---
title: 区块链基础
tags: ["区块链"]
abbrlink: eb2c6f22
categories:
  - 3-计算机系统
  - 计算机基础
date: 2018-01-29 10:50:00
---

# 区块链

区块链属于一种去中心化的记录技术。参与到系统上的节点，可能不属于同一组织、彼此无需信任；区块链数据由所有节点共同维护，每个参与维护节点都能复制获得一份完整记录的拷贝。

### 特点
跟传统的记账技术相比，其特点应该包括：

* 维护一条不断增长的链，只可能添加记录，而发生过的记录都不可篡改；
* 去中心化，或者说多中心化，无需集中的控制而能达成共识，实现上尽量分布式；
* 通过密码学的机制来确保交易无法抵赖和破坏，并尽量保护用户信息和记录的隐私性。


### 基本原理
区块链的基本原理理解起来并不难。基本概念包括：

* 交易（Transaction）：一次操作，导致账本状态的一次改变，如添加一条记录；
* 区块（Block）：记录一段时间内发生的交易和状态结果，是对当前账本状态的一次共识；
* 链（Chain）：由一个个区块按照发生顺序串联而成，是整个状态变化的日志记录。
<!-- more -->

### 分类
根据参与者的不同，可以分为公开（Public）链、联盟（Consortium）链和私有（Private）链。
目前来看，公开链将会更多的吸引社区和媒体的眼球，但更多的商业价值应该在联盟链和私有链上。

根据使用目的和场景的不同，又可以分为以数字货币为目的的货币链，以记录产权为目的的产权链，以众筹为目的的众筹链等。

### 存储
首先，区块链不是数据库。虽然区块链也可以用来存储数据，但它要解决的问题是多方的互信问题。单纯从存储数据角度，它的效率可能不高，笔者也不推荐把大量的原始数据放到区块链上。

### 计算
区块链技术还能带来更通用的计算能力。Hyperledger 和 Ethereum 就试图做类似的事情，基于区块链再做一层平台层，让别人基于平台开发应用变得更简单。




# 分布式问题

### 一致性

理想的分布式系统一致性应该满足：

* 可终止性（Termination）：一致的结果在有限时间内能完成；
* 共识性（Consensus）：不同节点最终完成决策的结果应该相同；
* 合法性（Validity）：决策的结果必须是其它进程提出的提案。


实际上，越强的一致性要求往往意味着越弱的性能。


### FLP 不可能性原理

FLP 不可能原理：在网络可靠，存在节点失效（即便只有一个）的最小化异步模型系统中，不存在一个可以解决一致性问题的确定性算法。

FLP 不可能原理实际上告诉人们，不要浪费时间去为异步分布式系统设计在任意场景下都能实现共识的算法。


### CAP 原理

* 一致性（Consistency）：任何操作应该都是原子的，发生在后面的事件能看到前面事件发生导致的结果，注意这里指的是强一致性；
* 可用性（Availablity）：在有限时间内，任何非失败节点都能应答请求；
* 分区容忍性（Partition）：网络可能发生分区，即节点之间的通信不可保障。

1. 弱化一致性  对结果一致性不敏感的应用，可以允许在新版本上线后过一段时间才更新成功，期间不保证一致性。

2. 弱化可用性  对结果一致性很敏感的应用，例如银行取款机，当系统故障时候会拒绝服务。MongoDB、Redis 等为此设计。Paxos、Raft 等算法，主要处理这种情况。

3. 弱化分区容忍性  现实中，网络分区出现概率减小，但较难避免。某些关系型数据库、ZooKeeper 即为此设计。


### ACID 原则


即 Atomicity（原子性）、Consistency（一致性）、Isolation（隔离性）、Durability（持久性）。

ACID 原则描述了对分布式数据库的一致性需求，同时付出了可用性的代价。

* Atomicity：每次操作是原子的，要么成功，要么不执行；
* Consistency：数据库的状态是一致的，无中间状态；
* Isolation：各种操作彼此互相不影响；
* Durability：状态的改变是持久的，不会失效。

一个与之相对的原则是 BASE（Basic Availiability，Soft state，Eventually Consistency），牺牲掉对一致性的约束（最终一致性），来换取一定的可用性。


# 密码学


### hash

一个优秀的 hash 算法，将能实现：

* 正向快速：给定明文和 hash 算法，在有限时间和有限资源内能计算出 hash 值。
* 逆向困难：给定（若干） hash 值，在有限时间内很难（基本不可能）逆推出明文。
* 输入敏感：原始输入信息修改一点信息，产生的 hash 值看起来应该都有很大不同。
* 冲突避免：很难找到两段内容不同的明文，使得它们的 hash 值一致（发生冲突）



### 加解密

根据加解密的密钥是否相同，算法可以分为对称加密（symmetric cryptography，又称公共密钥加密，common-key cryptography）和非对称加密(asymmetric cryptography，又称公钥加密，public-key cryptography)。两种模式适用于不同的需求，恰好形成互补，很多时候也可以组合使用，形成混合加密机制。


* 对称加密

优点是加解密效率高（速度快，空间占用小），加密强度高。

缺点是参与多方都需要持有密钥，一旦有人泄露则安全性被破坏；另外如何在不安全通道下分发密钥也是个问题。

适用于大量数据的加解密；不能用于签名场景；需要提前分发密钥。

* 非对称加密

非对称加密是现代密码学历史上最为伟大的发明，可以很好的解决对称加密需要的提前分发密钥问题。

顾名思义，加密密钥和解密密钥是不同的，分别称为公钥和私钥。
公钥一般是公开的，人人可获取的，私钥一般是个人自己持有，不能被他人获取。
优点是公私钥分开，不安全通道也可使用。
缺点是加解密速度慢，一般比对称加解密算法慢两到三个数量级；同时加密强度相比对称加密要差。

一般适用于签名场景或密钥协商，不适于大量数据的加解密。

* 混合加密机制

即先用计算复杂度高的非对称加密协商一个临时的对称加密密钥（会话密钥，一般相对内容来说要短的多），然后双方再通过对称加密对传递的大量数据进行加解密处理。

典型的场景是现在大家常用的 HTTPS 机制。



